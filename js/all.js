!function(){var n;function e(n,e){var t=function(){return t.method.apply(t.scope,arguments)};return t.scope=n,t.method=e,t}window.js=js={_Boot:{}},window.zpp_nape=zpp_nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},util:{},space:{}},window.sandbox=sandbox={},window.nape=nape={shape:{},constraint:{},geom:{},phys:{},dynamics:{},callbacks:{},space:{},util:{}};var t=t=function(){};t.__name__=["Reflect"],t.field=function(n,e){try{return n[e]}catch(n){return null}},t.fields=function(n){var e=[];if(null!=n){var t=Object.prototype.hasOwnProperty;for(var i in n)"__id__"!=i&&"hx__closures__"!=i&&t.call(n,i)&&e.push(i)}return e},t.copy=function(n){for(var e={},i=0,p=t.fields(n);i<p.length;){var l=p[i];++i,e[l]=t.field(n,l)}return e},t.prototype.__class__=t;var i=i=function(){};i.__name__=["Std"],i.string=function(n){return r.__string_rec(n,"")},i.prototype.__class__=i;var p=p=function(){};p.__name__=["StringTools"],p.hex=function(n,e){for(var t="";t="0123456789ABCDEF".charAt(15&n)+t,(n>>>=4)>0;);if(null!=e)for(;t.length<e;)t="0"+t;return t},p.prototype.__class__=p;var l=js._Boot.HaxeError=function(n){Error.call(this),this.val=n,this.message=String(n),Error.captureStackTrace&&Error.captureStackTrace(this,l)};l.__name__=["js","_Boot","HaxeError"],l.__super__=Error,l.prototype=Object.create(Error.prototype),l.wrap=function(n){return n instanceof Error?n:new l(n)},l.prototype.val=null,l.prototype.__class__=l;var r=js.Boot=function(){};r.__name__=["js","Boot"],r.getClass=function(n){if(n instanceof Array&&null==n.__enum__)return Array;var e=n.__class__;if(null!=e)return e;var t=r.__nativeClassName(n);return null!=t?r.__resolveNativeClass(t):null},r.__string_rec=function(n,e){if(null==n)return"null";if(e.length>=5)return"<...>";var t=typeof n;switch("function"==t&&(n.__name__||n.__ename__)&&(t="object"),t){case"function":return"<function>";case"object":if(n instanceof Array){if(n.__enum__){if(2==n.length)return n[0];var i=n[0]+"(";e+="\t";for(var p=2,l=n.length;p<l;){var o=p++;i+=2!=o?","+r.__string_rec(n[o],e):r.__string_rec(n[o],e)}return i+")"}var a="[";e+="\t";for(var s=0,_=n.length;s<_;){var h=s++;a+=(h>0?",":"")+r.__string_rec(n[h],e)}return a+="]"}var u;try{u=n.toString}catch(n){return"???"}if(null!=u&&u!=Object.toString&&"function"==typeof u){var x=n.toString();if("[object Object]"!=x)return x}var d=null,y="{\n";e+="\t";var z=null!=n.hasOwnProperty;for(var d in n)z&&!n.hasOwnProperty(d)||"prototype"!=d&&"__class__"!=d&&"__super__"!=d&&"__interfaces__"!=d&&"__properties__"!=d&&(2!=y.length&&(y+=", \n"),y+=e+d+" : "+r.__string_rec(n[d],e));return y+="\n"+(e=e.substring(1))+"}";case"string":return n;default:return String(n)}},r.__interfLoop=function(n,e){if(null==n)return!1;if(n==e)return!0;var t=n.__interfaces__;if(null!=t)for(var i=0,p=t.length;i<p;){var l=t[i++];if(l==e||r.__interfLoop(l,e))return!0}return r.__interfLoop(n.__super__,e)},r.__instanceof=function(n,e){if(null==e)return!1;switch(e){case Array:return n instanceof Array&&null==n.__enum__;case Cp:return"boolean"==typeof n;case wp:return!0;case Mp:return"number"==typeof n;case gp:return"number"==typeof n&&(0|n)===n;case String:return"string"==typeof n;default:if(null==n)return!1;if("function"==typeof e){if(n instanceof e)return!0;if(r.__interfLoop(r.getClass(n),e))return!0}else if("object"==typeof e&&r.__isNativeObj(e)&&n instanceof e)return!0;return e==kp&&null!=n.__name__||(e==Op&&null!=n.__ename__||n.__enum__==e)}},r.__nativeClassName=function(n){var e=r.__toStr.call(n).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},r.__isNativeObj=function(n){return null!=r.__nativeClassName(n)},r.__resolveNativeClass=function(n){return $global[n]},r.prototype.__class__=r;var o=nape.Config=function(){};o.__name__=["nape","Config"],o.prototype.__class__=o;var a=nape.callbacks.Callback=function(){this.zpp_inner=null};a.__name__=["nape","callbacks","Callback"],a.prototype.zpp_inner=null,a.prototype.get_event=function(){return ae.events[this.zpp_inner.event]},a.prototype.get_listener=function(){return this.zpp_inner.listener.outer},a.prototype.toString=function(){return""},Object.defineProperty(a.prototype,"event",{get:a.prototype.get_event}),Object.defineProperty(a.prototype,"listener",{get:a.prototype.get_listener}),a.prototype.__class__=a;var s=nape.callbacks.BodyCallback=function(){a.call(this)};s.__name__=["nape","callbacks","BodyCallback"],s.__super__=a,s.prototype=Object.create(a.prototype),s.prototype.get_body=function(){return this.zpp_inner.body.outer},s.prototype.toString=function(){var n="Cb:";return n="Cb:"+["WAKE","SLEEP"][this.zpp_inner.event-2],n+=":"+this.zpp_inner.body.outer.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(s.prototype,"body",{get:s.prototype.get_body}),s.prototype.__class__=s;var _=nape.callbacks.Listener=function(){this.zpp_inner=null};_.__name__=["nape","callbacks","Listener"],_.prototype.zpp_inner=null,_.prototype.get_type=function(){return ae.types[this.zpp_inner.type]},_.prototype.get_event=function(){return ae.events[this.zpp_inner.event]},_.prototype.set_event=function(n){var e;ae.events[this.zpp_inner.event]!=n&&(null==oe.CbEvent_BEGIN&&(oe.internal=!0,oe.CbEvent_BEGIN=new u,oe.internal=!1),n==oe.CbEvent_BEGIN?e=0:(null==oe.CbEvent_ONGOING&&(oe.internal=!0,oe.CbEvent_ONGOING=new u,oe.internal=!1),n==oe.CbEvent_ONGOING?e=6:(null==oe.CbEvent_END&&(oe.internal=!0,oe.CbEvent_END=new u,oe.internal=!1),n==oe.CbEvent_END?e=1:(null==oe.CbEvent_SLEEP&&(oe.internal=!0,oe.CbEvent_SLEEP=new u,oe.internal=!1),n==oe.CbEvent_SLEEP?e=3:(null==oe.CbEvent_WAKE&&(oe.internal=!0,oe.CbEvent_WAKE=new u,oe.internal=!1),n==oe.CbEvent_WAKE?e=2:(null==oe.CbEvent_PRE&&(oe.internal=!0,oe.CbEvent_PRE=new u,oe.internal=!1),e=n==oe.CbEvent_PRE?5:4))))),this.zpp_inner.swapEvent(e));return ae.events[this.zpp_inner.event]},_.prototype.get_precedence=function(){return this.zpp_inner.precedence},_.prototype.set_precedence=function(n){return this.zpp_inner.precedence!=n&&(this.zpp_inner.precedence=n,this.zpp_inner.invalidate_precedence()),this.zpp_inner.precedence},_.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},_.prototype.set_space=function(n){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n)if(null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(this),null!=n){var e=n.zpp_inner.wrap_listeners;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},_.prototype.toString=function(){var n=["BEGIN","END","WAKE","SLEEP","BREAK","PRE","ONGOING"][this.zpp_inner.event];if(0==this.zpp_inner.type)return"BodyListener{"+n+"::"+i.string(this.zpp_inner.body.outer_zn.zpp_inner_zn.options.outer)+"}";if(1==this.zpp_inner.type)return"ConstraintListener{"+n+"::"+i.string(this.zpp_inner.constraint.outer_zn.zpp_inner_zn.options.outer)+"}";var e,t=this.zpp_inner.interaction;switch(t.itype){case 1:e="COLLISION";break;case 2:e="SENSOR";break;case 4:e="FLUID";break;default:e="ALL"}return(2==this.zpp_inner.type?"InteractionListener{"+n+"#"+e+"::"+i.string(t.outer_zni.zpp_inner_zn.options1.outer)+":"+i.string(t.outer_zni.zpp_inner_zn.options2.outer)+"}":"PreListener{"+e+"::"+i.string(t.outer_znp.zpp_inner_zn.options1.outer)+":"+i.string(t.outer_znp.zpp_inner_zn.options2.outer)+"}")+" precedence="+this.zpp_inner.precedence},Object.defineProperty(_.prototype,"type",{get:_.prototype.get_type}),Object.defineProperty(_.prototype,"event",{get:_.prototype.get_event,set:_.prototype.set_event}),Object.defineProperty(_.prototype,"precedence",{get:_.prototype.get_precedence,set:_.prototype.set_precedence}),Object.defineProperty(_.prototype,"space",{get:_.prototype.get_space,set:_.prototype.set_space}),_.prototype.__class__=_;var h=nape.callbacks.BodyListener=function(n,e,t,i){null==i&&(i=0),this.zpp_inner_zn=null,_.call(this);var p=-1;null==oe.CbEvent_WAKE&&(oe.internal=!0,oe.CbEvent_WAKE=new u,oe.internal=!1),n==oe.CbEvent_WAKE?p=2:(null==oe.CbEvent_SLEEP&&(oe.internal=!0,oe.CbEvent_SLEEP=new u,oe.internal=!1),n==oe.CbEvent_SLEEP&&(p=3)),this.zpp_inner_zn=new se(xe.argument(e),p,t),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=i};h.__name__=["nape","callbacks","BodyListener"],h.__super__=_,h.prototype=Object.create(_.prototype),h.prototype.zpp_inner_zn=null,h.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},h.prototype.set_options=function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},h.prototype.get_handler=function(){return this.zpp_inner_zn.handler},h.prototype.set_handler=function(n){return this.zpp_inner_zn.handler=n,this.zpp_inner_zn.handler},Object.defineProperty(h.prototype,"options",{get:h.prototype.get_options,set:h.prototype.set_options}),Object.defineProperty(h.prototype,"handler",{get:h.prototype.get_handler,set:h.prototype.set_handler}),h.prototype.__class__=h;var u=nape.callbacks.CbEvent=function(){};u.__name__=["nape","callbacks","CbEvent"],u.BEGIN=null,u.get_BEGIN=function(){return null==oe.CbEvent_BEGIN&&(oe.internal=!0,oe.CbEvent_BEGIN=new u,oe.internal=!1),oe.CbEvent_BEGIN},u.ONGOING=null,u.get_ONGOING=function(){return null==oe.CbEvent_ONGOING&&(oe.internal=!0,oe.CbEvent_ONGOING=new u,oe.internal=!1),oe.CbEvent_ONGOING},u.END=null,u.get_END=function(){return null==oe.CbEvent_END&&(oe.internal=!0,oe.CbEvent_END=new u,oe.internal=!1),oe.CbEvent_END},u.WAKE=null,u.get_WAKE=function(){return null==oe.CbEvent_WAKE&&(oe.internal=!0,oe.CbEvent_WAKE=new u,oe.internal=!1),oe.CbEvent_WAKE},u.SLEEP=null,u.get_SLEEP=function(){return null==oe.CbEvent_SLEEP&&(oe.internal=!0,oe.CbEvent_SLEEP=new u,oe.internal=!1),oe.CbEvent_SLEEP},u.BREAK=null,u.get_BREAK=function(){return null==oe.CbEvent_BREAK&&(oe.internal=!0,oe.CbEvent_BREAK=new u,oe.internal=!1),oe.CbEvent_BREAK},u.PRE=null,u.get_PRE=function(){return null==oe.CbEvent_PRE&&(oe.internal=!0,oe.CbEvent_PRE=new u,oe.internal=!1),oe.CbEvent_PRE},u.prototype.toString=function(){return null==oe.CbEvent_PRE&&(oe.internal=!0,oe.CbEvent_PRE=new u,oe.internal=!1),this==oe.CbEvent_PRE?"PRE":(null==oe.CbEvent_BEGIN&&(oe.internal=!0,oe.CbEvent_BEGIN=new u,oe.internal=!1),this==oe.CbEvent_BEGIN?"BEGIN":(null==oe.CbEvent_ONGOING&&(oe.internal=!0,oe.CbEvent_ONGOING=new u,oe.internal=!1),this==oe.CbEvent_ONGOING?"ONGOING":(null==oe.CbEvent_END&&(oe.internal=!0,oe.CbEvent_END=new u,oe.internal=!1),this==oe.CbEvent_END?"END":(null==oe.CbEvent_WAKE&&(oe.internal=!0,oe.CbEvent_WAKE=new u,oe.internal=!1),this==oe.CbEvent_WAKE?"WAKE":(null==oe.CbEvent_SLEEP&&(oe.internal=!0,oe.CbEvent_SLEEP=new u,oe.internal=!1),this==oe.CbEvent_SLEEP?"SLEEP":(null==oe.CbEvent_BREAK&&(oe.internal=!0,oe.CbEvent_BREAK=new u,oe.internal=!1),this==oe.CbEvent_BREAK?"BREAK":""))))))},Object.defineProperty(u,"BEGIN",{get:u.get_BEGIN}),Object.defineProperty(u,"ONGOING",{get:u.get_ONGOING}),Object.defineProperty(u,"END",{get:u.get_END}),Object.defineProperty(u,"WAKE",{get:u.get_WAKE}),Object.defineProperty(u,"SLEEP",{get:u.get_SLEEP}),Object.defineProperty(u,"BREAK",{get:u.get_BREAK}),Object.defineProperty(u,"PRE",{get:u.get_PRE}),u.prototype.__class__=u;var x=nape.callbacks.CbType=function(){this.zpp_inner=null,this.zpp_inner=new re,this.zpp_inner.outer=this};x.__name__=["nape","callbacks","CbType"],x.ANY_BODY=null,x.get_ANY_BODY=function(){return re.ANY_BODY},x.ANY_CONSTRAINT=null,x.get_ANY_CONSTRAINT=function(){return re.ANY_CONSTRAINT},x.ANY_SHAPE=null,x.get_ANY_SHAPE=function(){return re.ANY_SHAPE},x.ANY_COMPOUND=null,x.get_ANY_COMPOUND=function(){return re.ANY_COMPOUND},x.prototype.zpp_inner=null,x.prototype.get_id=function(){return this.zpp_inner.id},x.prototype.including=function(n){return new M(this).including(n)},x.prototype.excluding=function(n){return new M(this).excluding(n)},x.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},x.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=Qi.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},x.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=Hi.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},x.prototype.toString=function(){return this==re.ANY_BODY?"ANY_BODY":this==re.ANY_SHAPE?"ANY_SHAPE":this==re.ANY_COMPOUND?"ANY_COMPOUND":this==re.ANY_CONSTRAINT?"ANY_CONSTRAINT":"CbType#"+this.zpp_inner.id},Object.defineProperty(x,"ANY_BODY",{get:x.get_ANY_BODY}),Object.defineProperty(x,"ANY_CONSTRAINT",{get:x.get_ANY_CONSTRAINT}),Object.defineProperty(x,"ANY_SHAPE",{get:x.get_ANY_SHAPE}),Object.defineProperty(x,"ANY_COMPOUND",{get:x.get_ANY_COMPOUND}),Object.defineProperty(x.prototype,"id",{get:x.prototype.get_id}),Object.defineProperty(x.prototype,"userData",{get:x.prototype.get_userData}),Object.defineProperty(x.prototype,"interactors",{get:x.prototype.get_interactors}),Object.defineProperty(x.prototype,"constraints",{get:x.prototype.get_constraints}),x.prototype.__class__=x;var d=nape.callbacks.CbTypeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};d.__name__=["nape","callbacks","CbTypeIterator"],d.get=function(n){var e;if(null==d.zpp_pool){tp.internal=!0;var t=new d;tp.internal=!1,e=t}else{var i=d.zpp_pool;d.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},d.prototype.zpp_inner=null,d.prototype.zpp_i=null,d.prototype.zpp_critical=null,d.prototype.zpp_next=null,d.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=d.zpp_pool,d.zpp_pool=this,this.zpp_inner=null,!1)},d.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},d.prototype.__class__=d;var y=nape.callbacks.CbTypeList=function(){this.zpp_inner=null,this.zpp_inner=new tp,this.zpp_inner.outer=this};y.__name__=["nape","callbacks","CbTypeList"],y.fromArray=function(n){for(var e=new y,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},y.prototype.zpp_inner=null,y.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},y.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},y.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},y.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},y.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},y.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},y.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},y.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},y.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},y.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},y.prototype.empty=function(){return null==this.zpp_inner.inner.head},y.prototype.iterator=function(){return this.zpp_inner.valmod(),d.get(this)},y.prototype.copy=function(n){null==n&&(n=!1);var e=new y;this.zpp_inner.valmod();for(var t=d.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=d.zpp_pool,d.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},y.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=d.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=d.zpp_pool,d.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},y.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=d.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=d.zpp_pool,d.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},y.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=d.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=d.zpp_pool,d.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=d.zpp_pool,d.zpp_pool=e,e.zpp_inner=null;break}}return this},y.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(y.prototype,"length",{get:y.prototype.get_length}),y.prototype.__class__=y;var z=nape.callbacks.ConstraintCallback=function(){a.call(this)};z.__name__=["nape","callbacks","ConstraintCallback"],z.__super__=a,z.prototype=Object.create(a.prototype),z.prototype.get_constraint=function(){return this.zpp_inner.constraint.outer},z.prototype.toString=function(){var n="Cb:";return n="Cb:"+["WAKE","SLEEP","BREAK"][this.zpp_inner.event-2],n+=":"+this.zpp_inner.constraint.outer.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(z.prototype,"constraint",{get:z.prototype.get_constraint}),z.prototype.__class__=z;var v=nape.callbacks.ConstraintListener=function(n,e,t,i){null==i&&(i=0),this.zpp_inner_zn=null,_.call(this);var p=-1;null==oe.CbEvent_WAKE&&(oe.internal=!0,oe.CbEvent_WAKE=new u,oe.internal=!1),n==oe.CbEvent_WAKE?p=2:(null==oe.CbEvent_SLEEP&&(oe.internal=!0,oe.CbEvent_SLEEP=new u,oe.internal=!1),n==oe.CbEvent_SLEEP?p=3:(null==oe.CbEvent_BREAK&&(oe.internal=!0,oe.CbEvent_BREAK=new u,oe.internal=!1),n==oe.CbEvent_BREAK&&(p=4))),this.zpp_inner_zn=new _e(xe.argument(e),p,t),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner.precedence=i};v.__name__=["nape","callbacks","ConstraintListener"],v.__super__=_,v.prototype=Object.create(_.prototype),v.prototype.zpp_inner_zn=null,v.prototype.get_options=function(){return this.zpp_inner_zn.options.outer},v.prototype.set_options=function(n){return this.zpp_inner_zn.options.set(n.zpp_inner),this.zpp_inner_zn.options.outer},v.prototype.get_handler=function(){return this.zpp_inner_zn.handler},v.prototype.set_handler=function(n){return this.zpp_inner_zn.handler=n,this.zpp_inner_zn.handler},Object.defineProperty(v.prototype,"options",{get:v.prototype.get_options,set:v.prototype.set_options}),Object.defineProperty(v.prototype,"handler",{get:v.prototype.get_handler,set:v.prototype.set_handler}),v.prototype.__class__=v;var c=nape.callbacks.InteractionCallback=function(){a.call(this)};c.__name__=["nape","callbacks","InteractionCallback"],c.__super__=a,c.prototype=Object.create(a.prototype),c.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},c.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},c.prototype.get_arbiters=function(){return this.zpp_inner.wrap_arbiters},c.prototype.toString=function(){var n="Cb:";return n="Cb:"+["BEGIN","END","","","","","ONGOING"][this.zpp_inner.event],n+=":"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),n+=" : "+this.zpp_inner.wrap_arbiters.toString(),n+=" : listener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(c.prototype,"int1",{get:c.prototype.get_int1}),Object.defineProperty(c.prototype,"int2",{get:c.prototype.get_int2}),Object.defineProperty(c.prototype,"arbiters",{get:c.prototype.get_arbiters}),c.prototype.__class__=c;var f=nape.callbacks.InteractionListener=function(n,e,t,i,p,l){null==l&&(l=0),this.zpp_inner_zn=null,_.call(this);var r=-1;null==oe.CbEvent_BEGIN&&(oe.internal=!0,oe.CbEvent_BEGIN=new u,oe.internal=!1),n==oe.CbEvent_BEGIN?r=0:(null==oe.CbEvent_END&&(oe.internal=!0,oe.CbEvent_END=new u,oe.internal=!1),n==oe.CbEvent_END?r=1:(null==oe.CbEvent_ONGOING&&(oe.internal=!0,oe.CbEvent_ONGOING=new u,oe.internal=!1),n==oe.CbEvent_ONGOING&&(r=6))),this.zpp_inner_zn=new ue(xe.argument(t),xe.argument(i),r,2),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zni=this,this.zpp_inner.precedence=l,this.zpp_inner_zn.handleri=p;var o,a,s=this.zpp_inner_zn.itype;(1==s?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),o=oe.InteractionType_COLLISION):2==s?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),o=oe.InteractionType_SENSOR):4==s?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),o=oe.InteractionType_FLUID):7==s?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),o=oe.InteractionType_ANY):o=null,o!=e)&&(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),e==oe.InteractionType_COLLISION?a=1:(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),e==oe.InteractionType_SENSOR?a=2:(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),a=e==oe.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=a);var h=this.zpp_inner_zn.itype;1==h?null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1):2==h?null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1):4==h?null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1):7==h&&null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1)};f.__name__=["nape","callbacks","InteractionListener"],f.__super__=_,f.prototype=Object.create(_.prototype),f.prototype.zpp_inner_zn=null,f.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},f.prototype.set_options1=function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},f.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},f.prototype.set_options2=function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},f.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),oe.InteractionType_COLLISION):2==n?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),oe.InteractionType_SENSOR):4==n?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),oe.InteractionType_FLUID):7==n?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),oe.InteractionType_ANY):null},f.prototype.set_interactionType=function(n){var e,t,i=this.zpp_inner_zn.itype;(1==i?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),e=oe.InteractionType_COLLISION):2==i?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),e=oe.InteractionType_SENSOR):4==i?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),e=oe.InteractionType_FLUID):7==i?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),e=oe.InteractionType_ANY):e=null,e!=n)&&(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),n==oe.InteractionType_COLLISION?t=1:(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),n==oe.InteractionType_SENSOR?t=2:(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),t=n==oe.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=t);var p=this.zpp_inner_zn.itype;return 1==p?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),oe.InteractionType_COLLISION):2==p?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),oe.InteractionType_SENSOR):4==p?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),oe.InteractionType_FLUID):7==p?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),oe.InteractionType_ANY):null},f.prototype.get_handler=function(){return this.zpp_inner_zn.handleri},f.prototype.set_handler=function(n){return this.zpp_inner_zn.handleri=n,this.zpp_inner_zn.handleri},f.prototype.get_allowSleepingCallbacks=function(){return this.zpp_inner_zn.allowSleepingCallbacks},f.prototype.set_allowSleepingCallbacks=function(n){return this.zpp_inner_zn.allowSleepingCallbacks=n,this.zpp_inner_zn.allowSleepingCallbacks},Object.defineProperty(f.prototype,"options1",{get:f.prototype.get_options1,set:f.prototype.set_options1}),Object.defineProperty(f.prototype,"options2",{get:f.prototype.get_options2,set:f.prototype.set_options2}),Object.defineProperty(f.prototype,"interactionType",{get:f.prototype.get_interactionType,set:f.prototype.set_interactionType}),Object.defineProperty(f.prototype,"handler",{get:f.prototype.get_handler,set:f.prototype.set_handler}),Object.defineProperty(f.prototype,"allowSleepingCallbacks",{get:f.prototype.get_allowSleepingCallbacks,set:f.prototype.set_allowSleepingCallbacks}),f.prototype.__class__=f;var m=nape.callbacks.InteractionType=function(){};m.__name__=["nape","callbacks","InteractionType"],m.COLLISION=null,m.get_COLLISION=function(){return null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),oe.InteractionType_COLLISION},m.SENSOR=null,m.get_SENSOR=function(){return null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),oe.InteractionType_SENSOR},m.FLUID=null,m.get_FLUID=function(){return null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),oe.InteractionType_FLUID},m.ANY=null,m.get_ANY=function(){return null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),oe.InteractionType_ANY},m.prototype.toString=function(){return null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),this==oe.InteractionType_COLLISION?"COLLISION":(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),this==oe.InteractionType_SENSOR?"SENSOR":(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),this==oe.InteractionType_FLUID?"FLUID":(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),this==oe.InteractionType_ANY?"ANY":"")))},Object.defineProperty(m,"COLLISION",{get:m.get_COLLISION}),Object.defineProperty(m,"SENSOR",{get:m.get_SENSOR}),Object.defineProperty(m,"FLUID",{get:m.get_FLUID}),Object.defineProperty(m,"ANY",{get:m.get_ANY}),m.prototype.__class__=m;var b=nape.callbacks.ListenerIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};b.__name__=["nape","callbacks","ListenerIterator"],b.get=function(n){var e;if(null==b.zpp_pool){ep.internal=!0;var t=new b;ep.internal=!1,e=t}else{var i=b.zpp_pool;b.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},b.prototype.zpp_inner=null,b.prototype.zpp_i=null,b.prototype.zpp_critical=null,b.prototype.zpp_next=null,b.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=b.zpp_pool,b.zpp_pool=this,this.zpp_inner=null,!1)},b.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},b.prototype.__class__=b;var g=nape.callbacks.ListenerList=function(){this.zpp_inner=null,this.zpp_inner=new ep,this.zpp_inner.outer=this};g.__name__=["nape","callbacks","ListenerList"],g.fromArray=function(n){for(var e=new g,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},g.prototype.zpp_inner=null,g.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},g.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},g.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},g.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},g.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},g.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},g.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},g.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},g.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},g.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},g.prototype.empty=function(){return null==this.zpp_inner.inner.head},g.prototype.iterator=function(){return this.zpp_inner.valmod(),b.get(this)},g.prototype.copy=function(n){null==n&&(n=!1);var e=new g;this.zpp_inner.valmod();for(var t=b.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=b.zpp_pool,b.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},g.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=b.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=b.zpp_pool,b.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},g.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=b.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=b.zpp_pool,b.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},g.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=b.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=b.zpp_pool,b.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=b.zpp_pool,b.zpp_pool=e,e.zpp_inner=null;break}}return this},g.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(g.prototype,"length",{get:g.prototype.get_length}),g.prototype.__class__=g;var w=nape.callbacks.ListenerType=function(){};w.__name__=["nape","callbacks","ListenerType"],w.BODY=null,w.get_BODY=function(){return null==oe.ListenerType_BODY&&(oe.internal=!0,oe.ListenerType_BODY=new w,oe.internal=!1),oe.ListenerType_BODY},w.CONSTRAINT=null,w.get_CONSTRAINT=function(){return null==oe.ListenerType_CONSTRAINT&&(oe.internal=!0,oe.ListenerType_CONSTRAINT=new w,oe.internal=!1),oe.ListenerType_CONSTRAINT},w.INTERACTION=null,w.get_INTERACTION=function(){return null==oe.ListenerType_INTERACTION&&(oe.internal=!0,oe.ListenerType_INTERACTION=new w,oe.internal=!1),oe.ListenerType_INTERACTION},w.PRE=null,w.get_PRE=function(){return null==oe.ListenerType_PRE&&(oe.internal=!0,oe.ListenerType_PRE=new w,oe.internal=!1),oe.ListenerType_PRE},w.prototype.toString=function(){return null==oe.ListenerType_BODY&&(oe.internal=!0,oe.ListenerType_BODY=new w,oe.internal=!1),this==oe.ListenerType_BODY?"BODY":(null==oe.ListenerType_CONSTRAINT&&(oe.internal=!0,oe.ListenerType_CONSTRAINT=new w,oe.internal=!1),this==oe.ListenerType_CONSTRAINT?"CONSTRAINT":(null==oe.ListenerType_INTERACTION&&(oe.internal=!0,oe.ListenerType_INTERACTION=new w,oe.internal=!1),this==oe.ListenerType_INTERACTION?"INTERACTION":(null==oe.ListenerType_PRE&&(oe.internal=!0,oe.ListenerType_PRE=new w,oe.internal=!1),this==oe.ListenerType_PRE?"PRE":"")))},Object.defineProperty(w,"BODY",{get:w.get_BODY}),Object.defineProperty(w,"CONSTRAINT",{get:w.get_CONSTRAINT}),Object.defineProperty(w,"INTERACTION",{get:w.get_INTERACTION}),Object.defineProperty(w,"PRE",{get:w.get_PRE}),w.prototype.__class__=w;var M=nape.callbacks.OptionType=function(n,e){this.zpp_inner=null,this.zpp_inner=new xe,this.zpp_inner.outer=this,null!=n&&this.including(n),null!=e&&this.excluding(e)};M.__name__=["nape","callbacks","OptionType"],M.prototype.zpp_inner=null,M.prototype.get_includes=function(){return null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes(),this.zpp_inner.wrap_includes},M.prototype.get_excludes=function(){return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),this.zpp_inner.wrap_excludes},M.prototype.including=function(n){return this.zpp_inner.append(this.zpp_inner.includes,n),this},M.prototype.excluding=function(n){return this.zpp_inner.append(this.zpp_inner.excludes,n),this},M.prototype.toString=function(){null==this.zpp_inner.wrap_includes&&this.zpp_inner.setup_includes();var n=this.zpp_inner.wrap_includes.toString();return null==this.zpp_inner.wrap_excludes&&this.zpp_inner.setup_excludes(),"@{"+n+" excluding "+this.zpp_inner.wrap_excludes.toString()+"}"},Object.defineProperty(M.prototype,"includes",{get:M.prototype.get_includes}),Object.defineProperty(M.prototype,"excludes",{get:M.prototype.get_excludes}),M.prototype.__class__=M;var C=nape.callbacks.PreCallback=function(){a.call(this)};C.__name__=["nape","callbacks","PreCallback"],C.__super__=a,C.prototype=Object.create(a.prototype),C.prototype.get_arbiter=function(){return this.zpp_inner.pre_arbiter.wrapper()},C.prototype.get_int1=function(){return this.zpp_inner.int1.outer_i},C.prototype.get_int2=function(){return this.zpp_inner.int2.outer_i},C.prototype.get_swapped=function(){return this.zpp_inner.pre_swapped},C.prototype.toString=function(){var n="Cb:PRE:";return n="Cb:PRE::"+this.zpp_inner.int1.outer_i.toString()+"/"+this.zpp_inner.int2.outer_i.toString(),n+=" : "+this.zpp_inner.pre_arbiter.wrapper().toString(),n+=" : listnener: "+i.string(this.zpp_inner.listener.outer)},Object.defineProperty(C.prototype,"arbiter",{get:C.prototype.get_arbiter}),Object.defineProperty(C.prototype,"int1",{get:C.prototype.get_int1}),Object.defineProperty(C.prototype,"int2",{get:C.prototype.get_int2}),Object.defineProperty(C.prototype,"swapped",{get:C.prototype.get_swapped}),C.prototype.__class__=C;var k=nape.callbacks.PreFlag=function(){};k.__name__=["nape","callbacks","PreFlag"],k.ACCEPT=null,k.get_ACCEPT=function(){return null==oe.PreFlag_ACCEPT&&(oe.internal=!0,oe.PreFlag_ACCEPT=new k,oe.internal=!1),oe.PreFlag_ACCEPT},k.IGNORE=null,k.get_IGNORE=function(){return null==oe.PreFlag_IGNORE&&(oe.internal=!0,oe.PreFlag_IGNORE=new k,oe.internal=!1),oe.PreFlag_IGNORE},k.ACCEPT_ONCE=null,k.get_ACCEPT_ONCE=function(){return null==oe.PreFlag_ACCEPT_ONCE&&(oe.internal=!0,oe.PreFlag_ACCEPT_ONCE=new k,oe.internal=!1),oe.PreFlag_ACCEPT_ONCE},k.IGNORE_ONCE=null,k.get_IGNORE_ONCE=function(){return null==oe.PreFlag_IGNORE_ONCE&&(oe.internal=!0,oe.PreFlag_IGNORE_ONCE=new k,oe.internal=!1),oe.PreFlag_IGNORE_ONCE},k.prototype.toString=function(){return null==oe.PreFlag_ACCEPT&&(oe.internal=!0,oe.PreFlag_ACCEPT=new k,oe.internal=!1),this==oe.PreFlag_ACCEPT?"ACCEPT":(null==oe.PreFlag_IGNORE&&(oe.internal=!0,oe.PreFlag_IGNORE=new k,oe.internal=!1),this==oe.PreFlag_IGNORE?"IGNORE":(null==oe.PreFlag_ACCEPT_ONCE&&(oe.internal=!0,oe.PreFlag_ACCEPT_ONCE=new k,oe.internal=!1),this==oe.PreFlag_ACCEPT_ONCE?"ACCEPT_ONCE":(null==oe.PreFlag_IGNORE_ONCE&&(oe.internal=!0,oe.PreFlag_IGNORE_ONCE=new k,oe.internal=!1),this==oe.PreFlag_IGNORE_ONCE?"IGNORE_ONCE":"")))},Object.defineProperty(k,"ACCEPT",{get:k.get_ACCEPT}),Object.defineProperty(k,"IGNORE",{get:k.get_IGNORE}),Object.defineProperty(k,"ACCEPT_ONCE",{get:k.get_ACCEPT_ONCE}),Object.defineProperty(k,"IGNORE_ONCE",{get:k.get_IGNORE_ONCE}),k.prototype.__class__=k;var O=nape.callbacks.PreListener=function(n,e,t,i,p,l){null==l&&(l=!1),null==p&&(p=0),this.zpp_inner_zn=null,_.call(this),this.zpp_inner_zn=new ue(xe.argument(e),xe.argument(t),5,3),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_znp=this,this.zpp_inner.precedence=p,this.zpp_inner_zn.pure=l,this.zpp_inner_zn.handlerp=i;var r,o,a=this.zpp_inner_zn.itype;(1==a?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),r=oe.InteractionType_COLLISION):2==a?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),r=oe.InteractionType_SENSOR):4==a?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),r=oe.InteractionType_FLUID):7==a?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),r=oe.InteractionType_ANY):r=null,r!=n)&&(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),n==oe.InteractionType_COLLISION?o=1:(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),n==oe.InteractionType_SENSOR?o=2:(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),o=n==oe.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=o);var s=this.zpp_inner_zn.itype;1==s?null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1):2==s?null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1):4==s?null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1):7==s&&null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1)};O.__name__=["nape","callbacks","PreListener"],O.__super__=_,O.prototype=Object.create(_.prototype),O.prototype.zpp_inner_zn=null,O.prototype.get_options1=function(){return this.zpp_inner_zn.options1.outer},O.prototype.set_options1=function(n){return this.zpp_inner_zn.options1.set(n.zpp_inner),this.zpp_inner_zn.options1.outer},O.prototype.get_options2=function(){return this.zpp_inner_zn.options2.outer},O.prototype.set_options2=function(n){return this.zpp_inner_zn.options2.set(n.zpp_inner),this.zpp_inner_zn.options2.outer},O.prototype.get_handler=function(){return this.zpp_inner_zn.handlerp},O.prototype.set_handler=function(n){return this.zpp_inner_zn.handlerp=n,this.zpp_inner_zn.wake(),this.zpp_inner_zn.handlerp},O.prototype.get_pure=function(){return this.zpp_inner_zn.pure},O.prototype.set_pure=function(n){return n||this.zpp_inner_zn.wake(),this.zpp_inner_zn.pure=n,this.zpp_inner_zn.pure},O.prototype.get_interactionType=function(){var n=this.zpp_inner_zn.itype;return 1==n?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),oe.InteractionType_COLLISION):2==n?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),oe.InteractionType_SENSOR):4==n?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),oe.InteractionType_FLUID):7==n?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),oe.InteractionType_ANY):null},O.prototype.set_interactionType=function(n){var e,t,i=this.zpp_inner_zn.itype;(1==i?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),e=oe.InteractionType_COLLISION):2==i?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),e=oe.InteractionType_SENSOR):4==i?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),e=oe.InteractionType_FLUID):7==i?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),e=oe.InteractionType_ANY):e=null,e!=n)&&(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),n==oe.InteractionType_COLLISION?t=1:(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),n==oe.InteractionType_SENSOR?t=2:(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),t=n==oe.InteractionType_FLUID?4:7)),this.zpp_inner_zn.itype=t);var p=this.zpp_inner_zn.itype;return 1==p?(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),oe.InteractionType_COLLISION):2==p?(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),oe.InteractionType_SENSOR):4==p?(null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),oe.InteractionType_FLUID):7==p?(null==oe.InteractionType_ANY&&(oe.internal=!0,oe.InteractionType_ANY=new m,oe.internal=!1),oe.InteractionType_ANY):null},Object.defineProperty(O.prototype,"options1",{get:O.prototype.get_options1,set:O.prototype.set_options1}),Object.defineProperty(O.prototype,"options2",{get:O.prototype.get_options2,set:O.prototype.set_options2}),Object.defineProperty(O.prototype,"handler",{get:O.prototype.get_handler,set:O.prototype.set_handler}),Object.defineProperty(O.prototype,"pure",{get:O.prototype.get_pure,set:O.prototype.set_pure}),Object.defineProperty(O.prototype,"interactionType",{get:O.prototype.get_interactionType,set:O.prototype.set_interactionType}),O.prototype.__class__=O;var P=nape.constraint.Constraint=function(){this.debugDraw=!0,this.zpp_inner.insert_cbtype(re.ANY_CONSTRAINT.zpp_inner)};P.__name__=["nape","constraint","Constraint"],P.prototype.zpp_inner=null,P.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},P.prototype.debugDraw=null,P.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},P.prototype.set_compound=function(n){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(this),null!=n)){var e=n.zpp_inner.wrap_constraints;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},P.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},P.prototype.set_space=function(n){if((null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n)if(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),null!=this.zpp_inner.space&&this.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(this),null!=n){var e=n.zpp_inner.wrap_constraints;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}else this.zpp_inner.space=null;return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},P.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},P.prototype.get_active=function(){return this.zpp_inner.active},P.prototype.set_active=function(n){return this.zpp_inner.active!=n&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.woken=!1),this.zpp_inner.clearcache(),n?(this.zpp_inner.active=n,this.zpp_inner.activate(),null!=this.zpp_inner.space&&(null!=this.zpp_inner.component&&(this.zpp_inner.component.sleeping=!0),this.zpp_inner.space.wake_constraint(this.zpp_inner,!0))):(null!=this.zpp_inner.space&&(this.zpp_inner.wake(),this.zpp_inner.space.live_constraints.remove(this.zpp_inner)),this.zpp_inner.active=n,this.zpp_inner.deactivate())),this.zpp_inner.active},P.prototype.get_ignore=function(){return this.zpp_inner.ignore},P.prototype.set_ignore=function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.ignore=n,this.zpp_inner.wake()),this.zpp_inner.ignore},P.prototype.get_stiff=function(){return this.zpp_inner.stiff},P.prototype.set_stiff=function(n){return this.zpp_inner.stiff!=n&&(this.zpp_inner.stiff=n,this.zpp_inner.wake()),this.zpp_inner.stiff},P.prototype.get_frequency=function(){return this.zpp_inner.frequency},P.prototype.set_frequency=function(n){return this.zpp_inner.frequency!=n&&(this.zpp_inner.frequency=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.frequency},P.prototype.get_damping=function(){return this.zpp_inner.damping},P.prototype.set_damping=function(n){return this.zpp_inner.damping!=n&&(this.zpp_inner.damping=n,this.zpp_inner.stiff||this.zpp_inner.wake()),this.zpp_inner.damping},P.prototype.get_maxForce=function(){return this.zpp_inner.maxForce},P.prototype.set_maxForce=function(n){return this.zpp_inner.maxForce!=n&&(this.zpp_inner.maxForce=n,this.zpp_inner.wake()),this.zpp_inner.maxForce},P.prototype.get_maxError=function(){return this.zpp_inner.maxError},P.prototype.set_maxError=function(n){return this.zpp_inner.maxError!=n&&(this.zpp_inner.maxError=n,this.zpp_inner.wake()),this.zpp_inner.maxError},P.prototype.get_breakUnderForce=function(){return this.zpp_inner.breakUnderForce},P.prototype.set_breakUnderForce=function(n){return this.zpp_inner.breakUnderForce!=n&&(this.zpp_inner.breakUnderForce=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderForce},P.prototype.get_breakUnderError=function(){return this.zpp_inner.breakUnderError},P.prototype.set_breakUnderError=function(n){return this.zpp_inner.breakUnderError!=n&&(this.zpp_inner.breakUnderError=n,this.zpp_inner.wake()),this.zpp_inner.breakUnderError},P.prototype.get_removeOnBreak=function(){return this.zpp_inner.removeOnBreak},P.prototype.set_removeOnBreak=function(n){return this.zpp_inner.removeOnBreak=n,this.zpp_inner.removeOnBreak},P.prototype.impulse=function(){return null},P.prototype.bodyImpulse=function(n){return null},P.prototype.visitBodies=function(n){},P.prototype.get_cbTypes=function(){return null==this.zpp_inner.wrap_cbTypes&&this.zpp_inner.setupcbTypes(),this.zpp_inner.wrap_cbTypes},P.prototype.toString=function(){return"{Constraint}"},P.prototype.copy=function(){return this.zpp_inner.copy()},Object.defineProperty(P.prototype,"userData",{get:P.prototype.get_userData}),Object.defineProperty(P.prototype,"compound",{get:P.prototype.get_compound,set:P.prototype.set_compound}),Object.defineProperty(P.prototype,"space",{get:P.prototype.get_space,set:P.prototype.set_space}),Object.defineProperty(P.prototype,"isSleeping",{get:P.prototype.get_isSleeping}),Object.defineProperty(P.prototype,"active",{get:P.prototype.get_active,set:P.prototype.set_active}),Object.defineProperty(P.prototype,"ignore",{get:P.prototype.get_ignore,set:P.prototype.set_ignore}),Object.defineProperty(P.prototype,"stiff",{get:P.prototype.get_stiff,set:P.prototype.set_stiff}),Object.defineProperty(P.prototype,"frequency",{get:P.prototype.get_frequency,set:P.prototype.set_frequency}),Object.defineProperty(P.prototype,"damping",{get:P.prototype.get_damping,set:P.prototype.set_damping}),Object.defineProperty(P.prototype,"maxForce",{get:P.prototype.get_maxForce,set:P.prototype.set_maxForce}),Object.defineProperty(P.prototype,"maxError",{get:P.prototype.get_maxError,set:P.prototype.set_maxError}),Object.defineProperty(P.prototype,"breakUnderForce",{get:P.prototype.get_breakUnderForce,set:P.prototype.set_breakUnderForce}),Object.defineProperty(P.prototype,"breakUnderError",{get:P.prototype.get_breakUnderError,set:P.prototype.set_breakUnderError}),Object.defineProperty(P.prototype,"removeOnBreak",{get:P.prototype.get_removeOnBreak,set:P.prototype.set_removeOnBreak}),Object.defineProperty(P.prototype,"cbTypes",{get:P.prototype.get_cbTypes}),P.prototype.__class__=P;var S=nape.constraint.AngleJoint=function(n,e,t,i,p){null==p&&(p=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new ye,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==e?null:e.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=t&&(this.zpp_inner_zn.jointMin=t,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=i&&(this.zpp_inner_zn.jointMax=i,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=p&&(this.zpp_inner_zn.ratio=p,this.zpp_inner.wake())};S.__name__=["nape","constraint","AngleJoint"],S.__super__=P,S.prototype=Object.create(P.prototype),S.prototype.zpp_inner_zn=null,S.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},S.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},S.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},S.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},S.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},S.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},S.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},S.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},S.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},S.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("AngleJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},S.prototype.isSlack=function(){var n,e=this.zpp_inner_zn,t=e.ratio*e.b2.rot-e.b1.rot;return e.equal?(n=!1,e.scale=1):t<e.jointMin?(e.scale=-1,n=!1):t>e.jointMax?(t-=e.jointMax,e.scale=1,n=!1):(e.scale=0,t=0,n=!0),n},S.prototype.impulse=function(){var n=new _n(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},S.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get(0,0,0)},S.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(S.prototype,"body1",{get:S.prototype.get_body1,set:S.prototype.set_body1}),Object.defineProperty(S.prototype,"body2",{get:S.prototype.get_body2,set:S.prototype.set_body2}),Object.defineProperty(S.prototype,"jointMin",{get:S.prototype.get_jointMin,set:S.prototype.set_jointMin}),Object.defineProperty(S.prototype,"jointMax",{get:S.prototype.get_jointMax,set:S.prototype.set_jointMax}),Object.defineProperty(S.prototype,"ratio",{get:S.prototype.get_ratio,set:S.prototype.set_ratio}),S.prototype.__class__=S;var A=nape.constraint.ConstraintIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};A.__name__=["nape","constraint","ConstraintIterator"],A.get=function(n){var e;if(null==A.zpp_pool){Hi.internal=!0;var t=new A;Hi.internal=!1,e=t}else{var i=A.zpp_pool;A.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},A.prototype.zpp_inner=null,A.prototype.zpp_i=null,A.prototype.zpp_critical=null,A.prototype.zpp_next=null,A.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=A.zpp_pool,A.zpp_pool=this,this.zpp_inner=null,!1)},A.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},A.prototype.__class__=A;var j=nape.constraint.ConstraintList=function(){this.zpp_inner=null,this.zpp_inner=new Hi,this.zpp_inner.outer=this};j.__name__=["nape","constraint","ConstraintList"],j.fromArray=function(n){for(var e=new j,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},j.prototype.zpp_inner=null,j.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},j.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},j.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},j.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},j.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},j.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},j.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},j.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},j.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},j.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},j.prototype.empty=function(){return null==this.zpp_inner.inner.head},j.prototype.iterator=function(){return this.zpp_inner.valmod(),A.get(this)},j.prototype.copy=function(n){null==n&&(n=!1);var e=new j;this.zpp_inner.valmod();for(var t=A.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=A.zpp_pool,A.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},j.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=A.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=A.zpp_pool,A.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},j.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=A.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=A.zpp_pool,A.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},j.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=A.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=A.zpp_pool,A.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=A.zpp_pool,A.zpp_pool=e,e.zpp_inner=null;break}}return this},j.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(j.prototype,"length",{get:j.prototype.get_length}),j.prototype.__class__=j;var E=nape.constraint.DistanceJoint=function(n,e,t,i,p,l){this.zpp_inner_zn=null,this.zpp_inner_zn=new ve,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var r=null==n?null:n.zpp_inner;r!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b2!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var o=null==e?null:e.zpp_inner;o!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b1!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var a=this.zpp_inner_zn.wrap_a1,s=t.zpp_inner;null!=s._validate&&s._validate();var _=t.zpp_inner.x,h=t.zpp_inner;null!=h._validate&&h._validate();var u,x=t.zpp_inner.y,d=a.zpp_inner;if(null!=d._validate&&d._validate(),a.zpp_inner.x==_){var y=a.zpp_inner;null!=y._validate&&y._validate(),u=a.zpp_inner.y==x}else u=!1;if(!u){a.zpp_inner.x=_,a.zpp_inner.y=x;var z=a.zpp_inner;null!=z._invalidate&&z._invalidate(z)}if(t.zpp_inner.weak){var v=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=xp.poolVec2,xp.poolVec2=t,null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=xt.zpp_pool,xt.zpp_pool=v}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var c=this.zpp_inner_zn.wrap_a2,f=i.zpp_inner;null!=f._validate&&f._validate();var m=i.zpp_inner.x,b=i.zpp_inner;null!=b._validate&&b._validate();var g,w=i.zpp_inner.y,M=c.zpp_inner;if(null!=M._validate&&M._validate(),c.zpp_inner.x==m){var C=c.zpp_inner;null!=C._validate&&C._validate(),g=c.zpp_inner.y==w}else g=!1;if(!g){c.zpp_inner.x=m,c.zpp_inner.y=w;var k=c.zpp_inner;null!=k._invalidate&&k._invalidate(k)}if(i.zpp_inner.weak){var O=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=O.outer&&(O.outer.zpp_inner=null,O.outer=null),O._isimmutable=null,O._validate=null,O._invalidate=null,O.next=xt.zpp_pool,xt.zpp_pool=O}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=p&&(this.zpp_inner_zn.jointMin=p,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=l&&(this.zpp_inner_zn.jointMax=l,this.zpp_inner.wake())};E.__name__=["nape","constraint","DistanceJoint"],E.__super__=P,E.prototype=Object.create(P.prototype),E.prototype.zpp_inner_zn=null,E.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},E.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},E.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},E.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},E.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},E.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},E.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},E.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},E.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},E.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},E.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},E.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("DistanceJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},E.prototype.isSlack=function(){return this.zpp_inner_zn.slack},E.prototype.impulse=function(){var n=new _n(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},E.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get()},E.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(E.prototype,"body1",{get:E.prototype.get_body1,set:E.prototype.set_body1}),Object.defineProperty(E.prototype,"body2",{get:E.prototype.get_body2,set:E.prototype.set_body2}),Object.defineProperty(E.prototype,"anchor1",{get:E.prototype.get_anchor1,set:E.prototype.set_anchor1}),Object.defineProperty(E.prototype,"anchor2",{get:E.prototype.get_anchor2,set:E.prototype.set_anchor2}),Object.defineProperty(E.prototype,"jointMin",{get:E.prototype.get_jointMin,set:E.prototype.set_jointMin}),Object.defineProperty(E.prototype,"jointMax",{get:E.prototype.get_jointMax,set:E.prototype.set_jointMax}),E.prototype.__class__=E;var I=nape.constraint.LineJoint=function(n,e,t,i,p,l,r){this.zpp_inner_zn=null,this.zpp_inner_zn=new ce,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var o=null==n?null:n.zpp_inner;o!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=o,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=o&&this.zpp_inner_zn.b2!=o&&null!=o&&o.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=o&&o.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var a=null==e?null:e.zpp_inner;a!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=a,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=a&&this.zpp_inner_zn.b1!=a&&null!=a&&a.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=a&&a.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var s=this.zpp_inner_zn.wrap_a1,_=t.zpp_inner;null!=_._validate&&_._validate();var h=t.zpp_inner.x,u=t.zpp_inner;null!=u._validate&&u._validate();var x,d=t.zpp_inner.y,y=s.zpp_inner;if(null!=y._validate&&y._validate(),s.zpp_inner.x==h){var z=s.zpp_inner;null!=z._validate&&z._validate(),x=s.zpp_inner.y==d}else x=!1;if(!x){s.zpp_inner.x=h,s.zpp_inner.y=d;var v=s.zpp_inner;null!=v._invalidate&&v._invalidate(v)}if(t.zpp_inner.weak){var c=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=xp.poolVec2,xp.poolVec2=t,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=xt.zpp_pool,xt.zpp_pool=c}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var f=this.zpp_inner_zn.wrap_a2,m=i.zpp_inner;null!=m._validate&&m._validate();var b=i.zpp_inner.x,g=i.zpp_inner;null!=g._validate&&g._validate();var w,M=i.zpp_inner.y,C=f.zpp_inner;if(null!=C._validate&&C._validate(),f.zpp_inner.x==b){var k=f.zpp_inner;null!=k._validate&&k._validate(),w=f.zpp_inner.y==M}else w=!1;if(!w){f.zpp_inner.x=b,f.zpp_inner.y=M;var O=f.zpp_inner;null!=O._invalidate&&O._invalidate(O)}if(i.zpp_inner.weak){var S=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=S.outer&&(S.outer.zpp_inner=null,S.outer=null),S._isimmutable=null,S._validate=null,S._invalidate=null,S.next=xt.zpp_pool,xt.zpp_pool=S}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var A=this.zpp_inner_zn.wrap_n,j=p.zpp_inner;null!=j._validate&&j._validate();var E=p.zpp_inner.x,I=p.zpp_inner;null!=I._validate&&I._validate();var T,N=p.zpp_inner.y,L=A.zpp_inner;if(null!=L._validate&&L._validate(),A.zpp_inner.x==E){var V=A.zpp_inner;null!=V._validate&&V._validate(),T=A.zpp_inner.y==N}else T=!1;if(!T){A.zpp_inner.x=E,A.zpp_inner.y=N;var D=A.zpp_inner;null!=D._invalidate&&D._invalidate(D)}if(p.zpp_inner.weak){var F=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=xp.poolVec2,xp.poolVec2=p,null!=F.outer&&(F.outer.zpp_inner=null,F.outer=null),F._isimmutable=null,F._validate=null,F._invalidate=null,F.next=xt.zpp_pool,xt.zpp_pool=F}null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=l&&(this.zpp_inner_zn.jointMin=l,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=r&&(this.zpp_inner_zn.jointMax=r,this.zpp_inner.wake())};I.__name__=["nape","constraint","LineJoint"],I.__super__=P,I.prototype=Object.create(P.prototype),I.prototype.zpp_inner_zn=null,I.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},I.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},I.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},I.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},I.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},I.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},I.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},I.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},I.prototype.get_direction=function(){return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},I.prototype.set_direction=function(n){null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n();var e=this.zpp_inner_zn.wrap_n,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_n&&this.zpp_inner_zn.setup_n(),this.zpp_inner_zn.wrap_n},I.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},I.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},I.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},I.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("LineJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},I.prototype.impulse=function(){var n=new _n(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},I.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get()},I.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(I.prototype,"body1",{get:I.prototype.get_body1,set:I.prototype.set_body1}),Object.defineProperty(I.prototype,"body2",{get:I.prototype.get_body2,set:I.prototype.set_body2}),Object.defineProperty(I.prototype,"anchor1",{get:I.prototype.get_anchor1,set:I.prototype.set_anchor1}),Object.defineProperty(I.prototype,"anchor2",{get:I.prototype.get_anchor2,set:I.prototype.set_anchor2}),Object.defineProperty(I.prototype,"direction",{get:I.prototype.get_direction,set:I.prototype.set_direction}),Object.defineProperty(I.prototype,"jointMin",{get:I.prototype.get_jointMin,set:I.prototype.set_jointMin}),Object.defineProperty(I.prototype,"jointMax",{get:I.prototype.get_jointMax,set:I.prototype.set_jointMax}),I.prototype.__class__=I;var T=nape.constraint.MotorJoint=function(n,e,t,i){null==i&&(i=1),null==t&&(t=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new fe,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==e?null:e.zpp_inner;l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=t&&(this.zpp_inner_zn.rate=t,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=i&&(this.zpp_inner_zn.ratio=i,this.zpp_inner.wake())};T.__name__=["nape","constraint","MotorJoint"],T.__super__=P,T.prototype=Object.create(P.prototype),T.prototype.zpp_inner_zn=null,T.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},T.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},T.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},T.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},T.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},T.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("MotorJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},T.prototype.get_rate=function(){return this.zpp_inner_zn.rate},T.prototype.set_rate=function(n){return this.zpp_inner.immutable_midstep("MotorJoint::rate"),this.zpp_inner_zn.rate!=n&&(this.zpp_inner_zn.rate=n,this.zpp_inner.wake()),this.zpp_inner_zn.rate},T.prototype.impulse=function(){var n=new _n(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},T.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get()},T.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(T.prototype,"body1",{get:T.prototype.get_body1,set:T.prototype.set_body1}),Object.defineProperty(T.prototype,"body2",{get:T.prototype.get_body2,set:T.prototype.set_body2}),Object.defineProperty(T.prototype,"ratio",{get:T.prototype.get_ratio,set:T.prototype.set_ratio}),Object.defineProperty(T.prototype,"rate",{get:T.prototype.get_rate,set:T.prototype.set_rate}),T.prototype.__class__=T;var N=nape.constraint.PivotJoint=function(n,e,t,i){this.zpp_inner_zn=null,this.zpp_inner_zn=new me,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var p=null==n?null:n.zpp_inner;p!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=p,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=p&&this.zpp_inner_zn.b2!=p&&null!=p&&p.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=p&&p.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var l=null==e?null:e.zpp_inner;l!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b1!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var r=this.zpp_inner_zn.wrap_a1,o=t.zpp_inner;null!=o._validate&&o._validate();var a=t.zpp_inner.x,s=t.zpp_inner;null!=s._validate&&s._validate();var _,h=t.zpp_inner.y,u=r.zpp_inner;if(null!=u._validate&&u._validate(),r.zpp_inner.x==a){var x=r.zpp_inner;null!=x._validate&&x._validate(),_=r.zpp_inner.y==h}else _=!1;if(!_){r.zpp_inner.x=a,r.zpp_inner.y=h;var d=r.zpp_inner;null!=d._invalidate&&d._invalidate(d)}if(t.zpp_inner.weak){var y=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=xp.poolVec2,xp.poolVec2=t,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=xt.zpp_pool,xt.zpp_pool=y}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var z=this.zpp_inner_zn.wrap_a2,v=i.zpp_inner;null!=v._validate&&v._validate();var c=i.zpp_inner.x,f=i.zpp_inner;null!=f._validate&&f._validate();var m,b=i.zpp_inner.y,g=z.zpp_inner;if(null!=g._validate&&g._validate(),z.zpp_inner.x==c){var w=z.zpp_inner;null!=w._validate&&w._validate(),m=z.zpp_inner.y==b}else m=!1;if(!m){z.zpp_inner.x=c,z.zpp_inner.y=b;var M=z.zpp_inner;null!=M._invalidate&&M._invalidate(M)}if(i.zpp_inner.weak){var C=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=C.outer&&(C.outer.zpp_inner=null,C.outer=null),C._isimmutable=null,C._validate=null,C._invalidate=null,C.next=xt.zpp_pool,xt.zpp_pool=C}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2()};N.__name__=["nape","constraint","PivotJoint"],N.__super__=P,N.prototype=Object.create(P.prototype),N.prototype.zpp_inner_zn=null,N.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},N.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},N.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},N.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},N.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},N.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},N.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},N.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},N.prototype.impulse=function(){var n=new _n(2,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n},N.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get()},N.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(N.prototype,"body1",{get:N.prototype.get_body1,set:N.prototype.set_body1}),Object.defineProperty(N.prototype,"body2",{get:N.prototype.get_body2,set:N.prototype.set_body2}),Object.defineProperty(N.prototype,"anchor1",{get:N.prototype.get_anchor1,set:N.prototype.set_anchor1}),Object.defineProperty(N.prototype,"anchor2",{get:N.prototype.get_anchor2,set:N.prototype.set_anchor2}),N.prototype.__class__=N;var L=nape.constraint.PulleyJoint=function(n,e,t,i,p,l,r,o,a,s,_){null==_&&(_=1),this.zpp_inner_zn=null,this.zpp_inner_zn=new be,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var h=null==n?null:n.zpp_inner;h!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=h,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=h&&this.zpp_inner_zn.b2!=h&&this.zpp_inner_zn.b3!=h&&this.zpp_inner_zn.b4!=h&&null!=h&&h.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=h&&h.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var u=null==e?null:e.zpp_inner;u!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=u,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=u&&this.zpp_inner_zn.b1!=u&&this.zpp_inner_zn.b3!=u&&this.zpp_inner_zn.b4!=u&&null!=u&&u.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=u&&u.wake())),this.zpp_inner.immutable_midstep("Constraint::body3");var x=null==t?null:t.zpp_inner;x!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=x,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=x&&this.zpp_inner_zn.b1!=x&&this.zpp_inner_zn.b2!=x&&this.zpp_inner_zn.b4!=x&&null!=x&&x.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=x&&x.wake())),this.zpp_inner.immutable_midstep("Constraint::body4");var d=null==i?null:i.zpp_inner;d!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=d,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=d&&this.zpp_inner_zn.b1!=d&&this.zpp_inner_zn.b2!=d&&this.zpp_inner_zn.b3!=d&&null!=d&&d.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=d&&d.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var y=this.zpp_inner_zn.wrap_a1,z=p.zpp_inner;null!=z._validate&&z._validate();var v=p.zpp_inner.x,c=p.zpp_inner;null!=c._validate&&c._validate();var f,m=p.zpp_inner.y,b=y.zpp_inner;if(null!=b._validate&&b._validate(),y.zpp_inner.x==v){var g=y.zpp_inner;null!=g._validate&&g._validate(),f=y.zpp_inner.y==m}else f=!1;if(!f){y.zpp_inner.x=v,y.zpp_inner.y=m;var w=y.zpp_inner;null!=w._invalidate&&w._invalidate(w)}if(p.zpp_inner.weak){var M=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=xp.poolVec2,xp.poolVec2=p,null!=M.outer&&(M.outer.zpp_inner=null,M.outer=null),M._isimmutable=null,M._validate=null,M._invalidate=null,M.next=xt.zpp_pool,xt.zpp_pool=M}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var C=this.zpp_inner_zn.wrap_a2,k=l.zpp_inner;null!=k._validate&&k._validate();var O=l.zpp_inner.x,S=l.zpp_inner;null!=S._validate&&S._validate();var A,j=l.zpp_inner.y,E=C.zpp_inner;if(null!=E._validate&&E._validate(),C.zpp_inner.x==O){var I=C.zpp_inner;null!=I._validate&&I._validate(),A=C.zpp_inner.y==j}else A=!1;if(!A){C.zpp_inner.x=O,C.zpp_inner.y=j;var T=C.zpp_inner;null!=T._invalidate&&T._invalidate(T)}if(l.zpp_inner.weak){var N=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=xp.poolVec2,xp.poolVec2=l,null!=N.outer&&(N.outer.zpp_inner=null,N.outer=null),N._isimmutable=null,N._validate=null,N._invalidate=null,N.next=xt.zpp_pool,xt.zpp_pool=N}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var L=this.zpp_inner_zn.wrap_a3,V=r.zpp_inner;null!=V._validate&&V._validate();var D=r.zpp_inner.x,F=r.zpp_inner;null!=F._validate&&F._validate();var R,Z=r.zpp_inner.y,B=L.zpp_inner;if(null!=B._validate&&B._validate(),L.zpp_inner.x==D){var G=L.zpp_inner;null!=G._validate&&G._validate(),R=L.zpp_inner.y==Z}else R=!1;if(!R){L.zpp_inner.x=D,L.zpp_inner.y=Z;var q=L.zpp_inner;null!=q._invalidate&&q._invalidate(q)}if(r.zpp_inner.weak){var U=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=xp.poolVec2,xp.poolVec2=r,null!=U.outer&&(U.outer.zpp_inner=null,U.outer=null),U._isimmutable=null,U._validate=null,U._invalidate=null,U.next=xt.zpp_pool,xt.zpp_pool=U}null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var K=this.zpp_inner_zn.wrap_a4,W=o.zpp_inner;null!=W._validate&&W._validate();var Y=o.zpp_inner.x,J=o.zpp_inner;null!=J._validate&&J._validate();var X,H=o.zpp_inner.y,$=K.zpp_inner;if(null!=$._validate&&$._validate(),K.zpp_inner.x==Y){var Q=K.zpp_inner;null!=Q._validate&&Q._validate(),X=K.zpp_inner.y==H}else X=!1;if(!X){K.zpp_inner.x=Y,K.zpp_inner.y=H;var nn=K.zpp_inner;null!=nn._invalidate&&nn._invalidate(nn)}if(o.zpp_inner.weak){var en=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=xp.poolVec2,xp.poolVec2=o,null!=en.outer&&(en.outer.zpp_inner=null,en.outer=null),en._isimmutable=null,en._validate=null,en._invalidate=null,en.next=xt.zpp_pool,xt.zpp_pool=en}null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=_&&(this.zpp_inner_zn.ratio=_,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=a&&(this.zpp_inner_zn.jointMin=a,this.zpp_inner.wake()),this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=s&&(this.zpp_inner_zn.jointMax=s,this.zpp_inner.wake())};L.__name__=["nape","constraint","PulleyJoint"],L.__super__=P,L.prototype=Object.create(P.prototype),L.prototype.zpp_inner_zn=null,L.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},L.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b3!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},L.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},L.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b3!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},L.prototype.get_body3=function(){return null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},L.prototype.set_body3=function(n){this.zpp_inner.immutable_midstep("Constraint::body3");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b3&&(null!=this.zpp_inner_zn.b3&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b4!=this.zpp_inner_zn.b3&&null!=this.zpp_inner_zn.b3&&this.zpp_inner_zn.b3.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b3.wake()),this.zpp_inner_zn.b3=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b4!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer},L.prototype.get_body4=function(){return null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},L.prototype.set_body4=function(n){this.zpp_inner.immutable_midstep("Constraint::body4");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b4&&(null!=this.zpp_inner_zn.b4&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b3!=this.zpp_inner_zn.b4&&null!=this.zpp_inner_zn.b4&&this.zpp_inner_zn.b4.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b4.wake()),this.zpp_inner_zn.b4=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&this.zpp_inner_zn.b2!=e&&this.zpp_inner_zn.b3!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer},L.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},L.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},L.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},L.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},L.prototype.get_anchor3=function(){return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},L.prototype.set_anchor3=function(n){null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3();var e=this.zpp_inner_zn.wrap_a3,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a3&&this.zpp_inner_zn.setup_a3(),this.zpp_inner_zn.wrap_a3},L.prototype.get_anchor4=function(){return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},L.prototype.set_anchor4=function(n){null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4();var e=this.zpp_inner_zn.wrap_a4,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a4&&this.zpp_inner_zn.setup_a4(),this.zpp_inner_zn.wrap_a4},L.prototype.get_jointMin=function(){return this.zpp_inner_zn.jointMin},L.prototype.set_jointMin=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMin"),this.zpp_inner_zn.jointMin!=n&&(this.zpp_inner_zn.jointMin=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMin},L.prototype.get_jointMax=function(){return this.zpp_inner_zn.jointMax},L.prototype.set_jointMax=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::jointMax"),this.zpp_inner_zn.jointMax!=n&&(this.zpp_inner_zn.jointMax=n,this.zpp_inner.wake()),this.zpp_inner_zn.jointMax},L.prototype.get_ratio=function(){return this.zpp_inner_zn.ratio},L.prototype.set_ratio=function(n){return this.zpp_inner.immutable_midstep("PulleyJoint::ratio"),this.zpp_inner_zn.ratio!=n&&(this.zpp_inner_zn.ratio=n,this.zpp_inner.wake()),this.zpp_inner_zn.ratio},L.prototype.isSlack=function(){return this.zpp_inner_zn.slack},L.prototype.impulse=function(){var n=new _n(1,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAcc,n},L.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get()},L.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer),null!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&n(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer),null!=(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)!=(null==this.zpp_inner_zn.b3?null:this.zpp_inner_zn.b3.outer)&&n(null==this.zpp_inner_zn.b4?null:this.zpp_inner_zn.b4.outer)},Object.defineProperty(L.prototype,"body1",{get:L.prototype.get_body1,set:L.prototype.set_body1}),Object.defineProperty(L.prototype,"body2",{get:L.prototype.get_body2,set:L.prototype.set_body2}),Object.defineProperty(L.prototype,"body3",{get:L.prototype.get_body3,set:L.prototype.set_body3}),Object.defineProperty(L.prototype,"body4",{get:L.prototype.get_body4,set:L.prototype.set_body4}),Object.defineProperty(L.prototype,"anchor1",{get:L.prototype.get_anchor1,set:L.prototype.set_anchor1}),Object.defineProperty(L.prototype,"anchor2",{get:L.prototype.get_anchor2,set:L.prototype.set_anchor2}),Object.defineProperty(L.prototype,"anchor3",{get:L.prototype.get_anchor3,set:L.prototype.set_anchor3}),Object.defineProperty(L.prototype,"anchor4",{get:L.prototype.get_anchor4,set:L.prototype.set_anchor4}),Object.defineProperty(L.prototype,"jointMin",{get:L.prototype.get_jointMin,set:L.prototype.set_jointMin}),Object.defineProperty(L.prototype,"jointMax",{get:L.prototype.get_jointMax,set:L.prototype.set_jointMax}),Object.defineProperty(L.prototype,"ratio",{get:L.prototype.get_ratio,set:L.prototype.set_ratio}),L.prototype.__class__=L;var V=nape.constraint.UserConstraint=function(n,e){null==e&&(e=!1),this.zpp_inner_zn=null,this.zpp_inner_zn=new ge(n,e),this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this)};V.__name__=["nape","constraint","UserConstraint"],V.__super__=P,V.prototype=Object.create(P.prototype),V.prototype.zpp_inner_zn=null,V.prototype.__bindVec2=function(){var t=new yn;return t.zpp_inner._inuse=!0,t.zpp_inner._invalidate=e(n=this.zpp_inner_zn,n.bindVec2_invalidate),t},V.prototype.__copy=function(){return null},V.prototype.__broken=function(){},V.prototype.__validate=function(){},V.prototype.__draw=function(n){},V.prototype.__prepare=function(){},V.prototype.__position=function(n){},V.prototype.__velocity=function(n){},V.prototype.__eff_mass=function(n){},V.prototype.__clamp=function(n){},V.prototype.__impulse=function(n,e,t){},V.prototype.impulse=function(){for(var n=new _n(this.zpp_inner_zn.dim,1),e=0,t=this.zpp_inner_zn.dim;e<t;){var i=e++;n.zpp_inner.x[i*n.zpp_inner.n]=this.zpp_inner_zn.jAcc[i]}return n},V.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get()},V.prototype.visitBodies=function(n){for(var e=0,t=this.zpp_inner_zn.bodies.length;e<t;){var i=this.zpp_inner_zn.bodies[e];if(null!=i.body){for(var p=!1,l=e+1;l<t;)if(this.zpp_inner_zn.bodies[l++].body==i.body){p=!0;break}p||n(i.body.outer)}++e}},V.prototype.__invalidate=function(){this.zpp_inner.immutable_midstep("UserConstraint::invalidate()"),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner.wake()},V.prototype.__registerBody=function(n,e){return this.zpp_inner.immutable_midstep("UserConstraint::registerBody(..)"),n!=e&&(null!=n&&(this.zpp_inner_zn.remBody(n.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&n.zpp_inner.wake()),null!=e&&this.zpp_inner_zn.addBody(e.zpp_inner),this.zpp_inner.wake(),null!=e&&e.zpp_inner.wake()),e},V.prototype.__class__=V;var D=nape.constraint.WeldJoint=function(n,e,t,i,p){null==p&&(p=0),this.zpp_inner_zn=null,this.zpp_inner_zn=new Me,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.zpp_inner_zn.outer_zn=this,P.call(this),this.zpp_inner.immutable_midstep("Constraint::body1");var l=null==n?null:n.zpp_inner;l!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=l,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=l&&this.zpp_inner_zn.b2!=l&&null!=l&&l.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=l&&l.wake())),this.zpp_inner.immutable_midstep("Constraint::body2");var r=null==e?null:e.zpp_inner;r!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=r,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=r&&this.zpp_inner_zn.b1!=r&&null!=r&&r.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=r&&r.wake())),null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var o=this.zpp_inner_zn.wrap_a1,a=t.zpp_inner;null!=a._validate&&a._validate();var s=t.zpp_inner.x,_=t.zpp_inner;null!=_._validate&&_._validate();var h,u=t.zpp_inner.y,x=o.zpp_inner;if(null!=x._validate&&x._validate(),o.zpp_inner.x==s){var d=o.zpp_inner;null!=d._validate&&d._validate(),h=o.zpp_inner.y==u}else h=!1;if(!h){o.zpp_inner.x=s,o.zpp_inner.y=u;var y=o.zpp_inner;null!=y._invalidate&&y._invalidate(y)}if(t.zpp_inner.weak){var z=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=xp.poolVec2,xp.poolVec2=t,null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=xt.zpp_pool,xt.zpp_pool=z}null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var v=this.zpp_inner_zn.wrap_a2,c=i.zpp_inner;null!=c._validate&&c._validate();var f=i.zpp_inner.x,m=i.zpp_inner;null!=m._validate&&m._validate();var b,g=i.zpp_inner.y,w=v.zpp_inner;if(null!=w._validate&&w._validate(),v.zpp_inner.x==f){var M=v.zpp_inner;null!=M._validate&&M._validate(),b=v.zpp_inner.y==g}else b=!1;if(!b){v.zpp_inner.x=f,v.zpp_inner.y=g;var C=v.zpp_inner;null!=C._invalidate&&C._invalidate(C)}if(i.zpp_inner.weak){var k=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=k.outer&&(k.outer.zpp_inner=null,k.outer=null),k._isimmutable=null,k._validate=null,k._invalidate=null,k.next=xt.zpp_pool,xt.zpp_pool=k}null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=p&&(this.zpp_inner_zn.phase=p,this.zpp_inner.wake())};D.__name__=["nape","constraint","WeldJoint"],D.__super__=P,D.prototype=Object.create(P.prototype),D.prototype.zpp_inner_zn=null,D.prototype.get_body1=function(){return null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},D.prototype.set_body1=function(n){this.zpp_inner.immutable_midstep("Constraint::body1");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b1&&(null!=this.zpp_inner_zn.b1&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2!=this.zpp_inner_zn.b1&&null!=this.zpp_inner_zn.b1&&this.zpp_inner_zn.b1.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1.wake()),this.zpp_inner_zn.b1=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b2!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer},D.prototype.get_body2=function(){return null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},D.prototype.set_body2=function(n){this.zpp_inner.immutable_midstep("Constraint::body2");var e=null==n?null:n.zpp_inner;return e!=this.zpp_inner_zn.b2&&(null!=this.zpp_inner_zn.b2&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b1!=this.zpp_inner_zn.b2&&null!=this.zpp_inner_zn.b2&&this.zpp_inner_zn.b2.constraints.remove(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&this.zpp_inner_zn.b2.wake()),this.zpp_inner_zn.b2=e,null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&null!=e&&this.zpp_inner_zn.b1!=e&&null!=e&&e.constraints.add(this.zpp_inner),this.zpp_inner.active&&null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.wake(),null!=e&&e.wake())),null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer},D.prototype.get_anchor1=function(){return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},D.prototype.set_anchor1=function(n){null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1();var e=this.zpp_inner_zn.wrap_a1,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a1&&this.zpp_inner_zn.setup_a1(),this.zpp_inner_zn.wrap_a1},D.prototype.get_anchor2=function(){return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},D.prototype.set_anchor2=function(n){null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2();var e=this.zpp_inner_zn.wrap_a2,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner_zn.wrap_a2&&this.zpp_inner_zn.setup_a2(),this.zpp_inner_zn.wrap_a2},D.prototype.get_phase=function(){return this.zpp_inner_zn.phase},D.prototype.set_phase=function(n){return this.zpp_inner.immutable_midstep("WeldJoint::phase"),this.zpp_inner_zn.phase!=n&&(this.zpp_inner_zn.phase=n,this.zpp_inner.wake()),this.zpp_inner_zn.phase},D.prototype.impulse=function(){var n=new _n(3,1);return n.zpp_inner.x[0*n.zpp_inner.n]=this.zpp_inner_zn.jAccx,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccy,n.zpp_inner.x[n.zpp_inner.n]=this.zpp_inner_zn.jAccz,n},D.prototype.bodyImpulse=function(n){return this.zpp_inner.active?this.zpp_inner_zn.bodyImpulse(n.zpp_inner):cn.get()},D.prototype.visitBodies=function(n){null!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer),null!=(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)&&(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)!=(null==this.zpp_inner_zn.b1?null:this.zpp_inner_zn.b1.outer)&&n(null==this.zpp_inner_zn.b2?null:this.zpp_inner_zn.b2.outer)},Object.defineProperty(D.prototype,"body1",{get:D.prototype.get_body1,set:D.prototype.set_body1}),Object.defineProperty(D.prototype,"body2",{get:D.prototype.get_body2,set:D.prototype.set_body2}),Object.defineProperty(D.prototype,"anchor1",{get:D.prototype.get_anchor1,set:D.prototype.set_anchor1}),Object.defineProperty(D.prototype,"anchor2",{get:D.prototype.get_anchor2,set:D.prototype.set_anchor2}),Object.defineProperty(D.prototype,"phase",{get:D.prototype.get_phase,set:D.prototype.set_phase}),D.prototype.__class__=D;var F=nape.dynamics.Arbiter=function(){this.zpp_inner=null};F.__name__=["nape","dynamics","Arbiter"],F.prototype.zpp_inner=null,F.prototype.get_isSleeping=function(){return this.zpp_inner.sleeping},F.prototype.get_type=function(){return Ce.types[this.zpp_inner.type]},F.prototype.isCollisionArbiter=function(){return this.zpp_inner.type==Ce.COL},F.prototype.isFluidArbiter=function(){return this.zpp_inner.type==Ce.FLUID},F.prototype.isSensorArbiter=function(){return this.zpp_inner.type==Ce.SENSOR},F.prototype.get_collisionArbiter=function(){return this.zpp_inner.type==Ce.COL?this.zpp_inner.colarb.outer_zn:null},F.prototype.get_fluidArbiter=function(){return this.zpp_inner.type==Ce.FLUID?this.zpp_inner.fluidarb.outer_zn:null},F.prototype.get_shape1=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer},F.prototype.get_shape2=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer},F.prototype.get_body1=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b2.outer:this.zpp_inner.b1.outer},F.prototype.get_body2=function(){return this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.b1.outer:this.zpp_inner.b2.outer},F.prototype.get_state=function(){var n=this.zpp_inner.immState;return 5==n?(null==oe.PreFlag_ACCEPT&&(oe.internal=!0,oe.PreFlag_ACCEPT=new k,oe.internal=!1),oe.PreFlag_ACCEPT):1==n?(null==oe.PreFlag_ACCEPT_ONCE&&(oe.internal=!0,oe.PreFlag_ACCEPT_ONCE=new k,oe.internal=!1),oe.PreFlag_ACCEPT_ONCE):6==n?(null==oe.PreFlag_IGNORE&&(oe.internal=!0,oe.PreFlag_IGNORE=new k,oe.internal=!1),oe.PreFlag_IGNORE):(null==oe.PreFlag_IGNORE_ONCE&&(oe.internal=!0,oe.PreFlag_IGNORE_ONCE=new k,oe.internal=!1),oe.PreFlag_IGNORE_ONCE)},F.prototype.totalImpulse=function(n,e){return null==e&&(e=!1),cn.get(0,0,0)},F.prototype.toString=function(){var n=this.zpp_inner.type==Ce.COL?"CollisionArbiter":this.zpp_inner.type==Ce.FLUID?"FluidArbiter":"SensorArbiter";if(this.zpp_inner.cleared)return n+"(object-pooled)";var e,t=n+"("+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).toString()+"|"+(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).toString()+")"+(this.zpp_inner.type==Ce.COL?"["+["SD","DD"][this.zpp_inner.colarb.stat?0:1]+"]":"")+"<-",i=this.zpp_inner.immState;return 5==i?(null==oe.PreFlag_ACCEPT&&(oe.internal=!0,oe.PreFlag_ACCEPT=new k,oe.internal=!1),e=oe.PreFlag_ACCEPT):1==i?(null==oe.PreFlag_ACCEPT_ONCE&&(oe.internal=!0,oe.PreFlag_ACCEPT_ONCE=new k,oe.internal=!1),e=oe.PreFlag_ACCEPT_ONCE):6==i?(null==oe.PreFlag_IGNORE&&(oe.internal=!0,oe.PreFlag_IGNORE=new k,oe.internal=!1),e=oe.PreFlag_IGNORE):(null==oe.PreFlag_IGNORE_ONCE&&(oe.internal=!0,oe.PreFlag_IGNORE_ONCE=new k,oe.internal=!1),e=oe.PreFlag_IGNORE_ONCE),t+e.toString()},Object.defineProperty(F.prototype,"isSleeping",{get:F.prototype.get_isSleeping}),Object.defineProperty(F.prototype,"type",{get:F.prototype.get_type}),Object.defineProperty(F.prototype,"collisionArbiter",{get:F.prototype.get_collisionArbiter}),Object.defineProperty(F.prototype,"fluidArbiter",{get:F.prototype.get_fluidArbiter}),Object.defineProperty(F.prototype,"shape1",{get:F.prototype.get_shape1}),Object.defineProperty(F.prototype,"shape2",{get:F.prototype.get_shape2}),Object.defineProperty(F.prototype,"body1",{get:F.prototype.get_body1}),Object.defineProperty(F.prototype,"body2",{get:F.prototype.get_body2}),Object.defineProperty(F.prototype,"state",{get:F.prototype.get_state}),F.prototype.__class__=F;var R=nape.dynamics.ArbiterIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};R.__name__=["nape","dynamics","ArbiterIterator"],R.get=function(n){var e;if(null==R.zpp_pool){_p.internal=!0;var t=new R;_p.internal=!1,e=t}else{var i=R.zpp_pool;R.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},R.prototype.zpp_inner=null,R.prototype.zpp_i=null,R.prototype.zpp_critical=null,R.prototype.zpp_next=null,R.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=R.zpp_pool,R.zpp_pool=this,this.zpp_inner=null,!1)},R.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},R.prototype.__class__=R;var Z=nape.dynamics.ArbiterList=function(){this.zpp_inner=null,this.zpp_inner=new _p,this.zpp_inner.outer=this};Z.__name__=["nape","dynamics","ArbiterList"],Z.fromArray=function(n){for(var e=new Z,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},Z.prototype.zpp_inner=null,Z.prototype.get_length=function(){return this.zpp_gl()},Z.prototype.zpp_gl=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.head;null!=n;)n.elt.active&&this.zpp_inner.user_length++,n=n.next}return this.zpp_inner.user_length},Z.prototype.zpp_vm=function(){this.zpp_inner.valmod()},Z.prototype.has=function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},Z.prototype.at=function(n){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.head;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;!this.zpp_inner.at_ite.elt.active;)this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},Z.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},Z.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},Z.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var t=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2),i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.wrapper()},Z.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2),t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},Z.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},Z.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_vm(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},Z.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},Z.prototype.empty=function(){return 0==this.zpp_gl()},Z.prototype.iterator=function(){return this.zpp_vm(),R.get(this)},Z.prototype.copy=function(n){null==n&&(n=!1);for(var e=new Z,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i,p=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,t.zpp_i<p?i=!0:(t.zpp_next=R.zpp_pool,R.zpp_pool=t,t.zpp_inner=null,i=!1),!i)break;t.zpp_critical=!1;var l=t.zpp_inner.at(t.zpp_i++);e.push(n?null:l)}return e},Z.prototype.merge=function(n){for(var e=n.iterator();;){e.zpp_inner.zpp_inner.valmod();var t,i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,e.zpp_i<i?t=!0:(e.zpp_next=R.zpp_pool,R.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||this.add(p)}},Z.prototype.toString=function(){for(var n="[",e=!0,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i,p=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,t.zpp_i<p?i=!0:(t.zpp_next=R.zpp_pool,R.zpp_pool=t,t.zpp_inner=null,i=!1),!i)break;t.zpp_critical=!1;var l=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==l?"NULL":l.toString(),e=!1}return n+"]"},Z.prototype.foreach=function(n){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var t,i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,e.zpp_i<i?t=!0:(e.zpp_next=R.zpp_pool,R.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=R.zpp_pool,R.zpp_pool=e,e.zpp_inner=null;break}}return this},Z.prototype.filter=function(n){for(var e=0;e<this.zpp_gl();){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(Z.prototype,"length",{get:Z.prototype.get_length}),Z.prototype.__class__=Z;var B=nape.dynamics.ArbiterType=function(){};B.__name__=["nape","dynamics","ArbiterType"],B.COLLISION=null,B.get_COLLISION=function(){return null==oe.ArbiterType_COLLISION&&(oe.internal=!0,oe.ArbiterType_COLLISION=new B,oe.internal=!1),oe.ArbiterType_COLLISION},B.SENSOR=null,B.get_SENSOR=function(){return null==oe.ArbiterType_SENSOR&&(oe.internal=!0,oe.ArbiterType_SENSOR=new B,oe.internal=!1),oe.ArbiterType_SENSOR},B.FLUID=null,B.get_FLUID=function(){return null==oe.ArbiterType_FLUID&&(oe.internal=!0,oe.ArbiterType_FLUID=new B,oe.internal=!1),oe.ArbiterType_FLUID},B.prototype.toString=function(){return null==oe.ArbiterType_COLLISION&&(oe.internal=!0,oe.ArbiterType_COLLISION=new B,oe.internal=!1),this==oe.ArbiterType_COLLISION?"COLLISION":(null==oe.ArbiterType_SENSOR&&(oe.internal=!0,oe.ArbiterType_SENSOR=new B,oe.internal=!1),this==oe.ArbiterType_SENSOR?"SENSOR":(null==oe.ArbiterType_FLUID&&(oe.internal=!0,oe.ArbiterType_FLUID=new B,oe.internal=!1),this==oe.ArbiterType_FLUID?"FLUID":""))},Object.defineProperty(B,"COLLISION",{get:B.get_COLLISION}),Object.defineProperty(B,"SENSOR",{get:B.get_SENSOR}),Object.defineProperty(B,"FLUID",{get:B.get_FLUID}),B.prototype.__class__=B;var G=nape.dynamics.CollisionArbiter=function(){F.call(this)};G.__name__=["nape","dynamics","CollisionArbiter"],G.__super__=F,G.prototype=Object.create(F.prototype),G.prototype.get_contacts=function(){return null==this.zpp_inner.colarb.wrap_contacts&&this.zpp_inner.colarb.setupcontacts(),this.zpp_inner.colarb.wrap_contacts},G.prototype.get_normal=function(){return null==this.zpp_inner.colarb.wrap_normal&&this.zpp_inner.colarb.getnormal(),this.zpp_inner.colarb.wrap_normal},G.prototype.get_radius=function(){return this.zpp_inner.colarb.radius},G.prototype.get_referenceEdge1=function(){var n=this.zpp_inner.colarb.__ref_edge1;return null==n||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws2.outer:this.zpp_inner.ws1.outer).zpp_inner==n.polygon||(n=this.zpp_inner.colarb.__ref_edge2),null==n?null:n.wrapper()},G.prototype.get_referenceEdge2=function(){var n=this.zpp_inner.colarb.__ref_edge1;return null==n||1==(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner.type&&(this.zpp_inner.ws1.id>this.zpp_inner.ws2.id?this.zpp_inner.ws1.outer:this.zpp_inner.ws2.outer).zpp_inner==n.polygon||(n=this.zpp_inner.colarb.__ref_edge2),null==n?null:n.wrapper()},G.prototype.firstVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&-1==this.zpp_inner.colarb.__ref_vertex},G.prototype.secondVertex=function(){return null!=this.zpp_inner.colarb.__ref_edge1!=(null!=this.zpp_inner.colarb.__ref_edge2)&&1==this.zpp_inner.colarb.__ref_vertex},G.prototype.normalImpulse=function(n,e){null==e&&(e=!1);var t=0,i=0,p=0,l=this.zpp_inner.colarb;if(!e||l.oc1.fresh){var r=l.oc1.wrapper().normalImpulse(n),o=r.zpp_inner;null!=o._validate&&o._validate(),t+=r.zpp_inner.x;var a=r.zpp_inner;null!=a._validate&&a._validate(),i+=r.zpp_inner.y;var s=r.zpp_inner;null!=s._validate&&s._validate(),p+=r.zpp_inner.z,r.dispose()}if(l.hc2&&(!e||l.oc2.fresh)){var _=l.oc2.wrapper().normalImpulse(n),h=_.zpp_inner;null!=h._validate&&h._validate(),t+=_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),p+=_.zpp_inner.z,_.dispose()}return cn.get(t,i,p)},G.prototype.tangentImpulse=function(n,e){null==e&&(e=!1);var t=0,i=0,p=0,l=this.zpp_inner.colarb;if(!e||l.oc1.fresh){var r=l.oc1.wrapper().tangentImpulse(n),o=r.zpp_inner;null!=o._validate&&o._validate(),t+=r.zpp_inner.x;var a=r.zpp_inner;null!=a._validate&&a._validate(),i+=r.zpp_inner.y;var s=r.zpp_inner;null!=s._validate&&s._validate(),p+=r.zpp_inner.z,r.dispose()}if(l.hc2&&(!e||l.oc2.fresh)){var _=l.oc2.wrapper().tangentImpulse(n),h=_.zpp_inner;null!=h._validate&&h._validate(),t+=_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),p+=_.zpp_inner.z,_.dispose()}return cn.get(t,i,p)},G.prototype.totalImpulse=function(n,e){null==e&&(e=!1);var t=0,i=0,p=0,l=this.zpp_inner.colarb;if(!e||l.oc1.fresh){var r=l.oc1.wrapper().totalImpulse(n),o=r.zpp_inner;null!=o._validate&&o._validate(),t+=r.zpp_inner.x;var a=r.zpp_inner;null!=a._validate&&a._validate(),i+=r.zpp_inner.y;var s=r.zpp_inner;null!=s._validate&&s._validate(),p+=r.zpp_inner.z,r.dispose()}if(l.hc2&&(!e||l.oc2.fresh)){var _=l.oc2.wrapper().totalImpulse(n),h=_.zpp_inner;null!=h._validate&&h._validate(),t+=_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),p+=_.zpp_inner.z,_.dispose()}return cn.get(t,i,p)},G.prototype.rollingImpulse=function(n,e){null==e&&(e=!1);var t=this.zpp_inner.colarb;return!e||t.oc1.fresh?t.oc1.wrapper().rollingImpulse(n):0},G.prototype.get_elasticity=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.restitution},G.prototype.set_elasticity=function(n){var e=this.zpp_inner.colarb;e.restitution=n,e.userdef_restitution=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.restitution},G.prototype.get_dynamicFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.dyn_fric},G.prototype.set_dynamicFriction=function(n){var e=this.zpp_inner.colarb;e.dyn_fric=n,e.userdef_dyn_fric=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.dyn_fric},G.prototype.get_staticFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.stat_fric},G.prototype.set_staticFriction=function(n){var e=this.zpp_inner.colarb;e.stat_fric=n,e.userdef_stat_fric=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.stat_fric},G.prototype.get_rollingFriction=function(){var n=this.zpp_inner.colarb;return n.invalidated&&(n.invalidated=!1,n.userdef_restitution||(n.s1.material.elasticity<=-1/0||n.s2.material.elasticity<=-1/0?n.restitution=0:n.s1.material.elasticity>=1/0||n.s2.material.elasticity>=1/0?n.restitution=1:n.restitution=(n.s1.material.elasticity+n.s2.material.elasticity)/2,n.restitution<0&&(n.restitution=0),n.restitution>1&&(n.restitution=1)),n.userdef_dyn_fric||(n.dyn_fric=Math.sqrt(n.s1.material.dynamicFriction*n.s2.material.dynamicFriction)),n.userdef_stat_fric||(n.stat_fric=Math.sqrt(n.s1.material.staticFriction*n.s2.material.staticFriction)),n.userdef_rfric||(n.rfric=Math.sqrt(n.s1.material.rollingFriction*n.s2.material.rollingFriction))),n.rfric},G.prototype.set_rollingFriction=function(n){var e=this.zpp_inner.colarb;e.rfric=n,e.userdef_rfric=!0;var t=this.zpp_inner.colarb;return t.invalidated&&(t.invalidated=!1,t.userdef_restitution||(t.s1.material.elasticity<=-1/0||t.s2.material.elasticity<=-1/0?t.restitution=0:t.s1.material.elasticity>=1/0||t.s2.material.elasticity>=1/0?t.restitution=1:t.restitution=(t.s1.material.elasticity+t.s2.material.elasticity)/2,t.restitution<0&&(t.restitution=0),t.restitution>1&&(t.restitution=1)),t.userdef_dyn_fric||(t.dyn_fric=Math.sqrt(t.s1.material.dynamicFriction*t.s2.material.dynamicFriction)),t.userdef_stat_fric||(t.stat_fric=Math.sqrt(t.s1.material.staticFriction*t.s2.material.staticFriction)),t.userdef_rfric||(t.rfric=Math.sqrt(t.s1.material.rollingFriction*t.s2.material.rollingFriction))),t.rfric},Object.defineProperty(G.prototype,"contacts",{get:G.prototype.get_contacts}),Object.defineProperty(G.prototype,"normal",{get:G.prototype.get_normal}),Object.defineProperty(G.prototype,"radius",{get:G.prototype.get_radius}),Object.defineProperty(G.prototype,"referenceEdge1",{get:G.prototype.get_referenceEdge1}),Object.defineProperty(G.prototype,"referenceEdge2",{get:G.prototype.get_referenceEdge2}),Object.defineProperty(G.prototype,"elasticity",{get:G.prototype.get_elasticity,set:G.prototype.set_elasticity}),Object.defineProperty(G.prototype,"dynamicFriction",{get:G.prototype.get_dynamicFriction,set:G.prototype.set_dynamicFriction}),Object.defineProperty(G.prototype,"staticFriction",{get:G.prototype.get_staticFriction,set:G.prototype.set_staticFriction}),Object.defineProperty(G.prototype,"rollingFriction",{get:G.prototype.get_rollingFriction,set:G.prototype.set_rollingFriction}),G.prototype.__class__=G;var q=nape.dynamics.Contact=function(){this.zpp_inner=null};q.__name__=["nape","dynamics","Contact"],q.prototype.zpp_inner=null,q.prototype.get_arbiter=function(){if(null==this.zpp_inner.arbiter)return null;var n=this.zpp_inner.arbiter.outer;return n.zpp_inner.type==Ce.COL?n.zpp_inner.colarb.outer_zn:null},q.prototype.get_penetration=function(){return-this.zpp_inner.dist},q.prototype.get_position=function(){return null==this.zpp_inner.wrap_position&&this.zpp_inner.getposition(),this.zpp_inner.wrap_position},q.prototype.get_fresh=function(){return this.zpp_inner.fresh},q.prototype.normalImpulse=function(n){var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.inner,i=t.jnAcc;return null==n?cn.get(e.nx*i,e.ny*i):n==e.b1.outer?cn.get(e.nx*-i,e.ny*-i,-(e.ny*t.r1x-e.nx*t.r1y)*i):cn.get(e.nx*i,e.ny*i,(e.ny*t.r2x-e.nx*t.r2y)*i)},q.prototype.tangentImpulse=function(n){var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.inner,i=t.jtAcc;return null==n?cn.get(-e.ny*i,e.nx*i):n==e.b1.outer?cn.get(e.ny*i,-e.nx*i,-(t.r1x*e.nx+t.r1y*e.ny)*i):cn.get(-e.ny*i,e.nx*i,(t.r2x*e.nx+t.r2y*e.ny)*i)},q.prototype.rollingImpulse=function(n){var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.arbiter.colarb.jrAcc;return null==n?t:n==e.b1.outer?-t:t},q.prototype.totalImpulse=function(n){var e=this.zpp_inner.arbiter.colarb,t=this.zpp_inner.inner,i=t.jnAcc,p=t.jtAcc,l=e.jrAcc;if(null==n)return cn.get(e.nx*i-e.ny*p,e.ny*i+e.nx*p,l);var r=e.nx*i-e.ny*p,o=e.ny*i+e.nx*p;return n==e.b1.outer?cn.get(-r,-o,-(o*t.r1x-r*t.r1y)-l):cn.get(r,o,o*t.r2x-r*t.r2y+l)},q.prototype.get_friction=function(){return this.zpp_inner.inner.friction},q.prototype.toString=function(){return null==this.zpp_inner.arbiter||this.zpp_inner.arbiter.cleared?"{object-pooled}":"{Contact}"},Object.defineProperty(q.prototype,"arbiter",{get:q.prototype.get_arbiter}),Object.defineProperty(q.prototype,"penetration",{get:q.prototype.get_penetration}),Object.defineProperty(q.prototype,"position",{get:q.prototype.get_position}),Object.defineProperty(q.prototype,"fresh",{get:q.prototype.get_fresh}),Object.defineProperty(q.prototype,"friction",{get:q.prototype.get_friction}),q.prototype.__class__=q;var U=nape.dynamics.ContactIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};U.__name__=["nape","dynamics","ContactIterator"],U.get=function(n){var e;if(null==U.zpp_pool){hp.internal=!0;var t=new U;hp.internal=!1,e=t}else{var i=U.zpp_pool;U.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},U.prototype.zpp_inner=null,U.prototype.zpp_i=null,U.prototype.zpp_critical=null,U.prototype.zpp_next=null,U.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;if(n.zpp_inner.valmod(),n.zpp_inner.zip_length){n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=0;for(var e=n.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&n.zpp_inner.user_length++,e=e.next}}var i=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<i||(this.zpp_next=U.zpp_pool,U.zpp_pool=this,this.zpp_inner=null,!1)},U.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},U.prototype.__class__=U;var K=nape.dynamics.ContactList=function(){this.zpp_inner=null,this.zpp_inner=new hp,this.zpp_inner.outer=this};K.__name__=["nape","dynamics","ContactList"],K.fromArray=function(n){for(var e=new K,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},K.prototype.zpp_inner=null,K.prototype.get_length=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return this.zpp_inner.user_length},K.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},K.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var e=this.zpp_inner.inner.next;null!=e;){var t=e;t.active&&t.arbiter.active&&this.zpp_inner.user_length++,e=e.next}}n=this.zpp_inner.user_length-1-n}if(n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)for(this.zpp_inner.at_index=0,this.zpp_inner.at_ite=this.zpp_inner.inner.next;;){var i=this.zpp_inner.at_ite;if(i.active&&i.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}for(;this.zpp_inner.at_index!=n;)for(this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;;){var p=this.zpp_inner.at_ite;if(p.active&&p.arbiter.active)break;this.zpp_inner.at_ite=this.zpp_inner.at_ite.next}return this.zpp_inner.at_ite.wrapper()},K.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{if(null==this.zpp_inner.push_ite){var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var p=i;p.active&&p.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var l=this.zpp_inner.inner.next;null!=l;){var r=l;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,l=l.next}}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},K.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){if(null==this.zpp_inner.push_ite){var t;if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var p=i;p.active&&p.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(0==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var l=this.zpp_inner.inner.next;null!=l;){var r=l;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,l=l.next}}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)}this.zpp_inner.push_ite=t}this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},K.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var i=this.zpp_inner.inner.next;null!=i;){var p=i;p.active&&p.arbiter.active&&this.zpp_inner.user_length++,i=i.next}}if(1==this.zpp_inner.user_length)t=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var l=this.zpp_inner.inner.next;null!=l;){var r=l;r.active&&r.arbiter.active&&this.zpp_inner.user_length++,l=l.next}}t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}var o=(n=null==t?this.zpp_inner.inner.next:t.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.wrapper()},K.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;if(null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var i=t;i.active&&i.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(1==this.zpp_inner.user_length)e=null;else{if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var p=this.zpp_inner.inner.next;null!=p;){var l=p;l.active&&l.arbiter.active&&this.zpp_inner.user_length++,p=p.next}}e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2)}var r=(n=null==e?this.zpp_inner.inner.next:e.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(r),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var o=(n=this.zpp_inner.inner.next).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(o),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},K.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},K.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.next;null!=t;){if(t==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},K.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}if(0==this.zpp_inner.user_length)break;this.pop()}else for(;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var i=t;i.active&&i.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(0==this.zpp_inner.user_length)break;this.shift()}},K.prototype.empty=function(){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var n=this.zpp_inner.inner.next;null!=n;){var e=n;e.active&&e.arbiter.active&&this.zpp_inner.user_length++,n=n.next}}return 0==this.zpp_inner.user_length},K.prototype.iterator=function(){return this.zpp_inner.valmod(),U.get(this)},K.prototype.copy=function(n){null==n&&(n=!1);var e=new K;this.zpp_inner.valmod();for(var t=U.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var p=i.zpp_inner.inner.next;null!=p;){var l=p;l.active&&l.arbiter.active&&i.zpp_inner.user_length++,p=p.next}}var r,o=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<o?r=!0:(t.zpp_next=U.zpp_pool,U.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e.push(n?null:a)}return e},K.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=U.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var i=t.zpp_inner.inner.next;null!=i;){var p=i;p.active&&p.arbiter.active&&t.zpp_inner.user_length++,i=i.next}}var l,r=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<r?l=!0:(e.zpp_next=U.zpp_pool,U.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;e.zpp_critical=!1;var o=e.zpp_inner.at(e.zpp_i++);this.has(o)||(this.zpp_inner.reverse_flag?this.push(o):this.unshift(o))}},K.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=U.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;if(i.zpp_inner.valmod(),i.zpp_inner.zip_length){i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=0;for(var p=i.zpp_inner.inner.next;null!=p;){var l=p;l.active&&l.arbiter.active&&i.zpp_inner.user_length++,p=p.next}}var r,o=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<o?r=!0:(t.zpp_next=U.zpp_pool,U.zpp_pool=t,t.zpp_inner=null,r=!1),!r)break;t.zpp_critical=!1;var a=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==a?"NULL":a.toString(),e=!1}return n+"]"},K.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=U.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;if(t.zpp_inner.valmod(),t.zpp_inner.zip_length){t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=0;for(var i=t.zpp_inner.inner.next;null!=i;){var p=i;p.active&&p.arbiter.active&&t.zpp_inner.user_length++,i=i.next}}var l,r=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<r?l=!0:(e.zpp_next=U.zpp_pool,U.zpp_pool=e,e.zpp_inner=null,l=!1),!l)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=U.zpp_pool,U.zpp_pool=e,e.zpp_inner=null;break}}return this},K.prototype.filter=function(n){for(var e=0;;){if(this.zpp_inner.valmod(),this.zpp_inner.zip_length){this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=0;for(var t=this.zpp_inner.inner.next;null!=t;){var i=t;i.active&&i.arbiter.active&&this.zpp_inner.user_length++,t=t.next}}if(!(e<this.zpp_inner.user_length))break;var p=this.at(e);try{n(p)?++e:this.remove(p)}catch(n){break}}return this},Object.defineProperty(K.prototype,"length",{get:K.prototype.get_length}),K.prototype.__class__=K;var W=nape.dynamics.FluidArbiter=function(){F.call(this)};W.__name__=["nape","dynamics","FluidArbiter"],W.__super__=F,W.prototype=Object.create(F.prototype),W.prototype.get_position=function(){return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},W.prototype.set_position=function(n){null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition();var e=this.zpp_inner.fluidarb.wrap_position,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.fluidarb.wrap_position&&this.zpp_inner.fluidarb.getposition(),this.zpp_inner.fluidarb.wrap_position},W.prototype.get_overlap=function(){return this.zpp_inner.fluidarb.overlap},W.prototype.set_overlap=function(n){return this.zpp_inner.fluidarb.overlap=n,this.zpp_inner.fluidarb.overlap},W.prototype.buoyancyImpulse=function(n){var e=this.zpp_inner.fluidarb;return null==n?cn.get(e.buoyx,e.buoyy,0):n.zpp_inner==this.zpp_inner.b2?cn.get(e.buoyx,e.buoyy,e.buoyy*e.r2x-e.buoyx*e.r2y):cn.get(-e.buoyx,-e.buoyy,-(e.buoyy*e.r1x-e.buoyx*e.r1y))},W.prototype.dragImpulse=function(n){var e=this.zpp_inner.fluidarb,t=null==n||n.zpp_inner==this.zpp_inner.b2?1:-1;return cn.get(e.dampx*t,e.dampy*t,e.adamp*t)},W.prototype.totalImpulse=function(n,e){null==e&&(e=!1);var t=this.buoyancyImpulse(n),i=this.dragImpulse(n),p=i.zpp_inner;null!=p._validate&&p._validate();var l=i.zpp_inner.x,r=t.zpp_inner;null!=r._validate&&r._validate(),i.zpp_inner.x=l+t.zpp_inner.x;var o=i.zpp_inner;null!=o._validate&&o._validate();var a=i.zpp_inner;null!=a._validate&&a._validate();var s=i.zpp_inner.y,_=t.zpp_inner;null!=_._validate&&_._validate(),i.zpp_inner.y=s+t.zpp_inner.y;var h=i.zpp_inner;null!=h._validate&&h._validate();var u=i.zpp_inner;null!=u._validate&&u._validate();var x=i.zpp_inner.z,d=t.zpp_inner;null!=d._validate&&d._validate(),i.zpp_inner.z=x+t.zpp_inner.z;var y=i.zpp_inner;return null!=y._validate&&y._validate(),t.dispose(),i},Object.defineProperty(W.prototype,"position",{get:W.prototype.get_position,set:W.prototype.set_position}),Object.defineProperty(W.prototype,"overlap",{get:W.prototype.get_overlap,set:W.prototype.set_overlap}),W.prototype.__class__=W;var Y=nape.dynamics.InteractionFilter=function(n,e,t,i,p,l){null==l&&(l=-1),null==p&&(p=1),null==i&&(i=-1),null==t&&(t=1),null==e&&(e=-1),null==n&&(n=1),this.zpp_inner=null,null==je.zpp_pool?this.zpp_inner=new je:(this.zpp_inner=je.zpp_pool,je.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),this.zpp_inner.outer=this,this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask!=e&&(this.zpp_inner.collisionMask=e,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup!=t&&(this.zpp_inner.sensorGroup=t,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask!=i&&(this.zpp_inner.sensorMask=i,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup!=p&&(this.zpp_inner.fluidGroup=p,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask!=l&&(this.zpp_inner.fluidMask=l,this.zpp_inner.invalidate())};Y.__name__=["nape","dynamics","InteractionFilter"],Y.prototype.zpp_inner=null,Y.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Y.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=ap.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},Y.prototype.get_collisionGroup=function(){return this.zpp_inner.collisionGroup},Y.prototype.set_collisionGroup=function(n){return this.zpp_inner.collisionGroup!=n&&(this.zpp_inner.collisionGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionGroup},Y.prototype.get_collisionMask=function(){return this.zpp_inner.collisionMask},Y.prototype.set_collisionMask=function(n){return this.zpp_inner.collisionMask!=n&&(this.zpp_inner.collisionMask=n,this.zpp_inner.invalidate()),this.zpp_inner.collisionMask},Y.prototype.get_sensorGroup=function(){return this.zpp_inner.sensorGroup},Y.prototype.set_sensorGroup=function(n){return this.zpp_inner.sensorGroup!=n&&(this.zpp_inner.sensorGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorGroup},Y.prototype.get_sensorMask=function(){return this.zpp_inner.sensorMask},Y.prototype.set_sensorMask=function(n){return this.zpp_inner.sensorMask!=n&&(this.zpp_inner.sensorMask=n,this.zpp_inner.invalidate()),this.zpp_inner.sensorMask},Y.prototype.get_fluidGroup=function(){return this.zpp_inner.fluidGroup},Y.prototype.set_fluidGroup=function(n){return this.zpp_inner.fluidGroup!=n&&(this.zpp_inner.fluidGroup=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidGroup},Y.prototype.get_fluidMask=function(){return this.zpp_inner.fluidMask},Y.prototype.set_fluidMask=function(n){return this.zpp_inner.fluidMask!=n&&(this.zpp_inner.fluidMask=n,this.zpp_inner.invalidate()),this.zpp_inner.fluidMask},Y.prototype.shouldCollide=function(n){var e=this.zpp_inner,t=n.zpp_inner;return 0!=(e.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&e.collisionGroup)},Y.prototype.shouldSense=function(n){var e=this.zpp_inner,t=n.zpp_inner;return 0!=(e.sensorMask&t.sensorGroup)&&0!=(t.sensorMask&e.sensorGroup)},Y.prototype.shouldFlow=function(n){var e=this.zpp_inner,t=n.zpp_inner;return 0!=(e.fluidMask&t.fluidGroup)&&0!=(t.fluidMask&e.fluidGroup)},Y.prototype.copy=function(){return new Y(this.zpp_inner.collisionGroup,this.zpp_inner.collisionMask,this.zpp_inner.sensorGroup,this.zpp_inner.sensorMask,this.zpp_inner.fluidGroup,this.zpp_inner.fluidMask)},Y.prototype.toString=function(){return"{ collision: "+p.hex(this.zpp_inner.collisionGroup,8)+"~"+p.hex(this.zpp_inner.collisionMask,8)+" sensor: "+p.hex(this.zpp_inner.sensorGroup,8)+"~"+p.hex(this.zpp_inner.sensorMask,8)+" fluid: "+p.hex(this.zpp_inner.fluidGroup,8)+"~"+p.hex(this.zpp_inner.fluidMask,8)+" }"},Object.defineProperty(Y.prototype,"userData",{get:Y.prototype.get_userData}),Object.defineProperty(Y.prototype,"shapes",{get:Y.prototype.get_shapes}),Object.defineProperty(Y.prototype,"collisionGroup",{get:Y.prototype.get_collisionGroup,set:Y.prototype.set_collisionGroup}),Object.defineProperty(Y.prototype,"collisionMask",{get:Y.prototype.get_collisionMask,set:Y.prototype.set_collisionMask}),Object.defineProperty(Y.prototype,"sensorGroup",{get:Y.prototype.get_sensorGroup,set:Y.prototype.set_sensorGroup}),Object.defineProperty(Y.prototype,"sensorMask",{get:Y.prototype.get_sensorMask,set:Y.prototype.set_sensorMask}),Object.defineProperty(Y.prototype,"fluidGroup",{get:Y.prototype.get_fluidGroup,set:Y.prototype.set_fluidGroup}),Object.defineProperty(Y.prototype,"fluidMask",{get:Y.prototype.get_fluidMask,set:Y.prototype.set_fluidMask}),Y.prototype.__class__=Y;var J=nape.dynamics.InteractionGroup=function(n){null==n&&(n=!1),this.zpp_inner=null,this.zpp_inner=new Ee,this.zpp_inner.outer=this,this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n)};J.__name__=["nape","dynamics","InteractionGroup"],J.prototype.zpp_inner=null,J.prototype.get_group=function(){return null==this.zpp_inner.group?null:this.zpp_inner.group.outer},J.prototype.set_group=function(n){return this.zpp_inner.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner.group?null:this.zpp_inner.group.outer},J.prototype.get_ignore=function(){return this.zpp_inner.ignore},J.prototype.set_ignore=function(n){return this.zpp_inner.ignore!=n&&(this.zpp_inner.invalidate(!0),this.zpp_inner.ignore=n),this.zpp_inner.ignore},J.prototype.get_interactors=function(){return null==this.zpp_inner.wrap_interactors&&(this.zpp_inner.wrap_interactors=Qi.get(this.zpp_inner.interactors,!0)),this.zpp_inner.wrap_interactors},J.prototype.get_groups=function(){return null==this.zpp_inner.wrap_groups&&(this.zpp_inner.wrap_groups=sp.get(this.zpp_inner.groups,!0)),this.zpp_inner.wrap_groups},J.prototype.toString=function(){var n="InteractionGroup";return this.zpp_inner.ignore&&(n="InteractionGroup:ignore"),n},Object.defineProperty(J.prototype,"group",{get:J.prototype.get_group,set:J.prototype.set_group}),Object.defineProperty(J.prototype,"ignore",{get:J.prototype.get_ignore,set:J.prototype.set_ignore}),Object.defineProperty(J.prototype,"interactors",{get:J.prototype.get_interactors}),Object.defineProperty(J.prototype,"groups",{get:J.prototype.get_groups}),J.prototype.__class__=J;var X=nape.dynamics.InteractionGroupIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};X.__name__=["nape","dynamics","InteractionGroupIterator"],X.get=function(n){var e;if(null==X.zpp_pool){sp.internal=!0;var t=new X;sp.internal=!1,e=t}else{var i=X.zpp_pool;X.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},X.prototype.zpp_inner=null,X.prototype.zpp_i=null,X.prototype.zpp_critical=null,X.prototype.zpp_next=null,X.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=X.zpp_pool,X.zpp_pool=this,this.zpp_inner=null,!1)},X.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},X.prototype.__class__=X;var H=nape.dynamics.InteractionGroupList=function(){this.zpp_inner=null,this.zpp_inner=new sp,this.zpp_inner.outer=this};H.__name__=["nape","dynamics","InteractionGroupList"],H.fromArray=function(n){for(var e=new H,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},H.prototype.zpp_inner=null,H.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},H.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},H.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},H.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},H.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},H.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},H.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},H.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},H.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},H.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},H.prototype.empty=function(){return null==this.zpp_inner.inner.head},H.prototype.iterator=function(){return this.zpp_inner.valmod(),X.get(this)},H.prototype.copy=function(n){null==n&&(n=!1);var e=new H;this.zpp_inner.valmod();for(var t=X.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=X.zpp_pool,X.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},H.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=X.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=X.zpp_pool,X.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},H.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=X.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=X.zpp_pool,X.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},H.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=X.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=X.zpp_pool,X.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=X.zpp_pool,X.zpp_pool=e,e.zpp_inner=null;break}}return this},H.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(H.prototype,"length",{get:H.prototype.get_length}),H.prototype.__class__=H;var $=nape.geom.AABB=function(n,e,t,i){var p;null==i&&(i=0),null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),this.zpp_inner=null,null==Te.zpp_pool?p=new Te:(p=Te.zpp_pool,Te.zpp_pool=p.next,p.next=null),p.minx=n,p.miny=e,p.maxx=n+t,p.maxy=e+i,this.zpp_inner=p,this.zpp_inner.outer=this};$.__name__=["nape","geom","AABB"],$.prototype.zpp_inner=null,$.prototype.copy=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e,t=this.zpp_inner,i=t.minx,p=t.miny,l=t.maxx,r=t.maxy;return null==Te.zpp_pool?e=new Te:(e=Te.zpp_pool,Te.zpp_pool=e.next,e.next=null),e.minx=i,e.miny=p,e.maxx=l,e.maxy=r,e.wrapper()},$.prototype.get_min=function(){return this.zpp_inner.getmin()},$.prototype.set_min=function(n){var e=this.zpp_inner.getmin(),t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return this.zpp_inner.getmin()},$.prototype.get_max=function(){return this.zpp_inner.getmax()},$.prototype.set_max=function(n){var e=this.zpp_inner.getmax(),t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return this.zpp_inner.getmax()},$.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.minx},$.prototype.set_x=function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.minx!=n){this.zpp_inner.maxx+=n-this.zpp_inner.minx,this.zpp_inner.minx=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.minx},$.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.miny},$.prototype.set_y=function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.miny!=n){this.zpp_inner.maxy+=n-this.zpp_inner.miny,this.zpp_inner.miny=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.miny},$.prototype.get_width=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner;return e.maxx-e.minx},$.prototype.set_width=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner;if(t.maxx-t.minx!=n){var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.maxx=this.zpp_inner.minx+n;var p=this.zpp_inner;null!=p._invalidate&&p._invalidate(p)}var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner;return r.maxx-r.minx},$.prototype.get_height=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner;return e.maxy-e.miny},$.prototype.set_height=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner;if(t.maxy-t.miny!=n){var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.maxy=this.zpp_inner.miny+n;var p=this.zpp_inner;null!=p._invalidate&&p._invalidate(p)}var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner;return r.maxy-r.miny},$.prototype.toString=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.toString()},Object.defineProperty($.prototype,"min",{get:$.prototype.get_min,set:$.prototype.set_min}),Object.defineProperty($.prototype,"max",{get:$.prototype.get_max,set:$.prototype.set_max}),Object.defineProperty($.prototype,"x",{get:$.prototype.get_x,set:$.prototype.set_x}),Object.defineProperty($.prototype,"y",{get:$.prototype.get_y,set:$.prototype.set_y}),Object.defineProperty($.prototype,"width",{get:$.prototype.get_width,set:$.prototype.set_width}),Object.defineProperty($.prototype,"height",{get:$.prototype.get_height,set:$.prototype.set_height}),$.prototype.__class__=$;var Q=nape.geom.ConvexResult=function(){this.zpp_inner=null};Q.__name__=["nape","geom","ConvexResult"],Q.prototype.zpp_inner=null,Q.prototype.get_normal=function(){return this.zpp_inner.normal},Q.prototype.get_position=function(){return this.zpp_inner.position},Q.prototype.get_toi=function(){return this.zpp_inner.toiDistance},Q.prototype.get_shape=function(){return this.zpp_inner.shape},Q.prototype.dispose=function(){this.zpp_inner.free()},Q.prototype.toString=function(){return"{ shape: "+i.string(this.zpp_inner.shape)+" toi: "+this.zpp_inner.toiDistance+" }"},Object.defineProperty(Q.prototype,"normal",{get:Q.prototype.get_normal}),Object.defineProperty(Q.prototype,"position",{get:Q.prototype.get_position}),Object.defineProperty(Q.prototype,"toi",{get:Q.prototype.get_toi}),Object.defineProperty(Q.prototype,"shape",{get:Q.prototype.get_shape}),Q.prototype.__class__=Q;var nn=nape.geom.ConvexResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};nn.__name__=["nape","geom","ConvexResultIterator"],nn.get=function(n){var e;if(null==nn.zpp_pool){rp.internal=!0;var t=new nn;rp.internal=!1,e=t}else{var i=nn.zpp_pool;nn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},nn.prototype.zpp_inner=null,nn.prototype.zpp_i=null,nn.prototype.zpp_critical=null,nn.prototype.zpp_next=null,nn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=nn.zpp_pool,nn.zpp_pool=this,this.zpp_inner=null,!1)},nn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},nn.prototype.__class__=nn;var en=nape.geom.ConvexResultList=function(){this.zpp_inner=null,this.zpp_inner=new rp,this.zpp_inner.outer=this};en.__name__=["nape","geom","ConvexResultList"],en.fromArray=function(n){for(var e=new en,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},en.prototype.zpp_inner=null,en.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},en.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},en.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},en.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},en.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}else this.zpp_inner.inner.add(n);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},en.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=n=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n},en.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=n=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n},en.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},en.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),e},en.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},en.prototype.empty=function(){return null==this.zpp_inner.inner.head},en.prototype.iterator=function(){return this.zpp_inner.valmod(),nn.get(this)},en.prototype.copy=function(n){null==n&&(n=!1);var e=new en;this.zpp_inner.valmod();for(var t=nn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=nn.zpp_pool,nn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},en.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=nn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=nn.zpp_pool,nn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},en.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=nn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=nn.zpp_pool,nn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},en.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=nn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=nn.zpp_pool,nn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=nn.zpp_pool,nn.zpp_pool=e,e.zpp_inner=null;break}}return this},en.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(en.prototype,"length",{get:en.prototype.get_length}),en.prototype.__class__=en;var tn=nape.geom.Geom=function(){};tn.__name__=["nape","geom","Geom"],tn.distanceBody=function(n,e,t,i){for(var p=n.zpp_inner.shapes.head;null!=p;)Be.validateShape(p.elt),p=p.next;for(var l=e.zpp_inner.shapes.head;null!=l;)Be.validateShape(l.elt),l=l.next;return _t.distanceBody(n.zpp_inner,e.zpp_inner,t.zpp_inner,i.zpp_inner)},tn.distance=function(n,e,t,i){var p;Be.validateShape(n.zpp_inner),Be.validateShape(e.zpp_inner),null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1;var l,r=n.zpp_inner,a=e.zpp_inner,s=t.zpp_inner,_=i.zpp_inner;if(0==r.type&&0==a.type){var h,u=r.circle,x=a.circle,d=0,y=0;d=x.worldCOMx-u.worldCOMx,y=x.worldCOMy-u.worldCOMy;var z=Math.sqrt(d*d+y*y);if((h=z-(u.radius+x.radius))<1e100){if(0==z)d=1,y=0;else{var v=1/z;d*=v,y*=v}var c=u.radius;s.x=u.worldCOMx+d*c,s.y=u.worldCOMy+y*c;var f=-x.radius;_.x=x.worldCOMx+d*f,_.y=x.worldCOMy+y*f,p.x=d,p.y=y}l=h}else{var m=!1;if(0==r.type&&1==a.type){var b=r;r=a,a=b;var g=s;s=_,_=g,m=!0}if(1==r.type&&0==a.type){for(var w=r.polygon,M=a.circle,C=-1e100,k=null,O=w.edges.head;null!=O;){var P=O.elt,S=P.gnormx*M.worldCOMx+P.gnormy*M.worldCOMy-P.gprojection-M.radius;if(S>1e100){C=S;break}S>0?S>C&&(C=S,k=P):C<0&&S>C&&(C=S,k=P),O=O.next}if(C<1e100){var A=k.gp0,j=k.gp1,E=M.worldCOMy*k.gnormx-M.worldCOMx*k.gnormy;if(E<=A.y*k.gnormx-A.x*k.gnormy){var I=0,T=0;I=M.worldCOMx-A.x,T=M.worldCOMy-A.y;var N=Math.sqrt(I*I+T*T);if((C=N-M.radius)<1e100){if(0==N)I=1,T=0;else{var L=1/N;I*=L,T*=L}s.x=A.x+0*I,s.y=A.y+0*T;var V=-M.radius;_.x=M.worldCOMx+I*V,_.y=M.worldCOMy+T*V,p.x=I,p.y=T}}else if(E>=j.y*k.gnormx-j.x*k.gnormy){var D=0,F=0;D=M.worldCOMx-j.x,F=M.worldCOMy-j.y;var R=Math.sqrt(D*D+F*F);if((C=R-M.radius)<1e100){if(0==R)D=1,F=0;else{var Z=1/R;D*=Z,F*=Z}s.x=j.x+0*D,s.y=j.y+0*F;var B=-M.radius;_.x=M.worldCOMx+D*B,_.y=M.worldCOMy+F*B,p.x=D,p.y=F}}else{var G=-M.radius;_.x=M.worldCOMx+k.gnormx*G,_.y=M.worldCOMy+k.gnormy*G;var q=-C;s.x=_.x+k.gnormx*q,s.y=_.y+k.gnormy*q,p.x=k.gnormx,p.y=k.gnormy}}m&&(p.x=-p.x,p.y=-p.y),l=C}else{for(var U=r.polygon,K=a.polygon,W=-1e100,Y=null,J=null,X=0,H=U.edges.head;null!=H;){for(var $=H.elt,Q=1e100,nn=K.gverts.next;null!=nn;){var en=nn,tn=$.gnormx*en.x+$.gnormy*en.y;tn<Q&&(Q=tn),nn=nn.next}if((Q-=$.gprojection)>1e100){W=Q;break}Q>0?Q>W&&(W=Q,Y=$,X=1):W<0&&Q>W&&(W=Q,Y=$,X=1),H=H.next}if(W<1e100){for(var pn=K.edges.head;null!=pn;){for(var ln=pn.elt,rn=1e100,on=U.gverts.next;null!=on;){var an=on,sn=ln.gnormx*an.x+ln.gnormy*an.y;sn<rn&&(rn=sn),on=on.next}if((rn-=ln.gprojection)>1e100){W=rn;break}rn>0?rn>W&&(W=rn,J=ln,X=2):W<0&&rn>W&&(W=rn,J=ln,X=2),pn=pn.next}if(W<1e100){var _n,hn;if(1==X)_n=K,hn=Y;else{_n=U,hn=J;var un=s;s=_,_=un,m=!m}for(var xn=null,dn=1e100,yn=_n.edges.head;null!=yn;){var zn=yn.elt,vn=hn.gnormx*zn.gnormx+hn.gnormy*zn.gnormy;vn<dn&&(dn=vn,xn=zn),yn=yn.next}if(m?(p.x=-hn.gnormx,p.y=-hn.gnormy):(p.x=hn.gnormx,p.y=hn.gnormy),W>=0){var cn,fn,mn,bn,gn=hn.gp0,wn=hn.gp1,Mn=xn.gp0,Cn=xn.gp1,kn=1/((cn=wn.x-gn.x)*cn+(fn=wn.y-gn.y)*fn),On=1/((mn=Cn.x-Mn.x)*mn+(bn=Cn.y-Mn.y)*bn),Pn=-(cn*(gn.x-Mn.x)+fn*(gn.y-Mn.y))*kn,Sn=-(cn*(gn.x-Cn.x)+fn*(gn.y-Cn.y))*kn,An=-(mn*(Mn.x-gn.x)+bn*(Mn.y-gn.y))*On,jn=-(mn*(Mn.x-wn.x)+bn*(Mn.y-wn.y))*On;Pn<0?Pn=0:Pn>1&&(Pn=1),Sn<0?Sn=0:Sn>1&&(Sn=1),An<0?An=0:An>1&&(An=1),jn<0?jn=0:jn>1&&(jn=1);var En,In,Tn=Pn;En=gn.x+cn*Tn,In=gn.y+fn*Tn;var Nn,Ln,Vn=Sn;Nn=gn.x+cn*Vn,Ln=gn.y+fn*Vn;var Dn,Fn,Rn=An;Dn=Mn.x+mn*Rn,Fn=Mn.y+bn*Rn;var Zn,Bn,Gn=jn;Zn=Mn.x+mn*Gn,Bn=Mn.y+bn*Gn;var qn,Un,Kn,Wn,Yn,Jn,Xn,Hn,$n=(qn=En-Mn.x)*qn+(Un=In-Mn.y)*Un,Qn=(Kn=Nn-Cn.x)*Kn+(Wn=Ln-Cn.y)*Wn,ne=(Yn=Dn-gn.x)*Yn+(Jn=Fn-gn.y)*Jn,ee=(Xn=Zn-wn.x)*Xn+(Hn=Bn-wn.y)*Hn,te=0,ie=0,pe=null;$n<Qn?(te=En,ie=In,pe=Mn):(te=Nn,ie=Ln,pe=Cn,$n=Qn);var le=0,re=0,oe=null;if(ne<ee?(le=Dn,re=Fn,oe=gn):(le=Zn,re=Bn,oe=wn,ne=ee),$n<ne?(s.x=te,s.y=ie,_.x=pe.x,_.y=pe.y,W=Math.sqrt($n)):(_.x=le,_.y=re,s.x=oe.x,s.y=oe.y,W=Math.sqrt(ne)),0!=W){p.x=_.x-s.x,p.y=_.y-s.y;var ae=1/W;p.x*=ae,p.y*=ae,m&&(p.x=-p.x,p.y=-p.y)}l=W}else{var se=0,_e=0;se=xn.gp0.x,_e=xn.gp0.y;var he,ue,xe=0,de=0;he=(xe=xn.gp1.x)-se,ue=(de=xn.gp1.y)-_e;var ye=hn.gnormy*se-hn.gnormx*_e,ze=hn.gnormy*xe-hn.gnormx*de,ve=1/(ze-ye),ce=(-hn.tp1-ye)*ve;ce>o.epsilon&&(se+=he*ce,_e+=ue*ce);var fe=(-hn.tp0-ze)*ve;fe<-o.epsilon&&(xe+=he*fe,de+=ue*fe);var me=se*hn.gnormx+_e*hn.gnormy-hn.gprojection,be=xe*hn.gnormx+de*hn.gnormy-hn.gprojection;if(me<be){_.x=se,_.y=_e;var ge=-me;s.x=_.x+hn.gnormx*ge,s.y=_.y+hn.gnormy*ge,l=me}else{_.x=xe,_.y=de;var we=-be;s.x=_.x+hn.gnormx*we,s.y=_.y+hn.gnormy*we,l=be}}}else l=1e100}else l=1e100}}var Me=p;return null!=Me.outer&&(Me.outer.zpp_inner=null,Me.outer=null),Me._isimmutable=null,Me._validate=null,Me._invalidate=null,Me.next=xt.zpp_pool,xt.zpp_pool=Me,l},tn.intersectsBody=function(n,e){for(var t=n.zpp_inner.shapes.head;null!=t;)Be.validateShape(t.elt),t=t.next;for(var i=e.zpp_inner.shapes.head;null!=i;)Be.validateShape(i.elt),i=i.next;var p=n.zpp_inner.aabb,l=e.zpp_inner.aabb;if(l.miny<=p.maxy&&p.miny<=l.maxy&&l.minx<=p.maxx&&p.minx<=l.maxx){for(var r=n.zpp_inner.shapes.head;null!=r;){for(var o=r.elt,a=e.zpp_inner.shapes.head;null!=a;){if(Le.testCollide_safe(o,a.elt))return!0;a=a.next}r=r.next}return!1}return!1},tn.intersects=function(n,e){Be.validateShape(n.zpp_inner),Be.validateShape(e.zpp_inner);var t=n.zpp_inner.aabb,i=e.zpp_inner.aabb;return i.miny<=t.maxy&&t.miny<=i.maxy&&i.minx<=t.maxx&&t.minx<=i.maxx&&Le.testCollide_safe(n.zpp_inner,e.zpp_inner)},tn.contains=function(n,e){return Be.validateShape(n.zpp_inner),Be.validateShape(e.zpp_inner),Le.containTest(n.zpp_inner,e.zpp_inner)},tn.prototype.__class__=tn;var pn=nape.geom.GeomPoly=function(n){if(this.zpp_inner=null,this.zpp_pool=null,this.zpp_inner=new qe(this),null!=n){if(n instanceof Array&&null==n.__enum__)for(var e=n,t=0;t<e.length;){var i=e[t];++t;var p=i,l=p.zpp_inner;null!=l._validate&&l._validate();var o=p.zpp_inner.x,a=p.zpp_inner;null!=a._validate&&a._validate();var s,_=p.zpp_inner.y;null==Ge.zpp_pool?s=new Ge:(s=Ge.zpp_pool,Ge.zpp_pool=s.next,s.next=null),s.forced=!1,s.x=o,s.y=_;var h=s;null==this.zpp_inner.vertices?this.zpp_inner.vertices=h.prev=h.next=h:(h.prev=this.zpp_inner.vertices,h.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=h,this.zpp_inner.vertices.next=h),this.zpp_inner.vertices=h}else if(r.__instanceof(n,vn))for(var u=n.iterator();;){u.zpp_inner.zpp_inner.valmod();var x,d=u.zpp_inner.zpp_gl();if(u.zpp_critical=!0,u.zpp_i<d?x=!0:(u.zpp_next=zn.zpp_pool,zn.zpp_pool=u,u.zpp_inner=null,x=!1),!x)break;u.zpp_critical=!1;var y=u.zpp_inner.at(u.zpp_i++),z=y.zpp_inner;null!=z._validate&&z._validate();var v=y.zpp_inner.x,c=y.zpp_inner;null!=c._validate&&c._validate();var f,m=y.zpp_inner.y;null==Ge.zpp_pool?f=new Ge:(f=Ge.zpp_pool,Ge.zpp_pool=f.next,f.next=null),f.forced=!1,f.x=v,f.y=m;var b=f;null==this.zpp_inner.vertices?this.zpp_inner.vertices=b.prev=b.next=b:(b.prev=this.zpp_inner.vertices,b.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=b,this.zpp_inner.vertices.next=b),this.zpp_inner.vertices=b}else if(r.__instanceof(n,pn)){var g=n.zpp_inner.vertices;if(null!=g)for(var w=g;;){var M,C=w.x,k=w.y;if(null==xp.poolVec2?M=new yn:(M=xp.poolVec2,xp.poolVec2=M.zpp_pool,M.zpp_pool=null),null==M.zpp_inner){var O;null==xt.zpp_pool?O=new xt:(O=xt.zpp_pool,xt.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=C,O.y=k,M.zpp_inner=O,M.zpp_inner.outer=M}else{var P,S=M.zpp_inner;if(null!=S._validate&&S._validate(),M.zpp_inner.x==C){var A=M.zpp_inner;null!=A._validate&&A._validate(),P=M.zpp_inner.y==k}else P=!1;if(!P){M.zpp_inner.x=C,M.zpp_inner.y=k;var j=M.zpp_inner;null!=j._invalidate&&j._invalidate(j)}}M.zpp_inner.weak=!1;var E=M;w=w.next;var I=E.zpp_inner;null!=I._validate&&I._validate();var T=E.zpp_inner.x,N=E.zpp_inner;null!=N._validate&&N._validate();var L,V=E.zpp_inner.y;null==Ge.zpp_pool?L=new Ge:(L=Ge.zpp_pool,Ge.zpp_pool=L.next,L.next=null),L.forced=!1,L.x=T,L.y=V;var D=L;null==this.zpp_inner.vertices?this.zpp_inner.vertices=D.prev=D.next=D:(D.prev=this.zpp_inner.vertices,D.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=D,this.zpp_inner.vertices.next=D),this.zpp_inner.vertices=D;var F=E.zpp_inner;E.zpp_inner.outer=null,E.zpp_inner=null;var R=E;R.zpp_pool=xp.poolVec2,xp.poolVec2=R;var Z=F;if(null!=Z.outer&&(Z.outer.zpp_inner=null,Z.outer=null),Z._isimmutable=null,Z._validate=null,Z._invalidate=null,Z.next=xt.zpp_pool,xt.zpp_pool=Z,w==g)break}}if(this.skipForward(1),n instanceof Array&&null==n.__enum__)for(var B=n,G=0;G<B.length;){var q,U=B[G];if(U.zpp_inner.weak){var K=U.zpp_inner;U.zpp_inner.outer=null,U.zpp_inner=null;var W=U;W.zpp_pool=xp.poolVec2,xp.poolVec2=W;var Y=K;null!=Y.outer&&(Y.outer.zpp_inner=null,Y.outer=null),Y._isimmutable=null,Y._validate=null,Y._invalidate=null,Y.next=xt.zpp_pool,xt.zpp_pool=Y,q=!0}else q=!1;q?B.splice(G,1):++G}else if(r.__instanceof(n,vn)){var J=n;null!=J.zpp_inner._validate&&J.zpp_inner._validate();for(var X=J.zpp_inner.inner,H=null,$=X.head;null!=$;){var Q=$.elt;if(Q.outer.zpp_inner.weak){if($=X.erase(H),Q.outer.zpp_inner.weak){var nn=Q.outer,en=nn.zpp_inner;nn.zpp_inner.outer=null,nn.zpp_inner=null;var tn=nn;tn.zpp_pool=xp.poolVec2,xp.poolVec2=tn;var ln=en;null!=ln.outer&&(ln.outer.zpp_inner=null,ln.outer=null),ln._isimmutable=null,ln._validate=null,ln._invalidate=null,ln.next=xt.zpp_pool,xt.zpp_pool=ln}}else H=$,$=$.next}}}};pn.__name__=["nape","geom","GeomPoly"],pn.get=function(n){var e;if(null==xp.poolGeomPoly?e=new pn:(e=xp.poolGeomPoly,xp.poolGeomPoly=e.zpp_pool,e.zpp_pool=null),null!=n){if(n instanceof Array&&null==n.__enum__)for(var t=n,i=0;i<t.length;){var p=t[i];++i;var l=p,o=l.zpp_inner;null!=o._validate&&o._validate();var a=l.zpp_inner.x,s=l.zpp_inner;null!=s._validate&&s._validate();var _,h=l.zpp_inner.y;null==Ge.zpp_pool?_=new Ge:(_=Ge.zpp_pool,Ge.zpp_pool=_.next,_.next=null),_.forced=!1,_.x=a,_.y=h;var u=_;null==e.zpp_inner.vertices?e.zpp_inner.vertices=u.prev=u.next=u:(u.prev=e.zpp_inner.vertices,u.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=u,e.zpp_inner.vertices.next=u),e.zpp_inner.vertices=u}else if(r.__instanceof(n,vn))for(var x=n.iterator();;){x.zpp_inner.zpp_inner.valmod();var d,y=x.zpp_inner.zpp_gl();if(x.zpp_critical=!0,x.zpp_i<y?d=!0:(x.zpp_next=zn.zpp_pool,zn.zpp_pool=x,x.zpp_inner=null,d=!1),!d)break;x.zpp_critical=!1;var z=x.zpp_inner.at(x.zpp_i++),v=z.zpp_inner;null!=v._validate&&v._validate();var c=z.zpp_inner.x,f=z.zpp_inner;null!=f._validate&&f._validate();var m,b=z.zpp_inner.y;null==Ge.zpp_pool?m=new Ge:(m=Ge.zpp_pool,Ge.zpp_pool=m.next,m.next=null),m.forced=!1,m.x=c,m.y=b;var g=m;null==e.zpp_inner.vertices?e.zpp_inner.vertices=g.prev=g.next=g:(g.prev=e.zpp_inner.vertices,g.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=g,e.zpp_inner.vertices.next=g),e.zpp_inner.vertices=g}else if(r.__instanceof(n,pn)){var w=n.zpp_inner.vertices;if(null!=w)for(var M=w;;){var C,k=M.x,O=M.y;if(null==xp.poolVec2?C=new yn:(C=xp.poolVec2,xp.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner){var P;null==xt.zpp_pool?P=new xt:(P=xt.zpp_pool,xt.zpp_pool=P.next,P.next=null),P.weak=!1,P._immutable=!1,P.x=k,P.y=O,C.zpp_inner=P,C.zpp_inner.outer=C}else{var S,A=C.zpp_inner;if(null!=A._validate&&A._validate(),C.zpp_inner.x==k){var j=C.zpp_inner;null!=j._validate&&j._validate(),S=C.zpp_inner.y==O}else S=!1;if(!S){C.zpp_inner.x=k,C.zpp_inner.y=O;var E=C.zpp_inner;null!=E._invalidate&&E._invalidate(E)}}C.zpp_inner.weak=!1;var I=C;M=M.next;var T=I.zpp_inner;null!=T._validate&&T._validate();var N=I.zpp_inner.x,L=I.zpp_inner;null!=L._validate&&L._validate();var V,D=I.zpp_inner.y;null==Ge.zpp_pool?V=new Ge:(V=Ge.zpp_pool,Ge.zpp_pool=V.next,V.next=null),V.forced=!1,V.x=N,V.y=D;var F=V;null==e.zpp_inner.vertices?e.zpp_inner.vertices=F.prev=F.next=F:(F.prev=e.zpp_inner.vertices,F.next=e.zpp_inner.vertices.next,e.zpp_inner.vertices.next.prev=F,e.zpp_inner.vertices.next=F),e.zpp_inner.vertices=F;var R=I.zpp_inner;I.zpp_inner.outer=null,I.zpp_inner=null;var Z=I;Z.zpp_pool=xp.poolVec2,xp.poolVec2=Z;var B=R;if(null!=B.outer&&(B.outer.zpp_inner=null,B.outer=null),B._isimmutable=null,B._validate=null,B._invalidate=null,B.next=xt.zpp_pool,xt.zpp_pool=B,M==w)break}}if(e.skipForward(1),n instanceof Array&&null==n.__enum__)for(var G=n,q=0;q<G.length;){var U,K=G[q];if(K.zpp_inner.weak){var W=K.zpp_inner;K.zpp_inner.outer=null,K.zpp_inner=null;var Y=K;Y.zpp_pool=xp.poolVec2,xp.poolVec2=Y;var J=W;null!=J.outer&&(J.outer.zpp_inner=null,J.outer=null),J._isimmutable=null,J._validate=null,J._invalidate=null,J.next=xt.zpp_pool,xt.zpp_pool=J,U=!0}else U=!1;U?G.splice(q,1):++q}else if(r.__instanceof(n,vn)){var X=n;null!=X.zpp_inner._validate&&X.zpp_inner._validate();for(var H=X.zpp_inner.inner,$=null,Q=H.head;null!=Q;){var nn=Q.elt;if(nn.outer.zpp_inner.weak){if(Q=H.erase($),nn.outer.zpp_inner.weak){var en=nn.outer,tn=en.zpp_inner;en.zpp_inner.outer=null,en.zpp_inner=null;var ln=en;ln.zpp_pool=xp.poolVec2,xp.poolVec2=ln;var rn=tn;null!=rn.outer&&(rn.outer.zpp_inner=null,rn.outer=null),rn._isimmutable=null,rn._validate=null,rn._invalidate=null,rn.next=xt.zpp_pool,xt.zpp_pool=rn}}else $=Q,Q=Q.next}}}return e},pn.prototype.zpp_pool=null,pn.prototype.zpp_inner=null,pn.prototype.empty=function(){return null==this.zpp_inner.vertices},pn.prototype.size=function(){var n=0,e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;++n,(i=i.next)!=t;);return n},pn.prototype.iterator=function(){return Ue.get(this.zpp_inner.vertices,!0)},pn.prototype.forwardIterator=function(){return Ue.get(this.zpp_inner.vertices,!0)},pn.prototype.backwardsIterator=function(){return Ue.get(this.zpp_inner.vertices,!1)},pn.prototype.current=function(){var n=this.zpp_inner.vertices;if(null==n.wrap){var t,i=n.x,p=n.y;if(null==xp.poolVec2?t=new yn:(t=xp.poolVec2,xp.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner){var l;null==xt.zpp_pool?l=new xt:(l=xt.zpp_pool,xt.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=i,l.y=p,t.zpp_inner=l,t.zpp_inner.outer=t}else{var r,o=t.zpp_inner;if(null!=o._validate&&o._validate(),t.zpp_inner.x==i){var a=t.zpp_inner;null!=a._validate&&a._validate(),r=t.zpp_inner.y==p}else r=!1;if(!r){t.zpp_inner.x=i,t.zpp_inner.y=p;var s=t.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}t.zpp_inner.weak=!1,n.wrap=t,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=e(n,n.modwrap),n.wrap.zpp_inner._validate=e(n,n.getwrap)}return n.wrap},pn.prototype.push=function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p,l=n.zpp_inner.y;null==Ge.zpp_pool?p=new Ge:(p=Ge.zpp_pool,Ge.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=t,p.y=l;var r=p;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=r.prev=r.next=r:(r.prev=this.zpp_inner.vertices,r.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=r,this.zpp_inner.vertices.next=r),this.zpp_inner.vertices=r,n.zpp_inner.weak){var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=xt.zpp_pool,xt.zpp_pool=o}return this},pn.prototype.pop=function(){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=null;else{var t=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=t}if(this.zpp_inner.vertices=n,null!=e.wrap){e.wrap.zpp_inner._inuse=!1;var i=e.wrap,p=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,e.wrap=null}return e.prev=e.next=null,e.next=Ge.zpp_pool,Ge.zpp_pool=e,this},pn.prototype.unshift=function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p,l=n.zpp_inner.y;null==Ge.zpp_pool?p=new Ge:(p=Ge.zpp_pool,Ge.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=t,p.y=l;var r=p;if(null==this.zpp_inner.vertices?this.zpp_inner.vertices=r.prev=r.next=r:(r.next=this.zpp_inner.vertices,r.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.prev.next=r,this.zpp_inner.vertices.prev=r),this.zpp_inner.vertices=r,n.zpp_inner.weak){var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=xt.zpp_pool,xt.zpp_pool=o}return this},pn.prototype.shift=function(){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=this.zpp_inner.vertices=null;else{var t=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=t}if(this.zpp_inner.vertices=n,null!=e.wrap){e.wrap.zpp_inner._inuse=!1;var i=e.wrap,p=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,e.wrap=null}return e.prev=e.next=null,e.next=Ge.zpp_pool,Ge.zpp_pool=e,this},pn.prototype.skipForward=function(n){if(null!=this.zpp_inner.vertices)if(n>0)for(;n-- >0;)this.zpp_inner.vertices=this.zpp_inner.vertices.next;else if(n<0)for(;n++<0;)this.zpp_inner.vertices=this.zpp_inner.vertices.prev;return this},pn.prototype.skipBackwards=function(n){return this.skipForward(-n)},pn.prototype.erase=function(n){for(;0!=n&&null!=this.zpp_inner.vertices;){var e=this.zpp_inner.vertices;if(n>0){var t;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,t=this.zpp_inner.vertices=null;else{var i=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,t=i}this.zpp_inner.vertices=t,--n}else if(n<0){var p;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,p=null;else{var l=this.zpp_inner.vertices.prev;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,p=l}this.zpp_inner.vertices=p,++n}if(null!=e.wrap){e.wrap.zpp_inner._inuse=!1;var r=e.wrap,o=r.zpp_inner;r.zpp_inner.outer=null,r.zpp_inner=null,r.zpp_pool=xp.poolVec2,xp.poolVec2=r,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=xt.zpp_pool,xt.zpp_pool=o,e.wrap=null}e.prev=e.next=null,e.next=Ge.zpp_pool,Ge.zpp_pool=e}return this},pn.prototype.clear=function(){for(;null!=this.zpp_inner.vertices;){var n,e=this.zpp_inner.vertices;if(null!=this.zpp_inner.vertices&&this.zpp_inner.vertices.prev==this.zpp_inner.vertices)this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,n=this.zpp_inner.vertices=null;else{var t=this.zpp_inner.vertices.next;this.zpp_inner.vertices.prev.next=this.zpp_inner.vertices.next,this.zpp_inner.vertices.next.prev=this.zpp_inner.vertices.prev,this.zpp_inner.vertices.next=this.zpp_inner.vertices.prev=null,this.zpp_inner.vertices=null,n=t}if(this.zpp_inner.vertices=n,null!=e.wrap){e.wrap.zpp_inner._inuse=!1;var i=e.wrap,p=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,e.wrap=null}e.prev=e.next=null,e.next=Ge.zpp_pool,Ge.zpp_pool=e}return this},pn.prototype.copy=function(){var n=pn.get(),e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var p,l=i,r=l.x,o=l.y;null==Ge.zpp_pool?p=new Ge:(p=Ge.zpp_pool,Ge.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=r,p.y=o;var a=p;if(null==n.zpp_inner.vertices?n.zpp_inner.vertices=a.prev=a.next=a:(a.prev=n.zpp_inner.vertices,a.next=n.zpp_inner.vertices.next,n.zpp_inner.vertices.next.prev=a,n.zpp_inner.vertices.next=a),n.zpp_inner.vertices=a,(i=i.next)==t)break}return n.skipForward(1)},pn.prototype.dispose=function(){this.clear();this.zpp_pool=xp.poolGeomPoly,xp.poolGeomPoly=this},pn.prototype.toString=function(){var n="GeomPoly[",e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var p=i;if(p!=this.zpp_inner.vertices&&(n+=","),n+="{"+p.x+","+p.y+"}",(i=i.next)==t)break}return n+"]"},pn.prototype.area=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return 0;var n=0,e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var p=i;if(n+=p.x*(p.next.y-p.prev.y),(i=i.next)==t)break}var l=.5*n;return l<0?-l:l},pn.prototype.winding=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return null==oe.Winding_UNDEFINED&&(oe.internal=!0,oe.Winding_UNDEFINED=new fn,oe.internal=!1),oe.Winding_UNDEFINED;var n=0,e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var p=i;if(n+=p.x*(p.next.y-p.prev.y),(i=i.next)==t)break}var l=.5*n;return l>0?(null==oe.Winding_CLOCKWISE&&(oe.internal=!0,oe.Winding_CLOCKWISE=new fn,oe.internal=!1),oe.Winding_CLOCKWISE):0==l?(null==oe.Winding_UNDEFINED&&(oe.internal=!0,oe.Winding_UNDEFINED=new fn,oe.internal=!1),oe.Winding_UNDEFINED):(null==oe.Winding_ANTICLOCKWISE&&(oe.internal=!0,oe.Winding_ANTICLOCKWISE=new fn,oe.internal=!1),oe.Winding_ANTICLOCKWISE)},pn.prototype.contains=function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.y,l=!1,r=this.zpp_inner.vertices,o=this.zpp_inner.vertices;if(null!=r)for(var a=r;;){var s=a,_=s.prev;if((s.y<p&&_.y>=p||_.y<p&&s.y>=p)&&(s.x<=t||_.x<=t)&&s.x+(p-s.y)/(_.y-s.y)*(_.x-s.x)<t&&(l=!l),(a=a.next)==o)break}var h=l;if(n.zpp_inner.weak){var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u}return h},pn.prototype.isClockwise=function(){var n=this.winding();return null==oe.Winding_CLOCKWISE&&(oe.internal=!0,oe.Winding_CLOCKWISE=new fn,oe.internal=!1),n==oe.Winding_CLOCKWISE},pn.prototype.isConvex=function(){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return!0;var n=!1,e=!1,t=!0,i=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=i)for(var l=i;;){var r,o,a=l,s=a.prev,_=a.next;r=_.x-a.x,o=_.y-a.y;var h;h=a.x-s.x;var u=(a.y-s.y)*r-h*o;if(u>0?e=!0:u<0&&(n=!0),e&&n){t=!1;break}if((l=l.next)==p)break}return t},pn.prototype.isSimple=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||lt.isSimple(this.zpp_inner.vertices)},pn.prototype.isMonotone=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||He.isMonotone(this.zpp_inner.vertices)},pn.prototype.isDegenerate=function(){return null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next||this.area()<o.epsilon},pn.prototype.simplify=function(n){if(null==this.zpp_inner.vertices||null==this.zpp_inner.vertices.next||this.zpp_inner.vertices.prev==this.zpp_inner.vertices.next)return this.copy();var e=at.simplify(this.zpp_inner.vertices,n),t=pn.get();return t.zpp_inner.vertices=e,t},pn.prototype.simpleDecomposition=function(n){null==Qe.sharedGVList&&(Qe.sharedGVList=new Qt);for(var e=lt.decompose(this.zpp_inner.vertices,Qe.sharedGVList),t=null==n?new rn:n;null!=e.head;){var i=e.pop_unsafe(),p=pn.get();p.zpp_inner.vertices=i,t.zpp_inner.reverse_flag?t.push(p):t.unshift(p)}return t},pn.prototype.monotoneDecomposition=function(n){null==He.sharedPPoly&&(He.sharedPPoly=new Qe);var e=He.decompose(this.zpp_inner.vertices,He.sharedPPoly);null==Qe.sharedGVList&&(Qe.sharedGVList=new Qt);for(var t=e.extract(Qe.sharedGVList),i=null==n?new rn:n;null!=t.head;){var p=t.pop_unsafe(),l=pn.get();l.zpp_inner.vertices=p,i.zpp_inner.reverse_flag?i.push(l):i.unshift(l)}return i},pn.prototype.convexDecomposition=function(n,e){null==n&&(n=!1),null==He.sharedPPoly&&(He.sharedPPoly=new Qe);var t=He.decompose(this.zpp_inner.vertices,He.sharedPPoly);null==Qe.sharedPPList&&(Qe.sharedPPList=new $t);for(var i=t.extract_partitions(Qe.sharedPPList),p=null==e?new rn:e;null!=i.head;){var l=i.pop_unsafe();ut.triangulate(l),n&&ut.optimise(l),Ve.optimise(l),null==Qe.sharedGVList&&(Qe.sharedGVList=new Qt);var r=l.extract(Qe.sharedGVList);for(l.next=Qe.zpp_pool,Qe.zpp_pool=l;null!=r.head;){var o=r.pop_unsafe(),a=pn.get();a.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(a):p.unshift(a)}}return p},pn.prototype.triangularDecomposition=function(n,e){null==n&&(n=!1),null==He.sharedPPoly&&(He.sharedPPoly=new Qe);var t=He.decompose(this.zpp_inner.vertices,He.sharedPPoly);null==Qe.sharedPPList&&(Qe.sharedPPList=new $t);for(var i=t.extract_partitions(Qe.sharedPPList),p=null==e?new rn:e;null!=i.head;){var l=i.pop_unsafe();ut.triangulate(l),n&&ut.optimise(l),null==Qe.sharedGVList&&(Qe.sharedGVList=new Qt);var r=l.extract(Qe.sharedGVList);for(l.next=Qe.zpp_pool,Qe.zpp_pool=l;null!=r.head;){var o=r.pop_unsafe(),a=pn.get();a.zpp_inner.vertices=o,p.zpp_inner.reverse_flag?p.push(a):p.unshift(a)}}return p},pn.prototype.inflate=function(n){var e=pn.get(),t=this.winding();null==oe.Winding_CLOCKWISE&&(oe.internal=!0,oe.Winding_CLOCKWISE=new fn,oe.internal=!1),t==oe.Winding_CLOCKWISE&&(n=-n);var i=this.zpp_inner.vertices,p=this.zpp_inner.vertices;if(null!=i)for(var l=i;;){var r,o,a,s,_=l,h=_.prev,u=_.next;r=_.x-h.x,o=_.y-h.y,a=u.x-_.x,s=u.y-_.y;var x=0,d=0,y=0,z=0;x=r,d=o;var v=1/Math.sqrt(x*x+d*d),c=x*=v;x=-(d*=v),d=c;x*=n,d*=n,y=a,z=s;var f=1/Math.sqrt(y*y+z*z),m=y*=f;y=-(z*=f),z=m;var b=s*((y*=n)-x)-a*((z*=n)-d),g=0==b?0:b/(s*r-a*o),w=0,M=0;w=_.x+x,M=_.y+d;var C;if(w+=r*g,M+=o*g,null==xp.poolVec2?C=new yn:(C=xp.poolVec2,xp.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner){var k;null==xt.zpp_pool?k=new xt:(k=xt.zpp_pool,xt.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=w,k.y=M,C.zpp_inner=k,C.zpp_inner.outer=C}else{var O,P=C.zpp_inner;if(null!=P._validate&&P._validate(),C.zpp_inner.x==w){var S=C.zpp_inner;null!=S._validate&&S._validate(),O=C.zpp_inner.y==M}else O=!1;if(!O){C.zpp_inner.x=w,C.zpp_inner.y=M;var A=C.zpp_inner;null!=A._invalidate&&A._invalidate(A)}}if(C.zpp_inner.weak=!1,e.push(C),(l=l.next)==p)break}return e.skipForward(1)},pn.prototype.cut=function(n,e,t,i,p){null==i&&(i=!1),null==t&&(t=!1);var l=Ze.run(this.zpp_inner.vertices,n,e,t,i,p);if(n.zpp_inner.weak){var r=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r}if(e.zpp_inner.weak){var o=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=xt.zpp_pool,xt.zpp_pool=o}return l},pn.prototype.transform=function(n){var e=this.zpp_inner.vertices,t=this.zpp_inner.vertices;if(null!=e)for(var i=e;;){var p=i,l=n.zpp_inner.a*p.x+n.zpp_inner.b*p.y+n.zpp_inner.tx;if(p.y=n.zpp_inner.c*p.x+n.zpp_inner.d*p.y+n.zpp_inner.ty,p.x=l,(i=i.next)==t)break}return this},pn.prototype.bounds=function(){var n=1e100,e=1e100,t=-1e100,i=-1e100,p=this.zpp_inner.vertices,l=this.zpp_inner.vertices;if(null!=p)for(var r=p;;){var o=r;if(o.x<n&&(n=o.x),o.y<e&&(e=o.y),o.x>t&&(t=o.x),o.y>i&&(i=o.y),(r=r.next)==l)break}return new $(n,e,t-n,i-e)},pn.prototype.top=function(){var n=this.zpp_inner.vertices,t=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=t)for(var p=t;;){var l=p;if(l.y<n.y&&(n=l),(p=p.next)==i)break}if(null==n.wrap){var r,o=n.x,a=n.y;if(null==xp.poolVec2?r=new yn:(r=xp.poolVec2,xp.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner){var s;null==xt.zpp_pool?s=new xt:(s=xt.zpp_pool,xt.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=o,s.y=a,r.zpp_inner=s,r.zpp_inner.outer=r}else{var _,h=r.zpp_inner;if(null!=h._validate&&h._validate(),r.zpp_inner.x==o){var u=r.zpp_inner;null!=u._validate&&u._validate(),_=r.zpp_inner.y==a}else _=!1;if(!_){r.zpp_inner.x=o,r.zpp_inner.y=a;var x=r.zpp_inner;null!=x._invalidate&&x._invalidate(x)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=e(n,n.modwrap),n.wrap.zpp_inner._validate=e(n,n.getwrap)}return n.wrap},pn.prototype.bottom=function(){var n=this.zpp_inner.vertices,t=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=t)for(var p=t;;){var l=p;if(l.y>n.y&&(n=l),(p=p.next)==i)break}if(null==n.wrap){var r,o=n.x,a=n.y;if(null==xp.poolVec2?r=new yn:(r=xp.poolVec2,xp.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner){var s;null==xt.zpp_pool?s=new xt:(s=xt.zpp_pool,xt.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=o,s.y=a,r.zpp_inner=s,r.zpp_inner.outer=r}else{var _,h=r.zpp_inner;if(null!=h._validate&&h._validate(),r.zpp_inner.x==o){var u=r.zpp_inner;null!=u._validate&&u._validate(),_=r.zpp_inner.y==a}else _=!1;if(!_){r.zpp_inner.x=o,r.zpp_inner.y=a;var x=r.zpp_inner;null!=x._invalidate&&x._invalidate(x)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=e(n,n.modwrap),n.wrap.zpp_inner._validate=e(n,n.getwrap)}return n.wrap},pn.prototype.left=function(){var n=this.zpp_inner.vertices,t=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=t)for(var p=t;;){var l=p;if(l.x<n.x&&(n=l),(p=p.next)==i)break}if(null==n.wrap){var r,o=n.x,a=n.y;if(null==xp.poolVec2?r=new yn:(r=xp.poolVec2,xp.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner){var s;null==xt.zpp_pool?s=new xt:(s=xt.zpp_pool,xt.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=o,s.y=a,r.zpp_inner=s,r.zpp_inner.outer=r}else{var _,h=r.zpp_inner;if(null!=h._validate&&h._validate(),r.zpp_inner.x==o){var u=r.zpp_inner;null!=u._validate&&u._validate(),_=r.zpp_inner.y==a}else _=!1;if(!_){r.zpp_inner.x=o,r.zpp_inner.y=a;var x=r.zpp_inner;null!=x._invalidate&&x._invalidate(x)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=e(n,n.modwrap),n.wrap.zpp_inner._validate=e(n,n.getwrap)}return n.wrap},pn.prototype.right=function(){var n=this.zpp_inner.vertices,t=this.zpp_inner.vertices.next,i=this.zpp_inner.vertices;if(null!=t)for(var p=t;;){var l=p;if(l.x>n.x&&(n=l),(p=p.next)==i)break}if(null==n.wrap){var r,o=n.x,a=n.y;if(null==xp.poolVec2?r=new yn:(r=xp.poolVec2,xp.poolVec2=r.zpp_pool,r.zpp_pool=null),null==r.zpp_inner){var s;null==xt.zpp_pool?s=new xt:(s=xt.zpp_pool,xt.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=o,s.y=a,r.zpp_inner=s,r.zpp_inner.outer=r}else{var _,h=r.zpp_inner;if(null!=h._validate&&h._validate(),r.zpp_inner.x==o){var u=r.zpp_inner;null!=u._validate&&u._validate(),_=r.zpp_inner.y==a}else _=!1;if(!_){r.zpp_inner.x=o,r.zpp_inner.y=a;var x=r.zpp_inner;null!=x._invalidate&&x._invalidate(x)}}r.zpp_inner.weak=!1,n.wrap=r,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=e(n,n.modwrap),n.wrap.zpp_inner._validate=e(n,n.getwrap)}return n.wrap},pn.prototype.__class__=pn;var ln=nape.geom.GeomPolyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};ln.__name__=["nape","geom","GeomPolyIterator"],ln.get=function(n){var e;if(null==ln.zpp_pool){pp.internal=!0;var t=new ln;pp.internal=!1,e=t}else{var i=ln.zpp_pool;ln.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},ln.prototype.zpp_inner=null,ln.prototype.zpp_i=null,ln.prototype.zpp_critical=null,ln.prototype.zpp_next=null,ln.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=ln.zpp_pool,ln.zpp_pool=this,this.zpp_inner=null,!1)},ln.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},ln.prototype.__class__=ln;var rn=nape.geom.GeomPolyList=function(){this.zpp_inner=null,this.zpp_inner=new pp,this.zpp_inner.outer=this};rn.__name__=["nape","geom","GeomPolyList"],rn.fromArray=function(n){for(var e=new rn,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},rn.prototype.zpp_inner=null,rn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},rn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},rn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},rn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},rn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},rn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},rn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},rn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},rn.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},rn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},rn.prototype.empty=function(){return null==this.zpp_inner.inner.head},rn.prototype.iterator=function(){return this.zpp_inner.valmod(),ln.get(this)},rn.prototype.copy=function(n){null==n&&(n=!1);var e=new rn;this.zpp_inner.valmod();for(var t=ln.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=ln.zpp_pool,ln.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},rn.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=ln.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},rn.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=ln.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=ln.zpp_pool,ln.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},rn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=ln.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=ln.zpp_pool,ln.zpp_pool=e,e.zpp_inner=null;break}}return this},rn.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(rn.prototype,"length",{get:rn.prototype.get_length}),rn.prototype.__class__=rn;var on=nape.geom.GeomVertexIterator=function(){};on.__name__=["nape","geom","GeomVertexIterator"],on.prototype.zpp_inner=null,on.prototype.hasNext=function(){var n=this.zpp_inner.ptr!=this.zpp_inner.start||this.zpp_inner.first;if(this.zpp_inner.first=!1,!n){var e=this.zpp_inner;e.outer.zpp_inner=null,e.ptr=e.start=null,e.next=Ue.zpp_pool,Ue.zpp_pool=e}return n},on.prototype.next=function(){var n=this.zpp_inner.ptr;if(null==n.wrap){var t,i=n.x,p=n.y;if(null==xp.poolVec2?t=new yn:(t=xp.poolVec2,xp.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner){var l;null==xt.zpp_pool?l=new xt:(l=xt.zpp_pool,xt.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=i,l.y=p,t.zpp_inner=l,t.zpp_inner.outer=t}else{var r,o=t.zpp_inner;if(null!=o._validate&&o._validate(),t.zpp_inner.x==i){var a=t.zpp_inner;null!=a._validate&&a._validate(),r=t.zpp_inner.y==p}else r=!1;if(!r){t.zpp_inner.x=i,t.zpp_inner.y=p;var s=t.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}t.zpp_inner.weak=!1,n.wrap=t,n.wrap.zpp_inner._inuse=!0,n.wrap.zpp_inner._invalidate=e(n,n.modwrap),n.wrap.zpp_inner._validate=e(n,n.getwrap)}var _=n.wrap;return this.zpp_inner.ptr=this.zpp_inner.forward?this.zpp_inner.ptr.next:this.zpp_inner.ptr.prev,_},on.prototype.__class__=on;var an=nape.geom.MarchingSquares=function(){};an.__name__=["nape","geom","MarchingSquares"],an.run=function(n,e,t,i,p,l,r){null==l&&(l=!0),null==i&&(i=2);var o=null!=r?r:new rn;if(null==p){var a=e.zpp_inner;null!=a._validate&&a._validate();var s=e.zpp_inner.minx,_=e.zpp_inner;null!=_._validate&&_._validate();var h=e.zpp_inner.miny,u=e.zpp_inner.getmax(),x=u.zpp_inner;null!=x._validate&&x._validate();var d=u.zpp_inner.x,y=e.zpp_inner.getmax(),z=y.zpp_inner;null!=z._validate&&z._validate(),Ye.run(n,s,h,d,y.zpp_inner.y,t,i,l,o)}else{var v=e.zpp_inner;null!=v._validate&&v._validate();var c=e.zpp_inner,f=c.maxx-c.minx,m=p.zpp_inner;null!=m._validate&&m._validate();var b=f/p.zpp_inner.x,g=e.zpp_inner;null!=g._validate&&g._validate();var w=e.zpp_inner,M=w.maxy-w.miny,C=p.zpp_inner;null!=C._validate&&C._validate();var k=M/p.zpp_inner.y,O=0|b,P=0|k;O!=b&&++O,P!=k&&++P;for(var S=0,A=O;S<A;){var j=S++,E=e.zpp_inner;null!=E._validate&&E._validate();var I=e.zpp_inner.minx,T=p.zpp_inner;null!=T._validate&&T._validate();var N,L=I+p.zpp_inner.x*j;if(j==O-1){var V=e.zpp_inner.getmax(),D=V.zpp_inner;null!=D._validate&&D._validate(),N=V.zpp_inner.x}else{var F=p.zpp_inner;null!=F._validate&&F._validate(),N=L+p.zpp_inner.x}for(var R=0,Z=P;R<Z;){var B=R++,G=e.zpp_inner;null!=G._validate&&G._validate();var q=e.zpp_inner.miny,U=p.zpp_inner;null!=U._validate&&U._validate();var K,W=q+p.zpp_inner.y*B;if(B==P-1){var Y=e.zpp_inner.getmax(),J=Y.zpp_inner;null!=J._validate&&J._validate(),K=Y.zpp_inner.y}else{var X=p.zpp_inner;null!=X._validate&&X._validate(),K=W+p.zpp_inner.y}Ye.run(n,L,W,N,K,t,i,l,o)}}}if(t.zpp_inner.weak){var H=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=xp.poolVec2,xp.poolVec2=t,null!=H.outer&&(H.outer.zpp_inner=null,H.outer=null),H._isimmutable=null,H._validate=null,H._invalidate=null,H.next=xt.zpp_pool,xt.zpp_pool=H}if(null!=p&&p.zpp_inner.weak){var $=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=xp.poolVec2,xp.poolVec2=p,null!=$.outer&&($.outer.zpp_inner=null,$.outer=null),$._isimmutable=null,$._validate=null,$._invalidate=null,$.next=xt.zpp_pool,xt.zpp_pool=$}return o},an.prototype.__class__=an;var sn=nape.geom.Mat23=function(n,e,t,i,p,l){null==l&&(l=0),null==p&&(p=0),null==i&&(i=1),null==t&&(t=0),null==e&&(e=0),null==n&&(n=1),this.zpp_inner=null,this.zpp_inner=Je.get(),this.zpp_inner.outer=this,this.zpp_inner.a=n;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate(),this.zpp_inner.b=e;var o=this.zpp_inner;null!=o._invalidate&&o._invalidate(),this.zpp_inner.tx=p;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(),this.zpp_inner.c=t;var s=this.zpp_inner;null!=s._invalidate&&s._invalidate(),this.zpp_inner.d=i;var _=this.zpp_inner;null!=_._invalidate&&_._invalidate(),this.zpp_inner.ty=l;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate()};sn.__name__=["nape","geom","Mat23"],sn.rotation=function(n){var e=Math.cos(n),t=Math.sin(n);return new sn(e,-t,t,e,0,0)},sn.translation=function(n,e){return new sn(1,0,0,1,n,e)},sn.scale=function(n,e){return new sn(n,0,0,e,0,0)},sn.prototype.zpp_inner=null,sn.prototype.get_a=function(){return this.zpp_inner.a},sn.prototype.set_a=function(n){this.zpp_inner.a=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.a},sn.prototype.get_b=function(){return this.zpp_inner.b},sn.prototype.set_b=function(n){this.zpp_inner.b=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.b},sn.prototype.get_c=function(){return this.zpp_inner.c},sn.prototype.set_c=function(n){this.zpp_inner.c=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.c},sn.prototype.get_d=function(){return this.zpp_inner.d},sn.prototype.set_d=function(n){this.zpp_inner.d=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.d},sn.prototype.get_tx=function(){return this.zpp_inner.tx},sn.prototype.set_tx=function(n){this.zpp_inner.tx=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.tx},sn.prototype.get_ty=function(){return this.zpp_inner.ty},sn.prototype.set_ty=function(n){this.zpp_inner.ty=n;var e=this.zpp_inner;return null!=e._invalidate&&e._invalidate(),this.zpp_inner.ty},sn.prototype.copy=function(){return new sn(this.zpp_inner.a,this.zpp_inner.b,this.zpp_inner.c,this.zpp_inner.d,this.zpp_inner.tx,this.zpp_inner.ty)},sn.prototype.set=function(n){var e=n.zpp_inner;this.zpp_inner.setas(e.a,e.b,e.c,e.d,e.tx,e.ty);var t=this.zpp_inner;return null!=t._invalidate&&t._invalidate(),this},sn.prototype.setAs=function(n,e,t,i,p,l){null==l&&(l=0),null==p&&(p=0),null==i&&(i=1),null==t&&(t=0),null==e&&(e=0),null==n&&(n=1),this.zpp_inner.setas(n,e,t,i,p,l);var r=this.zpp_inner;return null!=r._invalidate&&r._invalidate(),this},sn.prototype.reset=function(){return this.setAs()},sn.prototype.get_determinant=function(){return this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c},sn.prototype.singular=function(){var n=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d,e=this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c;return e<0&&(e=-e),n>o.illConditionedThreshold*e},sn.prototype.inverse=function(){var n=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);return new sn(this.zpp_inner.d*n,-this.zpp_inner.b*n,-this.zpp_inner.c*n,this.zpp_inner.a*n,(this.zpp_inner.b*this.zpp_inner.ty-this.zpp_inner.d*this.zpp_inner.tx)*n,(this.zpp_inner.c*this.zpp_inner.tx-this.zpp_inner.a*this.zpp_inner.ty)*n)},sn.prototype.transpose=function(){return new sn(this.zpp_inner.a,this.zpp_inner.c,this.zpp_inner.b,this.zpp_inner.d,-this.zpp_inner.a*this.zpp_inner.tx-this.zpp_inner.c*this.zpp_inner.ty,-this.zpp_inner.b*this.zpp_inner.tx-this.zpp_inner.d*this.zpp_inner.ty)},sn.prototype.concat=function(n){return new sn(n.zpp_inner.a*this.zpp_inner.a+n.zpp_inner.b*this.zpp_inner.c,n.zpp_inner.a*this.zpp_inner.b+n.zpp_inner.b*this.zpp_inner.d,n.zpp_inner.c*this.zpp_inner.a+n.zpp_inner.d*this.zpp_inner.c,n.zpp_inner.c*this.zpp_inner.b+n.zpp_inner.d*this.zpp_inner.d,n.zpp_inner.a*this.zpp_inner.tx+n.zpp_inner.b*this.zpp_inner.ty+n.zpp_inner.tx,n.zpp_inner.c*this.zpp_inner.tx+n.zpp_inner.d*this.zpp_inner.ty+n.zpp_inner.ty)},sn.prototype.transform=function(n,e,t){var i;if(null==t&&(t=!1),null==e&&(e=!1),e){var p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.x*this.zpp_inner.a,r=n.zpp_inner;null!=r._validate&&r._validate();var o=l+n.zpp_inner.y*this.zpp_inner.b,a=n.zpp_inner;null!=a._validate&&a._validate();var s=n.zpp_inner.x*this.zpp_inner.c,_=n.zpp_inner;null!=_._validate&&_._validate();var h,u=s+n.zpp_inner.y*this.zpp_inner.d;if(null==xp.poolVec2?h=new yn:(h=xp.poolVec2,xp.poolVec2=h.zpp_pool,h.zpp_pool=null),null==h.zpp_inner){var x;null==xt.zpp_pool?x=new xt:(x=xt.zpp_pool,xt.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=o,x.y=u,h.zpp_inner=x,h.zpp_inner.outer=h}else{var d,y=h.zpp_inner;if(null!=y._validate&&y._validate(),h.zpp_inner.x==o){var z=h.zpp_inner;null!=z._validate&&z._validate(),d=h.zpp_inner.y==u}else d=!1;if(!d){h.zpp_inner.x=o,h.zpp_inner.y=u;var v=h.zpp_inner;null!=v._invalidate&&v._invalidate(v)}}h.zpp_inner.weak=t,i=h}else{var c=n.zpp_inner;null!=c._validate&&c._validate();var f=n.zpp_inner.x*this.zpp_inner.a,m=n.zpp_inner;null!=m._validate&&m._validate();var b=f+n.zpp_inner.y*this.zpp_inner.b+this.zpp_inner.tx,g=n.zpp_inner;null!=g._validate&&g._validate();var w=n.zpp_inner.x*this.zpp_inner.c,M=n.zpp_inner;null!=M._validate&&M._validate();var C,k=w+n.zpp_inner.y*this.zpp_inner.d+this.zpp_inner.ty;if(null==xp.poolVec2?C=new yn:(C=xp.poolVec2,xp.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner){var O;null==xt.zpp_pool?O=new xt:(O=xt.zpp_pool,xt.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=b,O.y=k,C.zpp_inner=O,C.zpp_inner.outer=C}else{var P,S=C.zpp_inner;if(null!=S._validate&&S._validate(),C.zpp_inner.x==b){var A=C.zpp_inner;null!=A._validate&&A._validate(),P=C.zpp_inner.y==k}else P=!1;if(!P){C.zpp_inner.x=b,C.zpp_inner.y=k;var j=C.zpp_inner;null!=j._invalidate&&j._invalidate(j)}}C.zpp_inner.weak=t,i=C}if(n.zpp_inner.weak){var E=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=E.outer&&(E.outer.zpp_inner=null,E.outer=null),E._isimmutable=null,E._validate=null,E._invalidate=null,E.next=xt.zpp_pool,xt.zpp_pool=E}return i},sn.prototype.inverseTransform=function(n,e,t){null==t&&(t=!1),null==e&&(e=!1);var i,p=1/(this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c);if(e){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x*this.zpp_inner.d,o=n.zpp_inner;null!=o._validate&&o._validate();var a=(r-n.zpp_inner.y*this.zpp_inner.b)*p,s=n.zpp_inner;null!=s._validate&&s._validate();var _=n.zpp_inner.y*this.zpp_inner.a,h=n.zpp_inner;null!=h._validate&&h._validate();var u,x=(_-n.zpp_inner.x*this.zpp_inner.c)*p;if(null==xp.poolVec2?u=new yn:(u=xp.poolVec2,xp.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner){var d;null==xt.zpp_pool?d=new xt:(d=xt.zpp_pool,xt.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=a,d.y=x,u.zpp_inner=d,u.zpp_inner.outer=u}else{var y,z=u.zpp_inner;if(null!=z._validate&&z._validate(),u.zpp_inner.x==a){var v=u.zpp_inner;null!=v._validate&&v._validate(),y=u.zpp_inner.y==x}else y=!1;if(!y){u.zpp_inner.x=a,u.zpp_inner.y=x;var c=u.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}u.zpp_inner.weak=t,i=u}else{var f=n.zpp_inner;null!=f._validate&&f._validate();var m=n.zpp_inner.x-this.zpp_inner.tx,b=n.zpp_inner;null!=b._validate&&b._validate();var g,w=n.zpp_inner.y-this.zpp_inner.ty,M=(m*this.zpp_inner.d-w*this.zpp_inner.b)*p,C=(w*this.zpp_inner.a-m*this.zpp_inner.c)*p;if(null==xp.poolVec2?g=new yn:(g=xp.poolVec2,xp.poolVec2=g.zpp_pool,g.zpp_pool=null),null==g.zpp_inner){var k;null==xt.zpp_pool?k=new xt:(k=xt.zpp_pool,xt.zpp_pool=k.next,k.next=null),k.weak=!1,k._immutable=!1,k.x=M,k.y=C,g.zpp_inner=k,g.zpp_inner.outer=g}else{var O,P=g.zpp_inner;if(null!=P._validate&&P._validate(),g.zpp_inner.x==M){var S=g.zpp_inner;null!=S._validate&&S._validate(),O=g.zpp_inner.y==C}else O=!1;if(!O){g.zpp_inner.x=M,g.zpp_inner.y=C;var A=g.zpp_inner;null!=A._invalidate&&A._invalidate(A)}}g.zpp_inner.weak=t,i=g}if(n.zpp_inner.weak){var j=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=j.outer&&(j.outer.zpp_inner=null,j.outer=null),j._isimmutable=null,j._validate=null,j._invalidate=null,j.next=xt.zpp_pool,xt.zpp_pool=j}return i},sn.prototype.toString=function(){return"{ a: "+this.zpp_inner.a+" b: "+this.zpp_inner.b+" c: "+this.zpp_inner.c+" d: "+this.zpp_inner.d+" tx: "+this.zpp_inner.tx+" ty: "+this.zpp_inner.ty+" }"},sn.prototype.equiorthogonal=function(){if(this.singular())return!1;var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(n*n<o.epsilon){var e=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-this.zpp_inner.c*this.zpp_inner.c-this.zpp_inner.d*this.zpp_inner.d;return e*e<o.epsilon}return!1},sn.prototype.orthogonal=function(){var n=this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d;if(n*n<o.epsilon){var e=this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.b*this.zpp_inner.b-1,t=this.zpp_inner.c*this.zpp_inner.c+this.zpp_inner.d*this.zpp_inner.d-1;return e*e<o.epsilon&&t*t<o.epsilon}return!1},sn.prototype.equiorthogonalise=function(){if(!this.equiorthogonal()){var n=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d),t=(n+e)/2;n=t/n,e=t/e;this.zpp_inner.a=this.zpp_inner.a*n;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate();this.zpp_inner.c=this.zpp_inner.c*n;var p=this.zpp_inner;null!=p._invalidate&&p._invalidate();this.zpp_inner.b=this.zpp_inner.b*e;var l=this.zpp_inner;null!=l._invalidate&&l._invalidate();this.zpp_inner.d=this.zpp_inner.d*e;var r=this.zpp_inner;null!=r._invalidate&&r._invalidate();var o=.25*Math.PI-.5*Math.acos((this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d)/(t*t));this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(o=-o);var a=Math.sin(o),s=Math.cos(o),_=this.zpp_inner.a*s-this.zpp_inner.c*a,h=this.zpp_inner.b*s+this.zpp_inner.d*a;this.zpp_inner.c=this.zpp_inner.c*s+this.zpp_inner.a*a;var u=this.zpp_inner;null!=u._invalidate&&u._invalidate(),this.zpp_inner.a=_;var x=this.zpp_inner;null!=x._invalidate&&x._invalidate(),this.zpp_inner.d=this.zpp_inner.d*s-this.zpp_inner.b*a;var d=this.zpp_inner;null!=d._invalidate&&d._invalidate(),this.zpp_inner.b=h;var y=this.zpp_inner;null!=y._invalidate&&y._invalidate();var z=this.zpp_inner;null!=z._invalidate&&z._invalidate()}return this},sn.prototype.orthogonalise=function(){if(!this.orthogonal()){var n=Math.sqrt(this.zpp_inner.a*this.zpp_inner.a+this.zpp_inner.c*this.zpp_inner.c),e=Math.sqrt(this.zpp_inner.b*this.zpp_inner.b+this.zpp_inner.d*this.zpp_inner.d);n=1/n,e=1/e;this.zpp_inner.a=this.zpp_inner.a*n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate();this.zpp_inner.c=this.zpp_inner.c*n;var i=this.zpp_inner;null!=i._invalidate&&i._invalidate();this.zpp_inner.b=this.zpp_inner.b*e;var p=this.zpp_inner;null!=p._invalidate&&p._invalidate();this.zpp_inner.d=this.zpp_inner.d*e;var l=this.zpp_inner;null!=l._invalidate&&l._invalidate();var r=.25*Math.PI-.5*Math.acos((this.zpp_inner.a*this.zpp_inner.b+this.zpp_inner.c*this.zpp_inner.d)/1);this.zpp_inner.a*this.zpp_inner.d-this.zpp_inner.b*this.zpp_inner.c>0&&(r=-r);var o=Math.sin(r),a=Math.cos(r),s=this.zpp_inner.a*a-this.zpp_inner.c*o,_=this.zpp_inner.b*a+this.zpp_inner.d*o;this.zpp_inner.c=this.zpp_inner.c*a+this.zpp_inner.a*o;var h=this.zpp_inner;null!=h._invalidate&&h._invalidate(),this.zpp_inner.a=s;var u=this.zpp_inner;null!=u._invalidate&&u._invalidate(),this.zpp_inner.d=this.zpp_inner.d*a-this.zpp_inner.b*o;var x=this.zpp_inner;null!=x._invalidate&&x._invalidate(),this.zpp_inner.b=_;var d=this.zpp_inner;null!=d._invalidate&&d._invalidate();var y=this.zpp_inner;null!=y._invalidate&&y._invalidate()}return this},Object.defineProperty(sn.prototype,"a",{get:sn.prototype.get_a,set:sn.prototype.set_a}),Object.defineProperty(sn.prototype,"b",{get:sn.prototype.get_b,set:sn.prototype.set_b}),Object.defineProperty(sn.prototype,"c",{get:sn.prototype.get_c,set:sn.prototype.set_c}),Object.defineProperty(sn.prototype,"d",{get:sn.prototype.get_d,set:sn.prototype.set_d}),Object.defineProperty(sn.prototype,"tx",{get:sn.prototype.get_tx,set:sn.prototype.set_tx}),Object.defineProperty(sn.prototype,"ty",{get:sn.prototype.get_ty,set:sn.prototype.set_ty}),Object.defineProperty(sn.prototype,"determinant",{get:sn.prototype.get_determinant}),sn.prototype.__class__=sn;var _n=nape.geom.MatMN=function(n,e){this.zpp_inner=null,this.zpp_inner=new Xe(n,e),this.zpp_inner.outer=this};_n.__name__=["nape","geom","MatMN"],_n.prototype.zpp_inner=null,_n.prototype.get_rows=function(){return this.zpp_inner.m},_n.prototype.get_cols=function(){return this.zpp_inner.n},_n.prototype.x=function(n,e){return this.zpp_inner.x[n*this.zpp_inner.n+e]},_n.prototype.setx=function(n,e,t){return this.zpp_inner.x[n*this.zpp_inner.n+e]=t},_n.prototype.toString=function(){for(var n="{ ",e=!0,t=0,i=this.zpp_inner.m;t<i;){var p=t++;e||(n+="; "),e=!1;for(var l=0,r=this.zpp_inner.n;l<r;)n+=this.zpp_inner.x[p*this.zpp_inner.n+l++]+" "}return n+="}"},_n.prototype.transpose=function(){for(var n=new _n(this.zpp_inner.n,this.zpp_inner.m),e=0,t=this.zpp_inner.m;e<t;)for(var i=e++,p=0,l=this.zpp_inner.n;p<l;){var r=p++;n.zpp_inner.x[r*n.zpp_inner.n+i]=this.zpp_inner.x[i*this.zpp_inner.n+r]}return n},_n.prototype.mul=function(n){for(var e=new _n(this.zpp_inner.m,n.zpp_inner.n),t=0,i=this.zpp_inner.m;t<i;)for(var p=t++,l=0,r=n.zpp_inner.n;l<r;){for(var o=l++,a=0,s=0,_=this.zpp_inner.n;s<_;){var h=s++;a+=this.zpp_inner.x[p*this.zpp_inner.n+h]*n.zpp_inner.x[h*n.zpp_inner.n+o]}e.zpp_inner.x[p*e.zpp_inner.n+o]=a}return e},Object.defineProperty(_n.prototype,"rows",{get:_n.prototype.get_rows}),Object.defineProperty(_n.prototype,"cols",{get:_n.prototype.get_cols}),_n.prototype.__class__=_n;var hn=nape.geom.Ray=function(n,e){this.zpp_inner=null,this.zpp_inner=new nt;var t=this.zpp_inner.origin,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r,o=n.zpp_inner.y,a=t.zpp_inner;if(null!=a._validate&&a._validate(),t.zpp_inner.x==p){var s=t.zpp_inner;null!=s._validate&&s._validate(),r=t.zpp_inner.y==o}else r=!1;if(!r){t.zpp_inner.x=p,t.zpp_inner.y=o;var _=t.zpp_inner;null!=_._invalidate&&_._invalidate(_)}if(n.zpp_inner.weak){var h=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=xt.zpp_pool,xt.zpp_pool=h}var u=this.zpp_inner.direction,x=e.zpp_inner;null!=x._validate&&x._validate();var d=e.zpp_inner.x,y=e.zpp_inner;null!=y._validate&&y._validate();var z,v=e.zpp_inner.y,c=u.zpp_inner;if(null!=c._validate&&c._validate(),u.zpp_inner.x==d){var f=u.zpp_inner;null!=f._validate&&f._validate(),z=u.zpp_inner.y==v}else z=!1;if(!z){u.zpp_inner.x=d,u.zpp_inner.y=v;var m=u.zpp_inner;null!=m._invalidate&&m._invalidate(m)}if(e.zpp_inner.weak){var b=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=xt.zpp_pool,xt.zpp_pool=b}this.zpp_inner.zip_dir=!0,this.zpp_inner.maxdist=1/0};hn.__name__=["nape","geom","Ray"],hn.fromSegment=function(n,e){var t=new hn(n,e.sub(n,!0)),i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.y,o=e.zpp_inner;null!=o._validate&&o._validate();var a=e.zpp_inner.x,s=e.zpp_inner;null!=s._validate&&s._validate();var _,h;if(_=p-a,h=r-e.zpp_inner.y,t.zpp_inner.maxdist=Math.sqrt(_*_+h*h),n.zpp_inner.weak){var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u}if(e.zpp_inner.weak){var x=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=xt.zpp_pool,xt.zpp_pool=x}return t},hn.prototype.zpp_inner=null,hn.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},hn.prototype.get_origin=function(){return this.zpp_inner.origin},hn.prototype.set_origin=function(n){var e=this.zpp_inner.origin,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return this.zpp_inner.origin},hn.prototype.get_direction=function(){return this.zpp_inner.direction},hn.prototype.set_direction=function(n){var e=this.zpp_inner.direction,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return this.zpp_inner.zip_dir=!0,this.zpp_inner.direction},hn.prototype.get_maxDistance=function(){return this.zpp_inner.maxdist},hn.prototype.set_maxDistance=function(n){return this.zpp_inner.maxdist=n,this.zpp_inner.maxdist},hn.prototype.aabb=function(){return this.zpp_inner.rayAABB().wrapper()},hn.prototype.at=function(n,e){null==e&&(e=!1),this.zpp_inner.validate_dir();var t=this.zpp_inner.origin,i=t.zpp_inner;null!=i._validate&&i._validate();var p=t.zpp_inner.x+n*this.zpp_inner.dirx,l=this.zpp_inner.origin,r=l.zpp_inner;null!=r._validate&&r._validate();var o,a=l.zpp_inner.y+n*this.zpp_inner.diry;if(null==xp.poolVec2?o=new yn:(o=xp.poolVec2,xp.poolVec2=o.zpp_pool,o.zpp_pool=null),null==o.zpp_inner){var s;null==xt.zpp_pool?s=new xt:(s=xt.zpp_pool,xt.zpp_pool=s.next,s.next=null),s.weak=!1,s._immutable=!1,s.x=p,s.y=a,o.zpp_inner=s,o.zpp_inner.outer=o}else{var _,h=o.zpp_inner;if(null!=h._validate&&h._validate(),o.zpp_inner.x==p){var u=o.zpp_inner;null!=u._validate&&u._validate(),_=o.zpp_inner.y==a}else _=!1;if(!_){o.zpp_inner.x=p,o.zpp_inner.y=a;var x=o.zpp_inner;null!=x._invalidate&&x._invalidate(x)}}return o.zpp_inner.weak=e,o},hn.prototype.copy=function(){var n=new hn(this.zpp_inner.origin,this.zpp_inner.direction);return n.zpp_inner.maxdist=this.zpp_inner.maxdist,n},Object.defineProperty(hn.prototype,"userData",{get:hn.prototype.get_userData}),Object.defineProperty(hn.prototype,"origin",{get:hn.prototype.get_origin,set:hn.prototype.set_origin}),Object.defineProperty(hn.prototype,"direction",{get:hn.prototype.get_direction,set:hn.prototype.set_direction}),Object.defineProperty(hn.prototype,"maxDistance",{get:hn.prototype.get_maxDistance,set:hn.prototype.set_maxDistance}),hn.prototype.__class__=hn;var un=nape.geom.RayResult=function(){this.zpp_inner=null};un.__name__=["nape","geom","RayResult"],un.prototype.zpp_inner=null,un.prototype.get_normal=function(){return this.zpp_inner.normal},un.prototype.get_distance=function(){return this.zpp_inner.toiDistance},un.prototype.get_inner=function(){return this.zpp_inner.inner},un.prototype.get_shape=function(){return this.zpp_inner.shape},un.prototype.dispose=function(){this.zpp_inner.free()},un.prototype.toString=function(){return"{ shape: "+i.string(this.zpp_inner.shape)+" distance: "+this.zpp_inner.toiDistance+" ?inner: "+i.string(this.zpp_inner.inner)+" }"},Object.defineProperty(un.prototype,"normal",{get:un.prototype.get_normal}),Object.defineProperty(un.prototype,"distance",{get:un.prototype.get_distance}),Object.defineProperty(un.prototype,"inner",{get:un.prototype.get_inner}),Object.defineProperty(un.prototype,"shape",{get:un.prototype.get_shape}),un.prototype.__class__=un;var xn=nape.geom.RayResultIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};xn.__name__=["nape","geom","RayResultIterator"],xn.get=function(n){var e;if(null==xn.zpp_pool){lp.internal=!0;var t=new xn;lp.internal=!1,e=t}else{var i=xn.zpp_pool;xn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},xn.prototype.zpp_inner=null,xn.prototype.zpp_i=null,xn.prototype.zpp_critical=null,xn.prototype.zpp_next=null,xn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=xn.zpp_pool,xn.zpp_pool=this,this.zpp_inner=null,!1)},xn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},xn.prototype.__class__=xn;var dn=nape.geom.RayResultList=function(){this.zpp_inner=null,this.zpp_inner=new lp,this.zpp_inner.outer=this};dn.__name__=["nape","geom","RayResultList"],dn.fromArray=function(n){for(var e=new dn,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},dn.prototype.zpp_inner=null,dn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},dn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n)},dn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt},dn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},dn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n)}else this.zpp_inner.inner.add(n);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},dn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=n=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=n=null==t?this.zpp_inner.inner.head.elt:t.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n},dn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=n=null==e?this.zpp_inner.inner.head.elt:e.next.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=n=this.zpp_inner.inner.head.elt;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n},dn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},dn.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n),this.zpp_inner.invalidate()),e},dn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},dn.prototype.empty=function(){return null==this.zpp_inner.inner.head},dn.prototype.iterator=function(){return this.zpp_inner.valmod(),xn.get(this)},dn.prototype.copy=function(n){null==n&&(n=!1);var e=new dn;this.zpp_inner.valmod();for(var t=xn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=xn.zpp_pool,xn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},dn.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=xn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=xn.zpp_pool,xn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},dn.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=xn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=xn.zpp_pool,xn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},dn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=xn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=xn.zpp_pool,xn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=xn.zpp_pool,xn.zpp_pool=e,e.zpp_inner=null;break}}return this},dn.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(dn.prototype,"length",{get:dn.prototype.get_length}),dn.prototype.__class__=dn;var yn=nape.geom.Vec2=function(n,e){var t;null==e&&(e=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null,null==xt.zpp_pool?t=new xt:(t=xt.zpp_pool,xt.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=n,t.y=e,this.zpp_inner=t,this.zpp_inner.outer=this};yn.__name__=["nape","geom","Vec2"],yn.weak=function(n,e){var t;if(null==e&&(e=0),null==n&&(n=0),null==xp.poolVec2?t=new yn:(t=xp.poolVec2,xp.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner){var i;null==xt.zpp_pool?i=new xt:(i=xt.zpp_pool,xt.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=n,i.y=e,t.zpp_inner=i,t.zpp_inner.outer=t}else{var p,l=t.zpp_inner;if(null!=l._validate&&l._validate(),t.zpp_inner.x==n){var r=t.zpp_inner;null!=r._validate&&r._validate(),p=t.zpp_inner.y==e}else p=!1;if(!p){t.zpp_inner.x=n,t.zpp_inner.y=e;var o=t.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}return t.zpp_inner.weak=!0,t},yn.get=function(n,e,t){var i;if(null==t&&(t=!1),null==e&&(e=0),null==n&&(n=0),null==xp.poolVec2?i=new yn:(i=xp.poolVec2,xp.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=e,i.zpp_inner=p,i.zpp_inner.outer=i}else{var l,r=i.zpp_inner;if(null!=r._validate&&r._validate(),i.zpp_inner.x==n){var o=i.zpp_inner;null!=o._validate&&o._validate(),l=i.zpp_inner.y==e}else l=!1;if(!l){i.zpp_inner.x=n,i.zpp_inner.y=e;var a=i.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}return i.zpp_inner.weak=t,i},yn.fromPolar=function(n,e,t){null==t&&(t=!1);var i,p=n*Math.cos(e),l=n*Math.sin(e);if(null==xp.poolVec2?i=new yn:(i=xp.poolVec2,xp.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner){var r;null==xt.zpp_pool?r=new xt:(r=xt.zpp_pool,xt.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=p,r.y=l,i.zpp_inner=r,i.zpp_inner.outer=i}else{var o,a=i.zpp_inner;if(null!=a._validate&&a._validate(),i.zpp_inner.x==p){var s=i.zpp_inner;null!=s._validate&&s._validate(),o=i.zpp_inner.y==l}else o=!1;if(!o){i.zpp_inner.x=p,i.zpp_inner.y=l;var _=i.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return i.zpp_inner.weak=t,i},yn.dsq=function(n,e){var t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.y,r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.x,a=e.zpp_inner;null!=a._validate&&a._validate();var s,_,h=(s=i-o)*s+(_=l-e.zpp_inner.y)*_;if(n.zpp_inner.weak){var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u}if(e.zpp_inner.weak){var x=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=xt.zpp_pool,xt.zpp_pool=x}return h},yn.distance=function(n,e){var t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.y,r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.x,a=e.zpp_inner;null!=a._validate&&a._validate();var s,_;s=i-o,_=l-e.zpp_inner.y;var h=Math.sqrt(s*s+_*_);if(n.zpp_inner.weak){var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u}if(e.zpp_inner.weak){var x=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=xt.zpp_pool,xt.zpp_pool=x}return h},yn.prototype.zpp_inner=null,yn.prototype.zpp_pool=null,yn.prototype.dispose=function(){var n=this.zpp_inner;this.zpp_inner.outer=null,this.zpp_inner=null;this.zpp_pool=xp.poolVec2,xp.poolVec2=this,null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=xt.zpp_pool,xt.zpp_pool=n},yn.prototype.copy=function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l=this.zpp_inner.y;if(null==xp.poolVec2?p=new yn:(p=xp.poolVec2,xp.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner){var r;null==xt.zpp_pool?r=new xt:(r=xt.zpp_pool,xt.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=l,p.zpp_inner=r,p.zpp_inner.outer=p}else{var o,a=p.zpp_inner;if(null!=a._validate&&a._validate(),p.zpp_inner.x==t){var s=p.zpp_inner;null!=s._validate&&s._validate(),o=p.zpp_inner.y==l}else o=!1;if(!o){p.zpp_inner.x=t,p.zpp_inner.y=l;var _=p.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return p.zpp_inner.weak=n,p},yn.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},yn.prototype.set_x=function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.x!=n){this.zpp_inner.x=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.x},yn.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},yn.prototype.set_y=function(n){var e=this.zpp_inner;if(null!=e._validate&&e._validate(),this.zpp_inner.y!=n){this.zpp_inner.y=n;var t=this.zpp_inner;null!=t._invalidate&&t._invalidate(t)}var i=this.zpp_inner;return null!=i._validate&&i._validate(),this.zpp_inner.y},yn.prototype.get_length=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),Math.sqrt(i+l*this.zpp_inner.y)},yn.prototype.set_length=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=t*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a=n/Math.sqrt(p+r*this.zpp_inner.y),s=this,_=s.zpp_inner;null!=_._validate&&_._validate();var h=s.zpp_inner.x*a,u=s.zpp_inner;if(null!=u._validate&&u._validate(),s.zpp_inner.x!=h){s.zpp_inner.x=h;var x=s.zpp_inner;null!=x._invalidate&&x._invalidate(x)}var d=s.zpp_inner;null!=d._validate&&d._validate();var y=this,z=y.zpp_inner;null!=z._validate&&z._validate();var v=y.zpp_inner.y*a,c=y.zpp_inner;if(null!=c._validate&&c._validate(),y.zpp_inner.y!=v){y.zpp_inner.y=v;var f=y.zpp_inner;null!=f._invalidate&&f._invalidate(f)}var m=y.zpp_inner;null!=m._validate&&m._validate();var b=this.zpp_inner;null!=b._invalidate&&b._invalidate(b);var g=this.zpp_inner;null!=g._validate&&g._validate();var w=this.zpp_inner.x,M=this.zpp_inner;null!=M._validate&&M._validate();var C=w*this.zpp_inner.x,k=this.zpp_inner;null!=k._validate&&k._validate();var O=this.zpp_inner.y,P=this.zpp_inner;return null!=P._validate&&P._validate(),Math.sqrt(C+O*this.zpp_inner.y)},yn.prototype.lsq=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;return null!=r._validate&&r._validate(),i+l*this.zpp_inner.y},yn.prototype.set=function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p,l=n.zpp_inner.y,r=this.zpp_inner;if(null!=r._validate&&r._validate(),this.zpp_inner.x==t){var o=this.zpp_inner;null!=o._validate&&o._validate(),p=this.zpp_inner.y==l}else p=!1;if(!p){this.zpp_inner.x=t,this.zpp_inner.y=l;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(a)}if(n.zpp_inner.weak){var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=xt.zpp_pool,xt.zpp_pool=s}return this},yn.prototype.setxy=function(n,e){var t,i=this.zpp_inner;if(null!=i._validate&&i._validate(),this.zpp_inner.x==n){var p=this.zpp_inner;null!=p._validate&&p._validate(),t=this.zpp_inner.y==e}else t=!1;if(!t){this.zpp_inner.x=n,this.zpp_inner.y=e;var l=this.zpp_inner;null!=l._invalidate&&l._invalidate(l)}return this},yn.prototype.get_angle=function(){var n,e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;if(null!=i._validate&&i._validate(),t==this.zpp_inner.y){var p=this.zpp_inner;null!=p._validate&&p._validate(),n=0==this.zpp_inner.x}else n=!1;if(n)return 0;var l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;return null!=o._validate&&o._validate(),Math.atan2(r,this.zpp_inner.x)},yn.prototype.set_angle=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=t*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a,s,_=Math.sqrt(p+r*this.zpp_inner.y),h=_*Math.cos(n),u=_*Math.sin(n),x=this.zpp_inner;if(null!=x._validate&&x._validate(),this.zpp_inner.x==h){var d=this.zpp_inner;null!=d._validate&&d._validate(),a=this.zpp_inner.y==u}else a=!1;if(!a){this.zpp_inner.x=h,this.zpp_inner.y=u;var y=this.zpp_inner;null!=y._invalidate&&y._invalidate(y)}var z=this.zpp_inner;null!=z._validate&&z._validate();var v=this.zpp_inner.x,c=this.zpp_inner;if(null!=c._validate&&c._validate(),v==this.zpp_inner.y){var f=this.zpp_inner;null!=f._validate&&f._validate(),s=0==this.zpp_inner.x}else s=!1;if(s)return 0;var m=this.zpp_inner;null!=m._validate&&m._validate();var b=this.zpp_inner.y,g=this.zpp_inner;return null!=g._validate&&g._validate(),Math.atan2(b,this.zpp_inner.x)},yn.prototype.rotate=function(n){if(n%(2*Math.PI)!=0){var e=Math.sin(n),t=Math.cos(n),i=t*this.zpp_inner.x-e*this.zpp_inner.y;this.zpp_inner.y=this.zpp_inner.x*e+this.zpp_inner.y*t,this.zpp_inner.x=i;var p=this.zpp_inner;null!=p._invalidate&&p._invalidate(p)}return this},yn.prototype.reflect=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l,r=this.zpp_inner.y;if(null==xp.poolVec2?l=new yn:(l=xp.poolVec2,xp.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner){var o;null==xt.zpp_pool?o=new xt:(o=xt.zpp_pool,xt.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=i,o.y=r,l.zpp_inner=o,l.zpp_inner.outer=l}else{var a,s=l.zpp_inner;if(null!=s._validate&&s._validate(),l.zpp_inner.x==i){var _=l.zpp_inner;null!=_._validate&&_._validate(),a=l.zpp_inner.y==r}else a=!1;if(!a){l.zpp_inner.x=i,l.zpp_inner.y=r;var h=l.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}l.zpp_inner.weak=!0;var u=l.normalise(),x=n.sub(u.muleq(2*u.dot(n)),e);if(n.zpp_inner.weak){var d=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=xt.zpp_pool,xt.zpp_pool=d}return x},yn.prototype.normalise=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var o=1/Math.sqrt(i+l*this.zpp_inner.y),a=this,s=a.zpp_inner;null!=s._validate&&s._validate();var _=a.zpp_inner.x*o,h=a.zpp_inner;if(null!=h._validate&&h._validate(),a.zpp_inner.x!=_){a.zpp_inner.x=_;var u=a.zpp_inner;null!=u._invalidate&&u._invalidate(u)}var x=a.zpp_inner;null!=x._validate&&x._validate();var d=this,y=d.zpp_inner;null!=y._validate&&y._validate();var z=d.zpp_inner.y*o,v=d.zpp_inner;if(null!=v._validate&&v._validate(),d.zpp_inner.y!=z){d.zpp_inner.y=z;var c=d.zpp_inner;null!=c._invalidate&&c._invalidate(c)}var f=d.zpp_inner;null!=f._validate&&f._validate();var m=this.zpp_inner;return null!=m._invalidate&&m._invalidate(m),this},yn.prototype.unit=function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=t*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a=1/Math.sqrt(p+r*this.zpp_inner.y),s=this.zpp_inner;null!=s._validate&&s._validate();var _=this.zpp_inner.x*a,h=this.zpp_inner;null!=h._validate&&h._validate();var u,x=this.zpp_inner.y*a;if(null==xp.poolVec2?u=new yn:(u=xp.poolVec2,xp.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner){var d;null==xt.zpp_pool?d=new xt:(d=xt.zpp_pool,xt.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=_,d.y=x,u.zpp_inner=d,u.zpp_inner.outer=u}else{var y,z=u.zpp_inner;if(null!=z._validate&&z._validate(),u.zpp_inner.x==_){var v=u.zpp_inner;null!=v._validate&&v._validate(),y=u.zpp_inner.y==x}else y=!1;if(!y){u.zpp_inner.x=_,u.zpp_inner.y=x;var c=u.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}return u.zpp_inner.weak=n,u},yn.prototype.add=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=i+n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.y,a=n.zpp_inner;null!=a._validate&&a._validate();var s,_=o+n.zpp_inner.y;if(null==xp.poolVec2?s=new yn:(s=xp.poolVec2,xp.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner){var h;null==xt.zpp_pool?h=new xt:(h=xt.zpp_pool,xt.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=l,h.y=_,s.zpp_inner=h,s.zpp_inner.outer=s}else{var u,x=s.zpp_inner;if(null!=x._validate&&x._validate(),s.zpp_inner.x==l){var d=s.zpp_inner;null!=d._validate&&d._validate(),u=s.zpp_inner.y==_}else u=!1;if(!u){s.zpp_inner.x=l,s.zpp_inner.y=_;var y=s.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}s.zpp_inner.weak=e;var z=s;if(n.zpp_inner.weak){var v=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=xt.zpp_pool,xt.zpp_pool=v}return z},yn.prototype.addMul=function(n,e,t){null==t&&(t=!1);var i=this.zpp_inner;null!=i._validate&&i._validate();var p=this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=p+n.zpp_inner.x*e,o=this.zpp_inner;null!=o._validate&&o._validate();var a=this.zpp_inner.y,s=n.zpp_inner;null!=s._validate&&s._validate();var _,h=a+n.zpp_inner.y*e;if(null==xp.poolVec2?_=new yn:(_=xp.poolVec2,xp.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner){var u;null==xt.zpp_pool?u=new xt:(u=xt.zpp_pool,xt.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=r,u.y=h,_.zpp_inner=u,_.zpp_inner.outer=_}else{var x,d=_.zpp_inner;if(null!=d._validate&&d._validate(),_.zpp_inner.x==r){var y=_.zpp_inner;null!=y._validate&&y._validate(),x=_.zpp_inner.y==h}else x=!1;if(!x){_.zpp_inner.x=r,_.zpp_inner.y=h;var z=_.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}_.zpp_inner.weak=t;var v=_;if(n.zpp_inner.weak){var c=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=xt.zpp_pool,xt.zpp_pool=c}return v},yn.prototype.sub=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l=i-n.zpp_inner.x,r=this.zpp_inner;null!=r._validate&&r._validate();var o=this.zpp_inner.y,a=n.zpp_inner;null!=a._validate&&a._validate();var s,_=o-n.zpp_inner.y;if(null==xp.poolVec2?s=new yn:(s=xp.poolVec2,xp.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner){var h;null==xt.zpp_pool?h=new xt:(h=xt.zpp_pool,xt.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=l,h.y=_,s.zpp_inner=h,s.zpp_inner.outer=s}else{var u,x=s.zpp_inner;if(null!=x._validate&&x._validate(),s.zpp_inner.x==l){var d=s.zpp_inner;null!=d._validate&&d._validate(),u=s.zpp_inner.y==_}else u=!1;if(!u){s.zpp_inner.x=l,s.zpp_inner.y=_;var y=s.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}s.zpp_inner.weak=e;var z=s;if(n.zpp_inner.weak){var v=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=v.outer&&(v.outer.zpp_inner=null,v.outer=null),v._isimmutable=null,v._validate=null,v._invalidate=null,v.next=xt.zpp_pool,xt.zpp_pool=v}return z},yn.prototype.mul=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;null!=t._validate&&t._validate();var i=this.zpp_inner.x*n,p=this.zpp_inner;null!=p._validate&&p._validate();var l,r=this.zpp_inner.y*n;if(null==xp.poolVec2?l=new yn:(l=xp.poolVec2,xp.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner){var o;null==xt.zpp_pool?o=new xt:(o=xt.zpp_pool,xt.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=i,o.y=r,l.zpp_inner=o,l.zpp_inner.outer=l}else{var a,s=l.zpp_inner;if(null!=s._validate&&s._validate(),l.zpp_inner.x==i){var _=l.zpp_inner;null!=_._validate&&_._validate(),a=l.zpp_inner.y==r}else a=!1;if(!a){l.zpp_inner.x=i,l.zpp_inner.y=r;var h=l.zpp_inner;null!=h._invalidate&&h._invalidate(h)}}return l.zpp_inner.weak=e,l},yn.prototype.addeq=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=t+n.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var a,s=r+n.zpp_inner.y,_=this.zpp_inner;if(null!=_._validate&&_._validate(),this.zpp_inner.x==p){var h=this.zpp_inner;null!=h._validate&&h._validate(),a=this.zpp_inner.y==s}else a=!1;if(!a){this.zpp_inner.x=p,this.zpp_inner.y=s;var u=this.zpp_inner;null!=u._invalidate&&u._invalidate(u)}if(n.zpp_inner.weak){var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=xt.zpp_pool,xt.zpp_pool=x}return this},yn.prototype.subeq=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=t-n.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var a,s=r-n.zpp_inner.y,_=this.zpp_inner;if(null!=_._validate&&_._validate(),this.zpp_inner.x==p){var h=this.zpp_inner;null!=h._validate&&h._validate(),a=this.zpp_inner.y==s}else a=!1;if(!a){this.zpp_inner.x=p,this.zpp_inner.y=s;var u=this.zpp_inner;null!=u._invalidate&&u._invalidate(u)}if(n.zpp_inner.weak){var x=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=xt.zpp_pool,xt.zpp_pool=x}return this},yn.prototype.muleq=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x*n,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l=this.zpp_inner.y*n,r=this.zpp_inner;if(null!=r._validate&&r._validate(),this.zpp_inner.x==t){var o=this.zpp_inner;null!=o._validate&&o._validate(),p=this.zpp_inner.y==l}else p=!1;if(!p){this.zpp_inner.x=t,this.zpp_inner.y=l;var a=this.zpp_inner;null!=a._invalidate&&a._invalidate(a)}return this},yn.prototype.dot=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=t*n.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=n.zpp_inner;null!=o._validate&&o._validate();var a=p+r*n.zpp_inner.y;if(n.zpp_inner.weak){var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=xt.zpp_pool,xt.zpp_pool=s}return a},yn.prototype.cross=function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();var p=t*this.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,o=this.zpp_inner;null!=o._validate&&o._validate();var a=p-r*this.zpp_inner.y;if(n.zpp_inner.weak){var s=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=s.outer&&(s.outer.zpp_inner=null,s.outer=null),s._isimmutable=null,s._validate=null,s._invalidate=null,s.next=xt.zpp_pool,xt.zpp_pool=s}return a},yn.prototype.perp=function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=-this.zpp_inner.y,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l=this.zpp_inner.x;if(null==xp.poolVec2?p=new yn:(p=xp.poolVec2,xp.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner){var r;null==xt.zpp_pool?r=new xt:(r=xt.zpp_pool,xt.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=l,p.zpp_inner=r,p.zpp_inner.outer=p}else{var o,a=p.zpp_inner;if(null!=a._validate&&a._validate(),p.zpp_inner.x==t){var s=p.zpp_inner;null!=s._validate&&s._validate(),o=p.zpp_inner.y==l}else o=!1;if(!o){p.zpp_inner.x=t,p.zpp_inner.y=l;var _=p.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return p.zpp_inner.weak=n,p},yn.prototype.toString=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.toString()},Object.defineProperty(yn.prototype,"x",{get:yn.prototype.get_x,set:yn.prototype.set_x}),Object.defineProperty(yn.prototype,"y",{get:yn.prototype.get_y,set:yn.prototype.set_y}),Object.defineProperty(yn.prototype,"length",{get:yn.prototype.get_length,set:yn.prototype.set_length}),Object.defineProperty(yn.prototype,"angle",{get:yn.prototype.get_angle,set:yn.prototype.set_angle}),yn.prototype.__class__=yn;var zn=nape.geom.Vec2Iterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};zn.__name__=["nape","geom","Vec2Iterator"],zn.get=function(n){var e;if(null==zn.zpp_pool){ip.internal=!0;var t=new zn;ip.internal=!1,e=t}else{var i=zn.zpp_pool;zn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},zn.prototype.zpp_inner=null,zn.prototype.zpp_i=null,zn.prototype.zpp_critical=null,zn.prototype.zpp_next=null,zn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner.zpp_gl();return this.zpp_critical=!0,this.zpp_i<n||(this.zpp_next=zn.zpp_pool,zn.zpp_pool=this,this.zpp_inner=null,!1)},zn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},zn.prototype.__class__=zn;var vn=nape.geom.Vec2List=function(){this.zpp_inner=null,this.zpp_inner=new ip,this.zpp_inner.outer=this};vn.__name__=["nape","geom","Vec2List"],vn.fromArray=function(n){for(var e=new vn,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},vn.prototype.zpp_inner=null,vn.prototype.get_length=function(){return this.zpp_gl()},vn.prototype.zpp_gl=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},vn.prototype.zpp_vm=function(){this.zpp_inner.valmod()},vn.prototype.has=function(n){return this.zpp_vm(),this.zpp_inner.inner.has(n.zpp_inner)},vn.prototype.at=function(n){if(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;var e=this.zpp_inner.at_ite.elt;if(null==e.outer){e.outer=new yn;var t=e.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t,e.outer.zpp_inner=e}return e.outer},vn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.zpp_inner.inner.add(n.zpp_inner):(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},vn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?(null==this.zpp_inner.push_ite&&(this.zpp_inner.push_ite=this.empty()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-1)),this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)):this.zpp_inner.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},vn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){if(null==(n=this.zpp_inner.inner.head.elt).outer){n.outer=new yn;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=xt.zpp_pool,xt.zpp_pool=e,n.outer.zpp_inner=n}var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var i=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(null==(n=null==i?this.zpp_inner.inner.head.elt:i.next.elt).outer){n.outer=new yn;var p=n.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,n.outer.zpp_inner=n}var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(i)}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new yn;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},vn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null);var e=1==this.zpp_gl()?null:this.zpp_inner.inner.iterator_at(this.zpp_gl()-2);if(null==(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer){n.outer=new yn;var t=n.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t,n.outer.zpp_inner=n}var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{if(null==(n=this.zpp_inner.inner.head.elt).outer){n.outer=new yn;var p=n.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,n.outer.zpp_inner=n}var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new yn;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},vn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},vn.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_vm(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},vn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},vn.prototype.empty=function(){return 0==this.zpp_gl()},vn.prototype.iterator=function(){return this.zpp_vm(),zn.get(this)},vn.prototype.copy=function(n){null==n&&(n=!1);for(var e=new vn,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i,p=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,t.zpp_i<p?i=!0:(t.zpp_next=zn.zpp_pool,zn.zpp_pool=t,t.zpp_inner=null,i=!1),!i)break;t.zpp_critical=!1;var l,r=t.zpp_inner.at(t.zpp_i++);if(n){var o=r.zpp_inner;null!=o._validate&&o._validate();var a=r.zpp_inner.x,s=r.zpp_inner;null!=s._validate&&s._validate();var _,h=r.zpp_inner.y;if(null==xp.poolVec2?_=new yn:(_=xp.poolVec2,xp.poolVec2=_.zpp_pool,_.zpp_pool=null),null==_.zpp_inner){var u;null==xt.zpp_pool?u=new xt:(u=xt.zpp_pool,xt.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=a,u.y=h,_.zpp_inner=u,_.zpp_inner.outer=_}else{var x,d=_.zpp_inner;if(null!=d._validate&&d._validate(),_.zpp_inner.x==a){var y=_.zpp_inner;null!=y._validate&&y._validate(),x=_.zpp_inner.y==h}else x=!1;if(!x){_.zpp_inner.x=a,_.zpp_inner.y=h;var z=_.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}_.zpp_inner.weak=!1,l=_}else l=r;e.push(l)}return e},vn.prototype.merge=function(n){for(var e=n.iterator();;){e.zpp_inner.zpp_inner.valmod();var t,i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,e.zpp_i<i?t=!0:(e.zpp_next=zn.zpp_pool,zn.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;e.zpp_critical=!1;var p=e.zpp_inner.at(e.zpp_i++);this.has(p)||this.add(p)}},vn.prototype.toString=function(){for(var n="[",e=!0,t=this.iterator();;){t.zpp_inner.zpp_inner.valmod();var i,p=t.zpp_inner.zpp_gl();if(t.zpp_critical=!0,t.zpp_i<p?i=!0:(t.zpp_next=zn.zpp_pool,zn.zpp_pool=t,t.zpp_inner=null,i=!1),!i)break;t.zpp_critical=!1;var l=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==l?"NULL":l.toString(),e=!1}return n+"]"},vn.prototype.foreach=function(n){for(var e=this.iterator();;){e.zpp_inner.zpp_inner.valmod();var t,i=e.zpp_inner.zpp_gl();if(e.zpp_critical=!0,e.zpp_i<i?t=!0:(e.zpp_next=zn.zpp_pool,zn.zpp_pool=e,e.zpp_inner=null,t=!1),!t)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=zn.zpp_pool,zn.zpp_pool=e,e.zpp_inner=null;break}}return this},vn.prototype.filter=function(n){for(var e=0;e<this.zpp_gl();){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(vn.prototype,"length",{get:vn.prototype.get_length}),vn.prototype.__class__=vn;var cn=nape.geom.Vec3=function(n,e,t){null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),this.zpp_pool=null,this.zpp_inner=null,this.zpp_inner=new dt,this.zpp_inner.outer=this,this.zpp_inner.x=n;var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.y=e;var p=this.zpp_inner;null!=p._validate&&p._validate(),this.zpp_inner.z=t;var l=this.zpp_inner;null!=l._validate&&l._validate()};cn.__name__=["nape","geom","Vec3"],cn.get=function(n,e,t){var i;return null==t&&(t=0),null==e&&(e=0),null==n&&(n=0),null==xp.poolVec3?i=new cn:(i=xp.poolVec3,xp.poolVec3=i.zpp_pool,i.zpp_pool=null),i.setxyz(n,e,t),i.zpp_inner.immutable=!1,i.zpp_inner._validate=null,i},cn.prototype.zpp_inner=null,cn.prototype.zpp_pool=null,cn.prototype.get_x=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.x},cn.prototype.set_x=function(n){this.zpp_inner.x=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.x},cn.prototype.get_y=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.y},cn.prototype.set_y=function(n){this.zpp_inner.y=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.y},cn.prototype.get_z=function(){var n=this.zpp_inner;return null!=n._validate&&n._validate(),this.zpp_inner.z},cn.prototype.set_z=function(n){this.zpp_inner.z=n;var e=this.zpp_inner;return null!=e._validate&&e._validate(),this.zpp_inner.z},cn.prototype.dispose=function(){this.zpp_pool=xp.poolVec3,xp.poolVec3=this},cn.prototype.get_length=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var o=i+l*this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.z,_=this.zpp_inner;return null!=_._validate&&_._validate(),Math.sqrt(o+s*this.zpp_inner.z)},cn.prototype.set_length=function(n){var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p=t*this.zpp_inner.x,l=this.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.y,o=this.zpp_inner;null!=o._validate&&o._validate();var a=p+r*this.zpp_inner.y,s=this.zpp_inner;null!=s._validate&&s._validate();var _=this.zpp_inner.z,h=this.zpp_inner;null!=h._validate&&h._validate();var u=n/Math.sqrt(a+_*this.zpp_inner.z),x=this.zpp_inner;null!=x._validate&&x._validate(),this.zpp_inner.x=this.zpp_inner.x*u;var d=this.zpp_inner;null!=d._validate&&d._validate();var y=this.zpp_inner;null!=y._validate&&y._validate(),this.zpp_inner.y=this.zpp_inner.y*u;var z=this.zpp_inner;null!=z._validate&&z._validate();var v=this.zpp_inner;null!=v._validate&&v._validate(),this.zpp_inner.z=this.zpp_inner.z*u;var c=this.zpp_inner;null!=c._validate&&c._validate();var f=this.zpp_inner;null!=f._validate&&f._validate();var m=this.zpp_inner.x,b=this.zpp_inner;null!=b._validate&&b._validate();var g=m*this.zpp_inner.x,w=this.zpp_inner;null!=w._validate&&w._validate();var M=this.zpp_inner.y,C=this.zpp_inner;null!=C._validate&&C._validate();var k=g+M*this.zpp_inner.y,O=this.zpp_inner;null!=O._validate&&O._validate();var P=this.zpp_inner.z,S=this.zpp_inner;return null!=S._validate&&S._validate(),Math.sqrt(k+P*this.zpp_inner.z)},cn.prototype.lsq=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e=this.zpp_inner.x,t=this.zpp_inner;null!=t._validate&&t._validate();var i=e*this.zpp_inner.x,p=this.zpp_inner;null!=p._validate&&p._validate();var l=this.zpp_inner.y,r=this.zpp_inner;null!=r._validate&&r._validate();var o=i+l*this.zpp_inner.y,a=this.zpp_inner;null!=a._validate&&a._validate();var s=this.zpp_inner.z,_=this.zpp_inner;return null!=_._validate&&_._validate(),o+s*this.zpp_inner.z},cn.prototype.set=function(n){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.y,l=n.zpp_inner;return null!=l._validate&&l._validate(),this.setxyz(t,p,n.zpp_inner.z)},cn.prototype.setxyz=function(n,e,t){this.zpp_inner.x=n;var i=this.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.y=e;var p=this.zpp_inner;null!=p._validate&&p._validate(),this.zpp_inner.z=t;var l=this.zpp_inner;return null!=l._validate&&l._validate(),this},cn.prototype.xy=function(n){null==n&&(n=!1);var e=this.zpp_inner;null!=e._validate&&e._validate();var t=this.zpp_inner.x,i=this.zpp_inner;null!=i._validate&&i._validate();var p,l=this.zpp_inner.y;if(null==xp.poolVec2?p=new yn:(p=xp.poolVec2,xp.poolVec2=p.zpp_pool,p.zpp_pool=null),null==p.zpp_inner){var r;null==xt.zpp_pool?r=new xt:(r=xt.zpp_pool,xt.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=t,r.y=l,p.zpp_inner=r,p.zpp_inner.outer=p}else{var o,a=p.zpp_inner;if(null!=a._validate&&a._validate(),p.zpp_inner.x==t){var s=p.zpp_inner;null!=s._validate&&s._validate(),o=p.zpp_inner.y==l}else o=!1;if(!o){p.zpp_inner.x=t,p.zpp_inner.y=l;var _=p.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}return p.zpp_inner.weak=n,p},cn.prototype.toString=function(){var n=this.zpp_inner;null!=n._validate&&n._validate();var e="{ x: "+this.zpp_inner.x+" y: ",t=this.zpp_inner;null!=t._validate&&t._validate();var i=e+this.zpp_inner.y+" z: ",p=this.zpp_inner;return null!=p._validate&&p._validate(),i+this.zpp_inner.z+" }"},Object.defineProperty(cn.prototype,"x",{get:cn.prototype.get_x,set:cn.prototype.set_x}),Object.defineProperty(cn.prototype,"y",{get:cn.prototype.get_y,set:cn.prototype.set_y}),Object.defineProperty(cn.prototype,"z",{get:cn.prototype.get_z,set:cn.prototype.set_z}),Object.defineProperty(cn.prototype,"length",{get:cn.prototype.get_length,set:cn.prototype.set_length}),cn.prototype.__class__=cn;var fn=nape.geom.Winding=function(){};fn.__name__=["nape","geom","Winding"],fn.UNDEFINED=null,fn.get_UNDEFINED=function(){return null==oe.Winding_UNDEFINED&&(oe.internal=!0,oe.Winding_UNDEFINED=new fn,oe.internal=!1),oe.Winding_UNDEFINED},fn.CLOCKWISE=null,fn.get_CLOCKWISE=function(){return null==oe.Winding_CLOCKWISE&&(oe.internal=!0,oe.Winding_CLOCKWISE=new fn,oe.internal=!1),oe.Winding_CLOCKWISE},fn.ANTICLOCKWISE=null,fn.get_ANTICLOCKWISE=function(){return null==oe.Winding_ANTICLOCKWISE&&(oe.internal=!0,oe.Winding_ANTICLOCKWISE=new fn,oe.internal=!1),oe.Winding_ANTICLOCKWISE},fn.prototype.toString=function(){return null==oe.Winding_UNDEFINED&&(oe.internal=!0,oe.Winding_UNDEFINED=new fn,oe.internal=!1),this==oe.Winding_UNDEFINED?"UNDEFINED":(null==oe.Winding_CLOCKWISE&&(oe.internal=!0,oe.Winding_CLOCKWISE=new fn,oe.internal=!1),this==oe.Winding_CLOCKWISE?"CLOCKWISE":(null==oe.Winding_ANTICLOCKWISE&&(oe.internal=!0,oe.Winding_ANTICLOCKWISE=new fn,oe.internal=!1),this==oe.Winding_ANTICLOCKWISE?"ANTICLOCKWISE":""))},Object.defineProperty(fn,"UNDEFINED",{get:fn.get_UNDEFINED}),Object.defineProperty(fn,"CLOCKWISE",{get:fn.get_CLOCKWISE}),Object.defineProperty(fn,"ANTICLOCKWISE",{get:fn.get_ANTICLOCKWISE}),fn.prototype.__class__=fn;var mn=nape.phys.Interactor=function(){this.zpp_inner_i=null};mn.__name__=["nape","phys","Interactor"],mn.prototype.zpp_inner_i=null,mn.prototype.get_id=function(){return this.zpp_inner_i.id},mn.prototype.get_userData=function(){return null==this.zpp_inner_i.userData&&(this.zpp_inner_i.userData={}),this.zpp_inner_i.userData},mn.prototype.isShape=function(){return null!=this.zpp_inner_i.ishape},mn.prototype.isBody=function(){return null!=this.zpp_inner_i.ibody},mn.prototype.isCompound=function(){return null!=this.zpp_inner_i.icompound},mn.prototype.get_castShape=function(){return null!=this.zpp_inner_i.ishape?this.zpp_inner_i.ishape.outer:null},mn.prototype.get_castBody=function(){return null!=this.zpp_inner_i.ibody?this.zpp_inner_i.ibody.outer:null},mn.prototype.get_castCompound=function(){return null!=this.zpp_inner_i.icompound?this.zpp_inner_i.icompound.outer:null},mn.prototype.get_group=function(){return null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},mn.prototype.set_group=function(n){return this.zpp_inner_i.immutable_midstep("Interactor::group"),this.zpp_inner_i.setGroup(null==n?null:n.zpp_inner),null==this.zpp_inner_i.group?null:this.zpp_inner_i.group.outer},mn.prototype.get_cbTypes=function(){return null==this.zpp_inner_i.wrap_cbTypes&&this.zpp_inner_i.setupcbTypes(),this.zpp_inner_i.wrap_cbTypes},mn.prototype.toString=function(){return""},Object.defineProperty(mn.prototype,"id",{get:mn.prototype.get_id}),Object.defineProperty(mn.prototype,"userData",{get:mn.prototype.get_userData}),Object.defineProperty(mn.prototype,"castShape",{get:mn.prototype.get_castShape}),Object.defineProperty(mn.prototype,"castBody",{get:mn.prototype.get_castBody}),Object.defineProperty(mn.prototype,"castCompound",{get:mn.prototype.get_castCompound}),Object.defineProperty(mn.prototype,"group",{get:mn.prototype.get_group,set:mn.prototype.set_group}),Object.defineProperty(mn.prototype,"cbTypes",{get:mn.prototype.get_cbTypes}),mn.prototype.__class__=mn;var bn=nape.phys.Body=function(n,e){if(this.debugDraw=!0,this.zpp_inner=null,mn.call(this),this.zpp_inner=new vt,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,null!=e){var t=e.zpp_inner;null!=t._validate&&t._validate(),this.zpp_inner.posx=e.zpp_inner.x;var i=e.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.posy=e.zpp_inner.y}else this.zpp_inner.posx=0,this.zpp_inner.posy=0;var p,l;(null==n?(null==oe.BodyType_DYNAMIC&&(oe.internal=!0,oe.BodyType_DYNAMIC=new Mn,oe.internal=!1),p=oe.BodyType_DYNAMIC):p=n,this.zpp_inner.immutable_midstep("Body::type"),vt.types[this.zpp_inner.type]!=p)&&(null==oe.BodyType_DYNAMIC&&(oe.internal=!0,oe.BodyType_DYNAMIC=new Mn,oe.internal=!1),p==oe.BodyType_DYNAMIC?l=2:(null==oe.BodyType_KINEMATIC&&(oe.internal=!0,oe.BodyType_KINEMATIC=new Mn,oe.internal=!1),l=p==oe.BodyType_KINEMATIC?3:1),1==l&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,l):this.zpp_inner.type=l);if(null!=e&&e.zpp_inner.weak){var r=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r}this.zpp_inner_i.insert_cbtype(re.ANY_BODY.zpp_inner)};bn.__name__=["nape","phys","Body"],bn.__super__=mn,bn.prototype=Object.create(mn.prototype),bn.prototype.zpp_inner=null,bn.prototype.debugDraw=null,bn.prototype.get_type=function(){return vt.types[this.zpp_inner.type]},bn.prototype.set_type=function(n){var e;(this.zpp_inner.immutable_midstep("Body::type"),vt.types[this.zpp_inner.type]!=n)&&(null==oe.BodyType_DYNAMIC&&(oe.internal=!0,oe.BodyType_DYNAMIC=new Mn,oe.internal=!1),n==oe.BodyType_DYNAMIC?e=2:(null==oe.BodyType_KINEMATIC&&(oe.internal=!0,oe.BodyType_KINEMATIC=new Mn,oe.internal=!1),e=n==oe.BodyType_KINEMATIC?3:1),1==e&&null!=this.zpp_inner.space&&(this.zpp_inner.velx=0,this.zpp_inner.vely=0,this.zpp_inner.angvel=0),this.zpp_inner.invalidate_type(),null!=this.zpp_inner.space?this.zpp_inner.space.transmitType(this.zpp_inner,e):this.zpp_inner.type=e);return vt.types[this.zpp_inner.type]},bn.prototype.get_isBullet=function(){return this.zpp_inner.bulletEnabled},bn.prototype.set_isBullet=function(n){return this.zpp_inner.bulletEnabled=n,this.zpp_inner.bulletEnabled},bn.prototype.get_disableCCD=function(){return this.zpp_inner.disableCCD},bn.prototype.set_disableCCD=function(n){return this.zpp_inner.disableCCD=n,this.zpp_inner.disableCCD},bn.prototype.integrate=function(n){if(this.zpp_inner.immutable_midstep("Body::space"),0==n)return this;var e=this.zpp_inner;e.sweepTime=0,e.sweep_angvel=e.angvel;var t=n-e.sweepTime;if(0!=t&&(e.sweepTime=n,e.posx+=e.velx*t,e.posy+=e.vely*t,0!=e.angvel)){var i=e.sweep_angvel*t;if(e.rot+=i,i*i>1e-4)e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot);else{var p=i*i,l=1-.5*p,r=1-p*p/8,o=(l*e.axisx+i*e.axisy)*r;e.axisy=(l*e.axisy-i*e.axisx)*r,e.axisx=o}}for(var a=e.shapes.head;null!=a;){var s=a.elt;1==s.type&&(s.polygon.invalidate_gverts(),s.polygon.invalidate_gaxi()),s.invalidate_worldCOM(),a=a.next}e.zip_worldCOM=!0,e.zip_axis=!0;for(var _=e.shapes.head;null!=_;){var h=_.elt;1==h.type&&(h.polygon.invalidate_gverts(),h.polygon.invalidate_gaxi()),h.invalidate_worldCOM(),_=_.next}return e.zip_worldCOM=!0,e.sweepTime=0,this},bn.prototype.isStatic=function(){return 1==this.zpp_inner.type},bn.prototype.isDynamic=function(){return 2==this.zpp_inner.type},bn.prototype.isKinematic=function(){return 3==this.zpp_inner.type},bn.prototype.get_shapes=function(){return this.zpp_inner.wrap_shapes},bn.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},bn.prototype.set_compound=function(n){if((null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(this),null!=n)){var e=n.zpp_inner.wrap_bodies;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},bn.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},bn.prototype.set_space=function(n){if(this.zpp_inner.immutable_midstep("Body::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(this.zpp_inner.component.woken=!1),null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_bodies.remove(this),null!=n)){var e=n.zpp_inner.wrap_bodies;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},bn.prototype.get_arbiters=function(){return null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0)),this.zpp_inner.wrap_arbiters},bn.prototype.get_isSleeping=function(){return this.zpp_inner.component.sleeping},bn.prototype.get_constraints=function(){return null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=Hi.get(this.zpp_inner.constraints,!0)),this.zpp_inner.wrap_constraints},bn.prototype.copy=function(){return this.zpp_inner.copy()},bn.prototype.get_position=function(){return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},bn.prototype.set_position=function(n){null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var e=this.zpp_inner.wrap_pos,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos},bn.prototype.get_velocity=function(){return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},bn.prototype.set_velocity=function(n){null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var e=this.zpp_inner.wrap_vel,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity(),this.zpp_inner.wrap_vel},bn.prototype.setVelocityFromTarget=function(n,e,t){var i=1/t;null==this.zpp_inner.wrap_vel&&this.zpp_inner.setupVelocity();var p=this.zpp_inner.wrap_vel;null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var l=n.sub(this.zpp_inner.wrap_pos,!0).muleq(i),r=l.zpp_inner;null!=r._validate&&r._validate();var o=l.zpp_inner.x,a=l.zpp_inner;null!=a._validate&&a._validate();var s,_=l.zpp_inner.y,h=p.zpp_inner;if(null!=h._validate&&h._validate(),p.zpp_inner.x==o){var u=p.zpp_inner;null!=u._validate&&u._validate(),s=p.zpp_inner.y==_}else s=!1;if(!s){p.zpp_inner.x=o,p.zpp_inner.y=_;var x=p.zpp_inner;null!=x._invalidate&&x._invalidate(x)}if(l.zpp_inner.weak){var d=l.zpp_inner;l.zpp_inner.outer=null,l.zpp_inner=null,l.zpp_pool=xp.poolVec2,xp.poolVec2=l,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=xt.zpp_pool,xt.zpp_pool=d}var y=(e-this.zpp_inner.rot)*i;if(this.zpp_inner.angvel!=y&&(this.zpp_inner.angvel=y,this.zpp_inner.wake()),n.zpp_inner.weak){var z=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=xt.zpp_pool,xt.zpp_pool=z}return this},bn.prototype.get_kinematicVel=function(){return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},bn.prototype.set_kinematicVel=function(n){null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel();var e=this.zpp_inner.wrap_kinvel,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.wrap_kinvel&&this.zpp_inner.setupkinvel(),this.zpp_inner.wrap_kinvel},bn.prototype.get_surfaceVel=function(){return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},bn.prototype.set_surfaceVel=function(n){null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel();var e=this.zpp_inner.wrap_svel,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.wrap_svel&&this.zpp_inner.setupsvel(),this.zpp_inner.wrap_svel},bn.prototype.get_force=function(){return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},bn.prototype.set_force=function(n){null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce();var e=this.zpp_inner.wrap_force,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.wrap_force&&this.zpp_inner.setupForce(),this.zpp_inner.wrap_force},bn.prototype.get_constraintVelocity=function(){return null==this.zpp_inner.wrapcvel&&this.zpp_inner.setup_cvel(),this.zpp_inner.wrapcvel},bn.prototype.get_rotation=function(){return this.zpp_inner.rot},bn.prototype.set_rotation=function(n){if(this.zpp_inner.immutable_midstep("Body::rotation"),this.zpp_inner.rot!=n){this.zpp_inner.rot=n;var e=this.zpp_inner;e.zip_axis=!0;for(var t=e.shapes.head;null!=t;){var i=t.elt;1==i.type&&(i.polygon.invalidate_gverts(),i.polygon.invalidate_gaxi()),i.invalidate_worldCOM(),t=t.next}e.zip_worldCOM=!0,this.zpp_inner.wake()}return this.zpp_inner.rot},bn.prototype.get_angularVel=function(){return this.zpp_inner.angvel},bn.prototype.set_angularVel=function(n){return this.zpp_inner.angvel!=n&&(this.zpp_inner.angvel=n,this.zpp_inner.wake()),this.zpp_inner.angvel},bn.prototype.get_kinAngVel=function(){return this.zpp_inner.kinangvel},bn.prototype.set_kinAngVel=function(n){return this.zpp_inner.kinangvel!=n&&(this.zpp_inner.kinangvel=n,this.zpp_inner.wake()),this.zpp_inner.kinangvel},bn.prototype.get_torque=function(){return this.zpp_inner.torque},bn.prototype.set_torque=function(n){return this.zpp_inner.torque!=n&&(this.zpp_inner.torque=n,this.zpp_inner.wake()),this.zpp_inner.torque},bn.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},bn.prototype.get_allowMovement=function(){return!this.zpp_inner.nomove},bn.prototype.set_allowMovement=function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.nomove!=n&&(this.zpp_inner.nomove=!n,this.zpp_inner.invalidate_mass()),!this.zpp_inner.nomove},bn.prototype.get_allowRotation=function(){return!this.zpp_inner.norotate},bn.prototype.set_allowRotation=function(n){return this.zpp_inner.immutable_midstep("Body::"+(null==n?"null":""+n)),!this.zpp_inner.norotate!=n&&(this.zpp_inner.norotate=!n,this.zpp_inner.invalidate_inertia()),!this.zpp_inner.norotate},bn.prototype.get_massMode=function(){null==oe.MassMode_DEFAULT&&(oe.internal=!0,oe.MassMode_DEFAULT=new In,oe.internal=!1);var n=oe.MassMode_DEFAULT;return null==oe.MassMode_FIXED&&(oe.internal=!0,oe.MassMode_FIXED=new In,oe.internal=!1),[n,oe.MassMode_FIXED][this.zpp_inner.massMode]},bn.prototype.set_massMode=function(n){var e;this.zpp_inner.immutable_midstep("Body::massMode"),null==oe.MassMode_DEFAULT&&(oe.internal=!0,oe.MassMode_DEFAULT=new In,oe.internal=!1),e=n==oe.MassMode_DEFAULT?0:1,this.zpp_inner.massMode=e,this.zpp_inner.invalidate_mass(),null==oe.MassMode_DEFAULT&&(oe.internal=!0,oe.MassMode_DEFAULT=new In,oe.internal=!1);var t=oe.MassMode_DEFAULT;return null==oe.MassMode_FIXED&&(oe.internal=!0,oe.MassMode_FIXED=new In,oe.internal=!1),[t,oe.MassMode_FIXED][this.zpp_inner.massMode]},bn.prototype.get_constraintMass=function(){return this.zpp_inner.world||this.zpp_inner.validate_mass(),this.zpp_inner.smass},bn.prototype.get_mass=function(){return this.zpp_inner.validate_mass(),this.zpp_inner.cmass},bn.prototype.set_mass=function(n){return this.zpp_inner.immutable_midstep("Body::mass"),this.zpp_inner.massMode=1,this.zpp_inner.cmass=n,this.zpp_inner.invalidate_mass(),this.zpp_inner.validate_mass(),this.zpp_inner.cmass},bn.prototype.get_gravMassMode=function(){null==oe.GravMassMode_DEFAULT&&(oe.internal=!0,oe.GravMassMode_DEFAULT=new Sn,oe.internal=!1);var n=oe.GravMassMode_DEFAULT;null==oe.GravMassMode_FIXED&&(oe.internal=!0,oe.GravMassMode_FIXED=new Sn,oe.internal=!1);var e=oe.GravMassMode_FIXED;return null==oe.GravMassMode_SCALED&&(oe.internal=!0,oe.GravMassMode_SCALED=new Sn,oe.internal=!1),[n,e,oe.GravMassMode_SCALED][this.zpp_inner.massMode]},bn.prototype.set_gravMassMode=function(n){var e;this.zpp_inner.immutable_midstep("Body::gravMassMode"),null==oe.GravMassMode_SCALED&&(oe.internal=!0,oe.GravMassMode_SCALED=new Sn,oe.internal=!1),n==oe.GravMassMode_SCALED?e=2:(null==oe.GravMassMode_DEFAULT&&(oe.internal=!0,oe.GravMassMode_DEFAULT=new Sn,oe.internal=!1),e=n==oe.GravMassMode_DEFAULT?0:1),this.zpp_inner.gravMassMode=e,this.zpp_inner.invalidate_gravMass(),null==oe.GravMassMode_DEFAULT&&(oe.internal=!0,oe.GravMassMode_DEFAULT=new Sn,oe.internal=!1);var t=oe.GravMassMode_DEFAULT;null==oe.GravMassMode_FIXED&&(oe.internal=!0,oe.GravMassMode_FIXED=new Sn,oe.internal=!1);var i=oe.GravMassMode_FIXED;return null==oe.GravMassMode_SCALED&&(oe.internal=!0,oe.GravMassMode_SCALED=new Sn,oe.internal=!1),[t,i,oe.GravMassMode_SCALED][this.zpp_inner.massMode]},bn.prototype.get_gravMass=function(){return this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},bn.prototype.set_gravMass=function(n){return this.zpp_inner.immutable_midstep("Body::gravMass"),this.zpp_inner.gravMassMode=1,this.zpp_inner.gravMass=n,this.zpp_inner.invalidate_gravMass(),this.zpp_inner.validate_gravMass(),this.zpp_inner.gravMass},bn.prototype.get_gravMassScale=function(){return this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},bn.prototype.set_gravMassScale=function(n){return this.zpp_inner.immutable_midstep("Body::gravMassScale"),this.zpp_inner.gravMassMode=2,this.zpp_inner.gravMassScale=n,this.zpp_inner.invalidate_gravMassScale(),this.zpp_inner.validate_gravMassScale(),this.zpp_inner.gravMassScale},bn.prototype.get_inertiaMode=function(){null==oe.InertiaMode_DEFAULT&&(oe.internal=!0,oe.InertiaMode_DEFAULT=new An,oe.internal=!1);var n=oe.InertiaMode_DEFAULT;return null==oe.InertiaMode_FIXED&&(oe.internal=!0,oe.InertiaMode_FIXED=new An,oe.internal=!1),[n,oe.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},bn.prototype.set_inertiaMode=function(n){var e;this.zpp_inner.immutable_midstep("Body::inertiaMode"),null==oe.InertiaMode_FIXED&&(oe.internal=!0,oe.InertiaMode_FIXED=new An,oe.internal=!1),e=n==oe.InertiaMode_FIXED?1:0,this.zpp_inner.inertiaMode=e,this.zpp_inner.invalidate_inertia(),null==oe.InertiaMode_DEFAULT&&(oe.internal=!0,oe.InertiaMode_DEFAULT=new An,oe.internal=!1);var t=oe.InertiaMode_DEFAULT;return null==oe.InertiaMode_FIXED&&(oe.internal=!0,oe.InertiaMode_FIXED=new An,oe.internal=!1),[t,oe.InertiaMode_FIXED][this.zpp_inner.inertiaMode]},bn.prototype.get_constraintInertia=function(){return this.zpp_inner.world||this.zpp_inner.validate_inertia(),this.zpp_inner.sinertia},bn.prototype.get_inertia=function(){return this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},bn.prototype.set_inertia=function(n){return this.zpp_inner.immutable_midstep("Body::inertia"),this.zpp_inner.inertiaMode=1,this.zpp_inner.cinertia=n,this.zpp_inner.invalidate_inertia(),this.zpp_inner.validate_inertia(),this.zpp_inner.cinertia},bn.prototype.connectedBodies=function(n,e){return null==n&&(n=-1),this.zpp_inner.connectedBodies(n,e)},bn.prototype.interactingBodies=function(n,e,t){var i;return null==e&&(e=-1),null==n?i=Ce.COL|Ce.SENSOR|Ce.FLUID:(null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),n==oe.InteractionType_COLLISION?i=Ce.COL:(null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),i=n==oe.InteractionType_SENSOR?Ce.SENSOR:Ce.FLUID)),this.zpp_inner.interactingBodies(i,e,t)},bn.prototype.crushFactor=function(){var n,e=0;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var t;null==xt.zpp_pool?t=new xt:(t=xt.zpp_pool,xt.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n}else{var i,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var l=n.zpp_inner;null!=l._validate&&l._validate(),i=0==n.zpp_inner.y}else i=!1;if(!i){n.zpp_inner.x=0,n.zpp_inner.y=0;var r=n.zpp_inner;null!=r._invalidate&&r._invalidate(r)}}n.zpp_inner.weak=!1;var o=n;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var a=this.zpp_inner.wrap_arbiters.iterator();;){a.zpp_inner.zpp_inner.valmod();var s,_=a.zpp_inner.zpp_gl();if(a.zpp_critical=!0,a.zpp_i<_?s=!0:(a.zpp_next=R.zpp_pool,R.zpp_pool=a,a.zpp_inner=null,s=!1),!s)break;a.zpp_critical=!1;var h=a.zpp_inner.at(a.zpp_i++).totalImpulse(this),u=h.xy();o.addeq(u);var x=u.zpp_inner;null!=x._validate&&x._validate();var d=u.zpp_inner.x,y=u.zpp_inner;null!=y._validate&&y._validate();var z=d*u.zpp_inner.x,v=u.zpp_inner;null!=v._validate&&v._validate();var c=u.zpp_inner.y,f=u.zpp_inner;null!=f._validate&&f._validate(),e+=Math.sqrt(z+c*u.zpp_inner.y);var m=u.zpp_inner;u.zpp_inner.outer=null,u.zpp_inner=null,u.zpp_pool=xp.poolVec2,xp.poolVec2=u,null!=m.outer&&(m.outer.zpp_inner=null,m.outer=null),m._isimmutable=null,m._validate=null,m._invalidate=null,m.next=xt.zpp_pool,xt.zpp_pool=m,h.dispose()}null==this.zpp_inner.wrap_constraints&&(this.zpp_inner.wrap_constraints=Hi.get(this.zpp_inner.constraints,!0));var b=this.zpp_inner.wrap_constraints;b.zpp_inner.valmod();for(var g=A.get(b);;){g.zpp_inner.zpp_inner.valmod();var w=g.zpp_inner;w.zpp_inner.valmod(),w.zpp_inner.zip_length&&(w.zpp_inner.zip_length=!1,w.zpp_inner.user_length=w.zpp_inner.inner.length);var M,C=w.zpp_inner.user_length;if(g.zpp_critical=!0,g.zpp_i<C?M=!0:(g.zpp_next=A.zpp_pool,A.zpp_pool=g,g.zpp_inner=null,M=!1),!M)break;g.zpp_critical=!1;var k=g.zpp_inner.at(g.zpp_i++).bodyImpulse(this),O=k.xy();o.addeq(O);var P=O.zpp_inner;null!=P._validate&&P._validate();var S=O.zpp_inner.x,j=O.zpp_inner;null!=j._validate&&j._validate();var E=S*O.zpp_inner.x,I=O.zpp_inner;null!=I._validate&&I._validate();var T=O.zpp_inner.y,N=O.zpp_inner;null!=N._validate&&N._validate(),e+=Math.sqrt(E+T*O.zpp_inner.y);var L=O.zpp_inner;O.zpp_inner.outer=null,O.zpp_inner=null,O.zpp_pool=xp.poolVec2,xp.poolVec2=O,null!=L.outer&&(L.outer.zpp_inner=null,L.outer=null),L._isimmutable=null,L._validate=null,L._invalidate=null,L.next=xt.zpp_pool,xt.zpp_pool=L,k.dispose()}var V=o.zpp_inner;null!=V._validate&&V._validate();var D=o.zpp_inner.x,F=o.zpp_inner;null!=F._validate&&F._validate();var Z=D*o.zpp_inner.x,B=o.zpp_inner;null!=B._validate&&B._validate();var G=o.zpp_inner.y,q=o.zpp_inner;null!=q._validate&&q._validate();var U=e-Math.sqrt(Z+G*o.zpp_inner.y);this.zpp_inner.validate_mass();var K=U/(this.zpp_inner.cmass*(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.pre_dt),W=o.zpp_inner;return o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=xp.poolVec2,xp.poolVec2=o,null!=W.outer&&(W.outer.zpp_inner=null,W.outer=null),W._isimmutable=null,W._validate=null,W._invalidate=null,W.next=xt.zpp_pool,xt.zpp_pool=W,K},bn.prototype.localPointToWorld=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i,p,l=n.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.axisy*n.zpp_inner.x,o=n.zpp_inner;null!=o._validate&&o._validate(),i=r-this.zpp_inner.axisx*n.zpp_inner.y;var a=n.zpp_inner;null!=a._validate&&a._validate();var s=n.zpp_inner.x*this.zpp_inner.axisx,_=n.zpp_inner;if(null!=_._validate&&_._validate(),p=s+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak){var h=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=xt.zpp_pool,xt.zpp_pool=h}var u,x=i+this.zpp_inner.posx,d=p+this.zpp_inner.posy;if(null==xp.poolVec2?u=new yn:(u=xp.poolVec2,xp.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner){var y;null==xt.zpp_pool?y=new xt:(y=xt.zpp_pool,xt.zpp_pool=y.next,y.next=null),y.weak=!1,y._immutable=!1,y.x=x,y.y=d,u.zpp_inner=y,u.zpp_inner.outer=u}else{var z,v=u.zpp_inner;if(null!=v._validate&&v._validate(),u.zpp_inner.x==x){var c=u.zpp_inner;null!=c._validate&&c._validate(),z=u.zpp_inner.y==d}else z=!1;if(!z){u.zpp_inner.x=x,u.zpp_inner.y=d;var f=u.zpp_inner;null!=f._invalidate&&f._invalidate(f)}}return u.zpp_inner.weak=e,u},bn.prototype.worldPointToLocal=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i,p,l,r,o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.x-this.zpp_inner.posx;var a,s=n.zpp_inner;if(null!=s._validate&&s._validate(),r=n.zpp_inner.y-this.zpp_inner.posy,i=l*this.zpp_inner.axisy+r*this.zpp_inner.axisx,p=r*this.zpp_inner.axisy-l*this.zpp_inner.axisx,n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}if(null==xp.poolVec2?a=new yn:(a=xp.poolVec2,xp.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner){var h;null==xt.zpp_pool?h=new xt:(h=xt.zpp_pool,xt.zpp_pool=h.next,h.next=null),h.weak=!1,h._immutable=!1,h.x=i,h.y=p,a.zpp_inner=h,a.zpp_inner.outer=a}else{var u,x=a.zpp_inner;if(null!=x._validate&&x._validate(),a.zpp_inner.x==i){var d=a.zpp_inner;null!=d._validate&&d._validate(),u=a.zpp_inner.y==p}else u=!1;if(!u){a.zpp_inner.x=i,a.zpp_inner.y=p;var y=a.zpp_inner;null!=y._invalidate&&y._invalidate(y)}}return a.zpp_inner.weak=e,a},bn.prototype.localVectorToWorld=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i,p,l=n.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.axisy*n.zpp_inner.x,o=n.zpp_inner;null!=o._validate&&o._validate(),i=r-this.zpp_inner.axisx*n.zpp_inner.y;var a=n.zpp_inner;null!=a._validate&&a._validate();var s,_=n.zpp_inner.x*this.zpp_inner.axisx,h=n.zpp_inner;if(null!=h._validate&&h._validate(),p=_+n.zpp_inner.y*this.zpp_inner.axisy,n.zpp_inner.weak){var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u}if(null==xp.poolVec2?s=new yn:(s=xp.poolVec2,xp.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner){var x;null==xt.zpp_pool?x=new xt:(x=xt.zpp_pool,xt.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=i,x.y=p,s.zpp_inner=x,s.zpp_inner.outer=s}else{var d,y=s.zpp_inner;if(null!=y._validate&&y._validate(),s.zpp_inner.x==i){var z=s.zpp_inner;null!=z._validate&&z._validate(),d=s.zpp_inner.y==p}else d=!1;if(!d){s.zpp_inner.x=i,s.zpp_inner.y=p;var v=s.zpp_inner;null!=v._invalidate&&v._invalidate(v)}}return s.zpp_inner.weak=e,s},bn.prototype.worldVectorToLocal=function(n,e){null==e&&(e=!1);var t=this.zpp_inner;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));var i,p,l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x*this.zpp_inner.axisy,o=n.zpp_inner;null!=o._validate&&o._validate(),i=r+n.zpp_inner.y*this.zpp_inner.axisx;var a=n.zpp_inner;null!=a._validate&&a._validate();var s,_=n.zpp_inner.y*this.zpp_inner.axisy,h=n.zpp_inner;if(null!=h._validate&&h._validate(),p=_-n.zpp_inner.x*this.zpp_inner.axisx,n.zpp_inner.weak){var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u}if(null==xp.poolVec2?s=new yn:(s=xp.poolVec2,xp.poolVec2=s.zpp_pool,s.zpp_pool=null),null==s.zpp_inner){var x;null==xt.zpp_pool?x=new xt:(x=xt.zpp_pool,xt.zpp_pool=x.next,x.next=null),x.weak=!1,x._immutable=!1,x.x=i,x.y=p,s.zpp_inner=x,s.zpp_inner.outer=s}else{var d,y=s.zpp_inner;if(null!=y._validate&&y._validate(),s.zpp_inner.x==i){var z=s.zpp_inner;null!=z._validate&&z._validate(),d=s.zpp_inner.y==p}else d=!1;if(!d){s.zpp_inner.x=i,s.zpp_inner.y=p;var v=s.zpp_inner;null!=v._invalidate&&v._invalidate(v)}}return s.zpp_inner.weak=e,s},bn.prototype.applyImpulse=function(n,e,t){if(null==t&&(t=!1),t&&this.zpp_inner.component.sleeping){if(n.zpp_inner.weak){var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=xt.zpp_pool,xt.zpp_pool=i}if(null!=e&&e.zpp_inner.weak){var p=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p}return this}this.zpp_inner.validate_mass();var l=this.zpp_inner.imass,r=n.zpp_inner;null!=r._validate&&r._validate(),this.zpp_inner.velx+=n.zpp_inner.x*l;var o=n.zpp_inner;if(null!=o._validate&&o._validate(),this.zpp_inner.vely+=n.zpp_inner.y*l,null!=e){var a,s,_=e.zpp_inner;null!=_._validate&&_._validate(),a=e.zpp_inner.x-this.zpp_inner.posx;var h=e.zpp_inner;null!=h._validate&&h._validate(),s=e.zpp_inner.y-this.zpp_inner.posy,this.zpp_inner.validate_inertia();var u=n.zpp_inner;null!=u._validate&&u._validate();var x=n.zpp_inner.y*a,d=n.zpp_inner;if(null!=d._validate&&d._validate(),this.zpp_inner.angvel+=(x-n.zpp_inner.x*s)*this.zpp_inner.iinertia,e.zpp_inner.weak){var y=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=xt.zpp_pool,xt.zpp_pool=y}}if(t||2==this.zpp_inner.type&&this.zpp_inner.wake(),n.zpp_inner.weak){var z=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=xt.zpp_pool,xt.zpp_pool=z}return this},bn.prototype.applyAngularImpulse=function(n,e){return null==e&&(e=!1),e&&this.zpp_inner.component.sleeping?this:(this.zpp_inner.validate_inertia(),this.zpp_inner.angvel+=n*this.zpp_inner.iinertia,e||2==this.zpp_inner.type&&this.zpp_inner.wake(),this)},bn.prototype.translateShapes=function(n){this.zpp_inner.immutable_midstep("Body::translateShapes()");var e=n.zpp_inner.weak;n.zpp_inner.weak=!1;for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.translate(n),t=t.next;if(n.zpp_inner.weak=e,n.zpp_inner.weak){var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=xt.zpp_pool,xt.zpp_pool=i}return this},bn.prototype.rotateShapes=function(n){this.zpp_inner.immutable_midstep("Body::rotateShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;)e.elt.outer.rotate(n),e=e.next;return this},bn.prototype.scaleShapes=function(n,e){this.zpp_inner.immutable_midstep("Body::scaleShapes()");for(var t=this.zpp_inner.shapes.head;null!=t;)t.elt.outer.scale(n,e),t=t.next;return this},bn.prototype.transformShapes=function(n){this.zpp_inner.immutable_midstep("Body::transformShapes()");for(var e=this.zpp_inner.shapes.head;null!=e;)e.elt.outer.transform(n),e=e.next;return this},bn.prototype.align=function(){this.zpp_inner.immutable_midstep("Body::align()"),this.zpp_inner.validate_localCOM();var n,e=-this.zpp_inner.localCOMx,t=-this.zpp_inner.localCOMy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var i;null==xt.zpp_pool?i=new xt:(i=xt.zpp_pool,xt.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=e,i.y=t,n.zpp_inner=i,n.zpp_inner.outer=n}else{var p,l=n.zpp_inner;if(null!=l._validate&&l._validate(),n.zpp_inner.x==e){var r=n.zpp_inner;null!=r._validate&&r._validate(),p=n.zpp_inner.y==t}else p=!1;if(!p){n.zpp_inner.x=e,n.zpp_inner.y=t;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}n.zpp_inner.weak=!1;var a=n;this.translateShapes(a);var s=this.localVectorToWorld(a);if(null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition(),this.zpp_inner.wrap_pos.subeq(s),this.zpp_inner.pre_posx<1/0){var _=s.zpp_inner;null!=_._validate&&_._validate(),this.zpp_inner.pre_posx-=s.zpp_inner.x;var h=s.zpp_inner;null!=h._validate&&h._validate(),this.zpp_inner.pre_posy-=s.zpp_inner.y}var u=a.zpp_inner;a.zpp_inner.outer=null,a.zpp_inner=null,a.zpp_pool=xp.poolVec2,xp.poolVec2=a,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u;var x=s.zpp_inner;return s.zpp_inner.outer=null,s.zpp_inner=null,s.zpp_pool=xp.poolVec2,xp.poolVec2=s,null!=x.outer&&(x.outer.zpp_inner=null,x.outer=null),x._isimmutable=null,x._validate=null,x._invalidate=null,x.next=xt.zpp_pool,xt.zpp_pool=x,this},bn.prototype.rotate=function(n,e){var t=n.zpp_inner.weak;n.zpp_inner.weak=!1,null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var i=this.zpp_inner.wrap_pos.sub(n);i.rotate(e);var p=n.add(i,!0);null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var l=this.zpp_inner.wrap_pos,r=p.zpp_inner;null!=r._validate&&r._validate();var o=p.zpp_inner.x,a=p.zpp_inner;null!=a._validate&&a._validate();var s,_=p.zpp_inner.y,h=l.zpp_inner;if(null!=h._validate&&h._validate(),l.zpp_inner.x==o){var u=l.zpp_inner;null!=u._validate&&u._validate(),s=l.zpp_inner.y==_}else s=!1;if(!s){l.zpp_inner.x=o,l.zpp_inner.y=_;var x=l.zpp_inner;null!=x._invalidate&&x._invalidate(x)}if(p.zpp_inner.weak){var d=p.zpp_inner;p.zpp_inner.outer=null,p.zpp_inner=null,p.zpp_pool=xp.poolVec2,xp.poolVec2=p,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=xt.zpp_pool,xt.zpp_pool=d}null==this.zpp_inner.wrap_pos&&this.zpp_inner.setupPosition();var y=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=y.outer&&(y.outer.zpp_inner=null,y.outer=null),y._isimmutable=null,y._validate=null,y._invalidate=null,y.next=xt.zpp_pool,xt.zpp_pool=y;var z=this,v=z.zpp_inner.rot+e;if(z.zpp_inner.immutable_midstep("Body::rotation"),z.zpp_inner.rot!=v){z.zpp_inner.rot=v;var c=z.zpp_inner;c.zip_axis=!0;for(var f=c.shapes.head;null!=f;){var m=f.elt;1==m.type&&(m.polygon.invalidate_gverts(),m.polygon.invalidate_gaxi()),m.invalidate_worldCOM(),f=f.next}c.zip_worldCOM=!0,z.zpp_inner.wake()}if(n.zpp_inner.weak=t,n.zpp_inner.weak){var b=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=b.outer&&(b.outer.zpp_inner=null,b.outer=null),b._isimmutable=null,b._validate=null,b._invalidate=null,b.next=xt.zpp_pool,xt.zpp_pool=b}return this},bn.prototype.setShapeMaterials=function(n){this.zpp_inner.immutable_midstep("Body::setShapeMaterials()");for(var e=this.zpp_inner.shapes.head;null!=e;){var t=e.elt.outer;t.zpp_inner.immutable_midstep("Shape::material"),t.zpp_inner.setMaterial(n.zpp_inner),t.zpp_inner.material.wrapper(),e=e.next}return this},bn.prototype.setShapeFilters=function(n){this.zpp_inner.immutable_midstep("Body::setShapeFilters()");for(var e=this.zpp_inner.shapes.head;null!=e;){var t=e.elt.outer;t.zpp_inner.immutable_midstep("Shape::filter"),t.zpp_inner.setFilter(n.zpp_inner),t.zpp_inner.filter.wrapper(),e=e.next}return this},bn.prototype.setShapeFluidProperties=function(n){this.zpp_inner.immutable_midstep("Body::setShapeFluidProperties()");for(var e=this.zpp_inner.shapes.head;null!=e;){var t=e.elt.outer;t.zpp_inner.setFluid(n.zpp_inner),t.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==t.zpp_inner.fluidProperties&&t.zpp_inner.setFluid((new Pn).zpp_inner),t.zpp_inner.fluidProperties.wrapper(),e=e.next}return this},bn.prototype.get_localCOM=function(){if(null==this.zpp_inner.wrap_localCOM){var t,i=this.zpp_inner.localCOMx,p=this.zpp_inner.localCOMy;if(null==xp.poolVec2?t=new yn:(t=xp.poolVec2,xp.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner){var l;null==xt.zpp_pool?l=new xt:(l=xt.zpp_pool,xt.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=i,l.y=p,t.zpp_inner=l,t.zpp_inner.outer=t}else{var r,o=t.zpp_inner;if(null!=o._validate&&o._validate(),t.zpp_inner.x==i){var a=t.zpp_inner;null!=a._validate&&a._validate(),r=t.zpp_inner.y==p}else r=!1;if(!r){t.zpp_inner.x=i,t.zpp_inner.y=p;var s=t.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}t.zpp_inner.weak=!1,this.zpp_inner.wrap_localCOM=t,this.zpp_inner.wrap_localCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_localCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_localCOM.zpp_inner._validate=e(n=this.zpp_inner,n.getlocalCOM)}return this.zpp_inner.wrap_localCOM},bn.prototype.get_worldCOM=function(){if(null==this.zpp_inner.wrap_worldCOM){var t,i=this.zpp_inner.worldCOMx,p=this.zpp_inner.worldCOMy;if(null==xp.poolVec2?t=new yn:(t=xp.poolVec2,xp.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner){var l;null==xt.zpp_pool?l=new xt:(l=xt.zpp_pool,xt.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=i,l.y=p,t.zpp_inner=l,t.zpp_inner.outer=t}else{var r,o=t.zpp_inner;if(null!=o._validate&&o._validate(),t.zpp_inner.x==i){var a=t.zpp_inner;null!=a._validate&&a._validate(),r=t.zpp_inner.y==p}else r=!1;if(!r){t.zpp_inner.x=i,t.zpp_inner.y=p;var s=t.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}t.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=t,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=e(n=this.zpp_inner,n.getworldCOM)}return this.zpp_inner.wrap_worldCOM},bn.prototype.normalImpulse=function(n,e){null==e&&(e=!1);var t=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r,o=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<o?r=!0:(l.zpp_next=R.zpp_pool,R.zpp_pool=l,l.zpp_inner=null,r=!1),!r)break;l.zpp_critical=!1;var a=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(a.type==Ce.COL&&(null==n||a.b2==n.zpp_inner||a.b1==n.zpp_inner)){var s=a.wrapper(),_=(s.zpp_inner.type==Ce.COL?s.zpp_inner.colarb.outer_zn:null).normalImpulse(this,e),h=_.zpp_inner;null!=h._validate&&h._validate(),t+=_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),p+=_.zpp_inner.z,_.dispose()}}return cn.get(t,i,p)},bn.prototype.tangentImpulse=function(n,e){null==e&&(e=!1);var t=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r,o=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<o?r=!0:(l.zpp_next=R.zpp_pool,R.zpp_pool=l,l.zpp_inner=null,r=!1),!r)break;l.zpp_critical=!1;var a=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(a.type==Ce.COL&&(null==n||a.b2==n.zpp_inner||a.b1==n.zpp_inner)){var s=a.wrapper(),_=(s.zpp_inner.type==Ce.COL?s.zpp_inner.colarb.outer_zn:null).tangentImpulse(this,e),h=_.zpp_inner;null!=h._validate&&h._validate(),t+=_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),p+=_.zpp_inner.z,_.dispose()}}return cn.get(t,i,p)},bn.prototype.totalContactsImpulse=function(n,e){null==e&&(e=!1);var t=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r,o=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<o?r=!0:(l.zpp_next=R.zpp_pool,R.zpp_pool=l,l.zpp_inner=null,r=!1),!r)break;l.zpp_critical=!1;var a=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(a.type==Ce.COL&&(null==n||a.b2==n.zpp_inner||a.b1==n.zpp_inner)){var s=a.wrapper(),_=(s.zpp_inner.type==Ce.COL?s.zpp_inner.colarb.outer_zn:null).totalImpulse(this,e),h=_.zpp_inner;null!=h._validate&&h._validate(),t+=_.zpp_inner.x;var u=_.zpp_inner;null!=u._validate&&u._validate(),i+=_.zpp_inner.y;var x=_.zpp_inner;null!=x._validate&&x._validate(),p+=_.zpp_inner.z,_.dispose()}}return cn.get(t,i,p)},bn.prototype.rollingImpulse=function(n,e){null==e&&(e=!1);var t=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var i=this.zpp_inner.wrap_arbiters.iterator();;){i.zpp_inner.zpp_inner.valmod();var p,l=i.zpp_inner.zpp_gl();if(i.zpp_critical=!0,i.zpp_i<l?p=!0:(i.zpp_next=R.zpp_pool,R.zpp_pool=i,i.zpp_inner=null,p=!1),!p)break;i.zpp_critical=!1;var r=i.zpp_inner.at(i.zpp_i++).zpp_inner;if(r.type==Ce.COL&&(null==n||r.b2==n.zpp_inner||r.b1==n.zpp_inner)){var o=r.wrapper();t+=(o.zpp_inner.type==Ce.COL?o.zpp_inner.colarb.outer_zn:null).rollingImpulse(this,e)}}return t},bn.prototype.buoyancyImpulse=function(n){var e=0,t=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l,r=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,p.zpp_i<r?l=!0:(p.zpp_next=R.zpp_pool,R.zpp_pool=p,p.zpp_inner=null,l=!1),!l)break;p.zpp_critical=!1;var o=p.zpp_inner.at(p.zpp_i++).zpp_inner;if(o.type==Ce.FLUID&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var a=o.wrapper(),s=(a.zpp_inner.type==Ce.FLUID?a.zpp_inner.fluidarb.outer_zn:null).buoyancyImpulse(this),_=s.zpp_inner;null!=_._validate&&_._validate(),e+=s.zpp_inner.x;var h=s.zpp_inner;null!=h._validate&&h._validate(),t+=s.zpp_inner.y;var u=s.zpp_inner;null!=u._validate&&u._validate(),i+=s.zpp_inner.z,s.dispose()}}return cn.get(e,t,i)},bn.prototype.dragImpulse=function(n){var e=0,t=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l,r=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,p.zpp_i<r?l=!0:(p.zpp_next=R.zpp_pool,R.zpp_pool=p,p.zpp_inner=null,l=!1),!l)break;p.zpp_critical=!1;var o=p.zpp_inner.at(p.zpp_i++).zpp_inner;if(o.type==Ce.FLUID&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var a=o.wrapper(),s=(a.zpp_inner.type==Ce.FLUID?a.zpp_inner.fluidarb.outer_zn:null).dragImpulse(this),_=s.zpp_inner;null!=_._validate&&_._validate(),e+=s.zpp_inner.x;var h=s.zpp_inner;null!=h._validate&&h._validate(),t+=s.zpp_inner.y;var u=s.zpp_inner;null!=u._validate&&u._validate(),i+=s.zpp_inner.z,s.dispose()}}return cn.get(e,t,i)},bn.prototype.totalFluidImpulse=function(n){var e=0,t=0,i=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var p=this.zpp_inner.wrap_arbiters.iterator();;){p.zpp_inner.zpp_inner.valmod();var l,r=p.zpp_inner.zpp_gl();if(p.zpp_critical=!0,p.zpp_i<r?l=!0:(p.zpp_next=R.zpp_pool,R.zpp_pool=p,p.zpp_inner=null,l=!1),!l)break;p.zpp_critical=!1;var o=p.zpp_inner.at(p.zpp_i++).zpp_inner;if(o.type==Ce.FLUID&&(null==n||o.b2==n.zpp_inner||o.b1==n.zpp_inner)){var a=o.wrapper(),s=(a.zpp_inner.type==Ce.FLUID?a.zpp_inner.fluidarb.outer_zn:null).totalImpulse(this),_=s.zpp_inner;null!=_._validate&&_._validate(),e+=s.zpp_inner.x;var h=s.zpp_inner;null!=h._validate&&h._validate(),t+=s.zpp_inner.y;var u=s.zpp_inner;null!=u._validate&&u._validate(),i+=s.zpp_inner.z,s.dispose()}}return cn.get(e,t,i)},bn.prototype.constraintsImpulse=function(){for(var n=0,e=0,t=0,i=this.zpp_inner.constraints.head;null!=i;){var p=i.elt.outer.bodyImpulse(this),l=p.zpp_inner;null!=l._validate&&l._validate(),n+=p.zpp_inner.x;var r=p.zpp_inner;null!=r._validate&&r._validate(),e+=p.zpp_inner.y;var o=p.zpp_inner;null!=o._validate&&o._validate(),t+=p.zpp_inner.z,p.dispose(),i=i.next}return cn.get(n,e,t)},bn.prototype.totalImpulse=function(n,e){null==e&&(e=!1);var t=0,i=0,p=0;null==this.zpp_inner.wrap_arbiters&&(this.zpp_inner.wrap_arbiters=_p.get(this.zpp_inner.arbiters,!0));for(var l=this.zpp_inner.wrap_arbiters.iterator();;){l.zpp_inner.zpp_inner.valmod();var r,o=l.zpp_inner.zpp_gl();if(l.zpp_critical=!0,l.zpp_i<o?r=!0:(l.zpp_next=R.zpp_pool,R.zpp_pool=l,l.zpp_inner=null,r=!1),!r)break;l.zpp_critical=!1;var a=l.zpp_inner.at(l.zpp_i++).zpp_inner;if(a.type!=Ce.SENSOR&&(null==n||a.b2==n.zpp_inner||a.b1==n.zpp_inner)){var s=a.wrapper().totalImpulse(this,e),_=s.zpp_inner;null!=_._validate&&_._validate(),t+=s.zpp_inner.x;var h=s.zpp_inner;null!=h._validate&&h._validate(),i+=s.zpp_inner.y;var u=s.zpp_inner;null!=u._validate&&u._validate(),p+=s.zpp_inner.z,s.dispose()}}for(var x=this.zpp_inner.constraints.head;null!=x;){var d=x.elt;if(d.active){var y=d.outer.bodyImpulse(this),z=y.zpp_inner;null!=z._validate&&z._validate(),t+=y.zpp_inner.x;var v=y.zpp_inner;null!=v._validate&&v._validate(),i+=y.zpp_inner.y;var c=y.zpp_inner;null!=c._validate&&c._validate(),p+=y.zpp_inner.z,y.dispose()}x=x.next}return cn.get(t,i,p)},bn.prototype.contains=function(n){var e,t=n.zpp_inner.weak;n.zpp_inner.weak=!1,e=!1;for(var i=this.zpp_inner.shapes.head;null!=i;){if(i.elt.outer.contains(n)){e=!0;break}i=i.next}if(n.zpp_inner.weak=t,n.zpp_inner.weak){var p=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p}return e},bn.prototype.toString=function(){return(this.zpp_inner.world?"(space::world":"("+(2==this.zpp_inner.type?"dynamic":1==this.zpp_inner.type?"static":"kinematic"))+")#"+this.zpp_inner_i.id},Object.defineProperty(bn.prototype,"type",{get:bn.prototype.get_type,set:bn.prototype.set_type}),Object.defineProperty(bn.prototype,"isBullet",{get:bn.prototype.get_isBullet,set:bn.prototype.set_isBullet}),Object.defineProperty(bn.prototype,"disableCCD",{get:bn.prototype.get_disableCCD,set:bn.prototype.set_disableCCD}),Object.defineProperty(bn.prototype,"shapes",{get:bn.prototype.get_shapes}),Object.defineProperty(bn.prototype,"compound",{get:bn.prototype.get_compound,set:bn.prototype.set_compound}),Object.defineProperty(bn.prototype,"space",{get:bn.prototype.get_space,set:bn.prototype.set_space}),Object.defineProperty(bn.prototype,"arbiters",{get:bn.prototype.get_arbiters}),Object.defineProperty(bn.prototype,"isSleeping",{get:bn.prototype.get_isSleeping}),Object.defineProperty(bn.prototype,"constraints",{get:bn.prototype.get_constraints}),Object.defineProperty(bn.prototype,"position",{get:bn.prototype.get_position,set:bn.prototype.set_position}),Object.defineProperty(bn.prototype,"velocity",{get:bn.prototype.get_velocity,set:bn.prototype.set_velocity}),Object.defineProperty(bn.prototype,"kinematicVel",{get:bn.prototype.get_kinematicVel,set:bn.prototype.set_kinematicVel}),Object.defineProperty(bn.prototype,"surfaceVel",{get:bn.prototype.get_surfaceVel,set:bn.prototype.set_surfaceVel}),Object.defineProperty(bn.prototype,"force",{get:bn.prototype.get_force,set:bn.prototype.set_force}),Object.defineProperty(bn.prototype,"constraintVelocity",{get:bn.prototype.get_constraintVelocity}),Object.defineProperty(bn.prototype,"rotation",{get:bn.prototype.get_rotation,set:bn.prototype.set_rotation}),Object.defineProperty(bn.prototype,"angularVel",{get:bn.prototype.get_angularVel,set:bn.prototype.set_angularVel}),Object.defineProperty(bn.prototype,"kinAngVel",{get:bn.prototype.get_kinAngVel,set:bn.prototype.set_kinAngVel}),Object.defineProperty(bn.prototype,"torque",{get:bn.prototype.get_torque,set:bn.prototype.set_torque}),Object.defineProperty(bn.prototype,"bounds",{get:bn.prototype.get_bounds}),Object.defineProperty(bn.prototype,"allowMovement",{get:bn.prototype.get_allowMovement,set:bn.prototype.set_allowMovement}),Object.defineProperty(bn.prototype,"allowRotation",{get:bn.prototype.get_allowRotation,set:bn.prototype.set_allowRotation}),Object.defineProperty(bn.prototype,"massMode",{get:bn.prototype.get_massMode,set:bn.prototype.set_massMode}),Object.defineProperty(bn.prototype,"constraintMass",{get:bn.prototype.get_constraintMass}),Object.defineProperty(bn.prototype,"mass",{get:bn.prototype.get_mass,set:bn.prototype.set_mass}),Object.defineProperty(bn.prototype,"gravMassMode",{get:bn.prototype.get_gravMassMode,set:bn.prototype.set_gravMassMode}),Object.defineProperty(bn.prototype,"gravMass",{get:bn.prototype.get_gravMass,set:bn.prototype.set_gravMass}),Object.defineProperty(bn.prototype,"gravMassScale",{get:bn.prototype.get_gravMassScale,set:bn.prototype.set_gravMassScale}),Object.defineProperty(bn.prototype,"inertiaMode",{get:bn.prototype.get_inertiaMode,set:bn.prototype.set_inertiaMode}),Object.defineProperty(bn.prototype,"constraintInertia",{get:bn.prototype.get_constraintInertia}),Object.defineProperty(bn.prototype,"inertia",{get:bn.prototype.get_inertia,set:bn.prototype.set_inertia}),Object.defineProperty(bn.prototype,"localCOM",{get:bn.prototype.get_localCOM}),Object.defineProperty(bn.prototype,"worldCOM",{get:bn.prototype.get_worldCOM}),bn.prototype.__class__=bn;var gn=nape.phys.BodyIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};gn.__name__=["nape","phys","BodyIterator"],gn.get=function(n){var e;if(null==gn.zpp_pool){$i.internal=!0;var t=new gn;$i.internal=!1,e=t}else{var i=gn.zpp_pool;gn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},gn.prototype.zpp_inner=null,gn.prototype.zpp_i=null,gn.prototype.zpp_critical=null,gn.prototype.zpp_next=null,gn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=gn.zpp_pool,gn.zpp_pool=this,this.zpp_inner=null,!1)},gn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},gn.prototype.__class__=gn;var wn=nape.phys.BodyList=function(){this.zpp_inner=null,this.zpp_inner=new $i,this.zpp_inner.outer=this};wn.__name__=["nape","phys","BodyList"],wn.fromArray=function(n){for(var e=new wn,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},wn.prototype.zpp_inner=null,wn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},wn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},wn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},wn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},wn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},wn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},wn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},wn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},wn.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},wn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},wn.prototype.empty=function(){return null==this.zpp_inner.inner.head},wn.prototype.iterator=function(){return this.zpp_inner.valmod(),gn.get(this)},wn.prototype.copy=function(n){null==n&&(n=!1);var e=new wn;this.zpp_inner.valmod();for(var t=gn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=gn.zpp_pool,gn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},wn.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=gn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=gn.zpp_pool,gn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},wn.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=gn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=gn.zpp_pool,gn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},wn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=gn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=gn.zpp_pool,gn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=gn.zpp_pool,gn.zpp_pool=e,e.zpp_inner=null;break}}return this},wn.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(wn.prototype,"length",{get:wn.prototype.get_length}),wn.prototype.__class__=wn;var Mn=nape.phys.BodyType=function(){};Mn.__name__=["nape","phys","BodyType"],Mn.STATIC=null,Mn.get_STATIC=function(){return null==oe.BodyType_STATIC&&(oe.internal=!0,oe.BodyType_STATIC=new Mn,oe.internal=!1),oe.BodyType_STATIC},Mn.DYNAMIC=null,Mn.get_DYNAMIC=function(){return null==oe.BodyType_DYNAMIC&&(oe.internal=!0,oe.BodyType_DYNAMIC=new Mn,oe.internal=!1),oe.BodyType_DYNAMIC},Mn.KINEMATIC=null,Mn.get_KINEMATIC=function(){return null==oe.BodyType_KINEMATIC&&(oe.internal=!0,oe.BodyType_KINEMATIC=new Mn,oe.internal=!1),oe.BodyType_KINEMATIC},Mn.prototype.toString=function(){return null==oe.BodyType_STATIC&&(oe.internal=!0,oe.BodyType_STATIC=new Mn,oe.internal=!1),this==oe.BodyType_STATIC?"STATIC":(null==oe.BodyType_DYNAMIC&&(oe.internal=!0,oe.BodyType_DYNAMIC=new Mn,oe.internal=!1),this==oe.BodyType_DYNAMIC?"DYNAMIC":(null==oe.BodyType_KINEMATIC&&(oe.internal=!0,oe.BodyType_KINEMATIC=new Mn,oe.internal=!1),this==oe.BodyType_KINEMATIC?"KINEMATIC":""))},Object.defineProperty(Mn,"STATIC",{get:Mn.get_STATIC}),Object.defineProperty(Mn,"DYNAMIC",{get:Mn.get_DYNAMIC}),Object.defineProperty(Mn,"KINEMATIC",{get:Mn.get_KINEMATIC}),Mn.prototype.__class__=Mn;var Cn=nape.phys.Compound=function(){this.zpp_inner=null,mn.call(this),this.zpp_inner=new ct,this.zpp_inner.outer=this,this.zpp_inner.outer_i=this,this.zpp_inner_i=this.zpp_inner,this.zpp_inner.insert_cbtype(re.ANY_COMPOUND.zpp_inner)};Cn.__name__=["nape","phys","Compound"],Cn.__super__=mn,Cn.prototype=Object.create(mn.prototype),Cn.prototype.zpp_inner=null,Cn.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},Cn.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},Cn.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},Cn.prototype.get_compound=function(){return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},Cn.prototype.set_compound=function(n){if(this.zpp_inner.immutable_midstep("Compound::compound"),(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)!=n&&(null!=(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer)&&(null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(this),null!=n)){var e=n.zpp_inner.wrap_compounds;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.compound?null:this.zpp_inner.compound.outer},Cn.prototype.get_space=function(){return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},Cn.prototype.set_space=function(n){if(this.zpp_inner.immutable_midstep("Compound::space"),(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)!=n&&(null!=(null==this.zpp_inner.space?null:this.zpp_inner.space.outer)&&(null==this.zpp_inner.space?null:this.zpp_inner.space.outer).zpp_inner.wrap_compounds.remove(this),null!=n)){var e=n.zpp_inner.wrap_compounds;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null==this.zpp_inner.space?null:this.zpp_inner.space.outer},Cn.prototype.toString=function(){return"Compound"+this.zpp_inner_i.id},Cn.prototype.copy=function(){return this.zpp_inner.copy()},Cn.prototype.breakApart=function(){this.zpp_inner.breakApart()},Cn.prototype.visitBodies=function(n){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var t=gn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=gn.zpp_pool,gn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var o=kn.get(r);;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var s,_=a.zpp_inner.user_length;if(o.zpp_critical=!0,o.zpp_i<_?s=!0:(o.zpp_next=kn.zpp_pool,kn.zpp_pool=o,o.zpp_inner=null,s=!1),!s)break;o.zpp_critical=!1,o.zpp_inner.at(o.zpp_i++).visitBodies(n)}},Cn.prototype.visitConstraints=function(n){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var t=A.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=A.zpp_pool,A.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var o=kn.get(r);;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var s,_=a.zpp_inner.user_length;if(o.zpp_critical=!0,o.zpp_i<_?s=!0:(o.zpp_next=kn.zpp_pool,kn.zpp_pool=o,o.zpp_inner=null,s=!1),!s)break;o.zpp_critical=!1,o.zpp_inner.at(o.zpp_i++).visitConstraints(n)}},Cn.prototype.visitCompounds=function(n){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var t=kn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=kn.zpp_pool,kn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);n(r),r.visitCompounds(n)}},Cn.prototype.COM=function(t){var i;if(null==t&&(t=!1),null==xp.poolVec2?i=new yn:(i=xp.poolVec2,xp.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=0,p.y=0,i.zpp_inner=p,i.zpp_inner.outer=i}else{var l,r=i.zpp_inner;if(null!=r._validate&&r._validate(),0==i.zpp_inner.x){var o=i.zpp_inner;null!=o._validate&&o._validate(),l=0==i.zpp_inner.y}else l=!1;if(!l){i.zpp_inner.x=0,i.zpp_inner.y=0;var a=i.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}i.zpp_inner.weak=t;var s=i,_=0;return this.visitBodies(function(t){if(null!=t.zpp_inner.wrap_shapes.zpp_inner.inner.head){if(null==t.zpp_inner.wrap_worldCOM){var i,p=t.zpp_inner.worldCOMx,l=t.zpp_inner.worldCOMy;if(null==xp.poolVec2?i=new yn:(i=xp.poolVec2,xp.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner){var r;null==xt.zpp_pool?r=new xt:(r=xt.zpp_pool,xt.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=p,r.y=l,i.zpp_inner=r,i.zpp_inner.outer=i}else{var o,a=i.zpp_inner;if(null!=a._validate&&a._validate(),i.zpp_inner.x==p){var h=i.zpp_inner;null!=h._validate&&h._validate(),o=i.zpp_inner.y==l}else o=!1;if(!o){i.zpp_inner.x=p,i.zpp_inner.y=l;var u=i.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}i.zpp_inner.weak=!1,t.zpp_inner.wrap_worldCOM=i,t.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,t.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,t.zpp_inner.wrap_worldCOM.zpp_inner._validate=e(n=t.zpp_inner,n.getworldCOM)}var x=t.zpp_inner.wrap_worldCOM;t.zpp_inner.validate_mass(),s.addeq(x.mul(t.zpp_inner.cmass,!0)),t.zpp_inner.validate_mass(),_+=t.zpp_inner.cmass}}),s.muleq(1/_),s},Cn.prototype.translate=function(n){var e=n.zpp_inner.weak;if(n.zpp_inner.weak=!1,this.visitBodies(function(e){null==e.zpp_inner.wrap_pos&&e.zpp_inner.setupPosition(),e.zpp_inner.wrap_pos.addeq(n)}),n.zpp_inner.weak=e,n.zpp_inner.weak){var t=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var i=n;i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t}return this},Cn.prototype.rotate=function(n,e){var t=n.zpp_inner.weak;if(n.zpp_inner.weak=!1,this.visitBodies(function(t){t.rotate(n,e)}),n.zpp_inner.weak=t,n.zpp_inner.weak){var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null;var p=n;p.zpp_pool=xp.poolVec2,xp.poolVec2=p,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=xt.zpp_pool,xt.zpp_pool=i}return this},Object.defineProperty(Cn.prototype,"bodies",{get:Cn.prototype.get_bodies}),Object.defineProperty(Cn.prototype,"constraints",{get:Cn.prototype.get_constraints}),Object.defineProperty(Cn.prototype,"compounds",{get:Cn.prototype.get_compounds}),Object.defineProperty(Cn.prototype,"compound",{get:Cn.prototype.get_compound,set:Cn.prototype.set_compound}),Object.defineProperty(Cn.prototype,"space",{get:Cn.prototype.get_space,set:Cn.prototype.set_space}),Cn.prototype.__class__=Cn;var kn=nape.phys.CompoundIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};kn.__name__=["nape","phys","CompoundIterator"],kn.get=function(n){var e;if(null==kn.zpp_pool){np.internal=!0;var t=new kn;np.internal=!1,e=t}else{var i=kn.zpp_pool;kn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},kn.prototype.zpp_inner=null,kn.prototype.zpp_i=null,kn.prototype.zpp_critical=null,kn.prototype.zpp_next=null,kn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=kn.zpp_pool,kn.zpp_pool=this,this.zpp_inner=null,!1)},kn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},kn.prototype.__class__=kn;var On=nape.phys.CompoundList=function(){this.zpp_inner=null,this.zpp_inner=new np,this.zpp_inner.outer=this};On.__name__=["nape","phys","CompoundList"],On.fromArray=function(n){for(var e=new On,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},On.prototype.zpp_inner=null,On.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},On.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},On.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},On.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},On.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},On.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},On.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},On.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},On.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},On.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},On.prototype.empty=function(){return null==this.zpp_inner.inner.head},On.prototype.iterator=function(){return this.zpp_inner.valmod(),kn.get(this)},On.prototype.copy=function(n){null==n&&(n=!1);var e=new On;this.zpp_inner.valmod();for(var t=kn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=kn.zpp_pool,kn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},On.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=kn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=kn.zpp_pool,kn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},On.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=kn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=kn.zpp_pool,kn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},On.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=kn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=kn.zpp_pool,kn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=kn.zpp_pool,kn.zpp_pool=e,e.zpp_inner=null;break}}return this},On.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(On.prototype,"length",{get:On.prototype.get_length}),On.prototype.__class__=On;var Pn=nape.phys.FluidProperties=function(n,e){null==e&&(e=1),null==n&&(n=1),this.zpp_inner=null,null==ft.zpp_pool?this.zpp_inner=new ft:(this.zpp_inner=ft.zpp_pool,ft.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),this.zpp_inner.outer=this,n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),e!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=e/1,this.zpp_inner.invalidate())};Pn.__name__=["nape","phys","FluidProperties"],Pn.prototype.zpp_inner=null,Pn.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Pn.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=ap.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},Pn.prototype.copy=function(){var n=new Pn(1e3*this.zpp_inner.density,this.zpp_inner.viscosity);null!=this.zpp_inner.userData&&(n.zpp_inner.userData=t.copy(this.zpp_inner.userData));var e=this.zpp_inner.wrap_gravity;if(null==e){if(null!=n.zpp_inner.wrap_gravity){n.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var i=n.zpp_inner.wrap_gravity,p=i.zpp_inner;i.zpp_inner.outer=null,i.zpp_inner=null,i.zpp_pool=xp.poolVec2,xp.poolVec2=i,null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,n.zpp_inner.wrap_gravity=null}}else{null==n.zpp_inner.wrap_gravity&&n.zpp_inner.getgravity();var l=n.zpp_inner.wrap_gravity,r=e.zpp_inner;null!=r._validate&&r._validate();var o=e.zpp_inner.x,a=e.zpp_inner;null!=a._validate&&a._validate();var s,_=e.zpp_inner.y,h=l.zpp_inner;if(null!=h._validate&&h._validate(),l.zpp_inner.x==o){var u=l.zpp_inner;null!=u._validate&&u._validate(),s=l.zpp_inner.y==_}else s=!1;if(!s){l.zpp_inner.x=o,l.zpp_inner.y=_;var x=l.zpp_inner;null!=x._invalidate&&x._invalidate(x)}if(e.zpp_inner.weak){var d=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=xt.zpp_pool,xt.zpp_pool=d}}return n},Pn.prototype.get_density=function(){return 1e3*this.zpp_inner.density},Pn.prototype.set_density=function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate()),1e3*this.zpp_inner.density},Pn.prototype.get_viscosity=function(){return this.zpp_inner.viscosity},Pn.prototype.set_viscosity=function(n){return n!=this.zpp_inner.viscosity&&(this.zpp_inner.viscosity=n/1,this.zpp_inner.invalidate()),this.zpp_inner.viscosity},Pn.prototype.get_gravity=function(){return this.zpp_inner.wrap_gravity},Pn.prototype.set_gravity=function(n){if(null==n){if(null!=this.zpp_inner.wrap_gravity){this.zpp_inner.wrap_gravity.zpp_inner._inuse=!1;var e=this.zpp_inner.wrap_gravity,t=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t,this.zpp_inner.wrap_gravity=null}}else{null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var i=this.zpp_inner.wrap_gravity,p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate();var o,a=n.zpp_inner.y,s=i.zpp_inner;if(null!=s._validate&&s._validate(),i.zpp_inner.x==l){var _=i.zpp_inner;null!=_._validate&&_._validate(),o=i.zpp_inner.y==a}else o=!1;if(!o){i.zpp_inner.x=l,i.zpp_inner.y=a;var h=i.zpp_inner;null!=h._invalidate&&h._invalidate(h)}if(n.zpp_inner.weak){var u=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=u.outer&&(u.outer.zpp_inner=null,u.outer=null),u._isimmutable=null,u._validate=null,u._invalidate=null,u.next=xt.zpp_pool,xt.zpp_pool=u}}return this.zpp_inner.wrap_gravity},Pn.prototype.toString=function(){return"{ density: "+1e3*this.zpp_inner.density+" viscosity: "+this.zpp_inner.viscosity+" gravity: "+i.string(this.zpp_inner.wrap_gravity)+" }"},Object.defineProperty(Pn.prototype,"userData",{get:Pn.prototype.get_userData}),Object.defineProperty(Pn.prototype,"shapes",{get:Pn.prototype.get_shapes}),Object.defineProperty(Pn.prototype,"density",{get:Pn.prototype.get_density,set:Pn.prototype.set_density}),Object.defineProperty(Pn.prototype,"viscosity",{get:Pn.prototype.get_viscosity,set:Pn.prototype.set_viscosity}),Object.defineProperty(Pn.prototype,"gravity",{get:Pn.prototype.get_gravity,set:Pn.prototype.set_gravity}),Pn.prototype.__class__=Pn;var Sn=nape.phys.GravMassMode=function(){};Sn.__name__=["nape","phys","GravMassMode"],Sn.DEFAULT=null,Sn.get_DEFAULT=function(){return null==oe.GravMassMode_DEFAULT&&(oe.internal=!0,oe.GravMassMode_DEFAULT=new Sn,oe.internal=!1),oe.GravMassMode_DEFAULT},Sn.FIXED=null,Sn.get_FIXED=function(){return null==oe.GravMassMode_FIXED&&(oe.internal=!0,oe.GravMassMode_FIXED=new Sn,oe.internal=!1),oe.GravMassMode_FIXED},Sn.SCALED=null,Sn.get_SCALED=function(){return null==oe.GravMassMode_SCALED&&(oe.internal=!0,oe.GravMassMode_SCALED=new Sn,oe.internal=!1),oe.GravMassMode_SCALED},Sn.prototype.toString=function(){return null==oe.GravMassMode_DEFAULT&&(oe.internal=!0,oe.GravMassMode_DEFAULT=new Sn,oe.internal=!1),this==oe.GravMassMode_DEFAULT?"DEFAULT":(null==oe.GravMassMode_FIXED&&(oe.internal=!0,oe.GravMassMode_FIXED=new Sn,oe.internal=!1),this==oe.GravMassMode_FIXED?"FIXED":(null==oe.GravMassMode_SCALED&&(oe.internal=!0,oe.GravMassMode_SCALED=new Sn,oe.internal=!1),this==oe.GravMassMode_SCALED?"SCALED":""))},Object.defineProperty(Sn,"DEFAULT",{get:Sn.get_DEFAULT}),Object.defineProperty(Sn,"FIXED",{get:Sn.get_FIXED}),Object.defineProperty(Sn,"SCALED",{get:Sn.get_SCALED}),Sn.prototype.__class__=Sn;var An=nape.phys.InertiaMode=function(){};An.__name__=["nape","phys","InertiaMode"],An.DEFAULT=null,An.get_DEFAULT=function(){return null==oe.InertiaMode_DEFAULT&&(oe.internal=!0,oe.InertiaMode_DEFAULT=new An,oe.internal=!1),oe.InertiaMode_DEFAULT},An.FIXED=null,An.get_FIXED=function(){return null==oe.InertiaMode_FIXED&&(oe.internal=!0,oe.InertiaMode_FIXED=new An,oe.internal=!1),oe.InertiaMode_FIXED},An.prototype.toString=function(){return null==oe.InertiaMode_DEFAULT&&(oe.internal=!0,oe.InertiaMode_DEFAULT=new An,oe.internal=!1),this==oe.InertiaMode_DEFAULT?"DEFAULT":(null==oe.InertiaMode_FIXED&&(oe.internal=!0,oe.InertiaMode_FIXED=new An,oe.internal=!1),this==oe.InertiaMode_FIXED?"FIXED":"")},Object.defineProperty(An,"DEFAULT",{get:An.get_DEFAULT}),Object.defineProperty(An,"FIXED",{get:An.get_FIXED}),An.prototype.__class__=An;var jn=nape.phys.InteractorIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};jn.__name__=["nape","phys","InteractorIterator"],jn.get=function(n){var e;if(null==jn.zpp_pool){Qi.internal=!0;var t=new jn;Qi.internal=!1,e=t}else{var i=jn.zpp_pool;jn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},jn.prototype.zpp_inner=null,jn.prototype.zpp_i=null,jn.prototype.zpp_critical=null,jn.prototype.zpp_next=null,jn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=jn.zpp_pool,jn.zpp_pool=this,this.zpp_inner=null,!1)},jn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},jn.prototype.__class__=jn;var En=nape.phys.InteractorList=function(){this.zpp_inner=null,this.zpp_inner=new Qi,this.zpp_inner.outer=this};En.__name__=["nape","phys","InteractorList"],En.fromArray=function(n){for(var e=new En,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},En.prototype.zpp_inner=null,En.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},En.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner_i)},En.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer_i},En.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner_i);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},En.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner_i)}else this.zpp_inner.inner.add(n.zpp_inner_i);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},En.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer_i},En.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer_i;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer_i},En.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},En.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner_i){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner_i),this.zpp_inner.invalidate()),e},En.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},En.prototype.empty=function(){return null==this.zpp_inner.inner.head},En.prototype.iterator=function(){return this.zpp_inner.valmod(),jn.get(this)},En.prototype.copy=function(n){null==n&&(n=!1);var e=new En;this.zpp_inner.valmod();for(var t=jn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=jn.zpp_pool,jn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},En.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=jn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=jn.zpp_pool,jn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},En.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=jn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=jn.zpp_pool,jn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},En.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=jn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=jn.zpp_pool,jn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=jn.zpp_pool,jn.zpp_pool=e,e.zpp_inner=null;break}}return this},En.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(En.prototype,"length",{get:En.prototype.get_length}),En.prototype.__class__=En;var In=nape.phys.MassMode=function(){};In.__name__=["nape","phys","MassMode"],In.DEFAULT=null,In.get_DEFAULT=function(){return null==oe.MassMode_DEFAULT&&(oe.internal=!0,oe.MassMode_DEFAULT=new In,oe.internal=!1),oe.MassMode_DEFAULT},In.FIXED=null,In.get_FIXED=function(){return null==oe.MassMode_FIXED&&(oe.internal=!0,oe.MassMode_FIXED=new In,oe.internal=!1),oe.MassMode_FIXED},In.prototype.toString=function(){return null==oe.MassMode_DEFAULT&&(oe.internal=!0,oe.MassMode_DEFAULT=new In,oe.internal=!1),this==oe.MassMode_DEFAULT?"DEFAULT":(null==oe.MassMode_FIXED&&(oe.internal=!0,oe.MassMode_FIXED=new In,oe.internal=!1),this==oe.MassMode_FIXED?"FIXED":"")},Object.defineProperty(In,"DEFAULT",{get:In.get_DEFAULT}),Object.defineProperty(In,"FIXED",{get:In.get_FIXED}),In.prototype.__class__=In;var Tn=nape.phys.Material=function(n,e,t,i,p){null==p&&(p=.001),null==i&&(i=1),null==t&&(t=2),null==e&&(e=1),null==n&&(n=0),this.zpp_inner=null,null==mt.zpp_pool?this.zpp_inner=new mt:(this.zpp_inner=mt.zpp_pool,mt.zpp_pool=this.zpp_inner.next,this.zpp_inner.next=null),this.zpp_inner.outer=this,n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=n/1,this.zpp_inner.invalidate(mt.WAKE|mt.ARBITERS)),e!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=e/1,this.zpp_inner.invalidate(mt.WAKE|mt.ANGDRAG|mt.ARBITERS)),t!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=t/1,this.zpp_inner.invalidate(mt.WAKE|mt.ARBITERS)),i!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=i/1e3,this.zpp_inner.invalidate(mt.WAKE|mt.PROPS)),p!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=p/1,this.zpp_inner.invalidate(mt.WAKE|mt.ARBITERS))};Tn.__name__=["nape","phys","Material"],Tn.wood=function(){return new Tn(.4,.2,.38,.7,.005)},Tn.steel=function(){return new Tn(.2,.57,.74,7.8,.001)},Tn.ice=function(){return new Tn(.3,.03,.1,.9,1e-4)},Tn.rubber=function(){return new Tn(.8,1,1.4,1.5,.01)},Tn.glass=function(){return new Tn(.4,.4,.94,2.6,.002)},Tn.sand=function(){return new Tn(-1,.45,.6,1.6,16)},Tn.prototype.zpp_inner=null,Tn.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Tn.prototype.get_shapes=function(){return null==this.zpp_inner.wrap_shapes&&(this.zpp_inner.wrap_shapes=ap.get(this.zpp_inner.shapes,!0)),this.zpp_inner.wrap_shapes},Tn.prototype.copy=function(){var n=new Tn(this.zpp_inner.elasticity,this.zpp_inner.dynamicFriction,this.zpp_inner.staticFriction,1e3*this.zpp_inner.density,this.zpp_inner.rollingFriction);return null!=this.zpp_inner.userData&&(n.zpp_inner.userData=t.copy(this.zpp_inner.userData)),n},Tn.prototype.get_elasticity=function(){return this.zpp_inner.elasticity},Tn.prototype.set_elasticity=function(n){return n!=this.zpp_inner.elasticity&&(this.zpp_inner.elasticity=n/1,this.zpp_inner.invalidate(mt.WAKE|mt.ARBITERS)),this.zpp_inner.elasticity},Tn.prototype.get_dynamicFriction=function(){return this.zpp_inner.dynamicFriction},Tn.prototype.set_dynamicFriction=function(n){return n!=this.zpp_inner.dynamicFriction&&(this.zpp_inner.dynamicFriction=n/1,this.zpp_inner.invalidate(mt.WAKE|mt.ANGDRAG|mt.ARBITERS)),this.zpp_inner.dynamicFriction},Tn.prototype.get_staticFriction=function(){return this.zpp_inner.staticFriction},Tn.prototype.set_staticFriction=function(n){return n!=this.zpp_inner.staticFriction&&(this.zpp_inner.staticFriction=n/1,this.zpp_inner.invalidate(mt.WAKE|mt.ARBITERS)),this.zpp_inner.staticFriction},Tn.prototype.get_density=function(){return 1e3*this.zpp_inner.density},Tn.prototype.set_density=function(n){return n!=1e3*this.zpp_inner.density&&(this.zpp_inner.density=n/1e3,this.zpp_inner.invalidate(mt.WAKE|mt.PROPS)),1e3*this.zpp_inner.density},Tn.prototype.get_rollingFriction=function(){return this.zpp_inner.rollingFriction},Tn.prototype.set_rollingFriction=function(n){return n!=this.zpp_inner.rollingFriction&&(this.zpp_inner.rollingFriction=n/1,this.zpp_inner.invalidate(mt.WAKE|mt.ARBITERS)),this.zpp_inner.rollingFriction},Tn.prototype.toString=function(){return"{ elasticity: "+this.zpp_inner.elasticity+" dynamicFriction: "+this.zpp_inner.dynamicFriction+" staticFriction: "+this.zpp_inner.staticFriction+" density: "+1e3*this.zpp_inner.density+" rollingFriction: "+this.zpp_inner.rollingFriction+" }"},Object.defineProperty(Tn.prototype,"userData",{get:Tn.prototype.get_userData}),Object.defineProperty(Tn.prototype,"shapes",{get:Tn.prototype.get_shapes}),Object.defineProperty(Tn.prototype,"elasticity",{get:Tn.prototype.get_elasticity,set:Tn.prototype.set_elasticity}),Object.defineProperty(Tn.prototype,"dynamicFriction",{get:Tn.prototype.get_dynamicFriction,set:Tn.prototype.set_dynamicFriction}),Object.defineProperty(Tn.prototype,"staticFriction",{get:Tn.prototype.get_staticFriction,set:Tn.prototype.set_staticFriction}),Object.defineProperty(Tn.prototype,"density",{get:Tn.prototype.get_density,set:Tn.prototype.set_density}),Object.defineProperty(Tn.prototype,"rollingFriction",{get:Tn.prototype.get_rollingFriction,set:Tn.prototype.set_rollingFriction}),Tn.prototype.__class__=Tn;var Nn=nape.shape.Shape=function(){this.zpp_inner=null,mn.call(this)};Nn.__name__=["nape","shape","Shape"],Nn.__super__=mn,Nn.prototype=Object.create(mn.prototype),Nn.prototype.zpp_inner=null,Nn.prototype.get_type=function(){return bt.types[this.zpp_inner.type]},Nn.prototype.isCircle=function(){return 0==this.zpp_inner.type},Nn.prototype.isPolygon=function(){return 1==this.zpp_inner.type},Nn.prototype.get_body=function(){return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},Nn.prototype.set_body=function(n){if(this.zpp_inner.immutable_midstep("Shape::body"),(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null)!=n&&(null!=this.zpp_inner.body&&(null!=this.zpp_inner.body?this.zpp_inner.body.outer:null).zpp_inner.wrap_shapes.remove(this),null!=n)){var e=n.zpp_inner.wrap_shapes;e.zpp_inner.reverse_flag?e.push(this):e.unshift(this)}return null!=this.zpp_inner.body?this.zpp_inner.body.outer:null},Nn.prototype.get_castCircle=function(){return 0==this.zpp_inner.type?this.zpp_inner.circle.outer_zn:null},Nn.prototype.get_castPolygon=function(){return 1==this.zpp_inner.type?this.zpp_inner.polygon.outer_zn:null},Nn.prototype.get_worldCOM=function(){if(null==this.zpp_inner.wrap_worldCOM){var t,i=this.zpp_inner.worldCOMx,p=this.zpp_inner.worldCOMy;if(null==xp.poolVec2?t=new yn:(t=xp.poolVec2,xp.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner){var l;null==xt.zpp_pool?l=new xt:(l=xt.zpp_pool,xt.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=i,l.y=p,t.zpp_inner=l,t.zpp_inner.outer=t}else{var r,o=t.zpp_inner;if(null!=o._validate&&o._validate(),t.zpp_inner.x==i){var a=t.zpp_inner;null!=a._validate&&a._validate(),r=t.zpp_inner.y==p}else r=!1;if(!r){t.zpp_inner.x=i,t.zpp_inner.y=p;var s=t.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}t.zpp_inner.weak=!1,this.zpp_inner.wrap_worldCOM=t,this.zpp_inner.wrap_worldCOM.zpp_inner._inuse=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._immutable=!0,this.zpp_inner.wrap_worldCOM.zpp_inner._validate=e(n=this.zpp_inner,n.getworldCOM)}return this.zpp_inner.wrap_worldCOM},Nn.prototype.get_localCOM=function(){return null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},Nn.prototype.set_localCOM=function(n){this.zpp_inner.immutable_midstep("Body::localCOM"),null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM());var e=this.zpp_inner.wrap_localCOM,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.wrap_localCOM&&(0==this.zpp_inner.type?this.zpp_inner.circle.setupLocalCOM():this.zpp_inner.polygon.setupLocalCOM()),this.zpp_inner.wrap_localCOM},Nn.prototype.get_area=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.area},Nn.prototype.get_inertia=function(){return this.zpp_inner.validate_area_inertia(),this.zpp_inner.inertia},Nn.prototype.get_angDrag=function(){return this.zpp_inner.validate_angDrag(),this.zpp_inner.angDrag},Nn.prototype.get_material=function(){return this.zpp_inner.material.wrapper()},Nn.prototype.set_material=function(n){return this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(n.zpp_inner),this.zpp_inner.material.wrapper()},Nn.prototype.get_filter=function(){return this.zpp_inner.filter.wrapper()},Nn.prototype.set_filter=function(n){return this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(n.zpp_inner),this.zpp_inner.filter.wrapper()},Nn.prototype.get_fluidProperties=function(){return this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Pn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},Nn.prototype.set_fluidProperties=function(n){return this.zpp_inner.setFluid(n.zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Pn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()},Nn.prototype.get_fluidEnabled=function(){return this.zpp_inner.fluidEnabled},Nn.prototype.set_fluidEnabled=function(n){return this.zpp_inner.immutable_midstep("Shape::fluidEnabled"),this.zpp_inner.fluidEnabled=n,n&&null==this.zpp_inner.fluidProperties&&(this.zpp_inner.setFluid((new Pn).zpp_inner),this.zpp_inner.immutable_midstep("Shape::fluidProperties"),null==this.zpp_inner.fluidProperties&&this.zpp_inner.setFluid((new Pn).zpp_inner),this.zpp_inner.fluidProperties.wrapper()),this.zpp_inner.wake(),this.zpp_inner.fluidEnabled},Nn.prototype.get_sensorEnabled=function(){return this.zpp_inner.sensorEnabled},Nn.prototype.set_sensorEnabled=function(n){return this.zpp_inner.immutable_midstep("Shape::sensorEnabled"),this.zpp_inner.sensorEnabled=n,this.zpp_inner.wake(),this.zpp_inner.sensorEnabled},Nn.prototype.get_bounds=function(){return this.zpp_inner.aabb.wrapper()},Nn.prototype.translate=function(n){if(this.zpp_inner.immutable_midstep("Shape::translate()"),n.lsq()>0)if(0==this.zpp_inner.type){var e=n.zpp_inner;null!=e._validate&&e._validate();var t=n.zpp_inner.x,i=n.zpp_inner;null!=i._validate&&i._validate(),this.zpp_inner.circle.__translate(t,n.zpp_inner.y)}else{var p=n.zpp_inner;null!=p._validate&&p._validate();var l=n.zpp_inner.x,r=n.zpp_inner;null!=r._validate&&r._validate(),this.zpp_inner.polygon.__translate(l,n.zpp_inner.y)}if(n.zpp_inner.weak){var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=xt.zpp_pool,xt.zpp_pool=o}return this},Nn.prototype.scale=function(n,e){if(this.zpp_inner.immutable_midstep("Shape::scale()"),0==this.zpp_inner.type){var t=n*n-e*e;t*t<o.epsilon*o.epsilon&&this.zpp_inner.circle.__scale(n,e)}else this.zpp_inner.polygon.__scale(n,e);return this},Nn.prototype.rotate=function(n){if(this.zpp_inner.immutable_midstep("Shape::rotate()"),n%(2*Math.PI)!=0){var e=Math.cos(n),t=Math.sin(n);0==this.zpp_inner.type?this.zpp_inner.circle.__rotate(t,e):this.zpp_inner.polygon.__rotate(t,e)}return this},Nn.prototype.transform=function(n){return this.zpp_inner.immutable_midstep("Shape::transform()"),0==this.zpp_inner.type?n.equiorthogonal()&&this.zpp_inner.circle.__transform(n):this.zpp_inner.polygon.__transform(n),this},Nn.prototype.contains=function(n){Be.validateShape(this.zpp_inner);var e=n.zpp_inner;null!=e._validate&&e._validate();var t=Le.shapeContains(this.zpp_inner,n.zpp_inner);if(n.zpp_inner.weak){var i=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=xt.zpp_pool,xt.zpp_pool=i}return t},Nn.prototype.copy=function(){return this.zpp_inner.copy()},Nn.prototype.toString=function(){return(0==this.zpp_inner.type?"Circle":"Polygon")+"#"+this.zpp_inner_i.id},Object.defineProperty(Nn.prototype,"type",{get:Nn.prototype.get_type}),Object.defineProperty(Nn.prototype,"body",{get:Nn.prototype.get_body,set:Nn.prototype.set_body}),Object.defineProperty(Nn.prototype,"castCircle",{get:Nn.prototype.get_castCircle}),Object.defineProperty(Nn.prototype,"castPolygon",{get:Nn.prototype.get_castPolygon}),Object.defineProperty(Nn.prototype,"worldCOM",{get:Nn.prototype.get_worldCOM}),Object.defineProperty(Nn.prototype,"localCOM",{get:Nn.prototype.get_localCOM,set:Nn.prototype.set_localCOM}),Object.defineProperty(Nn.prototype,"area",{get:Nn.prototype.get_area}),Object.defineProperty(Nn.prototype,"inertia",{get:Nn.prototype.get_inertia}),Object.defineProperty(Nn.prototype,"angDrag",{get:Nn.prototype.get_angDrag}),Object.defineProperty(Nn.prototype,"material",{get:Nn.prototype.get_material,set:Nn.prototype.set_material}),Object.defineProperty(Nn.prototype,"filter",{get:Nn.prototype.get_filter,set:Nn.prototype.set_filter}),Object.defineProperty(Nn.prototype,"fluidProperties",{get:Nn.prototype.get_fluidProperties,set:Nn.prototype.set_fluidProperties}),Object.defineProperty(Nn.prototype,"fluidEnabled",{get:Nn.prototype.get_fluidEnabled,set:Nn.prototype.set_fluidEnabled}),Object.defineProperty(Nn.prototype,"sensorEnabled",{get:Nn.prototype.get_sensorEnabled,set:Nn.prototype.set_sensorEnabled}),Object.defineProperty(Nn.prototype,"bounds",{get:Nn.prototype.get_bounds}),Nn.prototype.__class__=Nn;var Ln=nape.shape.Circle=function(n,e,t,i){if(this.zpp_inner_zn=null,Nn.call(this),this.zpp_inner_zn=new gt,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),null==e)this.zpp_inner.localCOMx=0,this.zpp_inner.localCOMy=0;else{var p=e.zpp_inner;null!=p._validate&&p._validate(),this.zpp_inner.localCOMx=e.zpp_inner.x;var l=e.zpp_inner;if(null!=l._validate&&l._validate(),this.zpp_inner.localCOMy=e.zpp_inner.y,e.zpp_inner.weak){var r=e.zpp_inner;e.zpp_inner.outer=null,e.zpp_inner=null,e.zpp_pool=xp.poolVec2,xp.poolVec2=e,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r}}null==t?null==mt.zpp_pool?this.zpp_inner.material=new mt:(this.zpp_inner.material=mt.zpp_pool,mt.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(t.zpp_inner),this.zpp_inner.material.wrapper()),null==i?null==je.zpp_pool?this.zpp_inner.filter=new je:(this.zpp_inner.filter=je.zpp_pool,je.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(i.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(re.ANY_SHAPE.zpp_inner)};Ln.__name__=["nape","shape","Circle"],Ln.__super__=Nn,Ln.prototype=Object.create(Nn.prototype),Ln.prototype.zpp_inner_zn=null,Ln.prototype.get_radius=function(){return this.zpp_inner_zn.radius},Ln.prototype.set_radius=function(n){return this.zpp_inner.immutable_midstep("Circle::radius"),n!=this.zpp_inner_zn.radius&&(this.zpp_inner_zn.radius=n,this.zpp_inner_zn.invalidate_radius()),this.zpp_inner_zn.radius},Object.defineProperty(Ln.prototype,"radius",{get:Ln.prototype.get_radius,set:Ln.prototype.set_radius}),Ln.prototype.__class__=Ln;var Vn=nape.shape.Edge=function(){this.zpp_inner=null};Vn.__name__=["nape","shape","Edge"],Vn.prototype.zpp_inner=null,Vn.prototype.get_polygon=function(){return this.zpp_inner.polygon.outer_zn},Vn.prototype.get_localNormal=function(){return null==this.zpp_inner.wrap_lnorm&&this.zpp_inner.getlnorm(),this.zpp_inner.wrap_lnorm},Vn.prototype.get_worldNormal=function(){return null==this.zpp_inner.wrap_gnorm&&this.zpp_inner.getgnorm(),this.zpp_inner.wrap_gnorm},Vn.prototype.get_length=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.length},Vn.prototype.get_localProjection=function(){return this.zpp_inner.polygon.validate_laxi(),this.zpp_inner.lprojection},Vn.prototype.get_worldProjection=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i;i=i.next,l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}var o=n.edges.head,a=n.gverts.next,s=a;for(a=a.next;null!=a;){var _=a,h=o.elt;o=o.next,h.gp0=s,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,s=_,a=a.next}var u=o.elt;u.gp0=s,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}return this.zpp_inner.gprojection},Vn.prototype.get_localVertex1=function(){this.zpp_inner.polygon.validate_laxi();var n=this.zpp_inner.lp0;if(null==n.outer){n.outer=new yn;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=xt.zpp_pool,xt.zpp_pool=e,n.outer.zpp_inner=n}return n.outer},Vn.prototype.get_localVertex2=function(){this.zpp_inner.polygon.validate_laxi();var n=this.zpp_inner.lp1;if(null==n.outer){n.outer=new yn;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=xt.zpp_pool,xt.zpp_pool=e,n.outer.zpp_inner=n}return n.outer},Vn.prototype.get_worldVertex1=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i;i=i.next,l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}var o=n.edges.head,a=n.gverts.next,s=a;for(a=a.next;null!=a;){var _=a,h=o.elt;o=o.next,h.gp0=s,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,s=_,a=a.next}var u=o.elt;u.gp0=s,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}var x=this.zpp_inner.gp0;if(null==x.outer){x.outer=new yn;var d=x.outer.zpp_inner;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=xt.zpp_pool,xt.zpp_pool=d,x.outer.zpp_inner=x}return x.outer},Vn.prototype.get_worldVertex2=function(){var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i;i=i.next,l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}var o=n.edges.head,a=n.gverts.next,s=a;for(a=a.next;null!=a;){var _=a,h=o.elt;o=o.next,h.gp0=s,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,s=_,a=a.next}var u=o.elt;u.gp0=s,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}var x=this.zpp_inner.gp1;if(null==x.outer){x.outer=new yn;var d=x.outer.zpp_inner;null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=xt.zpp_pool,xt.zpp_pool=d,x.outer.zpp_inner=x}return x.outer},Vn.prototype.toString=function(){if(null==this.zpp_inner.polygon)return"Edge(object-pooled)";if(null==this.zpp_inner.polygon.body)return this.zpp_inner.polygon.validate_laxi(),"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } }";var n=this.zpp_inner.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i;i=i.next,l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}var o=n.edges.head,a=n.gverts.next,s=a;for(a=a.next;null!=a;){var _=a,h=o.elt;o=o.next,h.gp0=s,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,s=_,a=a.next}var u=o.elt;u.gp0=s,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}return"{ localNormal : { x: "+this.zpp_inner.lnormx+" y: "+this.zpp_inner.lnormy+" } worldNormal : { x: "+this.zpp_inner.gnormx+" y: "+this.zpp_inner.gnormy+" } }"},Object.defineProperty(Vn.prototype,"polygon",{get:Vn.prototype.get_polygon}),Object.defineProperty(Vn.prototype,"localNormal",{get:Vn.prototype.get_localNormal}),Object.defineProperty(Vn.prototype,"worldNormal",{get:Vn.prototype.get_worldNormal}),Object.defineProperty(Vn.prototype,"length",{get:Vn.prototype.get_length}),Object.defineProperty(Vn.prototype,"localProjection",{get:Vn.prototype.get_localProjection}),Object.defineProperty(Vn.prototype,"worldProjection",{get:Vn.prototype.get_worldProjection}),Object.defineProperty(Vn.prototype,"localVertex1",{get:Vn.prototype.get_localVertex1}),Object.defineProperty(Vn.prototype,"localVertex2",{get:Vn.prototype.get_localVertex2}),Object.defineProperty(Vn.prototype,"worldVertex1",{get:Vn.prototype.get_worldVertex1}),Object.defineProperty(Vn.prototype,"worldVertex2",{get:Vn.prototype.get_worldVertex2}),Vn.prototype.__class__=Vn;var Dn=nape.shape.EdgeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Dn.__name__=["nape","shape","EdgeIterator"],Dn.get=function(n){var e;if(null==Dn.zpp_pool){op.internal=!0;var t=new Dn;op.internal=!1,e=t}else{var i=Dn.zpp_pool;Dn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Dn.prototype.zpp_inner=null,Dn.prototype.zpp_i=null,Dn.prototype.zpp_critical=null,Dn.prototype.zpp_next=null,Dn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=Dn.zpp_pool,Dn.zpp_pool=this,this.zpp_inner=null,!1)},Dn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Dn.prototype.__class__=Dn;var Fn=nape.shape.EdgeList=function(){this.zpp_inner=null,this.zpp_inner=new op,this.zpp_inner.outer=this};Fn.__name__=["nape","shape","EdgeList"],Fn.fromArray=function(n){for(var e=new Fn,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},Fn.prototype.zpp_inner=null,Fn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},Fn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},Fn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n==this.zpp_inner.user_length-1?n=n:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-2-n)),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.wrapper()},Fn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},Fn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},Fn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.wrapper()},Fn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).wrapper();null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.wrapper()},Fn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},Fn.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},Fn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},Fn.prototype.empty=function(){return null==this.zpp_inner.inner.head},Fn.prototype.iterator=function(){return this.zpp_inner.valmod(),Dn.get(this)},Fn.prototype.copy=function(n){null==n&&(n=!1);var e=new Fn;this.zpp_inner.valmod();for(var t=Dn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=Dn.zpp_pool,Dn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},Fn.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=Dn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=Dn.zpp_pool,Dn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},Fn.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=Dn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=Dn.zpp_pool,Dn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},Fn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=Dn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=Dn.zpp_pool,Dn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=Dn.zpp_pool,Dn.zpp_pool=e,e.zpp_inner=null;break}}return this},Fn.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(Fn.prototype,"length",{get:Fn.prototype.get_length}),Fn.prototype.__class__=Fn;var Rn=nape.shape.Polygon=function(n,e,t){if(this.zpp_inner_zn=null,Nn.call(this),this.zpp_inner_zn=new Mt,this.zpp_inner_zn.outer=this,this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner_i=this.zpp_inner,this.zpp_inner_i.outer_i=this,n instanceof Array&&null==n.__enum__)for(var i=n,p=0;p<i.length;){var l=i[p];++p;var o=l;null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var a=this.zpp_inner_zn.wrap_lverts,s=o.zpp_inner;null!=s._validate&&s._validate();var _=o.zpp_inner.x,h=o.zpp_inner;null!=h._validate&&h._validate();var u,x=o.zpp_inner.y;if(null==xp.poolVec2?u=new yn:(u=xp.poolVec2,xp.poolVec2=u.zpp_pool,u.zpp_pool=null),null==u.zpp_inner){var d;null==xt.zpp_pool?d=new xt:(d=xt.zpp_pool,xt.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=_,d.y=x,u.zpp_inner=d,u.zpp_inner.outer=u}else{var y,z=u.zpp_inner;if(null!=z._validate&&z._validate(),u.zpp_inner.x==_){var v=u.zpp_inner;null!=v._validate&&v._validate(),y=u.zpp_inner.y==x}else y=!1;if(!y){u.zpp_inner.x=_,u.zpp_inner.y=x;var c=u.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}u.zpp_inner.weak=!1,a.push(u)}else if(r.__instanceof(n,vn))for(var f=n.iterator();;){f.zpp_inner.zpp_inner.valmod();var m,b=f.zpp_inner.zpp_gl();if(f.zpp_critical=!0,f.zpp_i<b?m=!0:(f.zpp_next=zn.zpp_pool,zn.zpp_pool=f,f.zpp_inner=null,m=!1),!m)break;f.zpp_critical=!1;var g=f.zpp_inner.at(f.zpp_i++);null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var w=this.zpp_inner_zn.wrap_lverts,M=g.zpp_inner;null!=M._validate&&M._validate();var C=g.zpp_inner.x,k=g.zpp_inner;null!=k._validate&&k._validate();var O,P=g.zpp_inner.y;if(null==xp.poolVec2?O=new yn:(O=xp.poolVec2,xp.poolVec2=O.zpp_pool,O.zpp_pool=null),null==O.zpp_inner){var S;null==xt.zpp_pool?S=new xt:(S=xt.zpp_pool,xt.zpp_pool=S.next,S.next=null),S.weak=!1,S._immutable=!1,S.x=C,S.y=P,O.zpp_inner=S,O.zpp_inner.outer=O}else{var A,j=O.zpp_inner;if(null!=j._validate&&j._validate(),O.zpp_inner.x==C){var E=O.zpp_inner;null!=E._validate&&E._validate(),A=O.zpp_inner.y==P}else A=!1;if(!A){O.zpp_inner.x=C,O.zpp_inner.y=P;var I=O.zpp_inner;null!=I._invalidate&&I._invalidate(I)}}O.zpp_inner.weak=!1,w.push(O)}else if(r.__instanceof(n,pn)){var T=n.zpp_inner.vertices;if(null!=T)for(var N=T;;){var L,V=N.x,D=N.y;if(null==xp.poolVec2?L=new yn:(L=xp.poolVec2,xp.poolVec2=L.zpp_pool,L.zpp_pool=null),null==L.zpp_inner){var F;null==xt.zpp_pool?F=new xt:(F=xt.zpp_pool,xt.zpp_pool=F.next,F.next=null),F.weak=!1,F._immutable=!1,F.x=V,F.y=D,L.zpp_inner=F,L.zpp_inner.outer=L}else{var R,Z=L.zpp_inner;if(null!=Z._validate&&Z._validate(),L.zpp_inner.x==V){var B=L.zpp_inner;null!=B._validate&&B._validate(),R=L.zpp_inner.y==D}else R=!1;if(!R){L.zpp_inner.x=V,L.zpp_inner.y=D;var G=L.zpp_inner;null!=G._invalidate&&G._invalidate(G)}}L.zpp_inner.weak=!1;var q=L;N=N.next,null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts();var U=this.zpp_inner_zn.wrap_lverts,K=q.zpp_inner;null!=K._validate&&K._validate();var W=q.zpp_inner.x,Y=q.zpp_inner;null!=Y._validate&&Y._validate();var J,X=q.zpp_inner.y;if(null==xp.poolVec2?J=new yn:(J=xp.poolVec2,xp.poolVec2=J.zpp_pool,J.zpp_pool=null),null==J.zpp_inner){var H;null==xt.zpp_pool?H=new xt:(H=xt.zpp_pool,xt.zpp_pool=H.next,H.next=null),H.weak=!1,H._immutable=!1,H.x=W,H.y=X,J.zpp_inner=H,J.zpp_inner.outer=J}else{var $,Q=J.zpp_inner;if(null!=Q._validate&&Q._validate(),J.zpp_inner.x==W){var nn=J.zpp_inner;null!=nn._validate&&nn._validate(),$=J.zpp_inner.y==X}else $=!1;if(!$){J.zpp_inner.x=W,J.zpp_inner.y=X;var en=J.zpp_inner;null!=en._invalidate&&en._invalidate(en)}}J.zpp_inner.weak=!1,U.push(J);var tn=q.zpp_inner;q.zpp_inner.outer=null,q.zpp_inner=null;var ln=q;ln.zpp_pool=xp.poolVec2,xp.poolVec2=ln;var rn=tn;if(null!=rn.outer&&(rn.outer.zpp_inner=null,rn.outer=null),rn._isimmutable=null,rn._validate=null,rn._invalidate=null,rn.next=xt.zpp_pool,xt.zpp_pool=rn,N==T)break}}if(n instanceof Array&&null==n.__enum__)for(var on=n,an=0;an<on.length;){var sn,_n=on[an];if(_n.zpp_inner.weak){var hn=_n.zpp_inner;_n.zpp_inner.outer=null,_n.zpp_inner=null;var un=_n;un.zpp_pool=xp.poolVec2,xp.poolVec2=un;var xn=hn;null!=xn.outer&&(xn.outer.zpp_inner=null,xn.outer=null),xn._isimmutable=null,xn._validate=null,xn._invalidate=null,xn.next=xt.zpp_pool,xt.zpp_pool=xn,sn=!0}else sn=!1;sn?on.splice(an,1):++an}else if(r.__instanceof(n,vn)){var dn=n;null!=dn.zpp_inner._validate&&dn.zpp_inner._validate();for(var cn=dn.zpp_inner.inner,fn=null,mn=cn.head;null!=mn;){var bn=mn.elt;if(bn.outer.zpp_inner.weak){if(mn=cn.erase(fn),bn.outer.zpp_inner.weak){var gn=bn.outer,wn=gn.zpp_inner;gn.zpp_inner.outer=null,gn.zpp_inner=null;var Mn=gn;Mn.zpp_pool=xp.poolVec2,xp.poolVec2=Mn;var Cn=wn;null!=Cn.outer&&(Cn.outer.zpp_inner=null,Cn.outer=null),Cn._isimmutable=null,Cn._validate=null,Cn._invalidate=null,Cn.next=xt.zpp_pool,xt.zpp_pool=Cn}}else fn=mn,mn=mn.next}}null==e?null==mt.zpp_pool?this.zpp_inner.material=new mt:(this.zpp_inner.material=mt.zpp_pool,mt.zpp_pool=this.zpp_inner.material.next,this.zpp_inner.material.next=null):(this.zpp_inner.immutable_midstep("Shape::material"),this.zpp_inner.setMaterial(e.zpp_inner),this.zpp_inner.material.wrapper()),null==t?null==je.zpp_pool?this.zpp_inner.filter=new je:(this.zpp_inner.filter=je.zpp_pool,je.zpp_pool=this.zpp_inner.filter.next,this.zpp_inner.filter.next=null):(this.zpp_inner.immutable_midstep("Shape::filter"),this.zpp_inner.setFilter(t.zpp_inner),this.zpp_inner.filter.wrapper()),this.zpp_inner_i.insert_cbtype(re.ANY_SHAPE.zpp_inner)};Rn.__name__=["nape","shape","Polygon"],Rn.__super__=Nn,Rn.prototype=Object.create(Nn.prototype),Rn.rect=function(n,e,t,i,p){var l;if(null==p&&(p=!1),null==xp.poolVec2?l=new yn:(l=xp.poolVec2,xp.poolVec2=l.zpp_pool,l.zpp_pool=null),null==l.zpp_inner){var r;null==xt.zpp_pool?r=new xt:(r=xt.zpp_pool,xt.zpp_pool=r.next,r.next=null),r.weak=!1,r._immutable=!1,r.x=n,r.y=e,l.zpp_inner=r,l.zpp_inner.outer=l}else{var o,a=l.zpp_inner;if(null!=a._validate&&a._validate(),l.zpp_inner.x==n){var s=l.zpp_inner;null!=s._validate&&s._validate(),o=l.zpp_inner.y==e}else o=!1;if(!o){l.zpp_inner.x=n,l.zpp_inner.y=e;var _=l.zpp_inner;null!=_._invalidate&&_._invalidate(_)}}l.zpp_inner.weak=p;var h,u=l,x=n+t;if(null==xp.poolVec2?h=new yn:(h=xp.poolVec2,xp.poolVec2=h.zpp_pool,h.zpp_pool=null),null==h.zpp_inner){var d;null==xt.zpp_pool?d=new xt:(d=xt.zpp_pool,xt.zpp_pool=d.next,d.next=null),d.weak=!1,d._immutable=!1,d.x=x,d.y=e,h.zpp_inner=d,h.zpp_inner.outer=h}else{var y,z=h.zpp_inner;if(null!=z._validate&&z._validate(),h.zpp_inner.x==x){var v=h.zpp_inner;null!=v._validate&&v._validate(),y=h.zpp_inner.y==e}else y=!1;if(!y){h.zpp_inner.x=x,h.zpp_inner.y=e;var c=h.zpp_inner;null!=c._invalidate&&c._invalidate(c)}}h.zpp_inner.weak=p;var f,m=h,b=n+t,g=e+i;if(null==xp.poolVec2?f=new yn:(f=xp.poolVec2,xp.poolVec2=f.zpp_pool,f.zpp_pool=null),null==f.zpp_inner){var w;null==xt.zpp_pool?w=new xt:(w=xt.zpp_pool,xt.zpp_pool=w.next,w.next=null),w.weak=!1,w._immutable=!1,w.x=b,w.y=g,f.zpp_inner=w,f.zpp_inner.outer=f}else{var M,C=f.zpp_inner;if(null!=C._validate&&C._validate(),f.zpp_inner.x==b){var k=f.zpp_inner;null!=k._validate&&k._validate(),M=f.zpp_inner.y==g}else M=!1;if(!M){f.zpp_inner.x=b,f.zpp_inner.y=g;var O=f.zpp_inner;null!=O._invalidate&&O._invalidate(O)}}f.zpp_inner.weak=p;var P,S=f,A=e+i;if(null==xp.poolVec2?P=new yn:(P=xp.poolVec2,xp.poolVec2=P.zpp_pool,P.zpp_pool=null),null==P.zpp_inner){var j;null==xt.zpp_pool?j=new xt:(j=xt.zpp_pool,xt.zpp_pool=j.next,j.next=null),j.weak=!1,j._immutable=!1,j.x=n,j.y=A,P.zpp_inner=j,P.zpp_inner.outer=P}else{var E,I=P.zpp_inner;if(null!=I._validate&&I._validate(),P.zpp_inner.x==n){var T=P.zpp_inner;null!=T._validate&&T._validate(),E=P.zpp_inner.y==A}else E=!1;if(!E){P.zpp_inner.x=n,P.zpp_inner.y=A;var N=P.zpp_inner;null!=N._invalidate&&N._invalidate(N)}}return P.zpp_inner.weak=p,[u,m,S,P]},Rn.box=function(n,e,t){return null==t&&(t=!1),Rn.rect(-n/2,-e/2,n,e,t)},Rn.regular=function(n,e,t,i,p){null==p&&(p=!1),null==i&&(i=0);for(var l=[],r=2*Math.PI/t,o=0;o<t;){var a,s=o++*r+i,_=Math.cos(s)*n,h=Math.sin(s)*e;if(null==xp.poolVec2?a=new yn:(a=xp.poolVec2,xp.poolVec2=a.zpp_pool,a.zpp_pool=null),null==a.zpp_inner){var u;null==xt.zpp_pool?u=new xt:(u=xt.zpp_pool,xt.zpp_pool=u.next,u.next=null),u.weak=!1,u._immutable=!1,u.x=_,u.y=h,a.zpp_inner=u,a.zpp_inner.outer=a}else{var x,d=a.zpp_inner;if(null!=d._validate&&d._validate(),a.zpp_inner.x==_){var y=a.zpp_inner;null!=y._validate&&y._validate(),x=a.zpp_inner.y==h}else x=!1;if(!x){a.zpp_inner.x=_,a.zpp_inner.y=h;var z=a.zpp_inner;null!=z._invalidate&&z._invalidate(z)}}a.zpp_inner.weak=p,l.push(a)}return l},Rn.prototype.zpp_inner_zn=null,Rn.prototype.get_localVerts=function(){return null==this.zpp_inner_zn.wrap_lverts&&this.zpp_inner_zn.getlverts(),this.zpp_inner_zn.wrap_lverts},Rn.prototype.get_worldVerts=function(){return null==this.zpp_inner_zn.wrap_gverts&&this.zpp_inner_zn.getgverts(),this.zpp_inner_zn.wrap_gverts},Rn.prototype.get_edges=function(){return null==this.zpp_inner_zn.wrap_edges&&this.zpp_inner_zn.getedges(),this.zpp_inner_zn.wrap_edges},Rn.prototype.validity=function(){return this.zpp_inner_zn.valid()},Object.defineProperty(Rn.prototype,"localVerts",{get:Rn.prototype.get_localVerts}),Object.defineProperty(Rn.prototype,"worldVerts",{get:Rn.prototype.get_worldVerts}),Object.defineProperty(Rn.prototype,"edges",{get:Rn.prototype.get_edges}),Rn.prototype.__class__=Rn;var Zn=nape.shape.ShapeIterator=function(){this.zpp_next=null,this.zpp_critical=!1,this.zpp_i=0,this.zpp_inner=null};Zn.__name__=["nape","shape","ShapeIterator"],Zn.get=function(n){var e;if(null==Zn.zpp_pool){ap.internal=!0;var t=new Zn;ap.internal=!1,e=t}else{var i=Zn.zpp_pool;Zn.zpp_pool=i.zpp_next,e=i}return e.zpp_i=0,e.zpp_inner=n,e.zpp_critical=!1,e},Zn.prototype.zpp_inner=null,Zn.prototype.zpp_i=null,Zn.prototype.zpp_critical=null,Zn.prototype.zpp_next=null,Zn.prototype.hasNext=function(){this.zpp_inner.zpp_inner.valmod();var n=this.zpp_inner;n.zpp_inner.valmod(),n.zpp_inner.zip_length&&(n.zpp_inner.zip_length=!1,n.zpp_inner.user_length=n.zpp_inner.inner.length);var e=n.zpp_inner.user_length;return this.zpp_critical=!0,this.zpp_i<e||(this.zpp_next=Zn.zpp_pool,Zn.zpp_pool=this,this.zpp_inner=null,!1)},Zn.prototype.next=function(){return this.zpp_critical=!1,this.zpp_inner.at(this.zpp_i++)},Zn.prototype.__class__=Zn;var Bn=nape.shape.ShapeList=function(){this.zpp_inner=null,this.zpp_inner=new ap,this.zpp_inner.outer=this};Bn.__name__=["nape","shape","ShapeList"],Bn.fromArray=function(n){for(var e=new Bn,t=0;t<n.length;){var i=n[t];++t,e.push(i)}return e},Bn.prototype.zpp_inner=null,Bn.prototype.get_length=function(){return this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),this.zpp_inner.user_length},Bn.prototype.has=function(n){return this.zpp_inner.valmod(),this.zpp_inner.inner.has(n.zpp_inner)},Bn.prototype.at=function(n){if(this.zpp_inner.valmod(),this.zpp_inner.reverse_flag&&(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),n=this.zpp_inner.user_length-1-n),n<this.zpp_inner.at_index||null==this.zpp_inner.at_ite)this.zpp_inner.at_index=n,this.zpp_inner.at_ite=this.zpp_inner.inner.iterator_at(n);else for(;this.zpp_inner.at_index!=n;)this.zpp_inner.at_index++,this.zpp_inner.at_ite=this.zpp_inner.at_ite.next;return this.zpp_inner.at_ite.elt.outer},Bn.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag)this.zpp_inner.inner.add(n.zpp_inner);else{var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},Bn.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);if(e){if(this.zpp_inner.reverse_flag){var t;if(null==this.zpp_inner.push_ite)null==this.zpp_inner.inner.head?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-1)),this.zpp_inner.push_ite=t;this.zpp_inner.push_ite=this.zpp_inner.inner.insert(this.zpp_inner.push_ite,n.zpp_inner)}else this.zpp_inner.inner.add(n.zpp_inner);this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)}return e},Bn.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(e),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}else{var t;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?t=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),t=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var i=(n=null==t?this.zpp_inner.inner.head.elt:t.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(t)}return this.zpp_inner.invalidate(),n.outer},Bn.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_inner.valmod();var n=null;if(this.zpp_inner.reverse_flag){var e;null!=this.zpp_inner.at_ite&&null==this.zpp_inner.at_ite.next&&(this.zpp_inner.at_ite=null),this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),1==this.zpp_inner.user_length?e=null:(this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e=this.zpp_inner.inner.iterator_at(this.zpp_inner.user_length-2));var t=(n=null==e?this.zpp_inner.inner.head.elt:e.next.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.zpp_inner.inner.erase(e)}else{var i=(n=this.zpp_inner.inner.head.elt).outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.zpp_inner.inner.pop()}return this.zpp_inner.invalidate(),n.outer},Bn.prototype.add=function(n){return this.zpp_inner.reverse_flag?this.push(n):this.unshift(n)},Bn.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_inner.valmod(),e=!1;for(var t=this.zpp_inner.inner.head;null!=t;){if(t.elt==n.zpp_inner){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.zpp_inner.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},Bn.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;null!=this.zpp_inner.inner.head;)this.pop();else for(;null!=this.zpp_inner.inner.head;)this.shift()},Bn.prototype.empty=function(){return null==this.zpp_inner.inner.head},Bn.prototype.iterator=function(){return this.zpp_inner.valmod(),Zn.get(this)},Bn.prototype.copy=function(n){null==n&&(n=!1);var e=new Bn;this.zpp_inner.valmod();for(var t=Zn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=Zn.zpp_pool,Zn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e.push(n?null:r)}return e},Bn.prototype.merge=function(n){n.zpp_inner.valmod();for(var e=Zn.get(n);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=Zn.zpp_pool,Zn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;e.zpp_critical=!1;var l=e.zpp_inner.at(e.zpp_i++);this.has(l)||(this.zpp_inner.reverse_flag?this.push(l):this.unshift(l))}},Bn.prototype.toString=function(){var n="[",e=!0;this.zpp_inner.valmod();for(var t=Zn.get(this);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=Zn.zpp_pool,Zn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);e||(n+=","),n+=null==r?"NULL":r.toString(),e=!1}return n+"]"},Bn.prototype.foreach=function(n){this.zpp_inner.valmod();for(var e=Zn.get(this);;){e.zpp_inner.zpp_inner.valmod();var t=e.zpp_inner;t.zpp_inner.valmod(),t.zpp_inner.zip_length&&(t.zpp_inner.zip_length=!1,t.zpp_inner.user_length=t.zpp_inner.inner.length);var i,p=t.zpp_inner.user_length;if(e.zpp_critical=!0,e.zpp_i<p?i=!0:(e.zpp_next=Zn.zpp_pool,Zn.zpp_pool=e,e.zpp_inner=null,i=!1),!i)break;try{e.zpp_critical=!1,n(e.zpp_inner.at(e.zpp_i++))}catch(n){e.zpp_next=Zn.zpp_pool,Zn.zpp_pool=e,e.zpp_inner=null;break}}return this},Bn.prototype.filter=function(n){for(var e=0;this.zpp_inner.valmod(),this.zpp_inner.zip_length&&(this.zpp_inner.zip_length=!1,this.zpp_inner.user_length=this.zpp_inner.inner.length),e<this.zpp_inner.user_length;){var t=this.at(e);try{n(t)?++e:this.remove(t)}catch(n){break}}return this},Object.defineProperty(Bn.prototype,"length",{get:Bn.prototype.get_length}),Bn.prototype.__class__=Bn;var Gn=nape.shape.ShapeType=function(){};Gn.__name__=["nape","shape","ShapeType"],Gn.CIRCLE=null,Gn.get_CIRCLE=function(){return null==oe.ShapeType_CIRCLE&&(oe.internal=!0,oe.ShapeType_CIRCLE=new Gn,oe.internal=!1),oe.ShapeType_CIRCLE},Gn.POLYGON=null,Gn.get_POLYGON=function(){return null==oe.ShapeType_POLYGON&&(oe.internal=!0,oe.ShapeType_POLYGON=new Gn,oe.internal=!1),oe.ShapeType_POLYGON},Gn.prototype.toString=function(){return null==oe.ShapeType_CIRCLE&&(oe.internal=!0,oe.ShapeType_CIRCLE=new Gn,oe.internal=!1),this==oe.ShapeType_CIRCLE?"CIRCLE":(null==oe.ShapeType_POLYGON&&(oe.internal=!0,oe.ShapeType_POLYGON=new Gn,oe.internal=!1),this==oe.ShapeType_POLYGON?"POLYGON":"")},Object.defineProperty(Gn,"CIRCLE",{get:Gn.get_CIRCLE}),Object.defineProperty(Gn,"POLYGON",{get:Gn.get_POLYGON}),Gn.prototype.__class__=Gn;var qn=nape.shape.ValidationResult=function(){};qn.__name__=["nape","shape","ValidationResult"],qn.VALID=null,qn.get_VALID=function(){return null==oe.ValidationResult_VALID&&(oe.internal=!0,oe.ValidationResult_VALID=new qn,oe.internal=!1),oe.ValidationResult_VALID},qn.DEGENERATE=null,qn.get_DEGENERATE=function(){return null==oe.ValidationResult_DEGENERATE&&(oe.internal=!0,oe.ValidationResult_DEGENERATE=new qn,oe.internal=!1),oe.ValidationResult_DEGENERATE},qn.CONCAVE=null,qn.get_CONCAVE=function(){return null==oe.ValidationResult_CONCAVE&&(oe.internal=!0,oe.ValidationResult_CONCAVE=new qn,oe.internal=!1),oe.ValidationResult_CONCAVE},qn.SELF_INTERSECTING=null,qn.get_SELF_INTERSECTING=function(){return null==oe.ValidationResult_SELF_INTERSECTING&&(oe.internal=!0,oe.ValidationResult_SELF_INTERSECTING=new qn,oe.internal=!1),oe.ValidationResult_SELF_INTERSECTING},qn.prototype.toString=function(){return null==oe.ValidationResult_VALID&&(oe.internal=!0,oe.ValidationResult_VALID=new qn,oe.internal=!1),this==oe.ValidationResult_VALID?"VALID":(null==oe.ValidationResult_DEGENERATE&&(oe.internal=!0,oe.ValidationResult_DEGENERATE=new qn,oe.internal=!1),this==oe.ValidationResult_DEGENERATE?"DEGENERATE":(null==oe.ValidationResult_CONCAVE&&(oe.internal=!0,oe.ValidationResult_CONCAVE=new qn,oe.internal=!1),this==oe.ValidationResult_CONCAVE?"CONCAVE":(null==oe.ValidationResult_SELF_INTERSECTING&&(oe.internal=!0,oe.ValidationResult_SELF_INTERSECTING=new qn,oe.internal=!1),this==oe.ValidationResult_SELF_INTERSECTING?"SELF_INTERSECTING":"")))},Object.defineProperty(qn,"VALID",{get:qn.get_VALID}),Object.defineProperty(qn,"DEGENERATE",{get:qn.get_DEGENERATE}),Object.defineProperty(qn,"CONCAVE",{get:qn.get_CONCAVE}),Object.defineProperty(qn,"SELF_INTERSECTING",{get:qn.get_SELF_INTERSECTING}),qn.prototype.__class__=qn;var Un=nape.space.Broadphase=function(){};Un.__name__=["nape","space","Broadphase"],Un.DYNAMIC_AABB_TREE=null,Un.get_DYNAMIC_AABB_TREE=function(){return null==oe.Broadphase_DYNAMIC_AABB_TREE&&(oe.internal=!0,oe.Broadphase_DYNAMIC_AABB_TREE=new Un,oe.internal=!1),oe.Broadphase_DYNAMIC_AABB_TREE},Un.SWEEP_AND_PRUNE=null,Un.get_SWEEP_AND_PRUNE=function(){return null==oe.Broadphase_SWEEP_AND_PRUNE&&(oe.internal=!0,oe.Broadphase_SWEEP_AND_PRUNE=new Un,oe.internal=!1),oe.Broadphase_SWEEP_AND_PRUNE},Un.prototype.toString=function(){return null==oe.Broadphase_DYNAMIC_AABB_TREE&&(oe.internal=!0,oe.Broadphase_DYNAMIC_AABB_TREE=new Un,oe.internal=!1),this==oe.Broadphase_DYNAMIC_AABB_TREE?"DYNAMIC_AABB_TREE":(null==oe.Broadphase_SWEEP_AND_PRUNE&&(oe.internal=!0,oe.Broadphase_SWEEP_AND_PRUNE=new Un,oe.internal=!1),this==oe.Broadphase_SWEEP_AND_PRUNE?"SWEEP_AND_PRUNE":"")},Object.defineProperty(Un,"DYNAMIC_AABB_TREE",{get:Un.get_DYNAMIC_AABB_TREE}),Object.defineProperty(Un,"SWEEP_AND_PRUNE",{get:Un.get_SWEEP_AND_PRUNE}),Un.prototype.__class__=Un;var Kn=nape.space.Space=function(n,e){if(this.zpp_inner=null,this.zpp_inner=new Tt(null==n?null:n.zpp_inner,e),this.zpp_inner.outer=this,null!=n&&n.zpp_inner.weak){var t=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t}};Kn.__name__=["nape","space","Space"],Kn.prototype.zpp_inner=null,Kn.prototype.get_userData=function(){return null==this.zpp_inner.userData&&(this.zpp_inner.userData={}),this.zpp_inner.userData},Kn.prototype.get_gravity=function(){return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},Kn.prototype.set_gravity=function(n){null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity();var e=this.zpp_inner.wrap_gravity,t=n.zpp_inner;null!=t._validate&&t._validate();var i=n.zpp_inner.x,p=n.zpp_inner;null!=p._validate&&p._validate();var l,r=n.zpp_inner.y,o=e.zpp_inner;if(null!=o._validate&&o._validate(),e.zpp_inner.x==i){var a=e.zpp_inner;null!=a._validate&&a._validate(),l=e.zpp_inner.y==r}else l=!1;if(!l){e.zpp_inner.x=i,e.zpp_inner.y=r;var s=e.zpp_inner;null!=s._invalidate&&s._invalidate(s)}if(n.zpp_inner.weak){var _=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_}return null==this.zpp_inner.wrap_gravity&&this.zpp_inner.getgravity(),this.zpp_inner.wrap_gravity},Kn.prototype.get_broadphase=function(){return this.zpp_inner.bphase.is_sweep?(null==oe.Broadphase_SWEEP_AND_PRUNE&&(oe.internal=!0,oe.Broadphase_SWEEP_AND_PRUNE=new Un,oe.internal=!1),oe.Broadphase_SWEEP_AND_PRUNE):(null==oe.Broadphase_DYNAMIC_AABB_TREE&&(oe.internal=!0,oe.Broadphase_DYNAMIC_AABB_TREE=new Un,oe.internal=!1),oe.Broadphase_DYNAMIC_AABB_TREE)},Kn.prototype.get_sortContacts=function(){return this.zpp_inner.sortcontacts},Kn.prototype.set_sortContacts=function(n){return this.zpp_inner.sortcontacts=n,this.zpp_inner.sortcontacts},Kn.prototype.get_worldAngularDrag=function(){return this.zpp_inner.global_ang_drag},Kn.prototype.set_worldAngularDrag=function(n){return this.zpp_inner.global_ang_drag=n,this.zpp_inner.global_ang_drag},Kn.prototype.get_worldLinearDrag=function(){return this.zpp_inner.global_lin_drag},Kn.prototype.set_worldLinearDrag=function(n){return this.zpp_inner.global_lin_drag=n,this.zpp_inner.global_lin_drag},Kn.prototype.get_compounds=function(){return this.zpp_inner.wrap_compounds},Kn.prototype.get_bodies=function(){return this.zpp_inner.wrap_bodies},Kn.prototype.get_liveBodies=function(){return this.zpp_inner.wrap_live},Kn.prototype.get_constraints=function(){return this.zpp_inner.wrap_constraints},Kn.prototype.get_liveConstraints=function(){return this.zpp_inner.wrap_livecon},Kn.prototype.visitBodies=function(n){var e=this.zpp_inner.wrap_bodies;e.zpp_inner.valmod();for(var t=gn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=gn.zpp_pool,gn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var o=kn.get(r);;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var s,_=a.zpp_inner.user_length;if(o.zpp_critical=!0,o.zpp_i<_?s=!0:(o.zpp_next=kn.zpp_pool,kn.zpp_pool=o,o.zpp_inner=null,s=!1),!s)break;o.zpp_critical=!1,o.zpp_inner.at(o.zpp_i++).visitBodies(n)}},Kn.prototype.visitConstraints=function(n){var e=this.zpp_inner.wrap_constraints;e.zpp_inner.valmod();for(var t=A.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=A.zpp_pool,A.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1,n(t.zpp_inner.at(t.zpp_i++))}var r=this.zpp_inner.wrap_compounds;r.zpp_inner.valmod();for(var o=kn.get(r);;){o.zpp_inner.zpp_inner.valmod();var a=o.zpp_inner;a.zpp_inner.valmod(),a.zpp_inner.zip_length&&(a.zpp_inner.zip_length=!1,a.zpp_inner.user_length=a.zpp_inner.inner.length);var s,_=a.zpp_inner.user_length;if(o.zpp_critical=!0,o.zpp_i<_?s=!0:(o.zpp_next=kn.zpp_pool,kn.zpp_pool=o,o.zpp_inner=null,s=!1),!s)break;o.zpp_critical=!1,o.zpp_inner.at(o.zpp_i++).visitConstraints(n)}},Kn.prototype.visitCompounds=function(n){var e=this.zpp_inner.wrap_compounds;e.zpp_inner.valmod();for(var t=kn.get(e);;){t.zpp_inner.zpp_inner.valmod();var i=t.zpp_inner;i.zpp_inner.valmod(),i.zpp_inner.zip_length&&(i.zpp_inner.zip_length=!1,i.zpp_inner.user_length=i.zpp_inner.inner.length);var p,l=i.zpp_inner.user_length;if(t.zpp_critical=!0,t.zpp_i<l?p=!0:(t.zpp_next=kn.zpp_pool,kn.zpp_pool=t,t.zpp_inner=null,p=!1),!p)break;t.zpp_critical=!1;var r=t.zpp_inner.at(t.zpp_i++);n(r),r.visitCompounds(n)}},Kn.prototype.get_world=function(){return this.zpp_inner.__static},Kn.prototype.get_arbiters=function(){if(null==this.zpp_inner.wrap_arbiters){var n=new Ie;n.space=this.zpp_inner,this.zpp_inner.wrap_arbiters=n}return this.zpp_inner.wrap_arbiters},Kn.prototype.get_listeners=function(){return this.zpp_inner.wrap_listeners},Kn.prototype.clear=function(){this.zpp_inner.clear()},Kn.prototype.step=function(n,e,t){null==t&&(t=10),null==e&&(e=10),this.zpp_inner.step(n,e,t)},Kn.prototype.get_timeStamp=function(){return this.zpp_inner.stamp},Kn.prototype.get_elapsedTime=function(){return this.zpp_inner.time},Kn.prototype.interactionType=function(n,e){if(1==(null!=n.zpp_inner.body?n.zpp_inner.body.outer:null).zpp_inner.type&&1==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null).zpp_inner.type)return null;if((null!=n.zpp_inner.body?n.zpp_inner.body.outer:null)==(null!=e.zpp_inner.body?e.zpp_inner.body.outer:null))return null;var t,i=n.zpp_inner,p=e.zpp_inner,l=i.body,r=p.body;t=!1;for(var o,a,s=l.constraints.head;null!=s;){var _=s.elt;if(_.ignore&&_.pair_exists(l.id,r.id)){t=!0;break}s=s.next}if(t)a=!1;else{for(var h=i;null!=h&&null==h.group;)h=null!=h.ishape?h.ishape.body:null!=h.icompound?h.icompound.compound:h.ibody.compound;var u,x=null==h?null:h.group;if(null==x)u=!1;else{for(var d=p;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var y=null==d?null:d.group;if(null==y)u=!1;else{for(var z=!1;null!=x&&null!=y;){if(x==y){z=x.ignore;break}x.depth<y.depth?y=y.group:x=x.group}u=z}}a=!u}if(a){var v;if(i.sensorEnabled||p.sensorEnabled){var c=i.filter,f=p.filter;v=0!=(c.sensorMask&f.sensorGroup)&&0!=(f.sensorMask&c.sensorGroup)}else v=!1;if(v)o=2;else{var b;if(i.fluidEnabled||p.fluidEnabled){var g=i.filter,w=p.filter;b=0!=(g.fluidMask&w.fluidGroup)&&0!=(w.fluidMask&g.fluidGroup)}else b=!1;if(!!b&&!(0==l.imass&&0==r.imass&&0==l.iinertia&&0==r.iinertia))o=0;else{var M=i.filter,C=p.filter;o=0!=(M.collisionMask&C.collisionGroup)&&0!=(C.collisionMask&M.collisionGroup)&&!(0==l.imass&&0==r.imass&&0==l.iinertia&&0==r.iinertia)?1:-1}}}else o=-1;switch(o){case 0:return null==oe.InteractionType_FLUID&&(oe.internal=!0,oe.InteractionType_FLUID=new m,oe.internal=!1),oe.InteractionType_FLUID;case 1:return null==oe.InteractionType_COLLISION&&(oe.internal=!0,oe.InteractionType_COLLISION=new m,oe.internal=!1),oe.InteractionType_COLLISION;case 2:return null==oe.InteractionType_SENSOR&&(oe.internal=!0,oe.InteractionType_SENSOR=new m,oe.internal=!1),oe.InteractionType_SENSOR;default:return null}},Kn.prototype.shapesUnderPoint=function(n,e,t){var i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.shapesUnderPoint(p,n.zpp_inner.y,null==e?null:e.zpp_inner,t);if(n.zpp_inner.weak){var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=xt.zpp_pool,xt.zpp_pool=o}return r},Kn.prototype.bodiesUnderPoint=function(n,e,t){var i=n.zpp_inner;null!=i._validate&&i._validate();var p=n.zpp_inner.x,l=n.zpp_inner;null!=l._validate&&l._validate();var r=this.zpp_inner.bodiesUnderPoint(p,n.zpp_inner.y,null==e?null:e.zpp_inner,t);if(n.zpp_inner.weak){var o=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=o.outer&&(o.outer.zpp_inner=null,o.outer=null),o._isimmutable=null,o._validate=null,o._invalidate=null,o.next=xt.zpp_pool,xt.zpp_pool=o}return r},Kn.prototype.shapesInAABB=function(n,e,t,i,p){return null==t&&(t=!0),null==e&&(e=!1),this.zpp_inner.shapesInAABB(n,t,e,null==i?null:i.zpp_inner,p)},Kn.prototype.bodiesInAABB=function(n,e,t,i,p){return null==t&&(t=!0),null==e&&(e=!1),this.zpp_inner.bodiesInAABB(n,t,e,null==i?null:i.zpp_inner,p)},Kn.prototype.shapesInCircle=function(n,e,t,i,p){null==t&&(t=!1);var l=this.zpp_inner.shapesInCircle(n,e,t,null==i?null:i.zpp_inner,p);if(n.zpp_inner.weak){var r=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r}return l},Kn.prototype.bodiesInCircle=function(n,e,t,i,p){null==t&&(t=!1);var l=this.zpp_inner.bodiesInCircle(n,e,t,null==i?null:i.zpp_inner,p);if(n.zpp_inner.weak){var r=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r}return l},Kn.prototype.shapesInShape=function(n,e,t,i){return null==e&&(e=!1),this.zpp_inner.shapesInShape(n.zpp_inner,e,null==t?null:t.zpp_inner,i)},Kn.prototype.bodiesInShape=function(n,e,t,i){return null==e&&(e=!1),this.zpp_inner.bodiesInShape(n.zpp_inner,e,null==t?null:t.zpp_inner,i)},Kn.prototype.shapesInBody=function(n,e,t){var i=null==t?new Bn:t,p=n.zpp_inner.wrap_shapes;p.zpp_inner.valmod();for(var l=Zn.get(p);;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(l.zpp_critical=!0,l.zpp_i<a?o=!0:(l.zpp_next=Zn.zpp_pool,Zn.zpp_pool=l,l.zpp_inner=null,o=!1),!o)break;l.zpp_critical=!1,this.shapesInShape(l.zpp_inner.at(l.zpp_i++),!1,e,i)}return i},Kn.prototype.bodiesInBody=function(n,e,t){var i=null==t?new wn:t,p=n.zpp_inner.wrap_shapes;p.zpp_inner.valmod();for(var l=Zn.get(p);;){l.zpp_inner.zpp_inner.valmod();var r=l.zpp_inner;r.zpp_inner.valmod(),r.zpp_inner.zip_length&&(r.zpp_inner.zip_length=!1,r.zpp_inner.user_length=r.zpp_inner.inner.length);var o,a=r.zpp_inner.user_length;if(l.zpp_critical=!0,l.zpp_i<a?o=!0:(l.zpp_next=Zn.zpp_pool,Zn.zpp_pool=l,l.zpp_inner=null,o=!1),!o)break;l.zpp_critical=!1,this.bodiesInShape(l.zpp_inner.at(l.zpp_i++),!1,e,i)}return i},Kn.prototype.convexCast=function(n,e,t,i){return null==t&&(t=!1),this.zpp_inner.convexCast(n.zpp_inner,e,i,t)},Kn.prototype.convexMultiCast=function(n,e,t,i,p){return null==t&&(t=!1),this.zpp_inner.convexMultiCast(n.zpp_inner,e,i,t,p)},Kn.prototype.rayCast=function(n,e,t){return null==e&&(e=!1),this.zpp_inner.rayCast(n,e,t)},Kn.prototype.rayMultiCast=function(n,e,t,i){return null==e&&(e=!1),this.zpp_inner.rayMultiCast(n,e,t,i)},Object.defineProperty(Kn.prototype,"userData",{get:Kn.prototype.get_userData}),Object.defineProperty(Kn.prototype,"gravity",{get:Kn.prototype.get_gravity,set:Kn.prototype.set_gravity}),Object.defineProperty(Kn.prototype,"broadphase",{get:Kn.prototype.get_broadphase}),Object.defineProperty(Kn.prototype,"sortContacts",{get:Kn.prototype.get_sortContacts,set:Kn.prototype.set_sortContacts}),Object.defineProperty(Kn.prototype,"worldAngularDrag",{get:Kn.prototype.get_worldAngularDrag,set:Kn.prototype.set_worldAngularDrag}),Object.defineProperty(Kn.prototype,"worldLinearDrag",{get:Kn.prototype.get_worldLinearDrag,set:Kn.prototype.set_worldLinearDrag}),Object.defineProperty(Kn.prototype,"compounds",{get:Kn.prototype.get_compounds}),Object.defineProperty(Kn.prototype,"bodies",{get:Kn.prototype.get_bodies}),Object.defineProperty(Kn.prototype,"liveBodies",{get:Kn.prototype.get_liveBodies}),Object.defineProperty(Kn.prototype,"constraints",{get:Kn.prototype.get_constraints}),Object.defineProperty(Kn.prototype,"liveConstraints",{get:Kn.prototype.get_liveConstraints}),Object.defineProperty(Kn.prototype,"world",{get:Kn.prototype.get_world}),Object.defineProperty(Kn.prototype,"arbiters",{get:Kn.prototype.get_arbiters}),Object.defineProperty(Kn.prototype,"listeners",{get:Kn.prototype.get_listeners}),Object.defineProperty(Kn.prototype,"timeStamp",{get:Kn.prototype.get_timeStamp}),Object.defineProperty(Kn.prototype,"elapsedTime",{get:Kn.prototype.get_elapsedTime}),Kn.prototype.__class__=Kn;var Wn=nape.util.Debug=function(){};Wn.__name__=["nape","util","Debug"],Wn.version=function(){return"Nape 2.0.19"},Wn.clearObjectPools=function(){for(;null!=A.zpp_pool;){var n=A.zpp_pool.zpp_next;A.zpp_pool.zpp_next=null,A.zpp_pool=n}for(;null!=jn.zpp_pool;){var e=jn.zpp_pool.zpp_next;jn.zpp_pool.zpp_next=null,jn.zpp_pool=e}for(;null!=gn.zpp_pool;){var t=gn.zpp_pool.zpp_next;gn.zpp_pool.zpp_next=null,gn.zpp_pool=t}for(;null!=kn.zpp_pool;){var i=kn.zpp_pool.zpp_next;kn.zpp_pool.zpp_next=null,kn.zpp_pool=i}for(;null!=b.zpp_pool;){var p=b.zpp_pool.zpp_next;b.zpp_pool.zpp_next=null,b.zpp_pool=p}for(;null!=d.zpp_pool;){var l=d.zpp_pool.zpp_next;d.zpp_pool.zpp_next=null,d.zpp_pool=l}for(;null!=nn.zpp_pool;){var r=nn.zpp_pool.zpp_next;nn.zpp_pool.zpp_next=null,nn.zpp_pool=r}for(;null!=ln.zpp_pool;){var o=ln.zpp_pool.zpp_next;ln.zpp_pool.zpp_next=null,ln.zpp_pool=o}for(;null!=zn.zpp_pool;){var a=zn.zpp_pool.zpp_next;zn.zpp_pool.zpp_next=null,zn.zpp_pool=a}for(;null!=xn.zpp_pool;){var s=xn.zpp_pool.zpp_next;xn.zpp_pool.zpp_next=null,xn.zpp_pool=s}for(;null!=Zn.zpp_pool;){var _=Zn.zpp_pool.zpp_next;Zn.zpp_pool.zpp_next=null,Zn.zpp_pool=_}for(;null!=Dn.zpp_pool;){var h=Dn.zpp_pool.zpp_next;Dn.zpp_pool.zpp_next=null,Dn.zpp_pool=h}for(;null!=U.zpp_pool;){var u=U.zpp_pool.zpp_next;U.zpp_pool.zpp_next=null,U.zpp_pool=u}for(;null!=R.zpp_pool;){var x=R.zpp_pool.zpp_next;R.zpp_pool.zpp_next=null,R.zpp_pool=x}for(;null!=X.zpp_pool;){var y=X.zpp_pool.zpp_next;X.zpp_pool.zpp_next=null,X.zpp_pool=y}for(;null!=yi.zpp_pool;){var z=yi.zpp_pool.next;yi.zpp_pool.next=null,yi.zpp_pool=z}for(;null!=zi.zpp_pool;){var v=zi.zpp_pool.next;zi.zpp_pool.next=null,zi.zpp_pool=v}for(;null!=mt.zpp_pool;){var c=mt.zpp_pool.next;mt.zpp_pool.next=null,mt.zpp_pool=c}for(;null!=vi.zpp_pool;){var f=vi.zpp_pool.next;vi.zpp_pool.next=null,vi.zpp_pool=f}for(;null!=ft.zpp_pool;){var m=ft.zpp_pool.next;ft.zpp_pool.next=null,ft.zpp_pool=m}for(;null!=ci.zpp_pool;){var g=ci.zpp_pool.next;ci.zpp_pool.next=null,ci.zpp_pool=g}for(;null!=fi.zpp_pool;){var w=fi.zpp_pool.next;fi.zpp_pool.next=null,fi.zpp_pool=w}for(;null!=mi.zpp_pool;){var M=mi.zpp_pool.next;mi.zpp_pool.next=null,mi.zpp_pool=M}for(;null!=bi.zpp_pool;){var C=bi.zpp_pool.next;bi.zpp_pool.next=null,bi.zpp_pool=C}for(;null!=dp.zpp_pool;){var k=dp.zpp_pool.next;dp.zpp_pool.next=null,dp.zpp_pool=k}for(;null!=Qn.zpp_pool;){var O=Qn.zpp_pool.next;Qn.zpp_pool.next=null,Qn.zpp_pool=O}for(;null!=gi.zpp_pool;){var P=gi.zpp_pool.next;gi.zpp_pool.next=null,gi.zpp_pool=P}for(;null!=wi.zpp_pool;){var S=wi.zpp_pool.next;wi.zpp_pool.next=null,wi.zpp_pool=S}for(;null!=Mi.zpp_pool;){var j=Mi.zpp_pool.next;Mi.zpp_pool.next=null,Mi.zpp_pool=j}for(;null!=Ci.zpp_pool;){var E=Ci.zpp_pool.next;Ci.zpp_pool.next=null,Ci.zpp_pool=E}for(;null!=Hn.zpp_pool;){var I=Hn.zpp_pool.next;Hn.zpp_pool.next=null,Hn.zpp_pool=I}for(;null!=$n.zpp_pool;){var T=$n.zpp_pool.next;$n.zpp_pool.next=null,$n.zpp_pool=T}for(;null!=ki.zpp_pool;){var N=ki.zpp_pool.next;ki.zpp_pool.next=null,ki.zpp_pool=N}for(;null!=Oi.zpp_pool;){var L=Oi.zpp_pool.next;Oi.zpp_pool.next=null,Oi.zpp_pool=L}for(;null!=Ge.zpp_pool;){var V=Ge.zpp_pool.next;Ge.zpp_pool.next=null,Ge.zpp_pool=V}for(;null!=Ue.zpp_pool;){var D=Ue.zpp_pool.next;Ue.zpp_pool.next=null,Ue.zpp_pool=D}for(;null!=Je.zpp_pool;){var F=Je.zpp_pool.next;Je.zpp_pool.next=null,Je.zpp_pool=F}for(;null!=yp.zpp_pool;){var Z=yp.zpp_pool.next;yp.zpp_pool.next=null,yp.zpp_pool=Z}for(;null!=Fe.zpp_pool;){var B=Fe.zpp_pool.next;Fe.zpp_pool.next=null,Fe.zpp_pool=B}for(;null!=Re.zpp_pool;){var G=Re.zpp_pool.next;Re.zpp_pool.next=null,Re.zpp_pool=G}for(;null!=Pi.zpp_pool;){var q=Pi.zpp_pool.next;Pi.zpp_pool.next=null,Pi.zpp_pool=q}for(;null!=Si.zpp_pool;){var K=Si.zpp_pool.next;Si.zpp_pool.next=null,Si.zpp_pool=K}for(;null!=xt.zpp_pool;){var W=xt.zpp_pool.next;xt.zpp_pool.next=null,xt.zpp_pool=W}for(;null!=Ai.zpp_pool;){var Y=Ai.zpp_pool.next;Ai.zpp_pool.next=null,Ai.zpp_pool=Y}for(;null!=$e.zpp_pool;){var J=$e.zpp_pool.next;$e.zpp_pool.next=null,$e.zpp_pool=J}for(;null!=zp.zpp_pool;){var H=zp.zpp_pool.next;zp.zpp_pool.next=null,zp.zpp_pool=H}for(;null!=rt.zpp_pool;){var $=rt.zpp_pool.next;rt.zpp_pool.next=null,rt.zpp_pool=$}for(;null!=ot.zpp_pool;){var Q=ot.zpp_pool.next;ot.zpp_pool.next=null,ot.zpp_pool=Q}for(;null!=Qe.zpp_pool;){var en=Qe.zpp_pool.next;Qe.zpp_pool.next=null,Qe.zpp_pool=en}for(;null!=ji.zpp_pool;){var tn=ji.zpp_pool.next;ji.zpp_pool.next=null,ji.zpp_pool=tn}for(;null!=Ei.zpp_pool;){var pn=Ei.zpp_pool.next;Ei.zpp_pool.next=null,Ei.zpp_pool=pn}for(;null!=ht.zpp_pool;){var rn=ht.zpp_pool.next;ht.zpp_pool.next=null,ht.zpp_pool=rn}for(;null!=vp.zpp_pool;){var on=vp.zpp_pool.next;vp.zpp_pool.next=null,vp.zpp_pool=on}for(;null!=Ii.zpp_pool;){var an=Ii.zpp_pool.next;Ii.zpp_pool.next=null,Ii.zpp_pool=an}for(;null!=Te.zpp_pool;){var sn=Te.zpp_pool.next;Te.zpp_pool.next=null,Te.zpp_pool=sn}for(;null!=cp.zpp_pool;){var _n=cp.zpp_pool.next;cp.zpp_pool.next=null,cp.zpp_pool=_n}for(;null!=et.zpp_pool;){var hn=et.zpp_pool.next;et.zpp_pool.next=null,et.zpp_pool=hn}for(;null!=tt.zpp_pool;){var un=tt.zpp_pool.next;tt.zpp_pool.next=null,tt.zpp_pool=un}for(;null!=fp.zpp_pool;){var dn=fp.zpp_pool.next;fp.zpp_pool.next=null,fp.zpp_pool=dn}for(;null!=mp.zpp_pool;){var yn=mp.zpp_pool.next;mp.zpp_pool.next=null,mp.zpp_pool=yn}for(;null!=it.zpp_pool;){var vn=it.zpp_pool.next;it.zpp_pool.next=null,it.zpp_pool=vn}for(;null!=Rt.zpp_pool;){var cn=Rt.zpp_pool.next;Rt.zpp_pool.next=null,Rt.zpp_pool=cn}for(;null!=st.zpp_pool;){var fn=st.zpp_pool.next;st.zpp_pool.next=null,st.zpp_pool=fn}for(;null!=Ti.zpp_pool;){var mn=Ti.zpp_pool.next;Ti.zpp_pool.next=null,Ti.zpp_pool=mn}for(;null!=Ni.zpp_pool;){var bn=Ni.zpp_pool.next;Ni.zpp_pool.next=null,Ni.zpp_pool=bn}for(;null!=Ke.zpp_pool;){var wn=Ke.zpp_pool.next;Ke.zpp_pool.next=null,Ke.zpp_pool=wn}for(;null!=We.zpp_pool;){var Mn=We.zpp_pool.next;We.zpp_pool.next=null,We.zpp_pool=Mn}for(;null!=Li.zpp_pool;){var Cn=Li.zpp_pool.next;Li.zpp_pool.next=null,Li.zpp_pool=Cn}for(;null!=wt.zpp_pool;){var On=wt.zpp_pool.next;wt.zpp_pool.next=null,wt.zpp_pool=On}for(;null!=Vi.zpp_pool;){var Pn=Vi.zpp_pool.next;Vi.zpp_pool.next=null,Vi.zpp_pool=Pn}for(;null!=Di.zpp_pool;){var Sn=Di.zpp_pool.next;Di.zpp_pool.next=null,Di.zpp_pool=Sn}for(;null!=Nt.zpp_pool;){var An=Nt.zpp_pool.next;Nt.zpp_pool.next=null,Nt.zpp_pool=An}for(;null!=kt.zpp_pool;){var En=kt.zpp_pool.next;kt.zpp_pool.next=null,kt.zpp_pool=En}for(;null!=Ot.zpp_pool;){var In=Ot.zpp_pool.next;Ot.zpp_pool.next=null,Ot.zpp_pool=In}for(;null!=Fi.zpp_pool;){var Tn=Fi.zpp_pool.next;Fi.zpp_pool.next=null,Fi.zpp_pool=Tn}for(;null!=Se.zpp_pool;){var Nn=Se.zpp_pool.next;Se.zpp_pool.next=null,Se.zpp_pool=Nn}for(;null!=Ri.zpp_pool;){var Ln=Ri.zpp_pool.next;Ri.zpp_pool.next=null,Ri.zpp_pool=Ln}for(;null!=At.zpp_pool;){var Vn=At.zpp_pool.next;At.zpp_pool.next=null,At.zpp_pool=Vn}for(;null!=jt.zpp_pool;){var Fn=jt.zpp_pool.next;jt.zpp_pool.next=null,jt.zpp_pool=Fn}for(;null!=Et.zpp_pool;){var Rn=Et.zpp_pool.next;Et.zpp_pool.next=null,Et.zpp_pool=Rn}for(;null!=ke.zpp_pool;){var Bn=ke.zpp_pool.next;ke.zpp_pool.next=null,ke.zpp_pool=Bn}for(;null!=Oe.zpp_pool;){var Gn=Oe.zpp_pool.next;Oe.zpp_pool.next=null,Oe.zpp_pool=Gn}for(;null!=bp.zpp_pool;){var qn=bp.zpp_pool.next;bp.zpp_pool.next=null,bp.zpp_pool=qn}for(;null!=Zi.zpp_pool;){var Un=Zi.zpp_pool.next;Zi.zpp_pool.next=null,Zi.zpp_pool=Un}for(;null!=Pe.zpp_pool;){var Kn=Pe.zpp_pool.next;Pe.zpp_pool.next=null,Pe.zpp_pool=Kn}for(;null!=Bi.zpp_pool;){var Wn=Bi.zpp_pool.next;Bi.zpp_pool.next=null,Bi.zpp_pool=Wn}for(;null!=Gi.zpp_pool;){var Yn=Gi.zpp_pool.next;Gi.zpp_pool.next=null,Gi.zpp_pool=Yn}for(;null!=qi.zpp_pool;){var Jn=qi.zpp_pool.next;qi.zpp_pool.next=null,qi.zpp_pool=Jn}for(;null!=Ui.zpp_pool;){var Xn=Ui.zpp_pool.next;Ui.zpp_pool.next=null,Ui.zpp_pool=Xn}for(;null!=Ki.zpp_pool;){var ne=Ki.zpp_pool.next;Ki.zpp_pool.next=null,Ki.zpp_pool=ne}for(;null!=je.zpp_pool;){var ee=je.zpp_pool.next;je.zpp_pool.next=null,je.zpp_pool=ee}for(;null!=Wi.zpp_pool;){var te=Wi.zpp_pool.next;Wi.zpp_pool.next=null,Wi.zpp_pool=te}for(;null!=Yi.zpp_pool;){var ie=Yi.zpp_pool.next;Yi.zpp_pool.next=null,Yi.zpp_pool=ie}for(;null!=Ji.zpp_pool;){var pe=Ji.zpp_pool.next;Ji.zpp_pool.next=null,Ji.zpp_pool=pe}for(;null!=xp.poolGeomPoly;){var le=xp.poolGeomPoly.zpp_pool;xp.poolGeomPoly.zpp_pool=null,xp.poolGeomPoly=le}for(;null!=xp.poolVec2;){var re=xp.poolVec2.zpp_pool;xp.poolVec2.zpp_pool=null,xp.poolVec2=re}for(;null!=xp.poolVec3;){var oe=xp.poolVec3.zpp_pool;xp.poolVec3.zpp_pool=null,xp.poolVec3=oe}},Wn.prototype.__class__=Wn;var Yn=sandbox.Main=function(){};Yn.__name__=["sandbox","Main"],Yn.main=function(){},Yn.prototype.__class__=Yn;var Jn=zpp_nape.ZPP_Const=function(){};Jn.__name__=["zpp_nape","ZPP_Const"],Jn.POSINF=function(){return 1/0},Jn.NEGINF=function(){return-1/0},Jn.prototype.__class__=Jn;var Xn=zpp_nape.ZPP_ID=function(){};Xn.__name__=["zpp_nape","ZPP_ID"],Xn.Constraint=function(){return Xn._Constraint++},Xn.Interactor=function(){return Xn._Interactor++},Xn.CbType=function(){return Xn._CbType++},Xn.CbSet=function(){return Xn._CbSet++},Xn.Listener=function(){return Xn._Listener++},Xn.ZPP_SimpleVert=function(){return Xn._ZPP_SimpleVert++},Xn.ZPP_SimpleSeg=function(){return Xn._ZPP_SimpleSeg++},Xn.Space=function(){return Xn._Space++},Xn.InteractionGroup=function(){return Xn._InteractionGroup++},Xn.prototype.__class__=Xn;var Hn=zpp_nape.callbacks.ZPP_Callback=function(){this.constraint=null,this.body=null,this.pre_swapped=!1,this.pre_arbiter=null,this.wrap_arbiters=null,this.set=null,this.int2=null,this.int1=null,this.length=0,this.prev=null,this.next=null,this.index=0,this.space=null,this.listener=null,this.event=0,this.outer_int=null,this.outer_con=null,this.outer_body=null,this.length=0};Hn.__name__=["zpp_nape","callbacks","ZPP_Callback"],Hn.prototype.outer_body=null,Hn.prototype.outer_con=null,Hn.prototype.outer_int=null,Hn.prototype.wrapper_body=function(){return null==this.outer_body&&(this.outer_body=new s,this.outer_body.zpp_inner=this),this.outer_body},Hn.prototype.wrapper_con=function(){return null==this.outer_con&&(this.outer_con=new z,this.outer_con.zpp_inner=this),this.outer_con},Hn.prototype.wrapper_int=function(){return null==this.outer_int&&(this.outer_int=new c,this.outer_int.zpp_inner=this),null==this.wrap_arbiters?this.wrap_arbiters=_p.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null,this.outer_int},Hn.prototype.event=null,Hn.prototype.listener=null,Hn.prototype.space=null,Hn.prototype.index=null,Hn.prototype.next=null,Hn.prototype.prev=null,Hn.prototype.length=null,Hn.prototype.push=function(n){null!=this.prev?this.prev.next=n:this.next=n,n.prev=this.prev,n.next=null,this.prev=n,this.length++},Hn.prototype.push_rev=function(n){null!=this.next?this.next.prev=n:this.prev=n,n.next=this.next,n.prev=null,this.next=n,this.length++},Hn.prototype.pop=function(){var n=this.next;return this.next=n.next,null==this.next?this.prev=null:this.next.prev=null,this.length--,n},Hn.prototype.pop_rev=function(){var n=this.prev;return this.prev=n.prev,null==this.prev?this.next=null:this.prev.next=null,this.length--,n},Hn.prototype.empty=function(){return null==this.next},Hn.prototype.clear=function(){for(;!this.empty();)this.pop()},Hn.prototype.splice=function(n){var e=n.next;return null==n.prev?(this.next=n.next,null!=this.next?this.next.prev=null:this.prev=null):(n.prev.next=n.next,null!=n.next?n.next.prev=n.prev:this.prev=n.prev),this.length--,e},Hn.prototype.rotateL=function(){this.push(this.pop())},Hn.prototype.rotateR=function(){this.push_rev(this.pop_rev())},Hn.prototype.cycleNext=function(n){return null==n.next?this.next:n.next},Hn.prototype.cyclePrev=function(n){return null==n.prev?this.prev:n.prev},Hn.prototype.at=function(n){for(var e=this.next;0!=n--;)e=e.next;return e},Hn.prototype.rev_at=function(n){for(var e=this.prev;0!=n--;)e=e.prev;return e},Hn.prototype.free=function(){this.int1=this.int2=null,this.body=null,this.constraint=null,this.listener=null,null!=this.wrap_arbiters&&(this.wrap_arbiters.zpp_inner.inner=null),this.set=null},Hn.prototype.alloc=function(){},Hn.prototype.int1=null,Hn.prototype.int2=null,Hn.prototype.set=null,Hn.prototype.wrap_arbiters=null,Hn.prototype.pre_arbiter=null,Hn.prototype.pre_swapped=null,Hn.prototype.genarbs=function(){null==this.wrap_arbiters?this.wrap_arbiters=_p.get(this.set.arbiters,!0):this.wrap_arbiters.zpp_inner.inner=this.set.arbiters,this.wrap_arbiters.zpp_inner.zip_length=!0,this.wrap_arbiters.zpp_inner.at_ite=null},Hn.prototype.body=null,Hn.prototype.constraint=null,Hn.prototype.__class__=Hn;var $n=zpp_nape.callbacks.ZPP_CbSet=function(){this.wrap_constraints=null,this.constraints=null,this.wrap_interactors=null,this.interactors=null,this.zip_conlisteners=!1,this.conlisteners=null,this.zip_bodylisteners=!1,this.bodylisteners=null,this.zip_listeners=!1,this.listeners=null,this.cbpairs=null,this.manager=null,this.id=0,this.next=null,this.count=0,this.cbTypes=null,this.cbTypes=new he,this.listeners=new ne,this.zip_listeners=!0,this.bodylisteners=new ee,this.zip_bodylisteners=!0,this.conlisteners=new te,this.zip_conlisteners=!0,this.constraints=new ie,this.interactors=new pe,this.id=Xn.CbSet(),this.cbpairs=new Wt};$n.__name__=["zpp_nape","callbacks","ZPP_CbSet"],$n.setlt=function(n,e){for(var t=n.cbTypes.head,i=e.cbTypes.head;null!=t&&null!=i;){var p=t.elt,l=i.elt;if(p.id<l.id)return!0;if(l.id<p.id)return!1;t=t.next,i=i.next}return null!=i&&null==t},$n.get=function(n){var e;null==$n.zpp_pool?e=new $n:(e=$n.zpp_pool,$n.zpp_pool=e.next,e.next=null);for(var t=null,i=n.head;null!=i;){var p=i.elt;t=e.cbTypes.insert(t,p),p.cbsets.add(e),i=i.next}return e},$n.compatible=function(n,e,t){var i,p=n.options1,l=e.cbTypes;if(p.nonemptyintersection(l,p.includes)&&!p.nonemptyintersection(l,p.excludes)){var r=n.options2,o=t.cbTypes;i=!!r.nonemptyintersection(o,r.includes)&&!r.nonemptyintersection(o,r.excludes)}else i=!1;if(i)return!0;var a=n.options2,s=e.cbTypes;if(a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)){var _=n.options1,h=t.cbTypes;return!!_.nonemptyintersection(h,_.includes)&&!_.nonemptyintersection(h,_.excludes)}return!1},$n.empty_intersection=function(n,e){for(var t,i=null,p=(n.cbpairs.length<e.cbpairs.length?n.cbpairs:e.cbpairs).head;null!=p;){var l=p.elt;if(l.a==n&&l.b==e||l.a==e&&l.b==n){i=l;break}p=p.next}null==i&&(null==Qn.zpp_pool?t=new Qn:(t=Qn.zpp_pool,Qn.zpp_pool=t.next,t.next=null),t.zip_listeners=!0,$n.setlt(n,e)?(t.a=n,t.b=e):(t.a=e,t.b=n),i=t,n.cbpairs.add(i),e!=n&&e.cbpairs.add(i));return i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),null==i.listeners.head},$n.single_intersection=function(n,e,t){for(var i,p=null,l=(n.cbpairs.length<e.cbpairs.length?n.cbpairs:e.cbpairs).head;null!=l;){var r=l.elt;if(r.a==n&&r.b==e||r.a==e&&r.b==n){p=r;break}l=l.next}null==p&&(null==Qn.zpp_pool?i=new Qn:(i=Qn.zpp_pool,Qn.zpp_pool=i.next,i.next=null),i.zip_listeners=!0,$n.setlt(n,e)?(i.a=n,i.b=e):(i.a=e,i.b=n),p=i,n.cbpairs.add(p),e!=n&&e.cbpairs.add(p));p.zip_listeners&&(p.zip_listeners=!1,p.__validate());var o=p.listeners.head;return null!=o&&o.elt==t&&null==o.next},$n.find_all=function(n,e,t,i){for(var p,l=null,r=(n.cbpairs.length<e.cbpairs.length?n.cbpairs:e.cbpairs).head;null!=r;){var o=r.elt;if(o.a==n&&o.b==e||o.a==e&&o.b==n){l=o;break}r=r.next}null==l&&(null==Qn.zpp_pool?p=new Qn:(p=Qn.zpp_pool,Qn.zpp_pool=p.next,p.next=null),p.zip_listeners=!0,$n.setlt(n,e)?(p.a=n,p.b=e):(p.a=e,p.b=n),l=p,n.cbpairs.add(l),e!=n&&e.cbpairs.add(l));l.zip_listeners&&(l.zip_listeners=!1,l.__validate());for(var a=l.listeners.head;null!=a;){var s=a.elt;s.event==t&&i(s),a=a.next}},$n.prototype.cbTypes=null,$n.prototype.count=null,$n.prototype.next=null,$n.prototype.id=null,$n.prototype.manager=null,$n.prototype.cbpairs=null,$n.prototype.increment=function(){this.count++},$n.prototype.decrement=function(){return 0==--this.count},$n.prototype.invalidate_pairs=function(){for(var n=this.cbpairs.head;null!=n;)n.elt.zip_listeners=!0,n=n.next},$n.prototype.listeners=null,$n.prototype.zip_listeners=null,$n.prototype.invalidate_listeners=function(){this.zip_listeners=!0,this.invalidate_pairs()},$n.prototype.validate_listeners=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners())},$n.prototype.realvalidate_listeners=function(){this.listeners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=null,t=this.listeners.head,i=n.elt.listeners.head;null!=i;){var p=i.elt;if(null!=t&&t.elt==p)i=i.next,e=t,t=t.next;else{var l;if(null!=t){var r=t.elt;l=!(p.precedence<=r.precedence)||p.precedence==r.precedence&&p.id>r.id}else l=!0;if(l){if(p.space==this.manager.space){var o,a=this.listeners;null==gi.zpp_pool?o=new gi:(o=gi.zpp_pool,gi.zpp_pool=o.next,o.next=null),o.elt=p;var s=o;null==e?(s.next=a.head,a.head=s):(s.next=e.next,e.next=s),a.pushmod=a.modified=!0,a.length++,e=s}i=i.next}else e=t,t=t.next}}n=n.next}},$n.prototype.bodylisteners=null,$n.prototype.zip_bodylisteners=null,$n.prototype.invalidate_bodylisteners=function(){this.zip_bodylisteners=!0},$n.prototype.validate_bodylisteners=function(){this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners())},$n.prototype.realvalidate_bodylisteners=function(){this.bodylisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=null,t=this.bodylisteners.head,i=n.elt.bodylisteners.head;null!=i;){var p=i.elt;if(null!=t&&t.elt==p)i=i.next,e=t,t=t.next;else{var l;if(null!=t){var r=t.elt;l=!(p.precedence<=r.precedence)||p.precedence==r.precedence&&p.id>r.id}else l=!0;if(l){var o=p.options;if(!o.nonemptyintersection(this.cbTypes,o.excludes)&&p.space==this.manager.space){var a,s=this.bodylisteners;null==Ci.zpp_pool?a=new Ci:(a=Ci.zpp_pool,Ci.zpp_pool=a.next,a.next=null),a.elt=p;var _=a;null==e?(_.next=s.head,s.head=_):(_.next=e.next,e.next=_),s.pushmod=s.modified=!0,s.length++,e=_}i=i.next}else e=t,t=t.next}}n=n.next}},$n.prototype.conlisteners=null,$n.prototype.zip_conlisteners=null,$n.prototype.invalidate_conlisteners=function(){this.zip_conlisteners=!0},$n.prototype.validate_conlisteners=function(){this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},$n.prototype.realvalidate_conlisteners=function(){this.conlisteners.clear();for(var n=this.cbTypes.head;null!=n;){for(var e=null,t=this.conlisteners.head,i=n.elt.conlisteners.head;null!=i;){var p=i.elt;if(null!=t&&t.elt==p)i=i.next,e=t,t=t.next;else{var l;if(null!=t){var r=t.elt;l=!(p.precedence<=r.precedence)||p.precedence==r.precedence&&p.id>r.id}else l=!0;if(l){var o=p.options;if(!o.nonemptyintersection(this.cbTypes,o.excludes)&&p.space==this.manager.space){var a,s=this.conlisteners;null==Oi.zpp_pool?a=new Oi:(a=Oi.zpp_pool,Oi.zpp_pool=a.next,a.next=null),a.elt=p;var _=a;null==e?(_.next=s.head,s.head=_):(_.next=e.next,e.next=_),s.pushmod=s.modified=!0,s.length++,e=_}i=i.next}else e=t,t=t.next}}n=n.next}},$n.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.realvalidate_listeners()),this.zip_bodylisteners&&(this.zip_bodylisteners=!1,this.realvalidate_bodylisteners()),this.zip_conlisteners&&(this.zip_conlisteners=!1,this.realvalidate_conlisteners())},$n.prototype.interactors=null,$n.prototype.wrap_interactors=null,$n.prototype.constraints=null,$n.prototype.wrap_constraints=null,$n.prototype.addConstraint=function(n){this.constraints.add(n)},$n.prototype.addInteractor=function(n){this.interactors.add(n)},$n.prototype.remConstraint=function(n){this.constraints.remove(n)},$n.prototype.remInteractor=function(n){this.interactors.remove(n)},$n.prototype.free=function(){for(this.listeners.clear(),this.zip_listeners=!0,this.bodylisteners.clear(),this.zip_bodylisteners=!0,this.conlisteners.clear(),this.zip_conlisteners=!0;null!=this.cbTypes.head;)this.cbTypes.pop_unsafe().cbsets.remove(this)},$n.prototype.alloc=function(){},$n.prototype.__class__=$n;var Qn=zpp_nape.callbacks.ZPP_CbSetPair=function(){this.listeners=null,this.zip_listeners=!1,this.next=null,this.b=null,this.a=null,this.listeners=new ne};Qn.__name__=["zpp_nape","callbacks","ZPP_CbSetPair"],Qn.get=function(n,e){var t;return null==Qn.zpp_pool?t=new Qn:(t=Qn.zpp_pool,Qn.zpp_pool=t.next,t.next=null),t.zip_listeners=!0,$n.setlt(n,e)?(t.a=n,t.b=e):(t.a=e,t.b=n),t},Qn.setlt=function(n,e){return!!$n.setlt(n.a,e.a)||n.a==e.a&&$n.setlt(n.b,e.b)},Qn.prototype.a=null,Qn.prototype.b=null,Qn.prototype.next=null,Qn.prototype.free=function(){this.a=this.b=null,this.listeners.clear()},Qn.prototype.alloc=function(){this.zip_listeners=!0},Qn.prototype.compatible=function(n){var e,t=n.options1,i=this.a.cbTypes;if(t.nonemptyintersection(i,t.includes)&&!t.nonemptyintersection(i,t.excludes)){var p=n.options2,l=this.b.cbTypes;e=!!p.nonemptyintersection(l,p.includes)&&!p.nonemptyintersection(l,p.excludes)}else e=!1;if(e)return!0;var r=n.options2,o=this.a.cbTypes;if(r.nonemptyintersection(o,r.includes)&&!r.nonemptyintersection(o,r.excludes)){var a=n.options1,s=this.b.cbTypes;return!!a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)}return!1},Qn.prototype.zip_listeners=null,Qn.prototype.listeners=null,Qn.prototype.invalidate=function(){this.zip_listeners=!0},Qn.prototype.validate=function(){this.zip_listeners&&(this.zip_listeners=!1,this.__validate())},Qn.prototype.__validate=function(){this.listeners.clear();for(var n=this.a.listeners.head,e=this.b.listeners.head;null!=n&&null!=e;){var t=n.elt,i=e.elt;if(t==i){var p,l,r=t.options1,o=this.a.cbTypes;if(r.nonemptyintersection(o,r.includes)&&!r.nonemptyintersection(o,r.excludes)){var a=t.options2,s=this.b.cbTypes;l=!!a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)}else l=!1;if(l)p=!0;else{var _=t.options2,h=this.a.cbTypes;if(_.nonemptyintersection(h,_.includes)&&!_.nonemptyintersection(h,_.excludes)){var u=t.options1,x=this.b.cbTypes;p=!!u.nonemptyintersection(x,u.includes)&&!u.nonemptyintersection(x,u.excludes)}else p=!1}p&&this.listeners.add(t),n=n.next,e=e.next}else t.precedence>i.precedence||t.precedence==i.precedence&&t.id>i.id?n=n.next:e=e.next}},Qn.prototype.empty_intersection=function(){return null==this.listeners.head},Qn.prototype.single_intersection=function(n){var e=this.listeners.head;return null!=e&&e.elt==n&&null==e.next},Qn.prototype.forall=function(n,e){for(var t=this.listeners.head;null!=t;){var i=t.elt;i.event==n&&e(i),t=t.next}},Qn.prototype.__class__=Qn;var ne=zpp_nape.util.ZNPList_ZPP_InteractionListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ne.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionListener"],ne.prototype.head=null,ne.prototype.begin=function(){return this.head},ne.prototype.modified=null,ne.prototype.pushmod=null,ne.prototype.length=null,ne.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ne.prototype.add=function(n){var e;null==gi.zpp_pool?e=new gi:(e=gi.zpp_pool,gi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ne.prototype.inlined_add=function(n){var e;null==gi.zpp_pool?e=new gi:(e=gi.zpp_pool,gi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ne.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ne.prototype.insert=function(n,e){var t;null==gi.zpp_pool?t=new gi:(t=gi.zpp_pool,gi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ne.prototype.inlined_insert=function(n,e){var t;null==gi.zpp_pool?t=new gi:(t=gi.zpp_pool,gi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ne.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=gi.zpp_pool,gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ne.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=gi.zpp_pool,gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ne.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ne.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ne.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=gi.zpp_pool,gi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ne.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ne.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=gi.zpp_pool,gi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ne.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=gi.zpp_pool,gi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ne.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=gi.zpp_pool,gi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ne.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=gi.zpp_pool,gi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ne.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ne.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=gi.zpp_pool,gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ne.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=gi.zpp_pool,gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ne.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ne.prototype.empty=function(){return null==this.head},ne.prototype.size=function(){return this.length},ne.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ne.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ne.prototype.front=function(){return this.head.elt},ne.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ne.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ne.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ne.prototype.__class__=ne;var ee=zpp_nape.util.ZNPList_ZPP_BodyListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ee.__name__=["zpp_nape","util","ZNPList_ZPP_BodyListener"],ee.prototype.head=null,ee.prototype.begin=function(){return this.head},ee.prototype.modified=null,ee.prototype.pushmod=null,ee.prototype.length=null,ee.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ee.prototype.add=function(n){var e;null==Ci.zpp_pool?e=new Ci:(e=Ci.zpp_pool,Ci.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ee.prototype.inlined_add=function(n){var e;null==Ci.zpp_pool?e=new Ci:(e=Ci.zpp_pool,Ci.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ee.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ee.prototype.insert=function(n,e){var t;null==Ci.zpp_pool?t=new Ci:(t=Ci.zpp_pool,Ci.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ee.prototype.inlined_insert=function(n,e){var t;null==Ci.zpp_pool?t=new Ci:(t=Ci.zpp_pool,Ci.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ee.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ci.zpp_pool,Ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ee.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ci.zpp_pool,Ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ee.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ee.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ee.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ci.zpp_pool,Ci.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ee.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ee.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ci.zpp_pool,Ci.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ee.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ci.zpp_pool,Ci.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ee.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ci.zpp_pool,Ci.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ee.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ci.zpp_pool,Ci.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ee.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ee.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ci.zpp_pool,Ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ee.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ci.zpp_pool,Ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ee.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ee.prototype.empty=function(){return null==this.head},ee.prototype.size=function(){return this.length},ee.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ee.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ee.prototype.front=function(){return this.head.elt},ee.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ee.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ee.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ee.prototype.__class__=ee;var te=zpp_nape.util.ZNPList_ZPP_ConstraintListener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};te.__name__=["zpp_nape","util","ZNPList_ZPP_ConstraintListener"],te.prototype.head=null,te.prototype.begin=function(){return this.head},te.prototype.modified=null,te.prototype.pushmod=null,te.prototype.length=null,te.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},te.prototype.add=function(n){var e;null==Oi.zpp_pool?e=new Oi:(e=Oi.zpp_pool,Oi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},te.prototype.inlined_add=function(n){var e;null==Oi.zpp_pool?e=new Oi:(e=Oi.zpp_pool,Oi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},te.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},te.prototype.insert=function(n,e){var t;null==Oi.zpp_pool?t=new Oi:(t=Oi.zpp_pool,Oi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},te.prototype.inlined_insert=function(n,e){var t;null==Oi.zpp_pool?t=new Oi:(t=Oi.zpp_pool,Oi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},te.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Oi.zpp_pool,Oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},te.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Oi.zpp_pool,Oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},te.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},te.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},te.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Oi.zpp_pool,Oi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},te.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},te.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Oi.zpp_pool,Oi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},te.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Oi.zpp_pool,Oi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},te.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Oi.zpp_pool,Oi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},te.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Oi.zpp_pool,Oi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},te.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},te.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Oi.zpp_pool,Oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},te.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Oi.zpp_pool,Oi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},te.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},te.prototype.empty=function(){return null==this.head},te.prototype.size=function(){return this.length},te.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},te.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},te.prototype.front=function(){return this.head.elt},te.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},te.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},te.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},te.prototype.__class__=te;var ie=zpp_nape.util.ZNPList_ZPP_Constraint=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ie.__name__=["zpp_nape","util","ZNPList_ZPP_Constraint"],ie.prototype.head=null,ie.prototype.begin=function(){return this.head},ie.prototype.modified=null,ie.prototype.pushmod=null,ie.prototype.length=null,ie.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ie.prototype.add=function(n){var e;null==fi.zpp_pool?e=new fi:(e=fi.zpp_pool,fi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ie.prototype.inlined_add=function(n){var e;null==fi.zpp_pool?e=new fi:(e=fi.zpp_pool,fi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ie.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ie.prototype.insert=function(n,e){var t;null==fi.zpp_pool?t=new fi:(t=fi.zpp_pool,fi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ie.prototype.inlined_insert=function(n,e){var t;null==fi.zpp_pool?t=new fi:(t=fi.zpp_pool,fi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ie.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ie.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ie.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ie.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ie.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=fi.zpp_pool,fi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ie.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ie.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=fi.zpp_pool,fi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ie.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=fi.zpp_pool,fi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ie.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=fi.zpp_pool,fi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ie.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=fi.zpp_pool,fi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ie.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ie.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ie.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=fi.zpp_pool,fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ie.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ie.prototype.empty=function(){return null==this.head},ie.prototype.size=function(){return this.length},ie.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ie.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ie.prototype.front=function(){return this.head.elt},ie.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ie.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ie.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ie.prototype.__class__=ie;var pe=zpp_nape.util.ZNPList_ZPP_Interactor=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};pe.__name__=["zpp_nape","util","ZNPList_ZPP_Interactor"],pe.prototype.head=null,pe.prototype.begin=function(){return this.head},pe.prototype.modified=null,pe.prototype.pushmod=null,pe.prototype.length=null,pe.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},pe.prototype.add=function(n){var e;null==Mi.zpp_pool?e=new Mi:(e=Mi.zpp_pool,Mi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},pe.prototype.inlined_add=function(n){var e;null==Mi.zpp_pool?e=new Mi:(e=Mi.zpp_pool,Mi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},pe.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},pe.prototype.insert=function(n,e){var t;null==Mi.zpp_pool?t=new Mi:(t=Mi.zpp_pool,Mi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pe.prototype.inlined_insert=function(n,e){var t;null==Mi.zpp_pool?t=new Mi:(t=Mi.zpp_pool,Mi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pe.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Mi.zpp_pool,Mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pe.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Mi.zpp_pool,Mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pe.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},pe.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},pe.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},pe.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},pe.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},pe.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Mi.zpp_pool,Mi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},pe.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},pe.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},pe.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},pe.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Mi.zpp_pool,Mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},pe.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Mi.zpp_pool,Mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},pe.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},pe.prototype.empty=function(){return null==this.head},pe.prototype.size=function(){return this.length},pe.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},pe.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},pe.prototype.front=function(){return this.head.elt},pe.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},pe.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},pe.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},pe.prototype.__class__=pe;var le=zpp_nape.util.ZNPList_ZPP_CbSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};le.__name__=["zpp_nape","util","ZNPList_ZPP_CbSet"],le.prototype.head=null,le.prototype.begin=function(){return this.head},le.prototype.modified=null,le.prototype.pushmod=null,le.prototype.length=null,le.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},le.prototype.add=function(n){var e;null==wi.zpp_pool?e=new wi:(e=wi.zpp_pool,wi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},le.prototype.inlined_add=function(n){var e;null==wi.zpp_pool?e=new wi:(e=wi.zpp_pool,wi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},le.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},le.prototype.insert=function(n,e){var t;null==wi.zpp_pool?t=new wi:(t=wi.zpp_pool,wi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},le.prototype.inlined_insert=function(n,e){var t;null==wi.zpp_pool?t=new wi:(t=wi.zpp_pool,wi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},le.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=wi.zpp_pool,wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},le.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=wi.zpp_pool,wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},le.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},le.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},le.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=wi.zpp_pool,wi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},le.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},le.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=wi.zpp_pool,wi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},le.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=wi.zpp_pool,wi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},le.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=wi.zpp_pool,wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},le.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=wi.zpp_pool,wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},le.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},le.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=wi.zpp_pool,wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},le.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=wi.zpp_pool,wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},le.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},le.prototype.empty=function(){return null==this.head},le.prototype.size=function(){return this.length},le.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},le.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},le.prototype.front=function(){return this.head.elt},le.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},le.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},le.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},le.prototype.__class__=le;var re=zpp_nape.callbacks.ZPP_CbType=function(){this.conlisteners=null,this.bodylisteners=null,this.listeners=null,this.cbsets=null,this.id=0,this.userData=null,this.outer=null,this.id=Xn.CbType(),this.listeners=new ne,this.bodylisteners=new ee,this.conlisteners=new te,this.constraints=new ie,this.interactors=new pe,this.cbsets=new le};re.__name__=["zpp_nape","callbacks","ZPP_CbType"],re.setlt=function(n,e){return n.id<e.id},re.prototype.outer=null,re.prototype.userData=null,re.prototype.id=null,re.prototype.cbsets=null,re.prototype.interactors=null,re.prototype.wrap_interactors=null,re.prototype.constraints=null,re.prototype.wrap_constraints=null,re.prototype.addConstraint=function(n){this.constraints.add(n)},re.prototype.addInteractor=function(n){this.interactors.add(n)},re.prototype.remConstraint=function(n){this.constraints.remove(n)},re.prototype.remInteractor=function(n){this.interactors.remove(n)},re.prototype.listeners=null,re.prototype.addint=function(n){for(var e=null,t=this.listeners.head;null!=t;){var i=t.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=t,t=t.next}var p,l=this.listeners;null==gi.zpp_pool?p=new gi:(p=gi.zpp_pool,gi.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==e?(r.next=l.head,l.head=r):(r.next=e.next,e.next=r),l.pushmod=l.modified=!0,l.length++;for(var o=this.cbsets.head;null!=o;){var a=o.elt;a.zip_listeners=!0,a.invalidate_pairs(),o=o.next}},re.prototype.removeint=function(n){this.listeners.remove(n);for(var e=this.cbsets.head;null!=e;){var t=e.elt;t.zip_listeners=!0,t.invalidate_pairs(),e=e.next}},re.prototype.invalidateint=function(){for(var n=this.cbsets.head;null!=n;){var e=n.elt;e.zip_listeners=!0,e.invalidate_pairs(),n=n.next}},re.prototype.bodylisteners=null,re.prototype.addbody=function(n){for(var e=null,t=this.bodylisteners.head;null!=t;){var i=t.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=t,t=t.next}var p,l=this.bodylisteners;null==Ci.zpp_pool?p=new Ci:(p=Ci.zpp_pool,Ci.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==e?(r.next=l.head,l.head=r):(r.next=e.next,e.next=r),l.pushmod=l.modified=!0,l.length++;for(var o=this.cbsets.head;null!=o;)o.elt.zip_bodylisteners=!0,o=o.next},re.prototype.removebody=function(n){this.bodylisteners.remove(n);for(var e=this.cbsets.head;null!=e;)e.elt.zip_bodylisteners=!0,e=e.next},re.prototype.invalidatebody=function(){for(var n=this.cbsets.head;null!=n;)n.elt.zip_bodylisteners=!0,n=n.next},re.prototype.conlisteners=null,re.prototype.addconstraint=function(n){for(var e=null,t=this.conlisteners.head;null!=t;){var i=t.elt;if(n.precedence>i.precedence||n.precedence==i.precedence&&n.id>i.id)break;e=t,t=t.next}var p,l=this.conlisteners;null==Oi.zpp_pool?p=new Oi:(p=Oi.zpp_pool,Oi.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==e?(r.next=l.head,l.head=r):(r.next=e.next,e.next=r),l.pushmod=l.modified=!0,l.length++;for(var o=this.cbsets.head;null!=o;)o.elt.zip_conlisteners=!0,o=o.next},re.prototype.removeconstraint=function(n){this.conlisteners.remove(n);for(var e=this.cbsets.head;null!=e;)e.elt.zip_conlisteners=!0,e=e.next},re.prototype.invalidateconstraint=function(){for(var n=this.cbsets.head;null!=n;)n.elt.zip_conlisteners=!0,n=n.next},re.prototype.__class__=re;var oe=zpp_nape.util.ZPP_Flags=function(){};oe.__name__=["zpp_nape","util","ZPP_Flags"],oe.GravMassMode_DEFAULT=null,oe.GravMassMode_FIXED=null,oe.GravMassMode_SCALED=null,oe.InertiaMode_DEFAULT=null,oe.InertiaMode_FIXED=null,oe.MassMode_DEFAULT=null,oe.MassMode_FIXED=null,oe.BodyType_STATIC=null,oe.BodyType_DYNAMIC=null,oe.BodyType_KINEMATIC=null,oe.ListenerType_BODY=null,oe.PreFlag_ACCEPT=null,oe.ListenerType_CONSTRAINT=null,oe.PreFlag_IGNORE=null,oe.ListenerType_INTERACTION=null,oe.PreFlag_ACCEPT_ONCE=null,oe.ListenerType_PRE=null,oe.PreFlag_IGNORE_ONCE=null,oe.CbEvent_BEGIN=null,oe.InteractionType_COLLISION=null,oe.CbEvent_ONGOING=null,oe.InteractionType_SENSOR=null,oe.CbEvent_END=null,oe.InteractionType_FLUID=null,oe.CbEvent_WAKE=null,oe.InteractionType_ANY=null,oe.CbEvent_SLEEP=null,oe.CbEvent_BREAK=null,oe.CbEvent_PRE=null,oe.Winding_UNDEFINED=null,oe.Winding_CLOCKWISE=null,oe.Winding_ANTICLOCKWISE=null,oe.ValidationResult_VALID=null,oe.ValidationResult_DEGENERATE=null,oe.ValidationResult_CONCAVE=null,oe.ValidationResult_SELF_INTERSECTING=null,oe.ShapeType_CIRCLE=null,oe.ShapeType_POLYGON=null,oe.Broadphase_DYNAMIC_AABB_TREE=null,oe.Broadphase_SWEEP_AND_PRUNE=null,oe.ArbiterType_COLLISION=null,oe.ArbiterType_SENSOR=null,oe.ArbiterType_FLUID=null,oe.prototype.__class__=oe;var ae=zpp_nape.callbacks.ZPP_Listener=function(){this.space=null,this.interaction=null,this.constraint=null,this.body=null,this.precedence=0,this.event=0,this.type=0,this.id=0,this.outer=null,this.id=Xn.Listener()};ae.__name__=["zpp_nape","callbacks","ZPP_Listener"],ae.setlt=function(n,e){return!(n.precedence<=e.precedence)||n.precedence==e.precedence&&n.id>e.id},ae.prototype.outer=null,ae.prototype.id=null,ae.prototype.type=null,ae.prototype.event=null,ae.prototype.precedence=null,ae.prototype.body=null,ae.prototype.constraint=null,ae.prototype.interaction=null,ae.prototype.space=null,ae.prototype.swapEvent=function(n){},ae.prototype.invalidate_precedence=function(){},ae.prototype.addedToSpace=function(){},ae.prototype.removedFromSpace=function(){},ae.prototype.__class__=ae;var se=zpp_nape.callbacks.ZPP_BodyListener=function(n,e,t){this.handler=null,this.options=null,this.outer_zn=null,ae.call(this),this.event=e,this.handler=t,this.body=this,this.type=0,this.options=n.zpp_inner};se.__name__=["zpp_nape","callbacks","ZPP_BodyListener"],se.__super__=ae,se.prototype=Object.create(ae.prototype),se.prototype.outer_zn=null,se.prototype.options=null,se.prototype.handler=null,se.prototype.addedToSpace=function(){this.options.handler=e(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var t=n.elt,i=null,p=t.bodylisteners.head;null!=p;){var l=p.elt;if(this.precedence>l.precedence||this.precedence==l.precedence&&this.id>l.id)break;i=p,p=p.next}var r,o=t.bodylisteners;null==Ci.zpp_pool?r=new Ci:(r=Ci.zpp_pool,Ci.zpp_pool=r.next,r.next=null),r.elt=this;var a=r;null==i?(a.next=o.head,o.head=a):(a.next=i.next,i.next=a),o.pushmod=o.modified=!0,o.length++;for(var s=t.cbsets.head;null!=s;)s.elt.zip_bodylisteners=!0,s=s.next;n=n.next}},se.prototype.removedFromSpace=function(){for(var n=this.options.includes.head;null!=n;){var e=n.elt;e.bodylisteners.remove(this);for(var t=e.cbsets.head;null!=t;)t.elt.zip_bodylisteners=!0,t=t.next;n=n.next}this.options.handler=null},se.prototype.cbtype_change=function(n,e,t){this.removedFromSpace();var i=this.options;if(e)if(t){for(var p=null,l=i.includes.head;null!=l&&!(n.id<l.elt.id);)p=l,l=l.next;var r,o=i.includes;null==yi.zpp_pool?r=new yi:(r=yi.zpp_pool,yi.zpp_pool=r.next,r.next=null),r.elt=n;var a=r;null==p?(a.next=o.head,o.head=a):(a.next=p.next,p.next=a),o.pushmod=o.modified=!0,o.length++}else i.includes.remove(n);else if(t){for(var s=null,_=i.excludes.head;null!=_&&!(n.id<_.elt.id);)s=_,_=_.next;var h,u=i.excludes;null==yi.zpp_pool?h=new yi:(h=yi.zpp_pool,yi.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++}else i.excludes.remove(n);this.addedToSpace()},se.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},se.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},se.prototype.__class__=se;var _e=zpp_nape.callbacks.ZPP_ConstraintListener=function(n,e,t){this.handler=null,this.options=null,this.outer_zn=null,ae.call(this),this.event=e,this.handler=t,this.constraint=this,this.type=1,this.options=n.zpp_inner};_e.__name__=["zpp_nape","callbacks","ZPP_ConstraintListener"],_e.__super__=ae,_e.prototype=Object.create(ae.prototype),_e.prototype.outer_zn=null,_e.prototype.options=null,_e.prototype.handler=null,_e.prototype.addedToSpace=function(){this.options.handler=e(this,this.cbtype_change);for(var n=this.options.includes.head;null!=n;){for(var t=n.elt,i=null,p=t.conlisteners.head;null!=p;){var l=p.elt;if(this.precedence>l.precedence||this.precedence==l.precedence&&this.id>l.id)break;i=p,p=p.next}var r,o=t.conlisteners;null==Oi.zpp_pool?r=new Oi:(r=Oi.zpp_pool,Oi.zpp_pool=r.next,r.next=null),r.elt=this;var a=r;null==i?(a.next=o.head,o.head=a):(a.next=i.next,i.next=a),o.pushmod=o.modified=!0,o.length++;for(var s=t.cbsets.head;null!=s;)s.elt.zip_conlisteners=!0,s=s.next;n=n.next}},_e.prototype.removedFromSpace=function(){for(var n=this.options.includes.head;null!=n;){var e=n.elt;e.conlisteners.remove(this);for(var t=e.cbsets.head;null!=t;)t.elt.zip_conlisteners=!0,t=t.next;n=n.next}this.options.handler=null},_e.prototype.cbtype_change=function(n,e,t){this.removedFromSpace();var i=this.options;if(e)if(t){for(var p=null,l=i.includes.head;null!=l&&!(n.id<l.elt.id);)p=l,l=l.next;var r,o=i.includes;null==yi.zpp_pool?r=new yi:(r=yi.zpp_pool,yi.zpp_pool=r.next,r.next=null),r.elt=n;var a=r;null==p?(a.next=o.head,o.head=a):(a.next=p.next,p.next=a),o.pushmod=o.modified=!0,o.length++}else i.includes.remove(n);else if(t){for(var s=null,_=i.excludes.head;null!=_&&!(n.id<_.elt.id);)s=_,_=_.next;var h,u=i.excludes;null==yi.zpp_pool?h=new yi:(h=yi.zpp_pool,yi.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++}else i.excludes.remove(n);this.addedToSpace()},_e.prototype.invalidate_precedence=function(){null!=this.space&&(this.removedFromSpace(),this.addedToSpace())},_e.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},_e.prototype.__class__=_e;var he=zpp_nape.util.ZNPList_ZPP_CbType=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};he.__name__=["zpp_nape","util","ZNPList_ZPP_CbType"],he.prototype.head=null,he.prototype.begin=function(){return this.head},he.prototype.modified=null,he.prototype.pushmod=null,he.prototype.length=null,he.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},he.prototype.add=function(n){var e;null==yi.zpp_pool?e=new yi:(e=yi.zpp_pool,yi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},he.prototype.inlined_add=function(n){var e;null==yi.zpp_pool?e=new yi:(e=yi.zpp_pool,yi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},he.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},he.prototype.insert=function(n,e){var t;null==yi.zpp_pool?t=new yi:(t=yi.zpp_pool,yi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},he.prototype.inlined_insert=function(n,e){var t;null==yi.zpp_pool?t=new yi:(t=yi.zpp_pool,yi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},he.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},he.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},he.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},he.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},he.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=yi.zpp_pool,yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},he.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},he.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=yi.zpp_pool,yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},he.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=yi.zpp_pool,yi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},he.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=yi.zpp_pool,yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},he.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=yi.zpp_pool,yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},he.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},he.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},he.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=yi.zpp_pool,yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},he.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},he.prototype.empty=function(){return null==this.head},he.prototype.size=function(){return this.length},he.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},he.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},he.prototype.front=function(){return this.head.elt},he.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},he.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},he.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},he.prototype.__class__=he;var ue=zpp_nape.callbacks.ZPP_InteractionListener=function(n,e,t,i){this.handlerp=null,this.pure=!1,this.allowSleepingCallbacks=!1,this.handleri=null,this.options2=null,this.options1=null,this.itype=0,this.outer_znp=null,this.outer_zni=null,ae.call(this),this.type=i,this.interaction=this,this.event=t,this.options1=n.zpp_inner,this.options2=e.zpp_inner,this.allowSleepingCallbacks=!1};ue.__name__=["zpp_nape","callbacks","ZPP_InteractionListener"],ue.__super__=ae,ue.prototype=Object.create(ae.prototype),ue.prototype.outer_zni=null,ue.prototype.outer_znp=null,ue.prototype.itype=null,ue.prototype.options1=null,ue.prototype.options2=null,ue.prototype.handleri=null,ue.prototype.allowSleepingCallbacks=null,ue.prototype.pure=null,ue.prototype.handlerp=null,ue.prototype.setInteractionType=function(n){this.itype=n},ue.prototype.wake=function(){for(var n=this.options1.includes.head,e=this.options2.includes.head;null!=n&&null!=e;){var t=n.elt,i=e.elt;if(t==i){for(var p=t.interactors.head;null!=p;)p.elt.wake(),p=p.next;n=n.next,e=e.next}else if(t.id<i.id){for(var l=t.interactors.head;null!=l;)l.elt.wake(),l=l.next;n=n.next}else{for(var r=i.interactors.head;null!=r;)r.elt.wake(),r=r.next;e=e.next}}for(;null!=n;){for(var o=n.elt.interactors.head;null!=o;)o.elt.wake(),o=o.next;n=n.next}for(;null!=e;){for(var a=e.elt.interactors.head;null!=a;)a.elt.wake(),a=a.next;e=e.next}},ue.prototype.CbSetset=function(n,e,t){for(var i=ue.UCbSet,p=ue.VCbSet,l=ue.WCbSet,r=n.head,o=e.head;null!=r&&null!=o;){var a=r.elt,s=o.elt;if(a==s){var _;null==wi.zpp_pool?_=new wi:(_=wi.zpp_pool,wi.zpp_pool=_.next,_.next=null),_.elt=a;var h=_;h.next=l.head,l.head=h,l.modified=!0,l.length++,r=r.next,o=o.next}else if($n.setlt(a,s)){var u;null==wi.zpp_pool?u=new wi:(u=wi.zpp_pool,wi.zpp_pool=u.next,u.next=null),u.elt=a;var x=u;x.next=i.head,i.head=x,i.modified=!0,i.length++,r=r.next}else{var d;null==wi.zpp_pool?d=new wi:(d=wi.zpp_pool,wi.zpp_pool=d.next,d.next=null),d.elt=s;var y=d;y.next=p.head,p.head=y,p.modified=!0,p.length++,o=o.next}}for(;null!=r;){var z,v=r.elt;null==wi.zpp_pool?z=new wi:(z=wi.zpp_pool,wi.zpp_pool=z.next,z.next=null),z.elt=v;var c=z;c.next=i.head,i.head=c,i.modified=!0,i.length++,r=r.next}for(;null!=o;){var f,m=o.elt;null==wi.zpp_pool?f=new wi:(f=wi.zpp_pool,wi.zpp_pool=f.next,f.next=null),f.elt=m;var b=f;b.next=p.head,p.head=b,p.modified=!0,p.length++,o=o.next}for(;null!=i.head;)for(var g=i.pop_unsafe(),w=e.head;null!=w;)t(g,w.elt),w=w.next;for(;null!=p.head;)for(var M=p.pop_unsafe(),C=l.head;null!=C;)t(M,C.elt),C=C.next;for(;null!=l.head;){var k=l.pop_unsafe();t(k,k);for(var O=l.head;null!=O;)t(k,O.elt),O=O.next}},ue.prototype.CbTypeset=function(n,e,t){for(var i=ue.UCbType,p=ue.VCbType,l=ue.WCbType,r=n.head,o=e.head;null!=r&&null!=o;){var a=r.elt,s=o.elt;if(a==s){var _;null==yi.zpp_pool?_=new yi:(_=yi.zpp_pool,yi.zpp_pool=_.next,_.next=null),_.elt=a;var h=_;h.next=l.head,l.head=h,l.modified=!0,l.length++,r=r.next,o=o.next}else if(a.id<s.id){var u;null==yi.zpp_pool?u=new yi:(u=yi.zpp_pool,yi.zpp_pool=u.next,u.next=null),u.elt=a;var x=u;x.next=i.head,i.head=x,i.modified=!0,i.length++,r=r.next}else{var d;null==yi.zpp_pool?d=new yi:(d=yi.zpp_pool,yi.zpp_pool=d.next,d.next=null),d.elt=s;var y=d;y.next=p.head,p.head=y,p.modified=!0,p.length++,o=o.next}}for(;null!=r;){var z,v=r.elt;null==yi.zpp_pool?z=new yi:(z=yi.zpp_pool,yi.zpp_pool=z.next,z.next=null),z.elt=v;var c=z;c.next=i.head,i.head=c,i.modified=!0,i.length++,r=r.next}for(;null!=o;){var f,m=o.elt;null==yi.zpp_pool?f=new yi:(f=yi.zpp_pool,yi.zpp_pool=f.next,f.next=null),f.elt=m;var b=f;b.next=p.head,p.head=b,p.modified=!0,p.length++,o=o.next}for(;null!=i.head;)for(var g=i.pop_unsafe(),w=e.head;null!=w;)t(g,w.elt),w=w.next;for(;null!=p.head;)for(var M=p.pop_unsafe(),C=l.head;null!=C;)t(M,C.elt),C=C.next;for(;null!=l.head;){var k=l.pop_unsafe();t(k,k);for(var O=l.head;null!=O;)t(k,O.elt),O=O.next}},ue.prototype.with_uniquesets=function(n){var e,t=this;null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.lt=Qn.setlt;for(var i=this.options2.includes,p=ue.UCbType,l=ue.VCbType,r=ue.WCbType,o=this.options1.includes.head,a=i.head;null!=o&&null!=a;){var s=o.elt,_=a.elt;if(s==_){var h;null==yi.zpp_pool?h=new yi:(h=yi.zpp_pool,yi.zpp_pool=h.next,h.next=null),h.elt=s;var u=h;u.next=r.head,r.head=u,r.modified=!0,r.length++,o=o.next,a=a.next}else if(s.id<_.id){var x;null==yi.zpp_pool?x=new yi:(x=yi.zpp_pool,yi.zpp_pool=x.next,x.next=null),x.elt=s;var d=x;d.next=p.head,p.head=d,p.modified=!0,p.length++,o=o.next}else{var y;null==yi.zpp_pool?y=new yi:(y=yi.zpp_pool,yi.zpp_pool=y.next,y.next=null),y.elt=_;var z=y;z.next=l.head,l.head=z,l.modified=!0,l.length++,a=a.next}}for(;null!=o;){var v,c=o.elt;null==yi.zpp_pool?v=new yi:(v=yi.zpp_pool,yi.zpp_pool=v.next,v.next=null),v.elt=c;var f=v;f.next=p.head,p.head=f,p.modified=!0,p.length++,o=o.next}for(;null!=a;){var m,b=a.elt;null==yi.zpp_pool?m=new yi:(m=yi.zpp_pool,yi.zpp_pool=m.next,m.next=null),m.elt=b;var g=m;g.next=l.head,l.head=g,l.modified=!0,l.length++,a=a.next}for(;null!=p.head;)for(var w=p.pop_unsafe(),M=i.head;null!=M;){for(var C=M.elt.cbsets,k=ue.UCbSet,O=ue.VCbSet,P=ue.WCbSet,S=w.cbsets.head,A=C.head;null!=S&&null!=A;){var j=S.elt,E=A.elt;if(j==E){var I;null==wi.zpp_pool?I=new wi:(I=wi.zpp_pool,wi.zpp_pool=I.next,I.next=null),I.elt=j;var T=I;T.next=P.head,P.head=T,P.modified=!0,P.length++,S=S.next,A=A.next}else if($n.setlt(j,E)){var N;null==wi.zpp_pool?N=new wi:(N=wi.zpp_pool,wi.zpp_pool=N.next,N.next=null),N.elt=j;var L=N;L.next=k.head,k.head=L,k.modified=!0,k.length++,S=S.next}else{var V;null==wi.zpp_pool?V=new wi:(V=wi.zpp_pool,wi.zpp_pool=V.next,V.next=null),V.elt=E;var D=V;D.next=O.head,O.head=D,O.modified=!0,O.length++,A=A.next}}for(;null!=S;){var F,R=S.elt;null==wi.zpp_pool?F=new wi:(F=wi.zpp_pool,wi.zpp_pool=F.next,F.next=null),F.elt=R;var Z=F;Z.next=k.head,k.head=Z,k.modified=!0,k.length++,S=S.next}for(;null!=A;){var B,G=A.elt;null==wi.zpp_pool?B=new wi:(B=wi.zpp_pool,wi.zpp_pool=B.next,B.next=null),B.elt=G;var q=B;q.next=O.head,O.head=q,O.modified=!0,O.length++,A=A.next}for(;null!=k.head;)for(var U=k.pop_unsafe(),K=C.head;null!=K;){var W,Y=K.elt;if(U.validate(),Y.validate(),$n.single_intersection(U,Y,t))null==Qn.zpp_pool?W=new Qn:(W=Qn.zpp_pool,Qn.zpp_pool=W.next,W.next=null),W.zip_listeners=!0,$n.setlt(U,Y)?(W.a=U,W.b=Y):(W.a=Y,W.b=U),e.try_insert(W);K=K.next}for(;null!=O.head;)for(var J=O.pop_unsafe(),X=P.head;null!=X;){var H,$=X.elt;if(J.validate(),$.validate(),$n.single_intersection(J,$,t))null==Qn.zpp_pool?H=new Qn:(H=Qn.zpp_pool,Qn.zpp_pool=H.next,H.next=null),H.zip_listeners=!0,$n.setlt(J,$)?(H.a=J,H.b=$):(H.a=$,H.b=J),e.try_insert(H);X=X.next}for(;null!=P.head;){var Q,nn=P.pop_unsafe();if(nn.validate(),nn.validate(),$n.single_intersection(nn,nn,t))null==Qn.zpp_pool?Q=new Qn:(Q=Qn.zpp_pool,Qn.zpp_pool=Q.next,Q.next=null),Q.zip_listeners=!0,$n.setlt(nn,nn),Q.a=nn,Q.b=nn,e.try_insert(Q);for(var en=P.head;null!=en;){var tn,pn=en.elt;if(nn.validate(),pn.validate(),$n.single_intersection(nn,pn,t))null==Qn.zpp_pool?tn=new Qn:(tn=Qn.zpp_pool,Qn.zpp_pool=tn.next,tn.next=null),tn.zip_listeners=!0,$n.setlt(nn,pn)?(tn.a=nn,tn.b=pn):(tn.a=pn,tn.b=nn),e.try_insert(tn);en=en.next}}M=M.next}for(;null!=l.head;)for(var ln=l.pop_unsafe(),rn=r.head;null!=rn;){for(var on=rn.elt.cbsets,an=ue.UCbSet,sn=ue.VCbSet,_n=ue.WCbSet,hn=ln.cbsets.head,un=on.head;null!=hn&&null!=un;){var xn=hn.elt,dn=un.elt;if(xn==dn){var yn;null==wi.zpp_pool?yn=new wi:(yn=wi.zpp_pool,wi.zpp_pool=yn.next,yn.next=null),yn.elt=xn;var zn=yn;zn.next=_n.head,_n.head=zn,_n.modified=!0,_n.length++,hn=hn.next,un=un.next}else if($n.setlt(xn,dn)){var vn;null==wi.zpp_pool?vn=new wi:(vn=wi.zpp_pool,wi.zpp_pool=vn.next,vn.next=null),vn.elt=xn;var cn=vn;cn.next=an.head,an.head=cn,an.modified=!0,an.length++,hn=hn.next}else{var fn;null==wi.zpp_pool?fn=new wi:(fn=wi.zpp_pool,wi.zpp_pool=fn.next,fn.next=null),fn.elt=dn;var mn=fn;mn.next=sn.head,sn.head=mn,sn.modified=!0,sn.length++,un=un.next}}for(;null!=hn;){var bn,gn=hn.elt;null==wi.zpp_pool?bn=new wi:(bn=wi.zpp_pool,wi.zpp_pool=bn.next,bn.next=null),bn.elt=gn;var wn=bn;wn.next=an.head,an.head=wn,an.modified=!0,an.length++,hn=hn.next}for(;null!=un;){var Mn,Cn=un.elt;null==wi.zpp_pool?Mn=new wi:(Mn=wi.zpp_pool,wi.zpp_pool=Mn.next,Mn.next=null),Mn.elt=Cn;var kn=Mn;kn.next=sn.head,sn.head=kn,sn.modified=!0,sn.length++,un=un.next}for(;null!=an.head;)for(var On=an.pop_unsafe(),Pn=on.head;null!=Pn;){var Sn,An=Pn.elt;if(On.validate(),An.validate(),$n.single_intersection(On,An,t))null==Qn.zpp_pool?Sn=new Qn:(Sn=Qn.zpp_pool,Qn.zpp_pool=Sn.next,Sn.next=null),Sn.zip_listeners=!0,$n.setlt(On,An)?(Sn.a=On,Sn.b=An):(Sn.a=An,Sn.b=On),e.try_insert(Sn);Pn=Pn.next}for(;null!=sn.head;)for(var jn=sn.pop_unsafe(),En=_n.head;null!=En;){var In,Tn=En.elt;if(jn.validate(),Tn.validate(),$n.single_intersection(jn,Tn,t))null==Qn.zpp_pool?In=new Qn:(In=Qn.zpp_pool,Qn.zpp_pool=In.next,In.next=null),In.zip_listeners=!0,$n.setlt(jn,Tn)?(In.a=jn,In.b=Tn):(In.a=Tn,In.b=jn),e.try_insert(In);En=En.next}for(;null!=_n.head;){var Nn,Ln=_n.pop_unsafe();if(Ln.validate(),Ln.validate(),$n.single_intersection(Ln,Ln,t))null==Qn.zpp_pool?Nn=new Qn:(Nn=Qn.zpp_pool,Qn.zpp_pool=Nn.next,Nn.next=null),Nn.zip_listeners=!0,$n.setlt(Ln,Ln),Nn.a=Ln,Nn.b=Ln,e.try_insert(Nn);for(var Vn=_n.head;null!=Vn;){var Dn,Fn=Vn.elt;if(Ln.validate(),Fn.validate(),$n.single_intersection(Ln,Fn,t))null==Qn.zpp_pool?Dn=new Qn:(Dn=Qn.zpp_pool,Qn.zpp_pool=Dn.next,Dn.next=null),Dn.zip_listeners=!0,$n.setlt(Ln,Fn)?(Dn.a=Ln,Dn.b=Fn):(Dn.a=Fn,Dn.b=Ln),e.try_insert(Dn);Vn=Vn.next}}rn=rn.next}for(;null!=r.head;){for(var Rn=r.pop_unsafe(),Zn=Rn.cbsets,Bn=ue.UCbSet,Gn=ue.VCbSet,qn=ue.WCbSet,Un=Rn.cbsets.head,Kn=Zn.head;null!=Un&&null!=Kn;){var Wn=Un.elt,Yn=Kn.elt;if(Wn==Yn){var Jn;null==wi.zpp_pool?Jn=new wi:(Jn=wi.zpp_pool,wi.zpp_pool=Jn.next,Jn.next=null),Jn.elt=Wn;var Xn=Jn;Xn.next=qn.head,qn.head=Xn,qn.modified=!0,qn.length++,Un=Un.next,Kn=Kn.next}else if($n.setlt(Wn,Yn)){var Hn;null==wi.zpp_pool?Hn=new wi:(Hn=wi.zpp_pool,wi.zpp_pool=Hn.next,Hn.next=null),Hn.elt=Wn;var ne=Hn;ne.next=Bn.head,Bn.head=ne,Bn.modified=!0,Bn.length++,Un=Un.next}else{var ee;null==wi.zpp_pool?ee=new wi:(ee=wi.zpp_pool,wi.zpp_pool=ee.next,ee.next=null),ee.elt=Yn;var te=ee;te.next=Gn.head,Gn.head=te,Gn.modified=!0,Gn.length++,Kn=Kn.next}}for(;null!=Un;){var ie,pe=Un.elt;null==wi.zpp_pool?ie=new wi:(ie=wi.zpp_pool,wi.zpp_pool=ie.next,ie.next=null),ie.elt=pe;var le=ie;le.next=Bn.head,Bn.head=le,Bn.modified=!0,Bn.length++,Un=Un.next}for(;null!=Kn;){var re,oe=Kn.elt;null==wi.zpp_pool?re=new wi:(re=wi.zpp_pool,wi.zpp_pool=re.next,re.next=null),re.elt=oe;var ae=re;ae.next=Gn.head,Gn.head=ae,Gn.modified=!0,Gn.length++,Kn=Kn.next}for(;null!=Bn.head;)for(var se=Bn.pop_unsafe(),_e=Zn.head;null!=_e;){var he,xe=_e.elt;if(se.validate(),xe.validate(),$n.single_intersection(se,xe,t))null==Qn.zpp_pool?he=new Qn:(he=Qn.zpp_pool,Qn.zpp_pool=he.next,he.next=null),he.zip_listeners=!0,$n.setlt(se,xe)?(he.a=se,he.b=xe):(he.a=xe,he.b=se),e.try_insert(he);_e=_e.next}for(;null!=Gn.head;)for(var de=Gn.pop_unsafe(),ye=qn.head;null!=ye;){var ze,ve=ye.elt;if(de.validate(),ve.validate(),$n.single_intersection(de,ve,t))null==Qn.zpp_pool?ze=new Qn:(ze=Qn.zpp_pool,Qn.zpp_pool=ze.next,ze.next=null),ze.zip_listeners=!0,$n.setlt(de,ve)?(ze.a=de,ze.b=ve):(ze.a=ve,ze.b=de),e.try_insert(ze);ye=ye.next}for(;null!=qn.head;){var ce,fe=qn.pop_unsafe();if(fe.validate(),fe.validate(),$n.single_intersection(fe,fe,t))null==Qn.zpp_pool?ce=new Qn:(ce=Qn.zpp_pool,Qn.zpp_pool=ce.next,ce.next=null),ce.zip_listeners=!0,$n.setlt(fe,fe),ce.a=fe,ce.b=fe,e.try_insert(ce);for(var me=qn.head;null!=me;){var be,ge=me.elt;if(fe.validate(),ge.validate(),$n.single_intersection(fe,ge,t))null==Qn.zpp_pool?be=new Qn:(be=Qn.zpp_pool,Qn.zpp_pool=be.next,be.next=null),be.zip_listeners=!0,$n.setlt(fe,ge)?(be.a=fe,be.b=ge):(be.a=ge,be.b=fe),e.try_insert(be);me=me.next}}for(var we=r.head;null!=we;){for(var Me=we.elt.cbsets,Ce=ue.UCbSet,ke=ue.VCbSet,Oe=ue.WCbSet,Pe=Rn.cbsets.head,Se=Me.head;null!=Pe&&null!=Se;){var Ae=Pe.elt,je=Se.elt;if(Ae==je){var Ee;null==wi.zpp_pool?Ee=new wi:(Ee=wi.zpp_pool,wi.zpp_pool=Ee.next,Ee.next=null),Ee.elt=Ae;var Ie=Ee;Ie.next=Oe.head,Oe.head=Ie,Oe.modified=!0,Oe.length++,Pe=Pe.next,Se=Se.next}else if($n.setlt(Ae,je)){var Te;null==wi.zpp_pool?Te=new wi:(Te=wi.zpp_pool,wi.zpp_pool=Te.next,Te.next=null),Te.elt=Ae;var Ne=Te;Ne.next=Ce.head,Ce.head=Ne,Ce.modified=!0,Ce.length++,Pe=Pe.next}else{var Le;null==wi.zpp_pool?Le=new wi:(Le=wi.zpp_pool,wi.zpp_pool=Le.next,Le.next=null),Le.elt=je;var Ve=Le;Ve.next=ke.head,ke.head=Ve,ke.modified=!0,ke.length++,Se=Se.next}}for(;null!=Pe;){var De,Fe=Pe.elt;null==wi.zpp_pool?De=new wi:(De=wi.zpp_pool,wi.zpp_pool=De.next,De.next=null),De.elt=Fe;var Re=De;Re.next=Ce.head,Ce.head=Re,Ce.modified=!0,Ce.length++,Pe=Pe.next}for(;null!=Se;){var Ze,Be=Se.elt;null==wi.zpp_pool?Ze=new wi:(Ze=wi.zpp_pool,wi.zpp_pool=Ze.next,Ze.next=null),Ze.elt=Be;var Ge=Ze;Ge.next=ke.head,ke.head=Ge,ke.modified=!0,ke.length++,Se=Se.next}for(;null!=Ce.head;)for(var qe=Ce.pop_unsafe(),Ue=Me.head;null!=Ue;){var Ke,We=Ue.elt;if(qe.validate(),We.validate(),$n.single_intersection(qe,We,t))null==Qn.zpp_pool?Ke=new Qn:(Ke=Qn.zpp_pool,Qn.zpp_pool=Ke.next,Ke.next=null),Ke.zip_listeners=!0,$n.setlt(qe,We)?(Ke.a=qe,Ke.b=We):(Ke.a=We,Ke.b=qe),e.try_insert(Ke);Ue=Ue.next}for(;null!=ke.head;)for(var Ye=ke.pop_unsafe(),Je=Oe.head;null!=Je;){var Xe,He=Je.elt;if(Ye.validate(),He.validate(),$n.single_intersection(Ye,He,t))null==Qn.zpp_pool?Xe=new Qn:(Xe=Qn.zpp_pool,Qn.zpp_pool=Xe.next,Xe.next=null),Xe.zip_listeners=!0,$n.setlt(Ye,He)?(Xe.a=Ye,Xe.b=He):(Xe.a=He,Xe.b=Ye),e.try_insert(Xe);Je=Je.next}for(;null!=Oe.head;){var $e,Qe=Oe.pop_unsafe();if(Qe.validate(),Qe.validate(),$n.single_intersection(Qe,Qe,t))null==Qn.zpp_pool?$e=new Qn:($e=Qn.zpp_pool,Qn.zpp_pool=$e.next,$e.next=null),$e.zip_listeners=!0,$n.setlt(Qe,Qe),$e.a=Qe,$e.b=Qe,e.try_insert($e);for(var nt=Oe.head;null!=nt;){var et,tt=nt.elt;if(Qe.validate(),tt.validate(),$n.single_intersection(Qe,tt,t))null==Qn.zpp_pool?et=new Qn:(et=Qn.zpp_pool,Qn.zpp_pool=et.next,et.next=null),et.zip_listeners=!0,$n.setlt(Qe,tt)?(et.a=Qe,et.b=tt):(et.a=tt,et.b=Qe),e.try_insert(et);nt=nt.next}}we=we.next}}if(null!=e.parent){for(var it=e.parent;null!=it;)if(null!=it.prev)it=it.prev;else if(null!=it.next)it=it.next;else{var pt=it.data;n?t.space.freshListenerType(pt.a,pt.b):t.space.nullListenerType(pt.a,pt.b),pt.a=pt.b=null,pt.listeners.clear(),pt.next=Qn.zpp_pool,Qn.zpp_pool=pt;var lt=it.parent;null!=lt&&(it==lt.prev?lt.prev=null:lt.next=null,it.parent=null);var rt=it;rt.data=null,rt.lt=null,rt.swapped=null,rt.next=yp.zpp_pool,yp.zpp_pool=rt,it=lt}e.parent=null}var ot=e;ot.data=null,ot.lt=null,ot.swapped=null,ot.next=yp.zpp_pool,yp.zpp_pool=ot},ue.prototype.with_union=function(n){for(var e=this.options1.includes.head,t=this.options2.includes.head;null!=e&&null!=t;){var i=e.elt,p=t.elt;i==p?(n(i),e=e.next,t=t.next):i.id<p.id?(n(i),e=e.next):(n(p),t=t.next)}for(;null!=e;)n(e.elt),e=e.next;for(;null!=t;)n(t.elt),t=t.next},ue.prototype.addedToSpace=function(){for(var n=this,t=3==this.type,i=this.options1.includes.head,p=this.options2.includes.head;null!=i&&null!=p;){var l=i.elt,r=p.elt;if(l==r){for(var o=null,a=l.listeners.head;null!=a;){var s=a.elt;if(n.precedence>s.precedence||n.precedence==s.precedence&&n.id>s.id)break;o=a,a=a.next}var _,h=l.listeners;null==gi.zpp_pool?_=new gi:(_=gi.zpp_pool,gi.zpp_pool=_.next,_.next=null),_.elt=n;var u=_;null==o?(u.next=h.head,h.head=u):(u.next=o.next,o.next=u),h.pushmod=h.modified=!0,h.length++;for(var x=l.cbsets.head;null!=x;){var d=x.elt;d.zip_listeners=!0,d.invalidate_pairs(),x=x.next}if(t)for(var y=l.interactors.head;null!=y;)y.elt.wake(),y=y.next;i=i.next,p=p.next}else if(l.id<r.id){for(var z=null,v=l.listeners.head;null!=v;){var c=v.elt;if(n.precedence>c.precedence||n.precedence==c.precedence&&n.id>c.id)break;z=v,v=v.next}var f,m=l.listeners;null==gi.zpp_pool?f=new gi:(f=gi.zpp_pool,gi.zpp_pool=f.next,f.next=null),f.elt=n;var b=f;null==z?(b.next=m.head,m.head=b):(b.next=z.next,z.next=b),m.pushmod=m.modified=!0,m.length++;for(var g=l.cbsets.head;null!=g;){var w=g.elt;w.zip_listeners=!0,w.invalidate_pairs(),g=g.next}if(t)for(var M=l.interactors.head;null!=M;)M.elt.wake(),M=M.next;i=i.next}else{for(var C=null,k=r.listeners.head;null!=k;){var O=k.elt;if(n.precedence>O.precedence||n.precedence==O.precedence&&n.id>O.id)break;C=k,k=k.next}var P,S=r.listeners;null==gi.zpp_pool?P=new gi:(P=gi.zpp_pool,gi.zpp_pool=P.next,P.next=null),P.elt=n;var A=P;null==C?(A.next=S.head,S.head=A):(A.next=C.next,C.next=A),S.pushmod=S.modified=!0,S.length++;for(var j=r.cbsets.head;null!=j;){var E=j.elt;E.zip_listeners=!0,E.invalidate_pairs(),j=j.next}if(t)for(var I=r.interactors.head;null!=I;)I.elt.wake(),I=I.next;p=p.next}}for(;null!=i;){for(var T=i.elt,N=null,L=T.listeners.head;null!=L;){var V=L.elt;if(n.precedence>V.precedence||n.precedence==V.precedence&&n.id>V.id)break;N=L,L=L.next}var D,F=T.listeners;null==gi.zpp_pool?D=new gi:(D=gi.zpp_pool,gi.zpp_pool=D.next,D.next=null),D.elt=n;var R=D;null==N?(R.next=F.head,F.head=R):(R.next=N.next,N.next=R),F.pushmod=F.modified=!0,F.length++;for(var Z=T.cbsets.head;null!=Z;){var B=Z.elt;B.zip_listeners=!0,B.invalidate_pairs(),Z=Z.next}if(t)for(var G=T.interactors.head;null!=G;)G.elt.wake(),G=G.next;i=i.next}for(;null!=p;){for(var q=p.elt,U=null,K=q.listeners.head;null!=K;){var W=K.elt;if(n.precedence>W.precedence||n.precedence==W.precedence&&n.id>W.id)break;U=K,K=K.next}var Y,J=q.listeners;null==gi.zpp_pool?Y=new gi:(Y=gi.zpp_pool,gi.zpp_pool=Y.next,Y.next=null),Y.elt=n;var X=Y;null==U?(X.next=J.head,J.head=X):(X.next=U.next,U.next=X),J.pushmod=J.modified=!0,J.length++;for(var H=q.cbsets.head;null!=H;){var $=H.elt;$.zip_listeners=!0,$.invalidate_pairs(),H=H.next}if(t)for(var Q=q.interactors.head;null!=Q;)Q.elt.wake(),Q=Q.next;p=p.next}this.options1.handler=e(this,this.cbtype_change1),this.options2.handler=e(this,this.cbtype_change2),this.with_uniquesets(!0)},ue.prototype.removedFromSpace=function(){var n=this;this.with_uniquesets(!1);for(var e=3==this.type,t=this.options1.includes.head,i=this.options2.includes.head;null!=t&&null!=i;){var p=t.elt,l=i.elt;if(p==l){p.listeners.remove(n);for(var r=p.cbsets.head;null!=r;){var o=r.elt;o.zip_listeners=!0,o.invalidate_pairs(),r=r.next}if(e)for(var a=p.interactors.head;null!=a;)a.elt.wake(),a=a.next;t=t.next,i=i.next}else if(p.id<l.id){p.listeners.remove(n);for(var s=p.cbsets.head;null!=s;){var _=s.elt;_.zip_listeners=!0,_.invalidate_pairs(),s=s.next}if(e)for(var h=p.interactors.head;null!=h;)h.elt.wake(),h=h.next;t=t.next}else{l.listeners.remove(n);for(var u=l.cbsets.head;null!=u;){var x=u.elt;x.zip_listeners=!0,x.invalidate_pairs(),u=u.next}if(e)for(var d=l.interactors.head;null!=d;)d.elt.wake(),d=d.next;i=i.next}}for(;null!=t;){var y=t.elt;y.listeners.remove(n);for(var z=y.cbsets.head;null!=z;){var v=z.elt;v.zip_listeners=!0,v.invalidate_pairs(),z=z.next}if(e)for(var c=y.interactors.head;null!=c;)c.elt.wake(),c=c.next;t=t.next}for(;null!=i;){var f=i.elt;f.listeners.remove(n);for(var m=f.cbsets.head;null!=m;){var b=m.elt;b.zip_listeners=!0,b.invalidate_pairs(),m=m.next}if(e)for(var g=f.interactors.head;null!=g;)g.elt.wake(),g=g.next;i=i.next}this.options1.handler=null,this.options2.handler=null},ue.prototype.invalidate_precedence=function(){var n=this;if(null!=this.space){for(var e=3==this.type,t=this.options1.includes.head,i=this.options2.includes.head;null!=t&&null!=i;){var p=t.elt,l=i.elt;if(p==l){p.listeners.remove(n);for(var r=p.cbsets.head;null!=r;){var o=r.elt;o.zip_listeners=!0,o.invalidate_pairs(),r=r.next}for(var a=null,s=p.listeners.head;null!=s;){var _=s.elt;if(n.precedence>_.precedence||n.precedence==_.precedence&&n.id>_.id)break;a=s,s=s.next}var h,u=p.listeners;null==gi.zpp_pool?h=new gi:(h=gi.zpp_pool,gi.zpp_pool=h.next,h.next=null),h.elt=n;var x=h;null==a?(x.next=u.head,u.head=x):(x.next=a.next,a.next=x),u.pushmod=u.modified=!0,u.length++;for(var d=p.cbsets.head;null!=d;){var y=d.elt;y.zip_listeners=!0,y.invalidate_pairs(),d=d.next}if(e)for(var z=p.interactors.head;null!=z;)z.elt.wake(),z=z.next;t=t.next,i=i.next}else if(p.id<l.id){p.listeners.remove(n);for(var v=p.cbsets.head;null!=v;){var c=v.elt;c.zip_listeners=!0,c.invalidate_pairs(),v=v.next}for(var f=null,m=p.listeners.head;null!=m;){var b=m.elt;if(n.precedence>b.precedence||n.precedence==b.precedence&&n.id>b.id)break;f=m,m=m.next}var g,w=p.listeners;null==gi.zpp_pool?g=new gi:(g=gi.zpp_pool,gi.zpp_pool=g.next,g.next=null),g.elt=n;var M=g;null==f?(M.next=w.head,w.head=M):(M.next=f.next,f.next=M),w.pushmod=w.modified=!0,w.length++;for(var C=p.cbsets.head;null!=C;){var k=C.elt;k.zip_listeners=!0,k.invalidate_pairs(),C=C.next}if(e)for(var O=p.interactors.head;null!=O;)O.elt.wake(),O=O.next;t=t.next}else{l.listeners.remove(n);for(var P=l.cbsets.head;null!=P;){var S=P.elt;S.zip_listeners=!0,S.invalidate_pairs(),P=P.next}for(var A=null,j=l.listeners.head;null!=j;){var E=j.elt;if(n.precedence>E.precedence||n.precedence==E.precedence&&n.id>E.id)break;A=j,j=j.next}var I,T=l.listeners;null==gi.zpp_pool?I=new gi:(I=gi.zpp_pool,gi.zpp_pool=I.next,I.next=null),I.elt=n;var N=I;null==A?(N.next=T.head,T.head=N):(N.next=A.next,A.next=N),T.pushmod=T.modified=!0,T.length++;for(var L=l.cbsets.head;null!=L;){var V=L.elt;V.zip_listeners=!0,V.invalidate_pairs(),L=L.next}if(e)for(var D=l.interactors.head;null!=D;)D.elt.wake(),D=D.next;i=i.next}}for(;null!=t;){var F=t.elt;F.listeners.remove(n);for(var R=F.cbsets.head;null!=R;){var Z=R.elt;Z.zip_listeners=!0,Z.invalidate_pairs(),R=R.next}for(var B=null,G=F.listeners.head;null!=G;){var q=G.elt;if(n.precedence>q.precedence||n.precedence==q.precedence&&n.id>q.id)break;B=G,G=G.next}var U,K=F.listeners;null==gi.zpp_pool?U=new gi:(U=gi.zpp_pool,gi.zpp_pool=U.next,U.next=null),U.elt=n;var W=U;null==B?(W.next=K.head,K.head=W):(W.next=B.next,B.next=W),K.pushmod=K.modified=!0,K.length++;for(var Y=F.cbsets.head;null!=Y;){var J=Y.elt;J.zip_listeners=!0,J.invalidate_pairs(),Y=Y.next}if(e)for(var X=F.interactors.head;null!=X;)X.elt.wake(),X=X.next;t=t.next}for(;null!=i;){var H=i.elt;H.listeners.remove(n);for(var $=H.cbsets.head;null!=$;){var Q=$.elt;Q.zip_listeners=!0,Q.invalidate_pairs(),$=$.next}for(var nn=null,en=H.listeners.head;null!=en;){var tn=en.elt;if(n.precedence>tn.precedence||n.precedence==tn.precedence&&n.id>tn.id)break;nn=en,en=en.next}var pn,ln=H.listeners;null==gi.zpp_pool?pn=new gi:(pn=gi.zpp_pool,gi.zpp_pool=pn.next,pn.next=null),pn.elt=n;var rn=pn;null==nn?(rn.next=ln.head,ln.head=rn):(rn.next=nn.next,nn.next=rn),ln.pushmod=ln.modified=!0,ln.length++;for(var on=H.cbsets.head;null!=on;){var an=on.elt;an.zip_listeners=!0,an.invalidate_pairs(),on=on.next}if(e)for(var sn=H.interactors.head;null!=sn;)sn.elt.wake(),sn=sn.next;i=i.next}}},ue.prototype.cbtype_change1=function(n,e,t){this.cbtype_change(this.options1,n,e,t)},ue.prototype.cbtype_change2=function(n,e,t){this.cbtype_change(this.options2,n,e,t)},ue.prototype.cbtype_change=function(n,e,t,i){if(this.removedFromSpace(),t)if(i){for(var p=null,l=n.includes.head;null!=l&&!(e.id<l.elt.id);)p=l,l=l.next;var r,o=n.includes;null==yi.zpp_pool?r=new yi:(r=yi.zpp_pool,yi.zpp_pool=r.next,r.next=null),r.elt=e;var a=r;null==p?(a.next=o.head,o.head=a):(a.next=p.next,p.next=a),o.pushmod=o.modified=!0,o.length++}else n.includes.remove(e);else if(i){for(var s=null,_=n.excludes.head;null!=_&&!(e.id<_.elt.id);)s=_,_=_.next;var h,u=n.excludes;null==yi.zpp_pool?h=new yi:(h=yi.zpp_pool,yi.zpp_pool=h.next,h.next=null),h.elt=e;var x=h;null==s?(x.next=u.head,u.head=x):(x.next=s.next,s.next=x),u.pushmod=u.modified=!0,u.length++}else n.excludes.remove(e);this.addedToSpace()},ue.prototype.swapEvent=function(n){this.removedFromSpace(),this.event=n,this.addedToSpace()},ue.prototype.__class__=ue;var xe=zpp_nape.callbacks.ZPP_OptionType=function(){this.wrap_excludes=null,this.wrap_includes=null,this.excludes=null,this.includes=null,this.handler=null,this.outer=null,this.includes=new he,this.excludes=new he};xe.__name__=["zpp_nape","callbacks","ZPP_OptionType"],xe.argument=function(n){return null==n?new M:r.__instanceof(n,M)?n:(new M).including(n)},xe.prototype.outer=null,xe.prototype.handler=null,xe.prototype.includes=null,xe.prototype.excludes=null,xe.prototype.wrap_includes=null,xe.prototype.wrap_excludes=null,xe.prototype.setup_includes=function(){this.wrap_includes=tp.get(this.includes,!0)},xe.prototype.setup_excludes=function(){this.wrap_excludes=tp.get(this.excludes,!0)},xe.prototype.excluded=function(n){return this.nonemptyintersection(n,this.excludes)},xe.prototype.included=function(n){return this.nonemptyintersection(n,this.includes)},xe.prototype.compatible=function(n){return!!this.nonemptyintersection(n,this.includes)&&!this.nonemptyintersection(n,this.excludes)},xe.prototype.nonemptyintersection=function(n,e){for(var t=!1,i=n.head,p=e.head;null!=p&&null!=i;){var l=p.elt,r=i.elt;if(l==r){t=!0;break}l.id<r.id?p=p.next:i=i.next}return t},xe.prototype.effect_change=function(n,e,t){if(e)if(t){for(var i=null,p=this.includes.head;null!=p&&!(n.id<p.elt.id);)i=p,p=p.next;var l,r=this.includes;null==yi.zpp_pool?l=new yi:(l=yi.zpp_pool,yi.zpp_pool=l.next,l.next=null),l.elt=n;var o=l;null==i?(o.next=r.head,r.head=o):(o.next=i.next,i.next=o),r.pushmod=r.modified=!0,r.length++}else this.includes.remove(n);else if(t){for(var a=null,s=this.excludes.head;null!=s&&!(n.id<s.elt.id);)a=s,s=s.next;var _,h=this.excludes;null==yi.zpp_pool?_=new yi:(_=yi.zpp_pool,yi.zpp_pool=_.next,_.next=null),_.elt=n;var u=_;null==a?(u.next=h.head,h.head=u):(u.next=a.next,a.next=u),h.pushmod=h.modified=!0,h.length++}else this.excludes.remove(n)},xe.prototype.append_type=function(n,e){if(n==this.includes){if(!this.includes.has(e))if(this.excludes.has(e))null!=this.handler?this.handler(e,!1,!1):this.excludes.remove(e);else if(null!=this.handler)this.handler(e,!0,!0);else{for(var t=null,i=this.includes.head;null!=i&&!(e.id<i.elt.id);)t=i,i=i.next;var p,l=this.includes;null==yi.zpp_pool?p=new yi:(p=yi.zpp_pool,yi.zpp_pool=p.next,p.next=null),p.elt=e;var r=p;null==t?(r.next=l.head,l.head=r):(r.next=t.next,t.next=r),l.pushmod=l.modified=!0,l.length++}}else if(!this.excludes.has(e))if(this.includes.has(e))null!=this.handler?this.handler(e,!0,!1):this.includes.remove(e);else if(null!=this.handler)this.handler(e,!1,!0);else{for(var o=null,a=this.excludes.head;null!=a&&!(e.id<a.elt.id);)o=a,a=a.next;var s,_=this.excludes;null==yi.zpp_pool?s=new yi:(s=yi.zpp_pool,yi.zpp_pool=s.next,s.next=null),s.elt=e;var h=s;null==o?(h.next=_.head,_.head=h):(h.next=o.next,o.next=h),_.pushmod=_.modified=!0,_.length++}},xe.prototype.set=function(n){if(n!=this){for(;null!=this.includes.head;)this.append_type(this.excludes,this.includes.head.elt);for(;null!=this.excludes.head;)this.append_type(this.includes,this.excludes.head.elt);for(var e=n.excludes.head;null!=e;)this.append_type(this.excludes,e.elt),e=e.next;for(var t=n.includes.head;null!=t;)this.append_type(this.includes,t.elt),t=t.next}return this},xe.prototype.append=function(n,e){if(r.__instanceof(e,x)){var t=e;this.append_type(n,t.zpp_inner)}else if(r.__instanceof(e,y)){var i=e;i.zpp_inner.valmod();for(var p=d.get(i);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var o,a=l.zpp_inner.user_length;if(p.zpp_critical=!0,p.zpp_i<a?o=!0:(p.zpp_next=d.zpp_pool,d.zpp_pool=p,p.zpp_inner=null,o=!1),!o)break;p.zpp_critical=!1,this.append_type(n,p.zpp_inner.at(p.zpp_i++).zpp_inner)}}else if(e instanceof Array&&null==e.__enum__)for(var s=e,_=0;_<s.length;){var h=s[_];++_;var u=h;this.append_type(n,u.zpp_inner)}},xe.prototype.__class__=xe;var de=zpp_nape.constraint.ZPP_Constraint=function(){this.pre_dt=0,this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.__velocity=!1,this.ignore=!1,this.component=null,this.removeOnBreak=!1,this.breakUnderError=!1,this.breakUnderForce=!1,this.maxError=0,this.maxForce=0,this.damping=0,this.frequency=0,this.stiff=!1,this.active=!1,this.space=null,this.compound=null,this.userData=null,this.id=0,this.outer=null,this.__velocity=!1,this.id=Xn.Constraint(),this.stiff=!0,this.active=!0,this.ignore=!1,this.frequency=10,this.damping=1,this.maxForce=1/0,this.maxError=1/0,this.breakUnderForce=!1,this.removeOnBreak=!0,this.pre_dt=-1,this.cbTypes=new he};de.__name__=["zpp_nape","constraint","ZPP_Constraint"],de.prototype.outer=null,de.prototype.clear=function(){},de.prototype.id=null,de.prototype.userData=null,de.prototype.compound=null,de.prototype.space=null,de.prototype.active=null,de.prototype.stiff=null,de.prototype.frequency=null,de.prototype.damping=null,de.prototype.maxForce=null,de.prototype.maxError=null,de.prototype.breakUnderForce=null,de.prototype.breakUnderError=null,de.prototype.removeOnBreak=null,de.prototype.component=null,de.prototype.ignore=null,de.prototype.__velocity=null,de.prototype.immutable_midstep=function(n){},de.prototype.cbTypes=null,de.prototype.cbSet=null,de.prototype.wrap_cbTypes=null,de.prototype.setupcbTypes=function(){this.wrap_cbTypes=tp.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=e(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=e(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},de.prototype.wrap_cbTypes_subber=function(n){var e=n.zpp_inner;this.cbTypes.has(e)&&(null!=this.space&&(this.dealloc_cbSet(),e.constraints.remove(this)),this.cbTypes.remove(e),null!=this.space&&(this.alloc_cbSet(),this.wake()))},de.prototype.wrap_cbTypes_adder=function(n){return this.insert_cbtype(n.zpp_inner),!1},de.prototype.insert_cbtype=function(n){if(!this.cbTypes.has(n)){null!=this.space&&(this.dealloc_cbSet(),n.constraints.add(this));for(var e=null,t=this.cbTypes.head;null!=t&&!(n.id<t.elt.id);)e=t,t=t.next;var i,p=this.cbTypes;null==yi.zpp_pool?i=new yi:(i=yi.zpp_pool,yi.zpp_pool=i.next,i.next=null),i.elt=n;var l=i;null==e?(l.next=p.head,p.head=l):(l.next=e.next,e.next=l),p.pushmod=p.modified=!0,p.length++,null!=this.space&&(this.alloc_cbSet(),this.wake())}},de.prototype.alloc_cbSet=function(){null!=(this.cbSet=this.space.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.constraints.add(this))},de.prototype.dealloc_cbSet=function(){if(null!=this.cbSet){if(this.cbSet.constraints.remove(this),0==--this.cbSet.count){this.space.cbsets.remove(this.cbSet);var n=this.cbSet;for(n.listeners.clear(),n.zip_listeners=!0,n.bodylisteners.clear(),n.zip_bodylisteners=!0,n.conlisteners.clear(),n.zip_conlisteners=!0;null!=n.cbTypes.head;)n.cbTypes.pop_unsafe().cbsets.remove(n);n.next=$n.zpp_pool,$n.zpp_pool=n}this.cbSet=null}},de.prototype.activate=function(){null!=this.space&&this.activeInSpace()},de.prototype.deactivate=function(){null!=this.space&&this.inactiveOrOutSpace()},de.prototype.addedToSpace=function(){this.active&&this.activeInSpace(),this.activeBodies();for(var n=this.cbTypes.head;null!=n;)n.elt.constraints.add(this),n=n.next},de.prototype.removedFromSpace=function(){this.active&&this.inactiveOrOutSpace(),this.inactiveBodies();for(var n=this.cbTypes.head;null!=n;)n.elt.constraints.remove(this),n=n.next},de.prototype.activeInSpace=function(){this.alloc_cbSet(),null==jt.zpp_pool?this.component=new jt:(this.component=jt.zpp_pool,jt.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!1,this.component.constraint=this},de.prototype.inactiveOrOutSpace=function(){this.dealloc_cbSet();var n=this.component;n.body=null,n.constraint=null,n.next=jt.zpp_pool,jt.zpp_pool=n,this.component=null},de.prototype.activeBodies=function(){},de.prototype.inactiveBodies=function(){},de.prototype.clearcache=function(){},de.prototype.validate=function(){},de.prototype.wake_connected=function(){},de.prototype.forest=function(){},de.prototype.pair_exists=function(n,e){return!1},de.prototype.broken=function(){},de.prototype.warmStart=function(){},de.prototype.pre_dt=null,de.prototype.preStep=function(n){return!1},de.prototype.applyImpulseVel=function(){return!1},de.prototype.applyImpulsePos=function(){return!1},de.prototype.wake=function(){null!=this.space&&this.space.wake_constraint(this)},de.prototype.draw=function(n){},de.prototype.copy=function(n,e){return null},de.prototype.copyto=function(n){var e=this.outer;null==e.zpp_inner.wrap_cbTypes&&e.zpp_inner.setupcbTypes();var t=e.zpp_inner.wrap_cbTypes;t.zpp_inner.valmod();for(var i=d.get(t);;){i.zpp_inner.zpp_inner.valmod();var p=i.zpp_inner;p.zpp_inner.valmod(),p.zpp_inner.zip_length&&(p.zpp_inner.zip_length=!1,p.zpp_inner.user_length=p.zpp_inner.inner.length);var l,r=p.zpp_inner.user_length;if(i.zpp_critical=!0,i.zpp_i<r?l=!0:(i.zpp_next=d.zpp_pool,d.zpp_pool=i,i.zpp_inner=null,l=!1),!l)break;i.zpp_critical=!1;var o=i.zpp_inner.at(i.zpp_i++);null==n.zpp_inner.wrap_cbTypes&&n.zpp_inner.setupcbTypes();var a=n.zpp_inner.wrap_cbTypes;a.zpp_inner.reverse_flag?a.push(o):a.unshift(o)}n.zpp_inner.removeOnBreak=e.zpp_inner.removeOnBreak;var s=e.zpp_inner.breakUnderError;n.zpp_inner.breakUnderError!=s&&(n.zpp_inner.breakUnderError=s,n.zpp_inner.wake());var _=e.zpp_inner.breakUnderForce;n.zpp_inner.breakUnderForce!=_&&(n.zpp_inner.breakUnderForce=_,n.zpp_inner.wake());var h=e.zpp_inner.maxError;n.zpp_inner.maxError!=h&&(n.zpp_inner.maxError=h,n.zpp_inner.wake());var u=e.zpp_inner.maxForce;n.zpp_inner.maxForce!=u&&(n.zpp_inner.maxForce=u,n.zpp_inner.wake());var x=e.zpp_inner.damping;n.zpp_inner.damping!=x&&(n.zpp_inner.damping=x,n.zpp_inner.stiff||n.zpp_inner.wake());var y=e.zpp_inner.frequency;n.zpp_inner.frequency!=y&&(n.zpp_inner.frequency=y,n.zpp_inner.stiff||n.zpp_inner.wake());var z=e.zpp_inner.stiff;n.zpp_inner.stiff!=z&&(n.zpp_inner.stiff=z,n.zpp_inner.wake());var v=e.zpp_inner.ignore;n.zpp_inner.ignore!=v&&(n.zpp_inner.ignore=v,n.zpp_inner.wake());var c=e.zpp_inner.active;n.zpp_inner.active!=c&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.woken=!1),n.zpp_inner.clearcache(),c?(n.zpp_inner.active=c,n.zpp_inner.activate(),null!=n.zpp_inner.space&&(null!=n.zpp_inner.component&&(n.zpp_inner.component.sleeping=!0),n.zpp_inner.space.wake_constraint(n.zpp_inner,!0))):(null!=n.zpp_inner.space&&(n.zpp_inner.wake(),n.zpp_inner.space.live_constraints.remove(n.zpp_inner)),n.zpp_inner.active=c,n.zpp_inner.deactivate()))},de.prototype.__class__=de;var ye=zpp_nape.constraint.ZPP_AngleJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.scale=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=0,this.outer_zn=null,de.call(this),this.ratio=1,this.jAcc=0,this.slack=!1,this.jMax=1/0,this.stepped=!1};ye.__name__=["zpp_nape","constraint","ZPP_AngleJoint"],ye.__super__=de,ye.prototype=Object.create(de.prototype),ye.prototype.outer_zn=null,ye.prototype.ratio=null,ye.prototype.jointMin=null,ye.prototype.jointMax=null,ye.prototype.slack=null,ye.prototype.equal=null,ye.prototype.scale=null,ye.prototype.is_slack=function(){var n,e=this.ratio*this.b2.rot-this.b1.rot;return this.equal?(n=!1,this.scale=1):e<this.jointMin?(this.scale=-1,n=!1):e>this.jointMax?(e-=this.jointMax,this.scale=1,n=!1):(this.scale=0,e=0,n=!0),n},ye.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?cn.get(0,0,-this.scale*this.jAcc):cn.get(0,0,this.ratio*this.scale*this.jAcc):cn.get(0,0,0)},ye.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},ye.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},ye.prototype.b1=null,ye.prototype.b2=null,ye.prototype.kMass=null,ye.prototype.jAcc=null,ye.prototype.jMax=null,ye.prototype.gamma=null,ye.prototype.bias=null,ye.prototype.stepped=null,ye.prototype.copy=function(n,e){var t=new S(null,null,this.jointMin,this.jointMax,this.ratio);if(this.copyto(t),null!=n&&null!=this.b1){for(var i=null,p=0;p<n.length;){var l=n[p];if(++p,l.id==this.b1.id){i=l.bc;break}}null!=i?t.zpp_inner_zn.b1=i.zpp_inner:e.push(ze.todo(this.b1.id,function(n){t.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b2.id){r=a.bc;break}}null!=r?t.zpp_inner_zn.b2=r.zpp_inner:e.push(ze.todo(this.b2.id,function(n){t.zpp_inner_zn.b2=n.zpp_inner}))}return t},ye.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new l("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new l("Error: AngleJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new l("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new l("Error: AngleJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new l("Error: Constraints cannot have both bodies non-dynamic")},ye.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},ye.prototype.forest=function(){if(2==this.b1.type){var n,e;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var t=this.b1.component,i=null;t!=t.parent;){var p=t.parent;t.parent=i,i=t,t=p}for(;null!=i;){var l=i.parent;i.parent=t,i=l}n=t}if(this.component==this.component.parent)e=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}e=r}n!=e&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n,n.rank++))}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,v=null;z!=z.parent;){var c=z.parent;z.parent=v,v=z,z=c}for(;null!=v;){var f=v.parent;v.parent=z,v=f}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_,_.rank++))}},ye.prototype.pair_exists=function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},ye.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1,this.slack=!1},ye.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax;var t=this.ratio*this.b2.rot-this.b1.rot;this.equal?(t-=this.jointMax,this.slack=!1,this.scale=1):t<this.jointMin?(t=this.jointMin-t,this.scale=-1,this.slack=!1):t>this.jointMax?(t-=this.jointMax,this.scale=1,this.slack=!1):(this.scale=0,t=0,this.slack=!0);var i=t;if(!this.slack){if(this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&i*i>this.maxError*this.maxError)return!0;var p,l=2*Math.PI*this.frequency;this.gamma=1/(n*l*(2*this.damping+l*n));var r=1/(1+this.gamma);p=n*l*l*this.gamma,this.gamma*=r,this.kMass*=r,this.bias=-i*p,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},ye.prototype.warmStart=function(){this.slack||(this.b1.angvel-=this.scale*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*this.jAcc)},ye.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-this.scale*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel))-this.jAcc*this.gamma,e=this.jAcc;return this.jAcc+=n,!this.equal&&this.jAcc>0&&(this.jAcc=0),!(!this.breakUnderForce||!(this.jAcc>this.jMax||this.jAcc<-this.jMax))||(this.stiff||(this.jAcc>this.jMax?this.jAcc=this.jMax:this.jAcc<-this.jMax&&(this.jAcc=-this.jMax)),n=this.jAcc-e,this.b1.angvel-=this.scale*this.b1.iinertia*n,this.b2.angvel+=this.ratio*this.scale*this.b2.iinertia*n,!1)},ye.prototype.applyImpulsePos=function(){var n,e,t,i=this.ratio*this.b2.rot-this.b1.rot;if(this.equal?(i-=this.jointMax,t=!1,this.scale=1):i<this.jointMin?(i=this.jointMin-i,this.scale=-1,t=!1):i>this.jointMax?(i-=this.jointMax,this.scale=1,t=!1):(this.scale=0,i=0,t=!0),n=i,!t){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(e=-(n*=.5)*this.kMass,this.equal||e<0){var p=this.b1,l=-this.scale*e*this.b1.iinertia;if(p.rot+=l,l*l>1e-4)p.axisx=Math.sin(p.rot),p.axisy=Math.cos(p.rot);else{var r=l*l,o=1-.5*r,a=1-r*r/8,s=(o*p.axisx+l*p.axisy)*a;p.axisy=(o*p.axisy-l*p.axisx)*a,p.axisx=s}var _=this.b2,h=this.ratio*this.scale*e*this.b2.iinertia;if(_.rot+=h,h*h>1e-4)_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot);else{var u=h*h,x=1-.5*u,d=1-u*u/8,y=(x*_.axisx+h*_.axisy)*d;_.axisy=(x*_.axisy-h*_.axisx)*d,_.axisx=y}}}return!1},ye.prototype.draw=function(n){},ye.prototype.__class__=ye;var ze=zpp_nape.constraint.ZPP_CopyHelper=function(){this.cb=null,this.bc=null,this.id=0};ze.__name__=["zpp_nape","constraint","ZPP_CopyHelper"],ze.dict=function(n,e){var t=new ze;return t.id=n,t.bc=e,t},ze.todo=function(n,e){var t=new ze;return t.id=n,t.cb=e,t},ze.prototype.id=null,ze.prototype.bc=null,ze.prototype.cb=null,ze.prototype.__class__=ze;var ve=zpp_nape.constraint.ZPP_DistanceJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx2=0,this.cx1=0,this.ny=0,this.nx=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.outer_zn=null,de.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=0};ve.__name__=["zpp_nape","constraint","ZPP_DistanceJoint"],ve.__super__=de,ve.prototype=Object.create(de.prototype),ve.prototype.outer_zn=null,ve.prototype.jointMin=null,ve.prototype.jointMax=null,ve.prototype.slack=null,ve.prototype.equal=null,ve.prototype.is_slack=function(){var n;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var e=0,t=0,i=(e=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx))*e+(t=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely))*t;if(i<o.epsilon)n=!0;else{var p=1/(i=Math.sqrt(i));e*=p,t*=p,this.equal?n=!1:i<this.jointMin?n=!1:i>this.jointMax?(i-=this.jointMax,n=!1):(e=0,t=0,i=0,n=!0)}return n},ve.prototype.nx=null,ve.prototype.ny=null,ve.prototype.cx1=null,ve.prototype.cx2=null,ve.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?cn.get(-this.jAcc*this.nx,-this.jAcc*this.ny,-this.cx1*this.jAcc):cn.get(this.jAcc*this.nx,this.jAcc*this.ny,this.cx2*this.jAcc):cn.get(0,0,0)},ve.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},ve.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},ve.prototype.b1=null,ve.prototype.a1localx=null,ve.prototype.a1localy=null,ve.prototype.a1relx=null,ve.prototype.a1rely=null,ve.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},ve.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},ve.prototype.setup_a1=function(){var n,t=this.a1localx,i=this.a1localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=e(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=e(this,this.invalidate_a1)},ve.prototype.wrap_a1=null,ve.prototype.b2=null,ve.prototype.a2localx=null,ve.prototype.a2localy=null,ve.prototype.a2relx=null,ve.prototype.a2rely=null,ve.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},ve.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},ve.prototype.setup_a2=function(){var n,t=this.a2localx,i=this.a2localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=e(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=e(this,this.invalidate_a2)},ve.prototype.wrap_a2=null,ve.prototype.kMass=null,ve.prototype.jAcc=null,ve.prototype.jMax=null,ve.prototype.gamma=null,ve.prototype.bias=null,ve.prototype.stepped=null,ve.prototype.copy=function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=new E(null,null,i,p.zpp_inner_zn.wrap_a2,this.jointMin,this.jointMax);if(this.copyto(l),null!=n&&null!=this.b1){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b1.id){r=a.bc;break}}null!=r?l.zpp_inner_zn.b1=r.zpp_inner:e.push(ze.todo(this.b1.id,function(n){l.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var s=null,_=0;_<n.length;){var h=n[_];if(++_,h.id==this.b2.id){s=h.bc;break}}null!=s?l.zpp_inner_zn.b2=s.zpp_inner:e.push(ze.todo(this.b2.id,function(n){l.zpp_inner_zn.b2=n.zpp_inner}))}return l},ve.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new l("Error: DistanceJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new l("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new l("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new l("Error: DistanceJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new l("Error: Constraints cannot have both bodies non-dynamic")},ve.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},ve.prototype.forest=function(){if(2==this.b1.type){var n,e;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var t=this.b1.component,i=null;t!=t.parent;){var p=t.parent;t.parent=i,i=t,t=p}for(;null!=i;){var l=i.parent;i.parent=t,i=l}n=t}if(this.component==this.component.parent)e=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}e=r}n!=e&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n,n.rank++))}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,v=null;z!=z.parent;){var c=z.parent;z.parent=v,v=z,z=c}for(;null!=v;){var f=v.parent;v.parent=z,v=f}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_,_.rank++))}},ve.prototype.pair_exists=function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},ve.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},ve.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.nx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.ny=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely);var t=this.nx*this.nx+this.ny*this.ny;if(t<o.epsilon)this.nx=0,this.ny=0,t=0,this.slack=!0;else{var i=1/(t=Math.sqrt(t));this.nx*=i,this.ny*=i,this.equal?(t-=this.jointMax,this.slack=!1):t<this.jointMin?(t=this.jointMin-t,this.nx=-this.nx,this.ny=-this.ny,this.slack=!1):t>this.jointMax?(t-=this.jointMax,this.slack=!1):(this.nx=0,this.ny=0,t=0,this.slack=!0)}var p=t;if(!this.slack){if(this.cx1=this.ny*this.a1relx-this.nx*this.a1rely,this.cx2=this.ny*this.a2relx-this.nx*this.a2rely,this.kMass=this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&p*p>this.maxError*this.maxError)return!0;var l,r=2*Math.PI*this.frequency;this.gamma=1/(n*r*(2*this.damping+r*n));var a=1/(1+this.gamma);l=n*r*r*this.gamma,this.gamma*=a,this.kMass*=a,this.bias=-p*l,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},ve.prototype.warmStart=function(){if(!this.slack){var n=this.b1.imass*this.jAcc;this.b1.velx-=this.nx*n,this.b1.vely-=this.ny*n;var e=this.b2.imass*this.jAcc;this.b2.velx+=this.nx*e,this.b2.vely+=this.ny*e,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc}},ve.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-(this.nx*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.ny*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1))-this.jAcc*this.gamma,e=this.jAcc;if(this.jAcc+=n,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),n=this.jAcc-e;var t=this.b1.imass*n;this.b1.velx-=this.nx*t,this.b1.vely-=this.ny*t;var i=this.b2.imass*n;return this.b2.velx+=this.nx*i,this.b2.vely+=this.ny*i,this.b1.angvel-=this.cx1*this.b1.iinertia*n,this.b2.angvel+=this.cx2*this.b2.iinertia*n,!1},ve.prototype.applyImpulsePos=function(){var n,e,t,i;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var p,l,r;p=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,l=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var a=0,s=0,_=(a=this.b2.posx+p-(this.b1.posx+t))*a+(s=this.b2.posy+l-(this.b1.posy+i))*s;if(_<o.epsilon)a=0,s=0,_=0,r=!0;else{var h=1/(_=Math.sqrt(_));a*=h,s*=h,this.equal?(_-=this.jointMax,r=!1):_<this.jointMin?(_=this.jointMin-_,a=-a,s=-s,r=!1):_>this.jointMax?(_-=this.jointMax,r=!1):(a=0,s=0,_=0,r=!0)}if(n=_,!r){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(n*n<o.constraintLinearSlop*o.constraintLinearSlop)return!1;if((n*=.5)*n>6){var u=this.b1.smass+this.b2.smass;if(u>o.epsilon&&(e=-n*(u=.75/u),this.equal||e<0)){var x=e*this.b1.imass;this.b1.posx-=a*x,this.b1.posy-=s*x;var d=e*this.b2.imass;this.b2.posx+=a*d,this.b2.posy+=s*d;var y=(a=this.b2.posx+p-(this.b1.posx+t))*a+(s=this.b2.posy+l-(this.b1.posy+i))*s;if(y<o.epsilon)a=0,s=0,y=0;else{var z=1/(y=Math.sqrt(y));a*=z,s*=z,this.equal?y-=this.jointMax:y<this.jointMin?(y=this.jointMin-y,a=-a,s=-s):y>this.jointMax?y-=this.jointMax:(a=0,s=0,y=0)}n=y,n*=.5}}var v,c;v=s*t-a*i,c=s*p-a*l;var f=this.b1.smass+this.b2.smass+v*v*this.b1.sinertia+c*c*this.b2.sinertia;if(0!=f&&(f=1/f),e=-n*f,this.equal||e<0){var m=this.b1.imass*e;this.b1.posx-=a*m,this.b1.posy-=s*m;var b=this.b2.imass*e;this.b2.posx+=a*b,this.b2.posy+=s*b;var g=this.b1,w=-v*this.b1.iinertia*e;if(g.rot+=w,w*w>1e-4)g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot);else{var M=w*w,C=1-.5*M,k=1-M*M/8,O=(C*g.axisx+w*g.axisy)*k;g.axisy=(C*g.axisy-w*g.axisx)*k,g.axisx=O}var P=this.b2,S=c*this.b2.iinertia*e;if(P.rot+=S,S*S>1e-4)P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot);else{var A=S*S,j=1-.5*A,E=1-A*A/8,I=(j*P.axisx+S*P.axisy)*E;P.axisy=(j*P.axisy-S*P.axisx)*E,P.axisx=I}}}return!1},ve.prototype.draw=function(n){},ve.prototype.__class__=ve;var ce=zpp_nape.constraint.ZPP_LineJoint=function(){this.biasy=0,this.biasx=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_n=null,this.nrely=0,this.nrelx=0,this.nlocaly=0,this.nlocalx=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.cx2=0,this.cx1=0,this.dot2=0,this.dot1=0,this.equal=!1,this.jointMax=0,this.jointMin=0,this.scale=0,this.outer_zn=null,de.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.nlocalx=0,this.nlocaly=0,this.nrelx=0,this.nrely=0,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.jointMin=-1/0,this.jointMax=1/0,this.stepped=!1};ce.__name__=["zpp_nape","constraint","ZPP_LineJoint"],ce.__super__=de,ce.prototype=Object.create(de.prototype),ce.prototype.outer_zn=null,ce.prototype.scale=null,ce.prototype.jointMin=null,ce.prototype.jointMax=null,ce.prototype.equal=null,ce.prototype.dot1=null,ce.prototype.dot2=null,ce.prototype.cx1=null,ce.prototype.cx2=null,ce.prototype.bodyImpulse=function(n){if(this.stepped){var e=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,t=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy;return n==this.b1?cn.get(-e,-t,this.scale*this.cx1*t-this.dot1*e):cn.get(e,t,this.scale*this.cx1*t-this.dot1*e)}return cn.get(0,0,0)},ce.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},ce.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},ce.prototype.b1=null,ce.prototype.a1localx=null,ce.prototype.a1localy=null,ce.prototype.a1relx=null,ce.prototype.a1rely=null,ce.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},ce.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},ce.prototype.setup_a1=function(){var n,t=this.a1localx,i=this.a1localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=e(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=e(this,this.invalidate_a1)},ce.prototype.wrap_a1=null,ce.prototype.b2=null,ce.prototype.a2localx=null,ce.prototype.a2localy=null,ce.prototype.a2relx=null,ce.prototype.a2rely=null,ce.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},ce.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},ce.prototype.setup_a2=function(){var n,t=this.a2localx,i=this.a2localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=e(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=e(this,this.invalidate_a2)},ce.prototype.wrap_a2=null,ce.prototype.zip_n=null,ce.prototype.nlocalx=null,ce.prototype.nlocaly=null,ce.prototype.nrelx=null,ce.prototype.nrely=null,ce.prototype.validate_n=function(){this.wrap_n.zpp_inner.x=this.nlocalx,this.wrap_n.zpp_inner.y=this.nlocaly},ce.prototype.invalidate_n=function(n){this.immutable_midstep("Constraint::n"),this.nlocalx=n.x,this.nlocaly=n.y,this.zip_n=!0,this.wake()},ce.prototype.setup_n=function(){var n,t=this.nlocalx,i=this.nlocaly;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_n=n,this.wrap_n.zpp_inner._inuse=!0,this.wrap_n.zpp_inner._validate=e(this,this.validate_n),this.wrap_n.zpp_inner._invalidate=e(this,this.invalidate_n)},ce.prototype.wrap_n=null,ce.prototype.validate_norm=function(){if(this.zip_n){this.zip_n=!1;var n=1/Math.sqrt(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly);this.nlocalx*=n,this.nlocaly*=n}},ce.prototype.kMassa=null,ce.prototype.kMassb=null,ce.prototype.kMassc=null,ce.prototype.jAccx=null,ce.prototype.jAccy=null,ce.prototype.jMax=null,ce.prototype.gamma=null,ce.prototype.biasx=null,ce.prototype.biasy=null,ce.prototype.stepped=null,ce.prototype.copy=function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=p.zpp_inner_zn.wrap_a2,r=this.outer_zn;null==r.zpp_inner_zn.wrap_n&&r.zpp_inner_zn.setup_n();var o=new I(null,null,i,l,r.zpp_inner_zn.wrap_n,this.jointMin,this.jointMax);if(this.copyto(o),null!=n&&null!=this.b1){for(var a=null,s=0;s<n.length;){var _=n[s];if(++s,_.id==this.b1.id){a=_.bc;break}}null!=a?o.zpp_inner_zn.b1=a.zpp_inner:e.push(ze.todo(this.b1.id,function(n){o.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var h=null,u=0;u<n.length;){var x=n[u];if(++u,x.id==this.b2.id){h=x.bc;break}}null!=h?o.zpp_inner_zn.b2=h.zpp_inner:e.push(ze.todo(this.b2.id,function(n){o.zpp_inner_zn.b2=n.zpp_inner}))}return o},ce.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new l("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new l("Error: DistanceJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new l("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new l("Error: DistanceJoint must have jointMin <= jointMax");if(this.nlocalx*this.nlocalx+this.nlocaly*this.nlocaly<o.epsilon)throw new l("Error: DistanceJoint direction must be non-degenerate");if(2!=this.b1.type&&2!=this.b2.type)throw new l("Error: Constraints cannot have both bodies non-dynamic")},ce.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},ce.prototype.forest=function(){if(2==this.b1.type){var n,e;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var t=this.b1.component,i=null;t!=t.parent;){var p=t.parent;t.parent=i,i=t,t=p}for(;null!=i;){var l=i.parent;i.parent=t,i=l}n=t}if(this.component==this.component.parent)e=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}e=r}n!=e&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n,n.rank++))}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,v=null;z!=z.parent;){var c=z.parent;z.parent=v,v=z,z=c}for(;null!=v;){var f=v.parent;v.parent=z,v=f}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_,_.rank++))}},ce.prototype.pair_exists=function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},ce.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},ce.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.equal=this.jointMin==this.jointMax,this.stepped=!0,this.validate_norm(),this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.nrelx=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,this.nrely=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var t,i,p,l=0;t=this.b2.posx+this.a2relx-this.b1.posx-this.a1relx,p=(i=this.b2.posy+this.a2rely-this.b1.posy-this.a1rely)*this.nrelx-t*this.nrely,l=this.nrelx*t+this.nrely*i,this.equal?(l-=this.jointMin,this.scale=1):l>this.jointMax?(l-=this.jointMax,this.scale=1):l<this.jointMin?(l=this.jointMin-l,this.scale=-1):(l=0,this.scale=0);var r,o;r=t+this.a1relx,o=i+this.a1rely,this.dot1=this.nrelx*r+this.nrely*o,this.cx1=o*this.nrelx-r*this.nrely,this.dot2=this.nrelx*this.a2relx+this.nrely*this.a2rely,this.cx2=this.a2rely*this.nrelx-this.a2relx*this.nrely,this.kMassa=this.b1.smass+this.b2.smass+this.dot1*this.dot1*this.b1.sinertia+this.dot2*this.dot2*this.b2.sinertia,this.kMassb=-this.scale*(this.dot1*this.cx1*this.b1.sinertia+this.dot2*this.cx2*this.b2.sinertia),this.kMassc=this.scale*this.scale*(this.b1.smass+this.b2.smass+this.cx1*this.cx1*this.b1.sinertia+this.cx2*this.cx2*this.b2.sinertia);var a,s=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(s!=s)this.kMassa=this.kMassb=this.kMassc=0,a=3;else if(0==s){var _=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,_=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,_|=2),this.kMassb=0,a=_}else{s=1/s;var h=this.kMassc*s;this.kMassc=this.kMassa*s,this.kMassa=h,this.kMassb*=-s,a=0}if(0!=(1&a)&&(this.jAccx=0),0!=(2&a)&&(this.jAccy=0),this.stiff)this.gamma=0,this.biasx=0,this.biasy=0;else{if(this.breakUnderError&&p*p+l*l>this.maxError*this.maxError)return!0;var u,x=2*Math.PI*this.frequency;this.gamma=1/(n*x*(2*this.damping+x*n));var d=1/(1+this.gamma);u=n*x*x*this.gamma,this.gamma*=d,this.kMassa*=d,this.kMassb*=d,this.kMassc*=d,this.biasx=p,this.biasy=l;var y=-u;this.biasx*=y,this.biasy*=y;var z=this.maxError,v=this.biasx*this.biasx+this.biasy*this.biasy;if(v>z*z){var c=z*(1/Math.sqrt(v));this.biasx*=c,this.biasy*=c}}return this.jAccx*=e,this.jAccy*=e,this.jMax=this.maxForce*n,!1},ce.prototype.warmStart=function(){var n=this.scale*this.nrelx*this.jAccy-this.nrely*this.jAccx,e=this.nrelx*this.jAccx+this.scale*this.nrely*this.jAccy,t=this.b1.imass;this.b1.velx-=n*t,this.b1.vely-=e*t;var i=this.b2.imass;this.b2.velx+=n*i,this.b2.vely+=e*i,this.b1.angvel+=(this.scale*this.cx1*this.jAccy-this.dot1*this.jAccx)*this.b1.iinertia,this.b2.angvel+=(this.dot2*this.jAccx-this.scale*this.cx2*this.jAccy)*this.b2.iinertia},ce.prototype.applyImpulseVel=function(){var n,e,t=0,i=0;t=this.b2.velx-this.b1.velx,i=this.b2.vely-this.b1.vely,t+=this.b2.kinvelx-this.b1.kinvelx,n=(i+=this.b2.kinvely-this.b1.kinvely)*this.nrelx-t*this.nrely+(this.b2.angvel+this.b2.kinangvel)*this.dot2-(this.b1.angvel+this.b1.kinangvel)*this.dot1,e=this.scale*(this.nrelx*t+this.nrely*i-(this.b2.angvel+this.b2.kinangvel)*this.cx2+(this.b1.angvel+this.b1.kinangvel)*this.cx1);var p=0,l=0;p=this.biasx-n,l=this.biasy-e;var r=this.kMassa*p+this.kMassb*l;l=this.kMassb*p+this.kMassc*l,p=r;var o=this.gamma;p-=this.jAccx*o,l-=this.jAccy*o;var a,s;if(a=this.jAccx,s=this.jAccy,this.jAccx+=p,this.jAccy+=l,this.jAccy>0&&(this.jAccy=0),this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var _=this.jMax,h=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(h>_*_){var u=_*(1/Math.sqrt(h));this.jAccx*=u,this.jAccy*=u}}p=this.jAccx-a,l=this.jAccy-s;var x=this.scale*this.nrelx*l-this.nrely*p,d=this.nrelx*p+this.scale*this.nrely*l,y=this.b1.imass;this.b1.velx-=x*y,this.b1.vely-=d*y;var z=this.b2.imass;return this.b2.velx+=x*z,this.b2.vely+=d*z,this.b1.angvel+=(this.scale*this.cx1*l-this.dot1*p)*this.b1.iinertia,this.b2.angvel+=(this.dot2*p-this.scale*this.cx2*l)*this.b2.iinertia,!1},ce.prototype.applyImpulsePos=function(){var n,e;n=this.b1.axisy*this.nlocalx-this.b1.axisx*this.nlocaly,e=this.nlocalx*this.b1.axisx+this.nlocaly*this.b1.axisy;var t,i;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var p,l;p=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,l=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var r,a=0,s=0,_=0,h=0;if(a=this.b2.posx+p-this.b1.posx-t,_=(s=this.b2.posy+l-this.b1.posy-i)*n-a*e,h=n*a+e*s,this.equal?(h-=this.jointMin,r=1):h>this.jointMax?(h-=this.jointMax,r=1):h<this.jointMin?(h=this.jointMin-h,r=-1):(h=0,r=0),this.breakUnderError&&_*_+h*h>this.maxError*this.maxError)return!0;if(_*_+h*h<o.constraintLinearSlop*o.constraintLinearSlop)return!1;var u,x,d,y,z=0,v=0;if((_*=.5)*_+(h*=.5)*h>6){var c=this.b1.smass+this.b2.smass;if(c>o.epsilon){var f=(c=.8/c)*(e*_-r*n*h),m=c*(n*_*r-e*_),b=this.b1.imass;this.b1.posx-=f*b,this.b1.posy-=m*b;var g=this.b2.imass;this.b2.posx+=f*g,this.b2.posy+=m*g,a=this.b2.posx+p-this.b1.posx-t,_=(s=this.b2.posy+l-this.b1.posy-i)*n-a*e,h=n*a+e*s,this.equal?(h-=this.jointMin,r=1):h>this.jointMax?(h-=this.jointMax,r=1):h<this.jointMin?(h=this.jointMin-h,r=-1):(h=0,r=0),_*=.5,h*=.5}}var w,M,C,k,O;u=n*(k=a+t)+e*(O=s+i),d=O*n-k*e,x=n*p+e*l,y=l*n-p*e,w=this.b1.smass+this.b2.smass+u*u*this.b1.sinertia+x*x*this.b2.sinertia,M=-r*(u*d*this.b1.sinertia+x*y*this.b2.sinertia),z=-_,v=-h;var P=w*(C=r*r*(this.b1.smass+this.b2.smass+d*d*this.b1.sinertia+y*y*this.b2.sinertia))-M*M;if(P!=P)z=v=0;else if(0==P)0!=w?z/=w:z=0,0!=C?v/=C:v=0;else{var S=(P=1/P)*(C*z-M*v);v=P*(w*v-M*z),z=S}v>0&&(v=0);var A=r*n*v-e*z,j=n*z+r*e*v,E=this.b1.imass;this.b1.posx-=A*E,this.b1.posy-=j*E;var I=this.b2.imass;this.b2.posx+=A*I,this.b2.posy+=j*I;var T=this.b1,N=(r*d*v-u*z)*this.b1.iinertia;if(T.rot+=N,N*N>1e-4)T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot);else{var L=N*N,V=1-.5*L,D=1-L*L/8,F=(V*T.axisx+N*T.axisy)*D;T.axisy=(V*T.axisy-N*T.axisx)*D,T.axisx=F}var R=this.b2,Z=(x*z-r*y*v)*this.b2.iinertia;if(R.rot+=Z,Z*Z>1e-4)R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot);else{var B=Z*Z,G=1-.5*B,q=1-B*B/8,U=(G*R.axisx+Z*R.axisy)*q;R.axisy=(G*R.axisy-Z*R.axisx)*q,R.axisx=U}return!1},ce.prototype.draw=function(n){},ce.prototype.__class__=ce;var fe=zpp_nape.constraint.ZPP_MotorJoint=function(){this.stepped=!1,this.jMax=0,this.jAcc=0,this.kMass=0,this.b2=null,this.b1=null,this.rate=0,this.ratio=0,this.outer_zn=null,de.call(this),this.jAcc=0,this.stepped=!1,this.__velocity=!0};fe.__name__=["zpp_nape","constraint","ZPP_MotorJoint"],fe.__super__=de,fe.prototype=Object.create(de.prototype),fe.prototype.outer_zn=null,fe.prototype.ratio=null,fe.prototype.rate=null,fe.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?cn.get(0,0,-this.jAcc):cn.get(0,0,this.ratio*this.jAcc):cn.get(0,0,0)},fe.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},fe.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},fe.prototype.b1=null,fe.prototype.b2=null,fe.prototype.kMass=null,fe.prototype.jAcc=null,fe.prototype.jMax=null,fe.prototype.stepped=null,fe.prototype.copy=function(n,e){var t=new T(null,null,this.rate,this.ratio);if(this.copyto(t),null!=n&&null!=this.b1){for(var i=null,p=0;p<n.length;){var l=n[p];if(++p,l.id==this.b1.id){i=l.bc;break}}null!=i?t.zpp_inner_zn.b1=i.zpp_inner:e.push(ze.todo(this.b1.id,function(n){t.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b2.id){r=a.bc;break}}null!=r?t.zpp_inner_zn.b2=r.zpp_inner:e.push(ze.todo(this.b2.id,function(n){t.zpp_inner_zn.b2=n.zpp_inner}))}return t},fe.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new l("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new l("Error: MotorJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new l("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new l("Error: Constraints cannot have both bodies non-dynamic")},fe.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},fe.prototype.forest=function(){if(2==this.b1.type){var n,e;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var t=this.b1.component,i=null;t!=t.parent;){var p=t.parent;t.parent=i,i=t,t=p}for(;null!=i;){var l=i.parent;i.parent=t,i=l}n=t}if(this.component==this.component.parent)e=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}e=r}n!=e&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n,n.rank++))}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,v=null;z!=z.parent;){var c=z.parent;z.parent=v,v=z,z=c}for(;null!=v;){var f=v.parent;v.parent=z,v=f}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_,_.rank++))}},fe.prototype.pair_exists=function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},fe.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},fe.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;return this.pre_dt=n,this.stepped=!0,this.kMass=this.b1.sinertia+this.ratio*this.ratio*this.b2.sinertia,this.kMass=1/this.kMass,this.jAcc*=e,this.jMax=this.maxForce*n,!1},fe.prototype.warmStart=function(){this.b1.angvel-=this.b1.iinertia*this.jAcc,this.b2.angvel+=this.ratio*this.b2.iinertia*this.jAcc},fe.prototype.applyImpulseVel=function(){var n=-this.kMass*(this.ratio*(this.b2.angvel+this.b2.kinangvel)-this.b1.angvel-this.b1.kinangvel-this.rate),e=this.jAcc;if(this.jAcc+=n,this.breakUnderForce){if(this.jAcc>this.jMax||this.jAcc<-this.jMax)return!0}else this.jAcc<-this.jMax?this.jAcc=-this.jMax:this.jAcc>this.jMax&&(this.jAcc=this.jMax);return n=this.jAcc-e,this.b1.angvel-=this.b1.iinertia*n,this.b2.angvel+=this.ratio*this.b2.iinertia*n,!1},fe.prototype.applyImpulsePos=function(){return!1},fe.prototype.__class__=fe;var me=zpp_nape.constraint.ZPP_PivotJoint=function(){this.stepped=!1,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccy=0,this.jAccx=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,de.call(this),this.stepped=!1,this.jAccx=0,this.jAccy=0,this.jMax=1/0,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};me.__name__=["zpp_nape","constraint","ZPP_PivotJoint"],me.__super__=de,me.prototype=Object.create(de.prototype),me.prototype.outer_zn=null,me.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?cn.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely)):cn.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely):cn.get(0,0,0)},me.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},me.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},me.prototype.b1=null,me.prototype.a1localx=null,me.prototype.a1localy=null,me.prototype.a1relx=null,me.prototype.a1rely=null,me.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},me.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},me.prototype.setup_a1=function(){var n,t=this.a1localx,i=this.a1localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=e(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=e(this,this.invalidate_a1)},me.prototype.wrap_a1=null,me.prototype.b2=null,me.prototype.a2localx=null,me.prototype.a2localy=null,me.prototype.a2relx=null,me.prototype.a2rely=null,me.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},me.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},me.prototype.setup_a2=function(){var n,t=this.a2localx,i=this.a2localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=e(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=e(this,this.invalidate_a2)},me.prototype.wrap_a2=null,me.prototype.kMassa=null,me.prototype.kMassb=null,me.prototype.kMassc=null,me.prototype.jAccx=null,me.prototype.jAccy=null,me.prototype.jMax=null,me.prototype.gamma=null,me.prototype.biasx=null,me.prototype.biasy=null,me.prototype.stepped=null,me.prototype.copy=function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=new N(null,null,i,p.zpp_inner_zn.wrap_a2);if(this.copyto(l),null!=n&&null!=this.b1){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b1.id){r=a.bc;break}}null!=r?l.zpp_inner_zn.b1=r.zpp_inner:e.push(ze.todo(this.b1.id,function(n){l.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var s=null,_=0;_<n.length;){var h=n[_];if(++_,h.id==this.b2.id){s=h.bc;break}}null!=s?l.zpp_inner_zn.b2=s.zpp_inner:e.push(ze.todo(this.b2.id,function(n){l.zpp_inner_zn.b2=n.zpp_inner}))}return l},me.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new l("Error: PivotJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new l("Error: PivotJoint cannot be simulated with body1 == body2 (body1=body2="+this.b1.outer.toString()+")");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new l("Error: Constraints must have each body within the same space to which the constraint has been assigned (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")");if(2!=this.b1.type&&2!=this.b2.type)throw new l("Error: Constraints cannot have both bodies non-dynamic (body1="+this.b1.outer.toString()+", body2="+this.b2.outer.toString()+")")},me.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},me.prototype.forest=function(){if(2==this.b1.type){var n,e;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var t=this.b1.component,i=null;t!=t.parent;){var p=t.parent;t.parent=i,i=t,t=p}for(;null!=i;){var l=i.parent;i.parent=t,i=l}n=t}if(this.component==this.component.parent)e=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}e=r}n!=e&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n,n.rank++))}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,v=null;z!=z.parent;){var c=z.parent;z.parent=v,v=z,z=c}for(;null!=v;){var f=v.parent;v.parent=z,v=f}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_,_.rank++))}},me.prototype.pair_exists=function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},me.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.pre_dt=-1},me.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var t=this.b1.smass+this.b2.smass;if(this.kMassa=t,this.kMassb=0,this.kMassc=t,0!=this.b1.sinertia){var i=this.a1relx*this.b1.sinertia,p=this.a1rely*this.b1.sinertia;this.kMassa+=p*this.a1rely,this.kMassb+=-p*this.a1relx,this.kMassc+=i*this.a1relx}if(0!=this.b2.sinertia){var l=this.a2relx*this.b2.sinertia,r=this.a2rely*this.b2.sinertia;this.kMassa+=r*this.a2rely,this.kMassb+=-r*this.a2relx,this.kMassc+=l*this.a2relx}var o,a=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(a!=a)this.kMassa=this.kMassb=this.kMassc=0,o=3;else if(0==a){var s=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,s=1),0!=this.kMassc?this.kMassc=1/this.kMassc:(this.kMassc=0,s|=2),this.kMassb=0,o=s}else{a=1/a;var _=this.kMassc*a;this.kMassc=this.kMassa*a,this.kMassa=_,this.kMassb*=-a,o=0}if(0!=(1&o)&&(this.jAccx=0),0!=(2&o)&&(this.jAccy=0),this.stiff)this.biasx=0,this.biasy=0,this.gamma=0;else{var h,u=2*Math.PI*this.frequency;this.gamma=1/(n*u*(2*this.damping+u*n));var x=1/(1+this.gamma);if(h=n*u*u*this.gamma,this.gamma*=x,this.kMassa*=x,this.kMassb*=x,this.kMassc*=x,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy>this.maxError*this.maxError)return!0;var d=-h;this.biasx*=d,this.biasy*=d;var y=this.maxError,z=this.biasx*this.biasx+this.biasy*this.biasy;if(z>y*y){var v=y*(1/Math.sqrt(z));this.biasx*=v,this.biasy*=v}}return this.jAccx*=e,this.jAccy*=e,this.jMax=this.maxForce*n,!1},me.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var e=this.b2.imass;this.b2.velx+=this.jAccx*e,this.b2.vely+=this.jAccy*e,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely)*this.b2.iinertia},me.prototype.applyImpulseVel=function(){var n,e;n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel));var t=0,i=0;t=this.biasx-n,i=this.biasy-e;var p=this.kMassa*t+this.kMassb*i;i=this.kMassb*t+this.kMassc*i,t=p;var l=this.gamma;t-=this.jAccx*l,i-=this.jAccy*l;var r,o;if(r=this.jAccx,o=this.jAccy,this.jAccx+=t,this.jAccy+=i,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy>this.jMax*this.jMax)return!0}else if(!this.stiff){var a=this.jMax,s=this.jAccx*this.jAccx+this.jAccy*this.jAccy;if(s>a*a){var _=a*(1/Math.sqrt(s));this.jAccx*=_,this.jAccy*=_}}t=this.jAccx-r,i=this.jAccy-o;var h=this.b1.imass;this.b1.velx-=t*h,this.b1.vely-=i*h;var u=this.b2.imass;return this.b2.velx+=t*u,this.b2.vely+=i*u,this.b1.angvel-=(i*this.a1relx-t*this.a1rely)*this.b1.iinertia,this.b2.angvel+=(i*this.a2relx-t*this.a2rely)*this.b2.iinertia,!1},me.prototype.applyImpulsePos=function(){var n,e;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var t,i;t=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var p=0,l=0;if(p=this.b2.posx+t-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+e),this.breakUnderError&&p*p+l*l>this.maxError*this.maxError)return!0;if(p*p+l*l<o.constraintLinearSlop*o.constraintLinearSlop)return!1;var r=0,a=0;if((p*=.5)*p+(l*=.5)*l>6){var s=this.b1.smass+this.b2.smass;if(s>o.epsilon){var _=(r=-p*(s=.75/s))*r+(a=-l*s)*a;if(_>400){var h=1/Math.sqrt(_)*20;r*=h,a*=h}var u=this.b1.imass;this.b1.posx-=r*u,this.b1.posy-=a*u;var x=this.b2.imass;this.b2.posx+=r*x,this.b2.posy+=a*x,p=this.b2.posx+t-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+e),p*=.5,l*=.5}}var d=0,y=0,z=0,v=this.b1.smass+this.b2.smass;if(d=v,y=0,z=v,0!=this.b1.sinertia){var c=n*this.b1.sinertia,f=e*this.b1.sinertia;d=v+f*e,y+=-f*n,z=v+c*n}if(0!=this.b2.sinertia){var m=t*this.b2.sinertia,b=i*this.b2.sinertia;d+=b*i,y+=-b*t,z+=m*t}var g=(r=-p)*r+(a=-l)*a;if(g>36){var w=1/Math.sqrt(g)*6;r*=w,a*=w}var M=d*z-y*y;if(M!=M)r=a=0;else if(0==M)0!=d?r/=d:r=0,0!=z?a/=z:a=0;else{var C=(M=1/M)*(z*r-y*a);a=M*(d*a-y*r),r=C}var k=this.b1.imass;this.b1.posx-=r*k,this.b1.posy-=a*k;var O=this.b2.imass;this.b2.posx+=r*O,this.b2.posy+=a*O;var P=this.b1,S=-(a*n-r*e)*this.b1.iinertia;if(P.rot+=S,S*S>1e-4)P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot);else{var A=S*S,j=1-.5*A,E=1-A*A/8,I=(j*P.axisx+S*P.axisy)*E;P.axisy=(j*P.axisy-S*P.axisx)*E,P.axisx=I}var T=this.b2,N=(a*t-r*i)*this.b2.iinertia;if(T.rot+=N,N*N>1e-4)T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot);else{var L=N*N,V=1-.5*L,D=1-L*L/8,F=(V*T.axisx+N*T.axisy)*D;T.axisy=(V*T.axisy-N*T.axisx)*D,T.axisx=F}return!1},me.prototype.draw=function(n){},me.prototype.__class__=me;var be=zpp_nape.constraint.ZPP_PulleyJoint=function(){this.stepped=!1,this.bias=0,this.gamma=0,this.jMax=0,this.jAcc=0,this.kMass=0,this.wrap_a4=null,this.a4rely=0,this.a4relx=0,this.a4localy=0,this.a4localx=0,this.b4=null,this.wrap_a3=null,this.a3rely=0,this.a3relx=0,this.a3localy=0,this.a3localx=0,this.b3=null,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.cx4=0,this.cx3=0,this.cx2=0,this.cx1=0,this.n34y=0,this.n34x=0,this.n12y=0,this.n12x=0,this.equal=!1,this.slack=!1,this.jointMax=0,this.jointMin=0,this.ratio=1,this.outer_zn=null,de.call(this),this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0,this.a3localx=0,this.a3localy=0,this.a3relx=0,this.a3rely=0,this.a4localx=0,this.a4localy=0,this.a4relx=0,this.a4rely=0,this.n12x=1,this.n12y=0,this.n34x=1,this.n34y=0,this.jAcc=0,this.jMax=1/0,this.stepped=!1,this.cx1=this.cx2=this.cx3=this.cx4=0};be.__name__=["zpp_nape","constraint","ZPP_PulleyJoint"],be.__super__=de,be.prototype=Object.create(de.prototype),be.prototype.outer_zn=null,be.prototype.ratio=null,be.prototype.jointMin=null,be.prototype.jointMax=null,be.prototype.slack=null,be.prototype.equal=null,be.prototype.is_slack=function(){var n;this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var e,t,i,p;e=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),t=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),i=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),p=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var l=Math.sqrt(e*e+t*t),r=Math.sqrt(i*i+p*p);0==r&&Math.sqrt(0);var o=l+this.ratio*r;return this.equal?n=!1:o<this.jointMin?n=!1:o>this.jointMax?(o-=this.jointMax,n=!1):(o=0,n=!0),n},be.prototype.n12x=null,be.prototype.n12y=null,be.prototype.n34x=null,be.prototype.n34y=null,be.prototype.cx1=null,be.prototype.cx2=null,be.prototype.cx3=null,be.prototype.cx4=null,be.prototype.bodyImpulse=function(n){if(this.stepped){var e=cn.get();if(n==this.b1){var t=e.zpp_inner;null!=t._validate&&t._validate(),e.zpp_inner.x=e.zpp_inner.x-this.jAcc*this.n12x;var i=e.zpp_inner;null!=i._validate&&i._validate();var p=e.zpp_inner;null!=p._validate&&p._validate(),e.zpp_inner.y=e.zpp_inner.y-this.jAcc*this.n12y;var l=e.zpp_inner;null!=l._validate&&l._validate();var r=e.zpp_inner;null!=r._validate&&r._validate(),e.zpp_inner.z=e.zpp_inner.z-this.cx1*this.jAcc;var o=e.zpp_inner;null!=o._validate&&o._validate()}if(n==this.b2){var a=e.zpp_inner;null!=a._validate&&a._validate(),e.zpp_inner.x=e.zpp_inner.x+this.jAcc*this.n12x;var s=e.zpp_inner;null!=s._validate&&s._validate();var _=e.zpp_inner;null!=_._validate&&_._validate(),e.zpp_inner.y=e.zpp_inner.y+this.jAcc*this.n12y;var h=e.zpp_inner;null!=h._validate&&h._validate();var u=e.zpp_inner;null!=u._validate&&u._validate(),e.zpp_inner.z=e.zpp_inner.z+this.cx2*this.jAcc;var x=e.zpp_inner;null!=x._validate&&x._validate()}if(n==this.b3){var d=e.zpp_inner;null!=d._validate&&d._validate(),e.zpp_inner.x=e.zpp_inner.x-this.jAcc*this.n34x;var y=e.zpp_inner;null!=y._validate&&y._validate();var z=e.zpp_inner;null!=z._validate&&z._validate(),e.zpp_inner.y=e.zpp_inner.y-this.jAcc*this.n34y;var v=e.zpp_inner;null!=v._validate&&v._validate();var c=e.zpp_inner;null!=c._validate&&c._validate(),e.zpp_inner.z=e.zpp_inner.z-this.cx3*this.jAcc;var f=e.zpp_inner;null!=f._validate&&f._validate()}if(n==this.b4){var m=e.zpp_inner;null!=m._validate&&m._validate(),e.zpp_inner.x=e.zpp_inner.x+this.jAcc*this.n34x;var b=e.zpp_inner;null!=b._validate&&b._validate();var g=e.zpp_inner;null!=g._validate&&g._validate(),e.zpp_inner.y=e.zpp_inner.y+this.jAcc*this.n34y;var w=e.zpp_inner;null!=w._validate&&w._validate();var M=e.zpp_inner;null!=M._validate&&M._validate(),e.zpp_inner.z=e.zpp_inner.z+this.cx4*this.jAcc;var C=e.zpp_inner;null!=C._validate&&C._validate()}return e}return cn.get(0,0,0)},be.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.add(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.add(this)},be.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this),this.b3!=this.b1&&this.b3!=this.b2&&null!=this.b3&&this.b3.constraints.remove(this),this.b4!=this.b1&&this.b4!=this.b2&&this.b4!=this.b3&&null!=this.b4&&this.b4.constraints.remove(this)},be.prototype.b1=null,be.prototype.a1localx=null,be.prototype.a1localy=null,be.prototype.a1relx=null,be.prototype.a1rely=null,be.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},be.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},be.prototype.setup_a1=function(){var n,t=this.a1localx,i=this.a1localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=e(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=e(this,this.invalidate_a1)},be.prototype.wrap_a1=null,be.prototype.b2=null,be.prototype.a2localx=null,be.prototype.a2localy=null,be.prototype.a2relx=null,be.prototype.a2rely=null,be.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},be.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},be.prototype.setup_a2=function(){var n,t=this.a2localx,i=this.a2localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=e(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=e(this,this.invalidate_a2)},be.prototype.wrap_a2=null,be.prototype.b3=null,be.prototype.a3localx=null,be.prototype.a3localy=null,be.prototype.a3relx=null,be.prototype.a3rely=null,be.prototype.validate_a3=function(){this.wrap_a3.zpp_inner.x=this.a3localx,this.wrap_a3.zpp_inner.y=this.a3localy},be.prototype.invalidate_a3=function(n){this.immutable_midstep("Constraint::a3"),this.a3localx=n.x,this.a3localy=n.y,this.wake()},be.prototype.setup_a3=function(){var n,t=this.a3localx,i=this.a3localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a3=n,this.wrap_a3.zpp_inner._inuse=!0,this.wrap_a3.zpp_inner._validate=e(this,this.validate_a3),this.wrap_a3.zpp_inner._invalidate=e(this,this.invalidate_a3)},be.prototype.wrap_a3=null,be.prototype.b4=null,be.prototype.a4localx=null,be.prototype.a4localy=null,be.prototype.a4relx=null,be.prototype.a4rely=null,be.prototype.validate_a4=function(){this.wrap_a4.zpp_inner.x=this.a4localx,this.wrap_a4.zpp_inner.y=this.a4localy},be.prototype.invalidate_a4=function(n){this.immutable_midstep("Constraint::a4"),this.a4localx=n.x,this.a4localy=n.y,this.wake()},be.prototype.setup_a4=function(){var n,t=this.a4localx,i=this.a4localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a4=n,this.wrap_a4.zpp_inner._inuse=!0,this.wrap_a4.zpp_inner._validate=e(this,this.validate_a4),this.wrap_a4.zpp_inner._invalidate=e(this,this.invalidate_a4)},be.prototype.wrap_a4=null,be.prototype.kMass=null,be.prototype.jAcc=null,be.prototype.jMax=null,be.prototype.gamma=null,be.prototype.bias=null,be.prototype.stepped=null,be.prototype.copy=function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=p.zpp_inner_zn.wrap_a2,r=this.outer_zn;null==r.zpp_inner_zn.wrap_a3&&r.zpp_inner_zn.setup_a3();var o=r.zpp_inner_zn.wrap_a3,a=this.outer_zn;null==a.zpp_inner_zn.wrap_a4&&a.zpp_inner_zn.setup_a4();var s=new L(null,null,null,null,i,l,o,a.zpp_inner_zn.wrap_a4,this.jointMin,this.jointMax,this.ratio);if(this.copyto(s),null!=n&&null!=this.b1){for(var _=null,h=0;h<n.length;){var u=n[h];if(++h,u.id==this.b1.id){_=u.bc;break}}null!=_?s.zpp_inner_zn.b1=_.zpp_inner:e.push(ze.todo(this.b1.id,function(n){s.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var x=null,d=0;d<n.length;){var y=n[d];if(++d,y.id==this.b2.id){x=y.bc;break}}null!=x?s.zpp_inner_zn.b2=x.zpp_inner:e.push(ze.todo(this.b2.id,function(n){s.zpp_inner_zn.b2=n.zpp_inner}))}if(null!=n&&null!=this.b3){for(var z=null,v=0;v<n.length;){var c=n[v];if(++v,c.id==this.b3.id){z=c.bc;break}}null!=z?s.zpp_inner_zn.b3=z.zpp_inner:e.push(ze.todo(this.b3.id,function(n){s.zpp_inner_zn.b3=n.zpp_inner}))}if(null!=n&&null!=this.b4){for(var f=null,m=0;m<n.length;){var b=n[m];if(++m,b.id==this.b4.id){f=b.bc;break}}null!=f?s.zpp_inner_zn.b4=f.zpp_inner:e.push(ze.todo(this.b4.id,function(n){s.zpp_inner_zn.b4=n.zpp_inner}))}return s},be.prototype.validate=function(){if(null==this.b1||null==this.b2||null==this.b3||null==this.b4)throw new l("Error: PulleyJoint cannot be simulated with null bodies");if(this.b1==this.b2||this.b3==this.b4)throw new l("Error: PulleyJoint cannot have body1==body2 or body3==body4");if(this.b1.space!=this.space||this.b2.space!=this.space||this.b3.space!=this.space||this.b4.space!=this.space)throw new l("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(this.jointMin>this.jointMax)throw new l("Error: PulleyJoint must have jointMin <= jointMax");if(2!=this.b1.type&&2!=this.b2.type)throw new l("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic");if(2!=this.b3.type&&2!=this.b4.type)throw new l("Error: PulleyJoint cannot have both bodies in a linked pair non-dynamic")},be.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake(),null!=this.b3&&2==this.b3.type&&this.b3.wake(),null!=this.b4&&2==this.b4.type&&this.b4.wake()},be.prototype.forest=function(){if(2==this.b1.type){var n,e;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var t=this.b1.component,i=null;t!=t.parent;){var p=t.parent;t.parent=i,i=t,t=p}for(;null!=i;){var l=i.parent;i.parent=t,i=l}n=t}if(this.component==this.component.parent)e=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}e=r}n!=e&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n,n.rank++))}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,v=null;z!=z.parent;){var c=z.parent;z.parent=v,v=z,z=c}for(;null!=v;){var f=v.parent;v.parent=z,v=f}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_,_.rank++))}if(2==this.b3.type){var m,b;if(this.b3.component==this.b3.component.parent)m=this.b3.component;else{for(var g=this.b3.component,w=null;g!=g.parent;){var M=g.parent;g.parent=w,w=g,g=M}for(;null!=w;){var C=w.parent;w.parent=g,w=C}m=g}if(this.component==this.component.parent)b=this.component;else{for(var k=this.component,O=null;k!=k.parent;){var P=k.parent;k.parent=O,O=k,k=P}for(;null!=O;){var S=O.parent;O.parent=k,O=S}b=k}m!=b&&(m.rank<b.rank?m.parent=b:m.rank>b.rank?b.parent=m:(b.parent=m,m.rank++))}if(2==this.b4.type){var A,j;if(this.b4.component==this.b4.component.parent)A=this.b4.component;else{for(var E=this.b4.component,I=null;E!=E.parent;){var T=E.parent;E.parent=I,I=E,E=T}for(;null!=I;){var N=I.parent;I.parent=E,I=N}A=E}if(this.component==this.component.parent)j=this.component;else{for(var L=this.component,V=null;L!=L.parent;){var D=L.parent;L.parent=V,V=L,L=D}for(;null!=V;){var F=V.parent;V.parent=L,V=F}j=L}A!=j&&(A.rank<j.rank?A.parent=j:A.rank>j.rank?j.parent=A:(j.parent=A,A.rank++))}},be.prototype.pair_exists=function(n,e){return this.b1.id==n&&(this.b2.id==e||this.b3.id==e||this.b4.id==e)||this.b2.id==n&&(this.b3.id==e||this.b4.id==e||this.b1.id==e)||this.b3.id==n&&(this.b4.id==e||this.b1.id==e||this.b2.id==e)||this.b4.id==n&&(this.b1.id==e||this.b2.id==e||this.b3.id==e)},be.prototype.clearcache=function(){this.jAcc=0,this.pre_dt=-1},be.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.equal=this.jointMin==this.jointMax,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy,this.a3relx=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,this.a3rely=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy,this.a4relx=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,this.a4rely=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var t,i,p,l;t=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),i=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),p=this.b4.posx+this.a4relx-(this.b3.posx+this.a3relx),l=this.b4.posy+this.a4rely-(this.b3.posy+this.a3rely);var r=Math.sqrt(t*t+i*i),o=Math.sqrt(p*p+l*l);if(0!=r){var a=1/r;this.n12x=t*a,this.n12y=i*a}if(0!=o){var s=1/o;this.n34x=p*s,this.n34y=l*s;var _=this.ratio;this.n34x*=_,this.n34y*=_}else{var h=this.ratio/Math.sqrt(this.n34x*this.n34x+this.n34y*this.n34y);this.n34x*=h,this.n34y*=h}var u=r+this.ratio*o;this.equal?(u-=this.jointMax,this.slack=!1):u<this.jointMin?(u=this.jointMin-u,this.n12x=-this.n12x,this.n12y=-this.n12y,this.n34x=-this.n34x,this.n34y=-this.n34y,this.slack=!1):u>this.jointMax?(u-=this.jointMax,this.slack=!1):(this.n12x=0,this.n12y=0,this.n34x=0,this.n34y=0,u=0,this.slack=!0);var x=u;if(!this.slack){this.cx1=this.n12y*this.a1relx-this.n12x*this.a1rely,this.cx2=this.n12y*this.a2relx-this.n12x*this.a2rely,this.cx3=this.n34y*this.a3relx-this.n34x*this.a3rely,this.cx4=this.n34y*this.a4relx-this.n34x*this.a4rely;var d=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*this.cx1*this.cx1+this.b2.sinertia*this.cx2*this.cx2+this.b3.sinertia*this.cx3*this.cx3+this.b4.sinertia*this.cx4*this.cx4;if(this.b1==this.b4&&(d-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx4*this.b1.sinertia)),this.b1==this.b3&&(d+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b1.smass+this.cx1*this.cx3*this.b1.sinertia)),this.b2==this.b3&&(d-=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx3*this.b2.sinertia)),this.b2==this.b4&&(d+=2*((this.n12x*this.n34x+this.n12y*this.n34y)*this.b2.smass+this.cx2*this.cx4*this.b2.sinertia)),this.kMass=d,0!=this.kMass?this.kMass=1/this.kMass:this.jAcc=0,this.stiff)this.bias=0,this.gamma=0;else{if(this.breakUnderError&&x*x>this.maxError*this.maxError)return!0;var y,z=2*Math.PI*this.frequency;this.gamma=1/(n*z*(2*this.damping+z*n));var v=1/(1+this.gamma);y=n*z*z*this.gamma,this.gamma*=v,this.kMass*=v,this.bias=-x*y,this.bias<-this.maxError?this.bias=-this.maxError:this.bias>this.maxError&&(this.bias=this.maxError)}this.jAcc*=e,this.jMax=this.maxForce*n}return!1},be.prototype.warmStart=function(){if(!this.slack){var n=this.b1.imass*this.jAcc;this.b1.velx-=this.n12x*n,this.b1.vely-=this.n12y*n;var e=this.b2.imass*this.jAcc;this.b2.velx+=this.n12x*e,this.b2.vely+=this.n12y*e;var t=this.b3.imass*this.jAcc;this.b3.velx-=this.n34x*t,this.b3.vely-=this.n34y*t;var i=this.b4.imass*this.jAcc;this.b4.velx+=this.n34x*i,this.b4.vely+=this.n34y*i,this.b1.angvel-=this.cx1*this.b1.iinertia*this.jAcc,this.b2.angvel+=this.cx2*this.b2.iinertia*this.jAcc,this.b3.angvel-=this.cx3*this.b3.iinertia*this.jAcc,this.b4.angvel+=this.cx4*this.b4.iinertia*this.jAcc}},be.prototype.applyImpulseVel=function(){if(this.slack)return!1;var n=this.kMass*(this.bias-(this.n12x*(this.b2.velx+this.b2.kinvelx-this.b1.velx-this.b1.kinvelx)+this.n12y*(this.b2.vely+this.b2.kinvely-this.b1.vely-this.b1.kinvely)+this.n34x*(this.b4.velx+this.b4.kinvelx-this.b3.velx-this.b3.kinvelx)+this.n34y*(this.b4.vely+this.b4.kinvely-this.b3.vely-this.b3.kinvely)+(this.b2.angvel+this.b2.kinangvel)*this.cx2-(this.b1.angvel+this.b1.kinangvel)*this.cx1+(this.b4.angvel+this.b4.kinangvel)*this.cx4-(this.b3.angvel+this.b3.kinangvel)*this.cx3))-this.jAcc*this.gamma,e=this.jAcc;if(this.jAcc+=n,!this.equal&&this.jAcc>0&&(this.jAcc=0),this.breakUnderForce&&this.jAcc<-this.jMax)return!0;this.stiff||this.jAcc<-this.jMax&&(this.jAcc=-this.jMax),n=this.jAcc-e;var t=this.b1.imass*n;this.b1.velx-=this.n12x*t,this.b1.vely-=this.n12y*t;var i=this.b2.imass*n;this.b2.velx+=this.n12x*i,this.b2.vely+=this.n12y*i;var p=this.b3.imass*n;this.b3.velx-=this.n34x*p,this.b3.vely-=this.n34y*p;var l=this.b4.imass*n;return this.b4.velx+=this.n34x*l,this.b4.vely+=this.n34y*l,this.b1.angvel-=this.cx1*this.b1.iinertia*n,this.b2.angvel+=this.cx2*this.b2.iinertia*n,this.b3.angvel-=this.cx3*this.b3.iinertia*n,this.b4.angvel+=this.cx4*this.b4.iinertia*n,!1},be.prototype.applyImpulsePos=function(){var n,e,t,i;t=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,i=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var p,l;p=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,l=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var r,a;r=this.b3.axisy*this.a3localx-this.b3.axisx*this.a3localy,a=this.a3localx*this.b3.axisx+this.a3localy*this.b3.axisy;var s,_,h;s=this.b4.axisy*this.a4localx-this.b4.axisx*this.a4localy,_=this.a4localx*this.b4.axisx+this.a4localy*this.b4.axisy;var u=0,x=0,d=0,y=0;u=this.n12x,x=this.n12y,d=this.n34x,y=this.n34y;var z,v,c,f;z=this.b2.posx+p-(this.b1.posx+t),v=this.b2.posy+l-(this.b1.posy+i),c=this.b4.posx+s-(this.b3.posx+r),f=this.b4.posy+_-(this.b3.posy+a);var m=Math.sqrt(z*z+v*v),b=Math.sqrt(c*c+f*f);if(0!=m){var g=1/m;u=z*g,x=v*g}if(0!=b){var w=1/b;d=c*w,y=f*w;var M=this.ratio;d*=M,y*=M}else{var C=this.ratio/Math.sqrt(d*d+y*y);d*=C,y*=C}var k=m+this.ratio*b;if(this.equal?(k-=this.jointMax,h=!1):k<this.jointMin?(k=this.jointMin-k,u=-u,x=-x,d=-d,y=-y,h=!1):k>this.jointMax?(k-=this.jointMax,h=!1):(u=0,x=0,d=0,y=0,k=0,h=!0),n=k,!h){if(this.breakUnderError&&n*n>this.maxError*this.maxError)return!0;if(n*n<o.constraintLinearSlop*o.constraintLinearSlop)return!1;if((n*=.5)*n>6){var O=this.b1.smass+this.b2.smass;if(O>o.epsilon&&(e=-n*(O=.75/O),this.equal||e<0)){var P=e*this.b1.imass;this.b1.posx-=u*P,this.b1.posy-=x*P;var S=e*this.b2.imass;this.b2.posx+=u*S,this.b2.posy+=x*S;var A=e*this.b3.imass;this.b3.posx-=d*A,this.b3.posy-=y*A;var j=e*this.b4.imass;this.b4.posx+=d*j,this.b4.posy+=y*j;var E,I,T,N;E=this.b2.posx+p-(this.b1.posx+t),I=this.b2.posy+l-(this.b1.posy+i),T=this.b4.posx+s-(this.b3.posx+r),N=this.b4.posy+_-(this.b3.posy+a);var L=Math.sqrt(E*E+I*I),V=Math.sqrt(T*T+N*N);if(0!=L){var D=1/L;u=E*D,x=I*D}if(0!=V){var F=1/V;d=T*F,y=N*F;var R=this.ratio;d*=R,y*=R}else{var Z=this.ratio/Math.sqrt(d*d+y*y);d*=Z,y*=Z}var B=L+this.ratio*V;this.equal?B-=this.jointMax:B<this.jointMin?(B=this.jointMin-B,u=-u,x=-x,d=-d,y=-y):B>this.jointMax?B-=this.jointMax:(u=0,x=0,d=0,y=0,B=0),n=B,n*=.5}}var G,q,U,K;G=x*t-u*i,q=x*p-u*l,U=y*r-d*a,K=y*s-d*_;var W=this.b1.smass+this.b2.smass+this.ratio*this.ratio*(this.b3.smass+this.b4.smass)+this.b1.sinertia*G*G+this.b2.sinertia*q*q+this.b3.sinertia*U*U+this.b4.sinertia*K*K;this.b1==this.b4&&(W-=2*((u*d+x*y)*this.b1.smass+G*K*this.b1.sinertia)),this.b1==this.b3&&(W+=2*((u*d+x*y)*this.b1.smass+G*U*this.b1.sinertia)),this.b2==this.b3&&(W-=2*((u*d+x*y)*this.b2.smass+q*U*this.b2.sinertia)),this.b2==this.b4&&(W+=2*((u*d+x*y)*this.b2.smass+q*K*this.b2.sinertia));var Y=W;if(0!=Y&&(Y=1/Y),e=-n*Y,this.equal||e<0){var J=this.b1.imass*e;this.b1.posx-=u*J,this.b1.posy-=x*J;var X=this.b2.imass*e;this.b2.posx+=u*X,this.b2.posy+=x*X;var H=this.b3.imass*e;this.b3.posx-=d*H,this.b3.posy-=y*H;var $=this.b4.imass*e;this.b4.posx+=d*$,this.b4.posy+=y*$;var Q=this.b1,nn=-G*this.b1.iinertia*e;if(Q.rot+=nn,nn*nn>1e-4)Q.axisx=Math.sin(Q.rot),Q.axisy=Math.cos(Q.rot);else{var en=nn*nn,tn=1-.5*en,pn=1-en*en/8,ln=(tn*Q.axisx+nn*Q.axisy)*pn;Q.axisy=(tn*Q.axisy-nn*Q.axisx)*pn,Q.axisx=ln}var rn=this.b2,on=q*this.b2.iinertia*e;if(rn.rot+=on,on*on>1e-4)rn.axisx=Math.sin(rn.rot),rn.axisy=Math.cos(rn.rot);else{var an=on*on,sn=1-.5*an,_n=1-an*an/8,hn=(sn*rn.axisx+on*rn.axisy)*_n;rn.axisy=(sn*rn.axisy-on*rn.axisx)*_n,rn.axisx=hn}var un=this.b3,xn=-U*this.b3.iinertia*e;if(un.rot+=xn,xn*xn>1e-4)un.axisx=Math.sin(un.rot),un.axisy=Math.cos(un.rot);else{var dn=xn*xn,yn=1-.5*dn,zn=1-dn*dn/8,vn=(yn*un.axisx+xn*un.axisy)*zn;un.axisy=(yn*un.axisy-xn*un.axisx)*zn,un.axisx=vn}var cn=this.b4,fn=K*this.b4.iinertia*e;if(cn.rot+=fn,fn*fn>1e-4)cn.axisx=Math.sin(cn.rot),cn.axisy=Math.cos(cn.rot);else{var mn=fn*fn,bn=1-.5*mn,gn=1-mn*mn/8,wn=(bn*cn.axisx+fn*cn.axisy)*gn;cn.axisy=(bn*cn.axisy-fn*cn.axisx)*gn,cn.axisx=wn}}}return!1},be.prototype.draw=function(n){},be.prototype.__class__=be;var ge=zpp_nape.constraint.ZPP_UserConstraint=function(n,e){this.jOld=null,this.J=null,this.vec3=null,this.Keff=null,this.jMax=0,this.velonly=!1,this.gamma=0,this.soft=0,this.y=null,this.L=null,this.stepped=!1,this.bias=null,this.jAcc=null,this.dim=0,this.bodies=null,this.outer_zn=null,de.call(this),this.bodies=[],this.dim=n,this.velonly=e,this.jAcc=[],this.bias=[],this.L=[],this.J=[],this.jOld=[],this.y=[],this.Keff=[],this.vec3=cn.get(0,0,0);for(var t=0;t<n;){var i=t++;this.J[i]=this.jOld[i]=this.y[i]=0,this.bias[i]=0,this.jAcc[i]=0;for(var p=0;p<n;)this.L[i*n+p++]=0}this.stepped=!1};ge.__name__=["zpp_nape","constraint","ZPP_UserConstraint"],ge.__super__=de,ge.prototype=Object.create(de.prototype),ge.prototype.outer_zn=null,ge.prototype.bindVec2_invalidate=function(n){this.outer_zn.__invalidate()},ge.prototype.bodies=null,ge.prototype.dim=null,ge.prototype.jAcc=null,ge.prototype.bias=null,ge.prototype.addBody=function(n){for(var e=null,t=0,i=this.bodies;t<i.length;){var p=i[t];if(++t,p.body==n){e=p;break}}null==e?(this.bodies.push(new we(1,n)),this.active&&null!=this.space&&null!=n&&n.constraints.add(this)):e.cnt++},ge.prototype.remBody=function(n){for(var e=null,t=0|this.bodies.length,i=0;i<t;){var p=this.bodies[i];if(p.body==n){p.cnt--,0==p.cnt&&(t>0&&(this.bodies[i]=this.bodies[t-1]),this.bodies.pop(),this.active&&null!=this.space&&null!=n&&n.constraints.remove(this)),e=p;break}++i}return null!=e},ge.prototype.bodyImpulse=function(n){for(var e=0,t=this.dim;e<t;){var i=e++;this.J[i]=this.jAcc[i]}var p=cn.get(0,0,0);return this.stepped&&this.outer_zn.__impulse(this.J,n.outer,p),p},ge.prototype.activeBodies=function(){for(var n=0,e=this.bodies;n<e.length;){var t=e[n];++n,null!=t.body&&t.body.constraints.add(this)}},ge.prototype.inactiveBodies=function(){for(var n=0,e=this.bodies;n<e.length;){var t=e[n];++n,null!=t.body&&t.body.constraints.remove(this)}},ge.prototype.stepped=null,ge.prototype.copy=function(n,e){throw this.copyto(this.outer_zn.__copy()),new l("not done yet")},ge.prototype.validate=function(){for(var n=0,e=this.bodies;n<e.length;){var t=e[n];if(++n,t.body.space!=this.space)throw new l("Error: Constraints must have each body within the same sapce to which the constraint has been assigned")}this.outer_zn.__validate()},ge.prototype.wake_connected=function(){for(var n=0,e=this.bodies;n<e.length;){var t=e[n];++n,2==t.body.type&&t.body.wake()}},ge.prototype.forest=function(){for(var n=0,e=this.bodies;n<e.length;){var t=e[n];if(++n,2==t.body.type){var i,p;if(t.body.component==t.body.component.parent)i=t.body.component;else{for(var l=t.body.component,r=null;l!=l.parent;){var o=l.parent;l.parent=r,r=l,l=o}for(;null!=r;){var a=r.parent;r.parent=l,r=a}i=l}if(this.component==this.component.parent)p=this.component;else{for(var s=this.component,_=null;s!=s.parent;){var h=s.parent;s.parent=_,_=s,s=h}for(;null!=_;){var u=_.parent;_.parent=s,_=u}p=s}i!=p&&(i.rank<p.rank?i.parent=p:i.rank>p.rank?p.parent=i:(p.parent=i,i.rank++))}}},ge.prototype.pair_exists=function(n,e){for(var t=!1,i=0|this.bodies.length,p=0;p<i;){for(var l=p++,r=this.bodies[l].body,o=l+1;o<i;){var a=this.bodies[o++].body;if(r.id==n&&a.id==e||r.id==e&&a.id==n){t=!0;break}}if(t)break}return t},ge.prototype.broken=function(){this.outer_zn.__broken()},ge.prototype.clearcache=function(){for(var n=0,e=this.dim;n<e;)this.jAcc[n++]=0;this.pre_dt=-1},ge.prototype.lsq=function(n){for(var e=0,t=0,i=this.dim;t<i;){var p=t++;e+=n[p]*n[p]}return e},ge.prototype._clamp=function(n,e){var t=this.lsq(n);if(t>e*e)for(var i=e/Math.sqrt(t),p=0,l=this.dim;p<l;)n[p++]*=i},ge.prototype.L=null,ge.prototype.solve=function(n){for(var e=0,t=0,i=this.dim;t<i;){for(var p=t++,l=0,r=0,o=p-1;r<o;){var a=r++;l+=this.L[p*this.dim+a]*this.L[p*this.dim+a]}var s=Math.sqrt(n[e++]-l);if(this.L[p*this.dim+p]=s,0!=s){s=1/s;for(var _=p+1,h=this.dim;_<h;){for(var u=_++,x=0,d=0,y=p-1;d<y;){var z=d++;x+=this.L[u*this.dim+z]*this.L[p*this.dim+z]}this.L[u*this.dim+p]=s*(n[e++]-x)}}else{for(var v=p+1,c=this.dim;v<c;)this.L[v++*this.dim+p]=0;e+=this.dim-p-1}}return this.L},ge.prototype.y=null,ge.prototype.transform=function(n,e){for(var t=0,i=this.dim;t<i;){var p=t++,l=e[p],r=n[p*this.dim+p];if(0!=r){for(var o=0;o<p;){var a=o++;l-=n[p*this.dim+a]*this.y[a]}this.y[p]=l/r}else this.y[p]=0}for(var s=0,_=this.dim;s<_;){var h=this.dim-1-s++,u=n[h*this.dim+h];if(0!=u){for(var x=this.y[h],d=h+1,y=this.dim;d<y;){var z=d++;x-=n[z*this.dim+h]*e[z]}e[h]=x/u}else e[h]=0}},ge.prototype.soft=null,ge.prototype.gamma=null,ge.prototype.velonly=null,ge.prototype.jMax=null,ge.prototype.Keff=null,ge.prototype.preStep=function(n){this.outer_zn.__validate(),-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;if(this.pre_dt=n,this.stepped=!0,this.outer_zn.__prepare(),this.outer_zn.__eff_mass(this.Keff),this.L=this.solve(this.Keff),this.stiff||this.velonly){for(var t=0,i=this.dim;t<i;)this.bias[t++]=0;this.gamma=0,this.soft=1}else{var p,l=2*Math.PI*this.frequency;this.gamma=1/(n*l*(2*this.damping+l*n));var r=1/(1+this.gamma);if(p=n*l*l*this.gamma,this.gamma*=r,this.soft=r,this.outer_zn.__position(this.bias),this.breakUnderError&&this.lsq(this.bias)>this.maxError*this.maxError)return!0;for(var o=0,a=this.dim;o<a;)this.bias[o++]*=-p;this._clamp(this.bias,this.maxError)}for(var s=0,_=this.dim;s<_;)this.jAcc[s++]*=e;return this.jMax=this.maxForce*n,!1},ge.prototype.vec3=null,ge.prototype.warmStart=function(){for(var n=0,e=this.bodies;n<e.length;){var t=e[n];++n;var i=t.body;this.outer_zn.__impulse(this.jAcc,i.outer,this.vec3);var p=i.imass,l=this.vec3,r=l.zpp_inner;null!=r._validate&&r._validate(),i.velx+=l.zpp_inner.x*p;var o=this.vec3,a=o.zpp_inner;null!=a._validate&&a._validate(),i.vely+=o.zpp_inner.y*p;var s=this.vec3,_=s.zpp_inner;null!=_._validate&&_._validate(),i.angvel+=s.zpp_inner.z*i.iinertia}},ge.prototype.J=null,ge.prototype.jOld=null,ge.prototype.applyImpulseVel=function(){this.outer_zn.__velocity(this.J);for(var n=0,e=this.dim;n<e;){var t=n++;this.J[t]=this.bias[t]-this.J[t]}this.transform(this.L,this.J);for(var i=0,p=this.dim;i<p;){var l=i++;this.jOld[l]=this.jAcc[l],this.jAcc[l]+=this.J[l]=this.J[l]*this.soft-this.jAcc[l]*this.gamma}if(this.outer_zn.__clamp(this.jAcc),(this.breakUnderForce||!this.stiff)&&this.lsq(this.jAcc)>this.jMax*this.jMax){if(this.breakUnderForce)return!0;this.stiff||this._clamp(this.jAcc,this.jMax)}for(var r=0,o=this.dim;r<o;){var a=r++;this.J[a]=this.jAcc[a]-this.jOld[a]}for(var s=0,_=this.bodies;s<_.length;){var h=_[s];++s;var u=h.body;this.outer_zn.__impulse(this.J,u.outer,this.vec3);var x=u.imass,d=this.vec3,y=d.zpp_inner;null!=y._validate&&y._validate(),u.velx+=d.zpp_inner.x*x;var z=this.vec3,v=z.zpp_inner;null!=v._validate&&v._validate(),u.vely+=z.zpp_inner.y*x;var c=this.vec3,f=c.zpp_inner;null!=f._validate&&f._validate(),u.angvel+=c.zpp_inner.z*u.iinertia}return!1},ge.prototype.applyImpulsePos=function(){if(this.velonly)return!1;this.outer_zn.__prepare(),this.outer_zn.__position(this.J);var n=this.lsq(this.J);if(this.breakUnderError&&n>this.maxError*this.maxError)return!0;if(n<o.constraintLinearSlop*o.constraintLinearSlop)return!1;for(var e=0,t=this.dim;e<t;)this.J[e++]*=-1;this.outer_zn.__eff_mass(this.Keff),this.transform(this.solve(this.Keff),this.J),this.outer_zn.__clamp(this.J);for(var i=0,p=this.bodies;i<p.length;){var l=p[i];++i;var r=l.body;this.outer_zn.__impulse(this.J,r.outer,this.vec3);var a=r.imass,s=this.vec3,_=s.zpp_inner;null!=_._validate&&_._validate(),r.posx+=s.zpp_inner.x*a;var h=this.vec3,u=h.zpp_inner;null!=u._validate&&u._validate(),r.posy+=h.zpp_inner.y*a;var x=this.vec3,d=x.zpp_inner;null!=d._validate&&d._validate();var y=x.zpp_inner.z*r.iinertia;if(r.rot+=y,y*y>1e-4)r.axisx=Math.sin(r.rot),r.axisy=Math.cos(r.rot);else{var z=y*y,v=1-.5*z,c=1-z*z/8,f=(v*r.axisx+y*r.axisy)*c;r.axisy=(v*r.axisy-y*r.axisx)*c,r.axisx=f}}return!1},ge.prototype.draw=function(n){this.outer_zn.__draw(n)},ge.prototype.__class__=ge;var we=zpp_nape.constraint.ZPP_UserBody=function(n,e){this.body=null,this.cnt=0,this.cnt=n,this.body=e};we.__name__=["zpp_nape","constraint","ZPP_UserBody"],we.prototype.cnt=null,we.prototype.body=null,we.prototype.__class__=we;var Me=zpp_nape.constraint.ZPP_WeldJoint=function(){this.stepped=!1,this.biasz=0,this.biasy=0,this.biasx=0,this.gamma=0,this.jMax=0,this.jAccz=0,this.jAccy=0,this.jAccx=0,this.kMassf=0,this.kMasse=0,this.kMassc=0,this.kMassd=0,this.kMassb=0,this.kMassa=0,this.phase=0,this.wrap_a2=null,this.a2rely=0,this.a2relx=0,this.a2localy=0,this.a2localx=0,this.b2=null,this.wrap_a1=null,this.a1rely=0,this.a1relx=0,this.a1localy=0,this.a1localx=0,this.b1=null,this.outer_zn=null,de.call(this),this.phase=0,this.jAccx=0,this.jAccy=0,this.jAccz=0,this.jMax=1/0,this.stepped=!1,this.a1localx=0,this.a1localy=0,this.a1relx=0,this.a1rely=0,this.a2localx=0,this.a2localy=0,this.a2relx=0,this.a2rely=0};Me.__name__=["zpp_nape","constraint","ZPP_WeldJoint"],Me.__super__=de,Me.prototype=Object.create(de.prototype),Me.prototype.outer_zn=null,Me.prototype.bodyImpulse=function(n){return this.stepped?n==this.b1?cn.get(-this.jAccx,-this.jAccy,-(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)):cn.get(this.jAccx,this.jAccy,this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz):cn.get(0,0,0)},Me.prototype.activeBodies=function(){null!=this.b1&&this.b1.constraints.add(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.add(this)},Me.prototype.inactiveBodies=function(){null!=this.b1&&this.b1.constraints.remove(this),this.b2!=this.b1&&null!=this.b2&&this.b2.constraints.remove(this)},Me.prototype.b1=null,Me.prototype.a1localx=null,Me.prototype.a1localy=null,Me.prototype.a1relx=null,Me.prototype.a1rely=null,Me.prototype.validate_a1=function(){this.wrap_a1.zpp_inner.x=this.a1localx,this.wrap_a1.zpp_inner.y=this.a1localy},Me.prototype.invalidate_a1=function(n){this.immutable_midstep("Constraint::a1"),this.a1localx=n.x,this.a1localy=n.y,this.wake()},Me.prototype.setup_a1=function(){var n,t=this.a1localx,i=this.a1localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a1=n,this.wrap_a1.zpp_inner._inuse=!0,this.wrap_a1.zpp_inner._validate=e(this,this.validate_a1),this.wrap_a1.zpp_inner._invalidate=e(this,this.invalidate_a1)},Me.prototype.wrap_a1=null,Me.prototype.b2=null,Me.prototype.a2localx=null,Me.prototype.a2localy=null,Me.prototype.a2relx=null,Me.prototype.a2rely=null,Me.prototype.validate_a2=function(){this.wrap_a2.zpp_inner.x=this.a2localx,this.wrap_a2.zpp_inner.y=this.a2localy},Me.prototype.invalidate_a2=function(n){this.immutable_midstep("Constraint::a2"),this.a2localx=n.x,this.a2localy=n.y,this.wake()},Me.prototype.setup_a2=function(){var n,t=this.a2localx,i=this.a2localy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_a2=n,this.wrap_a2.zpp_inner._inuse=!0,this.wrap_a2.zpp_inner._validate=e(this,this.validate_a2),this.wrap_a2.zpp_inner._invalidate=e(this,this.invalidate_a2)},Me.prototype.wrap_a2=null,Me.prototype.phase=null,Me.prototype.kMassa=null,Me.prototype.kMassb=null,Me.prototype.kMassd=null,Me.prototype.kMassc=null,Me.prototype.kMasse=null,Me.prototype.kMassf=null,Me.prototype.jAccx=null,Me.prototype.jAccy=null,Me.prototype.jAccz=null,Me.prototype.jMax=null,Me.prototype.gamma=null,Me.prototype.biasx=null,Me.prototype.biasy=null,Me.prototype.biasz=null,Me.prototype.stepped=null,Me.prototype.copy=function(n,e){var t=this.outer_zn;null==t.zpp_inner_zn.wrap_a1&&t.zpp_inner_zn.setup_a1();var i=t.zpp_inner_zn.wrap_a1,p=this.outer_zn;null==p.zpp_inner_zn.wrap_a2&&p.zpp_inner_zn.setup_a2();var l=new D(null,null,i,p.zpp_inner_zn.wrap_a2);if(this.copyto(l),null!=n&&null!=this.b1){for(var r=null,o=0;o<n.length;){var a=n[o];if(++o,a.id==this.b1.id){r=a.bc;break}}null!=r?l.zpp_inner_zn.b1=r.zpp_inner:e.push(ze.todo(this.b1.id,function(n){l.zpp_inner_zn.b1=n.zpp_inner}))}if(null!=n&&null!=this.b2){for(var s=null,_=0;_<n.length;){var h=n[_];if(++_,h.id==this.b2.id){s=h.bc;break}}null!=s?l.zpp_inner_zn.b2=s.zpp_inner:e.push(ze.todo(this.b2.id,function(n){l.zpp_inner_zn.b2=n.zpp_inner}))}return l},Me.prototype.validate=function(){if(null==this.b1||null==this.b2)throw new l("Error: AngleJoint cannot be simulated null bodies");if(this.b1==this.b2)throw new l("Error: WeldJoint cannot be simulated with body1 == body2");if(this.b1.space!=this.space||this.b2.space!=this.space)throw new l("Error: Constraints must have each body within the same space to which the constraint has been assigned");if(2!=this.b1.type&&2!=this.b2.type)throw new l("Error: Constraints cannot have both bodies non-dynamic")},Me.prototype.wake_connected=function(){null!=this.b1&&2==this.b1.type&&this.b1.wake(),null!=this.b2&&2==this.b2.type&&this.b2.wake()},Me.prototype.forest=function(){if(2==this.b1.type){var n,e;if(this.b1.component==this.b1.component.parent)n=this.b1.component;else{for(var t=this.b1.component,i=null;t!=t.parent;){var p=t.parent;t.parent=i,i=t,t=p}for(;null!=i;){var l=i.parent;i.parent=t,i=l}n=t}if(this.component==this.component.parent)e=this.component;else{for(var r=this.component,o=null;r!=r.parent;){var a=r.parent;r.parent=o,o=r,r=a}for(;null!=o;){var s=o.parent;o.parent=r,o=s}e=r}n!=e&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n,n.rank++))}if(2==this.b2.type){var _,h;if(this.b2.component==this.b2.component.parent)_=this.b2.component;else{for(var u=this.b2.component,x=null;u!=u.parent;){var d=u.parent;u.parent=x,x=u,u=d}for(;null!=x;){var y=x.parent;x.parent=u,x=y}_=u}if(this.component==this.component.parent)h=this.component;else{for(var z=this.component,v=null;z!=z.parent;){var c=z.parent;z.parent=v,v=z,z=c}for(;null!=v;){var f=v.parent;v.parent=z,v=f}h=z}_!=h&&(_.rank<h.rank?_.parent=h:_.rank>h.rank?h.parent=_:(h.parent=_,_.rank++))}},Me.prototype.pair_exists=function(n,e){return this.b1.id==n&&this.b2.id==e||this.b1.id==e&&this.b2.id==n},Me.prototype.clearcache=function(){this.jAccx=0,this.jAccy=0,this.jAccz=0,this.pre_dt=-1},Me.prototype.preStep=function(n){-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n,this.stepped=!0,this.a1relx=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,this.a1rely=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy,this.a2relx=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,this.a2rely=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var t=this.b1.smass+this.b2.smass;if(this.kMassa=t,this.kMassb=0,this.kMassd=t,this.kMassc=0,this.kMasse=0,this.kMassf=0,0!=this.b1.sinertia){var i=this.a1relx*this.b1.sinertia,p=this.a1rely*this.b1.sinertia;this.kMassa+=p*this.a1rely,this.kMassb+=-p*this.a1relx,this.kMassd+=i*this.a1relx,this.kMassc+=-p,this.kMasse+=i,this.kMassf+=this.b1.sinertia}if(0!=this.b2.sinertia){var l=this.a2relx*this.b2.sinertia,r=this.a2rely*this.b2.sinertia;this.kMassa+=r*this.a2rely,this.kMassb+=-r*this.a2relx,this.kMassd+=l*this.a2relx,this.kMassc+=-r,this.kMasse+=l,this.kMassf+=this.b2.sinertia}var o,a=this.kMassa*(this.kMassd*this.kMassf-this.kMasse*this.kMasse)+this.kMassb*(this.kMassc*this.kMasse-this.kMassb*this.kMassf)+this.kMassc*(this.kMassb*this.kMasse-this.kMassc*this.kMassd);if(a!=a)this.kMassa=0,this.kMassb=0,this.kMassd=0,this.kMassc=0,this.kMasse=0,this.kMassf=0,o=7;else if(0==a){var s=0;0!=this.kMassa?this.kMassa=1/this.kMassa:(this.kMassa=0,s=1),0!=this.kMassd?this.kMassd=1/this.kMassd:(this.kMassd=0,s|=2),0!=this.kMassf?this.kMassf=1/this.kMassf:(this.kMassf=0,s|=4),this.kMassb=this.kMassc=this.kMasse=0,o=s}else{var _=(a=1/a)*(this.kMassd*this.kMassf-this.kMasse*this.kMasse),h=a*(this.kMasse*this.kMassc-this.kMassb*this.kMassf),u=a*(this.kMassa*this.kMassf-this.kMassc*this.kMassc),x=a*(this.kMassb*this.kMasse-this.kMassc*this.kMassd),d=a*(this.kMassb*this.kMassc-this.kMassa*this.kMasse),y=this.kMassa*this.kMassd-this.kMassb*this.kMassb;this.kMassa=_,this.kMassb=h,this.kMassd=u,this.kMassc=x,this.kMasse=d,this.kMassf=a*y,o=0}if(0!=(1&o)&&(this.jAccx=0),0!=(2&o)&&(this.jAccy=0),0!=(4&o)&&(this.jAccz=0),this.stiff)this.biasx=0,this.biasy=0,this.biasz=0,this.gamma=0;else{var z,v=2*Math.PI*this.frequency;this.gamma=1/(n*v*(2*this.damping+v*n));var c=1/(1+this.gamma);if(z=n*v*v*this.gamma,this.gamma*=c,this.kMassa*=c,this.kMassb*=c,this.kMassd*=c,this.kMassc*=c,this.kMasse*=c,this.kMassf*=c,this.biasx=this.b2.posx+this.a2relx-(this.b1.posx+this.a1relx),this.biasy=this.b2.posy+this.a2rely-(this.b1.posy+this.a1rely),this.biasz=this.b2.rot-this.b1.rot-this.phase,this.breakUnderError&&this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz>this.maxError*this.maxError)return!0;var f=-z;this.biasx*=f,this.biasy*=f,this.biasz*=f;var m=this.maxError,b=this.biasx*this.biasx+this.biasy*this.biasy+this.biasz*this.biasz;if(b>m*m){var g=m*(1/Math.sqrt(b));this.biasx*=g,this.biasy*=g,this.biasz*=g}}return this.jAccx*=e,this.jAccy*=e,this.jAccz*=e,this.jMax=this.maxForce*n,!1},Me.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.jAccx*n,this.b1.vely-=this.jAccy*n;var e=this.b2.imass;this.b2.velx+=this.jAccx*e,this.b2.vely+=this.jAccy*e,this.b1.angvel-=(this.jAccy*this.a1relx-this.jAccx*this.a1rely+this.jAccz)*this.b1.iinertia,this.b2.angvel+=(this.jAccy*this.a2relx-this.jAccx*this.a2rely+this.jAccz)*this.b2.iinertia},Me.prototype.applyImpulseVel=function(){var n,e,t;n=this.b2.velx+this.b2.kinvelx-this.a2rely*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.a1rely*(this.b1.angvel+this.b1.kinangvel)),e=this.b2.vely+this.b2.kinvely+this.a2relx*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.a1relx*(this.b1.angvel+this.b1.kinangvel)),t=this.b2.angvel+this.b2.kinangvel-this.b1.angvel-this.b1.kinangvel;var i=0,p=0,l=0;i=this.biasx-n,p=this.biasy-e,l=this.biasz-t;var r=this.kMassa*i+this.kMassb*p+this.kMassc*l,o=this.kMassb*i+this.kMassd*p+this.kMasse*l;l=this.kMassc*i+this.kMasse*p+this.kMassf*l,i=r,p=o;var a=this.gamma;i-=this.jAccx*a,p-=this.jAccy*a,l-=this.jAccz*a;var s,_,h;if(s=this.jAccx,_=this.jAccy,h=this.jAccz,this.jAccx+=i,this.jAccy+=p,this.jAccz+=l,this.breakUnderForce){if(this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz>this.jMax*this.jMax)return!0}else if(!this.stiff){var u=this.jMax,x=this.jAccx*this.jAccx+this.jAccy*this.jAccy+this.jAccz*this.jAccz;if(x>u*u){var d=u*(1/Math.sqrt(x));this.jAccx*=d,this.jAccy*=d,this.jAccz*=d}}i=this.jAccx-s,p=this.jAccy-_,l=this.jAccz-h;var y=this.b1.imass;this.b1.velx-=i*y,this.b1.vely-=p*y;var z=this.b2.imass;return this.b2.velx+=i*z,this.b2.vely+=p*z,this.b1.angvel-=(p*this.a1relx-i*this.a1rely+l)*this.b1.iinertia,this.b2.angvel+=(p*this.a2relx-i*this.a2rely+l)*this.b2.iinertia,!1},Me.prototype.applyImpulsePos=function(){var n,e;n=this.b1.axisy*this.a1localx-this.b1.axisx*this.a1localy,e=this.a1localx*this.b1.axisx+this.a1localy*this.b1.axisy;var t,i;t=this.b2.axisy*this.a2localx-this.b2.axisx*this.a2localy,i=this.a2localx*this.b2.axisx+this.a2localy*this.b2.axisy;var p=0,l=0,r=0;p=this.b2.posx+t-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+e),r=this.b2.rot-this.b1.rot-this.phase;var a=0,s=0,_=0;if(this.breakUnderError&&p*p+l*l+r*r>this.maxError*this.maxError)return!0;var h=!0;p*p+l*l<o.constraintLinearSlop*o.constraintLinearSlop&&(h=!1,p=0,l=0);var u=r*r,x=o.constraintAngularSlop;if(u<x*x){if(!h)return!1;r=0}if(r*=.5,(p*=.5)*p+(l*=.5)*l>6){var d=this.b1.smass+this.b2.smass;if(d>o.epsilon){var y=(a=-p*(d=.75/d))*a+(s=-l*d)*s;if(y>400){var z=1/Math.sqrt(y)*20;a*=z,s*=z}var v=this.b1.imass;this.b1.posx-=a*v,this.b1.posy-=s*v;var c=this.b2.imass;this.b2.posx+=a*c,this.b2.posy+=s*c,p=this.b2.posx+t-(this.b1.posx+n),l=this.b2.posy+i-(this.b1.posy+e),r=this.b2.rot-this.b1.rot-this.phase,p*=.5,l*=.5,r*=.5}}var f=0,m=0,b=0,g=0,w=0,M=0,C=this.b1.smass+this.b2.smass;if(f=C,m=0,b=C,g=0,w=0,M=0,0!=this.b1.sinertia){var k=n*this.b1.sinertia,O=e*this.b1.sinertia;f=C+O*e,m+=-O*n,b=C+k*n,g+=-O,w+=k,M+=this.b1.sinertia}if(0!=this.b2.sinertia){var P=t*this.b2.sinertia,S=i*this.b2.sinertia;f+=S*i,m+=-S*t,b+=P*t,g+=-S,w+=P,M+=this.b2.sinertia}_=-r;var A=(a=-p)*a+(s=-l)*s;if(A>36){var j=1/Math.sqrt(A)*6;a*=j,s*=j}var E=f*(b*M-w*w)+m*(g*w-m*M)+g*(m*w-g*b);if(E!=E)a=s=_=0;else if(0==E)0!=f?a/=f:a=0,0!=b?s/=b:s=0,0!=M?_/=M:_=0;else{var I=w*g-m*M,T=m*w-g*b,N=m*g-f*w,L=(E=1/E)*(a*(b*M-w*w)+s*I+_*T),V=E*(a*I+s*(f*M-g*g)+_*N);_=E*(a*T+s*N+_*(f*b-m*m)),a=L,s=V}var D=this.b1.imass;this.b1.posx-=a*D,this.b1.posy-=s*D;var F=this.b2.imass;this.b2.posx+=a*F,this.b2.posy+=s*F;var R=this.b1,Z=-(s*n-a*e+_)*this.b1.iinertia;if(R.rot+=Z,Z*Z>1e-4)R.axisx=Math.sin(R.rot),R.axisy=Math.cos(R.rot);else{var B=Z*Z,G=1-.5*B,q=1-B*B/8,U=(G*R.axisx+Z*R.axisy)*q;R.axisy=(G*R.axisy-Z*R.axisx)*q,R.axisx=U}var K=this.b2,W=(s*t-a*i+_)*this.b2.iinertia;if(K.rot+=W,W*W>1e-4)K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot);else{var Y=W*W,J=1-.5*Y,X=1-Y*Y/8,H=(J*K.axisx+W*K.axisy)*X;K.axisy=(J*K.axisy-W*K.axisx)*X,K.axisx=H}return!1},Me.prototype.draw=function(n){},Me.prototype.__class__=Me;var Ce=zpp_nape.dynamics.ZPP_Arbiter=function(){this.sensorarb=null,this.fluidarb=null,this.colarb=null,this.type=0,this.pair=null,this.ws2=null,this.ws1=null,this.b2=null,this.b1=null,this.invalidated=!1,this.immState=0,this.fresh=!1,this.continuous=!1,this.presentable=!1,this.intchange=!1,this.present=0,this.sleeping=!1,this.cleared=!1,this.active=!1,this.endGenerated=0,this.sleep_stamp=0,this.up_stamp=0,this.stamp=0,this.di=0,this.id=0,this.hnext=null,this.outer=null};Ce.__name__=["zpp_nape","dynamics","ZPP_Arbiter"],Ce.prototype.outer=null,Ce.prototype.wrapper=function(){return null==this.outer&&(Ce.internal=!0,this.type==Ce.COL?(this.colarb.outer_zn=new G,this.outer=this.colarb.outer_zn):this.type==Ce.FLUID?(this.fluidarb.outer_zn=new W,this.outer=this.fluidarb.outer_zn):this.outer=new F,this.outer.zpp_inner=this,Ce.internal=!1),this.outer},Ce.prototype.inactiveme=function(){return!this.active},Ce.prototype.hnext=null,Ce.prototype.id=null,Ce.prototype.di=null,Ce.prototype.stamp=null,Ce.prototype.up_stamp=null,Ce.prototype.sleep_stamp=null,Ce.prototype.endGenerated=null,Ce.prototype.active=null,Ce.prototype.cleared=null,Ce.prototype.sleeping=null,Ce.prototype.present=null,Ce.prototype.intchange=null,Ce.prototype.presentable=null,Ce.prototype.continuous=null,Ce.prototype.fresh=null,Ce.prototype.immState=null,Ce.prototype.acting=function(){return!!this.active&&0!=(1&this.immState)},Ce.prototype.invalidated=null,Ce.prototype.b1=null,Ce.prototype.b2=null,Ce.prototype.ws1=null,Ce.prototype.ws2=null,Ce.prototype.pair=null,Ce.prototype.swap_features=function(){var n=this.b1;this.b1=this.b2,this.b2=n;var e=this.ws1;this.ws1=this.ws2,this.ws2=e;var t=this.colarb.s1;this.colarb.s1=this.colarb.s2,this.colarb.s2=t},Ce.prototype.type=null,Ce.prototype.colarb=null,Ce.prototype.fluidarb=null,Ce.prototype.sensorarb=null,Ce.prototype.lazyRetire=function(n,e){if(this.cleared=!0,null==e||this.b2==e)for(var t=this.b1.arbiters,i=null,p=t.head;null!=p;){if(p.elt==this){var l,r;null==i?(r=(l=t.head).next,t.head=r,null==t.head&&(t.pushmod=!0)):(r=(l=i.next).next,i.next=r,null==r&&(t.pushmod=!0));var o=l;o.elt=null,o.next=bi.zpp_pool,bi.zpp_pool=o,t.modified=!0,t.length--,t.pushmod=!0;break}i=p,p=p.next}if(null==e||this.b1==e)for(var a=this.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==this){var h,u;null==s?(u=(h=a.head).next,a.head=u,null==a.head&&(a.pushmod=!0)):(u=(h=s.next).next,s.next=u,null==u&&(a.pushmod=!0));var x=h;x.elt=null,x.next=bi.zpp_pool,bi.zpp_pool=x,a.modified=!0,a.length--,a.pushmod=!0;break}s=_,_=_.next}null!=this.pair&&(this.pair.arb=null,this.pair=null),this.active=!1,n.f_arbiters.modified=!0},Ce.prototype.sup_assign=function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var p,l=this.b1.arbiters;null==bi.zpp_pool?p=new bi:(p=bi.zpp_pool,bi.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==bi.zpp_pool?o=new bi:(o=bi.zpp_pool,bi.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},Ce.prototype.sup_retire=function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,p;null==e?(p=(i=n.head).next,n.head=p,null==n.head&&(n.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(n.pushmod=!0));var l=i;l.elt=null,l.next=bi.zpp_pool,bi.zpp_pool=l,n.modified=!0,n.length--,n.pushmod=!0;break}e=t,t=t.next}for(var r=this.b2.arbiters,o=null,a=r.head;null!=a;){if(a.elt==this){var s,_;null==o?(_=(s=r.head).next,r.head=_,null==r.head&&(r.pushmod=!0)):(_=(s=o.next).next,o.next=_,null==_&&(r.pushmod=!0));var h=s;h.elt=null,h.next=bi.zpp_pool,bi.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0;break}o=a,a=a.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1},Ce.prototype.__class__=Ce;var ke=zpp_nape.dynamics.ZPP_SensorArbiter=function(){this.next=null,Ce.call(this),this.type=Ce.SENSOR,this.sensorarb=this};ke.__name__=["zpp_nape","dynamics","ZPP_SensorArbiter"],ke.__super__=Ce,ke.prototype=Object.create(Ce.prototype),ke.prototype.next=null,ke.prototype.alloc=function(){},ke.prototype.free=function(){},ke.prototype.assign=function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var p,l=this.b1.arbiters;null==bi.zpp_pool?p=new bi:(p=bi.zpp_pool,bi.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==bi.zpp_pool?o=new bi:(o=bi.zpp_pool,bi.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1},ke.prototype.retire=function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,p;null==e?(p=(i=n.head).next,n.head=p,null==n.head&&(n.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(n.pushmod=!0));var l=i;l.elt=null,l.next=bi.zpp_pool,bi.zpp_pool=l,n.modified=!0,n.length--,n.pushmod=!0;break}e=t,t=t.next}for(var r=this.b2.arbiters,o=null,a=r.head;null!=a;){if(a.elt==this){var s,_;null==o?(_=(s=r.head).next,r.head=_,null==r.head&&(r.pushmod=!0)):(_=(s=o.next).next,o.next=_,null==_&&(r.pushmod=!0));var h=s;h.elt=null,h.next=bi.zpp_pool,bi.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0;break}o=a,a=a.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=ke.zpp_pool,ke.zpp_pool=this},ke.prototype.makemutable=function(){},ke.prototype.makeimmutable=function(){},ke.prototype.__class__=ke;var Oe=zpp_nape.dynamics.ZPP_FluidArbiter=function(){this.pre_dt=0,this.mutable=!1,this.wrap_position=null,this.buoyy=0,this.buoyx=0,this.ny=0,this.nx=0,this.lgamma=0,this.dampy=0,this.dampx=0,this.vMassc=0,this.vMassb=0,this.vMassa=0,this.agamma=0,this.adamp=0,this.wMass=0,this.nodrag=!1,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0,this.overlap=0,this.centroidy=0,this.centroidx=0,this.next=null,this.outer_zn=null,Ce.call(this),this.type=Ce.FLUID,this.fluidarb=this,this.buoyx=0,this.buoyy=0,this.pre_dt=-1};Oe.__name__=["zpp_nape","dynamics","ZPP_FluidArbiter"],Oe.__super__=Ce,Oe.prototype=Object.create(Ce.prototype),Oe.prototype.outer_zn=null,Oe.prototype.next=null,Oe.prototype.alloc=function(){},Oe.prototype.free=function(){},Oe.prototype.centroidx=null,Oe.prototype.centroidy=null,Oe.prototype.overlap=null,Oe.prototype.r1x=null,Oe.prototype.r1y=null,Oe.prototype.r2x=null,Oe.prototype.r2y=null,Oe.prototype.nodrag=null,Oe.prototype.wMass=null,Oe.prototype.adamp=null,Oe.prototype.agamma=null,Oe.prototype.vMassa=null,Oe.prototype.vMassb=null,Oe.prototype.vMassc=null,Oe.prototype.dampx=null,Oe.prototype.dampy=null,Oe.prototype.lgamma=null,Oe.prototype.nx=null,Oe.prototype.ny=null,Oe.prototype.buoyx=null,Oe.prototype.buoyy=null,Oe.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.centroidx,this.wrap_position.zpp_inner.y=this.centroidy},Oe.prototype.position_invalidate=function(n){this.centroidx=n.x,this.centroidy=n.y},Oe.prototype.wrap_position=null,Oe.prototype.getposition=function(){var n;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var t;null==xt.zpp_pool?t=new xt:(t=xt.zpp_pool,xt.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n}else{var i,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var l=n.zpp_inner;null!=l._validate&&l._validate(),i=0==n.zpp_inner.y}else i=!1;if(!i){n.zpp_inner.x=0,n.zpp_inner.y=0;var r=n.zpp_inner;null!=r._invalidate&&r._invalidate(r)}}n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!this.mutable,this.wrap_position.zpp_inner._validate=e(this,this.position_validate),this.wrap_position.zpp_inner._invalidate=e(this,this.position_invalidate)},Oe.prototype.assign=function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var p,l=this.b1.arbiters;null==bi.zpp_pool?p=new bi:(p=bi.zpp_pool,bi.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==bi.zpp_pool?o=new bi:(o=bi.zpp_pool,bi.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.nx=0,this.ny=1,this.dampx=0,this.dampy=0,this.adamp=0},Oe.prototype.retire=function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,p;null==e?(p=(i=n.head).next,n.head=p,null==n.head&&(n.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(n.pushmod=!0));var l=i;l.elt=null,l.next=bi.zpp_pool,bi.zpp_pool=l,n.modified=!0,n.length--,n.pushmod=!0;break}e=t,t=t.next}for(var r=this.b2.arbiters,o=null,a=r.head;null!=a;){if(a.elt==this){var s,_;null==o?(_=(s=r.head).next,r.head=_,null==r.head&&(r.pushmod=!0)):(_=(s=o.next).next,o.next=_,null==_&&(r.pushmod=!0));var h=s;h.elt=null,h.next=bi.zpp_pool,bi.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0;break}o=a,a=a.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}this.b1=this.b2=null,this.active=!1,this.intchange=!1;this.next=Oe.zpp_pool,Oe.zpp_pool=this,this.pre_dt=-1},Oe.prototype.mutable=null,Oe.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!1)},Oe.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_position&&(this.wrap_position.zpp_inner._immutable=!0)},Oe.prototype.inject=function(n,e,t){this.overlap=n,this.centroidx=e,this.centroidy=t},Oe.prototype.pre_dt=null,Oe.prototype.preStep=function(n,e){-1==this.pre_dt&&(this.pre_dt=e);var t=e/this.pre_dt;this.pre_dt=e,this.r1x=this.centroidx-this.b1.posx,this.r1y=this.centroidy-this.b1.posy,this.r2x=this.centroidx-this.b2.posx,this.r2y=this.centroidy-this.b2.posy;var i=0,p=0;this.ws1.fluidEnabled&&null!=this.ws1.fluidProperties.wrap_gravity?(i=this.ws1.fluidProperties.gravityx,p=this.ws1.fluidProperties.gravityy):(i=n.gravityx,p=n.gravityy);var l=0,r=0;this.ws2.fluidEnabled&&null!=this.ws2.fluidProperties.wrap_gravity?(l=this.ws2.fluidProperties.gravityx,r=this.ws2.fluidProperties.gravityy):(l=n.gravityx,r=n.gravityy);var a=0,s=0;if(this.ws1.fluidEnabled&&this.ws2.fluidEnabled){var _=this.overlap*this.ws1.fluidProperties.density,h=this.overlap*this.ws2.fluidProperties.density;if(_>h){var u=_+h;a-=i*u,s-=p*u}else if(_<h){var x=_+h;a+=l*x,s+=r*x}else{var d=0,y=0;if(d=i+l,y=p+r,d*=.5,y*=.5,this.ws1.worldCOMx*d+this.ws1.worldCOMy*y>this.ws2.worldCOMx*d+this.ws2.worldCOMy*y){var z=_+h;a-=d*z,s-=y*z}else{var v=_+h;a+=d*v,s+=y*v}}}else if(this.ws1.fluidEnabled){var c=this.overlap*this.ws1.fluidProperties.density;a-=i*c,s-=p*c}else if(this.ws2.fluidEnabled){var f=this.overlap*this.ws2.fluidProperties.density;a+=l*f,s+=r*f}if(a*=e,s*=e,this.buoyx=a,this.buoyy=s,2==this.b1.type){var m=this.b1.imass;this.b1.velx-=a*m,this.b1.vely-=s*m,this.b1.angvel-=(s*this.r1x-a*this.r1y)*this.b1.iinertia}if(2==this.b2.type){var b=this.b2.imass;this.b2.velx+=a*b,this.b2.vely+=s*b,this.b2.angvel+=(s*this.r2x-a*this.r2y)*this.b2.iinertia}if(this.ws1.fluidEnabled&&0!=this.ws1.fluidProperties.viscosity||this.ws2.fluidEnabled&&0!=this.ws2.fluidProperties.viscosity){this.nodrag=!1;var g=0;if(this.ws1.fluidEnabled&&(this.ws2.validate_angDrag(),g=this.ws1.fluidProperties.viscosity*this.ws2.angDrag*this.overlap/this.ws2.area),this.ws2.fluidEnabled&&(this.ws1.validate_angDrag(),g+=this.ws2.fluidProperties.viscosity*this.ws1.angDrag*this.overlap/this.ws1.area),0!=g){var w=this.b1.sinertia+this.b2.sinertia;this.wMass=0!=w?1/w:0,g*=4e-4;var M=2*Math.PI*g;this.agamma=1/(e*M*(2+M*e));var C=1/(1+this.agamma);this.agamma*=C,this.wMass*=C}else this.wMass=0,this.agamma=0;var k=this.b2.velx+this.b2.kinvelx-this.r2y*(this.b2.angvel+this.b2.kinangvel)-(this.b1.velx+this.b1.kinvelx-this.r1y*(this.b2.angvel+this.b2.kinangvel)),O=this.b2.vely+this.b2.kinvely+this.r2x*(this.b2.angvel+this.b2.kinangvel)-(this.b1.vely+this.b1.kinvely+this.r1x*(this.b1.angvel+this.b1.kinangvel));if(!(k*k+O*O<o.epsilon*o.epsilon)){var P=1/Math.sqrt(k*k+O*O);k*=P,O*=P,this.nx=k,this.ny=O}var S=0;if(this.ws1.fluidEnabled){var A=-this.ws1.fluidProperties.viscosity*this.overlap/this.ws2.area;if(0==this.ws2.type)S=0-A*this.ws2.circle.radius*o.fluidLinearDrag/(2*this.ws2.circle.radius*Math.PI);else{for(var j=0,E=0,I=this.ws2.polygon.edges.head;null!=I;){var T=I.elt;j+=T.length;var N=A*T.length*(T.gnormx*this.nx+T.gnormy*this.ny);N>0&&(N=N*=-o.fluidVacuumDrag),E-=.5*N*o.fluidLinearDrag,I=I.next}S=E/j}}if(this.ws2.fluidEnabled){var L=-this.ws2.fluidProperties.viscosity*this.overlap/this.ws1.area;if(0==this.ws1.type)S-=L*this.ws1.circle.radius*o.fluidLinearDrag/(2*this.ws1.circle.radius*Math.PI);else{for(var V=0,D=0,F=this.ws1.polygon.edges.head;null!=F;){var R=F.elt;V+=R.length;var Z=L*R.length*(R.gnormx*this.nx+R.gnormy*this.ny);Z>0&&(Z=Z*=-o.fluidVacuumDrag),D-=.5*Z*o.fluidLinearDrag,F=F.next}S+=D/V}}if(0!=S){var B=this.b1.smass+this.b2.smass,G=0,q=0,U=0;if(G=B,q=0,U=B,0!=this.b1.sinertia){var K=this.r1x*this.b1.sinertia,W=this.r1y*this.b1.sinertia;G=B+W*this.r1y,q+=-W*this.r1x,U=B+K*this.r1x}if(0!=this.b2.sinertia){var Y=this.r2x*this.b2.sinertia,J=this.r2y*this.b2.sinertia;G+=J*this.r2y,q+=-J*this.r2x,U+=Y*this.r2x}var X=G*U-q*q;if(X!=X)G=q=U=0;else if(0==X)G=0!=G?1/G:0,U=0!=U?1/U:0,q=0;else{var H=U*(X=1/X);U=G*X,G=H,q*=-X}this.vMassa=G,this.vMassb=q,this.vMassc=U;var $=2*Math.PI*S;this.lgamma=1/(e*$*(2+$*e));var Q=1/(1+this.lgamma);this.lgamma*=Q,this.vMassa*=Q,this.vMassb*=Q,this.vMassc*=Q}else this.vMassa=0,this.vMassb=0,this.vMassc=0,this.lgamma=0}else this.nodrag=!0,this.dampx=0,this.dampy=0,this.adamp=0;this.dampx*=t,this.dampy*=t,this.adamp*=t},Oe.prototype.warmStart=function(){var n=this.b1.imass;this.b1.velx-=this.dampx*n,this.b1.vely-=this.dampy*n;var e=this.b2.imass;this.b2.velx+=this.dampx*e,this.b2.vely+=this.dampy*e,this.b1.angvel-=this.b1.iinertia*(this.dampy*this.r1x-this.dampx*this.r1y),this.b2.angvel+=this.b2.iinertia*(this.dampy*this.r2x-this.dampx*this.r2y),this.b1.angvel-=this.adamp*this.b1.iinertia,this.b2.angvel+=this.adamp*this.b2.iinertia},Oe.prototype.applyImpulseVel=function(){if(!this.nodrag){var n=this.b1.angvel+this.b1.kinangvel,e=this.b2.angvel+this.b2.kinangvel,t=this.b1.velx+this.b1.kinvelx-this.r1y*n-(this.b2.velx+this.b2.kinvelx-this.r2y*e),i=this.b1.vely+this.b1.kinvely+this.r1x*n-(this.b2.vely+this.b2.kinvely+this.r2x*e),p=this.vMassa*t+this.vMassb*i;i=this.vMassb*t+this.vMassc*i,t=p;var l=this.lgamma;t-=this.dampx*l,i-=this.dampy*l,this.dampx+=t,this.dampy+=i;var r=this.b1.imass;this.b1.velx-=t*r,this.b1.vely-=i*r;var o=this.b2.imass;this.b2.velx+=t*o,this.b2.vely+=i*o,this.b1.angvel-=this.b1.iinertia*(i*this.r1x-t*this.r1y),this.b2.angvel+=this.b2.iinertia*(i*this.r2x-t*this.r2y);var a=(n-e)*this.wMass-this.adamp*this.agamma;this.adamp+=a,this.b1.angvel-=a*this.b1.iinertia,this.b2.angvel+=a*this.b2.iinertia}},Oe.prototype.__class__=Oe;var Pe=zpp_nape.dynamics.ZPP_ColArbiter=function(){this.pre_dt=0,this.mutable=!1,this.stat=!1,this.next=null,this.hpc2=!1,this.hc2=!1,this.oc2=null,this.c2=null,this.oc1=null,this.c1=null,this.__ref_vertex=0,this.__ref_edge2=null,this.__ref_edge1=null,this.biasCoef=0,this.rev=!1,this.radius=0,this.lproj=0,this.lnormy=0,this.lnormx=0,this.surfacey=0,this.surfacex=0,this.k2y=0,this.k2x=0,this.k1y=0,this.k1x=0,this.rt2b=0,this.rn2b=0,this.rt2a=0,this.rn2a=0,this.rt1b=0,this.rn1b=0,this.rt1a=0,this.rn1a=0,this.jrAcc=0,this.rMass=0,this.Kc=0,this.Kb=0,this.Ka=0,this.kMassc=0,this.kMassb=0,this.kMassa=0,this.wrap_normal=null,this.ny=0,this.nx=0,this.innards=null,this.wrap_contacts=null,this.contacts=null,this.s2=null,this.s1=null,this.userdef_rfric=!1,this.userdef_restitution=!1,this.userdef_stat_fric=!1,this.userdef_dyn_fric=!1,this.rfric=0,this.restitution=0,this.stat_fric=0,this.dyn_fric=0,this.outer_zn=null,Ce.call(this),this.pre_dt=-1,this.contacts=new Se,this.innards=new Ae,this.type=Ce.COL,this.colarb=this};Pe.__name__=["zpp_nape","dynamics","ZPP_ColArbiter"],Pe.__super__=Ce,Pe.prototype=Object.create(Ce.prototype),Pe.prototype.outer_zn=null,Pe.prototype.dyn_fric=null,Pe.prototype.stat_fric=null,Pe.prototype.restitution=null,Pe.prototype.rfric=null,Pe.prototype.userdef_dyn_fric=null,Pe.prototype.userdef_stat_fric=null,Pe.prototype.userdef_restitution=null,Pe.prototype.userdef_rfric=null,Pe.prototype.s1=null,Pe.prototype.s2=null,Pe.prototype.contacts=null,Pe.prototype.wrap_contacts=null,Pe.prototype.innards=null,Pe.prototype.nx=null,Pe.prototype.ny=null,Pe.prototype.normal_validate=function(){if(this.cleared)throw new l("Error: Arbiter not currently in use");this.wrap_normal.zpp_inner.x=this.nx,this.wrap_normal.zpp_inner.y=this.ny,this.ws1.id>this.ws2.id&&(this.wrap_normal.zpp_inner.x=-this.wrap_normal.zpp_inner.x,this.wrap_normal.zpp_inner.y=-this.wrap_normal.zpp_inner.y)},Pe.prototype.wrap_normal=null,Pe.prototype.getnormal=function(){var n;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var t;null==xt.zpp_pool?t=new xt:(t=xt.zpp_pool,xt.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n}else{var i,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var l=n.zpp_inner;null!=l._validate&&l._validate(),i=0==n.zpp_inner.y}else i=!1;if(!i){n.zpp_inner.x=0,n.zpp_inner.y=0;var r=n.zpp_inner;null!=r._invalidate&&r._invalidate(r)}}n.zpp_inner.weak=!1,this.wrap_normal=n,this.wrap_normal.zpp_inner._immutable=!0,this.wrap_normal.zpp_inner._inuse=!0,this.wrap_normal.zpp_inner._validate=e(this,this.normal_validate)},Pe.prototype.kMassa=null,Pe.prototype.kMassb=null,Pe.prototype.kMassc=null,Pe.prototype.Ka=null,Pe.prototype.Kb=null,Pe.prototype.Kc=null,Pe.prototype.rMass=null,Pe.prototype.jrAcc=null,Pe.prototype.rn1a=null,Pe.prototype.rt1a=null,Pe.prototype.rn1b=null,Pe.prototype.rt1b=null,Pe.prototype.rn2a=null,Pe.prototype.rt2a=null,Pe.prototype.rn2b=null,Pe.prototype.rt2b=null,Pe.prototype.k1x=null,Pe.prototype.k1y=null,Pe.prototype.k2x=null,Pe.prototype.k2y=null,Pe.prototype.surfacex=null,Pe.prototype.surfacey=null,Pe.prototype.ptype=null,Pe.prototype.lnormx=null,Pe.prototype.lnormy=null,Pe.prototype.lproj=null,Pe.prototype.radius=null,Pe.prototype.rev=null,Pe.prototype.biasCoef=null,Pe.prototype.__ref_edge1=null,Pe.prototype.__ref_edge2=null,Pe.prototype.__ref_vertex=null,Pe.prototype.c1=null,Pe.prototype.oc1=null,Pe.prototype.c2=null,Pe.prototype.oc2=null,Pe.prototype.hc2=null,Pe.prototype.hpc2=null,Pe.prototype.next=null,Pe.prototype.alloc=function(){},Pe.prototype.free=function(){this.userdef_dyn_fric=!1,this.userdef_stat_fric=!1,this.userdef_restitution=!1,this.userdef_rfric=!1,this.__ref_edge1=this.__ref_edge2=null},Pe.prototype.stat=null,Pe.prototype.injectContact=function(n,e,t,i,p,l,r){null==r&&(r=!1);for(var o=null,a=this.contacts.next;null!=a;){var s=a;if(l==s.hash){o=s;break}a=a.next}if(null==o){null==Se.zpp_pool?o=new Se:(o=Se.zpp_pool,Se.zpp_pool=o.next,o.next=null);var _=o.inner;_.jnAcc=_.jtAcc=0,o.hash=l,o.fresh=!0,o.arbiter=this,this.jrAcc=0;var h=this.contacts;o._inuse=!0;var u=o;u.next=h.next,h.next=u,h.modified=!0,h.length++,this.innards.add(_)}else o.fresh=!1;return o.px=n,o.py=e,this.nx=t,this.ny=i,o.dist=p,o.stamp=this.stamp,o.posOnly=r,o},Pe.prototype.assign=function(n,e,t,i){this.b1=n.body,this.ws1=n,this.b2=e.body,this.ws2=e,this.id=t,this.di=i;var p,l=this.b1.arbiters;null==bi.zpp_pool?p=new bi:(p=bi.zpp_pool,bi.zpp_pool=p.next,p.next=null),p.elt=this;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o,a=this.b2.arbiters;null==bi.zpp_pool?o=new bi:(o=bi.zpp_pool,bi.zpp_pool=o.next,o.next=null),o.elt=this;var s=o;s.next=a.head,a.head=s,a.modified=!0,a.length++,this.active=!0,this.present=0,this.cleared=!1,this.sleeping=!1,this.fresh=!1,this.presentable=!1,this.s1=n,this.s2=e,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Pe.prototype.calcProperties=function(){this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))},Pe.prototype.validate_props=function(){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction)))},Pe.prototype.retire=function(){if(!this.cleared){for(var n=this.b1.arbiters,e=null,t=n.head;null!=t;){if(t.elt==this){var i,p;null==e?(p=(i=n.head).next,n.head=p,null==n.head&&(n.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(n.pushmod=!0));var l=i;l.elt=null,l.next=bi.zpp_pool,bi.zpp_pool=l,n.modified=!0,n.length--,n.pushmod=!0;break}e=t,t=t.next}for(var r=this.b2.arbiters,o=null,a=r.head;null!=a;){if(a.elt==this){var s,_;null==o?(_=(s=r.head).next,r.head=_,null==r.head&&(r.pushmod=!0)):(_=(s=o.next).next,o.next=_,null==_&&(r.pushmod=!0));var h=s;h.elt=null,h.next=bi.zpp_pool,bi.zpp_pool=h,r.modified=!0,r.length--,r.pushmod=!0;break}o=a,a=a.next}null!=this.pair&&(this.pair.arb=null,this.pair=null)}for(this.b1=this.b2=null,this.active=!1,this.intchange=!1;null!=this.contacts.next;){var u=this.contacts,x=u.next;u.pop(),x.arbiter=null,x.next=Se.zpp_pool,Se.zpp_pool=x;var d=this.innards,y=d.next;d.next=y.next,y._inuse=!1,null==d.next&&(d.pushmod=!0),d.modified=!0,d.length--}var z=this;z.userdef_dyn_fric=!1,z.userdef_stat_fric=!1,z.userdef_restitution=!1,z.userdef_rfric=!1,z.__ref_edge1=z.__ref_edge2=null,z.next=Pe.zpp_pool,Pe.zpp_pool=z,this.pre_dt=-1},Pe.prototype.mutable=null,Pe.prototype.makemutable=function(){this.mutable=!0,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!1),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!1)},Pe.prototype.makeimmutable=function(){this.mutable=!1,null!=this.wrap_normal&&(this.wrap_normal.zpp_inner._immutable=!0),null!=this.wrap_contacts&&(this.wrap_contacts.zpp_inner.immutable=!0)},Pe.prototype.contacts_adder=function(n){return!1},Pe.prototype.contacts_subber=function(n){for(var e=null,t=null,i=this.innards.next,p=this.contacts.next;null!=p;){var l=p;if(l==n.zpp_inner){this.contacts.erase(e),this.innards.erase(t),l.arbiter=null,l.next=Se.zpp_pool,Se.zpp_pool=l;break}e=p,t=i,i=i.next,p=p.next}},Pe.prototype.setupcontacts=function(){this.wrap_contacts=hp.get(this.contacts,!0),this.wrap_contacts.zpp_inner.immutable=!this.mutable,this.wrap_contacts.zpp_inner.adder=e(this,this.contacts_adder),this.wrap_contacts.zpp_inner.dontremove=!0,this.wrap_contacts.zpp_inner.subber=e(this,this.contacts_subber)},Pe.prototype.cleanupContacts=function(){var n=!0,e=null,t=null,i=this.innards.next;this.hc2=!1;for(var p=this.contacts.next;null!=p;){var l=p;if(l.stamp+o.arbiterExpirationDelay<this.stamp){var r,a,s=this.contacts;null==e?(a=(r=s.next).next,s.next=a,null==s.next&&(s.pushmod=!0)):(a=(r=e.next).next,e.next=a,null==a&&(s.pushmod=!0)),r._inuse=!1,s.modified=!0,s.length--,s.pushmod=!0,p=a;var _,h,u=this.innards;null==t?(h=(_=u.next).next,u.next=h,null==u.next&&(u.pushmod=!0)):(h=(_=t.next).next,t.next=h,null==h&&(u.pushmod=!0)),_._inuse=!1,u.modified=!0,u.length--,u.pushmod=!0,i=h,l.arbiter=null,l.next=Se.zpp_pool,Se.zpp_pool=l}else{var x=l.inner,d=l.active;l.active=l.stamp==this.stamp,l.active&&(n?(n=!1,this.c1=x,this.oc1=l):(this.hc2=!0,this.c2=x,this.oc2=l)),d!=l.active&&(this.contacts.modified=!0),e=p,t=i,i=i.next,p=p.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var y=this.c1;this.c1=this.c2,this.c2=y;var z=this.oc1;this.oc1=this.oc2,this.oc2=z,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(n=!0)}else this.hpc2=!1;return n},Pe.prototype.pre_dt=null,Pe.prototype.preStep=function(n){this.invalidated&&(this.invalidated=!1,this.userdef_restitution||(this.s1.material.elasticity<=-1/0||this.s2.material.elasticity<=-1/0?this.restitution=0:this.s1.material.elasticity>=1/0||this.s2.material.elasticity>=1/0?this.restitution=1:this.restitution=(this.s1.material.elasticity+this.s2.material.elasticity)/2,this.restitution<0&&(this.restitution=0),this.restitution>1&&(this.restitution=1)),this.userdef_dyn_fric||(this.dyn_fric=Math.sqrt(this.s1.material.dynamicFriction*this.s2.material.dynamicFriction)),this.userdef_stat_fric||(this.stat_fric=Math.sqrt(this.s1.material.staticFriction*this.s2.material.staticFriction)),this.userdef_rfric||(this.rfric=Math.sqrt(this.s1.material.rollingFriction*this.s2.material.rollingFriction))),-1==this.pre_dt&&(this.pre_dt=n);var e=n/this.pre_dt;this.pre_dt=n;var t=this.b1.smass+this.b2.smass;this.hc2=!1;var i=!0;this.biasCoef=2!=this.b1.type||2!=this.b2.type?this.continuous?o.contactContinuousStaticBiasCoef:o.contactStaticBiasCoef:this.continuous?o.contactContinuousBiasCoef:o.contactBiasCoef,this.continuous=!1;for(var p=null,l=null,r=this.innards.next,a=this.contacts.next;null!=a;){var s=a;if(s.stamp+o.arbiterExpirationDelay<this.stamp){var _,h,u=this.contacts;null==p?(h=(_=u.next).next,u.next=h,null==u.next&&(u.pushmod=!0)):(h=(_=p.next).next,p.next=h,null==h&&(u.pushmod=!0)),_._inuse=!1,u.modified=!0,u.length--,u.pushmod=!0,a=h;var x,d,y=this.innards;null==l?(d=(x=y.next).next,y.next=d,null==y.next&&(y.pushmod=!0)):(d=(x=l.next).next,l.next=d,null==d&&(y.pushmod=!0)),x._inuse=!1,y.modified=!0,y.length--,y.pushmod=!0,r=d,s.arbiter=null,s.next=Se.zpp_pool,Se.zpp_pool=s}else{var z=s.inner,v=s.active;if(s.active=s.stamp==this.stamp,s.active){i?(i=!1,this.c1=z,this.oc1=s):(this.hc2=!0,this.c2=z,this.oc2=s),z.r2x=s.px-this.b2.posx,z.r2y=s.py-this.b2.posy,z.r1x=s.px-this.b1.posx,z.r1y=s.py-this.b1.posy;var c=z.r2x*this.nx+z.r2y*this.ny,f=t+this.b2.sinertia*(c*c),m=z.r1x*this.nx+z.r1y*this.ny;f+=this.b1.sinertia*(m*m),z.tMass=f<o.epsilon*o.epsilon?0:1/f;var b=this.ny*z.r2x-this.nx*z.r2y,g=t+this.b2.sinertia*(b*b),w=this.ny*z.r1x-this.nx*z.r1y;g+=this.b1.sinertia*(w*w),z.nMass=g<o.epsilon*o.epsilon?0:1/g;var M=0,C=0,k=this.b2.angvel+this.b2.kinangvel;M=this.b2.velx+this.b2.kinvelx-z.r2y*k,C=this.b2.vely+this.b2.kinvely+z.r2x*k,k=this.b1.angvel+this.b1.kinangvel,M-=this.b1.velx+this.b1.kinvelx-z.r1y*k,C-=this.b1.vely+this.b1.kinvely+z.r1x*k;var O=this.nx*M+this.ny*C;s.elasticity=this.restitution,z.bounce=O*s.elasticity,z.bounce>-o.elasticThreshold&&(z.bounce=0),O=C*this.nx-M*this.ny;var P=o.staticFrictionThreshold;z.friction=O*O>P*P?this.dyn_fric:this.stat_fric,z.jnAcc*=e,z.jtAcc*=e}v!=s.active&&(this.contacts.modified=!0),p=a,l=r,r=r.next,a=a.next}}if(this.hc2){if(this.hpc2=!0,this.oc1.posOnly){var S=this.c1;this.c1=this.c2,this.c2=S;var A=this.oc1;this.oc1=this.oc2,this.oc2=A,this.hc2=!1}else this.oc2.posOnly&&(this.hc2=!1);this.oc1.posOnly&&(i=!0)}else this.hpc2=!1;if(this.jrAcc*=e,i||(this.rn1a=this.ny*this.c1.r1x-this.nx*this.c1.r1y,this.rt1a=this.c1.r1x*this.nx+this.c1.r1y*this.ny,this.rn1b=this.ny*this.c1.r2x-this.nx*this.c1.r2y,this.rt1b=this.c1.r2x*this.nx+this.c1.r2y*this.ny,this.k1x=this.b2.kinvelx-this.c1.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c1.r1y*this.b1.kinangvel),this.k1y=this.b2.kinvely+this.c1.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c1.r1x*this.b1.kinangvel)),this.hc2)if(this.rn2a=this.ny*this.c2.r1x-this.nx*this.c2.r1y,this.rt2a=this.c2.r1x*this.nx+this.c2.r1y*this.ny,this.rn2b=this.ny*this.c2.r2x-this.nx*this.c2.r2y,this.rt2b=this.c2.r2x*this.nx+this.c2.r2y*this.ny,this.k2x=this.b2.kinvelx-this.c2.r2y*this.b2.kinangvel-(this.b1.kinvelx-this.c2.r1y*this.b1.kinangvel),this.k2y=this.b2.kinvely+this.c2.r2x*this.b2.kinangvel-(this.b1.kinvely+this.c2.r1x*this.b1.kinangvel),this.kMassa=t+this.b1.sinertia*this.rn1a*this.rn1a+this.b2.sinertia*this.rn1b*this.rn1b,this.kMassb=t+this.b1.sinertia*this.rn1a*this.rn2a+this.b2.sinertia*this.rn1b*this.rn2b,this.kMassc=t+this.b1.sinertia*this.rn2a*this.rn2a+this.b2.sinertia*this.rn2b*this.rn2b,this.kMassa*this.kMassa+2*this.kMassb*this.kMassb+this.kMassc*this.kMassc<o.illConditionedThreshold*(this.kMassa*this.kMassc-this.kMassb*this.kMassb)){this.Ka=this.kMassa,this.Kb=this.kMassb,this.Kc=this.kMassc;var j=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(j!=j)this.kMassa=this.kMassb=this.kMassc=0;else if(0==j)0!=this.kMassa?this.kMassa=1/this.kMassa:this.kMassa=0,0!=this.kMassc?this.kMassc=1/this.kMassc:this.kMassc=0,this.kMassb=0;else{j=1/j;var E=this.kMassc*j;this.kMassc=this.kMassa*j,this.kMassa=E,this.kMassb*=-j}}else{if(this.hc2=!1,this.oc2.dist<this.oc1.dist){var I=this.c1;this.c1=this.c2,this.c2=I}this.oc2.active=!1,this.contacts.modified=!0}return this.surfacex=this.b2.svelx,this.surfacey=this.b2.svely,this.surfacex+=this.b1.svelx,this.surfacey+=this.b1.svely,this.surfacex=-this.surfacex,this.surfacey=-this.surfacey,this.rMass=this.b1.sinertia+this.b2.sinertia,0!=this.rMass&&(this.rMass=1/this.rMass),i},Pe.prototype.warmStart=function(){var n=this.nx*this.c1.jnAcc-this.ny*this.c1.jtAcc,e=this.ny*this.c1.jnAcc+this.nx*this.c1.jtAcc,t=this.b1.imass;this.b1.velx-=n*t,this.b1.vely-=e*t,this.b1.angvel-=this.b1.iinertia*(e*this.c1.r1x-n*this.c1.r1y);var i=this.b2.imass;if(this.b2.velx+=n*i,this.b2.vely+=e*i,this.b2.angvel+=this.b2.iinertia*(e*this.c1.r2x-n*this.c1.r2y),this.hc2){var p=this.nx*this.c2.jnAcc-this.ny*this.c2.jtAcc,l=this.ny*this.c2.jnAcc+this.nx*this.c2.jtAcc,r=this.b1.imass;this.b1.velx-=p*r,this.b1.vely-=l*r,this.b1.angvel-=this.b1.iinertia*(l*this.c2.r1x-p*this.c2.r1y);var o=this.b2.imass;this.b2.velx+=p*o,this.b2.vely+=l*o,this.b2.angvel+=this.b2.iinertia*(l*this.c2.r2x-p*this.c2.r2y)}this.b2.angvel+=this.jrAcc*this.b2.iinertia,this.b1.angvel-=this.jrAcc*this.b1.iinertia},Pe.prototype.applyImpulseVel=function(){var n,e,t,i,p,l,r=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),o=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel);if(t=(o*this.nx-r*this.ny+this.surfacex)*this.c1.tMass,i=this.c1.friction*this.c1.jnAcc,(l=(p=this.c1.jtAcc)-t)>i?l=i:l<-i&&(l=-i),t=l-p,this.c1.jtAcc=l,n=-this.ny*t,e=this.nx*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt1b*t*this.b2.iinertia,this.b1.angvel-=this.rt1a*t*this.b1.iinertia,this.hc2){var a=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),s=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);t=(s*this.nx-a*this.ny+this.surfacex)*this.c2.tMass,i=this.c2.friction*this.c2.jnAcc,(l=(p=this.c2.jtAcc)-t)>i?l=i:l<-i&&(l=-i),t=l-p,this.c2.jtAcc=l,n=-this.ny*t,e=this.nx*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rt2b*t*this.b2.iinertia,this.b1.angvel-=this.rt2a*t*this.b1.iinertia,r=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),o=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),a=this.k2x+this.b2.velx-this.c2.r2y*this.b2.angvel-(this.b1.velx-this.c2.r1y*this.b1.angvel),s=this.k2y+this.b2.vely+this.c2.r2x*this.b2.angvel-(this.b1.vely+this.c2.r1x*this.b1.angvel);var _=this.c1.jnAcc,h=this.c2.jnAcc,u=r*this.nx+o*this.ny+this.surfacey+this.c1.bounce-(this.Ka*_+this.Kb*h),x=a*this.nx+s*this.ny+this.surfacey+this.c2.bounce-(this.Kb*_+this.Kc*h),d=-(this.kMassa*u+this.kMassb*x),y=-(this.kMassb*u+this.kMassc*x);d>=0&&y>=0?(u=d-_,x=y-h,this.c1.jnAcc=d,this.c2.jnAcc=y):(d=-this.c1.nMass*u)>=0&&this.Kb*d+x>=0?(u=d-_,x=-h,this.c1.jnAcc=d,this.c2.jnAcc=0):(y=-this.c2.nMass*x)>=0&&this.Kb*y+u>=0?(u=-_,x=y-h,this.c1.jnAcc=0,this.c2.jnAcc=y):u>=0&&x>=0?(u=-_,x=-h,this.c1.jnAcc=this.c2.jnAcc=0):(u=0,x=0),t=u+x,n=this.nx*t,e=this.ny*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=(this.rn1b*u+this.rn2b*x)*this.b2.iinertia,this.b1.angvel-=(this.rn1a*u+this.rn2a*x)*this.b1.iinertia}else 0!=this.radius&&(t=(this.b2.angvel-this.b1.angvel)*this.rMass,i=this.rfric*this.c1.jnAcc,p=this.jrAcc,this.jrAcc-=t,this.jrAcc>i?this.jrAcc=i:this.jrAcc<-i&&(this.jrAcc=-i),t=this.jrAcc-p,this.b2.angvel+=t*this.b2.iinertia,this.b1.angvel-=t*this.b1.iinertia),r=this.k1x+this.b2.velx-this.c1.r2y*this.b2.angvel-(this.b1.velx-this.c1.r1y*this.b1.angvel),o=this.k1y+this.b2.vely+this.c1.r2x*this.b2.angvel-(this.b1.vely+this.c1.r1x*this.b1.angvel),t=(this.c1.bounce+(this.nx*r+this.ny*o)+this.surfacey)*this.c1.nMass,(l=(p=this.c1.jnAcc)-t)<0&&(l=0),t=l-p,this.c1.jnAcc=l,n=this.nx*t,e=this.ny*t,this.b2.velx+=n*this.b2.imass,this.b2.vely+=e*this.b2.imass,this.b1.velx-=n*this.b1.imass,this.b1.vely-=e*this.b1.imass,this.b2.angvel+=this.rn1b*t*this.b2.iinertia,this.b1.angvel-=this.rn1a*t*this.b1.iinertia},Pe.prototype.applyImpulsePos=function(){if(2==this.ptype){var n=this.c1,e=0,t=0;e=this.b2.axisy*n.lr2x-this.b2.axisx*n.lr2y,t=n.lr2x*this.b2.axisx+n.lr2y*this.b2.axisy,e+=this.b2.posx,t+=this.b2.posy;var i=0,p=0;i=this.b1.axisy*n.lr1x-this.b1.axisx*n.lr1y,p=n.lr1x*this.b1.axisx+n.lr1y*this.b1.axisy;var l=0,r=0;l=e-(i+=this.b1.posx),r=t-(p+=this.b1.posy);var a=Math.sqrt(l*l+r*r),s=this.radius-o.collisionSlop,_=a-s;if(l*this.nx+r*this.ny<0&&(l=-l,r=-r,_-=this.radius),_<0)if(a<o.epsilon)0!=this.b1.smass?this.b1.posx+=10*o.epsilon:this.b2.posx+=10*o.epsilon;else{var h=1/a;l*=h;var u=.5*(i+e),x=.5*(p+t),d=a-s,y=(r*=h)*(i=u-this.b1.posx)-l*(p=x-this.b1.posy),z=r*(e=u-this.b2.posx)-l*(t=x-this.b2.posy),v=this.b2.smass+z*z*this.b2.sinertia+this.b1.smass+y*y*this.b1.sinertia;if(0!=v){var c,f,m=-this.biasCoef*d/v;c=l*m,f=r*m;var b=this.b1.imass;this.b1.posx-=c*b,this.b1.posy-=f*b;var g=this.b1,w=-y*this.b1.iinertia*m;if(g.rot+=w,w*w>1e-4)g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot);else{var M=w*w,C=1-.5*M,k=1-M*M/8,O=(C*g.axisx+w*g.axisy)*k;g.axisy=(C*g.axisy-w*g.axisx)*k,g.axisx=O}var P=this.b2.imass;this.b2.posx+=c*P,this.b2.posy+=f*P;var S=this.b2,A=z*this.b2.iinertia*m;if(S.rot+=A,A*A>1e-4)S.axisx=Math.sin(S.rot),S.axisy=Math.cos(S.rot);else{var j=A*A,E=1-.5*j,I=1-j*j/8,T=(E*S.axisx+A*S.axisy)*I;S.axisy=(E*S.axisy-A*S.axisx)*I,S.axisx=T}}}}else{var N,L=0,V=0,D=0,F=0,R=0,Z=0;0==this.ptype?(L=this.b1.axisy*this.lnormx-this.b1.axisx*this.lnormy,V=this.lnormx*this.b1.axisx+this.lnormy*this.b1.axisy,N=this.lproj+(L*this.b1.posx+V*this.b1.posy),D=this.b2.axisy*this.c1.lr1x-this.b2.axisx*this.c1.lr1y,F=this.c1.lr1x*this.b2.axisx+this.c1.lr1y*this.b2.axisy,D+=this.b2.posx,F+=this.b2.posy,this.hpc2&&(R=this.b2.axisy*this.c2.lr1x-this.b2.axisx*this.c2.lr1y,Z=this.c2.lr1x*this.b2.axisx+this.c2.lr1y*this.b2.axisy,R+=this.b2.posx,Z+=this.b2.posy)):(L=this.b2.axisy*this.lnormx-this.b2.axisx*this.lnormy,V=this.lnormx*this.b2.axisx+this.lnormy*this.b2.axisy,N=this.lproj+(L*this.b2.posx+V*this.b2.posy),D=this.b1.axisy*this.c1.lr1x-this.b1.axisx*this.c1.lr1y,F=this.c1.lr1x*this.b1.axisx+this.c1.lr1y*this.b1.axisy,D+=this.b1.posx,F+=this.b1.posy,this.hpc2&&(R=this.b1.axisy*this.c2.lr1x-this.b1.axisx*this.c2.lr1y,Z=this.c2.lr1x*this.b1.axisx+this.c2.lr1y*this.b1.axisy,R+=this.b1.posx,Z+=this.b1.posy));var B=D*L+F*V-N-this.radius;B+=o.collisionSlop;var G=0;if(this.hpc2&&(G=R*L+Z*V-N-this.radius,G+=o.collisionSlop),B<0||G<0){this.rev&&(L=-L,V=-V);var q,U;q=D-this.b1.posx,U=F-this.b1.posy;var K,W;K=D-this.b2.posx,W=F-this.b2.posy;if(this.hpc2){var Y=V*q-L*U,J=V*K-L*W,X=V*(R-this.b1.posx)-L*(Z-this.b1.posy),H=V*(R-this.b2.posx)-L*(Z-this.b2.posy),$=this.b1.smass+this.b2.smass;this.kMassa=$+this.b1.sinertia*Y*Y+this.b2.sinertia*J*J,this.kMassb=$+this.b1.sinertia*Y*X+this.b2.sinertia*J*H,this.kMassc=$+this.b1.sinertia*X*X+this.b2.sinertia*H*H;var Q,nn,en;Q=this.kMassa,nn=this.kMassb,en=this.kMassc;for(var tn=B*this.biasCoef,pn=G*this.biasCoef;;){var ln=0,rn=0;ln=tn,rn=pn,ln=-tn,rn=-pn;var on=this.kMassa*this.kMassc-this.kMassb*this.kMassb;if(on!=on)ln=rn=0;else if(0==on)0!=this.kMassa?ln/=this.kMassa:ln=0,0!=this.kMassc?rn/=this.kMassc:rn=0;else{var an=(on=1/on)*(this.kMassc*ln-this.kMassb*rn);rn=on*(this.kMassa*rn-this.kMassb*ln),ln=an}if(ln>=0&&rn>=0){var sn=(ln+rn)*this.b1.imass;this.b1.posx-=L*sn,this.b1.posy-=V*sn;var _n=this.b1,hn=-this.b1.iinertia*(Y*ln+X*rn);if(_n.rot+=hn,hn*hn>1e-4)_n.axisx=Math.sin(_n.rot),_n.axisy=Math.cos(_n.rot);else{var un=hn*hn,xn=1-.5*un,dn=1-un*un/8,yn=(xn*_n.axisx+hn*_n.axisy)*dn;_n.axisy=(xn*_n.axisy-hn*_n.axisx)*dn,_n.axisx=yn}var zn=(ln+rn)*this.b2.imass;this.b2.posx+=L*zn,this.b2.posy+=V*zn;var vn=this.b2,cn=this.b2.iinertia*(J*ln+H*rn);if(vn.rot+=cn,cn*cn>1e-4)vn.axisx=Math.sin(vn.rot),vn.axisy=Math.cos(vn.rot);else{var fn=cn*cn,mn=1-.5*fn,bn=1-fn*fn/8,gn=(mn*vn.axisx+cn*vn.axisy)*bn;vn.axisy=(mn*vn.axisy-cn*vn.axisx)*bn,vn.axisx=gn}break}if(rn=0,(ln=-tn/Q)>=0&&nn*ln+pn>=0){var wn=(ln+rn)*this.b1.imass;this.b1.posx-=L*wn,this.b1.posy-=V*wn;var Mn=this.b1,Cn=-this.b1.iinertia*(Y*ln+X*rn);if(Mn.rot+=Cn,Cn*Cn>1e-4)Mn.axisx=Math.sin(Mn.rot),Mn.axisy=Math.cos(Mn.rot);else{var kn=Cn*Cn,On=1-.5*kn,Pn=1-kn*kn/8,Sn=(On*Mn.axisx+Cn*Mn.axisy)*Pn;Mn.axisy=(On*Mn.axisy-Cn*Mn.axisx)*Pn,Mn.axisx=Sn}var An=(ln+rn)*this.b2.imass;this.b2.posx+=L*An,this.b2.posy+=V*An;var jn=this.b2,En=this.b2.iinertia*(J*ln+H*rn);if(jn.rot+=En,En*En>1e-4)jn.axisx=Math.sin(jn.rot),jn.axisy=Math.cos(jn.rot);else{var In=En*En,Tn=1-.5*In,Nn=1-In*In/8,Ln=(Tn*jn.axisx+En*jn.axisy)*Nn;jn.axisy=(Tn*jn.axisy-En*jn.axisx)*Nn,jn.axisx=Ln}break}if(ln=0,(rn=-pn/en)>=0&&nn*rn+tn>=0){var Vn=(ln+rn)*this.b1.imass;this.b1.posx-=L*Vn,this.b1.posy-=V*Vn;var Dn=this.b1,Fn=-this.b1.iinertia*(Y*ln+X*rn);if(Dn.rot+=Fn,Fn*Fn>1e-4)Dn.axisx=Math.sin(Dn.rot),Dn.axisy=Math.cos(Dn.rot);else{var Rn=Fn*Fn,Zn=1-.5*Rn,Bn=1-Rn*Rn/8,Gn=(Zn*Dn.axisx+Fn*Dn.axisy)*Bn;Dn.axisy=(Zn*Dn.axisy-Fn*Dn.axisx)*Bn,Dn.axisx=Gn}var qn=(ln+rn)*this.b2.imass;this.b2.posx+=L*qn,this.b2.posy+=V*qn;var Un=this.b2,Kn=this.b2.iinertia*(J*ln+H*rn);if(Un.rot+=Kn,Kn*Kn>1e-4)Un.axisx=Math.sin(Un.rot),Un.axisy=Math.cos(Un.rot);else{var Wn=Kn*Kn,Yn=1-.5*Wn,Jn=1-Wn*Wn/8,Xn=(Yn*Un.axisx+Kn*Un.axisy)*Jn;Un.axisy=(Yn*Un.axisy-Kn*Un.axisx)*Jn,Un.axisx=Xn}break}break}}else{var Hn=V*q-L*U,$n=V*K-L*W,Qn=this.b2.smass+$n*$n*this.b2.sinertia+this.b1.smass+Hn*Hn*this.b1.sinertia;if(0!=Qn){var ne,ee,te=-this.biasCoef*B/Qn;ne=L*te,ee=V*te;var ie=this.b1.imass;this.b1.posx-=ne*ie,this.b1.posy-=ee*ie;var pe=this.b1,le=-Hn*this.b1.iinertia*te;if(pe.rot+=le,le*le>1e-4)pe.axisx=Math.sin(pe.rot),pe.axisy=Math.cos(pe.rot);else{var re=le*le,oe=1-.5*re,ae=1-re*re/8,se=(oe*pe.axisx+le*pe.axisy)*ae;pe.axisy=(oe*pe.axisy-le*pe.axisx)*ae,pe.axisx=se}var _e=this.b2.imass;this.b2.posx+=ne*_e,this.b2.posy+=ee*_e;var he=this.b2,ue=$n*this.b2.iinertia*te;if(he.rot+=ue,ue*ue>1e-4)he.axisx=Math.sin(he.rot),he.axisy=Math.cos(he.rot);else{var xe=ue*ue,de=1-.5*xe,ye=1-xe*xe/8,ze=(de*he.axisx+ue*he.axisy)*ye;he.axisy=(de*he.axisy-ue*he.axisx)*ye,he.axisx=ze}}}}}},Pe.prototype.__class__=Pe;var Se=zpp_nape.dynamics.ZPP_Contact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.elasticity=0,this.dist=0,this.fresh=!1,this.hash=0,this.stamp=0,this.posOnly=!1,this.active=!1,this.inner=null,this.arbiter=null,this.wrap_position=null,this.py=0,this.px=0,this.outer=null,this.inner=new Ae};Se.__name__=["zpp_nape","dynamics","ZPP_Contact"],Se.prototype.outer=null,Se.prototype.wrapper=function(){return null==this.outer&&(Se.internal=!0,this.outer=new q,Se.internal=!1,this.outer.zpp_inner=this),this.outer},Se.prototype.px=null,Se.prototype.py=null,Se.prototype.position_validate=function(){this.wrap_position.zpp_inner.x=this.px,this.wrap_position.zpp_inner.y=this.py},Se.prototype.wrap_position=null,Se.prototype.getposition=function(){var n;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var t;null==xt.zpp_pool?t=new xt:(t=xt.zpp_pool,xt.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!1,t.x=0,t.y=0,n.zpp_inner=t,n.zpp_inner.outer=n}else{var i,p=n.zpp_inner;if(null!=p._validate&&p._validate(),0==n.zpp_inner.x){var l=n.zpp_inner;null!=l._validate&&l._validate(),i=0==n.zpp_inner.y}else i=!1;if(!i){n.zpp_inner.x=0,n.zpp_inner.y=0;var r=n.zpp_inner;null!=r._invalidate&&r._invalidate(r)}}n.zpp_inner.weak=!1,this.wrap_position=n,this.wrap_position.zpp_inner._inuse=!0,this.wrap_position.zpp_inner._immutable=!0,this.wrap_position.zpp_inner._validate=e(this,this.position_validate)},Se.prototype.inactiveme=function(){return!(this.active&&null!=this.arbiter&&this.arbiter.active)},Se.prototype.arbiter=null,Se.prototype.inner=null,Se.prototype.active=null,Se.prototype.posOnly=null,Se.prototype.stamp=null,Se.prototype.hash=null,Se.prototype.fresh=null,Se.prototype.dist=null,Se.prototype.elasticity=null,Se.prototype.free=function(){this.arbiter=null},Se.prototype.alloc=function(){},Se.prototype.next=null,Se.prototype.elem=function(){return this},Se.prototype.begin=function(){return this.next},Se.prototype._inuse=null,Se.prototype.modified=null,Se.prototype.pushmod=null,Se.prototype.length=null,Se.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Se.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Se.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Se.prototype.addAll=function(n){for(var e=n.next;null!=e;)this.add(e),e=e.next},Se.prototype.insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Se.prototype.inlined_insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Se.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Se.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Se.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Se.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Se.prototype.remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Se.prototype.try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Se.prototype.inlined_remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Se.prototype.inlined_try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var p,l;null==e?(l=(p=this.next).next,this.next=l,null==this.next&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0)),p._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Se.prototype.erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},Se.prototype.inlined_erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},Se.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Se.prototype.clear=function(){},Se.prototype.inlined_clear=function(){},Se.prototype.reverse=function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Se.prototype.empty=function(){return null==this.next},Se.prototype.size=function(){return this.length},Se.prototype.has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},Se.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},Se.prototype.front=function(){return this.next},Se.prototype.back=function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},Se.prototype.iterator_at=function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},Se.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e:null},Se.prototype.__class__=Se;var Ae=zpp_nape.dynamics.ZPP_IContact=function(){this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.lr2y=0,this.lr2x=0,this.lr1y=0,this.lr1x=0,this.jtAcc=0,this.jnAcc=0,this.friction=0,this.bounce=0,this.tMass=0,this.nMass=0,this.r2y=0,this.r2x=0,this.r1y=0,this.r1x=0};Ae.__name__=["zpp_nape","dynamics","ZPP_IContact"],Ae.prototype.r1x=null,Ae.prototype.r1y=null,Ae.prototype.r2x=null,Ae.prototype.r2y=null,Ae.prototype.nMass=null,Ae.prototype.tMass=null,Ae.prototype.bounce=null,Ae.prototype.friction=null,Ae.prototype.jnAcc=null,Ae.prototype.jtAcc=null,Ae.prototype.lr1x=null,Ae.prototype.lr1y=null,Ae.prototype.lr2x=null,Ae.prototype.lr2y=null,Ae.prototype.next=null,Ae.prototype.elem=function(){return this},Ae.prototype.begin=function(){return this.next},Ae.prototype._inuse=null,Ae.prototype.modified=null,Ae.prototype.pushmod=null,Ae.prototype.length=null,Ae.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Ae.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Ae.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Ae.prototype.addAll=function(n){for(var e=n.next;null!=e;)this.add(e),e=e.next},Ae.prototype.insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ae.prototype.inlined_insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Ae.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Ae.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Ae.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Ae.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Ae.prototype.remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ae.prototype.try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Ae.prototype.inlined_remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ae.prototype.inlined_try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var p,l;null==e?(l=(p=this.next).next,this.next=l,null==this.next&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0)),p._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Ae.prototype.erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},Ae.prototype.inlined_erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},Ae.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Ae.prototype.clear=function(){},Ae.prototype.inlined_clear=function(){},Ae.prototype.reverse=function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Ae.prototype.empty=function(){return null==this.next},Ae.prototype.size=function(){return this.length},Ae.prototype.has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},Ae.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},Ae.prototype.front=function(){return this.next},Ae.prototype.back=function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},Ae.prototype.iterator_at=function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},Ae.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e:null},Ae.prototype.__class__=Ae;var je=zpp_nape.dynamics.ZPP_InteractionFilter=function(){this.fluidMask=0,this.fluidGroup=0,this.sensorMask=0,this.sensorGroup=0,this.collisionMask=0,this.collisionGroup=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new Gt,this.collisionGroup=this.sensorGroup=this.fluidGroup=1,this.collisionMask=this.sensorMask=this.fluidMask=-1};je.__name__=["zpp_nape","dynamics","ZPP_InteractionFilter"],je.prototype.next=null,je.prototype.userData=null,je.prototype.outer=null,je.prototype.wrapper=function(){if(null==this.outer){this.outer=new Y;var n=this.outer.zpp_inner;n.outer=null,n.next=je.zpp_pool,je.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},je.prototype.free=function(){this.outer=null},je.prototype.alloc=function(){},je.prototype.shapes=null,je.prototype.wrap_shapes=null,je.prototype.feature_cons=function(){this.shapes=new Gt},je.prototype.addShape=function(n){this.shapes.add(n)},je.prototype.remShape=function(n){this.shapes.remove(n)},je.prototype.copy=function(){var n;return null==je.zpp_pool?n=new je:(n=je.zpp_pool,je.zpp_pool=n.next,n.next=null),n.collisionGroup=this.collisionGroup,n.collisionMask=this.collisionMask,n.sensorGroup=this.sensorGroup,n.sensorMask=this.sensorMask,n.fluidGroup=this.fluidGroup,n.fluidMask=this.fluidMask,n},je.prototype.collisionGroup=null,je.prototype.collisionMask=null,je.prototype.shouldCollide=function(n){return 0!=(this.collisionMask&n.collisionGroup)&&0!=(n.collisionMask&this.collisionGroup)},je.prototype.sensorGroup=null,je.prototype.sensorMask=null,je.prototype.shouldSense=function(n){return 0!=(this.sensorMask&n.sensorGroup)&&0!=(n.sensorMask&this.sensorGroup)},je.prototype.fluidGroup=null,je.prototype.fluidMask=null,je.prototype.shouldFlow=function(n){return 0!=(this.fluidMask&n.fluidGroup)&&0!=(n.fluidMask&this.fluidGroup)},je.prototype.invalidate=function(){for(var n=this.shapes.head;null!=n;)n.elt.invalidate_filter(),n=n.next},je.prototype.__class__=je;var Ee=zpp_nape.dynamics.ZPP_InteractionGroup=function(){this.depth=0,this.wrap_interactors=null,this.interactors=null,this.wrap_groups=null,this.groups=null,this.group=null,this.ignore=!1,this.outer=null,this.depth=0,this.groups=new _i,this.interactors=new pe};Ee.__name__=["zpp_nape","dynamics","ZPP_InteractionGroup"],Ee.prototype.outer=null,Ee.prototype.ignore=null,Ee.prototype.group=null,Ee.prototype.setGroup=function(n){this.group!=n&&(null!=this.group&&(this.group.groups.remove(this),this.depth=0,this.group.invalidate(!0)),this.group=n,null!=n?(n.groups.add(this),this.depth=n.depth+1,n.invalidate(!0)):this.invalidate(!0))},Ee.prototype.groups=null,Ee.prototype.wrap_groups=null,Ee.prototype.interactors=null,Ee.prototype.wrap_interactors=null,Ee.prototype.depth=null,Ee.prototype.invalidate=function(n){if(null==n&&(n=!1),n||this.ignore){for(var e=this.interactors.head;null!=e;){var t=e.elt;null!=t.ibody?t.ibody.wake():null!=t.ishape?t.ishape.body.wake():t.icompound.wake(),e=e.next}for(var i=this.groups.head;null!=i;)i.elt.invalidate(n),i=i.next}},Ee.prototype.addGroup=function(n){this.groups.add(n),n.depth=this.depth+1},Ee.prototype.remGroup=function(n){this.groups.remove(n),n.depth=0},Ee.prototype.addInteractor=function(n){this.interactors.add(n)},Ee.prototype.remInteractor=function(n,e){null==e&&(e=-1),this.interactors.remove(n)},Ee.prototype.__class__=Ee;var Ie=zpp_nape.dynamics.ZPP_SpaceArbiterList=function(){this.at_index_3=0,this.at_index_2=0,this.at_index_1=0,this.at_index_0=0,this.ite_3=null,this.ite_2=null,this.ite_1=null,this.ite_0=null,this.lengths=null,this.zip_length=!1,this._length=0,this.space=null,Z.call(this),this.at_index_0=0,this.at_index_1=0,this.at_index_2=0,this.at_index_3=0,this.zip_length=!0,this._length=0,this.lengths=[];for(var n=0;n<4;)++n,this.lengths.push(0)};Ie.__name__=["zpp_nape","dynamics","ZPP_SpaceArbiterList"],Ie.__super__=Z,Ie.prototype=Object.create(Z.prototype),Ie.prototype.space=null,Ie.prototype._length=null,Ie.prototype.zip_length=null,Ie.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=0,e=this.space.c_arbiters_true.head;null!=e;)e.elt.active&&++n,e=e.next;this.lengths[0]=n,this._length+=n;for(var t=0,i=this.space.c_arbiters_false.head;null!=i;)i.elt.active&&++t,i=i.next;this.lengths[1]=t,this._length+=t;for(var p=0,l=this.space.f_arbiters.head;null!=l;)l.elt.active&&++p,l=l.next;this.lengths[2]=p,this._length+=p;for(var r=0,o=this.space.s_arbiters.head;null!=o;)o.elt.active&&++r,o=o.next;this.lengths[3]=r,this._length+=r,this.zip_length=!1}return this._length},Ie.prototype.lengths=null,Ie.prototype.ite_0=null,Ie.prototype.ite_1=null,Ie.prototype.ite_2=null,Ie.prototype.ite_3=null,Ie.prototype.at_index_0=null,Ie.prototype.at_index_1=null,Ie.prototype.at_index_2=null,Ie.prototype.at_index_3=null,Ie.prototype.zpp_vm=function(){var n=!1;this.space.c_arbiters_true.modified&&(n=!0,this.space.c_arbiters_true.modified=!1),this.space.c_arbiters_false.modified&&(n=!0,this.space.c_arbiters_false.modified=!1),this.space.f_arbiters.modified&&(n=!0,this.space.f_arbiters.modified=!1),this.space.s_arbiters.modified&&(n=!0,this.space.s_arbiters.modified=!1),n&&(this.zip_length=!0,this._length=0,this.ite_0=null,this.ite_1=null,this.ite_2=null,this.ite_3=null)},Ie.prototype.push=function(n){return!1},Ie.prototype.pop=function(){return null},Ie.prototype.unshift=function(n){return!1},Ie.prototype.shift=function(){return null},Ie.prototype.remove=function(n){return!1},Ie.prototype.clear=function(){},Ie.prototype.at=function(n){this.zpp_vm();var e=null,t=0;if(null==e)if(n<this.lengths[0]){var i=n;if(i<this.at_index_0||null==this.ite_0)for(this.at_index_0=0,this.ite_0=this.space.c_arbiters_true.head;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;for(;this.at_index_0!=i;)for(this.at_index_0++,this.ite_0=this.ite_0.next;!this.ite_0.elt.active;)this.ite_0=this.ite_0.next;e=this.ite_0.elt.wrapper()}else t=this.lengths[0];if(null==e)if(n<t+this.lengths[1]){var p=n-t;if(p<this.at_index_1||null==this.ite_1)for(this.at_index_1=0,this.ite_1=this.space.c_arbiters_false.head;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;for(;this.at_index_1!=p;)for(this.at_index_1++,this.ite_1=this.ite_1.next;!this.ite_1.elt.active;)this.ite_1=this.ite_1.next;e=this.ite_1.elt.wrapper()}else t+=this.lengths[1];if(null==e)if(n<t+this.lengths[2]){var l=n-t;if(l<this.at_index_2||null==this.ite_2)for(this.at_index_2=0,this.ite_2=this.space.f_arbiters.head;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;for(;this.at_index_2!=l;)for(this.at_index_2++,this.ite_2=this.ite_2.next;!this.ite_2.elt.active;)this.ite_2=this.ite_2.next;e=this.ite_2.elt.wrapper()}else t+=this.lengths[2];if(null==e)if(n<t+this.lengths[3]){var r=n-t;if(r<this.at_index_3||null==this.ite_3)for(this.at_index_3=0,this.ite_3=this.space.s_arbiters.head;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;for(;this.at_index_3!=r;)for(this.at_index_3++,this.ite_3=this.ite_3.next;!this.ite_3.elt.active;)this.ite_3=this.ite_3.next;e=this.ite_3.elt.wrapper()}else t+=this.lengths[3];return e},Ie.prototype.__class__=Ie;var Te=zpp_nape.geom.ZPP_AABB=function(){this.wrap_max=null,this.maxy=0,this.maxx=0,this.wrap_min=null,this.miny=0,this.minx=0,this.next=null,this.outer=null,this._immutable=!1,this._validate=null,this._invalidate=null};Te.__name__=["zpp_nape","geom","ZPP_AABB"],Te.get=function(n,e,t,i){var p;return null==Te.zpp_pool?p=new Te:(p=Te.zpp_pool,Te.zpp_pool=p.next,p.next=null),p.minx=n,p.miny=e,p.maxx=t,p.maxy=i,p},Te.prototype._invalidate=null,Te.prototype._validate=null,Te.prototype._immutable=null,Te.prototype.validate=function(){null!=this._validate&&this._validate()},Te.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},Te.prototype.outer=null,Te.prototype.wrapper=function(){if(null==this.outer){this.outer=new $;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Te.zpp_pool,Te.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},Te.prototype.next=null,Te.prototype.alloc=function(){},Te.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this.wrap_min=this.wrap_max=null,this._invalidate=null,this._validate=null},Te.prototype.copy=function(){var n,e=this.minx,t=this.miny,i=this.maxx,p=this.maxy;return null==Te.zpp_pool?n=new Te:(n=Te.zpp_pool,Te.zpp_pool=n.next,n.next=null),n.minx=e,n.miny=t,n.maxx=i,n.maxy=p,n},Te.prototype.width=function(){return this.maxx-this.minx},Te.prototype.height=function(){return this.maxy-this.miny},Te.prototype.perimeter=function(){return 2*(this.maxx-this.minx+(this.maxy-this.miny))},Te.prototype.minx=null,Te.prototype.miny=null,Te.prototype.wrap_min=null,Te.prototype.getmin=function(){if(null==this.wrap_min){var n,t=this.minx,i=this.miny;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_min=n,this.wrap_min.zpp_inner._inuse=!0,this._immutable?this.wrap_min.zpp_inner._immutable=!0:this.wrap_min.zpp_inner._invalidate=e(this,this.mod_min),this.wrap_min.zpp_inner._validate=e(this,this.dom_min)}return this.wrap_min},Te.prototype.dom_min=function(){null!=this._validate&&this._validate(),this.wrap_min.zpp_inner.x=this.minx,this.wrap_min.zpp_inner.y=this.miny},Te.prototype.mod_min=function(n){n.x==this.minx&&n.y==this.miny||(this.minx=n.x,this.miny=n.y,null!=this._invalidate&&this._invalidate(this))},Te.prototype.maxx=null,Te.prototype.maxy=null,Te.prototype.wrap_max=null,Te.prototype.getmax=function(){if(null==this.wrap_max){var n,t=this.maxx,i=this.maxy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_max=n,this.wrap_max.zpp_inner._inuse=!0,this._immutable?this.wrap_max.zpp_inner._immutable=!0:this.wrap_max.zpp_inner._invalidate=e(this,this.mod_max),this.wrap_max.zpp_inner._validate=e(this,this.dom_max)}return this.wrap_max},Te.prototype.dom_max=function(){null!=this._validate&&this._validate(),this.wrap_max.zpp_inner.x=this.maxx,this.wrap_max.zpp_inner.y=this.maxy},Te.prototype.mod_max=function(n){n.x==this.maxx&&n.y==this.maxy||(this.maxx=n.x,this.maxy=n.y,null!=this._invalidate&&this._invalidate(this))},Te.prototype.intersectX=function(n){return!(n.minx>this.maxx||this.minx>n.maxx)},Te.prototype.intersectY=function(n){return!(n.miny>this.maxy||this.miny>n.maxy)},Te.prototype.intersect=function(n){return n.miny<=this.maxy&&this.miny<=n.maxy&&n.minx<=this.maxx&&this.minx<=n.maxx},Te.prototype.combine=function(n){n.minx<this.minx&&(this.minx=n.minx),n.maxx>this.maxx&&(this.maxx=n.maxx),n.miny<this.miny&&(this.miny=n.miny),n.maxy>this.maxy&&(this.maxy=n.maxy)},Te.prototype.contains=function(n){return n.minx>=this.minx&&n.miny>=this.miny&&n.maxx<=this.maxx&&n.maxy<=this.maxy},Te.prototype.containsPoint=function(n){return n.x>=this.minx&&n.x<=this.maxx&&n.y>=this.miny&&n.y<=this.maxy},Te.prototype.setCombine=function(n,e){this.minx=n.minx<e.minx?n.minx:e.minx,this.miny=n.miny<e.miny?n.miny:e.miny,this.maxx=n.maxx>e.maxx?n.maxx:e.maxx,this.maxy=n.maxy>e.maxy?n.maxy:e.maxy},Te.prototype.setExpand=function(n,e){this.minx=n.minx-e,this.miny=n.miny-e,this.maxx=n.maxx+e,this.maxy=n.maxy+e},Te.prototype.setExpandPoint=function(n,e){n<this.minx&&(this.minx=n),n>this.maxx&&(this.maxx=n),e<this.miny&&(this.miny=e),e>this.maxy&&(this.maxy=e)},Te.prototype.toString=function(){return"{ x: "+this.minx+" y: "+this.miny+" w: "+(this.maxx-this.minx)+" h: "+(this.maxy-this.miny)+" }"},Te.prototype.__class__=Te;var Ne=zpp_nape.util.ZNPList_ZPP_Vec2=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ne.__name__=["zpp_nape","util","ZNPList_ZPP_Vec2"],Ne.prototype.head=null,Ne.prototype.begin=function(){return this.head},Ne.prototype.modified=null,Ne.prototype.pushmod=null,Ne.prototype.length=null,Ne.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ne.prototype.add=function(n){var e;null==Li.zpp_pool?e=new Li:(e=Li.zpp_pool,Li.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ne.prototype.inlined_add=function(n){var e;null==Li.zpp_pool?e=new Li:(e=Li.zpp_pool,Li.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ne.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Ne.prototype.insert=function(n,e){var t;null==Li.zpp_pool?t=new Li:(t=Li.zpp_pool,Li.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ne.prototype.inlined_insert=function(n,e){var t;null==Li.zpp_pool?t=new Li:(t=Li.zpp_pool,Li.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ne.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Li.zpp_pool,Li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ne.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Li.zpp_pool,Li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ne.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ne.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ne.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Li.zpp_pool,Li.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ne.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Ne.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Li.zpp_pool,Li.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ne.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Li.zpp_pool,Li.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Ne.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Li.zpp_pool,Li.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Ne.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Li.zpp_pool,Li.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Ne.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Ne.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Li.zpp_pool,Li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ne.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Li.zpp_pool,Li.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ne.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Ne.prototype.empty=function(){return null==this.head},Ne.prototype.size=function(){return this.length},Ne.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Ne.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Ne.prototype.front=function(){return this.head.elt},Ne.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Ne.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Ne.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Ne.prototype.__class__=Ne;var Le=zpp_nape.geom.ZPP_Collide=function(){};Le.__name__=["zpp_nape","geom","ZPP_Collide"],Le.circleContains=function(n,e){var t,i;return(t=e.x-n.worldCOMx)*t+(i=e.y-n.worldCOMy)*i<n.radius*n.radius},Le.polyContains=function(n,e){var t;t=!0;for(var i=n.edges.head;null!=i;){var p=i.elt;if(!(p.gnormx*e.x+p.gnormy*e.y<=p.gprojection)){t=!1;break}i=i.next}return t},Le.shapeContains=function(n,e){return 0==n.type?Le.circleContains(n.circle,e):Le.polyContains(n.polygon,e)},Le.bodyContains=function(n,e){var t;t=!1;for(var i=n.shapes.head;null!=i;){if(Le.shapeContains(i.elt,e)){t=!0;break}i=i.next}return t},Le.containTest=function(n,e){var t=n.aabb,i=e.aabb;if(i.minx>=t.minx&&i.miny>=t.miny&&i.maxx<=t.maxx&&i.maxy<=t.maxy){if(0==n.type){if(0==e.type){var p,l,r=n.circle.radius+-e.circle.radius;return(p=e.circle.worldCOMx-n.circle.worldCOMx)*p+(l=e.circle.worldCOMy-n.circle.worldCOMy)*l<=r*r}var o;o=!0;for(var a=e.polygon.gverts.next;null!=a;){var s,_,h=a,u=n.circle.radius;if(!((s=h.x-n.circle.worldCOMx)*s+(_=h.y-n.circle.worldCOMy)*_<=u*u)){o=!1;break}a=a.next}return o}if(0==e.type){var x;x=!0;for(var d=n.polygon.edges.head;null!=d;){var y=d.elt;if(!(y.gnormx*e.circle.worldCOMx+y.gnormy*e.circle.worldCOMy+e.circle.radius<=y.gprojection)){x=!1;break}d=d.next}return x}var z;z=!0;for(var v=n.polygon.edges.head;null!=v;){for(var c=v.elt,f=-1e100,m=e.polygon.gverts.next;null!=m;){var b=m,g=c.gnormx*b.x+c.gnormy*b.y;g>f&&(f=g),m=m.next}if(!(f<=c.gprojection)){z=!1;break}v=v.next}return z}return!1},Le.contactCollide=function(n,e,t,i){if(1==e.type){if(1==n.type){for(var p=!0,l=-1e100,r=-1,a=null,s=null,_=n.polygon.edges.head;null!=_;){for(var h=_.elt,u=1e100,x=e.polygon.gverts.next;null!=x;){var d=x,y=h.gnormx*d.x+h.gnormy*d.y;if(y<u&&(u=y),u-h.gprojection<=l)break;x=x.next}if((u-=h.gprojection)>=0){p=!1;break}u>l&&(l=u,a=h,r=1),_=_.next}if(p){for(var z=e.polygon.edges.head;null!=z;){for(var v=z.elt,c=1e100,f=n.polygon.gverts.next;null!=f;){var m=f,b=v.gnormx*m.x+v.gnormy*m.y;if(b<c&&(c=b),c-v.gprojection<=l)break;f=f.next}if((c-=v.gprojection)>=0){p=!1;break}c>l&&(l=c,s=v,r=2),z=z.next}if(p){var g,w,M;1==r?(g=e.polygon,w=a,M=1):(g=n.polygon,w=s,M=-1);for(var C=null,k=1e100,O=g.edges.head;null!=O;){var P=O.elt,S=w.gnormx*P.gnormx+w.gnormy*P.gnormy;S<k&&(k=S,C=P),O=O.next}var A=0,j=0;A=C.gp0.x,j=C.gp0.y;var E,I,T=0,N=0;E=(T=C.gp1.x)-A,I=(N=C.gp1.y)-j;var L=w.gnormy*A-w.gnormx*j,V=w.gnormy*T-w.gnormx*N,D=1/(V-L),F=(-w.tp1-L)*D;F>o.epsilon&&(A+=E*F,j+=I*F);var R=(-w.tp0-V)*D;R<-o.epsilon&&(T+=E*R,N+=I*R);var Z=0,B=0,G=M;Z=w.gnormx*G,B=w.gnormy*G,t.lnormx=w.lnormx,t.lnormy=w.lnormy,t.lproj=w.lprojection,t.radius=0,t.rev=i!=(-1==M),t.ptype=t.rev?1:0;var q=A*w.gnormx+j*w.gnormy-w.gprojection,U=T*w.gnormx+N*w.gnormy-w.gprojection;if(q>0&&U>0)return!1;i&&(Z=-Z,B=-B);for(var K=A-w.gnormx*q*.5,W=j-w.gnormy*q*.5,Y=t.rev?1:0,J=null,X=t.contacts.next;null!=X;){var H=X;if(Y==H.hash){J=H;break}X=X.next}if(null==J){null==Se.zpp_pool?J=new Se:(J=Se.zpp_pool,Se.zpp_pool=J.next,J.next=null);var $=J.inner;$.jnAcc=$.jtAcc=0,J.hash=Y,J.fresh=!0,J.arbiter=t,t.jrAcc=0;var Q=t.contacts;J._inuse=!0;var nn=J;nn.next=Q.next,Q.next=nn,Q.modified=!0,Q.length++,t.innards.add($)}else J.fresh=!1;J.px=K,J.py=W,t.nx=Z,t.ny=B,J.dist=q,J.stamp=t.stamp,J.posOnly=q>0;var en=J;A-=g.body.posx,j-=g.body.posy,en.inner.lr1x=A*g.body.axisy+j*g.body.axisx,en.inner.lr1y=j*g.body.axisy-A*g.body.axisx;for(var tn=T-w.gnormx*U*.5,pn=N-w.gnormy*U*.5,ln=t.rev?0:1,rn=null,on=t.contacts.next;null!=on;){var an=on;if(ln==an.hash){rn=an;break}on=on.next}if(null==rn){null==Se.zpp_pool?rn=new Se:(rn=Se.zpp_pool,Se.zpp_pool=rn.next,rn.next=null);var sn=rn.inner;sn.jnAcc=sn.jtAcc=0,rn.hash=ln,rn.fresh=!0,rn.arbiter=t,t.jrAcc=0;var _n=t.contacts;rn._inuse=!0;var hn=rn;hn.next=_n.next,_n.next=hn,_n.modified=!0,_n.length++,t.innards.add(sn)}else rn.fresh=!1;return rn.px=tn,rn.py=pn,t.nx=Z,t.ny=B,rn.dist=U,rn.stamp=t.stamp,rn.posOnly=U>0,en=rn,T-=g.body.posx,N-=g.body.posy,en.inner.lr1x=T*g.body.axisy+N*g.body.axisx,en.inner.lr1y=N*g.body.axisy-T*g.body.axisx,1==r?(t.__ref_edge1=w,t.__ref_edge2=C):(t.__ref_edge2=w,t.__ref_edge1=C),!0}return!1}return!1}for(var un=-1e100,xn=!0,dn=null,yn=null,zn=e.polygon.gverts.next,vn=e.polygon.edges.head;null!=vn;){var cn=vn.elt,fn=cn.gnormx*n.circle.worldCOMx+cn.gnormy*n.circle.worldCOMy-cn.gprojection-n.circle.radius;if(fn>0){xn=!1;break}fn>un&&(un=fn,dn=cn,yn=zn),zn=zn.next,vn=vn.next}if(xn){var mn=yn,bn=null==yn.next?e.polygon.gverts.next:yn.next,gn=n.circle.worldCOMy*dn.gnormx-n.circle.worldCOMx*dn.gnormy;if(gn<=mn.y*dn.gnormx-mn.x*dn.gnormy){var wn,Mn,Cn,kn=n.circle.radius,On=(wn=mn.x-n.circle.worldCOMx)*wn+(Mn=mn.y-n.circle.worldCOMy)*Mn;if(On>kn*kn)Cn=null;else if(On<o.epsilon*o.epsilon){for(var Pn=n.circle.worldCOMx,Sn=n.circle.worldCOMy,An=null,jn=t.contacts.next;null!=jn;){var En=jn;if(0==En.hash){An=En;break}jn=jn.next}if(null==An){null==Se.zpp_pool?An=new Se:(An=Se.zpp_pool,Se.zpp_pool=An.next,An.next=null);var In=An.inner;In.jnAcc=In.jtAcc=0,An.hash=0,An.fresh=!0,An.arbiter=t,t.jrAcc=0;var Tn=t.contacts;An._inuse=!0;var Nn=An;Nn.next=Tn.next,Tn.next=Nn,Tn.modified=!0,Tn.length++,t.innards.add(In)}else An.fresh=!1;An.px=Pn,An.py=Sn,t.nx=1,t.ny=0,An.dist=-kn,An.stamp=t.stamp,An.posOnly=!1,Cn=An}else{var Ln=1/Math.sqrt(On),Vn=Ln<o.epsilon?1e100:1/Ln,Dn=.5+(n.circle.radius-.5*kn)*Ln;if(i){for(var Fn=n.circle.worldCOMx+wn*Dn,Rn=n.circle.worldCOMy+Mn*Dn,Zn=null,Bn=t.contacts.next;null!=Bn;){var Gn=Bn;if(0==Gn.hash){Zn=Gn;break}Bn=Bn.next}if(null==Zn){null==Se.zpp_pool?Zn=new Se:(Zn=Se.zpp_pool,Se.zpp_pool=Zn.next,Zn.next=null);var qn=Zn.inner;qn.jnAcc=qn.jtAcc=0,Zn.hash=0,Zn.fresh=!0,Zn.arbiter=t,t.jrAcc=0;var Un=t.contacts;Zn._inuse=!0;var Kn=Zn;Kn.next=Un.next,Un.next=Kn,Un.modified=!0,Un.length++,t.innards.add(qn)}else Zn.fresh=!1;Zn.px=Fn,Zn.py=Rn,t.nx=-wn*Ln,t.ny=-Mn*Ln,Zn.dist=Vn-kn,Zn.stamp=t.stamp,Zn.posOnly=!1,Cn=Zn}else{for(var Wn=n.circle.worldCOMx+wn*Dn,Yn=n.circle.worldCOMy+Mn*Dn,Jn=null,Xn=t.contacts.next;null!=Xn;){var Hn=Xn;if(0==Hn.hash){Jn=Hn;break}Xn=Xn.next}if(null==Jn){null==Se.zpp_pool?Jn=new Se:(Jn=Se.zpp_pool,Se.zpp_pool=Jn.next,Jn.next=null);var $n=Jn.inner;$n.jnAcc=$n.jtAcc=0,Jn.hash=0,Jn.fresh=!0,Jn.arbiter=t,t.jrAcc=0;var Qn=t.contacts;Jn._inuse=!0;var ne=Jn;ne.next=Qn.next,Qn.next=ne,Qn.modified=!0,Qn.length++,t.innards.add($n)}else Jn.fresh=!1;Jn.px=Wn,Jn.py=Yn,t.nx=wn*Ln,t.ny=Mn*Ln,Jn.dist=Vn-kn,Jn.stamp=t.stamp,Jn.posOnly=!1,Cn=Jn}}if(null!=Cn){var ee=Cn.inner;t.ptype=2;var te,ie;te=mn.x-e.polygon.body.posx,ie=mn.y-e.polygon.body.posy,t.__ref_edge1=dn,t.__ref_vertex=-1,i?(ee.lr1x=te*e.polygon.body.axisy+ie*e.polygon.body.axisx,ee.lr1y=ie*e.polygon.body.axisy-te*e.polygon.body.axisx,ee.lr2x=n.circle.localCOMx,ee.lr2y=n.circle.localCOMy):(ee.lr2x=te*e.polygon.body.axisy+ie*e.polygon.body.axisx,ee.lr2y=ie*e.polygon.body.axisy-te*e.polygon.body.axisx,ee.lr1x=n.circle.localCOMx,ee.lr1y=n.circle.localCOMy),t.radius=n.circle.radius}return null!=Cn}if(gn>=bn.y*dn.gnormx-bn.x*dn.gnormy){var pe,le,re,oe=n.circle.radius,ae=(pe=bn.x-n.circle.worldCOMx)*pe+(le=bn.y-n.circle.worldCOMy)*le;if(ae>oe*oe)re=null;else if(ae<o.epsilon*o.epsilon){for(var se=n.circle.worldCOMx,_e=n.circle.worldCOMy,he=null,ue=t.contacts.next;null!=ue;){var xe=ue;if(0==xe.hash){he=xe;break}ue=ue.next}if(null==he){null==Se.zpp_pool?he=new Se:(he=Se.zpp_pool,Se.zpp_pool=he.next,he.next=null);var de=he.inner;de.jnAcc=de.jtAcc=0,he.hash=0,he.fresh=!0,he.arbiter=t,t.jrAcc=0;var ye=t.contacts;he._inuse=!0;var ze=he;ze.next=ye.next,ye.next=ze,ye.modified=!0,ye.length++,t.innards.add(de)}else he.fresh=!1;he.px=se,he.py=_e,t.nx=1,t.ny=0,he.dist=-oe,he.stamp=t.stamp,he.posOnly=!1,re=he}else{var ve=1/Math.sqrt(ae),ce=ve<o.epsilon?1e100:1/ve,fe=.5+(n.circle.radius-.5*oe)*ve;if(i){for(var me=n.circle.worldCOMx+pe*fe,be=n.circle.worldCOMy+le*fe,ge=null,we=t.contacts.next;null!=we;){var Me=we;if(0==Me.hash){ge=Me;break}we=we.next}if(null==ge){null==Se.zpp_pool?ge=new Se:(ge=Se.zpp_pool,Se.zpp_pool=ge.next,ge.next=null);var Ce=ge.inner;Ce.jnAcc=Ce.jtAcc=0,ge.hash=0,ge.fresh=!0,ge.arbiter=t,t.jrAcc=0;var ke=t.contacts;ge._inuse=!0;var Oe=ge;Oe.next=ke.next,ke.next=Oe,ke.modified=!0,ke.length++,t.innards.add(Ce)}else ge.fresh=!1;ge.px=me,ge.py=be,t.nx=-pe*ve,t.ny=-le*ve,ge.dist=ce-oe,ge.stamp=t.stamp,ge.posOnly=!1,re=ge}else{for(var Pe=n.circle.worldCOMx+pe*fe,Ae=n.circle.worldCOMy+le*fe,je=null,Ee=t.contacts.next;null!=Ee;){var Ie=Ee;if(0==Ie.hash){je=Ie;break}Ee=Ee.next}if(null==je){null==Se.zpp_pool?je=new Se:(je=Se.zpp_pool,Se.zpp_pool=je.next,je.next=null);var Te=je.inner;Te.jnAcc=Te.jtAcc=0,je.hash=0,je.fresh=!0,je.arbiter=t,t.jrAcc=0;var Ne=t.contacts;je._inuse=!0;var Le=je;Le.next=Ne.next,Ne.next=Le,Ne.modified=!0,Ne.length++,t.innards.add(Te)}else je.fresh=!1;je.px=Pe,je.py=Ae,t.nx=pe*ve,t.ny=le*ve,je.dist=ce-oe,je.stamp=t.stamp,je.posOnly=!1,re=je}}if(null!=re){var Ve=re.inner;t.ptype=2;var De,Fe;De=bn.x-e.polygon.body.posx,Fe=bn.y-e.polygon.body.posy,t.__ref_edge1=dn,t.__ref_vertex=1,i?(Ve.lr1x=De*e.polygon.body.axisy+Fe*e.polygon.body.axisx,Ve.lr1y=Fe*e.polygon.body.axisy-De*e.polygon.body.axisx,Ve.lr2x=n.circle.localCOMx,Ve.lr2y=n.circle.localCOMy):(Ve.lr2x=De*e.polygon.body.axisy+Fe*e.polygon.body.axisx,Ve.lr2y=Fe*e.polygon.body.axisy-De*e.polygon.body.axisx,Ve.lr1x=n.circle.localCOMx,Ve.lr1y=n.circle.localCOMy),t.radius=n.circle.radius}return null!=re}var Re,Ze,Be=n.circle.radius+.5*un;Re=dn.gnormx*Be,Ze=dn.gnormy*Be;var Ge,qe,Ue;if(Ge=n.circle.worldCOMx-Re,qe=n.circle.worldCOMy-Ze,i){for(var Ke=dn.gnormx,We=dn.gnormy,Ye=null,Je=t.contacts.next;null!=Je;){var Xe=Je;if(0==Xe.hash){Ye=Xe;break}Je=Je.next}if(null==Ye){null==Se.zpp_pool?Ye=new Se:(Ye=Se.zpp_pool,Se.zpp_pool=Ye.next,Ye.next=null);var He=Ye.inner;He.jnAcc=He.jtAcc=0,Ye.hash=0,Ye.fresh=!0,Ye.arbiter=t,t.jrAcc=0;var $e=t.contacts;Ye._inuse=!0;var Qe=Ye;Qe.next=$e.next,$e.next=Qe,$e.modified=!0,$e.length++,t.innards.add(He)}else Ye.fresh=!1;Ye.px=Ge,Ye.py=qe,t.nx=Ke,t.ny=We,Ye.dist=un,Ye.stamp=t.stamp,Ye.posOnly=!1,Ue=Ye}else{for(var nt=-dn.gnormx,et=-dn.gnormy,tt=null,it=t.contacts.next;null!=it;){var pt=it;if(0==pt.hash){tt=pt;break}it=it.next}if(null==tt){null==Se.zpp_pool?tt=new Se:(tt=Se.zpp_pool,Se.zpp_pool=tt.next,tt.next=null);var lt=tt.inner;lt.jnAcc=lt.jtAcc=0,tt.hash=0,tt.fresh=!0,tt.arbiter=t,t.jrAcc=0;var rt=t.contacts;tt._inuse=!0;var ot=tt;ot.next=rt.next,rt.next=ot,rt.modified=!0,rt.length++,t.innards.add(lt)}else tt.fresh=!1;tt.px=Ge,tt.py=qe,t.nx=nt,t.ny=et,tt.dist=un,tt.stamp=t.stamp,tt.posOnly=!1,Ue=tt}return t.ptype=i?0:1,t.lnormx=dn.lnormx,t.lnormy=dn.lnormy,t.rev=!i,t.lproj=dn.lprojection,t.radius=n.circle.radius,Ue.inner.lr1x=n.circle.localCOMx,Ue.inner.lr1y=n.circle.localCOMy,t.__ref_edge1=dn,t.__ref_vertex=0,!0}return!1}var at,st,_t,ht=n.circle.radius+e.circle.radius,ut=(at=e.circle.worldCOMx-n.circle.worldCOMx)*at+(st=e.circle.worldCOMy-n.circle.worldCOMy)*st;if(ut>ht*ht)_t=null;else if(ut<o.epsilon*o.epsilon){for(var xt=n.circle.worldCOMx,dt=n.circle.worldCOMy,yt=null,zt=t.contacts.next;null!=zt;){var vt=zt;if(0==vt.hash){yt=vt;break}zt=zt.next}if(null==yt){null==Se.zpp_pool?yt=new Se:(yt=Se.zpp_pool,Se.zpp_pool=yt.next,yt.next=null);var ct=yt.inner;ct.jnAcc=ct.jtAcc=0,yt.hash=0,yt.fresh=!0,yt.arbiter=t,t.jrAcc=0;var ft=t.contacts;yt._inuse=!0;var mt=yt;mt.next=ft.next,ft.next=mt,ft.modified=!0,ft.length++,t.innards.add(ct)}else yt.fresh=!1;yt.px=xt,yt.py=dt,t.nx=1,t.ny=0,yt.dist=-ht,yt.stamp=t.stamp,yt.posOnly=!1,_t=yt}else{var bt=1/Math.sqrt(ut),gt=bt<o.epsilon?1e100:1/bt,wt=.5+(n.circle.radius-.5*ht)*bt;if(i){for(var Mt=n.circle.worldCOMx+at*wt,Ct=n.circle.worldCOMy+st*wt,kt=null,Ot=t.contacts.next;null!=Ot;){var Pt=Ot;if(0==Pt.hash){kt=Pt;break}Ot=Ot.next}if(null==kt){null==Se.zpp_pool?kt=new Se:(kt=Se.zpp_pool,Se.zpp_pool=kt.next,kt.next=null);var St=kt.inner;St.jnAcc=St.jtAcc=0,kt.hash=0,kt.fresh=!0,kt.arbiter=t,t.jrAcc=0;var At=t.contacts;kt._inuse=!0;var jt=kt;jt.next=At.next,At.next=jt,At.modified=!0,At.length++,t.innards.add(St)}else kt.fresh=!1;kt.px=Mt,kt.py=Ct,t.nx=-at*bt,t.ny=-st*bt,kt.dist=gt-ht,kt.stamp=t.stamp,kt.posOnly=!1,_t=kt}else{for(var Et=n.circle.worldCOMx+at*wt,It=n.circle.worldCOMy+st*wt,Tt=null,Nt=t.contacts.next;null!=Nt;){var Lt=Nt;if(0==Lt.hash){Tt=Lt;break}Nt=Nt.next}if(null==Tt){null==Se.zpp_pool?Tt=new Se:(Tt=Se.zpp_pool,Se.zpp_pool=Tt.next,Tt.next=null);var Vt=Tt.inner;Vt.jnAcc=Vt.jtAcc=0,Tt.hash=0,Tt.fresh=!0,Tt.arbiter=t,t.jrAcc=0;var Dt=t.contacts;Tt._inuse=!0;var Ft=Tt;Ft.next=Dt.next,Dt.next=Ft,Dt.modified=!0,Dt.length++,t.innards.add(Vt)}else Tt.fresh=!1;Tt.px=Et,Tt.py=It,t.nx=at*bt,t.ny=st*bt,Tt.dist=gt-ht,Tt.stamp=t.stamp,Tt.posOnly=!1,_t=Tt}}if(null!=_t){var Rt=_t.inner;return i?(Rt.lr1x=e.circle.localCOMx,Rt.lr1y=e.circle.localCOMy,Rt.lr2x=n.circle.localCOMx,Rt.lr2y=n.circle.localCOMy):(Rt.lr1x=n.circle.localCOMx,Rt.lr1y=n.circle.localCOMy,Rt.lr2x=e.circle.localCOMx,Rt.lr2y=e.circle.localCOMy),t.radius=n.circle.radius+e.circle.radius,t.ptype=2,!0}return!1},Le.testCollide_safe=function(n,e){if(0==e.type){var t=n;n=e,e=t}return Le.testCollide(n,e)},Le.testCollide=function(n,e){if(1==e.type){if(1==n.type){for(var t=!0,i=n.polygon.edges.head;null!=i;){for(var p=i.elt,l=1e100,r=e.polygon.gverts.next;null!=r;){var o=r,a=p.gnormx*o.x+p.gnormy*o.y;a<l&&(l=a),r=r.next}if((l-=p.gprojection)>0){t=!1;break}i=i.next}if(t){for(var s=e.polygon.edges.head;null!=s;){for(var _=s.elt,h=1e100,u=n.polygon.gverts.next;null!=u;){var x=u,d=_.gnormx*x.x+_.gnormy*x.y;d<h&&(h=d),u=u.next}if((h-=_.gprojection)>0){t=!1;break}s=s.next}return t}return!1}for(var y=null,z=null,v=!0,c=-1e100,f=e.polygon.gverts.next,m=e.polygon.edges.head;null!=m;){var b=m.elt,g=b.gnormx*n.circle.worldCOMx+b.gnormy*n.circle.worldCOMy-b.gprojection-n.circle.radius;if(g>0){v=!1;break}g>c&&(c=g,y=b,z=f),f=f.next,m=m.next}if(v){var w=z,M=null==z.next?e.polygon.gverts.next:z.next,C=n.circle.worldCOMy*y.gnormx-n.circle.worldCOMx*y.gnormy;if(C<=w.y*y.gnormx-w.x*y.gnormy){var k,O,P=n.circle.radius;return(k=w.x-n.circle.worldCOMx)*k+(O=w.y-n.circle.worldCOMy)*O<=P*P}if(C>=M.y*y.gnormx-M.x*y.gnormy){var S,A,j=n.circle.radius;return(S=M.x-n.circle.worldCOMx)*S+(A=M.y-n.circle.worldCOMy)*A<=j*j}return!0}return!1}var E,I,T=n.circle.radius+e.circle.radius;return(E=e.circle.worldCOMx-n.circle.worldCOMx)*E+(I=e.circle.worldCOMy-n.circle.worldCOMy)*I<=T*T},Le.flowCollide=function(n,e,t){if(1==e.type){if(1==n.type){for(var i=[],p=[],l=!0,r=!0,a=n.polygon.edges.head;null!=a;){for(var s=a.elt,_=1e100,h=0,u=e.polygon.gverts.next;null!=u;){var x=u,d=s.gnormx*x.x+s.gnormy*x.y;d<_&&(_=d),d>=s.gprojection+o.epsilon&&(p[h]=!0,r=!1),++h,u=u.next}if((_-=s.gprojection)>0){l=!1;break}a=a.next}if(r){var y=e.polygon;if(y.zip_worldCOM&&null!=y.body){if(y.zip_worldCOM=!1,y.zip_localCOM){if(y.zip_localCOM=!1,1==y.type){var z=y.polygon;if(null==z.lverts.next.next)z.localCOMx=z.lverts.next.x,z.localCOMy=z.lverts.next.y;else if(null==z.lverts.next.next.next)z.localCOMx=z.lverts.next.x,z.localCOMy=z.lverts.next.y,z.localCOMx+=z.lverts.next.next.x,z.localCOMy+=z.lverts.next.next.y,z.localCOMx*=.5,z.localCOMy*=.5;else{z.localCOMx=0,z.localCOMy=0;var v=0,c=z.lverts.next,f=c,m=c=c.next;for(c=c.next;null!=c;){var b=c;v+=m.x*(b.y-f.y);var g=b.y*m.x-b.x*m.y;z.localCOMx+=(m.x+b.x)*g,z.localCOMy+=(m.y+b.y)*g,f=m,m=b,c=c.next}var w=c=z.lverts.next;v+=m.x*(w.y-f.y);var M=w.y*m.x-w.x*m.y;z.localCOMx+=(m.x+w.x)*M,z.localCOMy+=(m.y+w.y)*M,f=m;var C=c=c.next;v+=w.x*(C.y-f.y);var k=C.y*w.x-C.x*w.y;z.localCOMx+=(w.x+C.x)*k,z.localCOMy+=(w.y+C.y)*k;var O=v=1/(3*v);z.localCOMx*=O,z.localCOMy*=O}}null!=y.wrap_localCOM&&(y.wrap_localCOM.zpp_inner.x=y.localCOMx,y.wrap_localCOM.zpp_inner.y=y.localCOMy)}var P=y.body;P.zip_axis&&(P.zip_axis=!1,P.axisx=Math.sin(P.rot),P.axisy=Math.cos(P.rot)),y.worldCOMx=y.body.posx+(y.body.axisy*y.localCOMx-y.body.axisx*y.localCOMy),y.worldCOMy=y.body.posy+(y.localCOMx*y.body.axisx+y.localCOMy*y.body.axisy)}var S=e.polygon.area,A=e.polygon.worldCOMx,j=e.polygon.worldCOMy;return t.overlap=S,t.centroidx=A,t.centroidy=j,!0}if(l){r=!0;for(var E=e.polygon.edges.head;null!=E;){for(var I=E.elt,T=1e100,N=0,L=n.polygon.gverts.next;null!=L;){var V=L,D=I.gnormx*V.x+I.gnormy*V.y;D<T&&(T=D),D>=I.gprojection+o.epsilon&&(i[N]=!0,r=!1),++N,L=L.next}if((T-=I.gprojection)>0){l=!1;break}E=E.next}if(r){var F=n.polygon;if(F.zip_worldCOM&&null!=F.body){if(F.zip_worldCOM=!1,F.zip_localCOM){if(F.zip_localCOM=!1,1==F.type){var R=F.polygon;if(null==R.lverts.next.next)R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y;else if(null==R.lverts.next.next.next)R.localCOMx=R.lverts.next.x,R.localCOMy=R.lverts.next.y,R.localCOMx+=R.lverts.next.next.x,R.localCOMy+=R.lverts.next.next.y,R.localCOMx*=.5,R.localCOMy*=.5;else{R.localCOMx=0,R.localCOMy=0;var Z=0,B=R.lverts.next,G=B,q=B=B.next;for(B=B.next;null!=B;){var U=B;Z+=q.x*(U.y-G.y);var K=U.y*q.x-U.x*q.y;R.localCOMx+=(q.x+U.x)*K,R.localCOMy+=(q.y+U.y)*K,G=q,q=U,B=B.next}var W=B=R.lverts.next;Z+=q.x*(W.y-G.y);var Y=W.y*q.x-W.x*q.y;R.localCOMx+=(q.x+W.x)*Y,R.localCOMy+=(q.y+W.y)*Y,G=q;var J=B=B.next;Z+=W.x*(J.y-G.y);var X=J.y*W.x-J.x*W.y;R.localCOMx+=(W.x+J.x)*X,R.localCOMy+=(W.y+J.y)*X;var H=Z=1/(3*Z);R.localCOMx*=H,R.localCOMy*=H}}null!=F.wrap_localCOM&&(F.wrap_localCOM.zpp_inner.x=F.localCOMx,F.wrap_localCOM.zpp_inner.y=F.localCOMy)}var $=F.body;$.zip_axis&&($.zip_axis=!1,$.axisx=Math.sin($.rot),$.axisy=Math.cos($.rot)),F.worldCOMx=F.body.posx+(F.body.axisy*F.localCOMx-F.body.axisx*F.localCOMy),F.worldCOMy=F.body.posy+(F.localCOMx*F.body.axisx+F.localCOMy*F.body.axisy)}var Q=n.polygon.area,nn=n.polygon.worldCOMx,en=n.polygon.worldCOMy;return t.overlap=Q,t.centroidx=nn,t.centroidy=en,!0}if(l){for(;null!=Le.flowpoly.head;){var tn=Le.flowpoly.pop_unsafe();tn._inuse||(null!=tn.outer&&(tn.outer.zpp_inner=null,tn.outer=null),tn._isimmutable=null,tn._validate=null,tn._invalidate=null,tn.next=xt.zpp_pool,xt.zpp_pool=tn)}for(var pn=null,ln=!1,rn=n.polygon.gverts.next,on=0,an=e.polygon.gverts.next,sn=0,_n=0,hn=e.polygon.edgeCnt;_n<hn;){var un=_n++;if(!p[un]){sn=un;break}an=an.next}if(null==an){an=e.polygon.gverts.next,ln=!0;for(var xn=0,dn=n.polygon.edgeCnt;xn<dn;){var yn=xn++;if(!i[yn]){on=yn;break}rn=rn.next}null==rn?rn=n.polygon.gverts.next:(Le.flowpoly.add(rn),pn=Le.flowpoly.head.elt)}else Le.flowpoly.add(an),pn=Le.flowpoly.head.elt;var zn=1;if(null==Le.flowpoly.head){for(var vn=!0,cn=n.polygon.gverts.next,fn=cn,mn=cn.next;null!=mn;){for(var bn=mn,gn=2,wn=e.polygon.gverts.next,Mn=wn,Cn=wn.next;null!=Cn;){var kn,On,Pn=Cn,Sn=0;kn=fn.x-Mn.x,On=fn.y-Mn.y;var An,jn;An=bn.x-fn.x;var En,In,Tn,Nn=(jn=bn.y-fn.y)*(En=Pn.x-Mn.x)-An*(In=Pn.y-Mn.y);if(Nn*Nn>o.epsilon*o.epsilon){var Ln=(In*kn-En*On)*(Nn=1/Nn);if(Ln>o.epsilon&&Ln<1-o.epsilon){var Vn=(jn*kn-An*On)*Nn;Vn>o.epsilon&&Vn<1-o.epsilon?(Sn=Ln,Tn=!0):Tn=!1}else Tn=!1}else Tn=!1;Tn&&Sn<gn&&(gn=Sn,an=wn),wn=Cn,Mn=Pn,Cn=Cn.next}for(;;){var Dn,Fn,Rn=Cn=e.polygon.gverts.next,Zn=0;Dn=fn.x-Mn.x,Fn=fn.y-Mn.y;var Bn,Gn;Bn=bn.x-fn.x;var qn,Un,Kn,Wn=(Gn=bn.y-fn.y)*(qn=Rn.x-Mn.x)-Bn*(Un=Rn.y-Mn.y);if(Wn*Wn>o.epsilon*o.epsilon){var Yn=(Un*Dn-qn*Fn)*(Wn=1/Wn);if(Yn>o.epsilon&&Yn<1-o.epsilon){var Jn=(Gn*Dn-Bn*Fn)*Wn;Jn>o.epsilon&&Jn<1-o.epsilon?(Zn=Yn,Kn=!0):Kn=!1}else Kn=!1}else Kn=!1;Kn&&Zn<gn&&(gn=Zn,an=wn);break}if(2!=gn){var Xn,Hn,$n,Qn=gn;Xn=fn.x+(bn.x-fn.x)*Qn,Hn=fn.y+(bn.y-fn.y)*Qn,null==xt.zpp_pool?$n=new xt:($n=xt.zpp_pool,xt.zpp_pool=$n.next,$n.next=null),$n.weak=!1,$n._immutable=!1,$n.x=Xn,$n.y=Hn,pn=$n,Le.flowpoly.add(pn),ln=!0,rn=cn,vn=!1;break}cn=mn,fn=bn,mn=mn.next}if(vn)for(;;){for(var ne=mn=n.polygon.gverts.next,ee=2,te=e.polygon.gverts.next,ie=te,pe=te.next;null!=pe;){var le,re,oe=pe,ae=0;le=fn.x-ie.x,re=fn.y-ie.y;var se,_e;se=ne.x-fn.x;var he,ue,xe,de=(_e=ne.y-fn.y)*(he=oe.x-ie.x)-se*(ue=oe.y-ie.y);if(de*de>o.epsilon*o.epsilon){var ye=(ue*le-he*re)*(de=1/de);if(ye>o.epsilon&&ye<1-o.epsilon){var ze=(_e*le-se*re)*de;ze>o.epsilon&&ze<1-o.epsilon?(ae=ye,xe=!0):xe=!1}else xe=!1}else xe=!1;xe&&ae<ee&&(ee=ae,an=te),te=pe,ie=oe,pe=pe.next}for(;;){var ve,ce,fe=pe=e.polygon.gverts.next,me=0;ve=fn.x-ie.x,ce=fn.y-ie.y;var be,ge;be=ne.x-fn.x;var we,Me,Ce,ke=(ge=ne.y-fn.y)*(we=fe.x-ie.x)-be*(Me=fe.y-ie.y);if(ke*ke>o.epsilon*o.epsilon){var Oe=(Me*ve-we*ce)*(ke=1/ke);if(Oe>o.epsilon&&Oe<1-o.epsilon){var Pe=(ge*ve-be*ce)*ke;Pe>o.epsilon&&Pe<1-o.epsilon?(me=Oe,Ce=!0):Ce=!1}else Ce=!1}else Ce=!1;Ce&&me<ee&&(ee=me,an=te);break}if(2!=ee){var Se,Ae,je,Ee=ee;Se=fn.x+(ne.x-fn.x)*Ee,Ae=fn.y+(ne.y-fn.y)*Ee,null==xt.zpp_pool?je=new xt:(je=xt.zpp_pool,xt.zpp_pool=je.next,je.next=null),je.weak=!1,je._immutable=!1,je.x=Se,je.y=Ae,pn=je,Le.flowpoly.add(pn),ln=!0,rn=cn;break}break}zn=2}for(;;)if(ln)if(++on,null==(rn=rn.next)&&(rn=n.polygon.gverts.next,on=0),i[on]){var Ie=Le.flowpoly.head.elt,Te=rn,Ne=an,Ve=an.next;null==Ve&&(Ve=e.polygon.gverts.next);for(var De=-1,Fe=null,Re=0,Ze=0,Be=Ve,Ge=Ve;;){var qe,Ue,Ke=Ge,We=0;qe=Ne.x-Ie.x,Ue=Ne.y-Ie.y;var Ye,Je;Ye=Ke.x-Ne.x;var Xe,He,$e,Qe=(Je=Ke.y-Ne.y)*(Xe=Te.x-Ie.x)-Ye*(He=Te.y-Ie.y);if(Qe*Qe>o.epsilon*o.epsilon){var nt=(He*qe-Xe*Ue)*(Qe=1/Qe);if(nt>o.epsilon&&nt<1-o.epsilon){var et=(Je*qe-Ye*Ue)*Qe;et>o.epsilon&&et<1-o.epsilon?(We=nt,$e=!0):$e=!1}else $e=!1}else $e=!1;if($e&&We>=-1){if(Fe=an,Re=sn,Ze=1,1==zn){De=We,Ge=Be;break}De=We}Ne=Ke,an=Ge,++sn>=e.polygon.edgeCnt&&(sn=0),null==(Ge=Ge.next)&&(Ge=e.polygon.gverts.next);break}for(;Ge!=Be;){var tt,it,pt=Ge,lt=0;tt=Ne.x-Ie.x,it=Ne.y-Ie.y;var rt,ot;rt=pt.x-Ne.x;var at,st,_t,ht=(ot=pt.y-Ne.y)*(at=Te.x-Ie.x)-rt*(st=Te.y-Ie.y);if(ht*ht>o.epsilon*o.epsilon){var ut=(st*tt-at*it)*(ht=1/ht);if(ut>o.epsilon&&ut<1-o.epsilon){var dt=(ot*tt-rt*it)*ht;dt>o.epsilon&&dt<1-o.epsilon?(lt=ut,_t=!0):_t=!1}else _t=!1}else _t=!1;if(_t&&lt>=De){if(Fe=an,Re=sn,++Ze==zn){De=lt;break}De=lt}Ne=pt,an=Ge,++sn>=e.polygon.edgeCnt&&(sn=0),null==(Ge=Ge.next)&&(Ge=e.polygon.gverts.next)}if(null==Fe)break;var yt=Fe,zt=Fe.next;null==zt&&(zt=e.polygon.gverts.next);var vt,ct,ft,mt,bt=zt,gt=De;if(vt=yt.x+(bt.x-yt.x)*gt,ct=yt.y+(bt.y-yt.y)*gt,null!=pn){var wt,Mt;ft=(wt=vt-pn.x)*wt+(Mt=ct-pn.y)*Mt<o.epsilon}else ft=!1;if(ft)break;null==xt.zpp_pool?mt=new xt:(mt=xt.zpp_pool,xt.zpp_pool=mt.next,mt.next=null),mt.weak=!1,mt._immutable=!1,mt.x=vt,mt.y=ct,Le.flowpoly.add(mt),null==pn&&(pn=Le.flowpoly.head.elt),an=Fe,sn=Re,ln=!ln,zn=2}else{var Ct,kt=rn;if(null!=pn){var Ot,Pt,St=kt.x,At=kt.y;Ct=(Ot=St-pn.x)*Ot+(Pt=At-pn.y)*Pt<o.epsilon}else Ct=!1;if(Ct)break;Le.flowpoly.add(kt),null==pn&&(pn=Le.flowpoly.head.elt),zn=1}else if(++sn,null==(an=an.next)&&(an=e.polygon.gverts.next,sn=0),p[sn]){var jt=Le.flowpoly.head.elt,Et=an,It=rn,Tt=rn.next;null==Tt&&(Tt=n.polygon.gverts.next);for(var Nt=-1,Lt=null,Vt=0,Dt=0,Ft=Tt,Rt=Tt;;){var Zt,Bt,Gt=Rt,qt=0;Zt=It.x-jt.x,Bt=It.y-jt.y;var Ut,Kt;Ut=Gt.x-It.x;var Wt,Yt,Jt,Xt=(Kt=Gt.y-It.y)*(Wt=Et.x-jt.x)-Ut*(Yt=Et.y-jt.y);if(Xt*Xt>o.epsilon*o.epsilon){var Ht=(Yt*Zt-Wt*Bt)*(Xt=1/Xt);if(Ht>o.epsilon&&Ht<1-o.epsilon){var $t=(Kt*Zt-Ut*Bt)*Xt;$t>o.epsilon&&$t<1-o.epsilon?(qt=Ht,Jt=!0):Jt=!1}else Jt=!1}else Jt=!1;if(Jt&&qt>=-1){if(Lt=rn,Vt=on,Dt=1,1==zn){Nt=qt,Rt=Ft;break}Nt=qt}It=Gt,rn=Rt,++on>=n.polygon.edgeCnt&&(on=0),null==(Rt=Rt.next)&&(Rt=n.polygon.gverts.next);break}for(;Rt!=Ft;){var Qt,ni,ei=Rt,ti=0;Qt=It.x-jt.x,ni=It.y-jt.y;var ii,pi;ii=ei.x-It.x;var li,ri,oi,ai=(pi=ei.y-It.y)*(li=Et.x-jt.x)-ii*(ri=Et.y-jt.y);if(ai*ai>o.epsilon*o.epsilon){var si=(ri*Qt-li*ni)*(ai=1/ai);if(si>o.epsilon&&si<1-o.epsilon){var _i=(pi*Qt-ii*ni)*ai;_i>o.epsilon&&_i<1-o.epsilon?(ti=si,oi=!0):oi=!1}else oi=!1}else oi=!1;if(oi&&ti>=Nt){if(Lt=rn,Vt=on,++Dt==zn){Nt=ti;break}Nt=ti}It=ei,rn=Rt,++on>=n.polygon.edgeCnt&&(on=0),null==(Rt=Rt.next)&&(Rt=n.polygon.gverts.next)}if(null==Lt)break;var hi=Lt,ui=Lt.next;null==ui&&(ui=n.polygon.gverts.next);var xi,di,yi,zi,vi=ui,ci=Nt;if(xi=hi.x+(vi.x-hi.x)*ci,di=hi.y+(vi.y-hi.y)*ci,null!=pn){var fi,mi;yi=(fi=xi-pn.x)*fi+(mi=di-pn.y)*mi<o.epsilon}else yi=!1;if(yi)break;null==xt.zpp_pool?zi=new xt:(zi=xt.zpp_pool,xt.zpp_pool=zi.next,zi.next=null),zi.weak=!1,zi._immutable=!1,zi.x=xi,zi.y=di,Le.flowpoly.add(zi),null==pn&&(pn=Le.flowpoly.head.elt),rn=Lt,on=Vt,ln=!ln,zn=2}else{var bi,gi=an;if(null!=pn){var wi,Mi,Ci=gi.x,ki=gi.y;bi=(wi=Ci-pn.x)*wi+(Mi=ki-pn.y)*Mi<o.epsilon}else bi=!1;if(bi)break;Le.flowpoly.add(gi),null==pn&&(pn=Le.flowpoly.head.elt),zn=1}if(null!=Le.flowpoly.head&&null!=Le.flowpoly.head.next&&null!=Le.flowpoly.head.next.next){var Oi=0,Pi=0,Si=0;Pi=0,Si=0,Oi=0;var Ai=Le.flowpoly.head,ji=Ai.elt,Ei=(Ai=Ai.next).elt;for(Ai=Ai.next;null!=Ai;){var Ii=Ai.elt;Oi+=Ei.x*(Ii.y-ji.y);var Ti=Ii.y*Ei.x-Ii.x*Ei.y;Pi+=(Ei.x+Ii.x)*Ti,Si+=(Ei.y+Ii.y)*Ti,ji=Ei,Ei=Ii,Ai=Ai.next}var Ni=(Ai=Le.flowpoly.head).elt;Oi+=Ei.x*(Ni.y-ji.y);var Li=Ni.y*Ei.x-Ni.x*Ei.y;Pi+=(Ei.x+Ni.x)*Li,Si+=(Ei.y+Ni.y)*Li,ji=Ei;var Vi=(Ai=Ai.next).elt;Oi+=Ni.x*(Vi.y-ji.y);var Di=Vi.y*Ni.x-Vi.x*Ni.y;Pi+=(Ni.x+Vi.x)*Di,Si+=(Ni.y+Vi.y)*Di;var Fi=1/(6*(Oi*=.5));return Pi*=Fi,Si*=Fi,t.overlap=-Oi,t.centroidx=Pi,t.centroidy=Si,!0}return!1}return!1}return!1}for(var Ri=[],Zi=!0,Bi=null,Gi=null,qi=-1e100,Ui=!0,Ki=e.polygon.gverts.next,Wi=0,Yi=e.polygon.edges.head;null!=Yi;){var Ji=Yi.elt,Xi=Ji.gnormx*n.circle.worldCOMx+Ji.gnormy*n.circle.worldCOMy;if(Xi>Ji.gprojection+n.circle.radius){Ui=!1;break}Xi+n.circle.radius>Ji.gprojection+o.epsilon&&(Zi=!1,Ri[Wi]=!0),(Xi-=Ji.gprojection+n.circle.radius)>qi&&(qi=Xi,Bi=Ji,Gi=Ki),Ki=Ki.next,++Wi,Yi=Yi.next}if(Ui){if(Zi){var Hi=n.circle.area,$i=n.circle.worldCOMx,Qi=n.circle.worldCOMy;return t.overlap=Hi,t.centroidx=$i,t.centroidy=Qi,!0}var np,ep=Gi,tp=null==Gi.next?e.polygon.gverts.next:Gi.next,ip=n.circle.worldCOMy*Bi.gnormx-n.circle.worldCOMx*Bi.gnormy;if(ip<=ep.y*Bi.gnormx-ep.x*Bi.gnormy){var pp,lp,rp=n.circle.radius;np=(pp=ep.x-n.circle.worldCOMx)*pp+(lp=ep.y-n.circle.worldCOMy)*lp<=rp*rp}else if(ip>=tp.y*Bi.gnormx-tp.x*Bi.gnormy){var op,ap,sp=n.circle.radius;np=(op=tp.x-n.circle.worldCOMx)*op+(ap=tp.y-n.circle.worldCOMy)*ap<=sp*sp}else np=!0;if(np){for(var _p=[],hp=0,up=!0,xp=null,dp=0,yp=e.polygon.gverts.next;null!=yp;){var zp,vp,cp=yp,fp=cp.x,mp=cp.y;zp=fp-n.circle.worldCOMx,vp=mp-n.circle.worldCOMy,(_p[hp]=zp*zp+vp*vp<=n.circle.radius*n.circle.radius)?(dp=hp,xp=yp):up=!1,++hp,yp=yp.next}if(up){var bp=e.polygon;if(bp.zip_worldCOM&&null!=bp.body){if(bp.zip_worldCOM=!1,bp.zip_localCOM){if(bp.zip_localCOM=!1,1==bp.type){var gp=bp.polygon;if(null==gp.lverts.next.next)gp.localCOMx=gp.lverts.next.x,gp.localCOMy=gp.lverts.next.y;else if(null==gp.lverts.next.next.next)gp.localCOMx=gp.lverts.next.x,gp.localCOMy=gp.lverts.next.y,gp.localCOMx+=gp.lverts.next.next.x,gp.localCOMy+=gp.lverts.next.next.y,gp.localCOMx*=.5,gp.localCOMy*=.5;else{gp.localCOMx=0,gp.localCOMy=0;var wp=0,Mp=gp.lverts.next,Cp=Mp,kp=Mp=Mp.next;for(Mp=Mp.next;null!=Mp;){var Op=Mp;wp+=kp.x*(Op.y-Cp.y);var Pp=Op.y*kp.x-Op.x*kp.y;gp.localCOMx+=(kp.x+Op.x)*Pp,gp.localCOMy+=(kp.y+Op.y)*Pp,Cp=kp,kp=Op,Mp=Mp.next}var Sp=Mp=gp.lverts.next;wp+=kp.x*(Sp.y-Cp.y);var Ap=Sp.y*kp.x-Sp.x*kp.y;gp.localCOMx+=(kp.x+Sp.x)*Ap,gp.localCOMy+=(kp.y+Sp.y)*Ap,Cp=kp;var jp=Mp=Mp.next;wp+=Sp.x*(jp.y-Cp.y);var Ep=jp.y*Sp.x-jp.x*Sp.y;gp.localCOMx+=(Sp.x+jp.x)*Ep,gp.localCOMy+=(Sp.y+jp.y)*Ep;var Ip=wp=1/(3*wp);gp.localCOMx*=Ip,gp.localCOMy*=Ip}}null!=bp.wrap_localCOM&&(bp.wrap_localCOM.zpp_inner.x=bp.localCOMx,bp.wrap_localCOM.zpp_inner.y=bp.localCOMy)}var Tp=bp.body;Tp.zip_axis&&(Tp.zip_axis=!1,Tp.axisx=Math.sin(Tp.rot),Tp.axisy=Math.cos(Tp.rot)),bp.worldCOMx=bp.body.posx+(bp.body.axisy*bp.localCOMx-bp.body.axisx*bp.localCOMy),bp.worldCOMy=bp.body.posy+(bp.localCOMx*bp.body.axisx+bp.localCOMy*bp.body.axisy)}var Np=e.polygon.area,Lp=e.polygon.worldCOMx,Vp=e.polygon.worldCOMy;return t.overlap=Np,t.centroidx=Lp,t.centroidy=Vp,!0}for(;null!=Le.flowpoly.head;){var Dp=Le.flowpoly.pop_unsafe();Dp._inuse||(null!=Dp.outer&&(Dp.outer.zpp_inner=null,Dp.outer=null),Dp._isimmutable=null,Dp._validate=null,Dp._invalidate=null,Dp.next=xt.zpp_pool,xt.zpp_pool=Dp)}Le.flowsegs.clear();var Fp=null,Rp=1;for(null==xp?(xp=e.polygon.gverts.next,Rp=2):(Fp=xp,Le.flowpoly.add(Fp));0!=Rp;)if(1==Rp)if(null==(xp=xp.next)&&(xp=e.polygon.gverts.next),++dp>=e.polygon.edgeCnt&&(dp=0),_p[dp]){var Zp,Bp,Gp=Fp.x,qp=Fp.y;if((Zp=Gp-xp.x)*Zp+(Bp=qp-xp.y)*Bp<o.epsilon)break;Le.flowpoly.add(xp)}else{var Up,Kp,Wp,Yp,Jp,Xp,Hp=Le.flowpoly.head.elt,$p=xp,Qp=(Up=$p.x-Hp.x)*Up+(Kp=$p.y-Hp.y)*Kp,nl=2*((Wp=Hp.x-n.circle.worldCOMx)*Up+(Yp=Hp.y-n.circle.worldCOMy)*Kp),el=Math.sqrt(nl*nl-4*Qp*(Wp*Wp+Yp*Yp-n.circle.radius*n.circle.radius)),tl=(-nl-el)*(Qp=1/(2*Qp)),il=tl<o.epsilon?(-nl+el)*Qp:tl;Jp=Hp.x+($p.x-Hp.x)*il,Xp=Hp.y+($p.y-Hp.y)*il;var pl,ll,rl;if((pl=Fp.x-Jp)*pl+(ll=Fp.y-Xp)*ll<o.epsilon)break;null==xt.zpp_pool?rl=new xt:(rl=xt.zpp_pool,xt.zpp_pool=rl.next,rl.next=null),rl.weak=!1,rl._immutable=!1,rl.x=Jp,rl.y=Xp,Le.flowpoly.add(rl),Rp=2}else if(2==Rp){var ol=xp.next;null==ol&&(ol=e.polygon.gverts.next);var al=xp;Rp=0;for(var sl=ol,_l=ol;;){var hl=_l,ul=dp+1;if(ul==e.polygon.edgeCnt&&(ul=0),Ri[dp]){if(_p[ul]){var xl,dl,yl,zl,vl,cl,fl=(xl=hl.x-al.x)*xl+(dl=hl.y-al.y)*dl,ml=2*((yl=al.x-n.circle.worldCOMx)*xl+(zl=al.y-n.circle.worldCOMy)*dl),bl=Math.sqrt(ml*ml-4*fl*(yl*yl+zl*zl-n.circle.radius*n.circle.radius)),gl=(-ml-bl)*(fl=1/(2*fl)),wl=gl<o.epsilon?(-ml+bl)*fl:gl;vl=al.x+(hl.x-al.x)*wl,cl=al.y+(hl.y-al.y)*wl;var Ml,Cl,kl;if((Ml=Fp.x-vl)*Ml+(Cl=Fp.y-cl)*Cl<o.epsilon){Rp=0,_l=sl;break}null==xt.zpp_pool?kl=new xt:(kl=xt.zpp_pool,xt.zpp_pool=kl.next,kl.next=null),kl.weak=!1,kl._immutable=!1,kl.x=vl,kl.y=cl;var Ol=kl;Le.flowsegs.add(Le.flowpoly.head.elt),Le.flowsegs.add(Ol),Le.flowpoly.add(Ol),Rp=1,_l=sl;break}var Pl,Sl,Al,jl,El,Il=0,Tl=0,Nl=(Pl=hl.x-al.x)*Pl+(Sl=hl.y-al.y)*Sl,Ll=2*((Al=al.x-n.circle.worldCOMx)*Pl+(jl=al.y-n.circle.worldCOMy)*Sl),Vl=Ll*Ll-4*Nl*(Al*Al+jl*jl-n.circle.radius*n.circle.radius);if(Vl*Vl<o.epsilon?(Il=Vl<0?10:Tl=-Ll/(2*Nl),El=!1):(Il=(-Ll-(Vl=Math.sqrt(Vl)))*(Nl=1/(2*Nl)),Tl=(-Ll+Vl)*Nl,El=!0),Il<1-o.epsilon&&Tl>o.epsilon){var Dl,Fl,Rl,Zl,Bl=Il;if(Dl=al.x+(hl.x-al.x)*Bl,Fl=al.y+(hl.y-al.y)*Bl,null!=Fp){var Gl,ql;Rl=(Gl=Fp.x-Dl)*Gl+(ql=Fp.y-Fl)*ql<o.epsilon}else Rl=!1;if(Rl){Rp=0,_l=sl;break}null==xt.zpp_pool?Zl=new xt:(Zl=xt.zpp_pool,xt.zpp_pool=Zl.next,Zl.next=null),Zl.weak=!1,Zl._immutable=!1,Zl.x=Dl,Zl.y=Fl;var Ul=Zl;if(null!=Le.flowpoly.head&&(Le.flowsegs.add(Le.flowpoly.head.elt),Le.flowsegs.add(Ul)),Le.flowpoly.add(Ul),null==Fp&&(Fp=Le.flowpoly.head.elt),El){var Kl,Wl,Yl,Jl=Tl;Kl=al.x+(hl.x-al.x)*Jl,Wl=al.y+(hl.y-al.y)*Jl,null==xt.zpp_pool?Yl=new xt:(Yl=xt.zpp_pool,xt.zpp_pool=Yl.next,Yl.next=null),Yl.weak=!1,Yl._immutable=!1,Yl.x=Kl,Yl.y=Wl,Le.flowpoly.add(Yl)}}}al=hl,xp=_l,dp=ul,null==(_l=_l.next)&&(_l=e.polygon.gverts.next);break}for(;_l!=sl;){var Xl=_l,Hl=dp+1;if(Hl==e.polygon.edgeCnt&&(Hl=0),Ri[dp]){if(_p[Hl]){var $l,Ql,nr,er,tr,ir,pr=($l=Xl.x-al.x)*$l+(Ql=Xl.y-al.y)*Ql,lr=2*((nr=al.x-n.circle.worldCOMx)*$l+(er=al.y-n.circle.worldCOMy)*Ql),rr=Math.sqrt(lr*lr-4*pr*(nr*nr+er*er-n.circle.radius*n.circle.radius)),or=(-lr-rr)*(pr=1/(2*pr)),ar=or<o.epsilon?(-lr+rr)*pr:or;tr=al.x+(Xl.x-al.x)*ar,ir=al.y+(Xl.y-al.y)*ar;var sr,_r,hr;if((sr=Fp.x-tr)*sr+(_r=Fp.y-ir)*_r<o.epsilon){Rp=0;break}null==xt.zpp_pool?hr=new xt:(hr=xt.zpp_pool,xt.zpp_pool=hr.next,hr.next=null),hr.weak=!1,hr._immutable=!1,hr.x=tr,hr.y=ir;var ur=hr;Le.flowsegs.add(Le.flowpoly.head.elt),Le.flowsegs.add(ur),Le.flowpoly.add(ur),Rp=1;break}var xr,dr,yr,zr,vr,cr=0,fr=0,mr=(xr=Xl.x-al.x)*xr+(dr=Xl.y-al.y)*dr,br=2*((yr=al.x-n.circle.worldCOMx)*xr+(zr=al.y-n.circle.worldCOMy)*dr),gr=br*br-4*mr*(yr*yr+zr*zr-n.circle.radius*n.circle.radius);if(gr*gr<o.epsilon?(cr=gr<0?10:fr=-br/(2*mr),vr=!1):(cr=(-br-(gr=Math.sqrt(gr)))*(mr=1/(2*mr)),fr=(-br+gr)*mr,vr=!0),cr<1-o.epsilon&&fr>o.epsilon){var wr,Mr,Cr,kr,Or=cr;if(wr=al.x+(Xl.x-al.x)*Or,Mr=al.y+(Xl.y-al.y)*Or,null!=Fp){var Pr,Sr;Cr=(Pr=Fp.x-wr)*Pr+(Sr=Fp.y-Mr)*Sr<o.epsilon}else Cr=!1;if(Cr){Rp=0;break}null==xt.zpp_pool?kr=new xt:(kr=xt.zpp_pool,xt.zpp_pool=kr.next,kr.next=null),kr.weak=!1,kr._immutable=!1,kr.x=wr,kr.y=Mr;var Ar=kr;if(null!=Le.flowpoly.head&&(Le.flowsegs.add(Le.flowpoly.head.elt),Le.flowsegs.add(Ar)),Le.flowpoly.add(Ar),null==Fp&&(Fp=Le.flowpoly.head.elt),vr){var jr,Er,Ir,Tr=fr;jr=al.x+(Xl.x-al.x)*Tr,Er=al.y+(Xl.y-al.y)*Tr,null==xt.zpp_pool?Ir=new xt:(Ir=xt.zpp_pool,xt.zpp_pool=Ir.next,Ir.next=null),Ir.weak=!1,Ir._immutable=!1,Ir.x=jr,Ir.y=Er,Le.flowpoly.add(Ir)}}}al=Xl,xp=_l,dp=Hl,null==(_l=_l.next)&&(_l=e.polygon.gverts.next)}}if(null==Le.flowpoly.head)return!1;if(null==Le.flowpoly.head.next){for(var Nr=!0,Lr=e.polygon.edges.head;null!=Lr;){var Vr=Lr.elt;if(Vr.gnormx*n.circle.worldCOMx+Vr.gnormy*n.circle.worldCOMy>Vr.gprojection){Nr=!1;break}Lr=Lr.next}if(Nr){var Dr=n.circle.area,Fr=n.circle.worldCOMx,Rr=n.circle.worldCOMy;return t.overlap=Dr,t.centroidx=Fr,t.centroidy=Rr,!0}return!1}var Zr=0,Br=0,Gr=0;if(null!=Le.flowpoly.head.next.next){var qr=0,Ur=0,Kr=0;Ur=0,Kr=0,qr=0;var Wr=Le.flowpoly.head,Yr=Wr.elt,Jr=(Wr=Wr.next).elt;for(Wr=Wr.next;null!=Wr;){var Xr=Wr.elt;qr+=Jr.x*(Xr.y-Yr.y);var Hr=Xr.y*Jr.x-Xr.x*Jr.y;Ur+=(Jr.x+Xr.x)*Hr,Kr+=(Jr.y+Xr.y)*Hr,Yr=Jr,Jr=Xr,Wr=Wr.next}var $r=(Wr=Le.flowpoly.head).elt;qr+=Jr.x*($r.y-Yr.y);var Qr=$r.y*Jr.x-$r.x*Jr.y;Ur+=(Jr.x+$r.x)*Qr,Kr+=(Jr.y+$r.y)*Qr,Yr=Jr;var no=(Wr=Wr.next).elt;qr+=$r.x*(no.y-Yr.y);var eo=no.y*$r.x-no.x*$r.y;Ur+=($r.x+no.x)*eo,Kr+=($r.y+no.y)*eo;var to=1/(6*(qr*=.5)),io=-qr;Zr+=(Ur*=to)*io,Br+=(Kr*=to)*io,Gr=0-qr}else Le.flowsegs.add(Le.flowpoly.head.elt),Le.flowsegs.add(Le.flowpoly.head.next.elt);for(;null!=Le.flowsegs.head;){var po=Le.flowsegs.pop_unsafe(),lo=Le.flowsegs.pop_unsafe(),ro=0,oo=0;ro=lo.x-po.x,oo=lo.y-po.y;var ao=1/Math.sqrt(ro*ro+oo*oo),so=ro*=ao;ro=-(oo*=ao),oo=so;var _o=0,ho=0;_o=po.x+lo.x,ho=po.y+lo.y,_o*=.5,ho*=.5;var uo,xo,yo=ro*(_o-=n.circle.worldCOMx)+oo*(ho-=n.circle.worldCOMy),zo=yo/n.circle.radius,vo=Math.sqrt(1-zo*zo),co=Math.acos(zo);uo=n.circle.radius*(n.circle.radius*co-yo*vo),xo=.6666666666666666*n.circle.radius*vo*vo*vo/(co-zo*vo),_o=n.circle.worldCOMx,ho=n.circle.worldCOMy;Zr+=(_o+=ro*xo)*uo,Br+=(ho+=oo*xo)*uo,Gr+=uo}var fo=1/Gr;return Zr*=fo,Br*=fo,t.overlap=Gr,t.centroidx=Zr,t.centroidy=Br,!0}return!1}return!1}var mo,bo,go=n.circle,wo=e.circle;mo=wo.worldCOMx-go.worldCOMx,bo=wo.worldCOMy-go.worldCOMy;var Mo=go.radius+wo.radius,Co=mo*mo+bo*bo;if(Co>Mo*Mo)return!1;if(Co<o.epsilon*o.epsilon){if(go.radius<wo.radius){var ko=go.area,Oo=go.worldCOMx,Po=go.worldCOMy;t.overlap=ko,t.centroidx=Oo,t.centroidy=Po}else{var So=wo.area,Ao=wo.worldCOMx,jo=wo.worldCOMy;t.overlap=So,t.centroidx=Ao,t.centroidy=jo}return!0}var Eo=Math.sqrt(Co),Io=1/Eo,To=.5*(Eo-(wo.radius*wo.radius-go.radius*go.radius)*Io);if(To<=-go.radius){var No=go.area,Lo=go.worldCOMx,Vo=go.worldCOMy;t.overlap=No,t.centroidx=Lo,t.centroidy=Vo}else{var Do=Eo-To;if(Do<=-wo.radius){var Fo=wo.area,Ro=wo.worldCOMx,Zo=wo.worldCOMy;t.overlap=Fo,t.centroidx=Ro,t.centroidy=Zo}else{var Bo,Go,qo,Uo=To/go.radius,Ko=Math.sqrt(1-Uo*Uo),Wo=Math.acos(Uo);Bo=go.radius*(go.radius*Wo-To*Ko),Go=.6666666666666666*go.radius*Ko*Ko*Ko/(Wo-Uo*Ko);var Yo=Do/wo.radius,Jo=Math.sqrt(1-Yo*Yo),Xo=Math.acos(Yo),Ho=Bo+(qo=wo.radius*(wo.radius*Xo-Do*Jo)),$o=(Go*Bo+(Eo-.6666666666666666*wo.radius*Jo*Jo*Jo/(Xo-Yo*Jo))*qo)/Ho*Io,Qo=go.worldCOMx+mo*$o,na=go.worldCOMy+bo*$o;t.overlap=Ho,t.centroidx=Qo,t.centroidy=na}}return!0},Le.prototype.__class__=Le;var Ve=zpp_nape.geom.ZPP_Convex=function(){};Ve.__name__=["zpp_nape","geom","ZPP_Convex"],Ve.isinner=function(n,e,t){var i,p;i=n.x-e.x,p=n.y-e.y;var l;return l=t.x-e.x,(t.y-e.y)*i-l*p>=0},Ve.optimise=function(n){var e=n.vertices,t=n.vertices;if(null!=e)for(var i=e;i.sort(),(i=i.next)!=t;);var p=n.vertices,l=n.vertices;if(null!=p)for(var r=p;;){for(var o=r,a=o.prev,s=null,_=o.diagonals.head;null!=_;){var h=_.elt;if(Ve.isinner(null==_.next?o.next:_.next.elt,o,a)){for(var u=!0,x=h.prev,d=null,y=h.diagonals.head;null!=y;){var z=y.elt;if(z==o){u=Ve.isinner(null==y.next?h.next:y.next.elt,h,x);break}x=z,d=y,y=y.next}u?(_=o.diagonals.erase(s),h.diagonals.erase(d)):(a=h,s=_,_=_.next)}else s=_,a=h,_=_.next}if((r=r.next)==l)break}},Ve.prototype.__class__=Ve;var De=zpp_nape.geom.ZPP_ConvexRayResult=function(){this.toiDistance=0,this.next=null,this.inner=!1,this.ray=null,this.position=null,this.convex=null,this.shape=null,this.normal=null};De.__name__=["zpp_nape","geom","ZPP_ConvexRayResult"],De.getRay=function(n,e,t,i){var p;null==De.rayPool?(De.internal=!0,(p=new un).zpp_inner=new De,p.zpp_inner.ray=p,De.internal=!1):(p=De.rayPool.ray,De.rayPool=De.rayPool.next,p.zpp_inner.next=null);var l=p.zpp_inner;return l.normal=n,n.zpp_inner._immutable=!0,l.toiDistance=e,l.inner=t,l.shape=i,p},De.getConvex=function(n,e,t,i){var p;null==De.convexPool?(De.internal=!0,(p=new Q).zpp_inner=new De,p.zpp_inner.convex=p,De.internal=!1):(p=De.convexPool.convex,De.convexPool=De.convexPool.next,p.zpp_inner.next=null);var l=p.zpp_inner;return l.normal=n,l.position=e,n.zpp_inner._immutable=!0,e.zpp_inner._immutable=!0,l.toiDistance=t,l.shape=i,p},De.prototype.normal=null,De.prototype.shape=null,De.prototype.convex=null,De.prototype.position=null,De.prototype.ray=null,De.prototype.inner=null,De.prototype.next=null,De.prototype.toiDistance=null,De.prototype.disposed=function(){},De.prototype.free=function(){this.normal.zpp_inner._immutable=!1;var n=this.normal,e=n.zpp_inner;if(n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=xt.zpp_pool,xt.zpp_pool=e,null!=this.position){this.position.zpp_inner._immutable=!1;var t=this.position,i=t.zpp_inner;t.zpp_inner.outer=null,t.zpp_inner=null,t.zpp_pool=xp.poolVec2,xp.poolVec2=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=xt.zpp_pool,xt.zpp_pool=i}this.shape=null,this.toiDistance=0,null!=this.convex?(this.next=De.convexPool,De.convexPool=this):(this.next=De.rayPool,De.rayPool=this)},De.prototype.__class__=De;var Fe=zpp_nape.geom.ZPP_CutVert=function(){this.used=!1,this.rank=0,this.parent=null,this.positive=!1,this.value=0,this.vert=null,this.posy=0,this.posx=0,this.next=null,this.prev=null};Fe.__name__=["zpp_nape","geom","ZPP_CutVert"],Fe.path=function(n){var e;return null==Fe.zpp_pool?e=new Fe:(e=Fe.zpp_pool,Fe.zpp_pool=e.next,e.next=null),e.vert=n,e.parent=e,e.rank=0,e.used=!1,e},Fe.prototype.prev=null,Fe.prototype.next=null,Fe.prototype.posx=null,Fe.prototype.posy=null,Fe.prototype.vert=null,Fe.prototype.value=null,Fe.prototype.positive=null,Fe.prototype.parent=null,Fe.prototype.rank=null,Fe.prototype.used=null,Fe.prototype.alloc=function(){},Fe.prototype.free=function(){this.vert=null,this.parent=null},Fe.prototype.__class__=Fe;var Re=zpp_nape.geom.ZPP_CutInt=function(){this.path1=null,this.start=null,this.end=null,this.path0=null,this.vertex=!1,this.virtualint=!1,this.time=0,this.next=null};Re.__name__=["zpp_nape","geom","ZPP_CutInt"],Re.get=function(n,e,t,i,p,l,r){var o;return null==r&&(r=!1),null==l&&(l=!1),null==Re.zpp_pool?o=new Re:(o=Re.zpp_pool,Re.zpp_pool=o.next,o.next=null),o.virtualint=l,o.end=e,o.start=t,o.path0=i,o.path1=p,o.time=n,o.vertex=r,o},Re.prototype.next=null,Re.prototype.time=null,Re.prototype.virtualint=null,Re.prototype.vertex=null,Re.prototype.path0=null,Re.prototype.end=null,Re.prototype.start=null,Re.prototype.path1=null,Re.prototype.alloc=function(){},Re.prototype.free=function(){this.end=this.start=null,this.path0=this.path1=null},Re.prototype.__class__=Re;var Ze=zpp_nape.geom.ZPP_Cutter=function(){};Ze.__name__=["zpp_nape","geom","ZPP_Cutter"],Ze.run=function(n,e,t,i,p,l){var r,o,a=e.zpp_inner;null!=a._validate&&a._validate(),r=e.zpp_inner.x;var s=e.zpp_inner;null!=s._validate&&s._validate(),o=e.zpp_inner.y;var _,h,u=t.zpp_inner;null!=u._validate&&u._validate(),_=t.zpp_inner.x-r;var x=t.zpp_inner;null!=x._validate&&x._validate();for(var d=i?0:-1/0,y=p?1:1/0,z=-(o*_-r*(h=t.zpp_inner.y-o)),v=null,c=!1,f=n;;){var m;null==Fe.zpp_pool?m=new Fe:(m=Fe.zpp_pool,Fe.zpp_pool=m.next,m.next=null),m.vert=f,m.posx=m.vert.x,m.posy=m.vert.y,m.value=m.posy*_-m.posx*h+z,m.positive=m.value>0,0==m.value&&(c=!0);var b=m;if(null==v?v=b.prev=b.next=b:(b.prev=v,b.next=v.next,v.next.prev=b,v.next=b),v=b,(f=f.next)==n)break}if(c){var g=null,w=v;if(null!=v)for(var M=v;;){var C=M;if(0!=C.value){g=C;break}if((M=M.next)==w)break}var k=0,O=0;k=_,O=h;var P=1/Math.sqrt(k*k+O*O),S=k*=P;k=-(O*=P),O=S;for(var A=null,j=g;;)if(0==j.value||null!=A&&j!=A.next){var E=A.value*j.value;if(0!=E){var I,T=A.next;if(E>0)I=A.positive;else{var N=T.next,L=0,V=0;L=T.posx+N.posx,V=T.posy+N.posy;var D=(L*=.5)+1e-8*k,F=(V*=.5)+1e-8*O,R=!1;if(null!=n)for(var Z=n;;){var B=Z,G=B.prev;if((B.y<F&&G.y>=F||G.y<F&&B.y>=F)&&(B.x<=D||G.x<=D)&&B.x+(F-B.y)/(G.y-B.y)*(G.x-B.x)<D&&(R=!R),(Z=Z.next)==n)break}I=R}var q=j;if(null!=T)for(var U=T;U.positive=I,(U=U.next)!=q;);if(A=j,(j=j.next)==g)break}else if((j=j.next)==g)break}else if(A=j,(j=j.next)==g)break;for(;;){if(0!=j.value&&(null==A||j==A.next)){A=j,j=j.next;break}var K=A.value*j.value;if(0==K){j=j.next;break}var W,Y=A.next;if(K>0)W=A.positive;else{var J=Y.next,X=0,H=0;X=Y.posx+J.posx,H=Y.posy+J.posy;var $=(X*=.5)+1e-8*k,Q=(H*=.5)+1e-8*O,nn=!1;if(null!=n)for(var en=n;;){var tn=en,ln=tn.prev;if((tn.y<Q&&ln.y>=Q||ln.y<Q&&tn.y>=Q)&&(tn.x<=$||ln.x<=$)&&tn.x+(Q-tn.y)/(ln.y-tn.y)*(ln.x-tn.x)<$&&(nn=!nn),(en=en.next)==n)break}W=nn}var on=j;if(null!=Y)for(var an=Y;an.positive=W,(an=an.next)!=on;);A=j,j=j.next;break}}null==Ze.ints&&(Ze.ints=new Yt),null==Ze.paths&&(Ze.paths=new Jt);var sn,_n=null,hn=v.posx,un=v.posy;null==Ge.zpp_pool?sn=new Ge:(sn=Ge.zpp_pool,Ge.zpp_pool=sn.next,sn.next=null),sn.forced=!1,sn.x=hn,sn.y=un;var xn=sn;null==_n?_n=xn.prev=xn.next=xn:(xn.next=_n,xn.prev=_n.prev,_n.prev.next=xn,_n.prev=xn);var dn,yn=_n;null==Fe.zpp_pool?dn=new Fe:(dn=Fe.zpp_pool,Fe.zpp_pool=dn.next,dn.next=null),dn.vert=_n,dn.parent=dn,dn.rank=0,dn.used=!1;var zn=dn;Ze.paths.add(zn);for(var vn=v;;){var cn,fn=vn.next,mn=fn.posx,bn=fn.posy;null==Ge.zpp_pool?cn=new Ge:(cn=Ge.zpp_pool,Ge.zpp_pool=cn.next,cn.next=null),cn.forced=!1,cn.x=mn,cn.y=bn;var gn=cn;if(vn.positive==fn.positive)null==_n?_n=gn.prev=gn.next=gn:(gn.next=_n,gn.prev=_n.prev,_n.prev.next=gn,_n.prev=gn);else{var wn,Mn,Cn=h*(wn=fn.posx-vn.posx)-_*(Mn=fn.posy-vn.posy);Cn=1/Cn;var kn,On,Pn,Sn=(Mn*(kn=r-vn.posx)-wn*(On=o-vn.posy))*Cn;if(Sn<d||Sn>y)null==Re.zpp_pool?Pn=new Re:(Pn=Re.zpp_pool,Re.zpp_pool=Pn.next,Pn.next=null),Pn.virtualint=!0,Pn.end=null,Pn.start=null,Pn.path0=null,Pn.path1=null,Pn.time=Sn,Pn.vertex=!1,Ze.ints.add(Pn),null==_n?_n=gn.prev=gn.next=gn:(gn.next=_n,gn.prev=_n.prev,_n.prev.next=gn,_n.prev=gn);else if(0==vn.value){var An=_n.prev;_n=null;var jn,En=An.x,In=An.y;null==Ge.zpp_pool?jn=new Ge:(jn=Ge.zpp_pool,Ge.zpp_pool=jn.next,jn.next=null),jn.forced=!1,jn.x=En,jn.y=In;var Tn=jn;null==_n?_n=Tn.prev=Tn.next=Tn:(Tn.next=_n,Tn.prev=_n.prev,_n.prev.next=Tn,_n.prev=Tn),null==_n?_n=gn.prev=gn.next=gn:(gn.next=_n,gn.prev=_n.prev,_n.prev.next=gn,_n.prev=gn);var Nn,Ln=Ze.paths.head.elt;null==Fe.zpp_pool?Nn=new Fe:(Nn=Fe.zpp_pool,Fe.zpp_pool=Nn.next,Nn.next=null),Nn.vert=_n,Nn.parent=Nn,Nn.rank=0,Nn.used=!1,Ze.paths.add(Nn);var Vn,Dn=Ze.paths.head.elt;null==Re.zpp_pool?Vn=new Re:(Vn=Re.zpp_pool,Re.zpp_pool=Vn.next,Vn.next=null),Vn.virtualint=!0,Vn.end=An,Vn.start=_n,Vn.path0=Ln,Vn.path1=Dn,Vn.time=Sn,Vn.vertex=!1,Ze.ints.add(Vn)}else if(0==fn.value){null==_n?_n=gn.prev=gn.next=gn:(gn.next=_n,gn.prev=_n.prev,_n.prev.next=gn,_n.prev=gn);var Fn=_n.prev;_n=null;var Rn,Zn=fn.posx,Bn=fn.posy;null==Ge.zpp_pool?Rn=new Ge:(Rn=Ge.zpp_pool,Ge.zpp_pool=Rn.next,Rn.next=null),Rn.forced=!1,Rn.x=Zn,Rn.y=Bn;var Gn=Rn;null==_n?_n=Gn.prev=Gn.next=Gn:(Gn.next=_n,Gn.prev=_n.prev,_n.prev.next=Gn,_n.prev=Gn);var qn,Un=Ze.paths.head.elt;null==Fe.zpp_pool?qn=new Fe:(qn=Fe.zpp_pool,Fe.zpp_pool=qn.next,qn.next=null),qn.vert=_n,qn.parent=qn,qn.rank=0,qn.used=!1,Ze.paths.add(qn);var Kn,Wn=Ze.paths.head.elt;null==Re.zpp_pool?Kn=new Re:(Kn=Re.zpp_pool,Re.zpp_pool=Kn.next,Kn.next=null),Kn.virtualint=!0,Kn.end=Fn,Kn.start=_n,Kn.path0=Un,Kn.path1=Wn,Kn.time=Sn,Kn.vertex=!1,Ze.ints.add(Kn)}else{var Yn,Jn=(h*kn-_*On)*Cn,Xn=0,Hn=0;Xn=vn.posx,Hn=vn.posy,Xn+=wn*Jn,Hn+=Mn*Jn,null==Ge.zpp_pool?Yn=new Ge:(Yn=Ge.zpp_pool,Ge.zpp_pool=Yn.next,Yn.next=null),Yn.forced=!1,Yn.x=Xn,Yn.y=Hn;var $n=Yn;null==_n?_n=$n.prev=$n.next=$n:($n.next=_n,$n.prev=_n.prev,_n.prev.next=$n,_n.prev=$n);var Qn,ne=_n.prev;_n=null,null==Ge.zpp_pool?Qn=new Ge:(Qn=Ge.zpp_pool,Ge.zpp_pool=Qn.next,Qn.next=null),Qn.forced=!1,Qn.x=Xn,Qn.y=Hn;var ee=Qn;null==_n?_n=ee.prev=ee.next=ee:(ee.next=_n,ee.prev=_n.prev,_n.prev.next=ee,_n.prev=ee),null==_n?_n=gn.prev=gn.next=gn:(gn.next=_n,gn.prev=_n.prev,_n.prev.next=gn,_n.prev=gn);var te,ie=Ze.paths.head.elt;null==Fe.zpp_pool?te=new Fe:(te=Fe.zpp_pool,Fe.zpp_pool=te.next,te.next=null),te.vert=_n,te.parent=te,te.rank=0,te.used=!1,Ze.paths.add(te);var pe,le=Ze.paths.head.elt;null==Re.zpp_pool?pe=new Re:(pe=Re.zpp_pool,Re.zpp_pool=pe.next,pe.next=null),pe.virtualint=!1,pe.end=ne,pe.start=_n,pe.path0=ie,pe.path1=le,pe.time=Sn,pe.vertex=!1,Ze.ints.add(pe)}}if((vn=vn.next)==v)break}var re=_n.prev;re.next.prev=yn.prev,yn.prev.next=re.next,re.next=yn,yn.prev=re;var oe,ae,se=Ze.paths.head.elt;if(zn==zn.parent)oe=zn;else{for(var _e=zn,he=null;_e!=_e.parent;){var ue=_e.parent;_e.parent=he,he=_e,_e=ue}for(;null!=he;){var xe=he.parent;he.parent=_e,he=xe}oe=_e}if(se==se.parent)ae=se;else{for(var de=se,ye=null;de!=de.parent;){var ze=de.parent;de.parent=ye,ye=de,de=ze}for(;null!=ye;){var ve=ye.parent;ye.parent=de,ye=ve}ae=de}oe!=ae&&(oe.rank<ae.rank?oe.parent=ae:oe.rank>ae.rank?ae.parent=oe:(ae.parent=oe,oe.rank++));var ce=Ze.ints;if(null!=ce.head&&null!=ce.head.next){for(var fe,me,be,ge=ce.head,we=null,Me=null,Ce=null,ke=null,Oe=1;;){for(fe=0,Me=ge,we=ge=null;null!=Me;){for(++fe,Ce=Me,me=0,be=Oe;null!=Ce&&me<Oe;)++me,Ce=Ce.next;for(;me>0||be>0&&null!=Ce;)0==me?(ke=Ce,Ce=Ce.next,--be):0==be||null==Ce?(ke=Me,Me=Me.next,--me):Me.elt.time<Ce.elt.time?(ke=Me,Me=Me.next,--me):(ke=Ce,Ce=Ce.next,--be),null!=we?we.next=ke:ge=ke,we=ke;Me=Ce}if(we.next=null,Oe<<=1,!(fe>1))break}ce.head=ge,ce.modified=!0,ce.pushmod=!0}for(;null!=Ze.ints.head;){var Pe=Ze.ints.pop_unsafe(),Se=Ze.ints.pop_unsafe();if(Pe.virtualint||Se.virtualint){if(Pe.virtualint&&!Se.virtualint){var Ae,je,Ee;if(null!=Se.end&&Se.end.prev==Se.end){Se.end.next=Se.end.prev=null;var Ie=Se.end;if(null!=Ie.wrap){Ie.wrap.zpp_inner._inuse=!1;var Te=Ie.wrap,Ne=Te.zpp_inner;Te.zpp_inner.outer=null,Te.zpp_inner=null,Te.zpp_pool=xp.poolVec2,xp.poolVec2=Te,null!=Ne.outer&&(Ne.outer.zpp_inner=null,Ne.outer=null),Ne._isimmutable=null,Ne._validate=null,Ne._invalidate=null,Ne.next=xt.zpp_pool,xt.zpp_pool=Ne,Ie.wrap=null}Ie.prev=Ie.next=null,Ie.next=Ge.zpp_pool,Ge.zpp_pool=Ie,Ae=null}else{var Le=Se.end.prev;Se.end.prev.next=Se.end.next,Se.end.next.prev=Se.end.prev,Se.end.next=Se.end.prev=null;var Ve=Se.end;if(null!=Ve.wrap){Ve.wrap.zpp_inner._inuse=!1;var De=Ve.wrap,Be=De.zpp_inner;De.zpp_inner.outer=null,De.zpp_inner=null,De.zpp_pool=xp.poolVec2,xp.poolVec2=De,null!=Be.outer&&(Be.outer.zpp_inner=null,Be.outer=null),Be._isimmutable=null,Be._validate=null,Be._invalidate=null,Be.next=xt.zpp_pool,xt.zpp_pool=Be,Ve.wrap=null}Ve.prev=Ve.next=null,Ve.next=Ge.zpp_pool,Ge.zpp_pool=Ve,Se.end=null,Ae=Le}if(Se.end=Ae,!Se.vertex)if(Se.end!=Se.path0.vert){var qe;if(Se.start.x=Se.end.x,Se.start.y=Se.end.y,null!=Se.end&&Se.end.prev==Se.end){Se.end.next=Se.end.prev=null;var Ue=Se.end;if(null!=Ue.wrap){Ue.wrap.zpp_inner._inuse=!1;var Ke=Ue.wrap,We=Ke.zpp_inner;Ke.zpp_inner.outer=null,Ke.zpp_inner=null,Ke.zpp_pool=xp.poolVec2,xp.poolVec2=Ke,null!=We.outer&&(We.outer.zpp_inner=null,We.outer=null),We._isimmutable=null,We._validate=null,We._invalidate=null,We.next=xt.zpp_pool,xt.zpp_pool=We,Ue.wrap=null}Ue.prev=Ue.next=null,Ue.next=Ge.zpp_pool,Ge.zpp_pool=Ue,qe=null}else{var Ye=Se.end.prev;Se.end.prev.next=Se.end.next,Se.end.next.prev=Se.end.prev,Se.end.next=Se.end.prev=null;var Je=Se.end;if(null!=Je.wrap){Je.wrap.zpp_inner._inuse=!1;var Xe=Je.wrap,He=Xe.zpp_inner;Xe.zpp_inner.outer=null,Xe.zpp_inner=null,Xe.zpp_pool=xp.poolVec2,xp.poolVec2=Xe,null!=He.outer&&(He.outer.zpp_inner=null,He.outer=null),He._isimmutable=null,He._validate=null,He._invalidate=null,He.next=xt.zpp_pool,xt.zpp_pool=He,Je.wrap=null}Je.prev=Je.next=null,Je.next=Ge.zpp_pool,Ge.zpp_pool=Je,Se.end=null,qe=Ye}Se.end=qe}else{var $e=Se.start.next;if(Se.start.x=$e.x,Se.start.y=$e.y,null!=$e&&$e.prev==$e){$e.next=$e.prev=null;var Qe=$e;if(null!=Qe.wrap){Qe.wrap.zpp_inner._inuse=!1;var nt=Qe.wrap,et=nt.zpp_inner;nt.zpp_inner.outer=null,nt.zpp_inner=null,nt.zpp_pool=xp.poolVec2,xp.poolVec2=nt,null!=et.outer&&(et.outer.zpp_inner=null,et.outer=null),et._isimmutable=null,et._validate=null,et._invalidate=null,et.next=xt.zpp_pool,xt.zpp_pool=et,Qe.wrap=null}Qe.prev=Qe.next=null,Qe.next=Ge.zpp_pool,Ge.zpp_pool=Qe,$e=null}else{$e.prev.next=$e.next,$e.next.prev=$e.prev,$e.next=$e.prev=null;var tt=$e;if(null!=tt.wrap){tt.wrap.zpp_inner._inuse=!1;var it=tt.wrap,pt=it.zpp_inner;it.zpp_inner.outer=null,it.zpp_inner=null,it.zpp_pool=xp.poolVec2,xp.poolVec2=it,null!=pt.outer&&(pt.outer.zpp_inner=null,pt.outer=null),pt._isimmutable=null,pt._validate=null,pt._invalidate=null,pt.next=xt.zpp_pool,xt.zpp_pool=pt,tt.wrap=null}tt.prev=tt.next=null,tt.next=Ge.zpp_pool,Ge.zpp_pool=tt}}if(Se.end.next.prev=Se.start.prev,Se.start.prev.next=Se.end.next,Se.end.next=Se.start,Se.start.prev=Se.end,Se.path0==Se.path0.parent)je=Se.path0;else{for(var lt=Se.path0,rt=null;lt!=lt.parent;){var ot=lt.parent;lt.parent=rt,rt=lt,lt=ot}for(;null!=rt;){var at=rt.parent;rt.parent=lt,rt=at}je=lt}if(Se.path1==Se.path1.parent)Ee=Se.path1;else{for(var st=Se.path1,_t=null;st!=st.parent;){var ht=st.parent;st.parent=_t,_t=st,st=ht}for(;null!=_t;){var ut=_t.parent;_t.parent=st,_t=ut}Ee=st}je!=Ee&&(je.rank<Ee.rank?je.parent=Ee:je.rank>Ee.rank?Ee.parent=je:(Ee.parent=je,je.rank++))}else if(Se.virtualint&&!Pe.virtualint){var dt,yt,zt;if(null!=Pe.end&&Pe.end.prev==Pe.end){Pe.end.next=Pe.end.prev=null;var vt=Pe.end;if(null!=vt.wrap){vt.wrap.zpp_inner._inuse=!1;var ct=vt.wrap,ft=ct.zpp_inner;ct.zpp_inner.outer=null,ct.zpp_inner=null,ct.zpp_pool=xp.poolVec2,xp.poolVec2=ct,null!=ft.outer&&(ft.outer.zpp_inner=null,ft.outer=null),ft._isimmutable=null,ft._validate=null,ft._invalidate=null,ft.next=xt.zpp_pool,xt.zpp_pool=ft,vt.wrap=null}vt.prev=vt.next=null,vt.next=Ge.zpp_pool,Ge.zpp_pool=vt,dt=null}else{var mt=Pe.end.prev;Pe.end.prev.next=Pe.end.next,Pe.end.next.prev=Pe.end.prev,Pe.end.next=Pe.end.prev=null;var bt=Pe.end;if(null!=bt.wrap){bt.wrap.zpp_inner._inuse=!1;var gt=bt.wrap,wt=gt.zpp_inner;gt.zpp_inner.outer=null,gt.zpp_inner=null,gt.zpp_pool=xp.poolVec2,xp.poolVec2=gt,null!=wt.outer&&(wt.outer.zpp_inner=null,wt.outer=null),wt._isimmutable=null,wt._validate=null,wt._invalidate=null,wt.next=xt.zpp_pool,xt.zpp_pool=wt,bt.wrap=null}bt.prev=bt.next=null,bt.next=Ge.zpp_pool,Ge.zpp_pool=bt,Pe.end=null,dt=mt}if(Pe.end=dt,!Pe.vertex)if(Pe.end!=Pe.path0.vert){var Mt;if(Pe.start.x=Pe.end.x,Pe.start.y=Pe.end.y,null!=Pe.end&&Pe.end.prev==Pe.end){Pe.end.next=Pe.end.prev=null;var Ct=Pe.end;if(null!=Ct.wrap){Ct.wrap.zpp_inner._inuse=!1;var kt=Ct.wrap,Ot=kt.zpp_inner;kt.zpp_inner.outer=null,kt.zpp_inner=null,kt.zpp_pool=xp.poolVec2,xp.poolVec2=kt,null!=Ot.outer&&(Ot.outer.zpp_inner=null,Ot.outer=null),Ot._isimmutable=null,Ot._validate=null,Ot._invalidate=null,Ot.next=xt.zpp_pool,xt.zpp_pool=Ot,Ct.wrap=null}Ct.prev=Ct.next=null,Ct.next=Ge.zpp_pool,Ge.zpp_pool=Ct,Mt=null}else{var Pt=Pe.end.prev;Pe.end.prev.next=Pe.end.next,Pe.end.next.prev=Pe.end.prev,Pe.end.next=Pe.end.prev=null;var St=Pe.end;if(null!=St.wrap){St.wrap.zpp_inner._inuse=!1;var At=St.wrap,jt=At.zpp_inner;At.zpp_inner.outer=null,At.zpp_inner=null,At.zpp_pool=xp.poolVec2,xp.poolVec2=At,null!=jt.outer&&(jt.outer.zpp_inner=null,jt.outer=null),jt._isimmutable=null,jt._validate=null,jt._invalidate=null,jt.next=xt.zpp_pool,xt.zpp_pool=jt,St.wrap=null}St.prev=St.next=null,St.next=Ge.zpp_pool,Ge.zpp_pool=St,Pe.end=null,Mt=Pt}Pe.end=Mt}else{var Et=Pe.start.next;if(Pe.start.x=Et.x,Pe.start.y=Et.y,null!=Et&&Et.prev==Et){Et.next=Et.prev=null;var It=Et;if(null!=It.wrap){It.wrap.zpp_inner._inuse=!1;var Tt=It.wrap,Nt=Tt.zpp_inner;Tt.zpp_inner.outer=null,Tt.zpp_inner=null,Tt.zpp_pool=xp.poolVec2,xp.poolVec2=Tt,null!=Nt.outer&&(Nt.outer.zpp_inner=null,Nt.outer=null),Nt._isimmutable=null,Nt._validate=null,Nt._invalidate=null,Nt.next=xt.zpp_pool,xt.zpp_pool=Nt,It.wrap=null}It.prev=It.next=null,It.next=Ge.zpp_pool,Ge.zpp_pool=It,Et=null}else{Et.prev.next=Et.next,Et.next.prev=Et.prev,Et.next=Et.prev=null;var Lt=Et;if(null!=Lt.wrap){Lt.wrap.zpp_inner._inuse=!1;var Vt=Lt.wrap,Dt=Vt.zpp_inner;Vt.zpp_inner.outer=null,Vt.zpp_inner=null,Vt.zpp_pool=xp.poolVec2,xp.poolVec2=Vt,null!=Dt.outer&&(Dt.outer.zpp_inner=null,Dt.outer=null),Dt._isimmutable=null,Dt._validate=null,Dt._invalidate=null,Dt.next=xt.zpp_pool,xt.zpp_pool=Dt,Lt.wrap=null}Lt.prev=Lt.next=null,Lt.next=Ge.zpp_pool,Ge.zpp_pool=Lt}}if(Pe.end.next.prev=Pe.start.prev,Pe.start.prev.next=Pe.end.next,Pe.end.next=Pe.start,Pe.start.prev=Pe.end,Pe.path0==Pe.path0.parent)yt=Pe.path0;else{for(var Ft=Pe.path0,Rt=null;Ft!=Ft.parent;){var Zt=Ft.parent;Ft.parent=Rt,Rt=Ft,Ft=Zt}for(;null!=Rt;){var Bt=Rt.parent;Rt.parent=Ft,Rt=Bt}yt=Ft}if(Pe.path1==Pe.path1.parent)zt=Pe.path1;else{for(var Gt=Pe.path1,qt=null;Gt!=Gt.parent;){var Ut=Gt.parent;Gt.parent=qt,qt=Gt,Gt=Ut}for(;null!=qt;){var Kt=qt.parent;qt.parent=Gt,qt=Kt}zt=Gt}yt!=zt&&(yt.rank<zt.rank?yt.parent=zt:yt.rank>zt.rank?zt.parent=yt:(zt.parent=yt,yt.rank++))}}else{var Wt,Xt,Ht,$t;if(Pe.end.next.prev=Se.start.prev,Se.start.prev.next=Pe.end.next,Pe.end.next=Se.start,Se.start.prev=Pe.end,Se.end.next.prev=Pe.start.prev,Pe.start.prev.next=Se.end.next,Se.end.next=Pe.start,Pe.start.prev=Se.end,Pe.path0==Pe.path0.parent)Wt=Pe.path0;else{for(var Qt=Pe.path0,ni=null;Qt!=Qt.parent;){var ei=Qt.parent;Qt.parent=ni,ni=Qt,Qt=ei}for(;null!=ni;){var ti=ni.parent;ni.parent=Qt,ni=ti}Wt=Qt}if(Se.path1==Se.path1.parent)Xt=Se.path1;else{for(var ii=Se.path1,pi=null;ii!=ii.parent;){var li=ii.parent;ii.parent=pi,pi=ii,ii=li}for(;null!=pi;){var ri=pi.parent;pi.parent=ii,pi=ri}Xt=ii}if(Wt!=Xt&&(Wt.rank<Xt.rank?Wt.parent=Xt:Wt.rank>Xt.rank?Xt.parent=Wt:(Xt.parent=Wt,Wt.rank++)),Pe.path1==Pe.path1.parent)Ht=Pe.path1;else{for(var oi=Pe.path1,ai=null;oi!=oi.parent;){var si=oi.parent;oi.parent=ai,ai=oi,oi=si}for(;null!=ai;){var _i=ai.parent;ai.parent=oi,ai=_i}Ht=oi}if(Se.path0==Se.path0.parent)$t=Se.path0;else{for(var hi=Se.path0,ui=null;hi!=hi.parent;){var xi=hi.parent;hi.parent=ui,ui=hi,hi=xi}for(;null!=ui;){var di=ui.parent;ui.parent=hi,ui=di}$t=hi}Ht!=$t&&(Ht.rank<$t.rank?Ht.parent=$t:Ht.rank>$t.rank?$t.parent=Ht:($t.parent=Ht,Ht.rank++))}Pe.end=Pe.start=null,Pe.path0=Pe.path1=null,Pe.next=Re.zpp_pool,Re.zpp_pool=Pe,Se.end=Se.start=null,Se.path0=Se.path1=null,Se.next=Re.zpp_pool,Re.zpp_pool=Se}for(var yi=null==l?new rn:l,zi=Ze.paths.head;null!=zi;){var vi,ci=zi.elt;if(ci==ci.parent)vi=ci;else{for(var fi=ci,mi=null;fi!=fi.parent;){var bi=fi.parent;fi.parent=mi,mi=fi,fi=bi}for(;null!=mi;){var gi=mi.parent;mi.parent=fi,mi=gi}vi=fi}if(vi.used)zi=zi.next;else{vi.used=!0;for(var wi=vi.vert,Mi=!0;null!=vi.vert&&(Mi||wi!=vi.vert);)if(Mi=!1,wi.x==wi.next.x&&wi.y==wi.next.y)if(wi==vi.vert&&(vi.vert=wi.next==wi?null:wi.next,Mi=!0),null!=wi&&wi.prev==wi)wi.next=wi.prev=null,wi=wi=null;else{var Ci=wi.next;wi.prev.next=wi.next,wi.next.prev=wi.prev,wi.next=wi.prev=null,wi=null,wi=Ci}else wi=wi.next;if(null!=vi.vert){var ki=pn.get();ki.zpp_inner.vertices=vi.vert,yi.zpp_inner.reverse_flag?yi.push(ki):yi.unshift(ki)}zi=zi.next}}for(;null!=Ze.paths.head;){var Oi=Ze.paths.pop_unsafe();Oi.vert=null,Oi.parent=null,Oi.next=Fe.zpp_pool,Fe.zpp_pool=Oi}for(;null!=v;)if(null!=v&&v.prev==v){v.next=v.prev=null;var Pi=v;Pi.vert=null,Pi.parent=null,Pi.next=Fe.zpp_pool,Fe.zpp_pool=Pi,v=v=null}else{var Si=v.next;v.prev.next=v.next,v.next.prev=v.prev,v.next=v.prev=null;var Ai=v;Ai.vert=null,Ai.parent=null,Ai.next=Fe.zpp_pool,Fe.zpp_pool=Ai,v=null,v=Si}return yi},Ze.prototype.__class__=Ze;var Be=zpp_nape.geom.ZPP_Geom=function(){};Be.__name__=["zpp_nape","geom","ZPP_Geom"],Be.validateShape=function(n){if(1==n.type){var e=n.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var t=e.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var i=e.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var p=e.lverts.next,l=e.gverts.next;null!=l;){var r=l,o=p;p=p.next,r.x=e.body.posx+(e.body.axisy*o.x-e.body.axisx*o.y),r.y=e.body.posy+(o.x*e.body.axisx+o.y*e.body.axisy),l=l.next}}var a=e.edges.head,s=e.gverts.next,_=s;for(s=s.next;null!=s;){var h=s,u=a.elt;a=a.next,u.gp0=_,u.gp1=h,u.gnormx=e.body.axisy*u.lnormx-e.body.axisx*u.lnormy,u.gnormy=u.lnormx*e.body.axisx+u.lnormy*e.body.axisy,u.gprojection=e.body.posx*u.gnormx+e.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,_=h,s=s.next}var x=a.elt;x.gp0=_,x.gp1=e.gverts.next,x.gnormx=e.body.axisy*x.lnormx-e.body.axisx*x.lnormy,x.gnormy=x.lnormx*e.body.axisx+x.lnormy*e.body.axisy,x.gprojection=e.body.posx*x.gnormx+e.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var d=n.circle;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,1==d.type){var y=d.polygon;if(null==y.lverts.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y;else if(null==y.lverts.next.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y,y.localCOMx+=y.lverts.next.next.x,y.localCOMy+=y.lverts.next.next.y,y.localCOMx*=.5,y.localCOMy*=.5;else{y.localCOMx=0,y.localCOMy=0;var z=0,v=y.lverts.next,c=v,f=v=v.next;for(v=v.next;null!=v;){var m=v;z+=f.x*(m.y-c.y);var b=m.y*f.x-m.x*f.y;y.localCOMx+=(f.x+m.x)*b,y.localCOMy+=(f.y+m.y)*b,c=f,f=m,v=v.next}var g=v=y.lverts.next;z+=f.x*(g.y-c.y);var w=g.y*f.x-g.x*f.y;y.localCOMx+=(f.x+g.x)*w,y.localCOMy+=(f.y+g.y)*w,c=f;var M=v=v.next;z+=g.x*(M.y-c.y);var C=M.y*g.x-M.x*g.y;y.localCOMx+=(g.x+M.x)*C,y.localCOMy+=(g.y+M.y)*C;var k=z=1/(3*z);y.localCOMx*=k,y.localCOMy*=k}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}var O=d.body;O.zip_axis&&(O.zip_axis=!1,O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}var P=d.radius,S=d.radius;d.aabb.minx=d.worldCOMx-P,d.aabb.miny=d.worldCOMy-S,d.aabb.maxx=d.worldCOMx+P,d.aabb.maxy=d.worldCOMy+S}else{var A=n.polygon;if(A.zip_gverts&&null!=A.body){A.zip_gverts=!1,A.validate_lverts();var j=A.body;j.zip_axis&&(j.zip_axis=!1,j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot));for(var E=A.lverts.next,I=A.gverts.next;null!=I;){var T=I,N=E;E=E.next,T.x=A.body.posx+(A.body.axisy*N.x-A.body.axisx*N.y),T.y=A.body.posy+(N.x*A.body.axisx+N.y*A.body.axisy),I=I.next}}var L=A.gverts.next;A.aabb.minx=L.x,A.aabb.miny=L.y,A.aabb.maxx=L.x,A.aabb.maxy=L.y;for(var V=A.gverts.next.next;null!=V;){var D=V;D.x<A.aabb.minx&&(A.aabb.minx=D.x),D.x>A.aabb.maxx&&(A.aabb.maxx=D.x),D.y<A.aabb.miny&&(A.aabb.miny=D.y),D.y>A.aabb.maxy&&(A.aabb.maxy=D.y),V=V.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var F=n.polygon;if(null==F.lverts.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;else if(null==F.lverts.next.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y,F.localCOMx+=F.lverts.next.next.x,F.localCOMy+=F.lverts.next.next.y,F.localCOMx*=.5,F.localCOMy*=.5;else{F.localCOMx=0,F.localCOMy=0;var R=0,Z=F.lverts.next,B=Z,G=Z=Z.next;for(Z=Z.next;null!=Z;){var q=Z;R+=G.x*(q.y-B.y);var U=q.y*G.x-q.x*G.y;F.localCOMx+=(G.x+q.x)*U,F.localCOMy+=(G.y+q.y)*U,B=G,G=q,Z=Z.next}var K=Z=F.lverts.next;R+=G.x*(K.y-B.y);var W=K.y*G.x-K.x*G.y;F.localCOMx+=(G.x+K.x)*W,F.localCOMy+=(G.y+K.y)*W,B=G;var Y=Z=Z.next;R+=K.x*(Y.y-B.y);var J=Y.y*K.x-Y.x*K.y;F.localCOMx+=(K.x+Y.x)*J,F.localCOMy+=(K.y+Y.y)*J;var X=R=1/(3*R);F.localCOMx*=X,F.localCOMy*=X}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var H=n.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},Be.prototype.__class__=Be;var Ge=zpp_nape.geom.ZPP_GeomVert=function(){this.forced=!1,this.wrap=null,this.next=null,this.prev=null,this.y=0,this.x=0};Ge.__name__=["zpp_nape","geom","ZPP_GeomVert"],Ge.get=function(n,e){var t;return null==Ge.zpp_pool?t=new Ge:(t=Ge.zpp_pool,Ge.zpp_pool=t.next,t.next=null),t.forced=!1,t.x=n,t.y=e,t},Ge.prototype.x=null,Ge.prototype.y=null,Ge.prototype.prev=null,Ge.prototype.next=null,Ge.prototype.wrap=null,Ge.prototype.forced=null,Ge.prototype.free=function(){if(null!=this.wrap){this.wrap.zpp_inner._inuse=!1;var n=this.wrap,e=n.zpp_inner;n.zpp_inner.outer=null,n.zpp_inner=null,n.zpp_pool=xp.poolVec2,xp.poolVec2=n,null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=xt.zpp_pool,xt.zpp_pool=e,this.wrap=null}this.prev=this.next=null},Ge.prototype.alloc=function(){this.forced=!1},Ge.prototype.wrapper=function(){if(null==this.wrap){var n,t=this.x,i=this.y;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap=n,this.wrap.zpp_inner._inuse=!0,this.wrap.zpp_inner._invalidate=e(this,this.modwrap),this.wrap.zpp_inner._validate=e(this,this.getwrap)}return this.wrap},Ge.prototype.modwrap=function(n){this.x=n.x,this.y=n.y},Ge.prototype.getwrap=function(){this.wrap.zpp_inner.x=this.x,this.wrap.zpp_inner.y=this.y},Ge.prototype.__class__=Ge;var qe=zpp_nape.geom.ZPP_GeomPoly=function(n){this.vertices=null,this.outer=null,this.outer=n};qe.__name__=["zpp_nape","geom","ZPP_GeomPoly"],qe.prototype.outer=null,qe.prototype.vertices=null,qe.prototype.__class__=qe;var Ue=zpp_nape.geom.ZPP_GeomVertexIterator=function(){this.next=null,this.outer=null,this.forward=!1,this.first=!1,this.start=null,this.ptr=null,this.outer=new on};Ue.__name__=["zpp_nape","geom","ZPP_GeomVertexIterator"],Ue.get=function(n,e){var t;return null==Ue.zpp_pool?t=new Ue:(t=Ue.zpp_pool,Ue.zpp_pool=t.next,t.next=null),t.outer.zpp_inner=t,t.ptr=n,t.forward=e,t.start=n,t.first=null!=n,t.outer},Ue.prototype.ptr=null,Ue.prototype.start=null,Ue.prototype.first=null,Ue.prototype.forward=null,Ue.prototype.outer=null,Ue.prototype.next=null,Ue.prototype.free=function(){this.outer.zpp_inner=null,this.ptr=this.start=null},Ue.prototype.alloc=function(){},Ue.prototype.__class__=Ue;var Ke=zpp_nape.geom.ZPP_MarchSpan=function(){this.next=null,this.out=!1,this.rank=0,this.parent=null,this.parent=this};Ke.__name__=["zpp_nape","geom","ZPP_MarchSpan"],Ke.prototype.parent=null,Ke.prototype.rank=null,Ke.prototype.out=null,Ke.prototype.next=null,Ke.prototype.free=function(){this.parent=this},Ke.prototype.alloc=function(){this.out=!1,this.rank=0},Ke.prototype.__class__=Ke;var We=zpp_nape.geom.ZPP_MarchPair=function(){this.next=null,this.spanr=null,this.span2=null,this.span1=null,this.pd=null,this.okeyr=0,this.keyr=0,this.pr=null,this.okey2=0,this.key2=0,this.p2=null,this.okey1=0,this.key1=0,this.p1=null};We.__name__=["zpp_nape","geom","ZPP_MarchPair"],We.prototype.p1=null,We.prototype.key1=null,We.prototype.okey1=null,We.prototype.p2=null,We.prototype.key2=null,We.prototype.okey2=null,We.prototype.pr=null,We.prototype.keyr=null,We.prototype.okeyr=null,We.prototype.pd=null,We.prototype.span1=null,We.prototype.span2=null,We.prototype.spanr=null,We.prototype.next=null,We.prototype.free=function(){this.p1=this.p2=this.pr=this.pd=null,this.span1=this.span2=this.spanr=null},We.prototype.alloc=function(){},We.prototype.__class__=We;var Ye=zpp_nape.geom.ZPP_MarchingSquares=function(){};Ye.__name__=["zpp_nape","geom","ZPP_MarchingSquares"],Ye.isos=null,Ye.ints=null,Ye.map=null,Ye.run=function(n,e,t,i,p,l,r,o,a){var s=i-e,_=l.zpp_inner;null!=_._validate&&_._validate();var h=s/l.zpp_inner.x,u=0|h,x=p-t,d=l.zpp_inner;null!=d._validate&&d._validate();var y=x/l.zpp_inner.y,z=0|y;h!=u&&++u,y!=z&&++z,o&&(null==Ye.map?Ye.map=new Ft(u,z):Ye.map.resize(u,z,null)),null==Ye.isos?Ye.isos=new Vt(u+1,z+1):Ye.isos.resize(u+1,z+1,0);for(var v=0,c=z+1;v<c;){var f,m=v++;if(0==m)f=t;else if(m<=z){var b=l.zpp_inner;null!=b._validate&&b._validate(),f=t+l.zpp_inner.y*m}else f=p;for(var g=0,w=u+1;g<w;){var M,C=g++;if(0==C)M=e;else if(C<=u){var k=l.zpp_inner;null!=k._validate&&k._validate(),M=e+l.zpp_inner.x*C}else M=i;var O=Ye.isos,P=n(M,f);O.list[m*O.width+C]=P}}null==Ye.ints?Ye.ints=new Dt(u+1,1+(z<<1)):Ye.ints.resize(u+1,1+(z<<1),null);var S=null;o&&(null==Ke.zpp_pool?S=new Ke:(S=Ke.zpp_pool,Ke.zpp_pool=S.next,S.next=null),S.out=!1,S.rank=0);for(var A=t,j=0,E=z;j<E;){var I,T=j++,N=A;if(T==z-1)I=p;else{var L=l.zpp_inner;null!=L._validate&&L._validate(),I=t+l.zpp_inner.y*(T+1)}A=I;for(var V=e,D=null,F=0,R=u;F<R;){var Z,B=F++,G=V;if(B==u-1)Z=i;else{var q=l.zpp_inner;null!=q._validate&&q._validate(),Z=e+l.zpp_inner.x*(B+1)}V=Z;var U=Ye.me.marchSquare(n,Ye.isos,Ye.ints,G,N,Z,I,B,T,0==B||!o,0==T||!o,B==u-1||!o,T==z-1||!o,r);if(null!=U)if(o){var K=null!=U.p2&&14!=U.okey2?U.p2:U.p1;U.pd=0==(128&(K==U.p2?U.okey2:U.okey1))?K.prev:K.prev.prev;var W,Y=Ye.map;if(Y.list[T*Y.width+B]=U,null!=D){var J=U.key1,X=1&J|(192&J)>>5,H=0;0!=(1&X)&&(H=1),0!=(2&X)&&++H,0!=(4&X)&&++H,W=H>=2}else W=!1;if(W)Ye.me.combLR(D,U),U.span1=D.spanr;else{null==Ke.zpp_pool?U.span1=new Ke:(U.span1=Ke.zpp_pool,Ke.zpp_pool=U.span1.next,U.span1.next=null);var $=U.span1;$.out=!1,$.rank=0,U.span1.next=S,S=U.span1}if(null!=U.p2){null==Ke.zpp_pool?U.span2=new Ke:(U.span2=Ke.zpp_pool,Ke.zpp_pool=U.span2.next,U.span2.next=null);var Q=U.span2;Q.out=!1,Q.rank=0,U.span2.next=S,S=U.span2,U.spanr=U.span2}else U.spanr=U.span1;var nn=(28&U.keyr)>>2,en=0;0!=(1&nn)&&(en=1),0!=(2&nn)&&++en,0!=(4&nn)&&++en,D=en>=2?U:null}else Ye.me.output(a,U.p1),null!=U.p2&&Ye.me.output(a,U.p2),U.p1=U.p2=U.pr=U.pd=null,U.span1=U.span2=U.spanr=null,U.next=We.zpp_pool,We.zpp_pool=U;else D=null}}if(o){for(var tn=1,pn=z;tn<pn;)for(var ln=tn++,rn=null,on=0,an=u;on<an;){var sn=on++,_n=Ye.map,hn=_n.list[ln*_n.width+sn];if(null!=hn){var un=7&(null!=hn.p2&&14==hn.okey2?hn.okey2:hn.okey1),xn=0;if(0!=(1&un)&&(xn=1),0!=(2&un)&&++xn,0!=(4&un)&&++xn,xn<2)rn=null;else{var dn=Ye.map,yn=dn.list[(ln-1)*dn.width+sn];if(null!=yn){var zn=(112&(null!=yn.p2&&56==yn.okey2?yn.okey2:yn.okey1))>>4,vn=0;if(0!=(1&zn)&&(vn=1),0!=(2&zn)&&++vn,0!=(4&zn)&&++vn,vn<2)rn=null;else{var cn,fn,mn=null!=yn.p2&&56==yn.okey2?yn.span2:yn.span1,bn=null!=hn.p2&&14==hn.okey2?hn.span2:hn.span1;if(mn==mn.parent)cn=mn;else{for(var gn=mn,wn=null;gn!=gn.parent;){var Mn=gn.parent;gn.parent=wn,wn=gn,gn=Mn}for(;null!=wn;){var Cn=wn.parent;wn.parent=gn,wn=Cn}cn=gn}if(bn==bn.parent)fn=bn;else{for(var kn=bn,On=null;kn!=kn.parent;){var Pn=kn.parent;kn.parent=On,On=kn,kn=Pn}for(;null!=On;){var Sn=On.parent;On.parent=kn,On=Sn}fn=kn}if(cn==fn)rn!=bn&&Ye.me.combUD_virtual(yn,hn);else{var An,jn;if(mn==mn.parent)An=mn;else{for(var En=mn,In=null;En!=En.parent;){var Tn=En.parent;En.parent=In,In=En,En=Tn}for(;null!=In;){var Nn=In.parent;In.parent=En,In=Nn}An=En}if(bn==bn.parent)jn=bn;else{for(var Ln=bn,Vn=null;Ln!=Ln.parent;){var Dn=Ln.parent;Ln.parent=Vn,Vn=Ln,Ln=Dn}for(;null!=Vn;){var Fn=Vn.parent;Vn.parent=Ln,Vn=Fn}jn=Ln}An!=jn&&(An.rank<jn.rank?An.parent=jn:An.rank>jn.rank?jn.parent=An:(jn.parent=An,An.rank++)),Ye.me.combUD(yn,hn)}rn=0!=(4&(bn==hn.span2?hn.okey2:hn.okey1))?bn:null}}else rn=null}}else rn=null}for(var Rn=0,Zn=z;Rn<Zn;)for(var Bn=Rn++,Gn=0,qn=u;Gn<qn;){var Un=Gn++,Kn=Ye.map,Wn=Kn.list[Bn*Kn.width+Un];if(null!=Wn){var Yn;if(Wn.span1==Wn.span1.parent)Yn=Wn.span1;else{for(var Jn=Wn.span1,Xn=null;Jn!=Jn.parent;){var Hn=Jn.parent;Jn.parent=Xn,Xn=Jn,Jn=Hn}for(;null!=Xn;){var $n=Xn.parent;Xn.parent=Jn,Xn=$n}Yn=Jn}if(Yn.out||(Yn.out=!0,Ye.me.output(a,Wn.p1)),null!=Wn.p2){if(Wn.span2==Wn.span2.parent)Yn=Wn.span2;else{for(var Qn=Wn.span2,ne=null;Qn!=Qn.parent;){var ee=Qn.parent;Qn.parent=ne,ne=Qn,Qn=ee}for(;null!=ne;){var te=ne.parent;ne.parent=Qn,ne=te}Yn=Qn}Yn.out||(Yn.out=!0,Ye.me.output(a,Wn.p2))}Wn.p1=Wn.p2=Wn.pr=Wn.pd=null,Wn.span1=Wn.span2=Wn.spanr=null,Wn.next=We.zpp_pool,We.zpp_pool=Wn;var ie=Ye.map;ie.list[Bn*ie.width+Un]=null}}for(;null!=S;){var pe=S;S=pe.next,pe.parent=pe,pe.next=Ke.zpp_pool,Ke.zpp_pool=pe}}},Ye.ISO=function(n,e,t){return n(e,t)},Ye.prototype.output=function(n,e){var t;if(null==e||e.next==e||e.next==e.prev)t=!0;else{var i=0,p=e;if(null!=e)for(var l=e;;){var r=l;if(i+=r.x*(r.next.y-r.prev.y),(l=l.next)==p)break}var a=.5*i;t=a*a<o.epsilon*o.epsilon}if(t)for(;null!=e;)if(null!=e&&e.prev==e)e.next=e.prev=null,e=e=null;else{var s=e.next;e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null,e=null,e=s}else{var _=pn.get();_.zpp_inner.vertices=e,n.zpp_inner.reverse_flag?n.push(_):n.unshift(_)}},Ye.prototype.linkright=function(n,e){var t=7&e;return 0==t?n:3==t?n.next.next:n.next},Ye.prototype.linkleft=function(n,e){return 0==(1&e)?n.prev:n},Ye.prototype.linkdown=function(n,e){return 0==(128&e)?n.prev:n.prev.prev},Ye.prototype.linkup=function(n,e){return n},Ye.prototype.combLR=function(n,e){var t=n.pr,i=7&n.okeyr,p=0==i?t:3==i?t.next.next:t.next,l=e.p1,r=0==(1&e.okey1)?l.prev:l,o=p.next,a=r.prev;if(0!=(4&n.keyr)){e.pr==e.p1&&(e.pr=p.prev),e.p1=p.prev,p.prev.next=r.next,r.next.prev=p.prev;var s=p;if(null!=s.wrap){s.wrap.zpp_inner._inuse=!1;var _=s.wrap,h=_.zpp_inner;_.zpp_inner.outer=null,_.zpp_inner=null,_.zpp_pool=xp.poolVec2,xp.poolVec2=_,null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h._isimmutable=null,h._validate=null,h._invalidate=null,h.next=xt.zpp_pool,xt.zpp_pool=h,s.wrap=null}s.prev=s.next=null,s.next=Ge.zpp_pool,Ge.zpp_pool=s}else p.next=r.next,r.next.prev=p;var u=r;if(null!=u.wrap){u.wrap.zpp_inner._inuse=!1;var x=u.wrap,d=x.zpp_inner;x.zpp_inner.outer=null,x.zpp_inner=null,x.zpp_pool=xp.poolVec2,xp.poolVec2=x,null!=d.outer&&(d.outer.zpp_inner=null,d.outer=null),d._isimmutable=null,d._validate=null,d._invalidate=null,d.next=xt.zpp_pool,xt.zpp_pool=d,u.wrap=null}if(u.prev=u.next=null,u.next=Ge.zpp_pool,Ge.zpp_pool=u,0!=(16&n.keyr)){if(e.pd=o.next,o.next.prev=a.prev,a.prev.next=o.next,null!=o.wrap){o.wrap.zpp_inner._inuse=!1;var y=o.wrap,z=y.zpp_inner;y.zpp_inner.outer=null,y.zpp_inner=null,y.zpp_pool=xp.poolVec2,xp.poolVec2=y,null!=z.outer&&(z.outer.zpp_inner=null,z.outer=null),z._isimmutable=null,z._validate=null,z._invalidate=null,z.next=xt.zpp_pool,xt.zpp_pool=z,o.wrap=null}o.prev=o.next=null,o.next=Ge.zpp_pool,Ge.zpp_pool=o}else o.prev=a.prev,a.prev.next=o;if(null!=a.wrap){a.wrap.zpp_inner._inuse=!1;var v=a.wrap,c=v.zpp_inner;v.zpp_inner.outer=null,v.zpp_inner=null,v.zpp_pool=xp.poolVec2,xp.poolVec2=v,null!=c.outer&&(c.outer.zpp_inner=null,c.outer=null),c._isimmutable=null,c._validate=null,c._invalidate=null,c.next=xt.zpp_pool,xt.zpp_pool=c,a.wrap=null}a.prev=a.next=null,a.next=Ge.zpp_pool,Ge.zpp_pool=a},Ye.prototype.combUD=function(n,e){null!=n.p2&&n.key2;var t=null!=e.p2&&14==e.key2?e.p2:e.p1,i=n.pd,p=t,l=i.prev,r=p.next;if(p.next=i.next,i.next.prev=p,null!=i.wrap){i.wrap.zpp_inner._inuse=!1;var o=i.wrap,a=o.zpp_inner;o.zpp_inner.outer=null,o.zpp_inner=null,o.zpp_pool=xp.poolVec2,xp.poolVec2=o,null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a._isimmutable=null,a._validate=null,a._invalidate=null,a.next=xt.zpp_pool,xt.zpp_pool=a,i.wrap=null}if(i.prev=i.next=null,i.next=Ge.zpp_pool,Ge.zpp_pool=i,r.prev=l.prev,l.prev.next=r,l==n.p1&&(n.p1=r),null!=l.wrap){l.wrap.zpp_inner._inuse=!1;var s=l.wrap,_=s.zpp_inner;s.zpp_inner.outer=null,s.zpp_inner=null,s.zpp_pool=xp.poolVec2,xp.poolVec2=s,null!=_.outer&&(_.outer.zpp_inner=null,_.outer=null),_._isimmutable=null,_._validate=null,_._invalidate=null,_.next=xt.zpp_pool,xt.zpp_pool=_,l.wrap=null}l.prev=l.next=null,l.next=Ge.zpp_pool,Ge.zpp_pool=l},Ye.prototype.combUD_virtual=function(n,e){null!=n.p2&&n.key2;var t=null!=e.p2&&14==e.key2?e.p2:e.p1,i=n.pd,p=t;i.forced=p.forced=i.prev.forced=p.next.forced=!0},Ye.prototype.combLeft=function(n){var e=1&n|(192&n)>>5,t=0;return 0!=(1&e)&&(t=1),0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},Ye.prototype.combRight=function(n){var e=(28&n)>>2,t=0;return 0!=(1&e)&&(t=1),0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},Ye.prototype.combUp=function(n){var e=7&n,t=0;return 0!=(1&e)&&(t=1),0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},Ye.prototype.combDown=function(n){var e=(112&n)>>4,t=0;return 0!=(1&e)&&(t=1),0!=(2&e)&&++t,0!=(4&e)&&++t,t>=2},Ye.prototype.comb=function(n){var e=0;return 0!=(1&n)&&(e=1),0!=(2&n)&&++e,0!=(4&n)&&++e,e>=2},Ye.prototype.marchSquare=function(n,e,t,i,p,l,r,o,a,s,_,h,u,x){var d=0,y=e.list[a*e.width+o];y<0&&(d=8);var z=e.list[a*e.width+(o+1)];z<0&&(d|=4);var v=e.list[(a+1)*e.width+(o+1)];v<0&&(d|=2);var c,f=e.list[(a+1)*e.width+o];if(f<0&&(d|=1),0==d)return null;if(null==We.zpp_pool?c=new We:(c=We.zpp_pool,We.zpp_pool=c.next,c.next=null),10!=d&&5!=d){var m=Ye.look_march[d];c.okey1=m;for(var b=0;b<8;){var g=b++;if(0!=(m&1<<g)){var w,M,C,k,O=null;if(0==g)null==Ge.zpp_pool?w=new Ge:(w=Ge.zpp_pool,Ge.zpp_pool=w.next,w.next=null),w.forced=!1,w.x=i,w.y=p,O=w,(s||_)&&(O.forced=!0);else if(2==g)null==Ge.zpp_pool?M=new Ge:(M=Ge.zpp_pool,Ge.zpp_pool=M.next,M.next=null),M.forced=!1,M.x=l,M.y=p,O=M,(h||_)&&(O.forced=!0);else if(4==g)null==Ge.zpp_pool?C=new Ge:(C=Ge.zpp_pool,Ge.zpp_pool=C.next,C.next=null),C.forced=!1,C.x=l,C.y=r,O=C,(h||u)&&(O.forced=!0);else if(6==g)null==Ge.zpp_pool?k=new Ge:(k=Ge.zpp_pool,Ge.zpp_pool=k.next,k.next=null),k.forced=!1,k.x=i,k.y=r,O=k,(s||u)&&(O.forced=!0);else if(1==g){if(null==(O=t.list[(a<<1)*t.width+o])){var P,S=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?P=new Ge:(P=Ge.zpp_pool,Ge.zpp_pool=P.next,P.next=null),P.forced=!1,P.x=S,P.y=p,O=P,t.list[(a<<1)*t.width+o]=O}else{var A,j=O.x,E=O.y;null==Ge.zpp_pool?A=new Ge:(A=Ge.zpp_pool,Ge.zpp_pool=A.next,A.next=null),A.forced=!1,A.x=j,A.y=E,O=A}_&&(O.forced=!0),O.x!=i&&O.x!=l||(O.x==i&&0!=(1&m)||O.x==l&&0!=(4&m))&&(m^=2)}else if(5==g){if(null==(O=t.list[(2+(a<<1))*t.width+o])){var I,T=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?I=new Ge:(I=Ge.zpp_pool,Ge.zpp_pool=I.next,I.next=null),I.forced=!1,I.x=T,I.y=r,O=I,t.list[(2+(a<<1))*t.width+o]=O}else{var N,L=O.x,V=O.y;null==Ge.zpp_pool?N=new Ge:(N=Ge.zpp_pool,Ge.zpp_pool=N.next,N.next=null),N.forced=!1,N.x=L,N.y=V,O=N}u&&(O.forced=!0),O.x!=i&&O.x!=l||(O.x==i&&0!=(64&m)||O.x==l&&0!=(16&m))&&(m^=32)}else if(3==g){if(null==(O=t.list[(1+(a<<1))*t.width+(o+1)])){var D,F=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?D=new Ge:(D=Ge.zpp_pool,Ge.zpp_pool=D.next,D.next=null),D.forced=!1,D.x=l,D.y=F,O=D,t.list[(1+(a<<1))*t.width+(o+1)]=O}else{var R,Z=O.x,B=O.y;null==Ge.zpp_pool?R=new Ge:(R=Ge.zpp_pool,Ge.zpp_pool=R.next,R.next=null),R.forced=!1,R.x=Z,R.y=B,O=R}h&&(O.forced=!0),O.y!=p&&O.y!=r||(O.y==p&&0!=(4&m)||O.y==r&&0!=(16&m))&&(m^=8)}else{if(null==(O=t.list[(1+(a<<1))*t.width+o])){var G,q=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?G=new Ge:(G=Ge.zpp_pool,Ge.zpp_pool=G.next,G.next=null),G.forced=!1,G.x=i,G.y=q,O=G,t.list[(1+(a<<1))*t.width+o]=O}else{var U,K=O.x,W=O.y;null==Ge.zpp_pool?U=new Ge:(U=Ge.zpp_pool,Ge.zpp_pool=U.next,U.next=null),U.forced=!1,U.x=K,U.y=W,O=U}s&&(O.forced=!0),O.y!=p&&O.y!=r||(O.y==p&&0!=(1&m)||O.y==r&&0!=(64&m))&&(m^=128)}var Y=O;null==c.p1?c.p1=Y.prev=Y.next=Y:(Y.prev=c.p1,Y.next=c.p1.next,c.p1.next.prev=Y,c.p1.next=Y),c.p1=Y}}c.p1=c.p1.next,c.key1=m,1!=m&&4!=m&&16!=m&&64!=m&&3!=m&&12!=m&&48!=m&&192!=m&&129!=m&&6!=m&&24!=m&&96!=m&&5!=m&&20!=m&&80!=m&&65!=m&&17!=m&&68!=m||(m=0,c.key1=0,c.p1=null),0==m?c=null:(c.pr=c.p1,c.okeyr=c.okey1,c.keyr=c.key1)}else{var J=n(.5*(i+l),.5*(p+r))<0;if(10==d)if(J){var X=187;c.okey1=187;for(var H=0;H<8;){var $=H++;if(0!=(X&1<<$)){var Q,nn,en,tn,pn=null;if(0==$)null==Ge.zpp_pool?Q=new Ge:(Q=Ge.zpp_pool,Ge.zpp_pool=Q.next,Q.next=null),Q.forced=!1,Q.x=i,Q.y=p,pn=Q,(s||_)&&(pn.forced=!0);else if(2==$)null==Ge.zpp_pool?nn=new Ge:(nn=Ge.zpp_pool,Ge.zpp_pool=nn.next,nn.next=null),nn.forced=!1,nn.x=l,nn.y=p,pn=nn,(h||_)&&(pn.forced=!0);else if(4==$)null==Ge.zpp_pool?en=new Ge:(en=Ge.zpp_pool,Ge.zpp_pool=en.next,en.next=null),en.forced=!1,en.x=l,en.y=r,pn=en,(h||u)&&(pn.forced=!0);else if(6==$)null==Ge.zpp_pool?tn=new Ge:(tn=Ge.zpp_pool,Ge.zpp_pool=tn.next,tn.next=null),tn.forced=!1,tn.x=i,tn.y=r,pn=tn,(s||u)&&(pn.forced=!0);else if(1==$){if(null==(pn=t.list[(a<<1)*t.width+o])){var ln,rn=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?ln=new Ge:(ln=Ge.zpp_pool,Ge.zpp_pool=ln.next,ln.next=null),ln.forced=!1,ln.x=rn,ln.y=p,pn=ln,t.list[(a<<1)*t.width+o]=pn}else{var on,an=pn.x,sn=pn.y;null==Ge.zpp_pool?on=new Ge:(on=Ge.zpp_pool,Ge.zpp_pool=on.next,on.next=null),on.forced=!1,on.x=an,on.y=sn,pn=on}_&&(pn.forced=!0),pn.x!=i&&pn.x!=l||(pn.x==i&&0!=(1&X)||pn.x==l&&0!=(4&X))&&(X^=2)}else if(5==$){if(null==(pn=t.list[(2+(a<<1))*t.width+o])){var _n,hn=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?_n=new Ge:(_n=Ge.zpp_pool,Ge.zpp_pool=_n.next,_n.next=null),_n.forced=!1,_n.x=hn,_n.y=r,pn=_n,t.list[(2+(a<<1))*t.width+o]=pn}else{var un,xn=pn.x,dn=pn.y;null==Ge.zpp_pool?un=new Ge:(un=Ge.zpp_pool,Ge.zpp_pool=un.next,un.next=null),un.forced=!1,un.x=xn,un.y=dn,pn=un}u&&(pn.forced=!0),pn.x!=i&&pn.x!=l||(pn.x==i&&0!=(64&X)||pn.x==l&&0!=(16&X))&&(X^=32)}else if(3==$){if(null==(pn=t.list[(1+(a<<1))*t.width+(o+1)])){var yn,zn=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?yn=new Ge:(yn=Ge.zpp_pool,Ge.zpp_pool=yn.next,yn.next=null),yn.forced=!1,yn.x=l,yn.y=zn,pn=yn,t.list[(1+(a<<1))*t.width+(o+1)]=pn}else{var vn,cn=pn.x,fn=pn.y;null==Ge.zpp_pool?vn=new Ge:(vn=Ge.zpp_pool,Ge.zpp_pool=vn.next,vn.next=null),vn.forced=!1,vn.x=cn,vn.y=fn,pn=vn}h&&(pn.forced=!0),pn.y!=p&&pn.y!=r||(pn.y==p&&0!=(4&X)||pn.y==r&&0!=(16&X))&&(X^=8)}else{if(null==(pn=t.list[(1+(a<<1))*t.width+o])){var mn,bn=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?mn=new Ge:(mn=Ge.zpp_pool,Ge.zpp_pool=mn.next,mn.next=null),mn.forced=!1,mn.x=i,mn.y=bn,pn=mn,t.list[(1+(a<<1))*t.width+o]=pn}else{var gn,wn=pn.x,Mn=pn.y;null==Ge.zpp_pool?gn=new Ge:(gn=Ge.zpp_pool,Ge.zpp_pool=gn.next,gn.next=null),gn.forced=!1,gn.x=wn,gn.y=Mn,pn=gn}s&&(pn.forced=!0),pn.y!=p&&pn.y!=r||(pn.y==p&&0!=(1&X)||pn.y==r&&0!=(64&X))&&(X^=128)}var Cn=pn;null==c.p1?c.p1=Cn.prev=Cn.next=Cn:(Cn.prev=c.p1,Cn.next=c.p1.next,c.p1.next.prev=Cn,c.p1.next=Cn),c.p1=Cn}}c.p1=c.p1.next,c.key1=X,1!=X&&4!=X&&16!=X&&64!=X&&3!=X&&12!=X&&48!=X&&192!=X&&129!=X&&6!=X&&24!=X&&96!=X&&5!=X&&20!=X&&80!=X&&65!=X&&17!=X&&68!=X||(X=0,c.key1=0,c.p1=null),0==X?c=null:(c.pr=c.p1,c.okeyr=c.okey1,c.keyr=c.key1)}else{var kn=131;c.okey1=131;for(var On=0;On<8;){var Pn=On++;if(0!=(kn&1<<Pn)){var Sn,An,jn,En,In=null;if(0==Pn)null==Ge.zpp_pool?Sn=new Ge:(Sn=Ge.zpp_pool,Ge.zpp_pool=Sn.next,Sn.next=null),Sn.forced=!1,Sn.x=i,Sn.y=p,In=Sn,(s||_)&&(In.forced=!0);else if(2==Pn)null==Ge.zpp_pool?An=new Ge:(An=Ge.zpp_pool,Ge.zpp_pool=An.next,An.next=null),An.forced=!1,An.x=l,An.y=p,In=An,(h||_)&&(In.forced=!0);else if(4==Pn)null==Ge.zpp_pool?jn=new Ge:(jn=Ge.zpp_pool,Ge.zpp_pool=jn.next,jn.next=null),jn.forced=!1,jn.x=l,jn.y=r,In=jn,(h||u)&&(In.forced=!0);else if(6==Pn)null==Ge.zpp_pool?En=new Ge:(En=Ge.zpp_pool,Ge.zpp_pool=En.next,En.next=null),En.forced=!1,En.x=i,En.y=r,In=En,(s||u)&&(In.forced=!0);else if(1==Pn){if(null==(In=t.list[(a<<1)*t.width+o])){var Tn,Nn=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?Tn=new Ge:(Tn=Ge.zpp_pool,Ge.zpp_pool=Tn.next,Tn.next=null),Tn.forced=!1,Tn.x=Nn,Tn.y=p,In=Tn,t.list[(a<<1)*t.width+o]=In}else{var Ln,Vn=In.x,Dn=In.y;null==Ge.zpp_pool?Ln=new Ge:(Ln=Ge.zpp_pool,Ge.zpp_pool=Ln.next,Ln.next=null),Ln.forced=!1,Ln.x=Vn,Ln.y=Dn,In=Ln}_&&(In.forced=!0),In.x!=i&&In.x!=l||(In.x==i&&0!=(1&kn)||In.x==l&&0!=(4&kn))&&(kn^=2)}else if(5==Pn){if(null==(In=t.list[(2+(a<<1))*t.width+o])){var Fn,Rn=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?Fn=new Ge:(Fn=Ge.zpp_pool,Ge.zpp_pool=Fn.next,Fn.next=null),Fn.forced=!1,Fn.x=Rn,Fn.y=r,In=Fn,t.list[(2+(a<<1))*t.width+o]=In}else{var Zn,Bn=In.x,Gn=In.y;null==Ge.zpp_pool?Zn=new Ge:(Zn=Ge.zpp_pool,Ge.zpp_pool=Zn.next,Zn.next=null),Zn.forced=!1,Zn.x=Bn,Zn.y=Gn,In=Zn}u&&(In.forced=!0),In.x!=i&&In.x!=l||(In.x==i&&0!=(64&kn)||In.x==l&&0!=(16&kn))&&(kn^=32)}else if(3==Pn){if(null==(In=t.list[(1+(a<<1))*t.width+(o+1)])){var qn,Un=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?qn=new Ge:(qn=Ge.zpp_pool,Ge.zpp_pool=qn.next,qn.next=null),qn.forced=!1,qn.x=l,qn.y=Un,In=qn,t.list[(1+(a<<1))*t.width+(o+1)]=In}else{var Kn,Wn=In.x,Yn=In.y;null==Ge.zpp_pool?Kn=new Ge:(Kn=Ge.zpp_pool,Ge.zpp_pool=Kn.next,Kn.next=null),Kn.forced=!1,Kn.x=Wn,Kn.y=Yn,In=Kn}h&&(In.forced=!0),In.y!=p&&In.y!=r||(In.y==p&&0!=(4&kn)||In.y==r&&0!=(16&kn))&&(kn^=8)}else{if(null==(In=t.list[(1+(a<<1))*t.width+o])){var Jn,Xn=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?Jn=new Ge:(Jn=Ge.zpp_pool,Ge.zpp_pool=Jn.next,Jn.next=null),Jn.forced=!1,Jn.x=i,Jn.y=Xn,In=Jn,t.list[(1+(a<<1))*t.width+o]=In}else{var Hn,$n=In.x,Qn=In.y;null==Ge.zpp_pool?Hn=new Ge:(Hn=Ge.zpp_pool,Ge.zpp_pool=Hn.next,Hn.next=null),Hn.forced=!1,Hn.x=$n,Hn.y=Qn,In=Hn}s&&(In.forced=!0),In.y!=p&&In.y!=r||(In.y==p&&0!=(1&kn)||In.y==r&&0!=(64&kn))&&(kn^=128)}var ne=In;null==c.p1?c.p1=ne.prev=ne.next=ne:(ne.prev=c.p1,ne.next=c.p1.next,c.p1.next.prev=ne,c.p1.next=ne),c.p1=ne}}if(c.p1=c.p1.next,c.key1=kn,1!=kn&&4!=kn&&16!=kn&&64!=kn&&3!=kn&&12!=kn&&48!=kn&&192!=kn&&129!=kn&&6!=kn&&24!=kn&&96!=kn&&5!=kn&&20!=kn&&80!=kn&&65!=kn&&17!=kn&&68!=kn||(kn=0,c.key1=0,c.p1=null),0!=kn){var ee=56;c.okey2=56;for(var te=0;te<8;){var ie=te++;if(0!=(ee&1<<ie)){var pe,le,re,oe,ae=null;if(0==ie)null==Ge.zpp_pool?pe=new Ge:(pe=Ge.zpp_pool,Ge.zpp_pool=pe.next,pe.next=null),pe.forced=!1,pe.x=i,pe.y=p,ae=pe,(s||_)&&(ae.forced=!0);else if(2==ie)null==Ge.zpp_pool?le=new Ge:(le=Ge.zpp_pool,Ge.zpp_pool=le.next,le.next=null),le.forced=!1,le.x=l,le.y=p,ae=le,(h||_)&&(ae.forced=!0);else if(4==ie)null==Ge.zpp_pool?re=new Ge:(re=Ge.zpp_pool,Ge.zpp_pool=re.next,re.next=null),re.forced=!1,re.x=l,re.y=r,ae=re,(h||u)&&(ae.forced=!0);else if(6==ie)null==Ge.zpp_pool?oe=new Ge:(oe=Ge.zpp_pool,Ge.zpp_pool=oe.next,oe.next=null),oe.forced=!1,oe.x=i,oe.y=r,ae=oe,(s||u)&&(ae.forced=!0);else if(1==ie){if(null==(ae=t.list[(a<<1)*t.width+o])){var se,_e=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?se=new Ge:(se=Ge.zpp_pool,Ge.zpp_pool=se.next,se.next=null),se.forced=!1,se.x=_e,se.y=p,ae=se,t.list[(a<<1)*t.width+o]=ae}else{var he,ue=ae.x,xe=ae.y;null==Ge.zpp_pool?he=new Ge:(he=Ge.zpp_pool,Ge.zpp_pool=he.next,he.next=null),he.forced=!1,he.x=ue,he.y=xe,ae=he}_&&(ae.forced=!0),ae.x!=i&&ae.x!=l||(ae.x==i&&0!=(1&ee)||ae.x==l&&0!=(4&ee))&&(ee^=2)}else if(5==ie){if(null==(ae=t.list[(2+(a<<1))*t.width+o])){var de,ye=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?de=new Ge:(de=Ge.zpp_pool,Ge.zpp_pool=de.next,de.next=null),de.forced=!1,de.x=ye,de.y=r,ae=de,t.list[(2+(a<<1))*t.width+o]=ae}else{var ze,ve=ae.x,ce=ae.y;null==Ge.zpp_pool?ze=new Ge:(ze=Ge.zpp_pool,Ge.zpp_pool=ze.next,ze.next=null),ze.forced=!1,ze.x=ve,ze.y=ce,ae=ze}u&&(ae.forced=!0),ae.x!=i&&ae.x!=l||(ae.x==i&&0!=(64&ee)||ae.x==l&&0!=(16&ee))&&(ee^=32)}else if(3==ie){if(null==(ae=t.list[(1+(a<<1))*t.width+(o+1)])){var fe,me=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?fe=new Ge:(fe=Ge.zpp_pool,Ge.zpp_pool=fe.next,fe.next=null),fe.forced=!1,fe.x=l,fe.y=me,ae=fe,t.list[(1+(a<<1))*t.width+(o+1)]=ae}else{var be,ge=ae.x,we=ae.y;null==Ge.zpp_pool?be=new Ge:(be=Ge.zpp_pool,Ge.zpp_pool=be.next,be.next=null),be.forced=!1,be.x=ge,be.y=we,ae=be}h&&(ae.forced=!0),ae.y!=p&&ae.y!=r||(ae.y==p&&0!=(4&ee)||ae.y==r&&0!=(16&ee))&&(ee^=8)}else{if(null==(ae=t.list[(1+(a<<1))*t.width+o])){var Me,Ce=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?Me=new Ge:(Me=Ge.zpp_pool,Ge.zpp_pool=Me.next,Me.next=null),Me.forced=!1,Me.x=i,Me.y=Ce,ae=Me,t.list[(1+(a<<1))*t.width+o]=ae}else{var ke,Oe=ae.x,Pe=ae.y;null==Ge.zpp_pool?ke=new Ge:(ke=Ge.zpp_pool,Ge.zpp_pool=ke.next,ke.next=null),ke.forced=!1,ke.x=Oe,ke.y=Pe,ae=ke}s&&(ae.forced=!0),ae.y!=p&&ae.y!=r||(ae.y==p&&0!=(1&ee)||ae.y==r&&0!=(64&ee))&&(ee^=128)}var Se=ae;null==c.p2?c.p2=Se.prev=Se.next=Se:(Se.prev=c.p2,Se.next=c.p2.next,c.p2.next.prev=Se,c.p2.next=Se),c.p2=Se}}c.p2=c.p2.next,c.key2=ee,1!=ee&&4!=ee&&16!=ee&&64!=ee&&3!=ee&&12!=ee&&48!=ee&&192!=ee&&129!=ee&&6!=ee&&24!=ee&&96!=ee&&5!=ee&&20!=ee&&80!=ee&&65!=ee&&17!=ee&&68!=ee||(ee=0,c.key2=0,c.p2=null),0==ee?(c.pr=c.p1,c.okeyr=c.okey1,c.keyr=c.key1):(c.pr=c.p2,c.okeyr=c.okey2,c.keyr=c.key2)}else{var Ae=56;c.okey1=56;for(var je=0;je<8;){var Ee=je++;if(0!=(Ae&1<<Ee)){var Ie,Te,Ne,Le,Ve=null;if(0==Ee)null==Ge.zpp_pool?Ie=new Ge:(Ie=Ge.zpp_pool,Ge.zpp_pool=Ie.next,Ie.next=null),Ie.forced=!1,Ie.x=i,Ie.y=p,Ve=Ie,(s||_)&&(Ve.forced=!0);else if(2==Ee)null==Ge.zpp_pool?Te=new Ge:(Te=Ge.zpp_pool,Ge.zpp_pool=Te.next,Te.next=null),Te.forced=!1,Te.x=l,Te.y=p,Ve=Te,(h||_)&&(Ve.forced=!0);else if(4==Ee)null==Ge.zpp_pool?Ne=new Ge:(Ne=Ge.zpp_pool,Ge.zpp_pool=Ne.next,Ne.next=null),Ne.forced=!1,Ne.x=l,Ne.y=r,Ve=Ne,(h||u)&&(Ve.forced=!0);else if(6==Ee)null==Ge.zpp_pool?Le=new Ge:(Le=Ge.zpp_pool,Ge.zpp_pool=Le.next,Le.next=null),Le.forced=!1,Le.x=i,Le.y=r,Ve=Le,(s||u)&&(Ve.forced=!0);else if(1==Ee){if(null==(Ve=t.list[(a<<1)*t.width+o])){var De,Fe=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?De=new Ge:(De=Ge.zpp_pool,Ge.zpp_pool=De.next,De.next=null),De.forced=!1,De.x=Fe,De.y=p,Ve=De,t.list[(a<<1)*t.width+o]=Ve}else{var Re,Ze=Ve.x,Be=Ve.y;null==Ge.zpp_pool?Re=new Ge:(Re=Ge.zpp_pool,Ge.zpp_pool=Re.next,Re.next=null),Re.forced=!1,Re.x=Ze,Re.y=Be,Ve=Re}_&&(Ve.forced=!0),Ve.x!=i&&Ve.x!=l||(Ve.x==i&&0!=(1&Ae)||Ve.x==l&&0!=(4&Ae))&&(Ae^=2)}else if(5==Ee){if(null==(Ve=t.list[(2+(a<<1))*t.width+o])){var qe,Ue=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?qe=new Ge:(qe=Ge.zpp_pool,Ge.zpp_pool=qe.next,qe.next=null),qe.forced=!1,qe.x=Ue,qe.y=r,Ve=qe,t.list[(2+(a<<1))*t.width+o]=Ve}else{var Ke,Je=Ve.x,Xe=Ve.y;null==Ge.zpp_pool?Ke=new Ge:(Ke=Ge.zpp_pool,Ge.zpp_pool=Ke.next,Ke.next=null),Ke.forced=!1,Ke.x=Je,Ke.y=Xe,Ve=Ke}u&&(Ve.forced=!0),Ve.x!=i&&Ve.x!=l||(Ve.x==i&&0!=(64&Ae)||Ve.x==l&&0!=(16&Ae))&&(Ae^=32)}else if(3==Ee){if(null==(Ve=t.list[(1+(a<<1))*t.width+(o+1)])){var He,$e=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?He=new Ge:(He=Ge.zpp_pool,Ge.zpp_pool=He.next,He.next=null),He.forced=!1,He.x=l,He.y=$e,Ve=He,t.list[(1+(a<<1))*t.width+(o+1)]=Ve}else{var Qe,nt=Ve.x,et=Ve.y;null==Ge.zpp_pool?Qe=new Ge:(Qe=Ge.zpp_pool,Ge.zpp_pool=Qe.next,Qe.next=null),Qe.forced=!1,Qe.x=nt,Qe.y=et,Ve=Qe}h&&(Ve.forced=!0),Ve.y!=p&&Ve.y!=r||(Ve.y==p&&0!=(4&Ae)||Ve.y==r&&0!=(16&Ae))&&(Ae^=8)}else{if(null==(Ve=t.list[(1+(a<<1))*t.width+o])){var tt,it=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?tt=new Ge:(tt=Ge.zpp_pool,Ge.zpp_pool=tt.next,tt.next=null),tt.forced=!1,tt.x=i,tt.y=it,Ve=tt,t.list[(1+(a<<1))*t.width+o]=Ve}else{var pt,lt=Ve.x,rt=Ve.y;null==Ge.zpp_pool?pt=new Ge:(pt=Ge.zpp_pool,Ge.zpp_pool=pt.next,pt.next=null),pt.forced=!1,pt.x=lt,pt.y=rt,Ve=pt}s&&(Ve.forced=!0),Ve.y!=p&&Ve.y!=r||(Ve.y==p&&0!=(1&Ae)||Ve.y==r&&0!=(64&Ae))&&(Ae^=128)}var ot=Ve;null==c.p1?c.p1=ot.prev=ot.next=ot:(ot.prev=c.p1,ot.next=c.p1.next,c.p1.next.prev=ot,c.p1.next=ot),c.p1=ot}}c.p1=c.p1.next,c.key1=Ae,1!=Ae&&4!=Ae&&16!=Ae&&64!=Ae&&3!=Ae&&12!=Ae&&48!=Ae&&192!=Ae&&129!=Ae&&6!=Ae&&24!=Ae&&96!=Ae&&5!=Ae&&20!=Ae&&80!=Ae&&65!=Ae&&17!=Ae&&68!=Ae||(Ae=0,c.key1=0,c.p1=null),0==Ae?c=null:(c.pr=c.p1,c.okeyr=c.okey1,c.keyr=c.key1)}}else if(J){var at=238;c.okey1=238;for(var st=0;st<8;){var _t=st++;if(0!=(at&1<<_t)){var ht,ut,xt,dt,yt=null;if(0==_t)null==Ge.zpp_pool?ht=new Ge:(ht=Ge.zpp_pool,Ge.zpp_pool=ht.next,ht.next=null),ht.forced=!1,ht.x=i,ht.y=p,yt=ht,(s||_)&&(yt.forced=!0);else if(2==_t)null==Ge.zpp_pool?ut=new Ge:(ut=Ge.zpp_pool,Ge.zpp_pool=ut.next,ut.next=null),ut.forced=!1,ut.x=l,ut.y=p,yt=ut,(h||_)&&(yt.forced=!0);else if(4==_t)null==Ge.zpp_pool?xt=new Ge:(xt=Ge.zpp_pool,Ge.zpp_pool=xt.next,xt.next=null),xt.forced=!1,xt.x=l,xt.y=r,yt=xt,(h||u)&&(yt.forced=!0);else if(6==_t)null==Ge.zpp_pool?dt=new Ge:(dt=Ge.zpp_pool,Ge.zpp_pool=dt.next,dt.next=null),dt.forced=!1,dt.x=i,dt.y=r,yt=dt,(s||u)&&(yt.forced=!0);else if(1==_t){if(null==(yt=t.list[(a<<1)*t.width+o])){var zt,vt=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?zt=new Ge:(zt=Ge.zpp_pool,Ge.zpp_pool=zt.next,zt.next=null),zt.forced=!1,zt.x=vt,zt.y=p,yt=zt,t.list[(a<<1)*t.width+o]=yt}else{var ct,ft=yt.x,mt=yt.y;null==Ge.zpp_pool?ct=new Ge:(ct=Ge.zpp_pool,Ge.zpp_pool=ct.next,ct.next=null),ct.forced=!1,ct.x=ft,ct.y=mt,yt=ct}_&&(yt.forced=!0),yt.x!=i&&yt.x!=l||(yt.x==i&&0!=(1&at)||yt.x==l&&0!=(4&at))&&(at^=2)}else if(5==_t){if(null==(yt=t.list[(2+(a<<1))*t.width+o])){var bt,gt=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?bt=new Ge:(bt=Ge.zpp_pool,Ge.zpp_pool=bt.next,bt.next=null),bt.forced=!1,bt.x=gt,bt.y=r,yt=bt,t.list[(2+(a<<1))*t.width+o]=yt}else{var wt,Mt=yt.x,Ct=yt.y;null==Ge.zpp_pool?wt=new Ge:(wt=Ge.zpp_pool,Ge.zpp_pool=wt.next,wt.next=null),wt.forced=!1,wt.x=Mt,wt.y=Ct,yt=wt}u&&(yt.forced=!0),yt.x!=i&&yt.x!=l||(yt.x==i&&0!=(64&at)||yt.x==l&&0!=(16&at))&&(at^=32)}else if(3==_t){if(null==(yt=t.list[(1+(a<<1))*t.width+(o+1)])){var kt,Ot=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?kt=new Ge:(kt=Ge.zpp_pool,Ge.zpp_pool=kt.next,kt.next=null),kt.forced=!1,kt.x=l,kt.y=Ot,yt=kt,t.list[(1+(a<<1))*t.width+(o+1)]=yt}else{var Pt,St=yt.x,At=yt.y;null==Ge.zpp_pool?Pt=new Ge:(Pt=Ge.zpp_pool,Ge.zpp_pool=Pt.next,Pt.next=null),Pt.forced=!1,Pt.x=St,Pt.y=At,yt=Pt}h&&(yt.forced=!0),yt.y!=p&&yt.y!=r||(yt.y==p&&0!=(4&at)||yt.y==r&&0!=(16&at))&&(at^=8)}else{if(null==(yt=t.list[(1+(a<<1))*t.width+o])){var jt,Et=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?jt=new Ge:(jt=Ge.zpp_pool,Ge.zpp_pool=jt.next,jt.next=null),jt.forced=!1,jt.x=i,jt.y=Et,yt=jt,t.list[(1+(a<<1))*t.width+o]=yt}else{var It,Tt=yt.x,Nt=yt.y;null==Ge.zpp_pool?It=new Ge:(It=Ge.zpp_pool,Ge.zpp_pool=It.next,It.next=null),It.forced=!1,It.x=Tt,It.y=Nt,yt=It}s&&(yt.forced=!0),yt.y!=p&&yt.y!=r||(yt.y==p&&0!=(1&at)||yt.y==r&&0!=(64&at))&&(at^=128)}var Lt=yt;null==c.p1?c.p1=Lt.prev=Lt.next=Lt:(Lt.prev=c.p1,Lt.next=c.p1.next,c.p1.next.prev=Lt,c.p1.next=Lt),c.p1=Lt}}c.p1=c.p1.next,c.key1=at,1!=at&&4!=at&&16!=at&&64!=at&&3!=at&&12!=at&&48!=at&&192!=at&&129!=at&&6!=at&&24!=at&&96!=at&&5!=at&&20!=at&&80!=at&&65!=at&&17!=at&&68!=at||(at=0,c.key1=0,c.p1=null),0==at?c=null:(c.pr=c.p1,c.okeyr=c.okey1,c.keyr=c.key1)}else{var Vt=224;c.okey1=224;for(var Dt=0;Dt<8;){var Ft=Dt++;if(0!=(Vt&1<<Ft)){var Rt,Zt,Bt,Gt,qt=null;if(0==Ft)null==Ge.zpp_pool?Rt=new Ge:(Rt=Ge.zpp_pool,Ge.zpp_pool=Rt.next,Rt.next=null),Rt.forced=!1,Rt.x=i,Rt.y=p,qt=Rt,(s||_)&&(qt.forced=!0);else if(2==Ft)null==Ge.zpp_pool?Zt=new Ge:(Zt=Ge.zpp_pool,Ge.zpp_pool=Zt.next,Zt.next=null),Zt.forced=!1,Zt.x=l,Zt.y=p,qt=Zt,(h||_)&&(qt.forced=!0);else if(4==Ft)null==Ge.zpp_pool?Bt=new Ge:(Bt=Ge.zpp_pool,Ge.zpp_pool=Bt.next,Bt.next=null),Bt.forced=!1,Bt.x=l,Bt.y=r,qt=Bt,(h||u)&&(qt.forced=!0);else if(6==Ft)null==Ge.zpp_pool?Gt=new Ge:(Gt=Ge.zpp_pool,Ge.zpp_pool=Gt.next,Gt.next=null),Gt.forced=!1,Gt.x=i,Gt.y=r,qt=Gt,(s||u)&&(qt.forced=!0);else if(1==Ft){if(null==(qt=t.list[(a<<1)*t.width+o])){var Ut,Kt=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?Ut=new Ge:(Ut=Ge.zpp_pool,Ge.zpp_pool=Ut.next,Ut.next=null),Ut.forced=!1,Ut.x=Kt,Ut.y=p,qt=Ut,t.list[(a<<1)*t.width+o]=qt}else{var Wt,Yt=qt.x,Jt=qt.y;null==Ge.zpp_pool?Wt=new Ge:(Wt=Ge.zpp_pool,Ge.zpp_pool=Wt.next,Wt.next=null),Wt.forced=!1,Wt.x=Yt,Wt.y=Jt,qt=Wt}_&&(qt.forced=!0),qt.x!=i&&qt.x!=l||(qt.x==i&&0!=(1&Vt)||qt.x==l&&0!=(4&Vt))&&(Vt^=2)}else if(5==Ft){if(null==(qt=t.list[(2+(a<<1))*t.width+o])){var Xt,Ht=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?Xt=new Ge:(Xt=Ge.zpp_pool,Ge.zpp_pool=Xt.next,Xt.next=null),Xt.forced=!1,Xt.x=Ht,Xt.y=r,qt=Xt,t.list[(2+(a<<1))*t.width+o]=qt}else{var $t,Qt=qt.x,ni=qt.y;null==Ge.zpp_pool?$t=new Ge:($t=Ge.zpp_pool,Ge.zpp_pool=$t.next,$t.next=null),$t.forced=!1,$t.x=Qt,$t.y=ni,qt=$t}u&&(qt.forced=!0),qt.x!=i&&qt.x!=l||(qt.x==i&&0!=(64&Vt)||qt.x==l&&0!=(16&Vt))&&(Vt^=32)}else if(3==Ft){if(null==(qt=t.list[(1+(a<<1))*t.width+(o+1)])){var ei,ti=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?ei=new Ge:(ei=Ge.zpp_pool,Ge.zpp_pool=ei.next,ei.next=null),ei.forced=!1,ei.x=l,ei.y=ti,qt=ei,t.list[(1+(a<<1))*t.width+(o+1)]=qt}else{var ii,pi=qt.x,li=qt.y;null==Ge.zpp_pool?ii=new Ge:(ii=Ge.zpp_pool,Ge.zpp_pool=ii.next,ii.next=null),ii.forced=!1,ii.x=pi,ii.y=li,qt=ii}h&&(qt.forced=!0),qt.y!=p&&qt.y!=r||(qt.y==p&&0!=(4&Vt)||qt.y==r&&0!=(16&Vt))&&(Vt^=8)}else{if(null==(qt=t.list[(1+(a<<1))*t.width+o])){var ri,oi=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?ri=new Ge:(ri=Ge.zpp_pool,Ge.zpp_pool=ri.next,ri.next=null),ri.forced=!1,ri.x=i,ri.y=oi,qt=ri,t.list[(1+(a<<1))*t.width+o]=qt}else{var ai,si=qt.x,_i=qt.y;null==Ge.zpp_pool?ai=new Ge:(ai=Ge.zpp_pool,Ge.zpp_pool=ai.next,ai.next=null),ai.forced=!1,ai.x=si,ai.y=_i,qt=ai}s&&(qt.forced=!0),qt.y!=p&&qt.y!=r||(qt.y==p&&0!=(1&Vt)||qt.y==r&&0!=(64&Vt))&&(Vt^=128)}var hi=qt;null==c.p1?c.p1=hi.prev=hi.next=hi:(hi.prev=c.p1,hi.next=c.p1.next,c.p1.next.prev=hi,c.p1.next=hi),c.p1=hi}}if(c.p1=c.p1.next,c.key1=Vt,1!=Vt&&4!=Vt&&16!=Vt&&64!=Vt&&3!=Vt&&12!=Vt&&48!=Vt&&192!=Vt&&129!=Vt&&6!=Vt&&24!=Vt&&96!=Vt&&5!=Vt&&20!=Vt&&80!=Vt&&65!=Vt&&17!=Vt&&68!=Vt||(Vt=0,c.key1=0,c.p1=null),0!=Vt){var ui=14;c.okey2=14;for(var xi=0;xi<8;){var di=xi++;if(0!=(ui&1<<di)){var yi,zi,vi,ci,fi=null;if(0==di)null==Ge.zpp_pool?yi=new Ge:(yi=Ge.zpp_pool,Ge.zpp_pool=yi.next,yi.next=null),yi.forced=!1,yi.x=i,yi.y=p,fi=yi,(s||_)&&(fi.forced=!0);else if(2==di)null==Ge.zpp_pool?zi=new Ge:(zi=Ge.zpp_pool,Ge.zpp_pool=zi.next,zi.next=null),zi.forced=!1,zi.x=l,zi.y=p,fi=zi,(h||_)&&(fi.forced=!0);else if(4==di)null==Ge.zpp_pool?vi=new Ge:(vi=Ge.zpp_pool,Ge.zpp_pool=vi.next,vi.next=null),vi.forced=!1,vi.x=l,vi.y=r,fi=vi,(h||u)&&(fi.forced=!0);else if(6==di)null==Ge.zpp_pool?ci=new Ge:(ci=Ge.zpp_pool,Ge.zpp_pool=ci.next,ci.next=null),ci.forced=!1,ci.x=i,ci.y=r,fi=ci,(s||u)&&(fi.forced=!0);else if(1==di){if(null==(fi=t.list[(a<<1)*t.width+o])){var mi,bi=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?mi=new Ge:(mi=Ge.zpp_pool,Ge.zpp_pool=mi.next,mi.next=null),mi.forced=!1,mi.x=bi,mi.y=p,fi=mi,t.list[(a<<1)*t.width+o]=fi}else{var gi,wi=fi.x,Mi=fi.y;null==Ge.zpp_pool?gi=new Ge:(gi=Ge.zpp_pool,Ge.zpp_pool=gi.next,gi.next=null),gi.forced=!1,gi.x=wi,gi.y=Mi,fi=gi}_&&(fi.forced=!0),fi.x!=i&&fi.x!=l||(fi.x==i&&0!=(1&ui)||fi.x==l&&0!=(4&ui))&&(ui^=2)}else if(5==di){if(null==(fi=t.list[(2+(a<<1))*t.width+o])){var Ci,ki=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?Ci=new Ge:(Ci=Ge.zpp_pool,Ge.zpp_pool=Ci.next,Ci.next=null),Ci.forced=!1,Ci.x=ki,Ci.y=r,fi=Ci,t.list[(2+(a<<1))*t.width+o]=fi}else{var Oi,Pi=fi.x,Si=fi.y;null==Ge.zpp_pool?Oi=new Ge:(Oi=Ge.zpp_pool,Ge.zpp_pool=Oi.next,Oi.next=null),Oi.forced=!1,Oi.x=Pi,Oi.y=Si,fi=Oi}u&&(fi.forced=!0),fi.x!=i&&fi.x!=l||(fi.x==i&&0!=(64&ui)||fi.x==l&&0!=(16&ui))&&(ui^=32)}else if(3==di){if(null==(fi=t.list[(1+(a<<1))*t.width+(o+1)])){var Ai,ji=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?Ai=new Ge:(Ai=Ge.zpp_pool,Ge.zpp_pool=Ai.next,Ai.next=null),Ai.forced=!1,Ai.x=l,Ai.y=ji,fi=Ai,t.list[(1+(a<<1))*t.width+(o+1)]=fi}else{var Ei,Ii=fi.x,Ti=fi.y;null==Ge.zpp_pool?Ei=new Ge:(Ei=Ge.zpp_pool,Ge.zpp_pool=Ei.next,Ei.next=null),Ei.forced=!1,Ei.x=Ii,Ei.y=Ti,fi=Ei}h&&(fi.forced=!0),fi.y!=p&&fi.y!=r||(fi.y==p&&0!=(4&ui)||fi.y==r&&0!=(16&ui))&&(ui^=8)}else{if(null==(fi=t.list[(1+(a<<1))*t.width+o])){var Ni,Li=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?Ni=new Ge:(Ni=Ge.zpp_pool,Ge.zpp_pool=Ni.next,Ni.next=null),Ni.forced=!1,Ni.x=i,Ni.y=Li,fi=Ni,t.list[(1+(a<<1))*t.width+o]=fi}else{var Vi,Di=fi.x,Fi=fi.y;null==Ge.zpp_pool?Vi=new Ge:(Vi=Ge.zpp_pool,Ge.zpp_pool=Vi.next,Vi.next=null),Vi.forced=!1,Vi.x=Di,Vi.y=Fi,fi=Vi}s&&(fi.forced=!0),fi.y!=p&&fi.y!=r||(fi.y==p&&0!=(1&ui)||fi.y==r&&0!=(64&ui))&&(ui^=128)}var Ri=fi;null==c.p2?c.p2=Ri.prev=Ri.next=Ri:(Ri.prev=c.p2,Ri.next=c.p2.next,c.p2.next.prev=Ri,c.p2.next=Ri),c.p2=Ri}}c.p2=c.p2.next,c.key2=ui,1!=ui&&4!=ui&&16!=ui&&64!=ui&&3!=ui&&12!=ui&&48!=ui&&192!=ui&&129!=ui&&6!=ui&&24!=ui&&96!=ui&&5!=ui&&20!=ui&&80!=ui&&65!=ui&&17!=ui&&68!=ui||(ui=0,c.key2=0,c.p2=null),0==ui?(c.pr=c.p1,c.okeyr=c.okey1,c.keyr=c.key1):(c.pr=c.p2,c.okeyr=c.okey2,c.keyr=c.key2)}else{var Zi=14;c.okey1=14;for(var Bi=0;Bi<8;){var Gi=Bi++;if(0!=(Zi&1<<Gi)){var qi,Ui,Ki,Wi,Yi=null;if(0==Gi)null==Ge.zpp_pool?qi=new Ge:(qi=Ge.zpp_pool,Ge.zpp_pool=qi.next,qi.next=null),qi.forced=!1,qi.x=i,qi.y=p,Yi=qi,(s||_)&&(Yi.forced=!0);else if(2==Gi)null==Ge.zpp_pool?Ui=new Ge:(Ui=Ge.zpp_pool,Ge.zpp_pool=Ui.next,Ui.next=null),Ui.forced=!1,Ui.x=l,Ui.y=p,Yi=Ui,(h||_)&&(Yi.forced=!0);else if(4==Gi)null==Ge.zpp_pool?Ki=new Ge:(Ki=Ge.zpp_pool,Ge.zpp_pool=Ki.next,Ki.next=null),Ki.forced=!1,Ki.x=l,Ki.y=r,Yi=Ki,(h||u)&&(Yi.forced=!0);else if(6==Gi)null==Ge.zpp_pool?Wi=new Ge:(Wi=Ge.zpp_pool,Ge.zpp_pool=Wi.next,Wi.next=null),Wi.forced=!1,Wi.x=i,Wi.y=r,Yi=Wi,(s||u)&&(Yi.forced=!0);else if(1==Gi){if(null==(Yi=t.list[(a<<1)*t.width+o])){var Ji,Xi=this.xlerp(i,l,p,y,z,n,x);null==Ge.zpp_pool?Ji=new Ge:(Ji=Ge.zpp_pool,Ge.zpp_pool=Ji.next,Ji.next=null),Ji.forced=!1,Ji.x=Xi,Ji.y=p,Yi=Ji,t.list[(a<<1)*t.width+o]=Yi}else{var Hi,$i=Yi.x,Qi=Yi.y;null==Ge.zpp_pool?Hi=new Ge:(Hi=Ge.zpp_pool,Ge.zpp_pool=Hi.next,Hi.next=null),Hi.forced=!1,Hi.x=$i,Hi.y=Qi,Yi=Hi}_&&(Yi.forced=!0),Yi.x!=i&&Yi.x!=l||(Yi.x==i&&0!=(1&Zi)||Yi.x==l&&0!=(4&Zi))&&(Zi^=2)}else if(5==Gi){if(null==(Yi=t.list[(2+(a<<1))*t.width+o])){var np,ep=this.xlerp(i,l,r,f,v,n,x);null==Ge.zpp_pool?np=new Ge:(np=Ge.zpp_pool,Ge.zpp_pool=np.next,np.next=null),np.forced=!1,np.x=ep,np.y=r,Yi=np,t.list[(2+(a<<1))*t.width+o]=Yi}else{var tp,ip=Yi.x,pp=Yi.y;null==Ge.zpp_pool?tp=new Ge:(tp=Ge.zpp_pool,Ge.zpp_pool=tp.next,tp.next=null),tp.forced=!1,tp.x=ip,tp.y=pp,Yi=tp}u&&(Yi.forced=!0),Yi.x!=i&&Yi.x!=l||(Yi.x==i&&0!=(64&Zi)||Yi.x==l&&0!=(16&Zi))&&(Zi^=32)}else if(3==Gi){if(null==(Yi=t.list[(1+(a<<1))*t.width+(o+1)])){var lp,rp=this.ylerp(p,r,l,z,v,n,x);null==Ge.zpp_pool?lp=new Ge:(lp=Ge.zpp_pool,Ge.zpp_pool=lp.next,lp.next=null),lp.forced=!1,lp.x=l,lp.y=rp,Yi=lp,t.list[(1+(a<<1))*t.width+(o+1)]=Yi}else{var op,ap=Yi.x,sp=Yi.y;null==Ge.zpp_pool?op=new Ge:(op=Ge.zpp_pool,Ge.zpp_pool=op.next,op.next=null),op.forced=!1,op.x=ap,op.y=sp,Yi=op}h&&(Yi.forced=!0),Yi.y!=p&&Yi.y!=r||(Yi.y==p&&0!=(4&Zi)||Yi.y==r&&0!=(16&Zi))&&(Zi^=8)}else{if(null==(Yi=t.list[(1+(a<<1))*t.width+o])){var _p,hp=this.ylerp(p,r,i,y,f,n,x);null==Ge.zpp_pool?_p=new Ge:(_p=Ge.zpp_pool,Ge.zpp_pool=_p.next,_p.next=null),_p.forced=!1,_p.x=i,_p.y=hp,Yi=_p,t.list[(1+(a<<1))*t.width+o]=Yi}else{var up,xp=Yi.x,dp=Yi.y;null==Ge.zpp_pool?up=new Ge:(up=Ge.zpp_pool,Ge.zpp_pool=up.next,up.next=null),up.forced=!1,up.x=xp,up.y=dp,Yi=up}s&&(Yi.forced=!0),Yi.y!=p&&Yi.y!=r||(Yi.y==p&&0!=(1&Zi)||Yi.y==r&&0!=(64&Zi))&&(Zi^=128)}var yp=Yi;null==c.p1?c.p1=yp.prev=yp.next=yp:(yp.prev=c.p1,yp.next=c.p1.next,c.p1.next.prev=yp,c.p1.next=yp),c.p1=yp}}c.p1=c.p1.next,c.key1=Zi,1!=Zi&&4!=Zi&&16!=Zi&&64!=Zi&&3!=Zi&&12!=Zi&&48!=Zi&&192!=Zi&&129!=Zi&&6!=Zi&&24!=Zi&&96!=Zi&&5!=Zi&&20!=Zi&&80!=Zi&&65!=Zi&&17!=Zi&&68!=Zi||(Zi=0,c.key1=0,c.p1=null),0==Zi?c=null:(c.pr=c.p1,c.okeyr=c.okey1,c.keyr=c.key1)}}}return c},Ye.prototype.lerp=function(n,e,t,i){if(0==t)return n;if(0==i)return e;var p=t-i,l=p*p<o.epsilon*o.epsilon?.5:t/p;return l<0?l=0:l>1&&(l=1),n+l*(e-n)},Ye.prototype.xlerp=function(n,e,t,i,p,l,r){var a;if(0==i)a=n;else if(0==p)a=e;else{var s=i-p,_=s*s<o.epsilon*o.epsilon?.5:i/s;_<0?_=0:_>1&&(_=1),a=n+_*(e-n)}for(;0!=r--&&n<a&&a<e;){var h=l(a,t);if(0==h)break;if(i*h<0?(e=a,p=h):(n=a,i=h),0==i)a=n;else if(0==p)a=e;else{var u=i-p,x=u*u<o.epsilon*o.epsilon?.5:i/u;x<0?x=0:x>1&&(x=1),a=n+x*(e-n)}}return a},Ye.prototype.ylerp=function(n,e,t,i,p,l,r){var a;if(0==i)a=n;else if(0==p)a=e;else{var s=i-p,_=s*s<o.epsilon*o.epsilon?.5:i/s;_<0?_=0:_>1&&(_=1),a=n+_*(e-n)}for(;0!=r--&&n<a&&a<e;){var h=l(t,a);if(0==h)break;if(i*h<0?(e=a,p=h):(n=a,i=h),0==i)a=n;else if(0==p)a=e;else{var u=i-p,x=u*u<o.epsilon*o.epsilon?.5:i/u;x<0?x=0:x>1&&(x=1),a=n+x*(e-n)}}return a},Ye.prototype.__class__=Ye;var Je=zpp_nape.geom.ZPP_Mat23=function(){this.next=null,this._invalidate=null,this.ty=0,this.tx=0,this.d=0,this.c=0,this.b=0,this.a=0,this.outer=null};Je.__name__=["zpp_nape","geom","ZPP_Mat23"],Je.get=function(){var n;return null==Je.zpp_pool?n=new Je:(n=Je.zpp_pool,Je.zpp_pool=n.next,n.next=null),n},Je.identity=function(){var n=Je.get();return n.setas(1,0,0,1,0,0),n},Je.prototype.outer=null,Je.prototype.wrapper=function(){if(null==this.outer){this.outer=new sn;var n=this.outer.zpp_inner;n.next=Je.zpp_pool,Je.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},Je.prototype.a=null,Je.prototype.b=null,Je.prototype.c=null,Je.prototype.d=null,Je.prototype.tx=null,Je.prototype.ty=null,Je.prototype._invalidate=null,Je.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate()},Je.prototype.set=function(n){this.setas(n.a,n.b,n.c,n.d,n.tx,n.ty)},Je.prototype.setas=function(n,e,t,i,p,l){this.tx=p,this.ty=l,this.a=n,this.b=e,this.c=t,this.d=i},Je.prototype.next=null,Je.prototype.free=function(){},Je.prototype.alloc=function(){},Je.prototype.__class__=Je;var Xe=zpp_nape.geom.ZPP_MatMN=function(n,e){this.x=null,this.n=0,this.m=0,this.outer=null,this.m=n,this.n=e,this.x=[];for(var t=0,i=n*e;t<i;)++t,this.x.push(0)};Xe.__name__=["zpp_nape","geom","ZPP_MatMN"],Xe.prototype.outer=null,Xe.prototype.m=null,Xe.prototype.n=null,Xe.prototype.x=null,Xe.prototype.__class__=Xe;var He=zpp_nape.geom.ZPP_Monotone=function(){};He.__name__=["zpp_nape","geom","ZPP_Monotone"],He.bisector=function(n){var e,t,i=n.prev,p=n.next;e=n.x-i.x,t=n.y-i.y;var l,r,o;l=p.x-n.x,r=p.y-n.y,null==xt.zpp_pool?o=new xt:(o=xt.zpp_pool,xt.zpp_pool=o.next,o.next=null),o.weak=!1,o._immutable=!1,o.x=-t-r,o.y=e+l;var a=o,s=1/Math.sqrt(a.x*a.x+a.y*a.y);return a.x*=s,a.y*=s,r*e-l*t<0&&(a.x=-a.x,a.y=-a.y),a},He.below=function(n,e){if(n.y<e.y)return!0;if(n.y>e.y)return!1;if(n.x<e.x)return!0;if(n.x>e.x)return!1;var t=He.bisector(n),i=He.bisector(e);t.x+=n.x,t.y+=n.y,i.x+=e.x,i.y+=e.y;var p=t.x<i.x||t.x==i.x&&t.y<i.y;return null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t,null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i._isimmutable=null,i._validate=null,i._invalidate=null,i.next=xt.zpp_pool,xt.zpp_pool=i,p},He.above=function(n,e){return He.below(e,n)},He.left_vertex=function(n){var e=n.prev;return e.y>n.y||e.y==n.y&&n.next.y<n.y},He.isMonotone=function(n){var e=n,t=n,i=n.next;if(null!=i)for(var p=i;;){var l=p;if(l.y<e.y&&(e=l),l.y>t.y&&(t=l),(p=p.next)==n)break}var r=!0,o=e;if(t!=e.next){var a=e.next,s=t;if(null!=a)for(var _=a;;){var h=_;if(h.y<o.y){r=!1;break}if(o=h,(_=_.next)==s)break}}if(!r)return!1;if(o=e,t!=e.prev){var u=e.prev,x=t;if(null!=u)for(var d=u;;){var y=d;if(y.y<o.y){r=!1;break}if(o=y,(d=d.prev)==x)break}}return r},He.sharedPPoly=null,He.getShared=function(){return null==He.sharedPPoly&&(He.sharedPPoly=new Qe),He.sharedPPoly},He.decompose=function(n,e){if(null==e?e=new Qe(n):e.init(n),null==e.vertices)return e;null==He.queue&&(He.queue=new Xt);var t=e.vertices,i=e.vertices;if(null!=t)for(var p=t;;){var l=p;He.queue.add(l);var r,o;r=l.next.x-l.x,o=l.next.y-l.y;var a;a=l.prev.x-l.x;var s=(l.prev.y-l.y)*r-a*o>0;if(l.type=He.below(l.prev,l)?He.below(l.next,l)?s?0:3:4:He.below(l,l.next)?s?1:2:4,(p=p.next)==i)break}var _=He.queue;if(null!=_.head&&null!=_.head.next){for(var h,u,x,d=_.head,y=null,z=null,v=null,c=null,f=1;;){for(h=0,z=d,y=d=null;null!=z;){for(++h,v=z,u=0,x=f;null!=v&&u<f;)++u,v=v.next;for(;u>0||x>0&&null!=v;)0==u?(c=v,v=v.next,--x):0==x||null==v?(c=z,z=z.next,--u):He.above(z.elt,v.elt)?(c=z,z=z.next,--u):(c=v,v=v.next,--x),null!=y?y.next=c:d=c,y=c;z=v}if(y.next=null,f<<=1,!(h>1))break}_.head=d,_.modified=!0,_.pushmod=!0}for(null==He.edges&&(null==zp.zpp_pool?He.edges=new zp:(He.edges=zp.zpp_pool,zp.zpp_pool=He.edges.next,He.edges.next=null),He.edges.lt=$e.edge_lt,He.edges.swapped=$e.edge_swap);null!=He.queue.head;){var m=He.queue.pop_unsafe();switch(m.type){case 0:m.helper=m,m.node=He.edges.insert(m);break;case 1:var b=m.prev;2==b.helper.type&&e.add_diagonal(m,b.helper),He.edges.remove_node(b.node);break;case 2:var g=m.prev;2==g.helper.type&&e.add_diagonal(m,g.helper),He.edges.remove_node(g.node);var w=null;if(!He.edges.empty()){for(var M=He.edges.parent;null!=M.prev;)M=M.prev;for(;null!=M;){var C=M.data;if(!$e.vert_lt(C,m)){w=C;break}if(null!=M.next)for(M=M.next;null!=M.prev;)M=M.prev;else{for(;null!=M.parent&&M==M.parent.next;)M=M.parent;M=M.parent}}}var k=w;null!=k&&(2==k.helper.type&&e.add_diagonal(m,k.helper),k.helper=m);break;case 3:var O=null;if(!He.edges.empty()){for(var P=He.edges.parent;null!=P.prev;)P=P.prev;for(;null!=P;){var S=P.data;if(!$e.vert_lt(S,m)){O=S;break}if(null!=P.next)for(P=P.next;null!=P.prev;)P=P.prev;else{for(;null!=P.parent&&P==P.parent.next;)P=P.parent;P=P.parent}}}var A=O;null!=A&&(e.add_diagonal(m,A.helper),A.helper=m),m.node=He.edges.insert(m),m.helper=m;break;case 4:var j=m.prev;if(He.left_vertex(m))2==j.helper.type&&e.add_diagonal(m,j.helper),He.edges.remove_node(j.node),m.node=He.edges.insert(m),m.helper=m;else{var E=null;if(!He.edges.empty()){for(var I=He.edges.parent;null!=I.prev;)I=I.prev;for(;null!=I;){var T=I.data;if(!$e.vert_lt(T,m)){E=T;break}if(null!=I.next)for(I=I.next;null!=I.prev;)I=I.prev;else{for(;null!=I.parent&&I==I.parent.next;)I=I.parent;I=I.parent}}}var N=E;2==N.helper.type&&e.add_diagonal(m,N.helper),N.helper=m}}}return e},He.prototype.__class__=He;var $e=zpp_nape.geom.ZPP_PartitionVertex=function(){this.node=null,this.prev=null,this.next=null,this.rightchain=!1,this.helper=null,this.type=0,this.diagonals=null,this.forced=!1,this.y=0,this.x=0,this.mag=0,this.id=0,this.id=$e.nextId++,this.diagonals=new Xt};$e.__name__=["zpp_nape","geom","ZPP_PartitionVertex"],$e.get=function(n){var e;return null==$e.zpp_pool?e=new $e:(e=$e.zpp_pool,$e.zpp_pool=e.next,e.next=null),e.x=n.x,e.y=n.y,e},$e.rightdistance=function(n,e){var t,i,p=n.next.y>n.y;t=n.next.x-n.x,i=n.next.y-n.y;var l;return l=e.x-n.x,(p?-1:1)*((e.y-n.y)*t-l*i)},$e.vert_lt=function(n,e){if(e==n||e==n.next)return!0;if(n.y==n.next.y){var t=n.x,i=n.next.x;return(t<i?t:i)<=e.x}return $e.rightdistance(n,e)<=0},$e.edge_swap=function(n,e){var t=n.node;n.node=e.node,e.node=t},$e.edge_lt=function(n,e){if(n==e&&n.next==e.next)return!1;if(n==e.next)return!$e.vert_lt(n,e);if(e==n.next)return $e.vert_lt(e,n);if(n.y==n.next.y){if(e.y==e.next.y){var t=n.x,i=n.next.x,p=t>i?t:i,l=e.x,r=e.next.x;return p>(l>r?l:r)}return $e.rightdistance(e,n)>0||$e.rightdistance(e,n.next)>0}var o=$e.rightdistance(n,e),a=$e.rightdistance(n,e.next);if(0==o&&0==a){var s=n.x,_=n.next.x,h=s>_?s:_,u=e.x,x=e.next.x;return h>(u>x?u:x)}if(o*a>=0)return o<0||a<0;var d=$e.rightdistance(e,n),y=$e.rightdistance(e,n.next);return d*y>=0&&(d>0||y>0)},$e.prototype.id=null,$e.prototype.mag=null,$e.prototype.x=null,$e.prototype.y=null,$e.prototype.forced=null,$e.prototype.diagonals=null,$e.prototype.type=null,$e.prototype.helper=null,$e.prototype.rightchain=null,$e.prototype.next=null,$e.prototype.prev=null,$e.prototype.alloc=function(){},$e.prototype.free=function(){this.helper=null},$e.prototype.copy=function(){var n;return null==$e.zpp_pool?n=new $e:(n=$e.zpp_pool,$e.zpp_pool=n.next,n.next=null),n.x=this.x,n.y=this.y,n.forced=this.forced,n},$e.prototype.sort=function(){var n=0,e=0,t=0;n=this.prev.x-this.x,e=this.prev.y-this.y,t=this.next.x-this.x;var i=(this.next.y-this.y)*n-t*e,p=i>0?-1:0==i?0:1,l=this.diagonals;if(null!=l.head&&null!=l.head.next){for(var r,o,a,s=l.head,_=null,h=null,u=null,x=null,d=1;;){for(r=0,h=s,_=s=null;null!=h;){for(++r,u=h,o=0,a=d;null!=u&&o<d;)++o,u=u.next;for(;o>0||a>0&&null!=u;){if(0==o)x=u,u=u.next,--a;else if(0==a||null==u)x=h,h=h.next,--o;else{var y;if(1==p){n=h.elt.x-this.x,e=h.elt.y-this.y,t=u.elt.x-this.x;var z=(u.elt.y-this.y)*n-t*e;y=1==(z>0?-1:0==z?0:1)}else{n=this.prev.x-this.x,e=this.prev.y-this.y,t=h.elt.x-this.x;var v=(h.elt.y-this.y)*n-t*e,c=v>0?-1:0==v?0:1;n=this.prev.x-this.x,e=this.prev.y-this.y,t=u.elt.x-this.x;var f=(u.elt.y-this.y)*n-t*e,m=f>0?-1:0==f?0:1;if(c*m==1||c*m==0&&(1==c||1==m)){n=h.elt.x-this.x,e=h.elt.y-this.y,t=u.elt.x-this.x;var b=(u.elt.y-this.y)*n-t*e;y=1==(b>0?-1:0==b?0:1)}else if(-1==c||-1==m)y=-1==m;else if(0==c&&0==m){n=this.x-this.prev.x,e=this.y-this.prev.y;var g=n*(t=h.elt.x-this.x)+e*(h.elt.y-this.y),w=n*(t=u.elt.x-this.x)+e*(u.elt.y-this.y);y=g<0&&w>0||!(w<0&&g>0)}else y=!0}y?(x=h,h=h.next,--o):(x=u,u=u.next,--a)}null!=_?_.next=x:s=x,_=x}h=u}if(_.next=null,d<<=1,!(r>1))break}l.head=s,l.modified=!0,l.pushmod=!0}},$e.prototype.node=null,$e.prototype.__class__=$e;var Qe=zpp_nape.geom.ZPP_PartitionedPoly=function(n){this.next=null,this.vertices=null,this.init(n)};Qe.__name__=["zpp_nape","geom","ZPP_PartitionedPoly"],Qe.sharedPPList=null,Qe.getSharedPP=function(){return null==Qe.sharedPPList&&(Qe.sharedPPList=new $t),Qe.sharedPPList},Qe.sharedGVList=null,Qe.getShared=function(){return null==Qe.sharedGVList&&(Qe.sharedGVList=new Qt),Qe.sharedGVList},Qe.prototype.vertices=null,Qe.prototype.eq=function(n,e){var t,i,p=n.x,l=n.y;return(t=p-e.x)*t+(i=l-e.y)*i<o.epsilon*o.epsilon},Qe.prototype.next=null,Qe.prototype.alloc=function(){},Qe.prototype.free=function(){},Qe.prototype.init=function(n){if(null!=n){var e=0;if(null!=n)for(var t=n;;){var i=t;if(e+=i.x*(i.next.y-i.prev.y),(t=t.next)==n)break}for(var p=.5*e>0,l=n;;){var r;if(p){var o;null==$e.zpp_pool?o=new $e:(o=$e.zpp_pool,$e.zpp_pool=o.next,o.next=null),o.x=l.x,o.y=l.y;var a=o;null==this.vertices?this.vertices=a.prev=a.next=a:(a.prev=this.vertices,a.next=this.vertices.next,this.vertices.next.prev=a,this.vertices.next=a),r=a}else{var s;null==$e.zpp_pool?s=new $e:(s=$e.zpp_pool,$e.zpp_pool=s.next,s.next=null),s.x=l.x,s.y=l.y;var _=s;null==this.vertices?this.vertices=_.prev=_.next=_:(_.next=this.vertices,_.prev=this.vertices.prev,this.vertices.prev.next=_,this.vertices.prev=_),r=_}if(this.vertices=r,this.vertices.forced=l.forced,(l=l.next)==n)break}this.remove_collinear_vertices()}},Qe.prototype.remove_collinear_vertices=function(){for(var n,e=this.vertices,t=!0;t||e!=this.vertices;)if(t=!1,this.eq(e,e.next)){if(e==this.vertices&&(this.vertices=e.next,t=!0),e.forced&&(e.next.forced=!0),null!=e&&e.prev==e){e.next=e.prev=null;var i=e;i.helper=null,i.next=$e.zpp_pool,$e.zpp_pool=i,e=e=null}else{var p=e.next;e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null;var l=e;l.helper=null,l.next=$e.zpp_pool,$e.zpp_pool=l,e=null,e=p}if(null==e){this.vertices=null;break}}else e=e.next;if(null==this.vertices)return!0;for(;;){for(n=!1,e=this.vertices,t=!0;t||e!=this.vertices;){t=!1;var r,a,s=e.prev;r=e.x-s.x,a=e.y-s.y;var _;_=e.next.x-e.x;var h=(e.next.y-e.y)*r-_*a;if(h*h>=o.epsilon*o.epsilon)e=e.next;else{if(e==this.vertices&&(this.vertices=e.next,t=!0),null!=e&&e.prev==e){e.next=e.prev=null;var u=e;u.helper=null,u.next=$e.zpp_pool,$e.zpp_pool=u,e=e=null}else{var x=e.next;e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null;var d=e;d.helper=null,d.next=$e.zpp_pool,$e.zpp_pool=d,e=null,e=x}if(n=!0,null==e){n=!1,this.vertices=null;break}}}if(!n)break}return null==this.vertices},Qe.prototype.add_diagonal=function(n,e){n.diagonals.add(e),e.diagonals.add(n),n.forced=e.forced=!0},Qe.prototype.extract_partitions=function(n){if(null==n&&(n=new $t),null!=this.vertices){var e=this.vertices,t=this.vertices;if(null!=e)for(var i=e;i.sort(),(i=i.next)!=t;);for(this.pull_partitions(this.vertices,n);null!=this.vertices;){var p;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var l=this.vertices;l.helper=null,l.next=$e.zpp_pool,$e.zpp_pool=l,p=this.vertices=null}else{var r=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var o=this.vertices;o.helper=null,o.next=$e.zpp_pool,$e.zpp_pool=o,this.vertices=null,p=r}this.vertices=p}for(var a=null,s=n.head;null!=s;)s.elt.remove_collinear_vertices()?n.erase(a):(a=s,s=s.next)}return n},Qe.prototype.pull_partitions=function(n,e){var t;null==Qe.zpp_pool?t=new Qe:(t=Qe.zpp_pool,Qe.zpp_pool=t.next,t.next=null);for(var i=n;;){var p;null==$e.zpp_pool?p=new $e:(p=$e.zpp_pool,$e.zpp_pool=p.next,p.next=null),p.x=i.x,p.y=i.y,p.forced=i.forced;var l=p;if(null==t.vertices?t.vertices=l.prev=l.next=l:(l.prev=t.vertices,l.next=t.vertices.next,t.vertices.next.prev=l,t.vertices.next=l),t.vertices=l,t.vertices.forced=i.forced,null!=i.diagonals.head){var r=i.diagonals,o=r.head.elt;if(r.pop(),o==n)break;i=this.pull_partitions(i,e)}else i=i.next;if(i==n)break}var a=0,s=t.vertices,_=t.vertices;if(null!=s)for(var h=s;;){var u=h;if(a+=u.x*(u.next.y-u.prev.y),(h=h.next)==_)break}return.5*a!=0&&e.add(t),i},Qe.prototype.extract=function(n){if(null==n&&(n=new Qt),null!=this.vertices){var e=this.vertices,t=this.vertices;if(null!=e)for(var i=e;i.sort(),(i=i.next)!=t;);for(this.pull(this.vertices,n);null!=this.vertices;){var p;if(null!=this.vertices&&this.vertices.prev==this.vertices){this.vertices.next=this.vertices.prev=null;var l=this.vertices;l.helper=null,l.next=$e.zpp_pool,$e.zpp_pool=l,p=this.vertices=null}else{var r=this.vertices.next;this.vertices.prev.next=this.vertices.next,this.vertices.next.prev=this.vertices.prev,this.vertices.next=this.vertices.prev=null;var o=this.vertices;o.helper=null,o.next=$e.zpp_pool,$e.zpp_pool=o,this.vertices=null,p=r}this.vertices=p}}return n},Qe.prototype.pull=function(n,e){for(var t=null,i=n;;){var p,l=i.x,r=i.y;null==Ge.zpp_pool?p=new Ge:(p=Ge.zpp_pool,Ge.zpp_pool=p.next,p.next=null),p.forced=!1,p.x=l,p.y=r;var a=p;if(null==t?t=a.prev=a.next=a:(a.prev=t,a.next=t.next,t.next.prev=a,t.next=a),t=a,a.forced=i.forced,null!=i.diagonals.head){var s=i.diagonals,_=s.head.elt;if(s.pop(),_==n)break;i=this.pull(i,e)}else i=i.next;if(i==n)break}var h=0,u=t;if(null!=t)for(var x=t;;){var d=x;if(h+=d.x*(d.next.y-d.prev.y),(x=x.next)==u)break}var y=.5*h;if(y*y>=o.epsilon*o.epsilon){for(var z=t,v=!0;v||z!=t;){v=!1;var c,f,m=z.x,b=z.y;if((c=m-z.next.x)*c+(f=b-z.next.y)*f<o.epsilon*o.epsilon){if(z==t&&(t=z.next,v=!0),z.forced&&(z.next.forced=!0),null!=z&&z.prev==z)z.next=z.prev=null,z=z=null;else{var g=z.next;z.prev.next=z.next,z.next.prev=z.prev,z.next=z.prev=null,z=null,z=g}if(null==z){t=null;break}}else z=z.next}if(null!=t)for(var w;;){for(w=!1,z=t,v=!0;v||z!=t;){v=!1;var M,C,k=z.prev;M=z.x-k.x,C=z.y-k.y;var O;O=z.next.x-z.x;var P=(z.next.y-z.y)*M-O*C;if(P*P>=o.epsilon*o.epsilon)z=z.next;else{if(z==t&&(t=z.next,v=!0),null!=z&&z.prev==z)z.next=z.prev=null,z=z=null;else{var S=z.next;z.prev.next=z.next,z.next.prev=z.prev,z.next=z.prev=null,z=null,z=S}if(w=!0,null==z){w=!1,t=null;break}}}if(!w)break}null!=t&&e.add(t)}return i},Qe.prototype.__class__=Qe;var nt=zpp_nape.geom.ZPP_Ray=function(){var n,t;if(this.zip_dir=!1,this.absnormaly=0,this.absnormalx=0,this.normaly=0,this.normalx=0,this.idiry=0,this.idirx=0,this.diry=0,this.dirx=0,this.originy=0,this.originx=0,this.userData=null,this.maxdist=0,this.direction=null,this.origin=null,null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var i;null==xt.zpp_pool?i=new xt:(i=xt.zpp_pool,xt.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=!1,i.x=0,i.y=0,n.zpp_inner=i,n.zpp_inner.outer=n}else{var p,l=n.zpp_inner;if(null!=l._validate&&l._validate(),0==n.zpp_inner.x){var r=n.zpp_inner;null!=r._validate&&r._validate(),p=0==n.zpp_inner.y}else p=!1;if(!p){n.zpp_inner.x=0,n.zpp_inner.y=0;var o=n.zpp_inner;null!=o._invalidate&&o._invalidate(o)}}if(n.zpp_inner.weak=!1,this.origin=n,this.origin.zpp_inner._invalidate=e(this,this.origin_invalidate),null==xp.poolVec2?t=new yn:(t=xp.poolVec2,xp.poolVec2=t.zpp_pool,t.zpp_pool=null),null==t.zpp_inner){var a;null==xt.zpp_pool?a=new xt:(a=xt.zpp_pool,xt.zpp_pool=a.next,a.next=null),a.weak=!1,a._immutable=!1,a.x=0,a.y=0,t.zpp_inner=a,t.zpp_inner.outer=t}else{var s,_=t.zpp_inner;if(null!=_._validate&&_._validate(),0==t.zpp_inner.x){var h=t.zpp_inner;null!=h._validate&&h._validate(),s=0==t.zpp_inner.y}else s=!1;if(!s){t.zpp_inner.x=0,t.zpp_inner.y=0;var u=t.zpp_inner;null!=u._invalidate&&u._invalidate(u)}}t.zpp_inner.weak=!1,this.direction=t,this.direction.zpp_inner._invalidate=e(this,this.direction_invalidate),this.originx=0,this.originy=0,this.dirx=0,this.diry=0,this.zip_dir=!1};nt.__name__=["zpp_nape","geom","ZPP_Ray"],nt.prototype.origin=null,nt.prototype.direction=null,nt.prototype.maxdist=null,nt.prototype.userData=null,nt.prototype.originx=null,nt.prototype.originy=null,nt.prototype.dirx=null,nt.prototype.diry=null,nt.prototype.idirx=null,nt.prototype.idiry=null,nt.prototype.normalx=null,nt.prototype.normaly=null,nt.prototype.absnormalx=null,nt.prototype.absnormaly=null,nt.prototype.origin_invalidate=function(n){this.originx=n.x,this.originy=n.y},nt.prototype.direction_invalidate=function(n){this.dirx=n.x,this.diry=n.y,this.zip_dir=!0},nt.prototype.zip_dir=null,nt.prototype.invalidate_dir=function(){this.zip_dir=!0},nt.prototype.validate_dir=function(){if(this.zip_dir){this.zip_dir=!1;var n=1/Math.sqrt(this.dirx*this.dirx+this.diry*this.diry);this.dirx*=n,this.diry*=n,this.idirx=1/this.dirx,this.idiry=1/this.diry,this.normalx=-this.diry,this.normaly=this.dirx;var e=this.normalx;this.absnormalx=e<0?-e:e;var t=this.normaly;this.absnormaly=t<0?-t:t}},nt.prototype.rayAABB=function(){var n,e=this.originx,t=e,i=this.originy,p=i;if(this.maxdist>=1/0?(this.dirx>0?t=1/0:this.dirx<0&&(t=-1/0),this.diry>0?p=1/0:this.diry<0&&(p=-1/0)):(t+=this.maxdist*this.dirx,p+=this.maxdist*this.diry),t<e){var l=e;e=t,t=l}if(p<i){var r=i;i=p,p=r}return null==Te.zpp_pool?n=new Te:(n=Te.zpp_pool,Te.zpp_pool=n.next,n.next=null),n.minx=e,n.miny=i,n.maxx=t,n.maxy=p,n},nt.prototype.aabbtest=function(n){var e=this.normalx*(this.originx-.5*(n.minx+n.maxx))+this.normaly*(this.originy-.5*(n.miny+n.maxy));return(e<0?-e:e)<.5*this.absnormalx*(n.maxx-n.minx)+.5*this.absnormaly*(n.maxy-n.miny)},nt.prototype.aabbsect=function(n){var e=this.originx>=n.minx&&this.originx<=n.maxx,t=this.originy>=n.miny&&this.originy<=n.maxy;if(e&&t)return 0;for(var i=-1;!(this.dirx>=0&&this.originx>=n.maxx||this.dirx<=0&&this.originx<=n.minx||this.diry>=0&&this.originy>=n.maxy||this.diry<=0&&this.originy<=n.miny);){if(this.dirx>0){var p=(n.minx-this.originx)*this.idirx;if(p>=0&&p<=this.maxdist){var l=this.originy+p*this.diry;if(l>=n.miny&&l<=n.maxy){i=p;break}}}else if(this.dirx<0){var r=(n.maxx-this.originx)*this.idirx;if(r>=0&&r<=this.maxdist){var o=this.originy+r*this.diry;if(o>=n.miny&&o<=n.maxy){i=r;break}}}if(this.diry>0){var a=(n.miny-this.originy)*this.idiry;if(a>=0&&a<=this.maxdist){var s=this.originx+a*this.dirx;if(s>=n.minx&&s<=n.maxx){i=a;break}}}else if(this.diry<0){var _=(n.maxy-this.originy)*this.idiry;if(_>=0&&_<=this.maxdist){var h=this.originx+_*this.dirx;if(h>=n.minx&&h<=n.maxx){i=_;break}}}break}return i},nt.prototype.circlesect=function(n,e,t){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var p=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var y=n.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z,v;z=this.originx-n.worldCOMx,v=this.originy-n.worldCOMy;var c=this.dirx*this.dirx+this.diry*this.diry,f=2*(z*this.dirx+v*this.diry),m=z*z+v*v-n.radius*n.radius,b=f*f-4*c*m;if(0==b){var g=-f/2*c;if((!e||m>0)&&g>0&&g<t&&g<=this.maxdist){var w=0,M=0;w=this.originx,M=this.originy,w+=this.dirx*g,M+=this.diry*g,w-=n.worldCOMx,M-=n.worldCOMy;var C,k=1/Math.sqrt(w*w+M*M);if(w*=k,M*=k,m<=0&&(w=-w,M=-M),null==xp.poolVec2?C=new yn:(C=xp.poolVec2,xp.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner){var O;null==xt.zpp_pool?O=new xt:(O=xt.zpp_pool,xt.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=w,O.y=M,C.zpp_inner=O,C.zpp_inner.outer=C}else{var P,S=C.zpp_inner;if(null!=S._validate&&S._validate(),C.zpp_inner.x==w){var A=C.zpp_inner;null!=A._validate&&A._validate(),P=C.zpp_inner.y==M}else P=!1;if(!P){C.zpp_inner.x=w,C.zpp_inner.y=M;var j=C.zpp_inner;null!=j._invalidate&&j._invalidate(j)}}return C.zpp_inner.weak=!1,De.getRay(C,g,m<=0,n.outer)}return null}var E=(-f-(b=Math.sqrt(b)))*(c=1/(2*c)),I=(-f+b)*c;if(E>0){if(E<t&&E<=this.maxdist){var T=0,N=0;T=this.originx,N=this.originy,T+=this.dirx*E,N+=this.diry*E,T-=n.worldCOMx,N-=n.worldCOMy;var L,V=1/Math.sqrt(T*T+N*N);if(T*=V,N*=V,null==xp.poolVec2?L=new yn:(L=xp.poolVec2,xp.poolVec2=L.zpp_pool,L.zpp_pool=null),null==L.zpp_inner){var D;null==xt.zpp_pool?D=new xt:(D=xt.zpp_pool,xt.zpp_pool=D.next,D.next=null),D.weak=!1,D._immutable=!1,D.x=T,D.y=N,L.zpp_inner=D,L.zpp_inner.outer=L}else{var F,R=L.zpp_inner;if(null!=R._validate&&R._validate(),L.zpp_inner.x==T){var Z=L.zpp_inner;null!=Z._validate&&Z._validate(),F=L.zpp_inner.y==N}else F=!1;if(!F){L.zpp_inner.x=T,L.zpp_inner.y=N;var B=L.zpp_inner;null!=B._invalidate&&B._invalidate(B)}}return L.zpp_inner.weak=!1,De.getRay(L,E,!1,n.outer)}return null}if(I>0&&e){if(I<t&&I<=this.maxdist){var G=0,q=0;G=this.originx,q=this.originy,G+=this.dirx*I,q+=this.diry*I,G-=n.worldCOMx,q-=n.worldCOMy;var U,K=1/Math.sqrt(G*G+q*q);if(G=-(G*=K),q=-(q*=K),null==xp.poolVec2?U=new yn:(U=xp.poolVec2,xp.poolVec2=U.zpp_pool,U.zpp_pool=null),null==U.zpp_inner){var W;null==xt.zpp_pool?W=new xt:(W=xt.zpp_pool,xt.zpp_pool=W.next,W.next=null),W.weak=!1,W._immutable=!1,W.x=G,W.y=q,U.zpp_inner=W,U.zpp_inner.outer=U}else{var Y,J=U.zpp_inner;if(null!=J._validate&&J._validate(),U.zpp_inner.x==G){var X=U.zpp_inner;null!=X._validate&&X._validate(),Y=U.zpp_inner.y==q}else Y=!1;if(!Y){U.zpp_inner.x=G,U.zpp_inner.y=q;var H=U.zpp_inner;null!=H._invalidate&&H._invalidate(H)}}return U.zpp_inner.weak=!1,De.getRay(U,I,!0,n.outer)}return null}return null},nt.prototype.circlesect2=function(n,e,t){if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var i=n.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var p=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var y=n.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var z,v;z=this.originx-n.worldCOMx,v=this.originy-n.worldCOMy;var c=this.dirx*this.dirx+this.diry*this.diry,f=2*(z*this.dirx+v*this.diry),m=z*z+v*v-n.radius*n.radius,b=f*f-4*c*m;if(0==b){var g=-f/2*c;if((!e||m>0)&&g>0&&g<=this.maxdist){var w=0,M=0;w=this.originx,M=this.originy,w+=this.dirx*g,M+=this.diry*g,w-=n.worldCOMx,M-=n.worldCOMy;var C,k=1/Math.sqrt(w*w+M*M);if(w*=k,M*=k,m<=0&&(w=-w,M=-M),null==xp.poolVec2?C=new yn:(C=xp.poolVec2,xp.poolVec2=C.zpp_pool,C.zpp_pool=null),null==C.zpp_inner){var O;null==xt.zpp_pool?O=new xt:(O=xt.zpp_pool,xt.zpp_pool=O.next,O.next=null),O.weak=!1,O._immutable=!1,O.x=w,O.y=M,C.zpp_inner=O,C.zpp_inner.outer=C}else{var P,S=C.zpp_inner;if(null!=S._validate&&S._validate(),C.zpp_inner.x==w){var A=C.zpp_inner;null!=A._validate&&A._validate(),P=C.zpp_inner.y==M}else P=!1;if(!P){C.zpp_inner.x=w,C.zpp_inner.y=M;var j=C.zpp_inner;null!=j._invalidate&&j._invalidate(j)}}C.zpp_inner.weak=!1;for(var E=De.getRay(C,g,m<=0,n.outer),I=null,T=t.zpp_inner.inner.head;null!=T&&!(E.zpp_inner.toiDistance<T.elt.zpp_inner.toiDistance);)I=T,T=T.next;var N,L=t.zpp_inner.inner;null==Ji.zpp_pool?N=new Ji:(N=Ji.zpp_pool,Ji.zpp_pool=N.next,N.next=null),N.elt=E;var V=N;null==I?(V.next=L.head,L.head=V):(V.next=I.next,I.next=V),L.pushmod=L.modified=!0,L.length++}}else{var D=(-f-(b=Math.sqrt(b)))*(c=1/(2*c)),F=(-f+b)*c;if(D>0&&D<=this.maxdist){var R=0,Z=0;R=this.originx,Z=this.originy,R+=this.dirx*D,Z+=this.diry*D,R-=n.worldCOMx,Z-=n.worldCOMy;var B,G=1/Math.sqrt(R*R+Z*Z);if(R*=G,Z*=G,null==xp.poolVec2?B=new yn:(B=xp.poolVec2,xp.poolVec2=B.zpp_pool,B.zpp_pool=null),null==B.zpp_inner){var q;null==xt.zpp_pool?q=new xt:(q=xt.zpp_pool,xt.zpp_pool=q.next,q.next=null),q.weak=!1,q._immutable=!1,q.x=R,q.y=Z,B.zpp_inner=q,B.zpp_inner.outer=B}else{var U,K=B.zpp_inner;if(null!=K._validate&&K._validate(),B.zpp_inner.x==R){var W=B.zpp_inner;null!=W._validate&&W._validate(),U=B.zpp_inner.y==Z}else U=!1;if(!U){B.zpp_inner.x=R,B.zpp_inner.y=Z;var Y=B.zpp_inner;null!=Y._invalidate&&Y._invalidate(Y)}}B.zpp_inner.weak=!1;for(var J=De.getRay(B,D,!1,n.outer),X=null,H=t.zpp_inner.inner.head;null!=H&&!(J.zpp_inner.toiDistance<H.elt.zpp_inner.toiDistance);)X=H,H=H.next;var $,Q=t.zpp_inner.inner;null==Ji.zpp_pool?$=new Ji:($=Ji.zpp_pool,Ji.zpp_pool=$.next,$.next=null),$.elt=J;var nn=$;null==X?(nn.next=Q.head,Q.head=nn):(nn.next=X.next,X.next=nn),Q.pushmod=Q.modified=!0,Q.length++}if(F>0&&F<=this.maxdist&&e){var en=0,tn=0;en=this.originx,tn=this.originy,en+=this.dirx*F,tn+=this.diry*F,en-=n.worldCOMx,tn-=n.worldCOMy;var pn,ln=1/Math.sqrt(en*en+tn*tn);if(en=-(en*=ln),tn=-(tn*=ln),null==xp.poolVec2?pn=new yn:(pn=xp.poolVec2,xp.poolVec2=pn.zpp_pool,pn.zpp_pool=null),null==pn.zpp_inner){var rn;null==xt.zpp_pool?rn=new xt:(rn=xt.zpp_pool,xt.zpp_pool=rn.next,rn.next=null),rn.weak=!1,rn._immutable=!1,rn.x=en,rn.y=tn,pn.zpp_inner=rn,pn.zpp_inner.outer=pn}else{var on,an=pn.zpp_inner;if(null!=an._validate&&an._validate(),pn.zpp_inner.x==en){var sn=pn.zpp_inner;null!=sn._validate&&sn._validate(),on=pn.zpp_inner.y==tn}else on=!1;if(!on){pn.zpp_inner.x=en,pn.zpp_inner.y=tn;var _n=pn.zpp_inner;null!=_n._invalidate&&_n._invalidate(_n)}}pn.zpp_inner.weak=!1;for(var hn=De.getRay(pn,F,!0,n.outer),un=null,xn=t.zpp_inner.inner.head;null!=xn&&!(hn.zpp_inner.toiDistance<xn.elt.zpp_inner.toiDistance);)un=xn,xn=xn.next;var dn,zn=t.zpp_inner.inner;null==Ji.zpp_pool?dn=new Ji:(dn=Ji.zpp_pool,Ji.zpp_pool=dn.next,dn.next=null),dn.elt=hn;var vn=dn;null==un?(vn.next=zn.head,zn.head=vn):(vn.next=un.next,un.next=vn),zn.pushmod=zn.modified=!0,zn.length++}}},nt.prototype.polysect=function(n,e,t){for(var i=t,p=null,l=n.edges.head,r=n.gverts.next,a=r,s=r.next;null!=s;){var _=s,h=l.elt;if(e||h.gnormx*this.dirx+h.gnormy*this.diry<0){var u,x;u=_.x-a.x,x=_.y-a.y;var d,y;d=a.x-this.originx,y=a.y-this.originy;var z=x*this.dirx-u*this.diry;if(z*z>o.epsilon){var v=(x*d-u*y)*(z=1/z);if(v>0&&v<i&&v<=this.maxdist){var c=(this.diry*d-this.dirx*y)*z;c>-o.epsilon&&c<1+o.epsilon&&(i=v,p=l.elt)}}}l=l.next,r=s,a=_,s=s.next}for(;;){var f=s=n.gverts.next,m=l.elt;if(e||m.gnormx*this.dirx+m.gnormy*this.diry<0){var b,g;b=f.x-a.x,g=f.y-a.y;var w,M;w=a.x-this.originx,M=a.y-this.originy;var C=g*this.dirx-b*this.diry;if(C*C>o.epsilon){var k=(g*w-b*M)*(C=1/C);if(k>0&&k<i&&k<=this.maxdist){var O=(this.diry*w-this.dirx*M)*C;O>-o.epsilon&&O<1+o.epsilon&&(i=k,p=l.elt)}}}l=l.next;break}if(null!=p){var P=0,S=0;P=p.gnormx,S=p.gnormy;var A,j=P*this.dirx+S*this.diry>0;if(j&&(P=-P,S=-S),null==xp.poolVec2?A=new yn:(A=xp.poolVec2,xp.poolVec2=A.zpp_pool,A.zpp_pool=null),null==A.zpp_inner){var E;null==xt.zpp_pool?E=new xt:(E=xt.zpp_pool,xt.zpp_pool=E.next,E.next=null),E.weak=!1,E._immutable=!1,E.x=P,E.y=S,A.zpp_inner=E,A.zpp_inner.outer=A}else{var I,T=A.zpp_inner;if(null!=T._validate&&T._validate(),A.zpp_inner.x==P){var N=A.zpp_inner;null!=N._validate&&N._validate(),I=A.zpp_inner.y==S}else I=!1;if(!I){A.zpp_inner.x=P,A.zpp_inner.y=S;var L=A.zpp_inner;null!=L._invalidate&&L._invalidate(L)}}return A.zpp_inner.weak=!1,De.getRay(A,i,j,n.outer)}return null},nt.prototype.polysect2=function(n,e,t){for(var i=1/0,p=-1,l=null,r=null,a=n.edges.head,s=n.gverts.next,_=s,h=s.next;null!=h;){var u=h,x=a.elt;if(e||x.gnormx*this.dirx+x.gnormy*this.diry<0){var d,y;d=u.x-_.x,y=u.y-_.y;var z,v;z=_.x-this.originx,v=_.y-this.originy;var c=y*this.dirx-d*this.diry;if(c*c>o.epsilon){var f=(y*z-d*v)*(c=1/c);if(f>0&&f<=this.maxdist&&(f<i||f>p)){var m=(this.diry*z-this.dirx*v)*c;m>-o.epsilon&&m<1+o.epsilon&&(f<i&&(i=f,l=a.elt),f>p&&(p=f,r=a.elt))}}}a=a.next,s=h,_=u,h=h.next}for(;;){var b=h=n.gverts.next,g=a.elt;if(e||g.gnormx*this.dirx+g.gnormy*this.diry<0){var w,M;w=b.x-_.x,M=b.y-_.y;var C,k;C=_.x-this.originx,k=_.y-this.originy;var O=M*this.dirx-w*this.diry;if(O*O>o.epsilon){var P=(M*C-w*k)*(O=1/O);if(P>0&&P<=this.maxdist&&(P<i||P>p)){var S=(this.diry*C-this.dirx*k)*O;S>-o.epsilon&&S<1+o.epsilon&&(P<i&&(i=P,l=a.elt),P>p&&(p=P,r=a.elt))}}}a=a.next;break}if(null!=l){var A=0,j=0;A=l.gnormx,j=l.gnormy;var E,I=A*this.dirx+j*this.diry>0;if(I&&(A=-A,j=-j),null==xp.poolVec2?E=new yn:(E=xp.poolVec2,xp.poolVec2=E.zpp_pool,E.zpp_pool=null),null==E.zpp_inner){var T;null==xt.zpp_pool?T=new xt:(T=xt.zpp_pool,xt.zpp_pool=T.next,T.next=null),T.weak=!1,T._immutable=!1,T.x=A,T.y=j,E.zpp_inner=T,E.zpp_inner.outer=E}else{var N,L=E.zpp_inner;if(null!=L._validate&&L._validate(),E.zpp_inner.x==A){var V=E.zpp_inner;null!=V._validate&&V._validate(),N=E.zpp_inner.y==j}else N=!1;if(!N){E.zpp_inner.x=A,E.zpp_inner.y=j;var D=E.zpp_inner;null!=D._invalidate&&D._invalidate(D)}}E.zpp_inner.weak=!1;for(var F=De.getRay(E,i,I,n.outer),R=null,Z=t.zpp_inner.inner.head;null!=Z&&!(F.zpp_inner.toiDistance<Z.elt.zpp_inner.toiDistance);)R=Z,Z=Z.next;var B,G=t.zpp_inner.inner;null==Ji.zpp_pool?B=new Ji:(B=Ji.zpp_pool,Ji.zpp_pool=B.next,B.next=null),B.elt=F;var q=B;null==R?(q.next=G.head,G.head=q):(q.next=R.next,R.next=q),G.pushmod=G.modified=!0,G.length++}if(null!=r&&l!=r){var U=0,K=0;U=r.gnormx,K=r.gnormy;var W,Y=U*this.dirx+K*this.diry>0;if(Y&&(U=-U,K=-K),null==xp.poolVec2?W=new yn:(W=xp.poolVec2,xp.poolVec2=W.zpp_pool,W.zpp_pool=null),null==W.zpp_inner){var J;null==xt.zpp_pool?J=new xt:(J=xt.zpp_pool,xt.zpp_pool=J.next,J.next=null),J.weak=!1,J._immutable=!1,J.x=U,J.y=K,W.zpp_inner=J,W.zpp_inner.outer=W}else{var X,H=W.zpp_inner;if(null!=H._validate&&H._validate(),W.zpp_inner.x==U){var $=W.zpp_inner;null!=$._validate&&$._validate(),X=W.zpp_inner.y==K}else X=!1;if(!X){W.zpp_inner.x=U,W.zpp_inner.y=K;var Q=W.zpp_inner;null!=Q._invalidate&&Q._invalidate(Q)}}W.zpp_inner.weak=!1;for(var nn=De.getRay(W,p,Y,n.outer),en=null,tn=t.zpp_inner.inner.head;null!=tn&&!(nn.zpp_inner.toiDistance<tn.elt.zpp_inner.toiDistance);)en=tn,tn=tn.next;var pn,ln=t.zpp_inner.inner;null==Ji.zpp_pool?pn=new Ji:(pn=Ji.zpp_pool,Ji.zpp_pool=pn.next,pn.next=null),pn.elt=nn;var rn=pn;null==en?(rn.next=ln.head,ln.head=rn):(rn.next=en.next,en.next=rn),ln.pushmod=ln.modified=!0,ln.length++}},nt.prototype.__class__=nt;var et=zpp_nape.geom.ZPP_SimpleVert=function(){this.node=null,this.next=null,this.id=0,this.links=null,this.y=0,this.x=0,this.forced=!1,this.id=Xn.ZPP_SimpleVert(),null==cp.zpp_pool?this.links=new cp:(this.links=cp.zpp_pool,cp.zpp_pool=this.links.next,this.links.next=null),this.links.lt=et.less_xy};et.__name__=["zpp_nape","geom","ZPP_SimpleVert"],et.less_xy=function(n,e){return n.y<e.y||n.y==e.y&&n.x<e.x},et.swap_nodes=function(n,e){var t=n.node;n.node=e.node,e.node=t},et.get=function(n,e){var t;return null==et.zpp_pool?t=new et:(t=et.zpp_pool,et.zpp_pool=t.next,t.next=null),t.x=n,t.y=e,t},et.prototype.forced=null,et.prototype.x=null,et.prototype.y=null,et.prototype.links=null,et.prototype.id=null,et.prototype.next=null,et.prototype.node=null,et.prototype.free=function(){this.links.clear(),this.node=null,this.forced=!1},et.prototype.alloc=function(){},et.prototype.__class__=et;var tt=zpp_nape.geom.ZPP_SimpleSeg=function(){this.node=null,this.prev=null,this.next=null,this.id=0,this.vertices=null,this.right=null,this.left=null,this.id=Xn.ZPP_SimpleSeg(),null==cp.zpp_pool?this.vertices=new cp:(this.vertices=cp.zpp_pool,cp.zpp_pool=this.vertices.next,this.vertices.next=null),this.vertices.lt=e(this,this.less_xy)};tt.__name__=["zpp_nape","geom","ZPP_SimpleSeg"],tt.get=function(n,e){var t;return null==tt.zpp_pool?t=new tt:(t=tt.zpp_pool,tt.zpp_pool=t.next,t.next=null),t.left=n,t.right=e,t.vertices.insert(n),t.vertices.insert(e),t},tt.prototype.left=null,tt.prototype.right=null,tt.prototype.vertices=null,tt.prototype.id=null,tt.prototype.next=null,tt.prototype.free=function(){this.left=this.right=null,this.prev=null,this.node=null,this.vertices.clear()},tt.prototype.alloc=function(){},tt.prototype.prev=null,tt.prototype.node=null,tt.prototype.less_xy=function(n,e){return n.x<e.x||n.x==e.x&&n.y<e.y},tt.prototype.__class__=tt;var it=zpp_nape.geom.ZPP_SimpleEvent=function(){this.next=null,this.node=null,this.segment2=null,this.segment=null,this.vertex=null,this.type=0};it.__name__=["zpp_nape","geom","ZPP_SimpleEvent"],it.swap_nodes=function(n,e){var t=n.node;n.node=e.node,e.node=t},it.less_xy=function(n,e){return n.vertex.x<e.vertex.x||!(n.vertex.x>e.vertex.x)&&(n.vertex.y<e.vertex.y||!(n.vertex.y>e.vertex.y)&&n.type<e.type)},it.get=function(n){var e;return null==it.zpp_pool?e=new it:(e=it.zpp_pool,it.zpp_pool=e.next,e.next=null),e.vertex=n,e},it.prototype.type=null,it.prototype.vertex=null,it.prototype.segment=null,it.prototype.segment2=null,it.prototype.node=null,it.prototype.next=null,it.prototype.free=function(){this.vertex=null,this.segment=this.segment2=null,this.node=null},it.prototype.alloc=function(){},it.prototype.__class__=it;var pt=zpp_nape.geom.ZPP_SimpleSweep=function(){this.tree=null,this.sweepx=0,null==fp.zpp_pool?this.tree=new fp:(this.tree=fp.zpp_pool,fp.zpp_pool=this.tree.next,this.tree.next=null),this.tree.lt=e(this,this.edge_lt),this.tree.swapped=e(this,this.swap_nodes)};pt.__name__=["zpp_nape","geom","ZPP_SimpleSweep"],pt.prototype.sweepx=null,pt.prototype.tree=null,pt.prototype.swap_nodes=function(n,e){var t=n.node;n.node=e.node,e.node=t},pt.prototype.edge_lt=function(n,e){var t,i,p=0,l=0,r=0,o=0;if(n.left==e.left&&n.right==e.right)return!1;if(n.left==e.right)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>e.left.y:n.right.y>e.left.y:(t=n.right.x<n.left.x,p=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,o=e.left.y-n.left.y,(t?l*r-p*o:o*p-r*l)<0);if(n.right==e.left)return e.left.x==e.right.x?i=e.left.y<e.right.y?e.left.y>n.left.y:e.right.y>n.left.y:(t=e.right.x<e.left.x,p=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.left.x-e.left.x,o=n.left.y-e.left.y,i=(t?l*r-p*o:o*p-r*l)<0),!i;if(n.left==e.left)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>e.right.y:n.right.y>e.right.y:(t=n.right.x<n.left.x,p=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.right.x-n.left.x,o=e.right.y-n.left.y,(t?l*r-p*o:o*p-r*l)<0);if(n.right==e.right)return n.left.x==n.right.x?n.left.y<n.right.y?n.left.y>e.left.y:n.right.y>e.left.y:(t=n.right.x<n.left.x,p=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,o=e.left.y-n.left.y,(t?l*r-p*o:o*p-r*l)<0);if(n.left.x==n.right.x){if(e.left.x==e.right.x)return(n.left.y<n.right.y?n.right:n.left).y>(e.left.y<e.right.y?e.right:e.left).y;t=e.right.x<e.left.x,p=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.left.x-e.left.x,o=n.left.y-e.left.y;var a=t?l*r-p*o:o*p-r*l;return t=e.right.x<e.left.x,p=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.right.x-e.left.x,o=n.right.y-e.left.y,a*(t?l*r-p*o:o*p-r*l)>=0?a>=0:this.sweepx>=n.left.x}if(e.left.x==e.right.x){t=n.right.x<n.left.x,p=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,o=e.left.y-n.left.y;var s=t?l*r-p*o:o*p-r*l;return t=n.right.x<n.left.x,p=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.right.x-n.left.x,o=e.right.y-n.left.y,s*(t?l*r-p*o:o*p-r*l)>=0?s<0:this.sweepx<e.left.x}t=n.right.x<n.left.x,p=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.left.x-n.left.x,o=e.left.y-n.left.y;var _=(t?l*r-p*o:o*p-r*l)<0;if(t=n.right.x<n.left.x,p=n.right.x-n.left.x,l=n.right.y-n.left.y,r=e.right.x-n.left.x,o=e.right.y-n.left.y,_==(t?l*r-p*o:o*p-r*l)<0)return _;t=e.right.x<e.left.x,p=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.left.x-e.left.x,o=n.left.y-e.left.y;var h=(t?l*r-p*o:o*p-r*l)>=0;return t=e.right.x<e.left.x,p=e.right.x-e.left.x,l=e.right.y-e.left.y,r=n.right.x-e.left.x,o=n.right.y-e.left.y,h==(t?l*r-p*o:o*p-r*l)>=0?h:(this.sweepx-n.left.x)/(n.right.x-n.left.x)*(n.right.y-n.left.y)+n.left.y>(this.sweepx-e.left.x)/(e.right.x-e.left.x)*(e.right.y-e.left.y)+e.left.y},pt.prototype.clear=function(){this.tree.clear()},pt.prototype.add=function(n){n.node=this.tree.insert(n);var e=this.tree.successor_node(n.node),t=this.tree.predecessor_node(n.node);return null!=e&&(n.next=e.data,e.data.prev=n),null!=t&&(n.prev=t.data,t.data.next=n),n},pt.prototype.remove=function(n){var e=this.tree.successor_node(n.node),t=this.tree.predecessor_node(n.node);null!=e&&(e.data.prev=n.prev),null!=t&&(t.data.next=n.next),this.tree.remove_node(n.node),n.node=null},pt.prototype.intersect=function(n,e){if(null==n||null==e)return!1;if(n.left==e.left||n.left==e.right||n.right==e.left||n.right==e.right)return!1;var t=(e.left.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(e.left.y-n.left.y),i=(e.right.x-n.left.x)*(n.right.y-n.left.y)-(n.right.x-n.left.x)*(e.right.y-n.left.y);if(t*i>0)return!1;var p=(n.left.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(n.left.y-e.left.y),l=(n.right.x-e.left.x)*(e.right.y-e.left.y)-(e.right.x-e.left.x)*(n.right.y-e.left.y);return!(p*l>0)},pt.prototype.intersection=function(n,e){if(null==n||null==e)return null;if(n.left==e.left||n.left==e.right||n.right==e.left||n.right==e.right)return null;var t,i;t=n.right.x-n.left.x,i=n.right.y-n.left.y;var p,l;p=e.right.x-e.left.x;var r=(l=e.right.y-e.left.y)*t-p*i;if(0==r)return null;r=1/r;var o,a,s=(l*(o=e.left.x-n.left.x)-p*(a=e.left.y-n.left.y))*r;if(s<0||s>1)return null;var _,h,u=(i*o-t*a)*r;if(u<0||u>1)return null;if(0==u||1==u||0==s||1==s)_=0==u?e.left:1==u?e.right:0==s?n.left:n.right;else{var x,d=.5*(n.left.x+t*s+e.left.x+p*u),y=.5*(n.left.y+i*s+e.left.y+l*u);null==et.zpp_pool?x=new et:(x=et.zpp_pool,et.zpp_pool=x.next,x.next=null),x.x=d,x.y=y,_=x}null==it.zpp_pool?h=new it:(h=it.zpp_pool,it.zpp_pool=h.next,h.next=null),h.vertex=_;var z=h;return z.type=0,z.segment=n,z.segment2=e,z},pt.prototype.__class__=pt;var lt=zpp_nape.geom.ZPP_Simple=function(){};lt.__name__=["zpp_nape","geom","ZPP_Simple"],lt.decompose=function(n,e){null==lt.sweep&&(lt.sweep=new pt,lt.inthash=new Zt),null==lt.vertices&&(null==cp.zpp_pool?lt.vertices=new cp:(lt.vertices=cp.zpp_pool,cp.zpp_pool=lt.vertices.next,lt.vertices.next=null),lt.vertices.lt=et.less_xy,lt.vertices.swapped=et.swap_nodes),null==lt.queue&&(null==mp.zpp_pool?lt.queue=new mp:(lt.queue=mp.zpp_pool,mp.zpp_pool=lt.queue.next,lt.queue.next=null),lt.queue.lt=it.less_xy,lt.queue.swapped=it.swap_nodes);var t,i=null,p=null;if(null!=n)for(var l=n;;){var r,o=l,a=o.x,s=o.y;null==et.zpp_pool?r=new et:(r=et.zpp_pool,et.zpp_pool=r.next,r.next=null),r.x=a,r.y=s;for(var _=r,h=lt.vertices.parent;null!=h;)if(lt.vertices.lt(_,h.data))h=h.prev;else{if(!lt.vertices.lt(h.data,_))break;h=h.next}var u=h;if(null!=u){var x=_;x.links.clear(),x.node=null,x.forced=!1,x.next=et.zpp_pool,et.zpp_pool=x,_=u.data}else _.node=lt.vertices.insert(_);if(null!=p){var d;null==it.zpp_pool?d=new it:(d=it.zpp_pool,it.zpp_pool=d.next,d.next=null),d.vertex=p;var y,z=d;null==it.zpp_pool?y=new it:(y=it.zpp_pool,it.zpp_pool=y.next,y.next=null),y.vertex=_;var v,c=y;it.less_xy(z,c)?(z.type=1,c.type=2,v=tt.get(p,_)):(z.type=2,c.type=1,v=tt.get(_,p)),z.segment=c.segment=v,lt.queue.insert(z),lt.queue.insert(c),p.links.insert(_),_.links.insert(p)}if(p=_,null==i&&(i=_),(l=l.next)==n)break}null==it.zpp_pool?t=new it:(t=it.zpp_pool,it.zpp_pool=t.next,t.next=null),t.vertex=p;var f,m=t;null==it.zpp_pool?f=new it:(f=it.zpp_pool,it.zpp_pool=f.next,f.next=null),f.vertex=i;var b,g=f;for(it.less_xy(m,g)?(m.type=1,g.type=2,b=tt.get(p,i)):(m.type=2,g.type=1,b=tt.get(i,p)),m.segment=g.segment=b,lt.queue.insert(m),lt.queue.insert(g),p.links.insert(i),i.links.insert(p),null==lt.ints&&(null==mp.zpp_pool?lt.ints=new mp:(lt.ints=mp.zpp_pool,mp.zpp_pool=lt.ints.next,lt.ints.next=null),lt.ints.lt=it.less_xy);!lt.queue.empty();){var w=lt.queue.pop_front();if(lt.sweep.sweepx=w.vertex.x,1==w.type){var M=w.segment;if(lt.sweep.add(M),null!=M.next&&null!=M&&!(M.next.id<M.id?lt.inthash.has(M.next.id,M.id):lt.inthash.has(M.id,M.next.id))){var C=lt.sweep.intersection(M.next,M);if(null!=C)if(C.vertex.x>=lt.sweep.sweepx){for(var k=lt.queue.parent;null!=k;)if(lt.queue.lt(C,k.data))k=k.prev;else{if(!lt.queue.lt(k.data,C))break;k=k.next}if(null==k){for(var O=lt.ints.parent;null!=O;)if(lt.ints.lt(C,O.data))O=O.prev;else{if(!lt.ints.lt(O.data,C))break;O=O.next}var P=O;if(null!=P){var S=C.vertex;S.links.clear(),S.node=null,S.forced=!1,S.next=et.zpp_pool,et.zpp_pool=S,C.vertex=P.data.vertex,P.data=C,lt.queue.insert(C)}else lt.queue.insert(C),lt.ints.insert(C);if(M.next.id<M.id){var A,j=M.next.id,E=M.id;null==Rt.zpp_pool?A=new Rt:(A=Rt.zpp_pool,Rt.zpp_pool=A.next,A.next=null),A.id=j,A.di=E;var I=A;I.value=!0,lt.inthash.add(I)}else{var T,N=M.id,L=M.next.id;null==Rt.zpp_pool?T=new Rt:(T=Rt.zpp_pool,Rt.zpp_pool=T.next,T.next=null),T.id=N,T.di=L;var V=T;V.value=!0,lt.inthash.add(V)}}else{var D=C.vertex;D.links.clear(),D.node=null,D.forced=!1,D.next=et.zpp_pool,et.zpp_pool=D,C.vertex=null,C.segment=C.segment2=null,C.node=null,C.next=it.zpp_pool,it.zpp_pool=C}}else{var F=C.vertex;F.links.clear(),F.node=null,F.forced=!1,F.next=et.zpp_pool,et.zpp_pool=F,C.vertex=null,C.segment=C.segment2=null,C.node=null,C.next=it.zpp_pool,it.zpp_pool=C}}if(null!=M&&null!=M.prev&&!(M.id<M.prev.id?lt.inthash.has(M.id,M.prev.id):lt.inthash.has(M.prev.id,M.id))){var R=lt.sweep.intersection(M,M.prev);if(null!=R)if(R.vertex.x>=lt.sweep.sweepx){for(var Z=lt.queue.parent;null!=Z;)if(lt.queue.lt(R,Z.data))Z=Z.prev;else{if(!lt.queue.lt(Z.data,R))break;Z=Z.next}if(null==Z){for(var B=lt.ints.parent;null!=B;)if(lt.ints.lt(R,B.data))B=B.prev;else{if(!lt.ints.lt(B.data,R))break;B=B.next}var G=B;if(null!=G){var q=R.vertex;q.links.clear(),q.node=null,q.forced=!1,q.next=et.zpp_pool,et.zpp_pool=q,R.vertex=G.data.vertex,G.data=R,lt.queue.insert(R)}else lt.queue.insert(R),lt.ints.insert(R);if(M.id<M.prev.id){var U,K=M.id,W=M.prev.id;null==Rt.zpp_pool?U=new Rt:(U=Rt.zpp_pool,Rt.zpp_pool=U.next,U.next=null),U.id=K,U.di=W;var Y=U;Y.value=!0,lt.inthash.add(Y)}else{var J,X=M.prev.id,H=M.id;null==Rt.zpp_pool?J=new Rt:(J=Rt.zpp_pool,Rt.zpp_pool=J.next,J.next=null),J.id=X,J.di=H;var $=J;$.value=!0,lt.inthash.add($)}}else{var Q=R.vertex;Q.links.clear(),Q.node=null,Q.forced=!1,Q.next=et.zpp_pool,et.zpp_pool=Q,R.vertex=null,R.segment=R.segment2=null,R.node=null,R.next=it.zpp_pool,it.zpp_pool=R}}else{var nn=R.vertex;nn.links.clear(),nn.node=null,nn.forced=!1,nn.next=et.zpp_pool,et.zpp_pool=nn,R.vertex=null,R.segment=R.segment2=null,R.node=null,R.next=it.zpp_pool,it.zpp_pool=R}}}else if(2==w.type){var en=w.segment;if(null!=en.node){var tn=en.next,pn=en.prev;if(lt.sweep.remove(en),en.left=en.right=null,en.prev=null,en.node=null,en.vertices.clear(),en.next=tt.zpp_pool,tt.zpp_pool=en,null!=tn&&null!=pn&&!(tn.id<pn.id?lt.inthash.has(tn.id,pn.id):lt.inthash.has(pn.id,tn.id))){var ln=lt.sweep.intersection(tn,pn);if(null!=ln)if(ln.vertex.x>=lt.sweep.sweepx){for(var rn=lt.queue.parent;null!=rn;)if(lt.queue.lt(ln,rn.data))rn=rn.prev;else{if(!lt.queue.lt(rn.data,ln))break;rn=rn.next}if(null==rn){for(var on=lt.ints.parent;null!=on;)if(lt.ints.lt(ln,on.data))on=on.prev;else{if(!lt.ints.lt(on.data,ln))break;on=on.next}var an=on;if(null!=an){var sn=ln.vertex;sn.links.clear(),sn.node=null,sn.forced=!1,sn.next=et.zpp_pool,et.zpp_pool=sn,ln.vertex=an.data.vertex,an.data=ln,lt.queue.insert(ln)}else lt.queue.insert(ln),lt.ints.insert(ln);if(tn.id<pn.id){var _n,hn=tn.id,un=pn.id;null==Rt.zpp_pool?_n=new Rt:(_n=Rt.zpp_pool,Rt.zpp_pool=_n.next,_n.next=null),_n.id=hn,_n.di=un;var xn=_n;xn.value=!0,lt.inthash.add(xn)}else{var dn,yn=pn.id,zn=tn.id;null==Rt.zpp_pool?dn=new Rt:(dn=Rt.zpp_pool,Rt.zpp_pool=dn.next,dn.next=null),dn.id=yn,dn.di=zn;var vn=dn;vn.value=!0,lt.inthash.add(vn)}}else{var cn=ln.vertex;cn.links.clear(),cn.node=null,cn.forced=!1,cn.next=et.zpp_pool,et.zpp_pool=cn,ln.vertex=null,ln.segment=ln.segment2=null,ln.node=null,ln.next=it.zpp_pool,it.zpp_pool=ln}}else{var fn=ln.vertex;fn.links.clear(),fn.node=null,fn.forced=!1,fn.next=et.zpp_pool,et.zpp_pool=fn,ln.vertex=null,ln.segment=ln.segment2=null,ln.node=null,ln.next=it.zpp_pool,it.zpp_pool=ln}}}}else{var mn=w.vertex,bn=null==mn.node,gn=w.segment,wn=w.segment2;if(wn.next!=gn){var Mn=gn;gn=wn,wn=Mn}for(var Cn=gn.vertices.parent;null!=Cn;)if(gn.vertices.lt(mn,Cn.data))Cn=Cn.prev;else{if(!gn.vertices.lt(Cn.data,mn))break;Cn=Cn.next}for(var kn=null==Cn,On=wn.vertices.parent;null!=On;)if(wn.vertices.lt(mn,On.data))On=On.prev;else{if(!wn.vertices.lt(On.data,mn))break;On=On.next}var Pn=null==On;if(kn){var Sn=gn.vertices.insert(mn),An=mn==gn.left?mn:gn.vertices.predecessor_node(Sn).data,jn=mn==gn.right?mn:gn.vertices.successor_node(Sn).data;An.links.remove(jn),mn!=An&&An.links.insert(mn),jn.links.remove(An),mn!=jn&&jn.links.insert(mn),mn!=An&&mn.links.insert(An),mn!=jn&&mn.links.insert(jn)}if(Pn){var En=wn.vertices.insert(mn),In=mn==wn.left?mn:wn.vertices.predecessor_node(En).data,Tn=mn==wn.right?mn:wn.vertices.successor_node(En).data;In.links.remove(Tn),mn!=In&&In.links.insert(mn),Tn.links.remove(In),mn!=Tn&&Tn.links.insert(mn),mn!=In&&mn.links.insert(In),mn!=Tn&&mn.links.insert(Tn)}if(bn&&(mn.node=lt.vertices.insert(mn)),mn.forced=!0,bn){var Nn=gn.node,Ln=wn.node;Nn.data=wn,Ln.data=gn,gn.node=Ln,wn.node=Nn,wn.next=gn.next,gn.next=wn,gn.prev=wn.prev,wn.prev=gn,null!=gn.prev&&(gn.prev.next=gn),null!=wn.next&&(wn.next.prev=wn)}if(null!=wn.next&&null!=wn&&!(wn.next.id<wn.id?lt.inthash.has(wn.next.id,wn.id):lt.inthash.has(wn.id,wn.next.id))){var Vn=lt.sweep.intersection(wn.next,wn);if(null!=Vn)if(Vn.vertex.x>=lt.sweep.sweepx){for(var Dn=lt.queue.parent;null!=Dn;)if(lt.queue.lt(Vn,Dn.data))Dn=Dn.prev;else{if(!lt.queue.lt(Dn.data,Vn))break;Dn=Dn.next}if(null==Dn){for(var Fn=lt.ints.parent;null!=Fn;)if(lt.ints.lt(Vn,Fn.data))Fn=Fn.prev;else{if(!lt.ints.lt(Fn.data,Vn))break;Fn=Fn.next}var Rn=Fn;if(null!=Rn){var Zn=Vn.vertex;Zn.links.clear(),Zn.node=null,Zn.forced=!1,Zn.next=et.zpp_pool,et.zpp_pool=Zn,Vn.vertex=Rn.data.vertex,Rn.data=Vn,lt.queue.insert(Vn)}else lt.queue.insert(Vn),lt.ints.insert(Vn);if(wn.next.id<wn.id){var Bn,Gn=wn.next.id,qn=wn.id;null==Rt.zpp_pool?Bn=new Rt:(Bn=Rt.zpp_pool,Rt.zpp_pool=Bn.next,Bn.next=null),Bn.id=Gn,Bn.di=qn;var Un=Bn;Un.value=!0,lt.inthash.add(Un)}else{var Kn,Wn=wn.id,Yn=wn.next.id;null==Rt.zpp_pool?Kn=new Rt:(Kn=Rt.zpp_pool,Rt.zpp_pool=Kn.next,Kn.next=null),Kn.id=Wn,Kn.di=Yn;var Jn=Kn;Jn.value=!0,lt.inthash.add(Jn)}}else{var Xn=Vn.vertex;Xn.links.clear(),Xn.node=null,Xn.forced=!1,Xn.next=et.zpp_pool,et.zpp_pool=Xn,Vn.vertex=null,Vn.segment=Vn.segment2=null,Vn.node=null,Vn.next=it.zpp_pool,it.zpp_pool=Vn}}else{var Hn=Vn.vertex;Hn.links.clear(),Hn.node=null,Hn.forced=!1,Hn.next=et.zpp_pool,et.zpp_pool=Hn,Vn.vertex=null,Vn.segment=Vn.segment2=null,Vn.node=null,Vn.next=it.zpp_pool,it.zpp_pool=Vn}}if(null!=gn&&null!=gn.prev&&!(gn.id<gn.prev.id?lt.inthash.has(gn.id,gn.prev.id):lt.inthash.has(gn.prev.id,gn.id))){var $n=lt.sweep.intersection(gn,gn.prev);if(null!=$n)if($n.vertex.x>=lt.sweep.sweepx){for(var Qn=lt.queue.parent;null!=Qn;)if(lt.queue.lt($n,Qn.data))Qn=Qn.prev;else{if(!lt.queue.lt(Qn.data,$n))break;Qn=Qn.next}if(null==Qn){for(var ne=lt.ints.parent;null!=ne;)if(lt.ints.lt($n,ne.data))ne=ne.prev;else{if(!lt.ints.lt(ne.data,$n))break;ne=ne.next}var ee=ne;if(null!=ee){var te=$n.vertex;te.links.clear(),te.node=null,te.forced=!1,te.next=et.zpp_pool,et.zpp_pool=te,$n.vertex=ee.data.vertex,ee.data=$n,lt.queue.insert($n)}else lt.queue.insert($n),lt.ints.insert($n);if(gn.id<gn.prev.id){var ie,pe=gn.id,le=gn.prev.id;null==Rt.zpp_pool?ie=new Rt:(ie=Rt.zpp_pool,Rt.zpp_pool=ie.next,ie.next=null),ie.id=pe,ie.di=le;var re=ie;re.value=!0,lt.inthash.add(re)}else{var oe,ae=gn.prev.id,se=gn.id;null==Rt.zpp_pool?oe=new Rt:(oe=Rt.zpp_pool,Rt.zpp_pool=oe.next,oe.next=null),oe.id=ae,oe.di=se;var _e=oe;_e.value=!0,lt.inthash.add(_e)}}else{var he=$n.vertex;he.links.clear(),he.node=null,he.forced=!1,he.next=et.zpp_pool,et.zpp_pool=he,$n.vertex=null,$n.segment=$n.segment2=null,$n.node=null,$n.next=it.zpp_pool,it.zpp_pool=$n}}else{var ue=$n.vertex;ue.links.clear(),ue.node=null,ue.forced=!1,ue.next=et.zpp_pool,et.zpp_pool=ue,$n.vertex=null,$n.segment=$n.segment2=null,$n.node=null,$n.next=it.zpp_pool,it.zpp_pool=$n}}lt.ints.remove(w)}w.vertex=null,w.segment=w.segment2=null,w.node=null,w.next=it.zpp_pool,it.zpp_pool=w}for(var xe=0,de=lt.inthash.table.length;xe<de;){var ye=xe++,ze=lt.inthash.table[ye];if(null!=ze){for(;null!=ze;){var ve=ze.hnext;ze.hnext=null;var ce=ze;ce.next=Rt.zpp_pool,Rt.zpp_pool=ce,ze=ve}lt.inthash.table[ye]=null}}for(null==e&&(e=new Qt);!lt.vertices.empty();)lt.clip_polygon(lt.vertices,e);return e},lt.clip_polygon=function(n,e){var t,i,p=null,l=n.first(),r=l,o=l.links.parent,a=null==o.prev?o.next:o.prev,s=o.data,_=a.data;t=l.x-s.x,i=l.y-s.y;var h;h=_.x-l.x,(_.y-l.y)*t-h*i<0&&(_=s);var u,x=l.x,d=l.y;null==Ge.zpp_pool?u=new Ge:(u=Ge.zpp_pool,Ge.zpp_pool=u.next,u.next=null),u.forced=!1,u.x=x,u.y=d;var y=u;for(null==p?p=y.prev=y.next=y:(y.prev=p,y.next=p.next,p.next.prev=y,p.next=y),p=y,y.forced=l.forced;;){if(l.links.remove(_),_.links.remove(l),_==r){if(l.links.empty()){n.remove(l);var z=l;z.links.clear(),z.node=null,z.forced=!1,z.next=et.zpp_pool,et.zpp_pool=z}break}var v,c=_.x,f=_.y;null==Ge.zpp_pool?v=new Ge:(v=Ge.zpp_pool,Ge.zpp_pool=v.next,v.next=null),v.forced=!1,v.x=c,v.y=f;var m=v;if(null==p?p=m.prev=m.next=m:(m.prev=p,m.next=p.next,p.next.prev=m,p.next=m),p=m,m.forced=_.forced,_.links.singular()){if(l.links.empty()){n.remove(l);var b=l;b.links.clear(),b.node=null,b.forced=!1,b.next=et.zpp_pool,et.zpp_pool=b}l=_,_=_.links.parent.data}else{var g=null,w=0;if(!_.links.empty()){for(var M=_.links.parent;null!=M.prev;)M=M.prev;for(;null!=M;){var C=M.data;if(null==g){g=C;var k,O;k=_.x-l.x,O=_.y-l.y;var P;P=C.x-_.x,w=(C.y-_.y)*k-P*O}else{var S,A;S=_.x-l.x,A=_.y-l.y;var j;j=C.x-_.x;var E=(C.y-_.y)*S-j*A;if(E>0&&w<=0)g=C,w=E;else if(w*E>=0){var I,T;I=_.x-C.x,T=_.y-C.y;var N;N=g.x-_.x,(g.y-_.y)*I-N*T>0&&(g=C,w=E)}}if(null!=M.next)for(M=M.next;null!=M.prev;)M=M.prev;else{for(;null!=M.parent&&M==M.parent.next;)M=M.parent;M=M.parent}}}if(l.links.empty()){n.remove(l);var L=l;L.links.clear(),L.node=null,L.forced=!1,L.next=et.zpp_pool,et.zpp_pool=L}l=_,_=g}}n.remove(r),r.links.clear(),r.node=null,r.forced=!1,r.next=et.zpp_pool,et.zpp_pool=r,e.add(p)},lt.isSimple=function(n){null==lt.sweep&&(lt.sweep=new pt,lt.inthash=new Zt);var e=lt.list_vertices;if(null==e&&(e=lt.list_vertices=new ni),null!=n)for(var t=n;;){var i,p=t,l=p.x,r=p.y;if(null==et.zpp_pool?i=new et:(i=et.zpp_pool,et.zpp_pool=i.next,i.next=null),i.x=l,i.y=r,e.add(i),(t=t.next)==n)break}var o=lt.list_queue;null==o&&(o=lt.list_queue=new ei);var a=e.head,s=a.elt;for(a=a.next;null!=a;){var _,h=a.elt;null==it.zpp_pool?_=new it:(_=it.zpp_pool,it.zpp_pool=_.next,_.next=null),_.vertex=s;var u,x=o.add(_);null==it.zpp_pool?u=new it:(u=it.zpp_pool,it.zpp_pool=u.next,u.next=null),u.vertex=h;var d,y=o.add(u);it.less_xy(x,y)?(x.type=1,y.type=2,d=tt.get(s,h)):(x.type=2,y.type=1,d=tt.get(h,s)),x.segment=y.segment=d,s=h,a=a.next}var z,v=e.head.elt;null==it.zpp_pool?z=new it:(z=it.zpp_pool,it.zpp_pool=z.next,z.next=null),z.vertex=s;var c,f=o.add(z);null==it.zpp_pool?c=new it:(c=it.zpp_pool,it.zpp_pool=c.next,c.next=null),c.vertex=v;var m,b=o.add(c);it.less_xy(f,b)?(f.type=1,b.type=2,m=tt.get(s,v)):(f.type=2,b.type=1,m=tt.get(v,s)),f.segment=b.segment=m;var g=o;if(null!=g.head&&null!=g.head.next){for(var w,M,C,k=g.head,O=null,P=null,S=null,A=null,j=1;;){for(w=0,P=k,O=k=null;null!=P;){for(++w,S=P,M=0,C=j;null!=S&&M<j;)++M,S=S.next;for(;M>0||C>0&&null!=S;)0==M?(A=S,S=S.next,--C):0==C||null==S?(A=P,P=P.next,--M):it.less_xy(P.elt,S.elt)?(A=P,P=P.next,--M):(A=S,S=S.next,--C),null!=O?O.next=A:k=A,O=A;P=S}if(O.next=null,j<<=1,!(w>1))break}g.head=k,g.modified=!0,g.pushmod=!0}for(var E=!0;null!=o.head;){var I=o.pop_unsafe(),T=I.segment;if(1==I.type){if(lt.sweep.add(T),lt.sweep.intersect(T,T.next)||lt.sweep.intersect(T,T.prev)){E=!1;break}}else if(2==I.type){if(lt.sweep.intersect(T.prev,T.next)){E=!1;break}lt.sweep.remove(T),T.left=T.right=null,T.prev=null,T.node=null,T.vertices.clear(),T.next=tt.zpp_pool,tt.zpp_pool=T}I.vertex=null,I.segment=I.segment2=null,I.node=null,I.next=it.zpp_pool,it.zpp_pool=I}for(;null!=o.head;){var N=o.pop_unsafe();if(2==N.type){var L=N.segment;L.left=L.right=null,L.prev=null,L.node=null,L.vertices.clear(),L.next=tt.zpp_pool,tt.zpp_pool=L}N.vertex=null,N.segment=N.segment2=null,N.node=null,N.next=it.zpp_pool,it.zpp_pool=N}for(lt.sweep.clear();null!=e.head;){var V=e.pop_unsafe();V.links.clear(),V.node=null,V.forced=!1,V.next=et.zpp_pool,et.zpp_pool=V}return E},lt.prototype.__class__=lt;var rt=zpp_nape.geom.ZPP_SimplifyV=function(){this.forced=!1,this.flag=!1,this.prev=null,this.next=null,this.y=0,this.x=0};rt.__name__=["zpp_nape","geom","ZPP_SimplifyV"],rt.get=function(n){var e;return null==rt.zpp_pool?e=new rt:(e=rt.zpp_pool,rt.zpp_pool=e.next,e.next=null),e.x=n.x,e.y=n.y,e.flag=!1,e},rt.prototype.x=null,rt.prototype.y=null,rt.prototype.next=null,rt.prototype.prev=null,rt.prototype.flag=null,rt.prototype.forced=null,rt.prototype.free=function(){},rt.prototype.alloc=function(){},rt.prototype.__class__=rt;var ot=zpp_nape.geom.ZPP_SimplifyP=function(){this.max=null,this.min=null,this.next=null};ot.__name__=["zpp_nape","geom","ZPP_SimplifyP"],ot.get=function(n,e){var t;return null==ot.zpp_pool?t=new ot:(t=ot.zpp_pool,ot.zpp_pool=t.next,t.next=null),t.min=n,t.max=e,t},ot.prototype.next=null,ot.prototype.min=null,ot.prototype.max=null,ot.prototype.free=function(){this.min=this.max=null},ot.prototype.alloc=function(){},ot.prototype.__class__=ot;var at=zpp_nape.geom.ZPP_Simplify=function(){};at.__name__=["zpp_nape","geom","ZPP_Simplify"],at.lessval=function(n,e){return n.x-e.x+(n.y-e.y)},at.less=function(n,e){return n.x-e.x+(n.y-e.y)<0},at.distance=function(n,e,t){var i,p;i=t.x-e.x,p=t.y-e.y;var l=0,r=0;if(l=n.x-e.x,r=n.y-e.y,i*i+p*p==0)return l*l+r*r;var o=(l*i+r*p)/(i*i+p*p);if(o<=0)return l*l+r*r;if(o>=1){var a,s,_=n.x,h=n.y;return(a=_-t.x)*a+(s=h-t.y)*s}return(l-=i*o)*l+(r-=p*o)*r},at.simplify=function(n,e){var t=null,i=null,p=null;e*=e,null==at.stack&&(at.stack=new Ht);for(var l,r=null,o=null,a=n;;){var s;null==rt.zpp_pool?s=new rt:(s=rt.zpp_pool,rt.zpp_pool=s.next,s.next=null),s.x=a.x,s.y=a.y,s.flag=!1;var _=s;if(_.forced=a.forced,_.forced){var h;if(_.flag=!0,null!=r)null==ot.zpp_pool?h=new ot:(h=ot.zpp_pool,ot.zpp_pool=h.next,h.next=null),h.min=r,h.max=_,at.stack.add(h);else o=_;r=_}if(null==t?t=_.prev=_.next=_:(_.prev=t,_.next=t.next,t.next.prev=_,t.next=_),t=_,null==i?(i=_,p=_):(_.x-i.x+(_.y-i.y)<0&&(i=_),p.x-_.x+(p.y-_.y)<0&&(p=_)),(a=a.next)==n)break}if(null==at.stack.head)if(null==o){var u,x;i.flag=p.flag=!0,null==ot.zpp_pool?u=new ot:(u=ot.zpp_pool,ot.zpp_pool=u.next,u.next=null),u.min=i,u.max=p,at.stack.add(u),null==ot.zpp_pool?x=new ot:(x=ot.zpp_pool,ot.zpp_pool=x.next,x.next=null),x.min=p,x.max=i,at.stack.add(x)}else{var d=i.x-o.x+(i.y-o.y);d<0&&(d=-d);var y,z,v,c,f=p.x-o.x+(p.y-o.y);if(f<0&&(f=-f),d>f)i.flag=o.flag=!0,null==ot.zpp_pool?y=new ot:(y=ot.zpp_pool,ot.zpp_pool=y.next,y.next=null),y.min=i,y.max=o,at.stack.add(y),null==ot.zpp_pool?z=new ot:(z=ot.zpp_pool,ot.zpp_pool=z.next,z.next=null),z.min=o,z.max=i,at.stack.add(z);else p.flag=o.flag=!0,null==ot.zpp_pool?v=new ot:(v=ot.zpp_pool,ot.zpp_pool=v.next,v.next=null),v.min=p,v.max=o,at.stack.add(v),null==ot.zpp_pool?c=new ot:(c=ot.zpp_pool,ot.zpp_pool=c.next,c.next=null),c.min=o,c.max=p,at.stack.add(c)}else null==ot.zpp_pool?l=new ot:(l=ot.zpp_pool,ot.zpp_pool=l.next,l.next=null),l.min=r,l.max=o,at.stack.add(l);for(;null!=at.stack.head;){var m=at.stack.pop_unsafe(),b=m.min,g=m.max;m.min=m.max=null,m.next=ot.zpp_pool,ot.zpp_pool=m;for(var w,M,C=e,k=null,O=b.next;O!=g;){var P=at.distance(O,b,g);P>C&&(C=P,k=O),O=O.next}if(null!=k)k.flag=!0,null==ot.zpp_pool?w=new ot:(w=ot.zpp_pool,ot.zpp_pool=w.next,w.next=null),w.min=b,w.max=k,at.stack.add(w),null==ot.zpp_pool?M=new ot:(M=ot.zpp_pool,ot.zpp_pool=M.next,M.next=null),M.min=k,M.max=g,at.stack.add(M)}for(var S=null;null!=t;){if(t.flag){var A,j=t.x,E=t.y;null==Ge.zpp_pool?A=new Ge:(A=Ge.zpp_pool,Ge.zpp_pool=A.next,A.next=null),A.forced=!1,A.x=j,A.y=E;var I=A;null==S?S=I.prev=I.next=I:(I.prev=S,I.next=S.next,S.next.prev=I,S.next=I),S=I,I.forced=t.forced}if(null!=t&&t.prev==t){t.next=t.prev=null;var T=t;T.next=rt.zpp_pool,rt.zpp_pool=T,t=t=null}else{var N=t.next;t.prev.next=t.next,t.next.prev=t.prev,t.next=t.prev=null;var L=t;L.next=rt.zpp_pool,rt.zpp_pool=L,t=null,t=N}}return S},at.prototype.__class__=at;var st=zpp_nape.geom.ZPP_ToiEvent=function(){this.kinematic=!1,this.failed=!1,this.slipped=!1,this.axis=null,this.c2=null,this.c1=null,this.frozen2=!1,this.frozen1=!1,this.arbiter=null,this.s2=null,this.s1=null,this.toi=0,this.next=null,this.c1=new xt,this.c2=new xt,this.axis=new xt};st.__name__=["zpp_nape","geom","ZPP_ToiEvent"],st.prototype.next=null,st.prototype.alloc=function(){this.failed=!1,this.s1=this.s2=null,this.arbiter=null},st.prototype.free=function(){},st.prototype.toi=null,st.prototype.s1=null,st.prototype.s2=null,st.prototype.arbiter=null,st.prototype.frozen1=null,st.prototype.frozen2=null,st.prototype.c1=null,st.prototype.c2=null,st.prototype.axis=null,st.prototype.slipped=null,st.prototype.failed=null,st.prototype.kinematic=null,st.prototype.__class__=st;var _t=zpp_nape.geom.ZPP_SweepDistance=function(){};_t.__name__=["zpp_nape","geom","ZPP_SweepDistance"],_t.dynamicSweep=function(n,e,t,i,p){null==p&&(p=!1);var l,r,a=n.s1,s=n.s2,_=a.body,h=s.body;l=h.velx-_.velx,r=h.vely-_.vely;var u=_.angvel;u<0&&(u=-u);var x=h.angvel;x<0&&(x=-x);var d=a.sweepCoef*u+s.sweepCoef*x;if(!p&&!n.kinematic&&l*l+r*r<o.dynamicSweepLinearThreshold*o.dynamicSweepLinearThreshold&&d<o.dynamicSweepAngularThreshold)return n.toi=-1,void(n.failed=!0);for(var y=n.c1,z=n.c2,v=n.axis,c=t,f=0;;){var m=c*e,b=m-_.sweepTime;if(0!=b&&(_.sweepTime=m,_.posx+=_.velx*b,_.posy+=_.vely*b,0!=_.angvel)){var g=_.sweep_angvel*b;if(_.rot+=g,g*g>1e-4)_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot);else{var w=g*g,M=1-.5*w,C=1-w*w/8,k=(M*_.axisx+g*_.axisy)*C;_.axisy=(M*_.axisy-g*_.axisx)*C,_.axisx=k}}if(0==a.type)a.worldCOMx=_.posx+(_.axisy*a.localCOMx-_.axisx*a.localCOMy),a.worldCOMy=_.posy+(a.localCOMx*_.axisx+a.localCOMy*_.axisy);else{for(var O=a.polygon,P=O.lverts.next,S=O.gverts.next;null!=S;){var A=S,j=P;P=P.next,A.x=_.posx+(_.axisy*j.x-_.axisx*j.y),A.y=_.posy+(j.x*_.axisx+j.y*_.axisy),S=S.next}var E=O.edges.head,I=O.gverts.next,T=I;for(I=I.next;null!=I;){var N=I,L=E.elt;E=E.next,L.gnormx=_.axisy*L.lnormx-_.axisx*L.lnormy,L.gnormy=L.lnormx*_.axisx+L.lnormy*_.axisy,L.gprojection=_.posx*L.gnormx+_.posy*L.gnormy+L.lprojection,L.tp0=T.y*L.gnormx-T.x*L.gnormy,L.tp1=N.y*L.gnormx-N.x*L.gnormy,T=N,I=I.next}var V=O.gverts.next,D=E.elt;D.gnormx=_.axisy*D.lnormx-_.axisx*D.lnormy,D.gnormy=D.lnormx*_.axisx+D.lnormy*_.axisy,D.gprojection=_.posx*D.gnormx+_.posy*D.gnormy+D.lprojection,D.tp0=T.y*D.gnormx-T.x*D.gnormy,D.tp1=V.y*D.gnormx-V.x*D.gnormy}var F=c*e,R=F-h.sweepTime;if(0!=R&&(h.sweepTime=F,h.posx+=h.velx*R,h.posy+=h.vely*R,0!=h.angvel)){var Z=h.sweep_angvel*R;if(h.rot+=Z,Z*Z>1e-4)h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot);else{var B=Z*Z,G=1-.5*B,q=1-B*B/8,U=(G*h.axisx+Z*h.axisy)*q;h.axisy=(G*h.axisy-Z*h.axisx)*q,h.axisx=U}}if(0==s.type)s.worldCOMx=h.posx+(h.axisy*s.localCOMx-h.axisx*s.localCOMy),s.worldCOMy=h.posy+(s.localCOMx*h.axisx+s.localCOMy*h.axisy);else{for(var K=s.polygon,W=K.lverts.next,Y=K.gverts.next;null!=Y;){var J=Y,X=W;W=W.next,J.x=h.posx+(h.axisy*X.x-h.axisx*X.y),J.y=h.posy+(X.x*h.axisx+X.y*h.axisy),Y=Y.next}var H=K.edges.head,$=K.gverts.next,Q=$;for($=$.next;null!=$;){var nn=$,en=H.elt;H=H.next,en.gnormx=h.axisy*en.lnormx-h.axisx*en.lnormy,en.gnormy=en.lnormx*h.axisx+en.lnormy*h.axisy,en.gprojection=h.posx*en.gnormx+h.posy*en.gnormy+en.lprojection,en.tp0=Q.y*en.gnormx-Q.x*en.gnormy,en.tp1=nn.y*en.gnormx-nn.x*en.gnormy,Q=nn,$=$.next}var tn=K.gverts.next,pn=H.elt;pn.gnormx=h.axisy*pn.lnormx-h.axisx*pn.lnormy,pn.gnormy=pn.lnormx*h.axisx+pn.lnormy*h.axisy,pn.gprojection=h.posx*pn.gnormx+h.posy*pn.gnormy+pn.lprojection,pn.tp0=Q.y*pn.gnormx-Q.x*pn.gnormy,pn.tp1=tn.y*pn.gnormx-tn.x*pn.gnormy}var ln,rn=a,on=s,an=y,sn=z;if(0==a.type&&0==s.type){var _n,hn=a.circle,un=s.circle,xn=0,dn=0;xn=un.worldCOMx-hn.worldCOMx,dn=un.worldCOMy-hn.worldCOMy;var yn=Math.sqrt(xn*xn+dn*dn);if((_n=yn-(hn.radius+un.radius))<1e100){if(0==yn)xn=1,dn=0;else{var zn=1/yn;xn*=zn,dn*=zn}var vn=hn.radius;y.x=hn.worldCOMx+xn*vn,y.y=hn.worldCOMy+dn*vn;var cn=-un.radius;z.x=un.worldCOMx+xn*cn,z.y=un.worldCOMy+dn*cn,v.x=xn,v.y=dn}ln=_n}else{var fn=!1;if(0==a.type&&1==s.type)rn=s,on=a,an=z,sn=y,fn=!0;if(1==rn.type&&0==on.type){for(var mn=rn.polygon,bn=on.circle,gn=-1e100,wn=null,Mn=mn.edges.head;null!=Mn;){var Cn=Mn.elt,kn=Cn.gnormx*bn.worldCOMx+Cn.gnormy*bn.worldCOMy-Cn.gprojection-bn.radius;if(kn>1e100){gn=kn;break}kn>0?kn>gn&&(gn=kn,wn=Cn):gn<0&&kn>gn&&(gn=kn,wn=Cn),Mn=Mn.next}if(gn<1e100){var On=wn.gp0,Pn=wn.gp1,Sn=bn.worldCOMy*wn.gnormx-bn.worldCOMx*wn.gnormy;if(Sn<=On.y*wn.gnormx-On.x*wn.gnormy){var An=0,jn=0;An=bn.worldCOMx-On.x,jn=bn.worldCOMy-On.y;var En=Math.sqrt(An*An+jn*jn);if((gn=En-bn.radius)<1e100){if(0==En)An=1,jn=0;else{var In=1/En;An*=In,jn*=In}an.x=On.x+0*An,an.y=On.y+0*jn;var Tn=-bn.radius;sn.x=bn.worldCOMx+An*Tn,sn.y=bn.worldCOMy+jn*Tn,v.x=An,v.y=jn}}else if(Sn>=Pn.y*wn.gnormx-Pn.x*wn.gnormy){var Nn=0,Ln=0;Nn=bn.worldCOMx-Pn.x,Ln=bn.worldCOMy-Pn.y;var Vn=Math.sqrt(Nn*Nn+Ln*Ln);if((gn=Vn-bn.radius)<1e100){if(0==Vn)Nn=1,Ln=0;else{var Dn=1/Vn;Nn*=Dn,Ln*=Dn}an.x=Pn.x+0*Nn,an.y=Pn.y+0*Ln;var Fn=-bn.radius;sn.x=bn.worldCOMx+Nn*Fn,sn.y=bn.worldCOMy+Ln*Fn,v.x=Nn,v.y=Ln}}else{var Rn=-bn.radius;sn.x=bn.worldCOMx+wn.gnormx*Rn,sn.y=bn.worldCOMy+wn.gnormy*Rn;var Zn=-gn;an.x=sn.x+wn.gnormx*Zn,an.y=sn.y+wn.gnormy*Zn,v.x=wn.gnormx,v.y=wn.gnormy}}fn&&(v.x=-v.x,v.y=-v.y),ln=gn}else{for(var Bn=rn.polygon,Gn=on.polygon,qn=-1e100,Un=null,Kn=null,Wn=0,Yn=Bn.edges.head;null!=Yn;){for(var Jn=Yn.elt,Xn=1e100,Hn=Gn.gverts.next;null!=Hn;){var $n=Hn,Qn=Jn.gnormx*$n.x+Jn.gnormy*$n.y;Qn<Xn&&(Xn=Qn),Hn=Hn.next}if((Xn-=Jn.gprojection)>1e100){qn=Xn;break}Xn>0?Xn>qn&&(qn=Xn,Un=Jn,Wn=1):qn<0&&Xn>qn&&(qn=Xn,Un=Jn,Wn=1),Yn=Yn.next}if(qn<1e100){for(var ne=Gn.edges.head;null!=ne;){for(var ee=ne.elt,te=1e100,ie=Bn.gverts.next;null!=ie;){var pe=ie,le=ee.gnormx*pe.x+ee.gnormy*pe.y;le<te&&(te=le),ie=ie.next}if((te-=ee.gprojection)>1e100){qn=te;break}te>0?te>qn&&(qn=te,Kn=ee,Wn=2):qn<0&&te>qn&&(qn=te,Kn=ee,Wn=2),ne=ne.next}if(qn<1e100){var re,oe;if(1==Wn)re=Gn,oe=Un;else{re=Bn,oe=Kn;var ae=an;an=sn,sn=ae,fn=!fn}for(var se=null,_e=1e100,he=re.edges.head;null!=he;){var ue=he.elt,xe=oe.gnormx*ue.gnormx+oe.gnormy*ue.gnormy;xe<_e&&(_e=xe,se=ue),he=he.next}if(fn?(v.x=-oe.gnormx,v.y=-oe.gnormy):(v.x=oe.gnormx,v.y=oe.gnormy),qn>=0){var de,ye,ze,ve,ce=oe.gp0,fe=oe.gp1,me=se.gp0,be=se.gp1,ge=1/((de=fe.x-ce.x)*de+(ye=fe.y-ce.y)*ye),we=1/((ze=be.x-me.x)*ze+(ve=be.y-me.y)*ve),Me=-(de*(ce.x-me.x)+ye*(ce.y-me.y))*ge,Ce=-(de*(ce.x-be.x)+ye*(ce.y-be.y))*ge,ke=-(ze*(me.x-ce.x)+ve*(me.y-ce.y))*we,Oe=-(ze*(me.x-fe.x)+ve*(me.y-fe.y))*we;Me<0?Me=0:Me>1&&(Me=1),Ce<0?Ce=0:Ce>1&&(Ce=1),ke<0?ke=0:ke>1&&(ke=1),Oe<0?Oe=0:Oe>1&&(Oe=1);var Pe,Se,Ae=Me;Pe=ce.x+de*Ae,Se=ce.y+ye*Ae;var je,Ee,Ie=Ce;je=ce.x+de*Ie,Ee=ce.y+ye*Ie;var Te,Ne,Le=ke;Te=me.x+ze*Le,Ne=me.y+ve*Le;var Ve,De,Fe=Oe;Ve=me.x+ze*Fe,De=me.y+ve*Fe;var Re,Ze,Be,Ge,qe,Ue,Ke,We,Ye=(Re=Pe-me.x)*Re+(Ze=Se-me.y)*Ze,Je=(Be=je-be.x)*Be+(Ge=Ee-be.y)*Ge,Xe=(qe=Te-ce.x)*qe+(Ue=Ne-ce.y)*Ue,He=(Ke=Ve-fe.x)*Ke+(We=De-fe.y)*We,$e=0,Qe=0,nt=null;Ye<Je?($e=Pe,Qe=Se,nt=me):($e=je,Qe=Ee,nt=be,Ye=Je);var et=0,tt=0,it=null;if(Xe<He?(et=Te,tt=Ne,it=ce):(et=Ve,tt=De,it=fe,Xe=He),Ye<Xe?(an.x=$e,an.y=Qe,sn.x=nt.x,sn.y=nt.y,qn=Math.sqrt(Ye)):(sn.x=et,sn.y=tt,an.x=it.x,an.y=it.y,qn=Math.sqrt(Xe)),0!=qn){v.x=sn.x-an.x,v.y=sn.y-an.y;var pt=1/qn;v.x*=pt,v.y*=pt,fn&&(v.x=-v.x,v.y=-v.y)}ln=qn}else{var lt=0,rt=0;lt=se.gp0.x,rt=se.gp0.y;var ot,at,st=0,_t=0;ot=(st=se.gp1.x)-lt,at=(_t=se.gp1.y)-rt;var ht=oe.gnormy*lt-oe.gnormx*rt,ut=oe.gnormy*st-oe.gnormx*_t,xt=1/(ut-ht),dt=(-oe.tp1-ht)*xt;dt>o.epsilon&&(lt+=ot*dt,rt+=at*dt);var yt=(-oe.tp0-ut)*xt;yt<-o.epsilon&&(st+=ot*yt,_t+=at*yt);var zt=lt*oe.gnormx+rt*oe.gnormy-oe.gprojection,vt=st*oe.gnormx+_t*oe.gnormy-oe.gprojection;if(zt<vt){sn.x=lt,sn.y=rt;var ct=-zt;an.x=sn.x+oe.gnormx*ct,an.y=sn.y+oe.gnormy*ct,ln=zt}else{sn.x=st,sn.y=_t;var ft=-vt;an.x=sn.x+oe.gnormx*ft,an.y=sn.y+oe.gnormy*ft,ln=vt}}}else ln=1e100}else ln=1e100}}var mt=ln+i,bt=l*v.x+r*v.y;if(mt<o.distanceThresholdCCD){if(p)break;var gt,wt;gt=y.x-_.posx,wt=y.y-_.posy;var Mt,Ct;Mt=z.x-h.posx,Ct=z.y-h.posy;var kt=bt-_.sweep_angvel*(v.y*gt-v.x*wt)+h.sweep_angvel*(v.y*Mt-v.x*Ct);if(kt>0&&(n.slipped=!0),kt<=0||mt<.5*o.distanceThresholdCCD)break}var Ot=(d-bt)*e;if(Ot<=0){c=-1;break}var Pt=mt/Ot;if(Pt<1e-6&&(Pt=1e-6),(c+=Pt)>=1){var St=(c=1)*e,At=St-_.sweepTime;if(0!=At&&(_.sweepTime=St,_.posx+=_.velx*At,_.posy+=_.vely*At,0!=_.angvel)){var jt=_.sweep_angvel*At;if(_.rot+=jt,jt*jt>1e-4)_.axisx=Math.sin(_.rot),_.axisy=Math.cos(_.rot);else{var Et=jt*jt,It=1-.5*Et,Tt=1-Et*Et/8,Nt=(It*_.axisx+jt*_.axisy)*Tt;_.axisy=(It*_.axisy-jt*_.axisx)*Tt,_.axisx=Nt}}if(0==a.type)a.worldCOMx=_.posx+(_.axisy*a.localCOMx-_.axisx*a.localCOMy),a.worldCOMy=_.posy+(a.localCOMx*_.axisx+a.localCOMy*_.axisy);else{for(var Lt=a.polygon,Vt=Lt.lverts.next,Dt=Lt.gverts.next;null!=Dt;){var Ft=Dt,Rt=Vt;Vt=Vt.next,Ft.x=_.posx+(_.axisy*Rt.x-_.axisx*Rt.y),Ft.y=_.posy+(Rt.x*_.axisx+Rt.y*_.axisy),Dt=Dt.next}var Zt=Lt.edges.head,Bt=Lt.gverts.next,Gt=Bt;for(Bt=Bt.next;null!=Bt;){var qt=Bt,Ut=Zt.elt;Zt=Zt.next,Ut.gnormx=_.axisy*Ut.lnormx-_.axisx*Ut.lnormy,Ut.gnormy=Ut.lnormx*_.axisx+Ut.lnormy*_.axisy,Ut.gprojection=_.posx*Ut.gnormx+_.posy*Ut.gnormy+Ut.lprojection,Ut.tp0=Gt.y*Ut.gnormx-Gt.x*Ut.gnormy,Ut.tp1=qt.y*Ut.gnormx-qt.x*Ut.gnormy,Gt=qt,Bt=Bt.next}var Kt=Lt.gverts.next,Wt=Zt.elt;Wt.gnormx=_.axisy*Wt.lnormx-_.axisx*Wt.lnormy,Wt.gnormy=Wt.lnormx*_.axisx+Wt.lnormy*_.axisy,Wt.gprojection=_.posx*Wt.gnormx+_.posy*Wt.gnormy+Wt.lprojection,Wt.tp0=Gt.y*Wt.gnormx-Gt.x*Wt.gnormy,Wt.tp1=Kt.y*Wt.gnormx-Kt.x*Wt.gnormy}var Yt=c*e,Jt=Yt-h.sweepTime;if(0!=Jt&&(h.sweepTime=Yt,h.posx+=h.velx*Jt,h.posy+=h.vely*Jt,0!=h.angvel)){var Xt=h.sweep_angvel*Jt;if(h.rot+=Xt,Xt*Xt>1e-4)h.axisx=Math.sin(h.rot),h.axisy=Math.cos(h.rot);else{var Ht=Xt*Xt,$t=1-.5*Ht,Qt=1-Ht*Ht/8,ni=($t*h.axisx+Xt*h.axisy)*Qt;h.axisy=($t*h.axisy-Xt*h.axisx)*Qt,h.axisx=ni}}if(0==s.type)s.worldCOMx=h.posx+(h.axisy*s.localCOMx-h.axisx*s.localCOMy),s.worldCOMy=h.posy+(s.localCOMx*h.axisx+s.localCOMy*h.axisy);else{for(var ei=s.polygon,ti=ei.lverts.next,ii=ei.gverts.next;null!=ii;){var pi=ii,li=ti;ti=ti.next,pi.x=h.posx+(h.axisy*li.x-h.axisx*li.y),pi.y=h.posy+(li.x*h.axisx+li.y*h.axisy),ii=ii.next}var ri=ei.edges.head,oi=ei.gverts.next,ai=oi;for(oi=oi.next;null!=oi;){var si=oi,_i=ri.elt;ri=ri.next,_i.gnormx=h.axisy*_i.lnormx-h.axisx*_i.lnormy,_i.gnormy=_i.lnormx*h.axisx+_i.lnormy*h.axisy,_i.gprojection=h.posx*_i.gnormx+h.posy*_i.gnormy+_i.lprojection,_i.tp0=ai.y*_i.gnormx-ai.x*_i.gnormy,_i.tp1=si.y*_i.gnormx-si.x*_i.gnormy,ai=si,oi=oi.next}var hi=ei.gverts.next,ui=ri.elt;ui.gnormx=h.axisy*ui.lnormx-h.axisx*ui.lnormy,ui.gnormy=ui.lnormx*h.axisx+ui.lnormy*h.axisy,ui.gprojection=h.posx*ui.gnormx+h.posy*ui.gnormy+ui.lprojection,ui.tp0=ai.y*ui.gnormx-ai.x*ui.gnormy,ui.tp1=hi.y*ui.gnormx-hi.x*ui.gnormy}var xi,di=a,yi=s,zi=y,vi=z;if(0==a.type&&0==s.type){var ci,fi=a.circle,mi=s.circle,bi=0,gi=0;bi=mi.worldCOMx-fi.worldCOMx,gi=mi.worldCOMy-fi.worldCOMy;var wi=Math.sqrt(bi*bi+gi*gi);if((ci=wi-(fi.radius+mi.radius))<1e100){if(0==wi)bi=1,gi=0;else{var Mi=1/wi;bi*=Mi,gi*=Mi}var Ci=fi.radius;y.x=fi.worldCOMx+bi*Ci,y.y=fi.worldCOMy+gi*Ci;var ki=-mi.radius;z.x=mi.worldCOMx+bi*ki,z.y=mi.worldCOMy+gi*ki,v.x=bi,v.y=gi}xi=ci}else{var Oi=!1;if(0==a.type&&1==s.type)di=s,yi=a,zi=z,vi=y,Oi=!0;if(1==di.type&&0==yi.type){for(var Pi=di.polygon,Si=yi.circle,Ai=-1e100,ji=null,Ei=Pi.edges.head;null!=Ei;){var Ii=Ei.elt,Ti=Ii.gnormx*Si.worldCOMx+Ii.gnormy*Si.worldCOMy-Ii.gprojection-Si.radius;if(Ti>1e100){Ai=Ti;break}Ti>0?Ti>Ai&&(Ai=Ti,ji=Ii):Ai<0&&Ti>Ai&&(Ai=Ti,ji=Ii),Ei=Ei.next}if(Ai<1e100){var Ni=ji.gp0,Li=ji.gp1,Vi=Si.worldCOMy*ji.gnormx-Si.worldCOMx*ji.gnormy;if(Vi<=Ni.y*ji.gnormx-Ni.x*ji.gnormy){var Di=0,Fi=0;Di=Si.worldCOMx-Ni.x,Fi=Si.worldCOMy-Ni.y;var Ri=Math.sqrt(Di*Di+Fi*Fi);if((Ai=Ri-Si.radius)<1e100){if(0==Ri)Di=1,Fi=0;else{var Zi=1/Ri;Di*=Zi,Fi*=Zi}zi.x=Ni.x+0*Di,zi.y=Ni.y+0*Fi;var Bi=-Si.radius;vi.x=Si.worldCOMx+Di*Bi,vi.y=Si.worldCOMy+Fi*Bi,v.x=Di,v.y=Fi}}else if(Vi>=Li.y*ji.gnormx-Li.x*ji.gnormy){var Gi=0,qi=0;Gi=Si.worldCOMx-Li.x,qi=Si.worldCOMy-Li.y;var Ui=Math.sqrt(Gi*Gi+qi*qi);if((Ai=Ui-Si.radius)<1e100){if(0==Ui)Gi=1,qi=0;else{var Ki=1/Ui;Gi*=Ki,qi*=Ki}zi.x=Li.x+0*Gi,zi.y=Li.y+0*qi;var Wi=-Si.radius;vi.x=Si.worldCOMx+Gi*Wi,vi.y=Si.worldCOMy+qi*Wi,v.x=Gi,v.y=qi}}else{var Yi=-Si.radius;vi.x=Si.worldCOMx+ji.gnormx*Yi,vi.y=Si.worldCOMy+ji.gnormy*Yi;var Ji=-Ai;zi.x=vi.x+ji.gnormx*Ji,zi.y=vi.y+ji.gnormy*Ji,v.x=ji.gnormx,v.y=ji.gnormy}}Oi&&(v.x=-v.x,v.y=-v.y),xi=Ai}else{for(var Xi=di.polygon,Hi=yi.polygon,$i=-1e100,Qi=null,np=null,ep=0,tp=Xi.edges.head;null!=tp;){for(var ip=tp.elt,pp=1e100,lp=Hi.gverts.next;null!=lp;){var rp=lp,op=ip.gnormx*rp.x+ip.gnormy*rp.y;op<pp&&(pp=op),lp=lp.next}if((pp-=ip.gprojection)>1e100){$i=pp;break}pp>0?pp>$i&&($i=pp,Qi=ip,ep=1):$i<0&&pp>$i&&($i=pp,Qi=ip,ep=1),tp=tp.next}if($i<1e100){for(var ap=Hi.edges.head;null!=ap;){for(var sp=ap.elt,_p=1e100,hp=Xi.gverts.next;null!=hp;){var up=hp,xp=sp.gnormx*up.x+sp.gnormy*up.y;xp<_p&&(_p=xp),hp=hp.next}if((_p-=sp.gprojection)>1e100){$i=_p;break}_p>0?_p>$i&&($i=_p,np=sp,ep=2):$i<0&&_p>$i&&($i=_p,np=sp,ep=2),ap=ap.next}if($i<1e100){var dp,yp;if(1==ep)dp=Hi,yp=Qi;else{dp=Xi,yp=np;var zp=zi;zi=vi,vi=zp,Oi=!Oi}for(var vp=null,cp=1e100,fp=dp.edges.head;null!=fp;){var mp=fp.elt,bp=yp.gnormx*mp.gnormx+yp.gnormy*mp.gnormy;bp<cp&&(cp=bp,vp=mp),fp=fp.next}if(Oi?(v.x=-yp.gnormx,v.y=-yp.gnormy):(v.x=yp.gnormx,v.y=yp.gnormy),$i>=0){var gp,wp,Mp,Cp,kp=yp.gp0,Op=yp.gp1,Pp=vp.gp0,Sp=vp.gp1,Ap=1/((gp=Op.x-kp.x)*gp+(wp=Op.y-kp.y)*wp),jp=1/((Mp=Sp.x-Pp.x)*Mp+(Cp=Sp.y-Pp.y)*Cp),Ep=-(gp*(kp.x-Pp.x)+wp*(kp.y-Pp.y))*Ap,Ip=-(gp*(kp.x-Sp.x)+wp*(kp.y-Sp.y))*Ap,Tp=-(Mp*(Pp.x-kp.x)+Cp*(Pp.y-kp.y))*jp,Np=-(Mp*(Pp.x-Op.x)+Cp*(Pp.y-Op.y))*jp;Ep<0?Ep=0:Ep>1&&(Ep=1),Ip<0?Ip=0:Ip>1&&(Ip=1),Tp<0?Tp=0:Tp>1&&(Tp=1),Np<0?Np=0:Np>1&&(Np=1);var Lp,Vp,Dp=Ep;Lp=kp.x+gp*Dp,Vp=kp.y+wp*Dp;var Fp,Rp,Zp=Ip;Fp=kp.x+gp*Zp,Rp=kp.y+wp*Zp;var Bp,Gp,qp=Tp;Bp=Pp.x+Mp*qp,Gp=Pp.y+Cp*qp;var Up,Kp,Wp=Np;Up=Pp.x+Mp*Wp,Kp=Pp.y+Cp*Wp;var Yp,Jp,Xp,Hp,$p,Qp,nl,el,tl=(Yp=Lp-Pp.x)*Yp+(Jp=Vp-Pp.y)*Jp,il=(Xp=Fp-Sp.x)*Xp+(Hp=Rp-Sp.y)*Hp,pl=($p=Bp-kp.x)*$p+(Qp=Gp-kp.y)*Qp,ll=(nl=Up-Op.x)*nl+(el=Kp-Op.y)*el,rl=0,ol=0,al=null;tl<il?(rl=Lp,ol=Vp,al=Pp):(rl=Fp,ol=Rp,al=Sp,tl=il);var sl=0,_l=0,hl=null;if(pl<ll?(sl=Bp,_l=Gp,hl=kp):(sl=Up,_l=Kp,hl=Op,pl=ll),tl<pl?(zi.x=rl,zi.y=ol,vi.x=al.x,vi.y=al.y,$i=Math.sqrt(tl)):(vi.x=sl,vi.y=_l,zi.x=hl.x,zi.y=hl.y,$i=Math.sqrt(pl)),0!=$i){v.x=vi.x-zi.x,v.y=vi.y-zi.y;var ul=1/$i;v.x*=ul,v.y*=ul,Oi&&(v.x=-v.x,v.y=-v.y)}xi=$i}else{var xl=0,dl=0;xl=vp.gp0.x,dl=vp.gp0.y;var yl,zl,vl=0,cl=0;yl=(vl=vp.gp1.x)-xl,zl=(cl=vp.gp1.y)-dl;var fl=yp.gnormy*xl-yp.gnormx*dl,ml=yp.gnormy*vl-yp.gnormx*cl,bl=1/(ml-fl),gl=(-yp.tp1-fl)*bl;gl>o.epsilon&&(xl+=yl*gl,dl+=zl*gl);var wl=(-yp.tp0-ml)*bl;wl<-o.epsilon&&(vl+=yl*wl,cl+=zl*wl);var Ml=xl*yp.gnormx+dl*yp.gnormy-yp.gprojection,Cl=vl*yp.gnormx+cl*yp.gnormy-yp.gprojection;if(Ml<Cl){vi.x=xl,vi.y=dl;var kl=-Ml;zi.x=vi.x+yp.gnormx*kl,zi.y=vi.y+yp.gnormy*kl,xi=Ml}else{vi.x=vl,vi.y=cl;var Ol=-Cl;zi.x=vi.x+yp.gnormx*Ol,zi.y=vi.y+yp.gnormy*Ol,xi=Cl}}}else xi=1e100}else xi=1e100}}var Pl=xi+i,Sl=l*v.x+r*v.y;if(Pl<o.distanceThresholdCCD){if(p)break;var Al,jl;Al=y.x-_.posx,jl=y.y-_.posy;var El,Il;El=z.x-h.posx,Il=z.y-h.posy;var Tl=Sl-_.sweep_angvel*(v.y*Al-v.x*jl)+h.sweep_angvel*(v.y*El-v.x*Il);if(Tl>0&&(n.slipped=!0),Tl<=0||Pl<.5*o.distanceThresholdCCD)break}c=-1;break}if(++f>=40){mt>i&&(n.failed=!0);break}}n.toi=c},_t.staticSweep=function(n,e,t,i){var p,l,r=n.s1,a=n.s2,s=r.body;p=-s.velx,l=-s.vely;var _=s.sweep_angvel;_<0&&(_=-_);for(var h=r.sweepCoef*_,u=n.c1,x=n.c2,d=n.axis,y=t,z=0;;){var v=y*e,c=v-s.sweepTime;if(0!=c&&(s.sweepTime=v,s.posx+=s.velx*c,s.posy+=s.vely*c,0!=s.angvel)){var f=s.sweep_angvel*c;if(s.rot+=f,f*f>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var m=f*f,b=1-.5*m,g=1-m*m/8,w=(b*s.axisx+f*s.axisy)*g;s.axisy=(b*s.axisy-f*s.axisx)*g,s.axisx=w}}if(0==r.type)r.worldCOMx=s.posx+(s.axisy*r.localCOMx-s.axisx*r.localCOMy),r.worldCOMy=s.posy+(r.localCOMx*s.axisx+r.localCOMy*s.axisy);else{for(var M=r.polygon,C=M.lverts.next,k=M.gverts.next;null!=k;){var O=k,P=C;C=C.next,O.x=s.posx+(s.axisy*P.x-s.axisx*P.y),O.y=s.posy+(P.x*s.axisx+P.y*s.axisy),k=k.next}var S=M.edges.head,A=M.gverts.next,j=A;for(A=A.next;null!=A;){var E=A,I=S.elt;S=S.next,I.gnormx=s.axisy*I.lnormx-s.axisx*I.lnormy,I.gnormy=I.lnormx*s.axisx+I.lnormy*s.axisy,I.gprojection=s.posx*I.gnormx+s.posy*I.gnormy+I.lprojection,I.tp0=j.y*I.gnormx-j.x*I.gnormy,I.tp1=E.y*I.gnormx-E.x*I.gnormy,j=E,A=A.next}var T=M.gverts.next,N=S.elt;N.gnormx=s.axisy*N.lnormx-s.axisx*N.lnormy,N.gnormy=N.lnormx*s.axisx+N.lnormy*s.axisy,N.gprojection=s.posx*N.gnormx+s.posy*N.gnormy+N.lprojection,N.tp0=j.y*N.gnormx-j.x*N.gnormy,N.tp1=T.y*N.gnormx-T.x*N.gnormy}var L,V=r,D=a,F=u,R=x;if(0==r.type&&0==a.type){var Z,B=r.circle,G=a.circle,q=0,U=0;q=G.worldCOMx-B.worldCOMx,U=G.worldCOMy-B.worldCOMy;var K=Math.sqrt(q*q+U*U);if((Z=K-(B.radius+G.radius))<1e100){if(0==K)q=1,U=0;else{var W=1/K;q*=W,U*=W}var Y=B.radius;u.x=B.worldCOMx+q*Y,u.y=B.worldCOMy+U*Y;var J=-G.radius;x.x=G.worldCOMx+q*J,x.y=G.worldCOMy+U*J,d.x=q,d.y=U}L=Z}else{var X=!1;if(0==r.type&&1==a.type)V=a,D=r,F=x,R=u,X=!0;if(1==V.type&&0==D.type){for(var H=V.polygon,$=D.circle,Q=-1e100,nn=null,en=H.edges.head;null!=en;){var tn=en.elt,pn=tn.gnormx*$.worldCOMx+tn.gnormy*$.worldCOMy-tn.gprojection-$.radius;if(pn>1e100){Q=pn;break}pn>0?pn>Q&&(Q=pn,nn=tn):Q<0&&pn>Q&&(Q=pn,nn=tn),en=en.next}if(Q<1e100){var ln=nn.gp0,rn=nn.gp1,on=$.worldCOMy*nn.gnormx-$.worldCOMx*nn.gnormy;if(on<=ln.y*nn.gnormx-ln.x*nn.gnormy){var an=0,sn=0;an=$.worldCOMx-ln.x,sn=$.worldCOMy-ln.y;var _n=Math.sqrt(an*an+sn*sn);if((Q=_n-$.radius)<1e100){if(0==_n)an=1,sn=0;else{var hn=1/_n;an*=hn,sn*=hn}F.x=ln.x+0*an,F.y=ln.y+0*sn;var un=-$.radius;R.x=$.worldCOMx+an*un,R.y=$.worldCOMy+sn*un,d.x=an,d.y=sn}}else if(on>=rn.y*nn.gnormx-rn.x*nn.gnormy){var xn=0,dn=0;xn=$.worldCOMx-rn.x,dn=$.worldCOMy-rn.y;var yn=Math.sqrt(xn*xn+dn*dn);if((Q=yn-$.radius)<1e100){if(0==yn)xn=1,dn=0;else{var zn=1/yn;xn*=zn,dn*=zn}F.x=rn.x+0*xn,F.y=rn.y+0*dn;var vn=-$.radius;R.x=$.worldCOMx+xn*vn,R.y=$.worldCOMy+dn*vn,d.x=xn,d.y=dn}}else{var cn=-$.radius;R.x=$.worldCOMx+nn.gnormx*cn,R.y=$.worldCOMy+nn.gnormy*cn;var fn=-Q;F.x=R.x+nn.gnormx*fn,F.y=R.y+nn.gnormy*fn,d.x=nn.gnormx,d.y=nn.gnormy}}X&&(d.x=-d.x,d.y=-d.y),L=Q}else{for(var mn=V.polygon,bn=D.polygon,gn=-1e100,wn=null,Mn=null,Cn=0,kn=mn.edges.head;null!=kn;){for(var On=kn.elt,Pn=1e100,Sn=bn.gverts.next;null!=Sn;){var An=Sn,jn=On.gnormx*An.x+On.gnormy*An.y;jn<Pn&&(Pn=jn),Sn=Sn.next}if((Pn-=On.gprojection)>1e100){gn=Pn;break}Pn>0?Pn>gn&&(gn=Pn,wn=On,Cn=1):gn<0&&Pn>gn&&(gn=Pn,wn=On,Cn=1),kn=kn.next}if(gn<1e100){for(var En=bn.edges.head;null!=En;){for(var In=En.elt,Tn=1e100,Nn=mn.gverts.next;null!=Nn;){var Ln=Nn,Vn=In.gnormx*Ln.x+In.gnormy*Ln.y;Vn<Tn&&(Tn=Vn),Nn=Nn.next}if((Tn-=In.gprojection)>1e100){gn=Tn;break}Tn>0?Tn>gn&&(gn=Tn,Mn=In,Cn=2):gn<0&&Tn>gn&&(gn=Tn,Mn=In,Cn=2),En=En.next}if(gn<1e100){var Dn,Fn;if(1==Cn)Dn=bn,Fn=wn;else{Dn=mn,Fn=Mn;var Rn=F;F=R,R=Rn,X=!X}for(var Zn=null,Bn=1e100,Gn=Dn.edges.head;null!=Gn;){var qn=Gn.elt,Un=Fn.gnormx*qn.gnormx+Fn.gnormy*qn.gnormy;Un<Bn&&(Bn=Un,Zn=qn),Gn=Gn.next}if(X?(d.x=-Fn.gnormx,d.y=-Fn.gnormy):(d.x=Fn.gnormx,d.y=Fn.gnormy),gn>=0){var Kn,Wn,Yn,Jn,Xn=Fn.gp0,Hn=Fn.gp1,$n=Zn.gp0,Qn=Zn.gp1,ne=1/((Kn=Hn.x-Xn.x)*Kn+(Wn=Hn.y-Xn.y)*Wn),ee=1/((Yn=Qn.x-$n.x)*Yn+(Jn=Qn.y-$n.y)*Jn),te=-(Kn*(Xn.x-$n.x)+Wn*(Xn.y-$n.y))*ne,ie=-(Kn*(Xn.x-Qn.x)+Wn*(Xn.y-Qn.y))*ne,pe=-(Yn*($n.x-Xn.x)+Jn*($n.y-Xn.y))*ee,le=-(Yn*($n.x-Hn.x)+Jn*($n.y-Hn.y))*ee;te<0?te=0:te>1&&(te=1),ie<0?ie=0:ie>1&&(ie=1),pe<0?pe=0:pe>1&&(pe=1),le<0?le=0:le>1&&(le=1);var re,oe,ae=te;re=Xn.x+Kn*ae,oe=Xn.y+Wn*ae;var se,_e,he=ie;se=Xn.x+Kn*he,_e=Xn.y+Wn*he;var ue,xe,de=pe;ue=$n.x+Yn*de,xe=$n.y+Jn*de;var ye,ze,ve=le;ye=$n.x+Yn*ve,ze=$n.y+Jn*ve;var ce,fe,me,be,ge,we,Me,Ce,ke=(ce=re-$n.x)*ce+(fe=oe-$n.y)*fe,Oe=(me=se-Qn.x)*me+(be=_e-Qn.y)*be,Pe=(ge=ue-Xn.x)*ge+(we=xe-Xn.y)*we,Se=(Me=ye-Hn.x)*Me+(Ce=ze-Hn.y)*Ce,Ae=0,je=0,Ee=null;ke<Oe?(Ae=re,je=oe,Ee=$n):(Ae=se,je=_e,Ee=Qn,ke=Oe);var Ie=0,Te=0,Ne=null;if(Pe<Se?(Ie=ue,Te=xe,Ne=Xn):(Ie=ye,Te=ze,Ne=Hn,Pe=Se),ke<Pe?(F.x=Ae,F.y=je,R.x=Ee.x,R.y=Ee.y,gn=Math.sqrt(ke)):(R.x=Ie,R.y=Te,F.x=Ne.x,F.y=Ne.y,gn=Math.sqrt(Pe)),0!=gn){d.x=R.x-F.x,d.y=R.y-F.y;var Le=1/gn;d.x*=Le,d.y*=Le,X&&(d.x=-d.x,d.y=-d.y)}L=gn}else{var Ve=0,De=0;Ve=Zn.gp0.x,De=Zn.gp0.y;var Fe,Re,Ze=0,Be=0;Fe=(Ze=Zn.gp1.x)-Ve,Re=(Be=Zn.gp1.y)-De;var Ge=Fn.gnormy*Ve-Fn.gnormx*De,qe=Fn.gnormy*Ze-Fn.gnormx*Be,Ue=1/(qe-Ge),Ke=(-Fn.tp1-Ge)*Ue;Ke>o.epsilon&&(Ve+=Fe*Ke,De+=Re*Ke);var We=(-Fn.tp0-qe)*Ue;We<-o.epsilon&&(Ze+=Fe*We,Be+=Re*We);var Ye=Ve*Fn.gnormx+De*Fn.gnormy-Fn.gprojection,Je=Ze*Fn.gnormx+Be*Fn.gnormy-Fn.gprojection;if(Ye<Je){R.x=Ve,R.y=De;var Xe=-Ye;F.x=R.x+Fn.gnormx*Xe,F.y=R.y+Fn.gnormy*Xe,L=Ye}else{R.x=Ze,R.y=Be;var He=-Je;F.x=R.x+Fn.gnormx*He,F.y=R.y+Fn.gnormy*He,L=Je}}}else L=1e100}else L=1e100}}var $e=L+i,Qe=p*d.x+l*d.y;if($e<o.distanceThresholdCCD){var nt,et;nt=u.x-s.posx,et=u.y-s.posy;var tt=Qe-s.sweep_angvel*(d.y*nt-d.x*et);if(tt>0&&(n.slipped=!0),tt<=0||$e<.5*o.distanceThresholdCCD)break}var it=(h-Qe)*e;if(it<=0){y=-1;break}var pt=$e/it;if(pt<1e-6&&(pt=1e-6),(y+=pt)>=1){var lt=(y=1)*e,rt=lt-s.sweepTime;if(0!=rt&&(s.sweepTime=lt,s.posx+=s.velx*rt,s.posy+=s.vely*rt,0!=s.angvel)){var ot=s.sweep_angvel*rt;if(s.rot+=ot,ot*ot>1e-4)s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot);else{var at=ot*ot,st=1-.5*at,_t=1-at*at/8,ht=(st*s.axisx+ot*s.axisy)*_t;s.axisy=(st*s.axisy-ot*s.axisx)*_t,s.axisx=ht}}if(0==r.type)r.worldCOMx=s.posx+(s.axisy*r.localCOMx-s.axisx*r.localCOMy),r.worldCOMy=s.posy+(r.localCOMx*s.axisx+r.localCOMy*s.axisy);else{for(var ut=r.polygon,xt=ut.lverts.next,dt=ut.gverts.next;null!=dt;){var yt=dt,zt=xt;xt=xt.next,yt.x=s.posx+(s.axisy*zt.x-s.axisx*zt.y),yt.y=s.posy+(zt.x*s.axisx+zt.y*s.axisy),dt=dt.next}var vt=ut.edges.head,ct=ut.gverts.next,ft=ct;for(ct=ct.next;null!=ct;){var mt=ct,bt=vt.elt;vt=vt.next,bt.gnormx=s.axisy*bt.lnormx-s.axisx*bt.lnormy,bt.gnormy=bt.lnormx*s.axisx+bt.lnormy*s.axisy,bt.gprojection=s.posx*bt.gnormx+s.posy*bt.gnormy+bt.lprojection,bt.tp0=ft.y*bt.gnormx-ft.x*bt.gnormy,bt.tp1=mt.y*bt.gnormx-mt.x*bt.gnormy,ft=mt,ct=ct.next}var gt=ut.gverts.next,wt=vt.elt;wt.gnormx=s.axisy*wt.lnormx-s.axisx*wt.lnormy,wt.gnormy=wt.lnormx*s.axisx+wt.lnormy*s.axisy,wt.gprojection=s.posx*wt.gnormx+s.posy*wt.gnormy+wt.lprojection,wt.tp0=ft.y*wt.gnormx-ft.x*wt.gnormy,wt.tp1=gt.y*wt.gnormx-gt.x*wt.gnormy}var Mt,Ct=r,kt=a,Ot=u,Pt=x;if(0==r.type&&0==a.type){var St,At=r.circle,jt=a.circle,Et=0,It=0;Et=jt.worldCOMx-At.worldCOMx,It=jt.worldCOMy-At.worldCOMy;var Tt=Math.sqrt(Et*Et+It*It);if((St=Tt-(At.radius+jt.radius))<1e100){if(0==Tt)Et=1,It=0;else{var Nt=1/Tt;Et*=Nt,It*=Nt}var Lt=At.radius;u.x=At.worldCOMx+Et*Lt,u.y=At.worldCOMy+It*Lt;var Vt=-jt.radius;x.x=jt.worldCOMx+Et*Vt,x.y=jt.worldCOMy+It*Vt,d.x=Et,d.y=It}Mt=St}else{var Dt=!1;if(0==r.type&&1==a.type)Ct=a,kt=r,Ot=x,Pt=u,Dt=!0;if(1==Ct.type&&0==kt.type){for(var Ft=Ct.polygon,Rt=kt.circle,Zt=-1e100,Bt=null,Gt=Ft.edges.head;null!=Gt;){var qt=Gt.elt,Ut=qt.gnormx*Rt.worldCOMx+qt.gnormy*Rt.worldCOMy-qt.gprojection-Rt.radius;if(Ut>1e100){Zt=Ut;break}Ut>0?Ut>Zt&&(Zt=Ut,Bt=qt):Zt<0&&Ut>Zt&&(Zt=Ut,Bt=qt),Gt=Gt.next}if(Zt<1e100){var Kt=Bt.gp0,Wt=Bt.gp1,Yt=Rt.worldCOMy*Bt.gnormx-Rt.worldCOMx*Bt.gnormy;if(Yt<=Kt.y*Bt.gnormx-Kt.x*Bt.gnormy){var Jt=0,Xt=0;Jt=Rt.worldCOMx-Kt.x,Xt=Rt.worldCOMy-Kt.y;var Ht=Math.sqrt(Jt*Jt+Xt*Xt);if((Zt=Ht-Rt.radius)<1e100){if(0==Ht)Jt=1,Xt=0;else{var $t=1/Ht;Jt*=$t,Xt*=$t}Ot.x=Kt.x+0*Jt,Ot.y=Kt.y+0*Xt;var Qt=-Rt.radius;Pt.x=Rt.worldCOMx+Jt*Qt,Pt.y=Rt.worldCOMy+Xt*Qt,d.x=Jt,d.y=Xt}}else if(Yt>=Wt.y*Bt.gnormx-Wt.x*Bt.gnormy){var ni=0,ei=0;ni=Rt.worldCOMx-Wt.x,ei=Rt.worldCOMy-Wt.y;var ti=Math.sqrt(ni*ni+ei*ei);if((Zt=ti-Rt.radius)<1e100){if(0==ti)ni=1,ei=0;else{var ii=1/ti;ni*=ii,ei*=ii}Ot.x=Wt.x+0*ni,Ot.y=Wt.y+0*ei;var pi=-Rt.radius;Pt.x=Rt.worldCOMx+ni*pi,Pt.y=Rt.worldCOMy+ei*pi,d.x=ni,d.y=ei}}else{var li=-Rt.radius;Pt.x=Rt.worldCOMx+Bt.gnormx*li,Pt.y=Rt.worldCOMy+Bt.gnormy*li;var ri=-Zt;Ot.x=Pt.x+Bt.gnormx*ri,Ot.y=Pt.y+Bt.gnormy*ri,d.x=Bt.gnormx,d.y=Bt.gnormy}}Dt&&(d.x=-d.x,d.y=-d.y),Mt=Zt}else{for(var oi=Ct.polygon,ai=kt.polygon,si=-1e100,_i=null,hi=null,ui=0,xi=oi.edges.head;null!=xi;){for(var di=xi.elt,yi=1e100,zi=ai.gverts.next;null!=zi;){var vi=zi,ci=di.gnormx*vi.x+di.gnormy*vi.y;ci<yi&&(yi=ci),zi=zi.next}if((yi-=di.gprojection)>1e100){si=yi;break}yi>0?yi>si&&(si=yi,_i=di,ui=1):si<0&&yi>si&&(si=yi,_i=di,ui=1),xi=xi.next}if(si<1e100){for(var fi=ai.edges.head;null!=fi;){for(var mi=fi.elt,bi=1e100,gi=oi.gverts.next;null!=gi;){var wi=gi,Mi=mi.gnormx*wi.x+mi.gnormy*wi.y;Mi<bi&&(bi=Mi),gi=gi.next}if((bi-=mi.gprojection)>1e100){si=bi;break}bi>0?bi>si&&(si=bi,hi=mi,ui=2):si<0&&bi>si&&(si=bi,hi=mi,ui=2),fi=fi.next}if(si<1e100){var Ci,ki;if(1==ui)Ci=ai,ki=_i;else{Ci=oi,ki=hi;var Oi=Ot;Ot=Pt,Pt=Oi,Dt=!Dt}for(var Pi=null,Si=1e100,Ai=Ci.edges.head;null!=Ai;){var ji=Ai.elt,Ei=ki.gnormx*ji.gnormx+ki.gnormy*ji.gnormy;Ei<Si&&(Si=Ei,Pi=ji),Ai=Ai.next}if(Dt?(d.x=-ki.gnormx,d.y=-ki.gnormy):(d.x=ki.gnormx,d.y=ki.gnormy),si>=0){var Ii,Ti,Ni,Li,Vi=ki.gp0,Di=ki.gp1,Fi=Pi.gp0,Ri=Pi.gp1,Zi=1/((Ii=Di.x-Vi.x)*Ii+(Ti=Di.y-Vi.y)*Ti),Bi=1/((Ni=Ri.x-Fi.x)*Ni+(Li=Ri.y-Fi.y)*Li),Gi=-(Ii*(Vi.x-Fi.x)+Ti*(Vi.y-Fi.y))*Zi,qi=-(Ii*(Vi.x-Ri.x)+Ti*(Vi.y-Ri.y))*Zi,Ui=-(Ni*(Fi.x-Vi.x)+Li*(Fi.y-Vi.y))*Bi,Ki=-(Ni*(Fi.x-Di.x)+Li*(Fi.y-Di.y))*Bi;Gi<0?Gi=0:Gi>1&&(Gi=1),qi<0?qi=0:qi>1&&(qi=1),Ui<0?Ui=0:Ui>1&&(Ui=1),Ki<0?Ki=0:Ki>1&&(Ki=1);var Wi,Yi,Ji=Gi;Wi=Vi.x+Ii*Ji,Yi=Vi.y+Ti*Ji;var Xi,Hi,$i=qi;Xi=Vi.x+Ii*$i,Hi=Vi.y+Ti*$i;var Qi,np,ep=Ui;Qi=Fi.x+Ni*ep,np=Fi.y+Li*ep;var tp,ip,pp=Ki;tp=Fi.x+Ni*pp,ip=Fi.y+Li*pp;var lp,rp,op,ap,sp,_p,hp,up,xp=(lp=Wi-Fi.x)*lp+(rp=Yi-Fi.y)*rp,dp=(op=Xi-Ri.x)*op+(ap=Hi-Ri.y)*ap,yp=(sp=Qi-Vi.x)*sp+(_p=np-Vi.y)*_p,zp=(hp=tp-Di.x)*hp+(up=ip-Di.y)*up,vp=0,cp=0,fp=null;xp<dp?(vp=Wi,cp=Yi,fp=Fi):(vp=Xi,cp=Hi,fp=Ri,xp=dp);var mp=0,bp=0,gp=null;if(yp<zp?(mp=Qi,bp=np,gp=Vi):(mp=tp,bp=ip,gp=Di,yp=zp),xp<yp?(Ot.x=vp,Ot.y=cp,Pt.x=fp.x,Pt.y=fp.y,si=Math.sqrt(xp)):(Pt.x=mp,Pt.y=bp,Ot.x=gp.x,Ot.y=gp.y,si=Math.sqrt(yp)),0!=si){d.x=Pt.x-Ot.x,d.y=Pt.y-Ot.y;var wp=1/si;d.x*=wp,d.y*=wp,Dt&&(d.x=-d.x,d.y=-d.y)}Mt=si}else{var Mp=0,Cp=0;Mp=Pi.gp0.x,Cp=Pi.gp0.y;var kp,Op,Pp=0,Sp=0;kp=(Pp=Pi.gp1.x)-Mp,Op=(Sp=Pi.gp1.y)-Cp;var Ap=ki.gnormy*Mp-ki.gnormx*Cp,jp=ki.gnormy*Pp-ki.gnormx*Sp,Ep=1/(jp-Ap),Ip=(-ki.tp1-Ap)*Ep;Ip>o.epsilon&&(Mp+=kp*Ip,Cp+=Op*Ip);var Tp=(-ki.tp0-jp)*Ep;Tp<-o.epsilon&&(Pp+=kp*Tp,Sp+=Op*Tp);var Np=Mp*ki.gnormx+Cp*ki.gnormy-ki.gprojection,Lp=Pp*ki.gnormx+Sp*ki.gnormy-ki.gprojection;if(Np<Lp){Pt.x=Mp,Pt.y=Cp;var Vp=-Np;Ot.x=Pt.x+ki.gnormx*Vp,Ot.y=Pt.y+ki.gnormy*Vp,Mt=Np}else{Pt.x=Pp,Pt.y=Sp;var Dp=-Lp;Ot.x=Pt.x+ki.gnormx*Dp,Ot.y=Pt.y+ki.gnormy*Dp,Mt=Lp}}}else Mt=1e100}else Mt=1e100}}var Fp=Mt+i,Rp=p*d.x+l*d.y;if(Fp<o.distanceThresholdCCD){var Zp,Bp;Zp=u.x-s.posx,Bp=u.y-s.posy;var Gp=Rp-s.sweep_angvel*(d.y*Zp-d.x*Bp);if(Gp>0&&(n.slipped=!0),Gp<=0||Fp<.5*o.distanceThresholdCCD)break}y=-1;break}if(++z>=40){$e>i&&(n.failed=!0);break}}n.toi=y},_t.distanceBody=function(n,e,t,i){var p,l,r;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,null==xt.zpp_pool?l=new xt:(l=xt.zpp_pool,xt.zpp_pool=l.next,l.next=null),l.weak=!1,null==xt.zpp_pool?r=new xt:(r=xt.zpp_pool,xt.zpp_pool=r.next,r.next=null),r.weak=!1;for(var a=1e100,s=n.shapes.head;null!=s;){for(var _=s.elt,h=e.shapes.head;null!=h;){var u,x=h.elt,d=_,y=x,z=p,v=l;if(0==_.type&&0==x.type){var c,f=_.circle,m=x.circle,b=0,g=0;b=m.worldCOMx-f.worldCOMx,g=m.worldCOMy-f.worldCOMy;var w=Math.sqrt(b*b+g*g);if((c=w-(f.radius+m.radius))<a){if(0==w)b=1,g=0;else{var M=1/w;b*=M,g*=M}var C=f.radius;z.x=f.worldCOMx+b*C,z.y=f.worldCOMy+g*C;var k=-m.radius;v.x=m.worldCOMx+b*k,v.y=m.worldCOMy+g*k,r.x=b,r.y=g}u=c}else{var O=!1;if(0==_.type&&1==x.type){d=x,y=_;var P=z;z=v,v=P,O=!0}if(1==d.type&&0==y.type){for(var S=d.polygon,A=y.circle,j=-1e100,E=null,I=S.edges.head;null!=I;){var T=I.elt,N=T.gnormx*A.worldCOMx+T.gnormy*A.worldCOMy-T.gprojection-A.radius;if(N>a){j=N;break}N>0?N>j&&(j=N,E=T):j<0&&N>j&&(j=N,E=T),I=I.next}if(j<a){var L=E.gp0,V=E.gp1,D=A.worldCOMy*E.gnormx-A.worldCOMx*E.gnormy;if(D<=L.y*E.gnormx-L.x*E.gnormy){var F=0,R=0;F=A.worldCOMx-L.x,R=A.worldCOMy-L.y;var Z=Math.sqrt(F*F+R*R);if((j=Z-A.radius)<a){if(0==Z)F=1,R=0;else{var B=1/Z;F*=B,R*=B}z.x=L.x+0*F,z.y=L.y+0*R;var G=-A.radius;v.x=A.worldCOMx+F*G,v.y=A.worldCOMy+R*G,r.x=F,r.y=R}}else if(D>=V.y*E.gnormx-V.x*E.gnormy){var q=0,U=0;q=A.worldCOMx-V.x,U=A.worldCOMy-V.y;var K=Math.sqrt(q*q+U*U);if((j=K-A.radius)<a){if(0==K)q=1,U=0;else{var W=1/K;q*=W,U*=W}z.x=V.x+0*q,z.y=V.y+0*U;var Y=-A.radius;v.x=A.worldCOMx+q*Y,v.y=A.worldCOMy+U*Y,r.x=q,r.y=U}}else{var J=-A.radius;v.x=A.worldCOMx+E.gnormx*J,v.y=A.worldCOMy+E.gnormy*J;var X=-j;z.x=v.x+E.gnormx*X,z.y=v.y+E.gnormy*X,r.x=E.gnormx,r.y=E.gnormy}}O&&(r.x=-r.x,r.y=-r.y),u=j}else{for(var H=d.polygon,$=y.polygon,Q=-1e100,nn=null,en=null,tn=0,pn=H.edges.head;null!=pn;){for(var ln=pn.elt,rn=1e100,on=$.gverts.next;null!=on;){var an=on,sn=ln.gnormx*an.x+ln.gnormy*an.y;sn<rn&&(rn=sn),on=on.next}if((rn-=ln.gprojection)>a){Q=rn;break}rn>0?rn>Q&&(Q=rn,nn=ln,tn=1):Q<0&&rn>Q&&(Q=rn,nn=ln,tn=1),pn=pn.next}if(Q<a){for(var _n=$.edges.head;null!=_n;){for(var hn=_n.elt,un=1e100,xn=H.gverts.next;null!=xn;){var dn=xn,yn=hn.gnormx*dn.x+hn.gnormy*dn.y;yn<un&&(un=yn),xn=xn.next}if((un-=hn.gprojection)>a){Q=un;break}un>0?un>Q&&(Q=un,en=hn,tn=2):Q<0&&un>Q&&(Q=un,en=hn,tn=2),_n=_n.next}if(Q<a){var zn,vn;if(1==tn)zn=$,vn=nn;else{zn=H,vn=en;var cn=z;z=v,v=cn,O=!O}for(var fn=null,mn=1e100,bn=zn.edges.head;null!=bn;){var gn=bn.elt,wn=vn.gnormx*gn.gnormx+vn.gnormy*gn.gnormy;wn<mn&&(mn=wn,fn=gn),bn=bn.next}if(O?(r.x=-vn.gnormx,r.y=-vn.gnormy):(r.x=vn.gnormx,r.y=vn.gnormy),Q>=0){var Mn,Cn,kn,On,Pn=vn.gp0,Sn=vn.gp1,An=fn.gp0,jn=fn.gp1,En=1/((Mn=Sn.x-Pn.x)*Mn+(Cn=Sn.y-Pn.y)*Cn),In=1/((kn=jn.x-An.x)*kn+(On=jn.y-An.y)*On),Tn=-(Mn*(Pn.x-An.x)+Cn*(Pn.y-An.y))*En,Nn=-(Mn*(Pn.x-jn.x)+Cn*(Pn.y-jn.y))*En,Ln=-(kn*(An.x-Pn.x)+On*(An.y-Pn.y))*In,Vn=-(kn*(An.x-Sn.x)+On*(An.y-Sn.y))*In;Tn<0?Tn=0:Tn>1&&(Tn=1),Nn<0?Nn=0:Nn>1&&(Nn=1),Ln<0?Ln=0:Ln>1&&(Ln=1),Vn<0?Vn=0:Vn>1&&(Vn=1);var Dn,Fn,Rn=Tn;Dn=Pn.x+Mn*Rn,Fn=Pn.y+Cn*Rn;var Zn,Bn,Gn=Nn;Zn=Pn.x+Mn*Gn,Bn=Pn.y+Cn*Gn;var qn,Un,Kn=Ln;qn=An.x+kn*Kn,Un=An.y+On*Kn;var Wn,Yn,Jn=Vn;Wn=An.x+kn*Jn,Yn=An.y+On*Jn;var Xn,Hn,$n,Qn,ne,ee,te,ie,pe=(Xn=Dn-An.x)*Xn+(Hn=Fn-An.y)*Hn,le=($n=Zn-jn.x)*$n+(Qn=Bn-jn.y)*Qn,re=(ne=qn-Pn.x)*ne+(ee=Un-Pn.y)*ee,oe=(te=Wn-Sn.x)*te+(ie=Yn-Sn.y)*ie,ae=0,se=0,_e=null;pe<le?(ae=Dn,se=Fn,_e=An):(ae=Zn,se=Bn,_e=jn,pe=le);var he=0,ue=0,xe=null;if(re<oe?(he=qn,ue=Un,xe=Pn):(he=Wn,ue=Yn,xe=Sn,re=oe),pe<re?(z.x=ae,z.y=se,v.x=_e.x,v.y=_e.y,Q=Math.sqrt(pe)):(v.x=he,v.y=ue,z.x=xe.x,z.y=xe.y,Q=Math.sqrt(re)),0!=Q){r.x=v.x-z.x,r.y=v.y-z.y;var de=1/Q;r.x*=de,r.y*=de,O&&(r.x=-r.x,r.y=-r.y)}u=Q}else{var ye=0,ze=0;ye=fn.gp0.x,ze=fn.gp0.y;var ve,ce,fe=0,me=0;ve=(fe=fn.gp1.x)-ye,ce=(me=fn.gp1.y)-ze;var be=vn.gnormy*ye-vn.gnormx*ze,ge=vn.gnormy*fe-vn.gnormx*me,we=1/(ge-be),Me=(-vn.tp1-be)*we;Me>o.epsilon&&(ye+=ve*Me,ze+=ce*Me);var Ce=(-vn.tp0-ge)*we;Ce<-o.epsilon&&(fe+=ve*Ce,me+=ce*Ce);var ke=ye*vn.gnormx+ze*vn.gnormy-vn.gprojection,Oe=fe*vn.gnormx+me*vn.gnormy-vn.gprojection;if(ke<Oe){v.x=ye,v.y=ze;var Pe=-ke;z.x=v.x+vn.gnormx*Pe,z.y=v.y+vn.gnormy*Pe,u=ke}else{v.x=fe,v.y=me;var Se=-Oe;z.x=v.x+vn.gnormx*Se,z.y=v.y+vn.gnormy*Se,u=Oe}}}else u=a}else u=a}}u<a&&(a=u,t.x=p.x,t.y=p.y,i.x=l.x,i.y=l.y),h=h.next}s=s.next}var Ae=p;null!=Ae.outer&&(Ae.outer.zpp_inner=null,Ae.outer=null),Ae._isimmutable=null,Ae._validate=null,Ae._invalidate=null,Ae.next=xt.zpp_pool,xt.zpp_pool=Ae;var je=l;null!=je.outer&&(je.outer.zpp_inner=null,je.outer=null),je._isimmutable=null,je._validate=null,je._invalidate=null,je.next=xt.zpp_pool,xt.zpp_pool=je;var Ee=r;return null!=Ee.outer&&(Ee.outer.zpp_inner=null,Ee.outer=null),Ee._isimmutable=null,Ee._validate=null,Ee._invalidate=null,Ee.next=xt.zpp_pool,xt.zpp_pool=Ee,a},_t.distance=function(n,e,t,i,p,l){if(null==l&&(l=1e100),0==n.type&&0==e.type){var r,a=n.circle,s=e.circle,_=0,h=0;_=s.worldCOMx-a.worldCOMx,h=s.worldCOMy-a.worldCOMy;var u=Math.sqrt(_*_+h*h);if((r=u-(a.radius+s.radius))<l){if(0==u)_=1,h=0;else{var x=1/u;_*=x,h*=x}var d=a.radius;t.x=a.worldCOMx+_*d,t.y=a.worldCOMy+h*d;var y=-s.radius;i.x=s.worldCOMx+_*y,i.y=s.worldCOMy+h*y,p.x=_,p.y=h}return r}var z=!1;if(0==n.type&&1==e.type){var v=n;n=e,e=v;var c=t;t=i,i=c,z=!0}if(1==n.type&&0==e.type){for(var f=n.polygon,m=e.circle,b=-1e100,g=null,w=f.edges.head;null!=w;){var M=w.elt,C=M.gnormx*m.worldCOMx+M.gnormy*m.worldCOMy-M.gprojection-m.radius;if(C>l){b=C;break}C>0?C>b&&(b=C,g=M):b<0&&C>b&&(b=C,g=M),w=w.next}if(b<l){var k=g.gp0,O=g.gp1,P=m.worldCOMy*g.gnormx-m.worldCOMx*g.gnormy;if(P<=k.y*g.gnormx-k.x*g.gnormy){var S=0,A=0;S=m.worldCOMx-k.x,A=m.worldCOMy-k.y;var j=Math.sqrt(S*S+A*A);if((b=j-m.radius)<l){if(0==j)S=1,A=0;else{var E=1/j;S*=E,A*=E}t.x=k.x+0*S,t.y=k.y+0*A;var I=-m.radius;i.x=m.worldCOMx+S*I,i.y=m.worldCOMy+A*I,p.x=S,p.y=A}}else if(P>=O.y*g.gnormx-O.x*g.gnormy){var T=0,N=0;T=m.worldCOMx-O.x,N=m.worldCOMy-O.y;var L=Math.sqrt(T*T+N*N);if((b=L-m.radius)<l){if(0==L)T=1,N=0;else{var V=1/L;T*=V,N*=V}t.x=O.x+0*T,t.y=O.y+0*N;var D=-m.radius;i.x=m.worldCOMx+T*D,i.y=m.worldCOMy+N*D,p.x=T,p.y=N}}else{var F=-m.radius;i.x=m.worldCOMx+g.gnormx*F,i.y=m.worldCOMy+g.gnormy*F;var R=-b;t.x=i.x+g.gnormx*R,t.y=i.y+g.gnormy*R,p.x=g.gnormx,p.y=g.gnormy}}return z&&(p.x=-p.x,p.y=-p.y),b}for(var Z=n.polygon,B=e.polygon,G=-1e100,q=null,U=null,K=0,W=Z.edges.head;null!=W;){for(var Y=W.elt,J=1e100,X=B.gverts.next;null!=X;){var H=X,$=Y.gnormx*H.x+Y.gnormy*H.y;$<J&&(J=$),X=X.next}if((J-=Y.gprojection)>l){G=J;break}J>0?J>G&&(G=J,q=Y,K=1):G<0&&J>G&&(G=J,q=Y,K=1),W=W.next}if(G<l){for(var Q=B.edges.head;null!=Q;){for(var nn=Q.elt,en=1e100,tn=Z.gverts.next;null!=tn;){var pn=tn,ln=nn.gnormx*pn.x+nn.gnormy*pn.y;ln<en&&(en=ln),tn=tn.next}if((en-=nn.gprojection)>l){G=en;break}en>0?en>G&&(G=en,U=nn,K=2):G<0&&en>G&&(G=en,U=nn,K=2),Q=Q.next}if(G<l){var rn,on;if(1==K)rn=B,on=q;else{rn=Z,on=U;var an=t;t=i,i=an,z=!z}for(var sn=null,_n=1e100,hn=rn.edges.head;null!=hn;){var un=hn.elt,xn=on.gnormx*un.gnormx+on.gnormy*un.gnormy;xn<_n&&(_n=xn,sn=un),hn=hn.next}if(z?(p.x=-on.gnormx,p.y=-on.gnormy):(p.x=on.gnormx,p.y=on.gnormy),G>=0){var dn,yn,zn,vn,cn=on.gp0,fn=on.gp1,mn=sn.gp0,bn=sn.gp1,gn=1/((dn=fn.x-cn.x)*dn+(yn=fn.y-cn.y)*yn),wn=1/((zn=bn.x-mn.x)*zn+(vn=bn.y-mn.y)*vn),Mn=-(dn*(cn.x-mn.x)+yn*(cn.y-mn.y))*gn,Cn=-(dn*(cn.x-bn.x)+yn*(cn.y-bn.y))*gn,kn=-(zn*(mn.x-cn.x)+vn*(mn.y-cn.y))*wn,On=-(zn*(mn.x-fn.x)+vn*(mn.y-fn.y))*wn;Mn<0?Mn=0:Mn>1&&(Mn=1),Cn<0?Cn=0:Cn>1&&(Cn=1),kn<0?kn=0:kn>1&&(kn=1),On<0?On=0:On>1&&(On=1);var Pn,Sn,An=Mn;Pn=cn.x+dn*An,Sn=cn.y+yn*An;var jn,En,In=Cn;jn=cn.x+dn*In,En=cn.y+yn*In;var Tn,Nn,Ln=kn;Tn=mn.x+zn*Ln,Nn=mn.y+vn*Ln;var Vn,Dn,Fn=On;Vn=mn.x+zn*Fn,Dn=mn.y+vn*Fn;var Rn,Zn,Bn,Gn,qn,Un,Kn,Wn,Yn=(Rn=Pn-mn.x)*Rn+(Zn=Sn-mn.y)*Zn,Jn=(Bn=jn-bn.x)*Bn+(Gn=En-bn.y)*Gn,Xn=(qn=Tn-cn.x)*qn+(Un=Nn-cn.y)*Un,Hn=(Kn=Vn-fn.x)*Kn+(Wn=Dn-fn.y)*Wn,$n=0,Qn=0,ne=null;Yn<Jn?($n=Pn,Qn=Sn,ne=mn):($n=jn,Qn=En,ne=bn,Yn=Jn);var ee=0,te=0,ie=null;if(Xn<Hn?(ee=Tn,te=Nn,ie=cn):(ee=Vn,te=Dn,ie=fn,Xn=Hn),Yn<Xn?(t.x=$n,t.y=Qn,i.x=ne.x,i.y=ne.y,G=Math.sqrt(Yn)):(i.x=ee,i.y=te,t.x=ie.x,t.y=ie.y,G=Math.sqrt(Xn)),0!=G){p.x=i.x-t.x,p.y=i.y-t.y;var pe=1/G;p.x*=pe,p.y*=pe,z&&(p.x=-p.x,p.y=-p.y)}return G}var le=0,re=0;le=sn.gp0.x,re=sn.gp0.y;var oe,ae,se=0,_e=0;oe=(se=sn.gp1.x)-le,ae=(_e=sn.gp1.y)-re;var he=on.gnormy*le-on.gnormx*re,ue=on.gnormy*se-on.gnormx*_e,xe=1/(ue-he),de=(-on.tp1-he)*xe;de>o.epsilon&&(le+=oe*de,re+=ae*de);var ye=(-on.tp0-ue)*xe;ye<-o.epsilon&&(se+=oe*ye,_e+=ae*ye);var ze=le*on.gnormx+re*on.gnormy-on.gprojection,ve=se*on.gnormx+_e*on.gnormy-on.gprojection;if(ze<ve){i.x=le,i.y=re;var ce=-ze;return t.x=i.x+on.gnormx*ce,t.y=i.y+on.gnormy*ce,ze}i.x=se,i.y=_e;var fe=-ve;return t.x=i.x+on.gnormx*fe,t.y=i.y+on.gnormy*fe,ve}return l}return l},_t.prototype.__class__=_t;var ht=zpp_nape.geom.ZPP_PartitionPair=function(){this.node=null,this.di=0,this.id=0,this.b=null,this.a=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null};ht.__name__=["zpp_nape","geom","ZPP_PartitionPair"],ht.get=function(n,e){var t;return null==ht.zpp_pool?t=new ht:(t=ht.zpp_pool,ht.zpp_pool=t.next,t.next=null),t.a=n,t.b=e,n.id<e.id?(t.id=n.id,t.di=e.id):(t.id=e.id,t.di=n.id),t},ht.edge_swap=function(n,e){var t=n.node;n.node=e.node,e.node=t},ht.edge_lt=function(n,e){return!(n.id>=e.id)||n.id==e.id&&n.di<e.di},ht.prototype.next=null,ht.prototype.elem=function(){return this},ht.prototype.begin=function(){return this.next},ht.prototype._inuse=null,ht.prototype.modified=null,ht.prototype.pushmod=null,ht.prototype.length=null,ht.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},ht.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},ht.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},ht.prototype.addAll=function(n){for(var e=n.next;null!=e;)this.add(e),e=e.next},ht.prototype.insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ht.prototype.inlined_insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},ht.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ht.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},ht.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},ht.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},ht.prototype.remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ht.prototype.try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ht.prototype.inlined_remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ht.prototype.inlined_try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var p,l;null==e?(l=(p=this.next).next,this.next=l,null==this.next&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0)),p._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ht.prototype.erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},ht.prototype.inlined_erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},ht.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ht.prototype.clear=function(){},ht.prototype.inlined_clear=function(){},ht.prototype.reverse=function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ht.prototype.empty=function(){return null==this.next},ht.prototype.size=function(){return this.length},ht.prototype.has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},ht.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},ht.prototype.front=function(){return this.next},ht.prototype.back=function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},ht.prototype.iterator_at=function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},ht.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e:null},ht.prototype.free=function(){this.a=this.b=null,this.node=null},ht.prototype.alloc=function(){},ht.prototype.a=null,ht.prototype.b=null,ht.prototype.id=null,ht.prototype.di=null,ht.prototype.node=null,ht.prototype.__class__=ht;var ut=zpp_nape.geom.ZPP_Triangular=function(){};ut.__name__=["zpp_nape","geom","ZPP_Triangular"],ut.lt=function(n,e){return n.y<e.y||n.y==e.y&&n.x<e.x},ut.right_turn=function(n,e,t){var i,p;i=t.x-e.x,p=t.y-e.y;var l;return l=e.x-n.x,(e.y-n.y)*i-l*p},ut.delaunay=function(n,e,t,i){var p,l,r,o=0,a=0,s=0;return o=t.x-e.x,a=t.y-e.y,s=e.x-n.x,(e.y-n.y)*o-s*a>=0?r=!0:(o=i.x-t.x,a=i.y-t.y,s=t.x-e.x,r=(t.y-e.y)*o-s*a>=0),r?l=!0:(o=n.x-i.x,a=n.y-i.y,s=i.x-t.x,l=(i.y-t.y)*o-s*a>=0),l?p=!0:(o=e.x-n.x,a=e.y-n.y,s=n.x-i.x,p=(n.y-i.y)*o-s*a>=0),!!p||e.x*(t.y*i.mag-t.mag*i.y)-t.x*(e.y*i.mag-e.mag*i.y)+i.x*(e.y*t.mag-e.mag*t.y)-(n.x*(t.y*i.mag-t.mag*i.y)-t.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*t.mag-n.mag*t.y))+(n.x*(e.y*i.mag-e.mag*i.y)-e.x*(n.y*i.mag-n.mag*i.y)+i.x*(n.y*e.mag-n.mag*e.y))-(n.x*(e.y*t.mag-e.mag*t.y)-e.x*(n.y*t.mag-n.mag*t.y)+t.x*(n.y*e.mag-n.mag*e.y))>0},ut.optimise=function(n){var e,t=n.vertices,i=n.vertices;if(null!=t)for(var p=t;;){var l=p;if(l.sort(),l.mag=l.x*l.x+l.y*l.y,(p=p.next)==i)break}null==ut.edgeSet&&(null==vp.zpp_pool?ut.edgeSet=new vp:(ut.edgeSet=vp.zpp_pool,vp.zpp_pool=ut.edgeSet.next,ut.edgeSet.next=null),ut.edgeSet.lt=ht.edge_lt,ut.edgeSet.swapped=ht.edge_swap),null==ht.zpp_pool?e=new ht:(e=ht.zpp_pool,ht.zpp_pool=e.next,e.next=null);var r=n.vertices,o=n.vertices;if(null!=r)for(var a=r;;){var s=a,_=s.next;s.diagonals.reverse();for(var h=s.diagonals.head;null!=h;){var u=h.elt;if(u.id<s.id)_=u,h=h.next;else{if(!ut.delaunay(s,_,u,null==h.next?s.prev:h.next.elt)){var x;null==ht.zpp_pool?x=new ht:(x=ht.zpp_pool,ht.zpp_pool=x.next,x.next=null),x.a=s,x.b=u,s.id<u.id?(x.id=s.id,x.di=u.id):(x.id=u.id,x.di=s.id);var d=x;e.add(d),d.node=ut.edgeSet.insert(d)}_=u,h=h.next}}if((a=a.next)==o)break}for(;null!=e.next;){for(var y=e.pop_unsafe(),z=y.a,v=y.b,c=z.next,f=null,m=z.diagonals.head;null!=m;){var b=m.elt;if(b==v){f=null==(m=m.next)?z.prev:m.elt;break}c=b,m=m.next}if(z.diagonals.remove(v),v.diagonals.remove(z),v==c.next)c.diagonals.add(f);else for(var g=c.diagonals.head;null!=g;){if(g.elt==v){c.diagonals.insert(g,f);break}g=g.next}if(z==f.next)f.diagonals.add(c);else for(var w=f.diagonals.head;null!=w;){if(w.elt==z){f.diagonals.insert(w,c);break}w=w.next}ut.edgeSet.remove_node(y.node),y.a=y.b=null,y.node=null,y.next=ht.zpp_pool,ht.zpp_pool=y}var M=e;M.a=M.b=null,M.node=null,M.next=ht.zpp_pool,ht.zpp_pool=M},ut.triangulate=function(n){var e=n.vertices,t=n.vertices,i=n.vertices.next,p=n.vertices;if(null!=i)for(var l=i;;){var r=l;if((r.y<e.y||r.y==e.y&&r.x<e.x)&&(e=r),(t.y<r.y||t.y==r.y&&t.x<r.x)&&(t=r),(l=l.next)==p)break}null==ut.queue&&(ut.queue=new Xt);var o=t.prev,a=t.next;for(ut.queue.add(t);o!=e||a!=e;)o==e||a!=e&&(o.y<a.y||o.y==a.y&&o.x<a.x)?(ut.queue.add(a),a.rightchain=!1,a=a.next):(ut.queue.add(o),o.rightchain=!0,o=o.prev);ut.queue.add(e),null==ut.stack&&(ut.stack=new Xt),ut.stack.add(ut.queue.pop_unsafe());var s=ut.queue.pop_unsafe();for(ut.stack.add(s);;){var _=ut.queue.pop_unsafe();if(null==ut.queue.head)break;if(_.rightchain!=ut.stack.head.elt.rightchain){for(;;){var h=ut.stack.pop_unsafe();if(null==ut.stack.head)break;n.add_diagonal(h,_)}ut.stack.add(s)}else{for(var u=ut.stack.pop_unsafe();null!=ut.stack.head;){var x,d,y=ut.stack.head.elt;x=_.x-u.x,d=_.y-u.y;var z;z=u.x-y.x;var v=(u.y-y.y)*x-z*d;if(_.rightchain&&v>=0||!_.rightchain&&v<=0)break;n.add_diagonal(y,_),u=y,ut.stack.pop()}ut.stack.add(u)}ut.stack.add(_),s=_}if(null!=ut.stack.head)for(ut.stack.pop();null!=ut.stack.head;){var c=ut.stack.pop_unsafe();if(null==ut.stack.head)break;n.add_diagonal(t,c)}return n},ut.prototype.__class__=ut;var xt=zpp_nape.geom.ZPP_Vec2=function(){this.y=0,this.x=0,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.weak=!1,this.outer=null,this._isimmutable=null,this._immutable=!1,this._validate=null,this._invalidate=null};xt.__name__=["zpp_nape","geom","ZPP_Vec2"],xt.get=function(n,e,t){var i;return null==t&&(t=!1),null==xt.zpp_pool?i=new xt:(i=xt.zpp_pool,xt.zpp_pool=i.next,i.next=null),i.weak=!1,i._immutable=t,i.x=n,i.y=e,i},xt.prototype._invalidate=null,xt.prototype._validate=null,xt.prototype.validate=function(){null!=this._validate&&this._validate()},xt.prototype.invalidate=function(){null!=this._invalidate&&this._invalidate(this)},xt.prototype._immutable=null,xt.prototype._isimmutable=null,xt.prototype.immutable=function(){},xt.prototype.outer=null,xt.prototype.wrapper=function(){if(null==this.outer){this.outer=new yn;var n=this.outer.zpp_inner;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n._isimmutable=null,n._validate=null,n._invalidate=null,n.next=xt.zpp_pool,xt.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},xt.prototype.weak=null,xt.prototype.free=function(){null!=this.outer&&(this.outer.zpp_inner=null,this.outer=null),this._isimmutable=null,this._validate=null,this._invalidate=null},xt.prototype.alloc=function(){this.weak=!1},xt.prototype.next=null,xt.prototype.elem=function(){return this},xt.prototype.begin=function(){return this.next},xt.prototype._inuse=null,xt.prototype.modified=null,xt.prototype.pushmod=null,xt.prototype.length=null,xt.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},xt.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},xt.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},xt.prototype.addAll=function(n){for(var e=n.next;null!=e;)this.add(e),e=e.next},xt.prototype.insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},xt.prototype.inlined_insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},xt.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},xt.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},xt.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},xt.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},xt.prototype.remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},xt.prototype.try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},xt.prototype.inlined_remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},xt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var p,l;null==e?(l=(p=this.next).next,this.next=l,null==this.next&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0)),p._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},xt.prototype.erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},xt.prototype.inlined_erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},xt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},xt.prototype.clear=function(){},xt.prototype.inlined_clear=function(){},xt.prototype.reverse=function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},xt.prototype.empty=function(){return null==this.next},xt.prototype.size=function(){return this.length},xt.prototype.has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},xt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},xt.prototype.front=function(){return this.next},xt.prototype.back=function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},xt.prototype.iterator_at=function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},xt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e:null},xt.prototype.x=null,xt.prototype.y=null,xt.prototype.copy=function(){var n,e=this.x,t=this.y;return null==xt.zpp_pool?n=new xt:(n=xt.zpp_pool,xt.zpp_pool=n.next,n.next=null),n.weak=!1,n._immutable=!1,n.x=e,n.y=t,n},xt.prototype.toString=function(){return"{ x: "+this.x+" y: "+this.y+" }"},xt.prototype.__class__=xt;var dt=zpp_nape.geom.ZPP_Vec3=function(){this._validate=null,this.immutable=!1,this.z=0,this.y=0,this.x=0,this.outer=null,this.immutable=!1,this._validate=null};dt.__name__=["zpp_nape","geom","ZPP_Vec3"],dt.prototype.outer=null,dt.prototype.x=null,dt.prototype.y=null,dt.prototype.z=null,dt.prototype.immutable=null,dt.prototype._validate=null,dt.prototype.validate=function(){null!=this._validate&&this._validate()},dt.prototype.__class__=dt;var yt=zpp_nape.geom.ZPP_VecMath=function(){};yt.__name__=["zpp_nape","geom","ZPP_VecMath"],yt.vec_dsq=function(n,e,t,i){var p,l;return(p=n-t)*p+(l=e-i)*l},yt.vec_distance=function(n,e,t,i){var p,l;return p=n-t,l=e-i,Math.sqrt(p*p+l*l)},yt.prototype.__class__=yt;var zt=zpp_nape.phys.ZPP_Interactor=function(){this.wrap_cbTypes=null,this.cbSet=null,this.cbTypes=null,this.group=null,this.cbsets=null,this.icompound=null,this.ibody=null,this.ishape=null,this.userData=null,this.id=0,this.outer_i=null,this.id=Xn.Interactor(),this.cbsets=new Bt,this.cbTypes=new he};zt.__name__=["zpp_nape","phys","ZPP_Interactor"],zt.get=function(n,e){for(var t=n.id<e.id?n.id:e.id,i=n.id<e.id?e.id:n.id,p=null,l=(n.cbsets.length<e.cbsets.length?n.cbsets:e.cbsets).head;null!=l;){var r=l.elt;if(r.id==t&&r.di==i){p=r;break}l=l.next}return p},zt.int_callback=function(n,e,t){var i,p=n.int1,l=n.int2,r=e.options1,o=p.cbTypes;if(r.nonemptyintersection(o,r.includes)&&!r.nonemptyintersection(o,r.excludes)){var a=e.options2,s=l.cbTypes;i=!!a.nonemptyintersection(s,a.includes)&&!a.nonemptyintersection(s,a.excludes)}else i=!1;i?(t.int1=p,t.int2=l):(t.int1=l,t.int2=p)},zt.prototype.outer_i=null,zt.prototype.id=null,zt.prototype.userData=null,zt.prototype.ishape=null,zt.prototype.ibody=null,zt.prototype.icompound=null,zt.prototype.isShape=function(){return null!=this.ishape},zt.prototype.isBody=function(){return null!=this.ibody},zt.prototype.isCompound=function(){return null!=this.icompound},zt.prototype.__iaddedToSpace=function(){null!=this.group&&this.group.interactors.add(this);for(var n=this.cbTypes.head;null!=n;)n.elt.interactors.add(this),n=n.next;this.alloc_cbSet()},zt.prototype.__iremovedFromSpace=function(){null!=this.group&&this.group.interactors.remove(this);for(var n=this.cbTypes.head;null!=n;)n.elt.interactors.remove(this),n=n.next;this.dealloc_cbSet()},zt.prototype.wake=function(){if(null!=this.ishape){var n=this.ishape.body;null!=n&&null!=n.space&&n.space.non_inlined_wake(n)}else null!=this.ibody?null!=this.ibody.space&&this.ibody.space.non_inlined_wake(this.ibody):null!=this.icompound.space&&this.icompound.space.wakeCompound(this.icompound)},zt.prototype.cbsets=null,zt.prototype.getSpace=function(){return null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space},zt.prototype.group=null,zt.prototype.cbTypes=null,zt.prototype.cbSet=null,zt.prototype.wrap_cbTypes=null,zt.prototype.setupcbTypes=function(){this.wrap_cbTypes=tp.get(this.cbTypes),this.wrap_cbTypes.zpp_inner.adder=e(this,this.wrap_cbTypes_adder),this.wrap_cbTypes.zpp_inner.subber=e(this,this.wrap_cbTypes_subber),this.wrap_cbTypes.zpp_inner.dontremove=!0},zt.prototype.wrap_cbTypes_subber=function(n){var e=n.zpp_inner;if(this.cbTypes.has(e)){var t=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=t&&(this.dealloc_cbSet(),e.interactors.remove(this)),this.cbTypes.remove(e),null!=t&&(this.alloc_cbSet(),this.wake())}},zt.prototype.wrap_cbTypes_adder=function(n){return this.insert_cbtype(n.zpp_inner),!1},zt.prototype.insert_cbtype=function(n){if(!this.cbTypes.has(n)){var e=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=e&&(this.dealloc_cbSet(),n.interactors.add(this));for(var t=null,i=this.cbTypes.head;null!=i&&!(n.id<i.elt.id);)t=i,i=i.next;var p,l=this.cbTypes;null==yi.zpp_pool?p=new yi:(p=yi.zpp_pool,yi.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;null==t?(r.next=l.head,l.head=r):(r.next=t.next,t.next=r),l.pushmod=l.modified=!0,l.length++,null!=e&&(this.alloc_cbSet(),this.wake())}},zt.prototype.alloc_cbSet=function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;null!=(this.cbSet=n.cbsets.get(this.cbTypes))&&(this.cbSet.count++,this.cbSet.interactors.add(this),this.cbSet.validate(),n.freshInteractorType(this))},zt.prototype.dealloc_cbSet=function(){var n=null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space;if(null!=this.cbSet){if(this.cbSet.interactors.remove(this),n.nullInteractorType(this),0==--this.cbSet.count){n.cbsets.remove(this.cbSet);var e=this.cbSet;for(e.listeners.clear(),e.zip_listeners=!0,e.bodylisteners.clear(),e.zip_bodylisteners=!0,e.conlisteners.clear(),e.zip_conlisteners=!0;null!=e.cbTypes.head;)e.cbTypes.pop_unsafe().cbsets.remove(e);e.next=$n.zpp_pool,$n.zpp_pool=e}this.cbSet=null}},zt.prototype.setGroup=function(n){if(this.group!=n){var e=null!=(null!=this.ishape?null==this.ishape.body?null:this.ishape.body.space:null!=this.ibody?this.ibody.space:this.icompound.space);e&&null!=this.group&&this.group.interactors.remove(this),this.group=n,e&&null!=n&&n.interactors.add(this),e&&(null!=this.ishape?this.ishape.body.wake():null!=this.ibody?this.ibody.wake():this.icompound.wake())}},zt.prototype.immutable_midstep=function(n){null==this.ibody&&(null!=this.ishape?this.ishape.__immutable_midstep(n):this.icompound.__imutable_midstep(n))},zt.prototype.lookup_group=function(){for(var n=this;null!=n&&null==n.group;)n=null!=n.ishape?n.ishape.body:null!=n.icompound?n.icompound.compound:n.ibody.compound;return null==n?null:n.group},zt.prototype.copyto=function(n){n.zpp_inner_i.group=this.group;var e=this.outer_i;null==e.zpp_inner_i.wrap_cbTypes&&e.zpp_inner_i.setupcbTypes();var i=e.zpp_inner_i.wrap_cbTypes;i.zpp_inner.valmod();for(var p=d.get(i);;){p.zpp_inner.zpp_inner.valmod();var l=p.zpp_inner;l.zpp_inner.valmod(),l.zpp_inner.zip_length&&(l.zpp_inner.zip_length=!1,l.zpp_inner.user_length=l.zpp_inner.inner.length);var r,o=l.zpp_inner.user_length;if(p.zpp_critical=!0,p.zpp_i<o?r=!0:(p.zpp_next=d.zpp_pool,d.zpp_pool=p,p.zpp_inner=null,r=!1),!r)break;p.zpp_critical=!1;var a=p.zpp_inner.at(p.zpp_i++);null==n.zpp_inner_i.wrap_cbTypes&&n.zpp_inner_i.setupcbTypes();var s=n.zpp_inner_i.wrap_cbTypes;s.zpp_inner.reverse_flag?s.push(a):s.unshift(a)}null!=this.userData&&(n.zpp_inner_i.userData=t.copy(this.userData))},zt.prototype.__class__=zt;var vt=zpp_nape.phys.ZPP_Body=function(){var n;this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_aabb=!1,this.aabb=null,this.norotate=!1,this.sinertia=0,this.iinertia=0,this.cinertia=0,this.zip_inertia=!1,this.inertia=0,this.inertiaMode=0,this.zip_gravMassScale=!1,this.gravMassScale=0,this.gravMassMode=0,this.zip_gravMass=!1,this.gravMass=0,this.nomove=!1,this.cmass=0,this.smass=0,this.imass=0,this.massMode=0,this.zip_mass=!1,this.mass=0,this.zip_axis=!1,this.axisy=0,this.axisx=0,this.rot=0,this.pre_rot=0,this.kinangvel=0,this.torque=0,this.angvel=0,this.wrapcvel=null,this.wrap_svel=null,this.svely=0,this.svelx=0,this.wrap_kinvel=null,this.kinvely=0,this.kinvelx=0,this.wrap_force=null,this.forcey=0,this.forcex=0,this.wrap_vel=null,this.vely=0,this.velx=0,this.wrap_pos=null,this.posy=0,this.posx=0,this.pre_posy=0,this.pre_posx=0,this.disableCCD=!1,this.bulletEnabled=!1,this.bullet=!1,this.sweepRadius=0,this.sweepFrozen=!1,this.sweep_angvel=0,this.sweepTime=0,this.graph_depth=0,this.component=null,this.wrap_constraints=null,this.constraints=null,this.wrap_arbiters=null,this.arbiters=null,this.space=null,this.wrap_shapes=null,this.shapes=null,this.compound=null,this.type=0,this.world=!1,this.outer=null,zt.call(this),this.ibody=this,this.world=!1,this.bulletEnabled=!1,this.sweepTime=0,this.sweep_angvel=0,this.norotate=this.nomove=!1,this.disableCCD=!1,this.posx=0,this.posy=0,this.rot=0,this.axisx=0,this.axisy=1,this.svelx=0,this.svely=0,this.velx=0,this.vely=0,this.kinvelx=0,this.kinvely=0,this.forcex=0,this.forcey=0,this.torque=this.angvel=this.kinangvel=0,this.pre_posx=1/0,this.pre_posy=1/0,this.pre_rot=1/0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.zip_aabb=!0,null==Te.zpp_pool?n=new Te:(n=Te.zpp_pool,Te.zpp_pool=n.next,n.next=null),n.minx=0,n.miny=0,n.maxx=0,n.maxy=0,this.aabb=n,this.aabb._immutable=!0,this.aabb._validate=e(this,this.aabb_validate),this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.arbiters=new Kt,this.constraints=new ie,this.shapes=new Gt,this.wrap_shapes=ap.get(this.shapes),this.wrap_shapes.zpp_inner.adder=e(this,this.shapes_adder),this.wrap_shapes.zpp_inner.subber=e(this,this.shapes_subber),this.wrap_shapes.zpp_inner._invalidate=e(this,this.shapes_invalidate),this.kinematicDelaySleep=!1};vt.__name__=["zpp_nape","phys","ZPP_Body"],vt.__super__=zt,vt.prototype=Object.create(zt.prototype),vt.bodysetlt=function(n,e){return n.id<e.id},vt.__static=function(){null==oe.BodyType_STATIC&&(oe.internal=!0,oe.BodyType_STATIC=new Mn,oe.internal=!1);var n=new bn(oe.BodyType_STATIC),e=n.zpp_inner;return e.world=!0,e.wrap_shapes.zpp_inner.immutable=!0,e.smass=e.imass=e.cmass=e.mass=e.gravMass=0,e.sinertia=e.iinertia=e.cinertia=e.inertia=0,e.cbTypes.clear(),n},vt.prototype.outer=null,vt.prototype.world=null,vt.prototype.type=null,vt.prototype.isStatic=function(){return 1==this.type},vt.prototype.isDynamic=function(){return 2==this.type},vt.prototype.isKinematic=function(){return 3==this.type},vt.prototype.invalidate_type=function(){this.invalidate_mass(),this.invalidate_inertia()},vt.prototype.compound=null,vt.prototype.shapes=null,vt.prototype.wrap_shapes=null,vt.prototype.invalidate_shapes=function(){this.zip_aabb=!0,this.zip_localCOM=!0,this.zip_worldCOM=!0,this.invalidate_mass(),this.invalidate_inertia()},vt.prototype.space=null,vt.prototype.arbiters=null,vt.prototype.wrap_arbiters=null,vt.prototype.constraints=null,vt.prototype.wrap_constraints=null,vt.prototype.component=null,vt.prototype.graph_depth=null,vt.prototype.init_bodysetlist=function(){null==vt.bodyset&&(vt.bodyset=new dp,vt.bodyset.lt=vt.bodysetlt,vt.bodystack=new qt)},vt.prototype.connectedBodies_cont=function(n){vt.bodyset.try_insert_bool(n.zpp_inner)&&(vt.bodystack.add(n.zpp_inner),n.zpp_inner.graph_depth=vt.cur_graph_depth+1)},vt.prototype.connectedBodies=function(n,t){null==vt.bodyset&&(vt.bodyset=new dp,vt.bodyset.lt=vt.bodysetlt,vt.bodystack=new qt);var i=null==t?new wn:t;for(vt.bodystack.add(this),vt.bodyset.insert(this),this.graph_depth=0;null!=vt.bodystack.head;){var p=vt.bodystack.pop_unsafe();if(p.graph_depth!=n){vt.cur_graph_depth=p.graph_depth;for(var l=p.constraints.head;null!=l;)l.elt.outer.visitBodies(e(this,this.connectedBodies_cont)),l=l.next}}var r=vt.bodyset;if(null!=r.parent){for(var o=r.parent;null!=o;)if(null!=o.prev)o=o.prev;else if(null!=o.next)o=o.next;else{var a=o.data;if(a!=this){var s=a.outer;i.zpp_inner.reverse_flag?i.push(s):i.unshift(s)}var _=o.parent;null!=_&&(o==_.prev?_.prev=null:_.next=null,o.parent=null);var h=o;h.data=null,h.lt=null,h.swapped=null,h.next=dp.zpp_pool,dp.zpp_pool=h,o=_}r.parent=null}return i},vt.prototype.interactingBodies=function(n,e,t){null==vt.bodyset&&(vt.bodyset=new dp,vt.bodyset.lt=vt.bodysetlt,vt.bodystack=new qt);var i=null==t?new wn:t;for(vt.bodyset.insert(this),vt.bodystack.add(this),this.graph_depth=0;null!=vt.bodystack.head;){var p=vt.bodystack.pop_unsafe();if(p.graph_depth!=e)for(var l=p.arbiters.head;null!=l;){var r=l.elt;if(0!=(r.type&n)){var o=r.b1==p?r.b2:r.b1;vt.bodyset.try_insert_bool(o)&&(vt.bodystack.add(o),o.graph_depth=p.graph_depth+1)}l=l.next}}var a=vt.bodyset;if(null!=a.parent){for(var s=a.parent;null!=s;)if(null!=s.prev)s=s.prev;else if(null!=s.next)s=s.next;else{var _=s.data;if(_!=this){var h=_.outer;i.zpp_inner.reverse_flag?i.push(h):i.unshift(h)}var u=s.parent;null!=u&&(s==u.prev?u.prev=null:u.next=null,s.parent=null);var x=s;x.data=null,x.lt=null,x.swapped=null,x.next=dp.zpp_pool,dp.zpp_pool=x,s=u}a.parent=null}return i},vt.prototype.atRest=function(n){if(2!=this.type)return this.component.sleeping;var e,t=o.linearSleepThreshold;if(t*=t,this.velx*this.velx+this.vely*this.vely>t)e=!1;else{var i,p,l=this.posx,r=this.posy;if((i=l-this.pre_posx)*i+(p=r-this.pre_posy)*p>.25*t*n*n)e=!1;else{var a,s,_=(a=this.aabb.maxx-this.aabb.minx)*a+(s=this.aabb.maxy-this.aabb.miny)*s,h=o.angularSleepThreshold;if(h*=h,4*this.angvel*this.angvel*_>h)e=!1;else{var u=this.rot-this.pre_rot;e=!(u*u*_>h*n*n)}}}return e||(this.component.waket=this.space.stamp),this.component.waket+o.sleepDelay<this.space.stamp},vt.prototype.refreshArbiters=function(){for(var n=this.arbiters.head;null!=n;)n.elt.invalidated=!0,n=n.next},vt.prototype.sweepTime=null,vt.prototype.sweep_angvel=null,vt.prototype.sweepFrozen=null,vt.prototype.sweepRadius=null,vt.prototype.bullet=null,vt.prototype.bulletEnabled=null,vt.prototype.disableCCD=null,vt.prototype.sweepIntegrate=function(n){var e=n-this.sweepTime;if(0!=e&&(this.sweepTime=n,this.posx+=this.velx*e,this.posy+=this.vely*e,0!=this.angvel)){var t=this.sweep_angvel*e;if(this.rot+=t,t*t>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var i=t*t,p=1-.5*i,l=1-i*i/8,r=(p*this.axisx+t*this.axisy)*l;this.axisy=(p*this.axisy-t*this.axisx)*l,this.axisx=r}}},vt.prototype.sweepValidate=function(n){if(0==n.type)n.worldCOMx=this.posx+(this.axisy*n.localCOMx-this.axisx*n.localCOMy),n.worldCOMy=this.posy+(n.localCOMx*this.axisx+n.localCOMy*this.axisy);else{for(var e=n.polygon,t=e.lverts.next,i=e.gverts.next;null!=i;){var p=i,l=t;t=t.next,p.x=this.posx+(this.axisy*l.x-this.axisx*l.y),p.y=this.posy+(l.x*this.axisx+l.y*this.axisy),i=i.next}var r=e.edges.head,o=e.gverts.next,a=o;for(o=o.next;null!=o;){var s=o,_=r.elt;r=r.next,_.gnormx=this.axisy*_.lnormx-this.axisx*_.lnormy,_.gnormy=_.lnormx*this.axisx+_.lnormy*this.axisy,_.gprojection=this.posx*_.gnormx+this.posy*_.gnormy+_.lprojection,_.tp0=a.y*_.gnormx-a.x*_.gnormy,_.tp1=s.y*_.gnormx-s.x*_.gnormy,a=s,o=o.next}var h=e.gverts.next,u=r.elt;u.gnormx=this.axisy*u.lnormx-this.axisx*u.lnormy,u.gnormy=u.lnormx*this.axisx+u.lnormy*this.axisy,u.gprojection=this.posx*u.gnormx+this.posy*u.gnormy+u.lprojection,u.tp0=a.y*u.gnormx-a.x*u.gnormy,u.tp1=h.y*u.gnormx-h.x*u.gnormy}},vt.prototype.pre_posx=null,vt.prototype.pre_posy=null,vt.prototype.posx=null,vt.prototype.posy=null,vt.prototype.wrap_pos=null,vt.prototype.velx=null,vt.prototype.vely=null,vt.prototype.wrap_vel=null,vt.prototype.forcex=null,vt.prototype.forcey=null,vt.prototype.wrap_force=null,vt.prototype.kinvelx=null,vt.prototype.kinvely=null,vt.prototype.wrap_kinvel=null,vt.prototype.svelx=null,vt.prototype.svely=null,vt.prototype.wrap_svel=null,vt.prototype.invalidate_pos=function(){for(var n=this.shapes.head;null!=n;){var e=n.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},vt.prototype.pos_invalidate=function(n){if(this.immutable_midstep("Body::position"),this.posx!=n.x||this.posy!=n.y){this.posx=n.x,this.posy=n.y;for(var e=this.shapes.head;null!=e;){var t=e.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.wake()}},vt.prototype.pos_validate=function(){this.wrap_pos.zpp_inner.x=this.posx,this.wrap_pos.zpp_inner.y=this.posy},vt.prototype.vel_invalidate=function(n){this.velx=n.x,this.vely=n.y,this.wake()},vt.prototype.vel_validate=function(){this.wrap_vel.zpp_inner.x=this.velx,this.wrap_vel.zpp_inner.y=this.vely},vt.prototype.kinvel_invalidate=function(n){this.kinvelx=n.x,this.kinvely=n.y,this.wake()},vt.prototype.kinvel_validate=function(){this.wrap_kinvel.zpp_inner.x=this.kinvelx,this.wrap_kinvel.zpp_inner.y=this.kinvely},vt.prototype.svel_invalidate=function(n){this.svelx=n.x,this.svely=n.y,this.wake()},vt.prototype.svel_validate=function(){this.wrap_svel.zpp_inner.x=this.svelx,this.wrap_svel.zpp_inner.y=this.svely},vt.prototype.force_invalidate=function(n){this.forcex=n.x,this.forcey=n.y,this.wake()},vt.prototype.force_validate=function(){this.wrap_force.zpp_inner.x=this.forcex,this.wrap_force.zpp_inner.y=this.forcey},vt.prototype.setupPosition=function(){var n,t=this.posx,i=this.posy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_pos=n,this.wrap_pos.zpp_inner._inuse=!0,this.world?this.wrap_pos.zpp_inner._immutable=!0:(this.wrap_pos.zpp_inner._invalidate=e(this,this.pos_invalidate),this.wrap_pos.zpp_inner._validate=e(this,this.pos_validate))},vt.prototype.setupVelocity=function(){var n,t=this.velx,i=this.vely;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_vel=n,this.wrap_vel.zpp_inner._inuse=!0,this.world?this.wrap_vel.zpp_inner._immutable=!0:(this.wrap_vel.zpp_inner._invalidate=e(this,this.vel_invalidate),this.wrap_vel.zpp_inner._validate=e(this,this.vel_validate))},vt.prototype.setupkinvel=function(){var n,t=this.kinvelx,i=this.kinvely;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_kinvel=n,this.wrap_kinvel.zpp_inner._inuse=!0,this.world?this.wrap_kinvel.zpp_inner._immutable=!0:(this.wrap_kinvel.zpp_inner._invalidate=e(this,this.kinvel_invalidate),this.wrap_kinvel.zpp_inner._validate=e(this,this.kinvel_validate))},vt.prototype.setupsvel=function(){var n,t=this.svelx,i=this.svely;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_svel=n,this.wrap_svel.zpp_inner._inuse=!0,this.world?this.wrap_svel.zpp_inner._immutable=!0:(this.wrap_svel.zpp_inner._invalidate=e(this,this.svel_invalidate),this.wrap_svel.zpp_inner._validate=e(this,this.svel_validate))},vt.prototype.setupForce=function(){var n,t=this.forcex,i=this.forcey;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_force=n,this.wrap_force.zpp_inner._inuse=!0,this.world?this.wrap_force.zpp_inner._immutable=!0:(this.wrap_force.zpp_inner._invalidate=e(this,this.force_invalidate),this.wrap_force.zpp_inner._validate=e(this,this.force_validate))},vt.prototype.cvel_validate=function(){this.wrapcvel.zpp_inner.x=this.velx+this.kinvelx,this.wrapcvel.zpp_inner.y=this.vely+this.kinvely,this.wrapcvel.zpp_inner.z=this.angvel+this.kinangvel},vt.prototype.wrapcvel=null,vt.prototype.setup_cvel=function(){this.wrapcvel=cn.get(),this.wrapcvel.zpp_inner.immutable=!0,this.wrapcvel.zpp_inner._validate=e(this,this.cvel_validate)},vt.prototype.angvel=null,vt.prototype.torque=null,vt.prototype.kinangvel=null,vt.prototype.pre_rot=null,vt.prototype.rot=null,vt.prototype.invalidate_rot=function(){this.zip_axis=!0;for(var n=this.shapes.head;null!=n;){var e=n.elt;1==e.type&&(e.polygon.invalidate_gverts(),e.polygon.invalidate_gaxi()),e.invalidate_worldCOM(),n=n.next}this.zip_worldCOM=!0},vt.prototype.axisx=null,vt.prototype.axisy=null,vt.prototype.zip_axis=null,vt.prototype.validate_axis=function(){this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot))},vt.prototype.quick_validate_axis=function(){this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)},vt.prototype.delta_rot=function(n){if(this.rot+=n,n*n>1e-4)this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot);else{var e=n*n,t=1-.5*e,i=1-e*e/8,p=(t*this.axisx+n*this.axisy)*i;this.axisy=(t*this.axisy-n*this.axisx)*i,this.axisx=p}},vt.prototype.kinematicDelaySleep=null,vt.prototype.mass=null,vt.prototype.zip_mass=null,vt.prototype.massMode=null,vt.prototype.imass=null,vt.prototype.smass=null,vt.prototype.cmass=null,vt.prototype.nomove=null,vt.prototype.invalidate_mass=function(){this.zip_mass=!0,this.invalidate_gravMass()},vt.prototype.validate_mass=function(){if(this.zip_mass||(this.massMode,0)){if(this.zip_mass=!1,0==this.massMode){this.cmass=0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cmass+=e.area*e.material.density,n=n.next}}2!=this.type||this.nomove?(this.mass=1/0,this.imass=this.smass=0):(this.mass=this.cmass,this.imass=this.smass=1/this.mass)}},vt.prototype.gravMass=null,vt.prototype.zip_gravMass=null,vt.prototype.gravMassMode=null,vt.prototype.gravMassScale=null,vt.prototype.zip_gravMassScale=null,vt.prototype.invalidate_gravMass=function(){1!=this.gravMassMode&&(this.zip_gravMass=!0),2!=this.gravMassMode&&(this.zip_gravMassScale=!0),this.wake()},vt.prototype.validate_gravMass=function(){this.zip_gravMass&&(this.zip_gravMass=!1,this.validate_mass(),0==this.gravMassMode?(this.validate_mass(),this.gravMass=this.cmass):2==this.gravMassMode&&(this.validate_mass(),this.gravMass=this.cmass*this.gravMassScale))},vt.prototype.invalidate_gravMassScale=function(){2!=this.gravMassMode?this.zip_gravMassScale=!0:this.invalidate_gravMass()},vt.prototype.validate_gravMassScale=function(){this.zip_gravMassScale&&(this.zip_gravMassScale=!1,0==this.gravMassMode?this.gravMassScale=1:1==this.gravMassMode&&(this.validate_mass(),this.gravMassScale=this.gravMass/this.cmass))},vt.prototype.inertiaMode=null,vt.prototype.inertia=null,vt.prototype.zip_inertia=null,vt.prototype.cinertia=null,vt.prototype.iinertia=null,vt.prototype.sinertia=null,vt.prototype.norotate=null,vt.prototype.invalidate_inertia=function(){this.zip_inertia=!0,this.wake()},vt.prototype.validate_inertia=function(){if(this.zip_inertia||(this.inertiaMode,0)){if(this.zip_inertia=!1,0==this.inertiaMode){this.cinertia=0;for(var n=this.shapes.head;null!=n;){var e=n.elt;e.refmaterial.density=e.material.density,e.validate_area_inertia(),this.cinertia+=e.inertia*e.area*e.material.density,n=n.next}}2!=this.type||this.norotate?(this.inertia=1/0,this.sinertia=this.iinertia=0):(this.inertia=this.cinertia,this.sinertia=this.iinertia=1/this.inertia)}},vt.prototype.invalidate_wake=function(){this.wake()},vt.prototype.aabb=null,vt.prototype.zip_aabb=null,vt.prototype.validate_aabb=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var n=this.shapes.head;null!=n;){var e=n.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var t=e.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var i=t.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var p=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var y=t.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var z=t.radius,v=t.radius;t.aabb.minx=t.worldCOMx-z,t.aabb.miny=t.worldCOMy-v,t.aabb.maxx=t.worldCOMx+z,t.aabb.maxy=t.worldCOMy+v}else{var c=e.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var f=c.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var m=c.lverts.next,b=c.gverts.next;null!=b;){var g=b,w=m;m=m.next,g.x=c.body.posx+(c.body.axisy*w.x-c.body.axisx*w.y),g.y=c.body.posy+(w.x*c.body.axisx+w.y*c.body.axisy),b=b.next}}var M=c.gverts.next;c.aabb.minx=M.x,c.aabb.miny=M.y,c.aabb.maxx=M.x,c.aabb.maxy=M.y;for(var C=c.gverts.next.next;null!=C;){var k=C;k.x<c.aabb.minx&&(c.aabb.minx=k.x),k.x>c.aabb.maxx&&(c.aabb.maxx=k.x),k.y<c.aabb.miny&&(c.aabb.miny=k.y),k.y>c.aabb.maxy&&(c.aabb.maxy=k.y),C=C.next}}var O=this.aabb,P=e.aabb;P.minx<O.minx&&(O.minx=P.minx),P.maxx>O.maxx&&(O.maxx=P.maxx),P.miny<O.miny&&(O.miny=P.miny),P.maxy>O.maxy&&(O.maxy=P.maxy),n=n.next}}},vt.prototype.invalidate_aabb=function(){this.zip_aabb=!0},vt.prototype.localCOMx=null,vt.prototype.localCOMy=null,vt.prototype.zip_localCOM=null,vt.prototype.worldCOMx=null,vt.prototype.worldCOMy=null,vt.prototype.zip_worldCOM=null,vt.prototype.wrap_localCOM=null,vt.prototype.wrap_worldCOM=null,vt.prototype.invalidate_localCOM=function(){this.zip_localCOM=!0,this.zip_worldCOM=!0},vt.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0},vt.prototype.validate_localCOM=function(){if(this.zip_localCOM){this.zip_localCOM=!1;for(var n=0,e=0,t=0,i=this.shapes.head;null!=i;){var p=i.elt;if(p.zip_localCOM){if(p.zip_localCOM=!1,1==p.type){var l=p.polygon;if(null==l.lverts.next.next)l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y;else if(null==l.lverts.next.next.next)l.localCOMx=l.lverts.next.x,l.localCOMy=l.lverts.next.y,l.localCOMx+=l.lverts.next.next.x,l.localCOMy+=l.lverts.next.next.y,l.localCOMx*=.5,l.localCOMy*=.5;else{l.localCOMx=0,l.localCOMy=0;var r=0,o=l.lverts.next,a=o,s=o=o.next;for(o=o.next;null!=o;){var _=o;r+=s.x*(_.y-a.y);var h=_.y*s.x-_.x*s.y;l.localCOMx+=(s.x+_.x)*h,l.localCOMy+=(s.y+_.y)*h,a=s,s=_,o=o.next}var u=o=l.lverts.next;r+=s.x*(u.y-a.y);var x=u.y*s.x-u.x*s.y;l.localCOMx+=(s.x+u.x)*x,l.localCOMy+=(s.y+u.y)*x,a=s;var d=o=o.next;r+=u.x*(d.y-a.y);var y=d.y*u.x-d.x*u.y;l.localCOMx+=(u.x+d.x)*y,l.localCOMy+=(u.y+d.y)*y;var z=r=1/(3*r);l.localCOMx*=z,l.localCOMy*=z}}null!=p.wrap_localCOM&&(p.wrap_localCOM.zpp_inner.x=p.localCOMx,p.wrap_localCOM.zpp_inner.y=p.localCOMy)}p.validate_area_inertia();var v=p.area*p.material.density;n+=p.localCOMx*v,e+=p.localCOMy*v,t+=p.area*p.material.density,i=i.next}if(0!=t){var c=1/t;this.localCOMx=n*c,this.localCOMy=e*c}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy),this.zip_mass&&0==this.massMode&&(this.zip_mass=!1,this.cmass=t,2==this.type?(this.mass=this.cmass,this.imass=this.smass=1/this.mass):(this.mass=1/0,this.imass=this.smass=0))}},vt.prototype.validate_worldCOM=function(){this.zip_worldCOM&&(this.zip_worldCOM=!1,this.validate_localCOM(),this.zip_axis&&(this.zip_axis=!1,this.axisx=Math.sin(this.rot),this.axisy=Math.cos(this.rot)),this.worldCOMx=this.posx+(this.axisy*this.localCOMx-this.axisx*this.localCOMy),this.worldCOMy=this.posy+(this.localCOMx*this.axisx+this.localCOMy*this.axisy),null!=this.wrap_worldCOM&&(this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy))},vt.prototype.getlocalCOM=function(){this.validate_localCOM()},vt.prototype.getworldCOM=function(){this.validate_worldCOM()},vt.prototype.__immutable_midstep=function(n){},vt.prototype.clear=function(){for(;null!=this.shapes.head;){var n=this.shapes.pop_unsafe();n.removedFromBody(),n.body=null}this.invalidate_shapes(),this.pre_posx=0,this.pre_posy=0,this.posx=0,this.posy=0,this.velx=0,this.vely=0,this.forcex=0,this.forcey=0,this.kinvelx=0,this.kinvely=0,this.svelx=0,this.svely=0,this.angvel=this.torque=this.kinangvel=this.pre_rot=this.rot=0;for(var e=this.shapes.head;null!=e;){var t=e.elt;1==t.type&&(t.polygon.invalidate_gverts(),t.polygon.invalidate_gaxi()),t.invalidate_worldCOM(),e=e.next}this.zip_worldCOM=!0,this.zip_axis=!0;for(var i=this.shapes.head;null!=i;){var p=i.elt;1==p.type&&(p.polygon.invalidate_gverts(),p.polygon.invalidate_gaxi()),p.invalidate_worldCOM(),i=i.next}this.zip_worldCOM=!0,this.axisx=0,this.axisy=1,this.zip_axis=!1,this.massMode=0,this.gravMassMode=0,this.gravMassScale=1,this.inertiaMode=0,this.norotate=!1,this.nomove=!1},vt.prototype.aabb_validate=function(){if(this.zip_aabb){this.zip_aabb=!1,this.aabb.minx=1/0,this.aabb.miny=1/0,this.aabb.maxx=-1/0,this.aabb.maxy=-1/0;for(var n=this.shapes.head;null!=n;){var e=n.elt;if(e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var t=e.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var i=t.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var p=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var y=t.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var z=t.radius,v=t.radius;t.aabb.minx=t.worldCOMx-z,t.aabb.miny=t.worldCOMy-v,t.aabb.maxx=t.worldCOMx+z,t.aabb.maxy=t.worldCOMy+v}else{var c=e.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var f=c.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var m=c.lverts.next,b=c.gverts.next;null!=b;){var g=b,w=m;m=m.next,g.x=c.body.posx+(c.body.axisy*w.x-c.body.axisx*w.y),g.y=c.body.posy+(w.x*c.body.axisx+w.y*c.body.axisy),b=b.next}}var M=c.gverts.next;c.aabb.minx=M.x,c.aabb.miny=M.y,c.aabb.maxx=M.x,c.aabb.maxy=M.y;for(var C=c.gverts.next.next;null!=C;){var k=C;k.x<c.aabb.minx&&(c.aabb.minx=k.x),k.x>c.aabb.maxx&&(c.aabb.maxx=k.x),k.y<c.aabb.miny&&(c.aabb.miny=k.y),k.y>c.aabb.maxy&&(c.aabb.maxy=k.y),C=C.next}}var O=this.aabb,P=e.aabb;P.minx<O.minx&&(O.minx=P.minx),P.maxx>O.maxx&&(O.maxx=P.maxx),P.miny<O.miny&&(O.miny=P.miny),P.maxy>O.maxy&&(O.maxy=P.maxy),n=n.next}}},vt.prototype.shapes_adder=function(n){if(n.zpp_inner.body!=this){if(null!=n.zpp_inner.body&&n.zpp_inner.body.wrap_shapes.remove(n),n.zpp_inner.body=this,n.zpp_inner.addedToBody(),null!=this.space){var e=this.space,t=n.zpp_inner,i=t.body;i.world||(i.component.waket=e.stamp+(e.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&e.really_wake(i,!1)),e.bphase.insert(t),t.addedToSpace()}return 1==n.zpp_inner.type&&(n.zpp_inner.polygon.invalidate_gaxi(),n.zpp_inner.polygon.invalidate_gverts()),!0}return!1},vt.prototype.shapes_subber=function(n){null!=this.space&&this.space.removed_shape(n.zpp_inner),n.zpp_inner.body=null,n.zpp_inner.removedFromBody()},vt.prototype.shapes_invalidate=function(n){this.invalidate_shapes()},vt.prototype.addedToSpace=function(){null==jt.zpp_pool?this.component=new jt:(this.component=jt.zpp_pool,jt.zpp_pool=this.component.next,this.component.next=null),this.component.isBody=!0,this.component.body=this,this.__iaddedToSpace()},vt.prototype.removedFromSpace=function(){for(;null!=this.arbiters.head;){var n=this.arbiters.pop_unsafe();if(n.cleared=!0,n.b2==this)for(var e=n.b1.arbiters,t=null,i=e.head;null!=i;){if(i.elt==n){var p,l;null==t?(l=(p=e.head).next,e.head=l,null==e.head&&(e.pushmod=!0)):(l=(p=t.next).next,t.next=l,null==l&&(e.pushmod=!0));var r=p;r.elt=null,r.next=bi.zpp_pool,bi.zpp_pool=r,e.modified=!0,e.length--,e.pushmod=!0;break}t=i,i=i.next}if(n.b1==this)for(var o=n.b2.arbiters,a=null,s=o.head;null!=s;){if(s.elt==n){var _,h;null==a?(h=(_=o.head).next,o.head=h,null==o.head&&(o.pushmod=!0)):(h=(_=a.next).next,a.next=h,null==h&&(o.pushmod=!0));var u=_;u.elt=null,u.next=bi.zpp_pool,bi.zpp_pool=u,o.modified=!0,o.length--,o.pushmod=!0;break}a=s,s=s.next}null!=n.pair&&(n.pair.arb=null,n.pair=null),n.active=!1,this.space.f_arbiters.modified=!0}var x=this.component;x.body=null,x.constraint=null,x.next=jt.zpp_pool,jt.zpp_pool=x,this.component=null,this.__iremovedFromSpace()},vt.prototype.copy=function(){var n=(new bn).zpp_inner;n.type=this.type,n.bulletEnabled=this.bulletEnabled,n.disableCCD=this.disableCCD;for(var e=this.shapes.head;null!=e;){var t=n.outer.zpp_inner.wrap_shapes,i=e.elt.outer.copy();t.zpp_inner.reverse_flag?t.push(i):t.unshift(i),e=e.next}if(n.posx=this.posx,n.posy=this.posy,n.velx=this.velx,n.vely=this.vely,n.forcex=this.forcex,n.forcey=this.forcey,n.rot=this.rot,n.angvel=this.angvel,n.torque=this.torque,n.kinvelx=this.kinvelx,n.kinvely=this.kinvely,n.kinangvel=this.kinangvel,n.svelx=this.svelx,n.svely=this.svely,this.zip_axis){n.zip_axis=!0;for(var p=n.shapes.head;null!=p;){var l=p.elt;1==l.type&&(l.polygon.invalidate_gverts(),l.polygon.invalidate_gaxi()),l.invalidate_worldCOM(),p=p.next}n.zip_worldCOM=!0}else n.axisx=this.axisx,n.axisy=this.axisy;return n.rot=this.rot,n.massMode=this.massMode,n.gravMassMode=this.gravMassMode,n.inertiaMode=this.inertiaMode,n.norotate=this.norotate,n.nomove=this.nomove,n.cmass=this.cmass,n.cinertia=this.cinertia,this.zip_mass?n.invalidate_mass():n.mass=this.mass,this.zip_gravMass?n.invalidate_gravMass():n.gravMass=this.gravMass,this.zip_gravMassScale?n.invalidate_gravMassScale():n.gravMassScale=this.gravMassScale,this.zip_inertia?n.invalidate_inertia():n.inertia=this.inertia,this.zip_aabb?n.zip_aabb=!0:(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy),this.zip_localCOM?(n.zip_localCOM=!0,n.zip_worldCOM=!0):(n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy),this.zip_worldCOM?n.zip_worldCOM=!0:(n.worldCOMx=this.worldCOMx,n.worldCOMy=this.worldCOMy),this.copyto(n.outer),n.outer},vt.prototype.__class__=vt;var ct=zpp_nape.phys.ZPP_Compound=function(){this.space=null,this.compound=null,this.depth=0,this.wrap_compounds=null,this.wrap_constraints=null,this.wrap_bodies=null,this.compounds=null,this.constraints=null,this.bodies=null,this.outer=null,zt.call(this),this.icompound=this,this.depth=1,this.bodies=new qt,this.wrap_bodies=$i.get(this.bodies),this.wrap_bodies.zpp_inner.adder=e(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=e(this,this.bodies_subber),this.constraints=new ie,this.wrap_constraints=Hi.get(this.constraints),this.wrap_constraints.zpp_inner.adder=e(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=e(this,this.constraints_subber),this.compounds=new Ut,this.wrap_compounds=np.get(this.compounds),this.wrap_compounds.zpp_inner.adder=e(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=e(this,this.compounds_subber)};ct.__name__=["zpp_nape","phys","ZPP_Compound"],ct.__super__=zt,ct.prototype=Object.create(zt.prototype),ct.prototype.outer=null,ct.prototype.bodies=null,ct.prototype.constraints=null,ct.prototype.compounds=null,ct.prototype.wrap_bodies=null,ct.prototype.wrap_constraints=null,ct.prototype.wrap_compounds=null,ct.prototype.depth=null,ct.prototype.compound=null,ct.prototype.space=null,ct.prototype.__imutable_midstep=function(n){},ct.prototype.addedToSpace=function(){this.__iaddedToSpace()},ct.prototype.removedFromSpace=function(){this.__iremovedFromSpace()},ct.prototype.breakApart=function(){for(null!=this.space&&(this.__iremovedFromSpace(),this.space.nullInteractorType(this)),null!=this.compound?this.compound.compounds.remove(this):null!=this.space&&this.space.compounds.remove(this);null!=this.bodies.head;){var n=this.bodies.pop_unsafe();null!=(n.compound=this.compound)?this.compound.bodies.add(n):null!=this.space&&this.space.bodies.add(n),null!=this.space&&this.space.freshInteractorType(n)}for(;null!=this.constraints.head;){var e=this.constraints.pop_unsafe();null!=(e.compound=this.compound)?this.compound.constraints.add(e):null!=this.space&&this.space.constraints.add(e)}for(;null!=this.compounds.head;){var t=this.compounds.pop_unsafe();null!=(t.compound=this.compound)?this.compound.compounds.add(t):null!=this.space&&this.space.compounds.add(t),null!=this.space&&this.space.freshInteractorType(t)}this.compound=null,this.space=null},ct.prototype.bodies_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_bodies.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_bodies.remove(n),n.zpp_inner.compound=this,null!=this.space&&this.space.addBody(n.zpp_inner),!0)},ct.prototype.bodies_subber=function(n){n.zpp_inner.compound=null,null!=this.space&&this.space.remBody(n.zpp_inner)},ct.prototype.constraints_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_constraints.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_constraints.remove(n),n.zpp_inner.compound=this,null!=this.space&&this.space.addConstraint(n.zpp_inner),!0)},ct.prototype.constraints_subber=function(n){n.zpp_inner.compound=null,null!=this.space&&this.space.remConstraint(n.zpp_inner)},ct.prototype.compounds_adder=function(n){return n.zpp_inner.compound!=this&&(null!=n.zpp_inner.compound?n.zpp_inner.compound.wrap_compounds.remove(n):null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),n.zpp_inner.compound=this,n.zpp_inner.depth=this.depth+1,null!=this.space&&this.space.addCompound(n.zpp_inner),!0)},ct.prototype.compounds_subber=function(n){n.zpp_inner.compound=null,n.zpp_inner.depth=1,null!=this.space&&this.space.remCompound(n.zpp_inner)},ct.prototype.copy=function(n,e){var t=null==n;null==n&&(n=[]),null==e&&(e=[]);for(var i=new Cn,p=this.compounds.head;null!=p;){var l=p.elt.copy(n,e);if(l.zpp_inner.immutable_midstep("Compound::compound"),(null==l.zpp_inner.compound?null:l.zpp_inner.compound.outer)!=i&&(null!=(null==l.zpp_inner.compound?null:l.zpp_inner.compound.outer)&&(null==l.zpp_inner.compound?null:l.zpp_inner.compound.outer).zpp_inner.wrap_compounds.remove(l),null!=i)){var r=i.zpp_inner.wrap_compounds;r.zpp_inner.reverse_flag?r.push(l):r.unshift(l)}p=p.next}for(var o=this.bodies.head;null!=o;){var a=o.elt,s=a.outer.copy();if(n.push(ze.dict(a.id,s)),(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer)!=i&&(null!=(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer)&&(null==s.zpp_inner.compound?null:s.zpp_inner.compound.outer).zpp_inner.wrap_bodies.remove(s),null!=i)){var _=i.zpp_inner.wrap_bodies;_.zpp_inner.reverse_flag?_.push(s):_.unshift(s)}o=o.next}for(var h=this.constraints.head;null!=h;){var u=h.elt.copy(n,e);if((null==u.zpp_inner.compound?null:u.zpp_inner.compound.outer)!=i&&(null!=(null==u.zpp_inner.compound?null:u.zpp_inner.compound.outer)&&(null==u.zpp_inner.compound?null:u.zpp_inner.compound.outer).zpp_inner.wrap_constraints.remove(u),null!=i)){var x=i.zpp_inner.wrap_constraints;x.zpp_inner.reverse_flag?x.push(u):x.unshift(u)}h=h.next}if(t)for(;e.length>0;)for(var d=e.pop(),y=0;y<n.length;){var z=n[y];if(++y,z.id==d.id){d.cb(z.bc);break}}return this.copyto(i),i},ct.prototype.__class__=ct;var ft=zpp_nape.phys.ZPP_FluidProperties=function(){this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.density=0,this.viscosity=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new Gt,this.density=this.viscosity=1,this.wrap_gravity=null,this.gravityx=0,this.gravityy=0};ft.__name__=["zpp_nape","phys","ZPP_FluidProperties"],ft.prototype.next=null,ft.prototype.userData=null,ft.prototype.outer=null,ft.prototype.wrapper=function(){if(null==this.outer){this.outer=new Pn;var n=this.outer.zpp_inner;n.outer=null,n.next=ft.zpp_pool,ft.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},ft.prototype.free=function(){this.outer=null},ft.prototype.alloc=function(){},ft.prototype.shapes=null,ft.prototype.wrap_shapes=null,ft.prototype.feature_cons=function(){this.shapes=new Gt},ft.prototype.addShape=function(n){this.shapes.add(n)},ft.prototype.remShape=function(n){this.shapes.remove(n)},ft.prototype.copy=function(){var n;return null==ft.zpp_pool?n=new ft:(n=ft.zpp_pool,ft.zpp_pool=n.next,n.next=null),n.viscosity=this.viscosity,n.density=this.density,n},ft.prototype.viscosity=null,ft.prototype.density=null,ft.prototype.gravityx=null,ft.prototype.gravityy=null,ft.prototype.wrap_gravity=null,ft.prototype.gravity_invalidate=function(n){this.gravityx=n.x,this.gravityy=n.y,this.invalidate()},ft.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},ft.prototype.getgravity=function(){var n,t=this.gravityx,i=this.gravityy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=e(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=e(this,this.gravity_validate)},ft.prototype.invalidate=function(){for(var n=this.shapes.head;null!=n;)n.elt.invalidate_fluidprops(),n=n.next},ft.prototype.__class__=ft;var mt=zpp_nape.phys.ZPP_Material=function(){this.rollingFriction=0,this.elasticity=0,this.density=0,this.staticFriction=0,this.dynamicFriction=0,this.wrap_shapes=null,this.shapes=null,this.outer=null,this.userData=null,this.next=null,this.shapes=new Gt,this.elasticity=0,this.dynamicFriction=1,this.staticFriction=2,this.density=.001,this.rollingFriction=.01};mt.__name__=["zpp_nape","phys","ZPP_Material"],mt.prototype.next=null,mt.prototype.userData=null,mt.prototype.outer=null,mt.prototype.wrapper=function(){if(null==this.outer){this.outer=new Tn;var n=this.outer.zpp_inner;n.outer=null,n.next=mt.zpp_pool,mt.zpp_pool=n,this.outer.zpp_inner=this}return this.outer},mt.prototype.free=function(){this.outer=null},mt.prototype.alloc=function(){},mt.prototype.shapes=null,mt.prototype.wrap_shapes=null,mt.prototype.feature_cons=function(){this.shapes=new Gt},mt.prototype.addShape=function(n){this.shapes.add(n)},mt.prototype.remShape=function(n){this.shapes.remove(n)},mt.prototype.dynamicFriction=null,mt.prototype.staticFriction=null,mt.prototype.density=null,mt.prototype.elasticity=null,mt.prototype.rollingFriction=null,mt.prototype.copy=function(){var n=new mt;return n.dynamicFriction=this.dynamicFriction,n.staticFriction=this.staticFriction,n.density=this.density,n.elasticity=this.elasticity,n.rollingFriction=this.rollingFriction,n},mt.prototype.set=function(n){this.dynamicFriction=n.dynamicFriction,this.staticFriction=n.staticFriction,this.density=n.density,this.elasticity=n.elasticity,this.rollingFriction=n.rollingFriction},mt.prototype.invalidate=function(n){for(var e=this.shapes.head;null!=e;)e.elt.invalidate_material(n),e=e.next},mt.prototype.__class__=mt;var bt=zpp_nape.shape.ZPP_Shape=function(n){var t;this.zip_aabb=!1,this.aabb=null,this.pairs=null,this.node=null,this.sweep=null,this.sensorEnabled=!1,this.fluidEnabled=!1,this.fluidProperties=null,this.filter=null,this.material=null,this.refmaterial=null,this.polygon=null,this.circle=null,this.sweepCoef=0,this.zip_sweepRadius=!1,this.sweepRadius=0,this.wrap_worldCOM=null,this.wrap_localCOM=null,this.zip_worldCOM=!1,this.worldCOMy=0,this.worldCOMx=0,this.zip_localCOM=!1,this.localCOMy=0,this.localCOMx=0,this.zip_angDrag=!1,this.angDrag=0,this.inertia=0,this.zip_area_inertia=!1,this.area=0,this.type=0,this.body=null,this.outer=null,zt.call(this),this.pairs=new ti,this.ishape=this,this.type=n,null==Te.zpp_pool?t=new Te:(t=Te.zpp_pool,Te.zpp_pool=t.next,t.next=null),t.minx=0,t.miny=0,t.maxx=0,t.maxy=0,this.aabb=t,this.aabb._immutable=!0,this.aabb._validate=e(this,this.aabb_validate),this.zip_area_inertia=this.zip_angDrag=this.zip_localCOM=this.zip_sweepRadius=!0,this.localCOMx=0,this.localCOMy=0,this.worldCOMx=0,this.worldCOMy=0,this.fluidEnabled=!1,this.sensorEnabled=!1,this.fluidProperties=null,this.body=null,this.refmaterial=new mt,this.sweepRadius=this.sweepCoef=0};bt.__name__=["zpp_nape","shape","ZPP_Shape"],bt.__super__=zt,bt.prototype=Object.create(zt.prototype),bt.prototype.outer=null,bt.prototype.body=null,bt.prototype.type=null,bt.prototype.isCircle=function(){return 0==this.type},bt.prototype.isPolygon=function(){return 1==this.type},bt.prototype.area=null,bt.prototype.zip_area_inertia=null,bt.prototype.inertia=null,bt.prototype.angDrag=null,bt.prototype.zip_angDrag=null,bt.prototype.localCOMx=null,bt.prototype.localCOMy=null,bt.prototype.zip_localCOM=null,bt.prototype.worldCOMx=null,bt.prototype.worldCOMy=null,bt.prototype.zip_worldCOM=null,bt.prototype.wrap_localCOM=null,bt.prototype.wrap_worldCOM=null,bt.prototype.sweepRadius=null,bt.prototype.zip_sweepRadius=null,bt.prototype.sweepCoef=null,bt.prototype.invalidate_sweepRadius=function(){this.zip_sweepRadius=!0},bt.prototype.validate_sweepRadius=function(){this.zip_sweepRadius&&(this.zip_sweepRadius=!1,0==this.type?this.circle.__validate_sweepRadius():this.polygon.__validate_sweepRadius())},bt.prototype.circle=null,bt.prototype.polygon=null,bt.prototype.refmaterial=null,bt.prototype.material=null,bt.prototype.filter=null,bt.prototype.fluidProperties=null,bt.prototype.fluidEnabled=null,bt.prototype.sensorEnabled=null,bt.prototype.sweep=null,bt.prototype.node=null,bt.prototype.pairs=null,bt.prototype.clear=function(){0==this.type?this.circle.__clear():this.polygon.__clear()},bt.prototype.aabb=null,bt.prototype.zip_aabb=null,bt.prototype.validate_aabb=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var e=n.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;t+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;e.localCOMx+=(l.x+r.x)*o,e.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=e.lverts.next;t+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;e.localCOMx+=(l.x+a.x)*s,e.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;t+=a.x*(_.y-p.y);var h=_.y*a.x-_.x*a.y;e.localCOMx+=(a.x+_.x)*h,e.localCOMy+=(a.y+_.y)*h;var u=t=1/(3*t);e.localCOMx*=u,e.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var d=n.radius,y=n.radius;n.aabb.minx=n.worldCOMx-d,n.aabb.miny=n.worldCOMy-y,n.aabb.maxx=n.worldCOMx+d,n.aabb.maxy=n.worldCOMy+y}else{var z=this.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var v=z.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var c=z.lverts.next,f=z.gverts.next;null!=f;){var m=f,b=c;c=c.next,m.x=z.body.posx+(z.body.axisy*b.x-z.body.axisx*b.y),m.y=z.body.posy+(b.x*z.body.axisx+b.y*z.body.axisy),f=f.next}}var g=z.gverts.next;z.aabb.minx=g.x,z.aabb.miny=g.y,z.aabb.maxx=g.x,z.aabb.maxy=g.y;for(var w=z.gverts.next.next;null!=w;){var M=w;M.x<z.aabb.minx&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),M.y<z.aabb.miny&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),w=w.next}}},bt.prototype.force_validate_aabb=function(){if(0==this.type){var n=this.circle;n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy),n.aabb.minx=n.worldCOMx-n.radius,n.aabb.miny=n.worldCOMy-n.radius,n.aabb.maxx=n.worldCOMx+n.radius,n.aabb.maxy=n.worldCOMy+n.radius}else{var e=this.polygon,t=e.lverts.next,i=e.gverts.next,p=t;t=t.next,i.x=e.body.posx+(e.body.axisy*p.x-e.body.axisx*p.y),i.y=e.body.posy+(p.x*e.body.axisx+p.y*e.body.axisy),e.aabb.minx=i.x,e.aabb.miny=i.y,e.aabb.maxx=i.x,e.aabb.maxy=i.y;for(var l=e.gverts.next.next;null!=l;){var r=l,o=t;t=t.next,r.x=e.body.posx+(e.body.axisy*o.x-e.body.axisx*o.y),r.y=e.body.posy+(o.x*e.body.axisx+o.y*e.body.axisy),r.x<e.aabb.minx&&(e.aabb.minx=r.x),r.x>e.aabb.maxx&&(e.aabb.maxx=r.x),r.y<e.aabb.miny&&(e.aabb.miny=r.y),r.y>e.aabb.maxy&&(e.aabb.maxy=r.y),l=l.next}}},bt.prototype.invalidate_aabb=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},bt.prototype.validate_area_inertia=function(){this.zip_area_inertia&&(this.zip_area_inertia=!1,0==this.type?this.circle.__validate_area_inertia():this.polygon.__validate_area_inertia())},bt.prototype.validate_angDrag=function(){(this.zip_angDrag||this.refmaterial.dynamicFriction!=this.material.dynamicFriction)&&(this.zip_angDrag=!1,this.refmaterial.dynamicFriction=this.material.dynamicFriction,0==this.type?this.circle.__validate_angDrag():this.polygon.__validate_angDrag())},bt.prototype.validate_localCOM=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t,p=t=t.next;for(t=t.next;null!=t;){var l=t;e+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,t=t.next}var o=t=n.lverts.next;e+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=t=t.next;e+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=e=1/(3*e);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},bt.prototype.validate_worldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t,p=t=t.next;for(t=t.next;null!=t;){var l=t;e+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,t=t.next}var o=t=n.lverts.next;e+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=t=t.next;e+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=e=1/(3*e);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}},bt.prototype.getworldCOM=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t,p=t=t.next;for(t=t.next;null!=t;){var l=t;e+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,t=t.next}var o=t=n.lverts.next;e+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=t=t.next;e+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=e=1/(3*e);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}this.wrap_worldCOM.zpp_inner.x=this.worldCOMx,this.wrap_worldCOM.zpp_inner.y=this.worldCOMy},bt.prototype.invalidate_area_inertia=function(){if(this.zip_area_inertia=!0,null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}},bt.prototype.invalidate_angDrag=function(){this.zip_angDrag=!0},bt.prototype.invalidate_localCOM=function(){if(this.zip_localCOM=!0,this.invalidate_area_inertia(),0==this.type&&(this.zip_sweepRadius=!0),this.invalidate_angDrag(),this.invalidate_worldCOM(),null!=this.body){var n=this.body;n.zip_localCOM=!0,n.zip_worldCOM=!0}},bt.prototype.invalidate_worldCOM=function(){this.zip_worldCOM=!0,this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},bt.prototype.invalidate_material=function(n){if(0!=(n&mt.WAKE)&&this.wake(),0!=(n&mt.ARBITERS)&&null!=this.body&&this.body.refreshArbiters(),0!=(n&mt.PROPS)&&null!=this.body){var e=this.body;e.zip_localCOM=!0,e.zip_worldCOM=!0,this.body.invalidate_mass(),this.body.invalidate_inertia()}0!=(n&mt.ANGDRAG)&&this.invalidate_angDrag(),this.refmaterial.set(this.material)},bt.prototype.invalidate_filter=function(){this.wake()},bt.prototype.invalidate_fluidprops=function(){this.fluidEnabled&&this.wake()},bt.prototype.aabb_validate=function(){if(this.zip_aabb&&null!=this.body)if(this.zip_aabb=!1,0==this.type){var n=this.circle;if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var e=n.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;t+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;e.localCOMx+=(l.x+r.x)*o,e.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=e.lverts.next;t+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;e.localCOMx+=(l.x+a.x)*s,e.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;t+=a.x*(_.y-p.y);var h=_.y*a.x-_.x*a.y;e.localCOMx+=(a.x+_.x)*h,e.localCOMy+=(a.y+_.y)*h;var u=t=1/(3*t);e.localCOMx*=u,e.localCOMy*=u}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var x=n.body;x.zip_axis&&(x.zip_axis=!1,x.axisx=Math.sin(x.rot),x.axisy=Math.cos(x.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}var d=n.radius,y=n.radius;n.aabb.minx=n.worldCOMx-d,n.aabb.miny=n.worldCOMy-y,n.aabb.maxx=n.worldCOMx+d,n.aabb.maxy=n.worldCOMy+y}else{var z=this.polygon;if(z.zip_gverts&&null!=z.body){z.zip_gverts=!1,z.validate_lverts();var v=z.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var c=z.lverts.next,f=z.gverts.next;null!=f;){var m=f,b=c;c=c.next,m.x=z.body.posx+(z.body.axisy*b.x-z.body.axisx*b.y),m.y=z.body.posy+(b.x*z.body.axisx+b.y*z.body.axisy),f=f.next}}var g=z.gverts.next;z.aabb.minx=g.x,z.aabb.miny=g.y,z.aabb.maxx=g.x,z.aabb.maxy=g.y;for(var w=z.gverts.next.next;null!=w;){var M=w;M.x<z.aabb.minx&&(z.aabb.minx=M.x),M.x>z.aabb.maxx&&(z.aabb.maxx=M.x),M.y<z.aabb.miny&&(z.aabb.miny=M.y),M.y>z.aabb.maxy&&(z.aabb.maxy=M.y),w=w.next}}},bt.prototype.setMaterial=function(n){this.material!=n&&(null!=this.body&&null!=this.body.space&&null!=this.material&&this.material.shapes.remove(this),this.material=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake(),null!=this.body&&this.body.refreshArbiters())},bt.prototype.setFilter=function(n){this.filter!=n&&(null!=this.body&&null!=this.body.space&&null!=this.filter&&this.filter.shapes.remove(this),this.filter=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.wake())},bt.prototype.setFluid=function(n){this.fluidProperties!=n&&(null!=this.body&&null!=this.body.space&&null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this),this.fluidProperties=n,null!=this.body&&null!=this.body.space&&n.shapes.add(this),this.fluidEnabled&&this.wake())},bt.prototype.__immutable_midstep=function(n){},bt.prototype.addedToBody=function(){this.invalidate_worldCOM(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0)},bt.prototype.removedFromBody=function(){},bt.prototype.addedToSpace=function(){this.__iaddedToSpace(),this.material.shapes.add(this),this.filter.shapes.add(this),null!=this.fluidProperties&&this.fluidProperties.shapes.add(this)},bt.prototype.removedFromSpace=function(){this.__iremovedFromSpace(),this.material.shapes.remove(this),this.filter.shapes.remove(this),null!=this.fluidProperties&&this.fluidProperties.shapes.remove(this)},bt.prototype.copy=function(){var n=null;n=0==this.type?this.circle.__copy():this.polygon.__copy(),this.zip_area_inertia?n.invalidate_area_inertia():(n.area=this.area,n.inertia=this.inertia),this.zip_sweepRadius?n.zip_sweepRadius=!0:(n.sweepRadius=this.sweepRadius,n.sweepCoef=this.sweepCoef),this.zip_angDrag?n.invalidate_angDrag():n.angDrag=this.angDrag,this.zip_aabb?(n.zip_aabb=!0,null!=n.body&&(n.body.zip_aabb=!0)):(n.aabb.minx=this.aabb.minx,n.aabb.miny=this.aabb.miny,n.aabb.maxx=this.aabb.maxx,n.aabb.maxy=this.aabb.maxy);var e=n.material;e.outer=null,e.next=mt.zpp_pool,mt.zpp_pool=e;var i=n.filter;return i.outer=null,i.next=je.zpp_pool,je.zpp_pool=i,n.material=this.material,n.filter=this.filter,null!=this.fluidProperties&&(n.fluidProperties=this.fluidProperties),n.fluidEnabled=this.fluidEnabled,n.sensorEnabled=this.sensorEnabled,null!=this.userData&&(n.userData=t.copy(this.userData)),this.copyto(n.outer),n.outer},bt.prototype.__class__=bt;var gt=zpp_nape.shape.ZPP_Circle=function(){this.radius=0,this.outer_zn=null,bt.call(this,0),this.circle=this,this.zip_localCOM=!1};gt.__name__=["zpp_nape","shape","ZPP_Circle"],gt.__super__=bt,gt.prototype=Object.create(bt.prototype),gt.prototype.outer_zn=null,gt.prototype.radius=null,gt.prototype.__clear=function(){},gt.prototype.invalidate_radius=function(){this.invalidate_area_inertia(),this.invalidate_angDrag(),this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),null!=this.body&&this.body.wake()},gt.prototype.localCOM_validate=function(){this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy},gt.prototype.localCOM_invalidate=function(n){this.localCOMx=n.x,this.localCOMy=n.y,this.invalidate_localCOM(),null!=this.body&&this.body.wake()},gt.prototype.setupLocalCOM=function(){var n,t=this.localCOMx,i=this.localCOMy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=e(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=e(this,this.localCOM_invalidate)},gt.prototype.__validate_aabb=function(){if(this.zip_worldCOM&&null!=this.body){if(this.zip_worldCOM=!1,this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t,p=t=t.next;for(t=t.next;null!=t;){var l=t;e+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,t=t.next}var o=t=n.lverts.next;e+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=t=t.next;e+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=e=1/(3*e);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var u=this.body;u.zip_axis&&(u.zip_axis=!1,u.axisx=Math.sin(u.rot),u.axisy=Math.cos(u.rot)),this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy)}var x=this.radius,d=this.radius;this.aabb.minx=this.worldCOMx-x,this.aabb.miny=this.worldCOMy-d,this.aabb.maxx=this.worldCOMx+x,this.aabb.maxy=this.worldCOMy+d},gt.prototype._force_validate_aabb=function(){this.worldCOMx=this.body.posx+(this.body.axisy*this.localCOMx-this.body.axisx*this.localCOMy),this.worldCOMy=this.body.posy+(this.localCOMx*this.body.axisx+this.localCOMy*this.body.axisy),this.aabb.minx=this.worldCOMx-this.radius,this.aabb.miny=this.worldCOMy-this.radius,this.aabb.maxx=this.worldCOMx+this.radius,this.aabb.maxy=this.worldCOMy+this.radius},gt.prototype.__validate_sweepRadius=function(){this.sweepCoef=Math.sqrt(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy),this.sweepRadius=this.sweepCoef+this.radius},gt.prototype.__validate_area_inertia=function(){var n=this.radius*this.radius;this.area=n*Math.PI,this.inertia=.5*n+(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy)},gt.prototype.__validate_angDrag=function(){var n=this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy,e=this.radius*this.radius;this.angDrag=(n+2*e)*(this.material.dynamicFriction*o.fluidAngularDragFriction)+.5*o.fluidAngularDrag*(1+o.fluidVacuumDrag)*n,this.angDrag/=2*(n+.5*e)},gt.prototype.__scale=function(n,e){var t=((n<0?-n:n)+(e<0?-e:e))/2;this.radius*=t<0?-t:t,this.invalidate_radius(),this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0&&(this.localCOMx*=n,this.localCOMy*=e,this.invalidate_localCOM())},gt.prototype.__translate=function(n,e){this.localCOMx+=n,this.localCOMy+=e,this.invalidate_localCOM()},gt.prototype.__rotate=function(n,e){if(this.localCOMx*this.localCOMx+this.localCOMy*this.localCOMy>0){var t,i;t=e*this.localCOMx-n*this.localCOMy,i=this.localCOMx*n+this.localCOMy*e,this.localCOMx=t,this.localCOMy=i,this.invalidate_localCOM()}},gt.prototype.__transform=function(n){var e=n.zpp_inner.a*n.zpp_inner.d-n.zpp_inner.b*n.zpp_inner.c;e<0&&(e=-e),this.radius*=Math.sqrt(e);var t=n.zpp_inner.a*this.localCOMx+n.zpp_inner.b*this.localCOMy+n.zpp_inner.tx;this.localCOMy=n.zpp_inner.c*this.localCOMx+n.zpp_inner.d*this.localCOMy+n.zpp_inner.ty,this.localCOMx=t,this.invalidate_radius(),this.invalidate_localCOM()},gt.prototype.__copy=function(){var n=new Ln(this.radius).zpp_inner_zn;return n.localCOMx=this.localCOMx,n.localCOMy=this.localCOMy,n.zip_localCOM=!1,n},gt.prototype.__class__=gt;var wt=zpp_nape.shape.ZPP_Edge=function(){this.tp1=0,this.tp0=0,this.gp1=null,this.lp1=null,this.gp0=null,this.lp0=null,this.gprojection=0,this.lprojection=0,this.length=0,this.wrap_gnorm=null,this.gnormy=0,this.gnormx=0,this.wrap_lnorm=null,this.lnormy=0,this.lnormx=0,this.outer=null,this.polygon=null,this.next=null,this.lnormx=0,this.lnormy=0,this.gnormx=0,this.gnormy=0,this.length=0,this.lprojection=0,this.gprojection=0};wt.__name__=["zpp_nape","shape","ZPP_Edge"],wt.prototype.next=null,wt.prototype.free=function(){this.polygon=null},wt.prototype.alloc=function(){},wt.prototype.polygon=null,wt.prototype.outer=null,wt.prototype.wrapper=function(){return null==this.outer&&(wt.internal=!0,this.outer=new Vn,wt.internal=!1,this.outer.zpp_inner=this),this.outer},wt.prototype.lnormx=null,wt.prototype.lnormy=null,wt.prototype.wrap_lnorm=null,wt.prototype.gnormx=null,wt.prototype.gnormy=null,wt.prototype.wrap_gnorm=null,wt.prototype.length=null,wt.prototype.lprojection=null,wt.prototype.gprojection=null,wt.prototype.lp0=null,wt.prototype.gp0=null,wt.prototype.lp1=null,wt.prototype.gp1=null,wt.prototype.tp0=null,wt.prototype.tp1=null,wt.prototype.lnorm_validate=function(){this.polygon.validate_laxi(),this.wrap_lnorm.zpp_inner.x=this.lnormx,this.wrap_lnorm.zpp_inner.y=this.lnormy},wt.prototype.gnorm_validate=function(){var n=this.polygon;if(n.zip_gaxi&&null!=n.body){n.zip_gaxi=!1,n.validate_laxi();var e=n.body;if(e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot)),n.zip_gverts&&null!=n.body){n.zip_gverts=!1,n.validate_lverts();var t=n.body;t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot));for(var i=n.lverts.next,p=n.gverts.next;null!=p;){var l=p,r=i;i=i.next,l.x=n.body.posx+(n.body.axisy*r.x-n.body.axisx*r.y),l.y=n.body.posy+(r.x*n.body.axisx+r.y*n.body.axisy),p=p.next}}var o=n.edges.head,a=n.gverts.next,s=a;for(a=a.next;null!=a;){var _=a,h=o.elt;o=o.next,h.gp0=s,h.gp1=_,h.gnormx=n.body.axisy*h.lnormx-n.body.axisx*h.lnormy,h.gnormy=h.lnormx*n.body.axisx+h.lnormy*n.body.axisy,h.gprojection=n.body.posx*h.gnormx+n.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy,s=_,a=a.next}var u=o.elt;u.gp0=s,u.gp1=n.gverts.next,u.gnormx=n.body.axisy*u.lnormx-n.body.axisx*u.lnormy,u.gnormy=u.lnormx*n.body.axisx+u.lnormy*n.body.axisy,u.gprojection=n.body.posx*u.gnormx+n.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy}this.wrap_gnorm.zpp_inner.x=this.gnormx,this.wrap_gnorm.zpp_inner.y=this.gnormy},wt.prototype.getlnorm=function(){var n,t=this.lnormx,i=this.lnormy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_lnorm=n,this.wrap_lnorm.zpp_inner._immutable=!0,this.wrap_lnorm.zpp_inner._validate=e(this,this.lnorm_validate)},wt.prototype.getgnorm=function(){var n,t=this.gnormx,i=this.gnormy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_gnorm=n,this.wrap_gnorm.zpp_inner._immutable=!0,this.wrap_gnorm.zpp_inner._validate=e(this,this.gnorm_validate)},wt.prototype.__class__=wt;var Mt=zpp_nape.shape.ZPP_Polygon=function(){this.zip_sanitation=!1,this.zip_valid=!1,this.zip_gaxi=!1,this.zip_gverts=!1,this.zip_laxi=!1,this.zip_lverts=!1,this.reverse_flag=!1,this.edgeCnt=0,this.wrap_edges=null,this.edges=null,this.wrap_gverts=null,this.gverts=null,this.wrap_lverts=null,this.lverts=null,this.outer_zn=null,bt.call(this,1),this.polygon=this,this.lverts=new xt,this.gverts=new xt,this.edges=new ii,this.edgeCnt=0};Mt.__name__=["zpp_nape","shape","ZPP_Polygon"],Mt.__super__=bt,Mt.prototype=Object.create(bt.prototype),Mt.prototype.outer_zn=null,Mt.prototype.lverts=null,Mt.prototype.wrap_lverts=null,Mt.prototype.gverts=null,Mt.prototype.wrap_gverts=null,Mt.prototype.edges=null,Mt.prototype.wrap_edges=null,Mt.prototype.edgeCnt=null,Mt.prototype.reverse_flag=null,Mt.prototype.__clear=function(){},Mt.prototype.lverts_pa_invalidate=function(n){this.invalidate_lverts()},Mt.prototype.gverts_pa_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,p=e;e=e.next,i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),t=t.next}}},Mt.prototype.lverts_post_adder=function(n){n.zpp_inner._invalidate=e(this,this.lverts_pa_invalidate);for(var t,i=null,p=null,l=this.lverts.next;null!=l&&l!=n.zpp_inner;)i=null==i?this.gverts.next:i.next,p=null==p?this.edges.head:p.next,l=l.next;null==xt.zpp_pool?t=new xt:(t=xt.zpp_pool,xt.zpp_pool=t.next,t.next=null),t.weak=!1,t._immutable=!0,t.x=0,t.y=0;var r,o,a,s=t;(this.gverts.insert(i,s),null!=this.lverts.next.next)&&(null==this.lverts.next.next.next?(null==wt.zpp_pool?r=new wt:(r=wt.zpp_pool,wt.zpp_pool=r.next,r.next=null),r.polygon=this,this.edges.add(r),null==wt.zpp_pool?o=new wt:(o=wt.zpp_pool,wt.zpp_pool=o.next,o.next=null),o.polygon=this,this.edges.add(o),this.edgeCnt+=2):(null==wt.zpp_pool?a=new wt:(a=wt.zpp_pool,wt.zpp_pool=a.next,a.next=null),a.polygon=this,this.edges.insert(p,a),this.edgeCnt++));s._validate=e(this,this.gverts_pa_validate)},Mt.prototype.lverts_subber=function(n){this.cleanup_lvert(n.zpp_inner)},Mt.prototype.lverts_invalidate=function(n){this.invalidate_lverts()},Mt.prototype.lverts_validate=function(){this.validate_lverts()},Mt.prototype.gverts_validate=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,p=e;e=e.next,i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),t=t.next}}},Mt.prototype.edges_validate=function(){this.validate_lverts()},Mt.prototype.getlverts=function(){this.wrap_lverts=Xi.get(this.lverts),this.wrap_lverts.zpp_inner.post_adder=e(this,this.lverts_post_adder),this.wrap_lverts.zpp_inner.subber=e(this,this.lverts_subber),this.wrap_lverts.zpp_inner._invalidate=e(this,this.lverts_invalidate),this.wrap_lverts.zpp_inner._validate=e(this,this.lverts_validate),this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag},Mt.prototype.getgverts=function(){this.wrap_gverts=Xi.get(this.gverts,!0),this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_gverts.zpp_inner._validate=e(this,this.gverts_validate)},Mt.prototype.getedges=function(){this.wrap_edges=op.get(this.edges,!0),this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag,this.wrap_edges.zpp_inner._validate=e(this,this.edges_validate)},Mt.prototype.zip_lverts=null,Mt.prototype.invalidate_lverts=function(){this.invalidate_laxi(),this.invalidate_area_inertia(),this.invalidate_angDrag(),this.invalidate_localCOM(),this.invalidate_gverts(),this.zip_lverts=!0,this.zip_valid=!0,this.zip_sanitation=!0,null!=this.body&&this.body.wake()},Mt.prototype.zip_laxi=null,Mt.prototype.invalidate_laxi=function(){this.invalidate_gaxi(),this.zip_sweepRadius=!0,this.zip_laxi=!0},Mt.prototype.zip_gverts=null,Mt.prototype.invalidate_gverts=function(){this.zip_aabb=!0,null!=this.body&&(this.body.zip_aabb=!0),this.zip_gverts=!0},Mt.prototype.zip_gaxi=null,Mt.prototype.invalidate_gaxi=function(){this.zip_gaxi=!0},Mt.prototype.zip_valid=null,Mt.prototype.validation=null,Mt.prototype.valid=function(){if(this.zip_valid){if(this.zip_valid=!1,this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real()),this.lverts.length<3)return null==oe.ValidationResult_DEGENERATE&&(oe.internal=!0,oe.ValidationResult_DEGENERATE=new qn,oe.internal=!1),this.validation=oe.ValidationResult_DEGENERATE;if(this.validate_lverts(),this.validate_area_inertia(),this.area<o.epsilon)return null==oe.ValidationResult_DEGENERATE&&(oe.internal=!0,oe.ValidationResult_DEGENERATE=new qn,oe.internal=!1),this.validation=oe.ValidationResult_DEGENERATE;var n=!1,e=!1,t=!0,i=this.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r,a,s=i;r=s.x-l.x,a=s.y-l.y;var _;_=l.x-p.x;var h=(l.y-p.y)*r-_*a;if(h>o.epsilon?e=!0:h<-o.epsilon&&(n=!0),e&&n){t=!1;break}p=l,l=s,i=i.next}if(t){for(var u=i=this.lverts.next;;){var x,d;x=u.x-l.x,d=u.y-l.y;var y;y=l.x-p.x;var z=(l.y-p.y)*x-y*d;if(z>o.epsilon?e=!0:z<-o.epsilon&&(n=!0),e&&n){t=!1;break}break}if(t){p=l,l=u;for(var v=i=i.next;;){var c,f;c=v.x-u.x,f=v.y-u.y;var m;m=u.x-p.x;var b=(u.y-p.y)*c-m*f;if(b>o.epsilon?e=!0:b<-o.epsilon&&(n=!0),e&&n)break;break}}}if(e&&n)return null==oe.ValidationResult_CONCAVE&&(oe.internal=!0,oe.ValidationResult_CONCAVE=new qn,oe.internal=!1),this.validation=oe.ValidationResult_CONCAVE;var g=!0,w=!0,M=this.lverts.next,C=M;for(M=M.next;null!=M;){var k=M;if(!g){w=!1;break}var O=!0,P=this.lverts.next,S=P;for(P=P.next;null!=P;){var A=P;if(C!=S&&C!=A&&k!=S&&k!=A){var j,E;j=C.x-S.x,E=C.y-S.y;var I,T;I=k.x-C.x;var N,L,V=(T=k.y-C.y)*(N=A.x-S.x)-I*(L=A.y-S.y);if(V*V>o.epsilon){var D=(L*j-N*E)*(V=1/V);if(D>o.epsilon&&D<1-o.epsilon){var F=(T*j-I*E)*V;if(F>o.epsilon&&F<1-o.epsilon){g=!1,O=!1;break}}}S=A,P=P.next}else S=A,P=P.next}if(O)for(;;){var R=this.lverts.next;if(C==S||C==R||k==S||k==R)break;var Z,B;Z=C.x-S.x,B=C.y-S.y;var G,q;G=k.x-C.x;var U,K,W=(q=k.y-C.y)*(U=R.x-S.x)-G*(K=R.y-S.y);if(W*W>o.epsilon){var Y=(K*Z-U*B)*(W=1/W);if(Y>o.epsilon&&Y<1-o.epsilon){var J=(q*Z-G*B)*W;if(J>o.epsilon&&J<1-o.epsilon){g=!1;break}}}break}C=k,M=M.next}if(w)for(;;){var X=this.lverts.next;if(!g)break;var H=!0,$=this.lverts.next,Q=$;for($=$.next;null!=$;){var nn=$;if(C!=Q&&C!=nn&&X!=Q&&X!=nn){var en,tn;en=C.x-Q.x,tn=C.y-Q.y;var pn,ln;pn=X.x-C.x;var rn,on,an=(ln=X.y-C.y)*(rn=nn.x-Q.x)-pn*(on=nn.y-Q.y);if(an*an>o.epsilon){var sn=(on*en-rn*tn)*(an=1/an);if(sn>o.epsilon&&sn<1-o.epsilon){var _n=(ln*en-pn*tn)*an;if(_n>o.epsilon&&_n<1-o.epsilon){g=!1,H=!1;break}}}Q=nn,$=$.next}else Q=nn,$=$.next}if(H)for(;;){var hn=this.lverts.next;if(C==Q||C==hn||X==Q||X==hn)break;var un,xn;un=C.x-Q.x,xn=C.y-Q.y;var dn,yn;dn=X.x-C.x;var zn,vn,cn=(yn=X.y-C.y)*(zn=hn.x-Q.x)-dn*(vn=hn.y-Q.y);if(cn*cn>o.epsilon){var fn=(vn*un-zn*xn)*(cn=1/cn);if(fn>o.epsilon&&fn<1-o.epsilon){var mn=(yn*un-dn*xn)*cn;if(mn>o.epsilon&&mn<1-o.epsilon){g=!1;break}}}break}break}return g?(null==oe.ValidationResult_VALID&&(oe.internal=!0,oe.ValidationResult_VALID=new qn,oe.internal=!1),this.validation=oe.ValidationResult_VALID):(null==oe.ValidationResult_SELF_INTERSECTING&&(oe.internal=!0,oe.ValidationResult_SELF_INTERSECTING=new qn,oe.internal=!1),this.validation=oe.ValidationResult_SELF_INTERSECTING)}return this.validation},Mt.prototype.validate_lverts=function(){this.zip_lverts&&(this.zip_lverts=!1,this.lverts.length>2&&(this.validate_area_inertia(),this.area<0&&(this.reverse_vertices(),this.area=-this.area)))},Mt.prototype.cleanup_lvert=function(n){for(var e=null,t=null,i=this.lverts.next;null!=i&&i!=n;)e=null==e?this.gverts.next:e.next,t=null==t?this.edges.head:t.next,i=i.next;var p=null==e?this.gverts.next:e.next;this.gverts.erase(e);var l=p;if(null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=xt.zpp_pool,xt.zpp_pool=l,2==this.edgeCnt){var r=this.edges.pop_unsafe(),o=r;o.polygon=null,o.next=wt.zpp_pool,wt.zpp_pool=o;var a=r=this.edges.pop_unsafe();a.polygon=null,a.next=wt.zpp_pool,wt.zpp_pool=a,this.edgeCnt=0}else if(0!=this.edgeCnt){var s=null==t?this.edges.head.elt:t.next.elt;this.edges.erase(t);var _=s;_.polygon=null,_.next=wt.zpp_pool,wt.zpp_pool=_,this.edgeCnt--}},Mt.prototype.zip_sanitation=null,Mt.prototype.splice_collinear=function(){this.zip_sanitation&&(this.zip_sanitation=!1,this.splice_collinear_real())},Mt.prototype.splice_collinear_real=function(){if(null!=this.lverts.next&&null!=this.lverts.next.next&&null!=this.lverts.next.next.next){for(var n=null,e=this.lverts.next;null!=e;){var t,i,p=e,l=null==e.next?this.lverts.next:e.next,r=p.x,a=p.y;(t=r-l.x)*t+(i=a-l.y)*i<o.epsilon*o.epsilon?(this.cleanup_lvert(e),e=this.lverts.erase(n)):(n=e,e=e.next)}if(null!=this.lverts.next)for(var s;;){s=!1;for(var _=this.lverts.next;null!=_;){var h,u,x=null==_.next?this.lverts.next:_.next,d=_,y=x,z=null==x.next?this.lverts.next:x.next;h=y.x-d.x,u=y.y-d.y;var v;v=z.x-y.x;var c=(z.y-y.y)*h-v*u;c*c>=o.epsilon*o.epsilon?_=_.next:(this.cleanup_lvert(x),this.lverts.erase(null==_.next?null:_),s=!0,_=_.next)}if(!s)break}}},Mt.prototype.reverse_vertices=function(){this.lverts.reverse(),this.gverts.reverse(),this.edges.reverse(),this.edges.insert(this.edges.iterator_at(this.edgeCnt-1),this.edges.pop_unsafe()),this.reverse_flag=!this.reverse_flag,null!=this.wrap_lverts&&(this.wrap_lverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_gverts&&(this.wrap_gverts.zpp_inner.reverse_flag=this.reverse_flag),null!=this.wrap_edges&&(this.wrap_edges.zpp_inner.reverse_flag=this.reverse_flag)},Mt.prototype.validate_laxi=function(){if(this.zip_laxi){this.zip_laxi=!1,this.validate_lverts();var n=this.edges.head,e=this.lverts.next,t=e;for(e=e.next;null!=e;){var i=e,p=n.elt;n=n.next,p.lp0=t,p.lp1=i;var l=0,r=0;l=t.x-i.x,r=t.y-i.y;var o=Math.sqrt(l*l+r*r);p.length=o;var a=1/o,s=l*=a;l=-(r*=a),r=s,p.lprojection=l*t.x+r*t.y,p.lnormx=l,p.lnormy=r,null!=p.wrap_lnorm&&(p.wrap_lnorm.zpp_inner.x=l,p.wrap_lnorm.zpp_inner.y=r),t=i,e=e.next}var _=this.lverts.next,h=n.elt;h.lp0=t,h.lp1=_;var u=0,x=0;u=t.x-_.x,x=t.y-_.y;var d=Math.sqrt(u*u+x*x);h.length=d;var y=1/d,z=u*=y;u=-(x*=y),x=z,h.lprojection=u*t.x+x*t.y,h.lnormx=u,h.lnormy=x,null!=h.wrap_lnorm&&(h.wrap_lnorm.zpp_inner.x=u,h.wrap_lnorm.zpp_inner.y=x)}},Mt.prototype.validate_gverts=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,p=e;e=e.next,i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),t=t.next}}},Mt.prototype.validate_gaxi=function(){if(this.zip_gaxi&&null!=this.body){this.zip_gaxi=!1,this.validate_laxi();var n=this.body;if(n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot)),this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var e=this.body;e.zip_axis&&(e.zip_axis=!1,e.axisx=Math.sin(e.rot),e.axisy=Math.cos(e.rot));for(var t=this.lverts.next,i=this.gverts.next;null!=i;){var p=i,l=t;t=t.next,p.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),p.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),i=i.next}}var r=this.edges.head,o=this.gverts.next,a=o;for(o=o.next;null!=o;){var s=o,_=r.elt;r=r.next,_.gp0=a,_.gp1=s,_.gnormx=this.body.axisy*_.lnormx-this.body.axisx*_.lnormy,_.gnormy=_.lnormx*this.body.axisx+_.lnormy*this.body.axisy,_.gprojection=this.body.posx*_.gnormx+this.body.posy*_.gnormy+_.lprojection,null!=_.wrap_gnorm&&(_.wrap_gnorm.zpp_inner.x=_.gnormx,_.wrap_gnorm.zpp_inner.y=_.gnormy),_.tp0=_.gp0.y*_.gnormx-_.gp0.x*_.gnormy,_.tp1=_.gp1.y*_.gnormx-_.gp1.x*_.gnormy,a=s,o=o.next}var h=r.elt;h.gp0=a,h.gp1=this.gverts.next,h.gnormx=this.body.axisy*h.lnormx-this.body.axisx*h.lnormy,h.gnormy=h.lnormx*this.body.axisx+h.lnormy*this.body.axisy,h.gprojection=this.body.posx*h.gnormx+this.body.posy*h.gnormy+h.lprojection,null!=h.wrap_gnorm&&(h.wrap_gnorm.zpp_inner.x=h.gnormx,h.wrap_gnorm.zpp_inner.y=h.gnormy),h.tp0=h.gp0.y*h.gnormx-h.gp0.x*h.gnormy,h.tp1=h.gp1.y*h.gnormx-h.gp1.x*h.gnormy}},Mt.prototype.__validate_aabb=function(){if(this.zip_gverts&&null!=this.body){this.zip_gverts=!1,this.validate_lverts();var n=this.body;n.zip_axis&&(n.zip_axis=!1,n.axisx=Math.sin(n.rot),n.axisy=Math.cos(n.rot));for(var e=this.lverts.next,t=this.gverts.next;null!=t;){var i=t,p=e;e=e.next,i.x=this.body.posx+(this.body.axisy*p.x-this.body.axisx*p.y),i.y=this.body.posy+(p.x*this.body.axisx+p.y*this.body.axisy),t=t.next}}var l=this.gverts.next;this.aabb.minx=l.x,this.aabb.miny=l.y,this.aabb.maxx=l.x,this.aabb.maxy=l.y;for(var r=this.gverts.next.next;null!=r;){var o=r;o.x<this.aabb.minx&&(this.aabb.minx=o.x),o.x>this.aabb.maxx&&(this.aabb.maxx=o.x),o.y<this.aabb.miny&&(this.aabb.miny=o.y),o.y>this.aabb.maxy&&(this.aabb.maxy=o.y),r=r.next}},Mt.prototype._force_validate_aabb=function(){var n=this.lverts.next,e=this.gverts.next,t=n;n=n.next,e.x=this.body.posx+(this.body.axisy*t.x-this.body.axisx*t.y),e.y=this.body.posy+(t.x*this.body.axisx+t.y*this.body.axisy),this.aabb.minx=e.x,this.aabb.miny=e.y,this.aabb.maxx=e.x,this.aabb.maxy=e.y;for(var i=this.gverts.next.next;null!=i;){var p=i,l=n;n=n.next,p.x=this.body.posx+(this.body.axisy*l.x-this.body.axisx*l.y),p.y=this.body.posy+(l.x*this.body.axisx+l.y*this.body.axisy),p.x<this.aabb.minx&&(this.aabb.minx=p.x),p.x>this.aabb.maxx&&(this.aabb.maxx=p.x),p.y<this.aabb.miny&&(this.aabb.miny=p.y),p.y>this.aabb.maxy&&(this.aabb.maxy=p.y),i=i.next}},Mt.prototype.__validate_sweepRadius=function(){var n=0,e=0;this.validate_laxi();for(var t=this.lverts.next;null!=t;){var i=t,p=i.x*i.x+i.y*i.y;p>n&&(n=p),t=t.next}for(var l=this.edges.head;null!=l;){var r=l.elt;if(r.lprojection<e&&(e=r.lprojection)<0)break;l=l.next}e<0&&(e=0),this.sweepRadius=Math.sqrt(n),this.sweepCoef=this.sweepRadius-e},Mt.prototype.__validate_area_inertia=function(){if(null==this.lverts.next||null==this.lverts.next.next||null==this.lverts.next.next.next)this.area=0,this.inertia=0;else{this.area=0;var n=0,e=0,t=this.lverts.next,i=t,p=t=t.next;for(t=t.next;null!=t;){var l=t,r=p.y*i.x-p.x*i.y;n+=r*(p.x*p.x+p.y*p.y+(p.x*i.x+p.y*i.y)+(i.x*i.x+i.y*i.y)),e+=r,this.area+=p.x*(l.y-i.y),i=p,p=l,t=t.next}var o=t=this.lverts.next,a=p.y*i.x-p.x*i.y;n+=a*(p.x*p.x+p.y*p.y+(p.x*i.x+p.y*i.y)+(i.x*i.x+i.y*i.y)),e+=a,this.area+=p.x*(o.y-i.y),i=p,t=t.next;var s=o.y*i.x-o.x*i.y;n+=s*(o.x*o.x+o.y*o.y+(o.x*i.x+o.y*i.y)+(i.x*i.x+i.y*i.y)),e+=s,this.area+=o.x*(t.y-i.y),this.inertia=n/(6*e),this.area*=.5,this.area<0&&(this.area=-this.area,this.reverse_vertices())}},Mt.prototype.__validate_angDrag=function(){this.validate_area_inertia(),this.validate_laxi();for(var n=0,e=this.edges.head,t=0,i=this.lverts.next,p=i,l=i.next;null!=l;){var r=l,a=e.elt;e=e.next,t+=a.length;var s,_;s=r.x-p.x,_=r.y-p.y,n+=a.length*o.fluidAngularDragFriction*this.material.dynamicFriction*a.lprojection*a.lprojection;var h=-(p.y*a.lnormx-p.x*a.lnormy)/(_*a.lnormx-s*a.lnormy);if(h>0){var u=h>1?1:h,x=0,d=0;x=p.x,d=p.y;x+=s*u,d+=_*u;var y=a.lnormy*p.x-a.lnormx*p.y,z=a.lnormy*x-a.lnormx*d;n+=(z*z*z-y*y*y)/(3*(z-y))*u*a.length*o.fluidAngularDrag}if(h<1){var v=h<0?0:h,c=0,f=0;c=p.x,f=p.y;c+=s*v,f+=_*v;var m=a.lnormy*c-a.lnormx*f,b=a.lnormy*r.x-a.lnormx*r.y;n+=(b*b*b-m*m*m)/(3*(b-m))*o.fluidVacuumDrag*(1-v)*a.length*o.fluidAngularDrag}i=l,p=r,l=l.next}for(;;){var g=l=this.lverts.next,w=e.elt;e=e.next,t+=w.length;var M,C;M=g.x-p.x,C=g.y-p.y,n+=w.length*o.fluidAngularDragFriction*this.material.dynamicFriction*w.lprojection*w.lprojection;var k=-(p.y*w.lnormx-p.x*w.lnormy)/(C*w.lnormx-M*w.lnormy);if(k>0){var O=k>1?1:k,P=0,S=0;P=p.x,S=p.y;P+=M*O,S+=C*O;var A=w.lnormy*p.x-w.lnormx*p.y,j=w.lnormy*P-w.lnormx*S;n+=(j*j*j-A*A*A)/(3*(j-A))*O*w.length*o.fluidAngularDrag}if(k<1){var E=k<0?0:k,I=0,T=0;I=p.x,T=p.y;I+=M*E,T+=C*E;var N=w.lnormy*I-w.lnormx*T,L=w.lnormy*g.x-w.lnormx*g.y;n+=(L*L*L-N*N*N)/(3*(L-N))*o.fluidVacuumDrag*(1-E)*w.length*o.fluidAngularDrag}break}this.angDrag=n/(this.inertia*t)},Mt.prototype.__validate_localCOM=function(){if(null==this.lverts.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y;else if(null==this.lverts.next.next.next)this.localCOMx=this.lverts.next.x,this.localCOMy=this.lverts.next.y,this.localCOMx+=this.lverts.next.next.x,this.localCOMy+=this.lverts.next.next.y,this.localCOMx*=.5,this.localCOMy*=.5;else{this.localCOMx=0,this.localCOMy=0;var n=0,e=this.lverts.next,t=e,i=e=e.next;for(e=e.next;null!=e;){var p=e;n+=i.x*(p.y-t.y);var l=p.y*i.x-p.x*i.y;this.localCOMx+=(i.x+p.x)*l,this.localCOMy+=(i.y+p.y)*l,t=i,i=p,e=e.next}var r=e=this.lverts.next;n+=i.x*(r.y-t.y);var o=r.y*i.x-r.x*i.y;this.localCOMx+=(i.x+r.x)*o,this.localCOMy+=(i.y+r.y)*o,t=i;var a=e=e.next;n+=r.x*(a.y-t.y);var s=a.y*r.x-a.x*r.y;this.localCOMx+=(r.x+a.x)*s,this.localCOMy+=(r.y+a.y)*s;var _=n=1/(3*n);this.localCOMx*=_,this.localCOMy*=_}},Mt.prototype.localCOM_validate=function(){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var n=this.polygon;if(null==n.lverts.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y;else if(null==n.lverts.next.next.next)n.localCOMx=n.lverts.next.x,n.localCOMy=n.lverts.next.y,n.localCOMx+=n.lverts.next.next.x,n.localCOMy+=n.lverts.next.next.y,n.localCOMx*=.5,n.localCOMy*=.5;else{n.localCOMx=0,n.localCOMy=0;var e=0,t=n.lverts.next,i=t,p=t=t.next;for(t=t.next;null!=t;){var l=t;e+=p.x*(l.y-i.y);var r=l.y*p.x-l.x*p.y;n.localCOMx+=(p.x+l.x)*r,n.localCOMy+=(p.y+l.y)*r,i=p,p=l,t=t.next}var o=t=n.lverts.next;e+=p.x*(o.y-i.y);var a=o.y*p.x-o.x*p.y;n.localCOMx+=(p.x+o.x)*a,n.localCOMy+=(p.y+o.y)*a,i=p;var s=t=t.next;e+=o.x*(s.y-i.y);var _=s.y*o.x-s.x*o.y;n.localCOMx+=(o.x+s.x)*_,n.localCOMy+=(o.y+s.y)*_;var h=e=1/(3*e);n.localCOMx*=h,n.localCOMy*=h}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}},Mt.prototype.localCOM_invalidate=function(n){if(this.zip_localCOM){if(this.zip_localCOM=!1,1==this.type){var e=this.polygon;if(null==e.lverts.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y;else if(null==e.lverts.next.next.next)e.localCOMx=e.lverts.next.x,e.localCOMy=e.lverts.next.y,e.localCOMx+=e.lverts.next.next.x,e.localCOMy+=e.lverts.next.next.y,e.localCOMx*=.5,e.localCOMy*=.5;else{e.localCOMx=0,e.localCOMy=0;var t=0,i=e.lverts.next,p=i,l=i=i.next;for(i=i.next;null!=i;){var r=i;t+=l.x*(r.y-p.y);var o=r.y*l.x-r.x*l.y;e.localCOMx+=(l.x+r.x)*o,e.localCOMy+=(l.y+r.y)*o,p=l,l=r,i=i.next}var a=i=e.lverts.next;t+=l.x*(a.y-p.y);var s=a.y*l.x-a.x*l.y;e.localCOMx+=(l.x+a.x)*s,e.localCOMy+=(l.y+a.y)*s,p=l;var _=i=i.next;t+=a.x*(_.y-p.y);var h=_.y*a.x-_.x*a.y;e.localCOMx+=(a.x+_.x)*h,e.localCOMy+=(a.y+_.y)*h;var u=t=1/(3*t);e.localCOMx*=u,e.localCOMy*=u}}null!=this.wrap_localCOM&&(this.wrap_localCOM.zpp_inner.x=this.localCOMx,this.wrap_localCOM.zpp_inner.y=this.localCOMy)}var x,d;x=n.x-this.localCOMx,d=n.y-this.localCOMy;for(var y=this.lverts.next;null!=y;){var z=y;z.x+=x,z.y+=d,y=y.next}this.invalidate_lverts()},Mt.prototype.setupLocalCOM=function(){var n,t=this.localCOMx,i=this.localCOMy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_localCOM=n,this.wrap_localCOM.zpp_inner._inuse=!0,this.wrap_localCOM.zpp_inner._validate=e(this,this.localCOM_validate),this.wrap_localCOM.zpp_inner._invalidate=e(this,this.localCOM_invalidate)},Mt.prototype.__translate=function(n,e){for(var t=this.lverts.next;null!=t;){var i=t;i.x+=n,i.y+=e,t=t.next}this.invalidate_lverts()},Mt.prototype.__scale=function(n,e){for(var t=this.lverts.next;null!=t;){var i=t;i.x*=n,i.y*=e,t=t.next}this.invalidate_lverts()},Mt.prototype.__rotate=function(n,e){for(var t=this.lverts.next;null!=t;){var i,p,l=t;i=e*l.x-n*l.y,p=l.x*n+l.y*e,l.x=i,l.y=p,t=t.next}this.invalidate_lverts()},Mt.prototype.__transform=function(n){for(var e=this.lverts.next;null!=e;){var t=e,i=n.zpp_inner.a*t.x+n.zpp_inner.b*t.y+n.zpp_inner.tx;t.y=n.zpp_inner.c*t.x+n.zpp_inner.d*t.y+n.zpp_inner.ty,t.x=i,e=e.next}this.invalidate_lverts()},Mt.prototype.__copy=function(){var n=this.outer_zn;return null==n.zpp_inner_zn.wrap_lverts&&n.zpp_inner_zn.getlverts(),new Rn(n.zpp_inner_zn.wrap_lverts).zpp_inner_zn},Mt.prototype.__class__=Mt;var Ct=zpp_nape.space.ZPP_Broadphase=function(){this.circShape=null,this.matrix=null,this.aabbShape=null,this.dynab=null,this.sweep=null,this.is_sweep=!1,this.space=null};Ct.__name__=["zpp_nape","space","ZPP_Broadphase"],Ct.prototype.space=null,Ct.prototype.is_sweep=null,Ct.prototype.sweep=null,Ct.prototype.dynab=null,Ct.prototype.insert=function(n){this.is_sweep?this.sweep.__insert(n):this.dynab.__insert(n)},Ct.prototype.remove=function(n){this.is_sweep?this.sweep.__remove(n):this.dynab.__remove(n)},Ct.prototype.sync=function(n){if(this.is_sweep){if(!this.sweep.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var t=e.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0,t.localCOMy=0;var i=0,p=t.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;t.localCOMx+=(r.x+o.x)*a,t.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=t.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*_,t.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);var u=h.y*s.x-h.x*s.y;t.localCOMx+=(s.x+h.x)*u,t.localCOMy+=(s.y+h.y)*u;var x=i=1/(3*i);t.localCOMx*=x,t.localCOMy*=x}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var y=e.radius,z=e.radius;e.aabb.minx=e.worldCOMx-y,e.aabb.miny=e.worldCOMy-z,e.aabb.maxx=e.worldCOMx+y,e.aabb.maxy=e.worldCOMy+z}else{var v=n.polygon;if(v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var c=v.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var f=v.lverts.next,m=v.gverts.next;null!=m;){var b=m,g=f;f=f.next,b.x=v.body.posx+(v.body.axisy*g.x-v.body.axisx*g.y),b.y=v.body.posy+(g.x*v.body.axisx+g.y*v.body.axisy),m=m.next}}var w=v.gverts.next;v.aabb.minx=w.x,v.aabb.miny=w.y,v.aabb.maxx=w.x,v.aabb.maxy=w.y;for(var M=v.gverts.next.next;null!=M;){var C=M;C.x<v.aabb.minx&&(v.aabb.minx=C.x),C.x>v.aabb.maxx&&(v.aabb.maxx=C.x),C.y<v.aabb.miny&&(v.aabb.miny=C.y),C.y>v.aabb.maxy&&(v.aabb.maxy=C.y),M=M.next}}}else{var k=this.dynab,O=n.node;if(!O.synced){if(!k.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var P=n.circle;if(P.zip_worldCOM&&null!=P.body){if(P.zip_worldCOM=!1,P.zip_localCOM){if(P.zip_localCOM=!1,1==P.type){var S=P.polygon;if(null==S.lverts.next.next)S.localCOMx=S.lverts.next.x,S.localCOMy=S.lverts.next.y;else if(null==S.lverts.next.next.next)S.localCOMx=S.lverts.next.x,S.localCOMy=S.lverts.next.y,S.localCOMx+=S.lverts.next.next.x,S.localCOMy+=S.lverts.next.next.y,S.localCOMx*=.5,S.localCOMy*=.5;else{S.localCOMx=0,S.localCOMy=0;var A=0,j=S.lverts.next,E=j,I=j=j.next;for(j=j.next;null!=j;){var T=j;A+=I.x*(T.y-E.y);var N=T.y*I.x-T.x*I.y;S.localCOMx+=(I.x+T.x)*N,S.localCOMy+=(I.y+T.y)*N,E=I,I=T,j=j.next}var L=j=S.lverts.next;A+=I.x*(L.y-E.y);var V=L.y*I.x-L.x*I.y;S.localCOMx+=(I.x+L.x)*V,S.localCOMy+=(I.y+L.y)*V,E=I;var D=j=j.next;A+=L.x*(D.y-E.y);var F=D.y*L.x-D.x*L.y;S.localCOMx+=(L.x+D.x)*F,S.localCOMy+=(L.y+D.y)*F;var R=A=1/(3*A);S.localCOMx*=R,S.localCOMy*=R}}null!=P.wrap_localCOM&&(P.wrap_localCOM.zpp_inner.x=P.localCOMx,P.wrap_localCOM.zpp_inner.y=P.localCOMy)}var Z=P.body;Z.zip_axis&&(Z.zip_axis=!1,Z.axisx=Math.sin(Z.rot),Z.axisy=Math.cos(Z.rot)),P.worldCOMx=P.body.posx+(P.body.axisy*P.localCOMx-P.body.axisx*P.localCOMy),P.worldCOMy=P.body.posy+(P.localCOMx*P.body.axisx+P.localCOMy*P.body.axisy)}var B=P.radius,G=P.radius;P.aabb.minx=P.worldCOMx-B,P.aabb.miny=P.worldCOMy-G,P.aabb.maxx=P.worldCOMx+B,P.aabb.maxy=P.worldCOMy+G}else{var q=n.polygon;if(q.zip_gverts&&null!=q.body){q.zip_gverts=!1,q.validate_lverts();var U=q.body;U.zip_axis&&(U.zip_axis=!1,U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot));for(var K=q.lverts.next,W=q.gverts.next;null!=W;){var Y=W,J=K;K=K.next,Y.x=q.body.posx+(q.body.axisy*J.x-q.body.axisx*J.y),Y.y=q.body.posy+(J.x*q.body.axisx+J.y*q.body.axisy),W=W.next}}var X=q.gverts.next;q.aabb.minx=X.x,q.aabb.miny=X.y,q.aabb.maxx=X.x,q.aabb.maxy=X.y;for(var H=q.gverts.next.next;null!=H;){var $=H;$.x<q.aabb.minx&&(q.aabb.minx=$.x),$.x>q.aabb.maxx&&(q.aabb.maxx=$.x),$.y<q.aabb.miny&&(q.aabb.miny=$.y),$.y>q.aabb.maxy&&(q.aabb.maxy=$.y),H=H.next}}var Q;if(O.dyn==(1!=n.body.type&&!n.body.component.sleeping)){var nn=O.aabb,en=n.aabb;Q=!(en.minx>=nn.minx&&en.miny>=nn.miny&&en.maxx<=nn.maxx&&en.maxy<=nn.maxy)}else Q=!0;Q&&(O.synced=!0,O.snext=k.syncs,k.syncs=O)}}},Ct.prototype.broadphase=function(n,e){},Ct.prototype.clear=function(){},Ct.prototype.shapesUnderPoint=function(n,e,t,i){return null},Ct.prototype.bodiesUnderPoint=function(n,e,t,i){return null},Ct.prototype.aabbShape=null,Ct.prototype.matrix=null,Ct.prototype.updateAABBShape=function(n){if(null==this.aabbShape){null==oe.BodyType_STATIC&&(oe.internal=!0,oe.BodyType_STATIC=new Mn,oe.internal=!1);var e=new bn(oe.BodyType_STATIC).zpp_inner.wrap_shapes,t=this.aabbShape=new Rn(Rn.rect(n.minx,n.miny,n.maxx-n.minx,n.maxy-n.miny));e.zpp_inner.reverse_flag?e.push(t):e.unshift(t)}else{var i=this.aabbShape.zpp_inner.aabb,p=(n.maxx-n.minx)/(i.maxx-i.minx),l=(n.maxy-n.miny)/(i.maxy-i.miny);null==this.matrix&&(this.matrix=new sn);var r=this.matrix;r.zpp_inner.a=p;var o=r.zpp_inner;null!=o._invalidate&&o._invalidate();var a=this.matrix,s=this.matrix;s.zpp_inner.c=0;var _=s.zpp_inner;null!=_._invalidate&&_._invalidate(),a.zpp_inner.b=s.zpp_inner.c;var h=a.zpp_inner;null!=h._invalidate&&h._invalidate();var u=this.matrix;u.zpp_inner.d=l;var x=u.zpp_inner;null!=x._invalidate&&x._invalidate();var d=this.matrix;d.zpp_inner.tx=n.minx-p*i.minx;var y=d.zpp_inner;null!=y._invalidate&&y._invalidate();var z=this.matrix;z.zpp_inner.ty=n.miny-l*i.miny;var v=z.zpp_inner;null!=v._invalidate&&v._invalidate(),this.aabbShape.transform(this.matrix)}var c=this.aabbShape.zpp_inner;if(c.zip_aabb&&null!=c.body)if(c.zip_aabb=!1,0==c.type){var f=c.circle;if(f.zip_worldCOM&&null!=f.body){if(f.zip_worldCOM=!1,f.zip_localCOM){if(f.zip_localCOM=!1,1==f.type){var m=f.polygon;if(null==m.lverts.next.next)m.localCOMx=m.lverts.next.x,m.localCOMy=m.lverts.next.y;else if(null==m.lverts.next.next.next)m.localCOMx=m.lverts.next.x,m.localCOMy=m.lverts.next.y,m.localCOMx+=m.lverts.next.next.x,m.localCOMy+=m.lverts.next.next.y,m.localCOMx*=.5,m.localCOMy*=.5;else{m.localCOMx=0,m.localCOMy=0;var b=0,g=m.lverts.next,w=g,M=g=g.next;for(g=g.next;null!=g;){var C=g;b+=M.x*(C.y-w.y);var k=C.y*M.x-C.x*M.y;m.localCOMx+=(M.x+C.x)*k,m.localCOMy+=(M.y+C.y)*k,w=M,M=C,g=g.next}var O=g=m.lverts.next;b+=M.x*(O.y-w.y);var P=O.y*M.x-O.x*M.y;m.localCOMx+=(M.x+O.x)*P,m.localCOMy+=(M.y+O.y)*P,w=M;var S=g=g.next;b+=O.x*(S.y-w.y);var A=S.y*O.x-S.x*O.y;m.localCOMx+=(O.x+S.x)*A,m.localCOMy+=(O.y+S.y)*A;var j=b=1/(3*b);m.localCOMx*=j,m.localCOMy*=j}}null!=f.wrap_localCOM&&(f.wrap_localCOM.zpp_inner.x=f.localCOMx,f.wrap_localCOM.zpp_inner.y=f.localCOMy)}var E=f.body;E.zip_axis&&(E.zip_axis=!1,E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot)),f.worldCOMx=f.body.posx+(f.body.axisy*f.localCOMx-f.body.axisx*f.localCOMy),f.worldCOMy=f.body.posy+(f.localCOMx*f.body.axisx+f.localCOMy*f.body.axisy)}var I=f.radius,T=f.radius;f.aabb.minx=f.worldCOMx-I,f.aabb.miny=f.worldCOMy-T,f.aabb.maxx=f.worldCOMx+I,f.aabb.maxy=f.worldCOMy+T}else{var N=c.polygon;if(N.zip_gverts&&null!=N.body){N.zip_gverts=!1,N.validate_lverts();var L=N.body;L.zip_axis&&(L.zip_axis=!1,L.axisx=Math.sin(L.rot),L.axisy=Math.cos(L.rot));for(var V=N.lverts.next,D=N.gverts.next;null!=D;){var F=D,R=V;V=V.next,F.x=N.body.posx+(N.body.axisy*R.x-N.body.axisx*R.y),F.y=N.body.posy+(R.x*N.body.axisx+R.y*N.body.axisy),D=D.next}}var Z=N.gverts.next;N.aabb.minx=Z.x,N.aabb.miny=Z.y,N.aabb.maxx=Z.x,N.aabb.maxy=Z.y;for(var B=N.gverts.next.next;null!=B;){var G=B;G.x<N.aabb.minx&&(N.aabb.minx=G.x),G.x>N.aabb.maxx&&(N.aabb.maxx=G.x),G.y<N.aabb.miny&&(N.aabb.miny=G.y),G.y>N.aabb.maxy&&(N.aabb.maxy=G.y),B=B.next}}var q=this.aabbShape.zpp_inner.polygon;if(q.zip_gaxi&&null!=q.body){q.zip_gaxi=!1,q.validate_laxi();var U=q.body;if(U.zip_axis&&(U.zip_axis=!1,U.axisx=Math.sin(U.rot),U.axisy=Math.cos(U.rot)),q.zip_gverts&&null!=q.body){q.zip_gverts=!1,q.validate_lverts();var K=q.body;K.zip_axis&&(K.zip_axis=!1,K.axisx=Math.sin(K.rot),K.axisy=Math.cos(K.rot));for(var W=q.lverts.next,Y=q.gverts.next;null!=Y;){var J=Y,X=W;W=W.next,J.x=q.body.posx+(q.body.axisy*X.x-q.body.axisx*X.y),J.y=q.body.posy+(X.x*q.body.axisx+X.y*q.body.axisy),Y=Y.next}}var H=q.edges.head,$=q.gverts.next,Q=$;for($=$.next;null!=$;){var nn=$,en=H.elt;H=H.next,en.gp0=Q,en.gp1=nn,en.gnormx=q.body.axisy*en.lnormx-q.body.axisx*en.lnormy,en.gnormy=en.lnormx*q.body.axisx+en.lnormy*q.body.axisy,en.gprojection=q.body.posx*en.gnormx+q.body.posy*en.gnormy+en.lprojection,null!=en.wrap_gnorm&&(en.wrap_gnorm.zpp_inner.x=en.gnormx,en.wrap_gnorm.zpp_inner.y=en.gnormy),en.tp0=en.gp0.y*en.gnormx-en.gp0.x*en.gnormy,en.tp1=en.gp1.y*en.gnormx-en.gp1.x*en.gnormy,Q=nn,$=$.next}var tn=H.elt;tn.gp0=Q,tn.gp1=q.gverts.next,tn.gnormx=q.body.axisy*tn.lnormx-q.body.axisx*tn.lnormy,tn.gnormy=tn.lnormx*q.body.axisx+tn.lnormy*q.body.axisy,tn.gprojection=q.body.posx*tn.gnormx+q.body.posy*tn.gnormy+tn.lprojection,null!=tn.wrap_gnorm&&(tn.wrap_gnorm.zpp_inner.x=tn.gnormx,tn.wrap_gnorm.zpp_inner.y=tn.gnormy),tn.tp0=tn.gp0.y*tn.gnormx-tn.gp0.x*tn.gnormy,tn.tp1=tn.gp1.y*tn.gnormx-tn.gp1.x*tn.gnormy}},Ct.prototype.shapesInAABB=function(n,e,t,i,p){return null},Ct.prototype.bodiesInAABB=function(n,e,t,i,p){return null},Ct.prototype.circShape=null,Ct.prototype.updateCircShape=function(n,e,t){if(null==this.circShape){null==oe.BodyType_STATIC&&(oe.internal=!0,oe.BodyType_STATIC=new Mn,oe.internal=!1);var i,p=new bn(oe.BodyType_STATIC).zpp_inner.wrap_shapes;if(null==xp.poolVec2?i=new yn:(i=xp.poolVec2,xp.poolVec2=i.zpp_pool,i.zpp_pool=null),null==i.zpp_inner){var l;null==xt.zpp_pool?l=new xt:(l=xt.zpp_pool,xt.zpp_pool=l.next,l.next=null),l.weak=!1,l._immutable=!1,l.x=n,l.y=e,i.zpp_inner=l,i.zpp_inner.outer=i}else{var r,o=i.zpp_inner;if(null!=o._validate&&o._validate(),i.zpp_inner.x==n){var a=i.zpp_inner;null!=a._validate&&a._validate(),r=i.zpp_inner.y==e}else r=!1;if(!r){i.zpp_inner.x=n,i.zpp_inner.y=e;var s=i.zpp_inner;null!=s._invalidate&&s._invalidate(s)}}i.zpp_inner.weak=!1;var _=this.circShape=new Ln(t,i);p.zpp_inner.reverse_flag?p.push(_):p.unshift(_)}else{var h=this.circShape.zpp_inner.circle,u=t/h.radius;null==this.matrix&&(this.matrix=new sn);var x=this.matrix,d=this.matrix;d.zpp_inner.d=u;var y=d.zpp_inner;null!=y._invalidate&&y._invalidate(),x.zpp_inner.a=d.zpp_inner.d;var z=x.zpp_inner;null!=z._invalidate&&z._invalidate();var v=this.matrix,c=this.matrix;c.zpp_inner.c=0;var f=c.zpp_inner;null!=f._invalidate&&f._invalidate(),v.zpp_inner.b=c.zpp_inner.c;var m=v.zpp_inner;null!=m._invalidate&&m._invalidate();var b=this.matrix;b.zpp_inner.tx=n-u*h.localCOMx;var g=b.zpp_inner;null!=g._invalidate&&g._invalidate();var w=this.matrix;w.zpp_inner.ty=e-u*h.localCOMy;var M=w.zpp_inner;null!=M._invalidate&&M._invalidate(),this.circShape.transform(this.matrix)}var C=this.circShape.zpp_inner;if(C.zip_aabb&&null!=C.body)if(C.zip_aabb=!1,0==C.type){var k=C.circle;if(k.zip_worldCOM&&null!=k.body){if(k.zip_worldCOM=!1,k.zip_localCOM){if(k.zip_localCOM=!1,1==k.type){var O=k.polygon;if(null==O.lverts.next.next)O.localCOMx=O.lverts.next.x,O.localCOMy=O.lverts.next.y;else if(null==O.lverts.next.next.next)O.localCOMx=O.lverts.next.x,O.localCOMy=O.lverts.next.y,O.localCOMx+=O.lverts.next.next.x,O.localCOMy+=O.lverts.next.next.y,O.localCOMx*=.5,O.localCOMy*=.5;else{O.localCOMx=0,O.localCOMy=0;var P=0,S=O.lverts.next,A=S,j=S=S.next;for(S=S.next;null!=S;){var E=S;P+=j.x*(E.y-A.y);var I=E.y*j.x-E.x*j.y;O.localCOMx+=(j.x+E.x)*I,O.localCOMy+=(j.y+E.y)*I,A=j,j=E,S=S.next}var T=S=O.lverts.next;P+=j.x*(T.y-A.y);var N=T.y*j.x-T.x*j.y;O.localCOMx+=(j.x+T.x)*N,O.localCOMy+=(j.y+T.y)*N,A=j;var L=S=S.next;P+=T.x*(L.y-A.y);var V=L.y*T.x-L.x*T.y;O.localCOMx+=(T.x+L.x)*V,O.localCOMy+=(T.y+L.y)*V;var D=P=1/(3*P);O.localCOMx*=D,O.localCOMy*=D}}null!=k.wrap_localCOM&&(k.wrap_localCOM.zpp_inner.x=k.localCOMx,k.wrap_localCOM.zpp_inner.y=k.localCOMy)}var F=k.body;F.zip_axis&&(F.zip_axis=!1,F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot)),k.worldCOMx=k.body.posx+(k.body.axisy*k.localCOMx-k.body.axisx*k.localCOMy),k.worldCOMy=k.body.posy+(k.localCOMx*k.body.axisx+k.localCOMy*k.body.axisy)}var R=k.radius,Z=k.radius;k.aabb.minx=k.worldCOMx-R,k.aabb.miny=k.worldCOMy-Z,k.aabb.maxx=k.worldCOMx+R,k.aabb.maxy=k.worldCOMy+Z}else{var B=C.polygon;if(B.zip_gverts&&null!=B.body){B.zip_gverts=!1,B.validate_lverts();var G=B.body;G.zip_axis&&(G.zip_axis=!1,G.axisx=Math.sin(G.rot),G.axisy=Math.cos(G.rot));for(var q=B.lverts.next,U=B.gverts.next;null!=U;){var K=U,W=q;q=q.next,K.x=B.body.posx+(B.body.axisy*W.x-B.body.axisx*W.y),K.y=B.body.posy+(W.x*B.body.axisx+W.y*B.body.axisy),U=U.next}}var Y=B.gverts.next;B.aabb.minx=Y.x,B.aabb.miny=Y.y,B.aabb.maxx=Y.x,B.aabb.maxy=Y.y;for(var J=B.gverts.next.next;null!=J;){var X=J;X.x<B.aabb.minx&&(B.aabb.minx=X.x),X.x>B.aabb.maxx&&(B.aabb.maxx=X.x),X.y<B.aabb.miny&&(B.aabb.miny=X.y),X.y>B.aabb.maxy&&(B.aabb.maxy=X.y),J=J.next}}},Ct.prototype.shapesInCircle=function(n,e,t,i,p,l){return null},Ct.prototype.bodiesInCircle=function(n,e,t,i,p,l){return null},Ct.prototype.validateShape=function(n){if(1==n.type){var e=n.polygon;if(e.zip_gaxi&&null!=e.body){e.zip_gaxi=!1,e.validate_laxi();var t=e.body;if(t.zip_axis&&(t.zip_axis=!1,t.axisx=Math.sin(t.rot),t.axisy=Math.cos(t.rot)),e.zip_gverts&&null!=e.body){e.zip_gverts=!1,e.validate_lverts();var i=e.body;i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot));for(var p=e.lverts.next,l=e.gverts.next;null!=l;){var r=l,o=p;p=p.next,r.x=e.body.posx+(e.body.axisy*o.x-e.body.axisx*o.y),r.y=e.body.posy+(o.x*e.body.axisx+o.y*e.body.axisy),l=l.next}}var a=e.edges.head,s=e.gverts.next,_=s;for(s=s.next;null!=s;){var h=s,u=a.elt;a=a.next,u.gp0=_,u.gp1=h,u.gnormx=e.body.axisy*u.lnormx-e.body.axisx*u.lnormy,u.gnormy=u.lnormx*e.body.axisx+u.lnormy*e.body.axisy,u.gprojection=e.body.posx*u.gnormx+e.body.posy*u.gnormy+u.lprojection,null!=u.wrap_gnorm&&(u.wrap_gnorm.zpp_inner.x=u.gnormx,u.wrap_gnorm.zpp_inner.y=u.gnormy),u.tp0=u.gp0.y*u.gnormx-u.gp0.x*u.gnormy,u.tp1=u.gp1.y*u.gnormx-u.gp1.x*u.gnormy,_=h,s=s.next}var x=a.elt;x.gp0=_,x.gp1=e.gverts.next,x.gnormx=e.body.axisy*x.lnormx-e.body.axisx*x.lnormy,x.gnormy=x.lnormx*e.body.axisx+x.lnormy*e.body.axisy,x.gprojection=e.body.posx*x.gnormx+e.body.posy*x.gnormy+x.lprojection,null!=x.wrap_gnorm&&(x.wrap_gnorm.zpp_inner.x=x.gnormx,x.wrap_gnorm.zpp_inner.y=x.gnormy),x.tp0=x.gp0.y*x.gnormx-x.gp0.x*x.gnormy,x.tp1=x.gp1.y*x.gnormx-x.gp1.x*x.gnormy}}if(n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var d=n.circle;if(d.zip_worldCOM&&null!=d.body){if(d.zip_worldCOM=!1,d.zip_localCOM){if(d.zip_localCOM=!1,1==d.type){var y=d.polygon;if(null==y.lverts.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y;else if(null==y.lverts.next.next.next)y.localCOMx=y.lverts.next.x,y.localCOMy=y.lverts.next.y,y.localCOMx+=y.lverts.next.next.x,y.localCOMy+=y.lverts.next.next.y,y.localCOMx*=.5,y.localCOMy*=.5;else{y.localCOMx=0,y.localCOMy=0;var z=0,v=y.lverts.next,c=v,f=v=v.next;for(v=v.next;null!=v;){var m=v;z+=f.x*(m.y-c.y);var b=m.y*f.x-m.x*f.y;y.localCOMx+=(f.x+m.x)*b,y.localCOMy+=(f.y+m.y)*b,c=f,f=m,v=v.next}var g=v=y.lverts.next;z+=f.x*(g.y-c.y);var w=g.y*f.x-g.x*f.y;y.localCOMx+=(f.x+g.x)*w,y.localCOMy+=(f.y+g.y)*w,c=f;var M=v=v.next;z+=g.x*(M.y-c.y);var C=M.y*g.x-M.x*g.y;y.localCOMx+=(g.x+M.x)*C,y.localCOMy+=(g.y+M.y)*C;var k=z=1/(3*z);y.localCOMx*=k,y.localCOMy*=k}}null!=d.wrap_localCOM&&(d.wrap_localCOM.zpp_inner.x=d.localCOMx,d.wrap_localCOM.zpp_inner.y=d.localCOMy)}var O=d.body;O.zip_axis&&(O.zip_axis=!1,O.axisx=Math.sin(O.rot),O.axisy=Math.cos(O.rot)),d.worldCOMx=d.body.posx+(d.body.axisy*d.localCOMx-d.body.axisx*d.localCOMy),d.worldCOMy=d.body.posy+(d.localCOMx*d.body.axisx+d.localCOMy*d.body.axisy)}var P=d.radius,S=d.radius;d.aabb.minx=d.worldCOMx-P,d.aabb.miny=d.worldCOMy-S,d.aabb.maxx=d.worldCOMx+P,d.aabb.maxy=d.worldCOMy+S}else{var A=n.polygon;if(A.zip_gverts&&null!=A.body){A.zip_gverts=!1,A.validate_lverts();var j=A.body;j.zip_axis&&(j.zip_axis=!1,j.axisx=Math.sin(j.rot),j.axisy=Math.cos(j.rot));for(var E=A.lverts.next,I=A.gverts.next;null!=I;){var T=I,N=E;E=E.next,T.x=A.body.posx+(A.body.axisy*N.x-A.body.axisx*N.y),T.y=A.body.posy+(N.x*A.body.axisx+N.y*A.body.axisy),I=I.next}}var L=A.gverts.next;A.aabb.minx=L.x,A.aabb.miny=L.y,A.aabb.maxx=L.x,A.aabb.maxy=L.y;for(var V=A.gverts.next.next;null!=V;){var D=V;D.x<A.aabb.minx&&(A.aabb.minx=D.x),D.x>A.aabb.maxx&&(A.aabb.maxx=D.x),D.y<A.aabb.miny&&(A.aabb.miny=D.y),D.y>A.aabb.maxy&&(A.aabb.maxy=D.y),V=V.next}}if(n.zip_worldCOM&&null!=n.body){if(n.zip_worldCOM=!1,n.zip_localCOM){if(n.zip_localCOM=!1,1==n.type){var F=n.polygon;if(null==F.lverts.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y;else if(null==F.lverts.next.next.next)F.localCOMx=F.lverts.next.x,F.localCOMy=F.lverts.next.y,F.localCOMx+=F.lverts.next.next.x,F.localCOMy+=F.lverts.next.next.y,F.localCOMx*=.5,F.localCOMy*=.5;else{F.localCOMx=0,F.localCOMy=0;var R=0,Z=F.lverts.next,B=Z,G=Z=Z.next;for(Z=Z.next;null!=Z;){var q=Z;R+=G.x*(q.y-B.y);var U=q.y*G.x-q.x*G.y;F.localCOMx+=(G.x+q.x)*U,F.localCOMy+=(G.y+q.y)*U,B=G,G=q,Z=Z.next}var K=Z=F.lverts.next;R+=G.x*(K.y-B.y);var W=K.y*G.x-K.x*G.y;F.localCOMx+=(G.x+K.x)*W,F.localCOMy+=(G.y+K.y)*W,B=G;var Y=Z=Z.next;R+=K.x*(Y.y-B.y);var J=Y.y*K.x-Y.x*K.y;F.localCOMx+=(K.x+Y.x)*J,F.localCOMy+=(K.y+Y.y)*J;var X=R=1/(3*R);F.localCOMx*=X,F.localCOMy*=X}}null!=n.wrap_localCOM&&(n.wrap_localCOM.zpp_inner.x=n.localCOMx,n.wrap_localCOM.zpp_inner.y=n.localCOMy)}var H=n.body;H.zip_axis&&(H.zip_axis=!1,H.axisx=Math.sin(H.rot),H.axisy=Math.cos(H.rot)),n.worldCOMx=n.body.posx+(n.body.axisy*n.localCOMx-n.body.axisx*n.localCOMy),n.worldCOMy=n.body.posy+(n.localCOMx*n.body.axisx+n.localCOMy*n.body.axisy)}},Ct.prototype.shapesInShape=function(n,e,t,i){return null},Ct.prototype.bodiesInShape=function(n,e,t,i){return null},Ct.prototype.rayCast=function(n,e,t){return null},Ct.prototype.rayMultiCast=function(n,e,t,i){return null},Ct.prototype.__class__=Ct;var kt=zpp_nape.space.ZPP_AABBNode=function(){this.first_sync=!1,this.synced=!1,this.snext=null,this.moved=!1,this.mnext=null,this.next=null,this.rayt=0,this.height=0,this.child2=null,this.child1=null,this.parent=null,this.dyn=!1,this.shape=null,this.aabb=null,this.height=-1};kt.__name__=["zpp_nape","space","ZPP_AABBNode"],kt.prototype.aabb=null,kt.prototype.shape=null,kt.prototype.dyn=null,kt.prototype.parent=null,kt.prototype.child1=null,kt.prototype.child2=null,kt.prototype.height=null,kt.prototype.rayt=null,kt.prototype.next=null,kt.prototype.alloc=function(){null==Te.zpp_pool?this.aabb=new Te:(this.aabb=Te.zpp_pool,Te.zpp_pool=this.aabb.next,this.aabb.next=null),this.moved=!1,this.synced=!1,this.first_sync=!1},kt.prototype.free=function(){this.height=-1;var n=this.aabb;null!=n.outer&&(n.outer.zpp_inner=null,n.outer=null),n.wrap_min=n.wrap_max=null,n._invalidate=null,n._validate=null,n.next=Te.zpp_pool,Te.zpp_pool=n,this.child1=this.child2=this.parent=null,this.next=null,this.snext=null,this.mnext=null},kt.prototype.mnext=null,kt.prototype.moved=null,kt.prototype.snext=null,kt.prototype.synced=null,kt.prototype.first_sync=null,kt.prototype.isLeaf=function(){return null==this.child1},kt.prototype.__class__=kt;var Ot=zpp_nape.space.ZPP_AABBPair=function(){this.next=null,this.arb=null,this.di=0,this.id=0,this.sleeping=!1,this.first=!1,this.n2=null,this.n1=null};Ot.__name__=["zpp_nape","space","ZPP_AABBPair"],Ot.prototype.n1=null,Ot.prototype.n2=null,Ot.prototype.first=null,Ot.prototype.sleeping=null,Ot.prototype.id=null,Ot.prototype.di=null,Ot.prototype.arb=null,Ot.prototype.next=null,Ot.prototype.alloc=function(){},Ot.prototype.free=function(){this.n1=this.n2=null,this.sleeping=!1},Ot.prototype.__class__=Ot;var Pt=zpp_nape.space.ZPP_AABBTree=function(){this.root=null};Pt.__name__=["zpp_nape","space","ZPP_AABBTree"],Pt.prototype.root=null,Pt.prototype.clear=function(){if(null!=this.root){var n=null;for(this.root.next=n,n=this.root;null!=n;){var e=n;n=e.next,e.next=null,null==e.child1?(e.shape.node=null,e.shape.removedFromSpace(),e.shape=null):(null!=e.child1&&(e.child1.next=n,n=e.child1),null!=e.child2&&(e.child2.next=n,n=e.child2)),e.height=-1;var t=e.aabb;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t.wrap_min=t.wrap_max=null,t._invalidate=null,t._validate=null,t.next=Te.zpp_pool,Te.zpp_pool=t,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=kt.zpp_pool,kt.zpp_pool=e}this.root=null}},Pt.prototype.insertLeaf=function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var e=n.aabb,t=this.root;null!=t.child1;){var i=t.child1,p=t.child2,l=t.aabb,r=2*(l.maxx-l.minx+(l.maxy-l.miny)),o=Pt.tmpaabb,a=t.aabb;o.minx=a.minx<e.minx?a.minx:e.minx,o.miny=a.miny<e.miny?a.miny:e.miny,o.maxx=a.maxx>e.maxx?a.maxx:e.maxx,o.maxy=a.maxy>e.maxy?a.maxy:e.maxy;var s,_=Pt.tmpaabb,h=2*(_.maxx-_.minx+(_.maxy-_.miny)),u=2*h,x=2*(h-r),d=Pt.tmpaabb,y=i.aabb;if(d.minx=e.minx<y.minx?e.minx:y.minx,d.miny=e.miny<y.miny?e.miny:y.miny,d.maxx=e.maxx>y.maxx?e.maxx:y.maxx,d.maxy=e.maxy>y.maxy?e.maxy:y.maxy,null==i.child1){var z=Pt.tmpaabb;s=2*(z.maxx-z.minx+(z.maxy-z.miny))+x}else{var v=i.aabb,c=2*(v.maxx-v.minx+(v.maxy-v.miny)),f=Pt.tmpaabb;s=2*(f.maxx-f.minx+(f.maxy-f.miny))-c+x}var m,b=Pt.tmpaabb,g=p.aabb;if(b.minx=e.minx<g.minx?e.minx:g.minx,b.miny=e.miny<g.miny?e.miny:g.miny,b.maxx=e.maxx>g.maxx?e.maxx:g.maxx,b.maxy=e.maxy>g.maxy?e.maxy:g.maxy,null==p.child1){var w=Pt.tmpaabb;m=2*(w.maxx-w.minx+(w.maxy-w.miny))+x}else{var M=p.aabb,C=2*(M.maxx-M.minx+(M.maxy-M.miny)),k=Pt.tmpaabb;m=2*(k.maxx-k.minx+(k.maxy-k.miny))-C+x}if(u<s&&u<m)break;t=s<m?i:p}var O,P=t,S=P.parent;null==kt.zpp_pool?O=new kt:(O=kt.zpp_pool,kt.zpp_pool=O.next,O.next=null),null==Te.zpp_pool?O.aabb=new Te:(O.aabb=Te.zpp_pool,Te.zpp_pool=O.aabb.next,O.aabb.next=null),O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=S;var A=O.aabb,j=P.aabb;for(A.minx=e.minx<j.minx?e.minx:j.minx,A.miny=e.miny<j.miny?e.miny:j.miny,A.maxx=e.maxx>j.maxx?e.maxx:j.maxx,A.maxy=e.maxy>j.maxy?e.maxy:j.maxy,O.height=P.height+1,null!=S?(S.child1==P?S.child1=O:S.child2=O,O.child1=P,O.child2=n,P.parent=O,n.parent=O):(O.child1=P,O.child2=n,P.parent=O,n.parent=O,this.root=O),t=n.parent;null!=t;){if(null==t.child1||t.height<2)t=t;else{var E=t.child1,I=t.child2,T=I.height-E.height;if(T>1){var N=I.child1,L=I.child2;if(I.child1=t,I.parent=t.parent,t.parent=I,null!=I.parent?I.parent.child1==t?I.parent.child1=I:I.parent.child2=I:this.root=I,N.height>L.height){I.child2=N,t.child2=L,L.parent=t;var V=t.aabb,D=E.aabb,F=L.aabb;V.minx=D.minx<F.minx?D.minx:F.minx,V.miny=D.miny<F.miny?D.miny:F.miny,V.maxx=D.maxx>F.maxx?D.maxx:F.maxx,V.maxy=D.maxy>F.maxy?D.maxy:F.maxy;var R=I.aabb,Z=t.aabb,B=N.aabb;R.minx=Z.minx<B.minx?Z.minx:B.minx,R.miny=Z.miny<B.miny?Z.miny:B.miny,R.maxx=Z.maxx>B.maxx?Z.maxx:B.maxx,R.maxy=Z.maxy>B.maxy?Z.maxy:B.maxy;var G=E.height,q=L.height;t.height=1+(G>q?G:q);var U=t.height,K=N.height;I.height=1+(U>K?U:K)}else{I.child2=L,t.child2=N,N.parent=t;var W=t.aabb,Y=E.aabb,J=N.aabb;W.minx=Y.minx<J.minx?Y.minx:J.minx,W.miny=Y.miny<J.miny?Y.miny:J.miny,W.maxx=Y.maxx>J.maxx?Y.maxx:J.maxx,W.maxy=Y.maxy>J.maxy?Y.maxy:J.maxy;var X=I.aabb,H=t.aabb,$=L.aabb;X.minx=H.minx<$.minx?H.minx:$.minx,X.miny=H.miny<$.miny?H.miny:$.miny,X.maxx=H.maxx>$.maxx?H.maxx:$.maxx,X.maxy=H.maxy>$.maxy?H.maxy:$.maxy;var Q=E.height,nn=N.height;t.height=1+(Q>nn?Q:nn);var en=t.height,tn=L.height;I.height=1+(en>tn?en:tn)}t=I}else if(T<-1){var pn=E.child1,ln=E.child2;if(E.child1=t,E.parent=t.parent,t.parent=E,null!=E.parent?E.parent.child1==t?E.parent.child1=E:E.parent.child2=E:this.root=E,pn.height>ln.height){E.child2=pn,t.child1=ln,ln.parent=t;var rn=t.aabb,on=I.aabb,an=ln.aabb;rn.minx=on.minx<an.minx?on.minx:an.minx,rn.miny=on.miny<an.miny?on.miny:an.miny,rn.maxx=on.maxx>an.maxx?on.maxx:an.maxx,rn.maxy=on.maxy>an.maxy?on.maxy:an.maxy;var sn=E.aabb,_n=t.aabb,hn=pn.aabb;sn.minx=_n.minx<hn.minx?_n.minx:hn.minx,sn.miny=_n.miny<hn.miny?_n.miny:hn.miny,sn.maxx=_n.maxx>hn.maxx?_n.maxx:hn.maxx,sn.maxy=_n.maxy>hn.maxy?_n.maxy:hn.maxy;var un=I.height,xn=ln.height;t.height=1+(un>xn?un:xn);var dn=t.height,yn=pn.height;E.height=1+(dn>yn?dn:yn)}else{E.child2=ln,t.child1=pn,pn.parent=t;var zn=t.aabb,vn=I.aabb,cn=pn.aabb;zn.minx=vn.minx<cn.minx?vn.minx:cn.minx,zn.miny=vn.miny<cn.miny?vn.miny:cn.miny,zn.maxx=vn.maxx>cn.maxx?vn.maxx:cn.maxx,zn.maxy=vn.maxy>cn.maxy?vn.maxy:cn.maxy;var fn=E.aabb,mn=t.aabb,bn=ln.aabb;fn.minx=mn.minx<bn.minx?mn.minx:bn.minx,fn.miny=mn.miny<bn.miny?mn.miny:bn.miny,fn.maxx=mn.maxx>bn.maxx?mn.maxx:bn.maxx,fn.maxy=mn.maxy>bn.maxy?mn.maxy:bn.maxy;var gn=I.height,wn=pn.height;t.height=1+(gn>wn?gn:wn);var Mn=t.height,Cn=ln.height;E.height=1+(Mn>Cn?Mn:Cn)}t=E}else t=t}var kn=t.child1,On=t.child2,Pn=kn.height,Sn=On.height;t.height=1+(Pn>Sn?Pn:Sn);var An=t.aabb,jn=kn.aabb,En=On.aabb;An.minx=jn.minx<En.minx?jn.minx:En.minx,An.miny=jn.miny<En.miny?jn.miny:En.miny,An.maxx=jn.maxx>En.maxx?jn.maxx:En.maxx,An.maxy=jn.maxy>En.maxy?jn.maxy:En.maxy,t=t.parent}}},Pt.prototype.inlined_insertLeaf=function(n){if(null==this.root)this.root=n,this.root.parent=null;else{for(var e=n.aabb,t=this.root;null!=t.child1;){var i=t.child1,p=t.child2,l=t.aabb,r=2*(l.maxx-l.minx+(l.maxy-l.miny)),o=Pt.tmpaabb,a=t.aabb;o.minx=a.minx<e.minx?a.minx:e.minx,o.miny=a.miny<e.miny?a.miny:e.miny,o.maxx=a.maxx>e.maxx?a.maxx:e.maxx,o.maxy=a.maxy>e.maxy?a.maxy:e.maxy;var s,_=Pt.tmpaabb,h=2*(_.maxx-_.minx+(_.maxy-_.miny)),u=2*h,x=2*(h-r),d=Pt.tmpaabb,y=i.aabb;if(d.minx=e.minx<y.minx?e.minx:y.minx,d.miny=e.miny<y.miny?e.miny:y.miny,d.maxx=e.maxx>y.maxx?e.maxx:y.maxx,d.maxy=e.maxy>y.maxy?e.maxy:y.maxy,null==i.child1){var z=Pt.tmpaabb;s=2*(z.maxx-z.minx+(z.maxy-z.miny))+x}else{var v=i.aabb,c=2*(v.maxx-v.minx+(v.maxy-v.miny)),f=Pt.tmpaabb;s=2*(f.maxx-f.minx+(f.maxy-f.miny))-c+x}var m,b=Pt.tmpaabb,g=p.aabb;if(b.minx=e.minx<g.minx?e.minx:g.minx,b.miny=e.miny<g.miny?e.miny:g.miny,b.maxx=e.maxx>g.maxx?e.maxx:g.maxx,b.maxy=e.maxy>g.maxy?e.maxy:g.maxy,null==p.child1){var w=Pt.tmpaabb;m=2*(w.maxx-w.minx+(w.maxy-w.miny))+x}else{var M=p.aabb,C=2*(M.maxx-M.minx+(M.maxy-M.miny)),k=Pt.tmpaabb;m=2*(k.maxx-k.minx+(k.maxy-k.miny))-C+x}if(u<s&&u<m)break;t=s<m?i:p}var O,P=t,S=P.parent;null==kt.zpp_pool?O=new kt:(O=kt.zpp_pool,kt.zpp_pool=O.next,O.next=null),null==Te.zpp_pool?O.aabb=new Te:(O.aabb=Te.zpp_pool,Te.zpp_pool=O.aabb.next,O.aabb.next=null),O.moved=!1,O.synced=!1,O.first_sync=!1,O.parent=S;var A=O.aabb,j=P.aabb;for(A.minx=e.minx<j.minx?e.minx:j.minx,A.miny=e.miny<j.miny?e.miny:j.miny,A.maxx=e.maxx>j.maxx?e.maxx:j.maxx,A.maxy=e.maxy>j.maxy?e.maxy:j.maxy,O.height=P.height+1,null!=S?(S.child1==P?S.child1=O:S.child2=O,O.child1=P,O.child2=n,P.parent=O,n.parent=O):(O.child1=P,O.child2=n,P.parent=O,n.parent=O,this.root=O),t=n.parent;null!=t;){if(null==t.child1||t.height<2)t=t;else{var E=t.child1,I=t.child2,T=I.height-E.height;if(T>1){var N=I.child1,L=I.child2;if(I.child1=t,I.parent=t.parent,t.parent=I,null!=I.parent?I.parent.child1==t?I.parent.child1=I:I.parent.child2=I:this.root=I,N.height>L.height){I.child2=N,t.child2=L,L.parent=t;var V=t.aabb,D=E.aabb,F=L.aabb;V.minx=D.minx<F.minx?D.minx:F.minx,V.miny=D.miny<F.miny?D.miny:F.miny,V.maxx=D.maxx>F.maxx?D.maxx:F.maxx,V.maxy=D.maxy>F.maxy?D.maxy:F.maxy;var R=I.aabb,Z=t.aabb,B=N.aabb;R.minx=Z.minx<B.minx?Z.minx:B.minx,R.miny=Z.miny<B.miny?Z.miny:B.miny,R.maxx=Z.maxx>B.maxx?Z.maxx:B.maxx,R.maxy=Z.maxy>B.maxy?Z.maxy:B.maxy;var G=E.height,q=L.height;t.height=1+(G>q?G:q);var U=t.height,K=N.height;I.height=1+(U>K?U:K)}else{I.child2=L,t.child2=N,N.parent=t;var W=t.aabb,Y=E.aabb,J=N.aabb;W.minx=Y.minx<J.minx?Y.minx:J.minx,W.miny=Y.miny<J.miny?Y.miny:J.miny,W.maxx=Y.maxx>J.maxx?Y.maxx:J.maxx,W.maxy=Y.maxy>J.maxy?Y.maxy:J.maxy;var X=I.aabb,H=t.aabb,$=L.aabb;X.minx=H.minx<$.minx?H.minx:$.minx,X.miny=H.miny<$.miny?H.miny:$.miny,X.maxx=H.maxx>$.maxx?H.maxx:$.maxx,X.maxy=H.maxy>$.maxy?H.maxy:$.maxy;var Q=E.height,nn=N.height;t.height=1+(Q>nn?Q:nn);var en=t.height,tn=L.height;I.height=1+(en>tn?en:tn)}t=I}else if(T<-1){var pn=E.child1,ln=E.child2;if(E.child1=t,E.parent=t.parent,t.parent=E,null!=E.parent?E.parent.child1==t?E.parent.child1=E:E.parent.child2=E:this.root=E,pn.height>ln.height){E.child2=pn,t.child1=ln,ln.parent=t;var rn=t.aabb,on=I.aabb,an=ln.aabb;rn.minx=on.minx<an.minx?on.minx:an.minx,rn.miny=on.miny<an.miny?on.miny:an.miny,rn.maxx=on.maxx>an.maxx?on.maxx:an.maxx,rn.maxy=on.maxy>an.maxy?on.maxy:an.maxy;var sn=E.aabb,_n=t.aabb,hn=pn.aabb;sn.minx=_n.minx<hn.minx?_n.minx:hn.minx,sn.miny=_n.miny<hn.miny?_n.miny:hn.miny,sn.maxx=_n.maxx>hn.maxx?_n.maxx:hn.maxx,sn.maxy=_n.maxy>hn.maxy?_n.maxy:hn.maxy;var un=I.height,xn=ln.height;t.height=1+(un>xn?un:xn);var dn=t.height,yn=pn.height;E.height=1+(dn>yn?dn:yn)}else{E.child2=ln,t.child1=pn,pn.parent=t;var zn=t.aabb,vn=I.aabb,cn=pn.aabb;zn.minx=vn.minx<cn.minx?vn.minx:cn.minx,zn.miny=vn.miny<cn.miny?vn.miny:cn.miny,zn.maxx=vn.maxx>cn.maxx?vn.maxx:cn.maxx,zn.maxy=vn.maxy>cn.maxy?vn.maxy:cn.maxy;var fn=E.aabb,mn=t.aabb,bn=ln.aabb;fn.minx=mn.minx<bn.minx?mn.minx:bn.minx,fn.miny=mn.miny<bn.miny?mn.miny:bn.miny,fn.maxx=mn.maxx>bn.maxx?mn.maxx:bn.maxx,fn.maxy=mn.maxy>bn.maxy?mn.maxy:bn.maxy;var gn=I.height,wn=pn.height;t.height=1+(gn>wn?gn:wn);var Mn=t.height,Cn=ln.height;E.height=1+(Mn>Cn?Mn:Cn)}t=E}else t=t}var kn=t.child1,On=t.child2,Pn=kn.height,Sn=On.height;t.height=1+(Pn>Sn?Pn:Sn);var An=t.aabb,jn=kn.aabb,En=On.aabb;An.minx=jn.minx<En.minx?jn.minx:En.minx,An.miny=jn.miny<En.miny?jn.miny:En.miny,An.maxx=jn.maxx>En.maxx?jn.maxx:En.maxx,An.maxy=jn.maxy>En.maxy?jn.maxy:En.maxy,t=t.parent}}},Pt.prototype.removeLeaf=function(n){if(n==this.root)this.root=null;else{var e=n.parent,t=e.parent,i=e.child1==n?e.child2:e.child1;if(null!=t){t.child1==e?t.child1=i:t.child2=i,i.parent=t,e.height=-1;var p=e.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Te.zpp_pool,Te.zpp_pool=p,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=kt.zpp_pool,kt.zpp_pool=e;for(var l=t;null!=l;){if(null==l.child1||l.height<2)l=l;else{var r=l.child1,o=l.child2,a=o.height-r.height;if(a>1){var s=o.child1,_=o.child2;if(o.child1=l,o.parent=l.parent,l.parent=o,null!=o.parent?o.parent.child1==l?o.parent.child1=o:o.parent.child2=o:this.root=o,s.height>_.height){o.child2=s,l.child2=_,_.parent=l;var h=l.aabb,u=r.aabb,x=_.aabb;h.minx=u.minx<x.minx?u.minx:x.minx,h.miny=u.miny<x.miny?u.miny:x.miny,h.maxx=u.maxx>x.maxx?u.maxx:x.maxx,h.maxy=u.maxy>x.maxy?u.maxy:x.maxy;var d=o.aabb,y=l.aabb,z=s.aabb;d.minx=y.minx<z.minx?y.minx:z.minx,d.miny=y.miny<z.miny?y.miny:z.miny,d.maxx=y.maxx>z.maxx?y.maxx:z.maxx,d.maxy=y.maxy>z.maxy?y.maxy:z.maxy;var v=r.height,c=_.height;l.height=1+(v>c?v:c);var f=l.height,m=s.height;o.height=1+(f>m?f:m)}else{o.child2=_,l.child2=s,s.parent=l;var b=l.aabb,g=r.aabb,w=s.aabb;b.minx=g.minx<w.minx?g.minx:w.minx,b.miny=g.miny<w.miny?g.miny:w.miny,b.maxx=g.maxx>w.maxx?g.maxx:w.maxx,b.maxy=g.maxy>w.maxy?g.maxy:w.maxy;var M=o.aabb,C=l.aabb,k=_.aabb;M.minx=C.minx<k.minx?C.minx:k.minx,M.miny=C.miny<k.miny?C.miny:k.miny,M.maxx=C.maxx>k.maxx?C.maxx:k.maxx,M.maxy=C.maxy>k.maxy?C.maxy:k.maxy;var O=r.height,P=s.height;l.height=1+(O>P?O:P);var S=l.height,A=_.height;o.height=1+(S>A?S:A)}l=o}else if(a<-1){var j=r.child1,E=r.child2;if(r.child1=l,r.parent=l.parent,l.parent=r,null!=r.parent?r.parent.child1==l?r.parent.child1=r:r.parent.child2=r:this.root=r,j.height>E.height){r.child2=j,l.child1=E,E.parent=l;var I=l.aabb,T=o.aabb,N=E.aabb;I.minx=T.minx<N.minx?T.minx:N.minx,I.miny=T.miny<N.miny?T.miny:N.miny,I.maxx=T.maxx>N.maxx?T.maxx:N.maxx,I.maxy=T.maxy>N.maxy?T.maxy:N.maxy;var L=r.aabb,V=l.aabb,D=j.aabb;L.minx=V.minx<D.minx?V.minx:D.minx,L.miny=V.miny<D.miny?V.miny:D.miny,L.maxx=V.maxx>D.maxx?V.maxx:D.maxx,L.maxy=V.maxy>D.maxy?V.maxy:D.maxy;var F=o.height,R=E.height;l.height=1+(F>R?F:R);var Z=l.height,B=j.height;r.height=1+(Z>B?Z:B)}else{r.child2=E,l.child1=j,j.parent=l;var G=l.aabb,q=o.aabb,U=j.aabb;G.minx=q.minx<U.minx?q.minx:U.minx,G.miny=q.miny<U.miny?q.miny:U.miny,G.maxx=q.maxx>U.maxx?q.maxx:U.maxx,G.maxy=q.maxy>U.maxy?q.maxy:U.maxy;var K=r.aabb,W=l.aabb,Y=E.aabb;K.minx=W.minx<Y.minx?W.minx:Y.minx,K.miny=W.miny<Y.miny?W.miny:Y.miny,K.maxx=W.maxx>Y.maxx?W.maxx:Y.maxx,K.maxy=W.maxy>Y.maxy?W.maxy:Y.maxy;var J=o.height,X=j.height;l.height=1+(J>X?J:X);var H=l.height,$=E.height;r.height=1+(H>$?H:$)}l=r}else l=l}var Q=l.child1,nn=l.child2,en=l.aabb,tn=Q.aabb,pn=nn.aabb;en.minx=tn.minx<pn.minx?tn.minx:pn.minx,en.miny=tn.miny<pn.miny?tn.miny:pn.miny,en.maxx=tn.maxx>pn.maxx?tn.maxx:pn.maxx,en.maxy=tn.maxy>pn.maxy?tn.maxy:pn.maxy;var ln=Q.height,rn=nn.height;l.height=1+(ln>rn?ln:rn),l=l.parent}}else{this.root=i,i.parent=null,e.height=-1;var on=e.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=Te.zpp_pool,Te.zpp_pool=on,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=kt.zpp_pool,kt.zpp_pool=e}}},Pt.prototype.inlined_removeLeaf=function(n){if(n!=this.root){var e=n.parent,t=e.parent,i=e.child1==n?e.child2:e.child1;if(null!=t){t.child1==e?t.child1=i:t.child2=i,i.parent=t,e.height=-1;var p=e.aabb;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Te.zpp_pool,Te.zpp_pool=p,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=kt.zpp_pool,kt.zpp_pool=e;for(var l=t;null!=l;){if(null==l.child1||l.height<2)l=l;else{var r=l.child1,o=l.child2,a=o.height-r.height;if(a>1){var s=o.child1,_=o.child2;if(o.child1=l,o.parent=l.parent,l.parent=o,null!=o.parent?o.parent.child1==l?o.parent.child1=o:o.parent.child2=o:this.root=o,s.height>_.height){o.child2=s,l.child2=_,_.parent=l;var h=l.aabb,u=r.aabb,x=_.aabb;h.minx=u.minx<x.minx?u.minx:x.minx,h.miny=u.miny<x.miny?u.miny:x.miny,h.maxx=u.maxx>x.maxx?u.maxx:x.maxx,h.maxy=u.maxy>x.maxy?u.maxy:x.maxy;var d=o.aabb,y=l.aabb,z=s.aabb;d.minx=y.minx<z.minx?y.minx:z.minx,d.miny=y.miny<z.miny?y.miny:z.miny,d.maxx=y.maxx>z.maxx?y.maxx:z.maxx,d.maxy=y.maxy>z.maxy?y.maxy:z.maxy;var v=r.height,c=_.height;l.height=1+(v>c?v:c);var f=l.height,m=s.height;o.height=1+(f>m?f:m)}else{o.child2=_,l.child2=s,s.parent=l;var b=l.aabb,g=r.aabb,w=s.aabb;b.minx=g.minx<w.minx?g.minx:w.minx,b.miny=g.miny<w.miny?g.miny:w.miny,b.maxx=g.maxx>w.maxx?g.maxx:w.maxx,b.maxy=g.maxy>w.maxy?g.maxy:w.maxy;var M=o.aabb,C=l.aabb,k=_.aabb;M.minx=C.minx<k.minx?C.minx:k.minx,M.miny=C.miny<k.miny?C.miny:k.miny,M.maxx=C.maxx>k.maxx?C.maxx:k.maxx,M.maxy=C.maxy>k.maxy?C.maxy:k.maxy;var O=r.height,P=s.height;l.height=1+(O>P?O:P);var S=l.height,A=_.height;o.height=1+(S>A?S:A)}l=o}else if(a<-1){var j=r.child1,E=r.child2;if(r.child1=l,r.parent=l.parent,l.parent=r,null!=r.parent?r.parent.child1==l?r.parent.child1=r:r.parent.child2=r:this.root=r,j.height>E.height){r.child2=j,l.child1=E,E.parent=l;var I=l.aabb,T=o.aabb,N=E.aabb;I.minx=T.minx<N.minx?T.minx:N.minx,I.miny=T.miny<N.miny?T.miny:N.miny,I.maxx=T.maxx>N.maxx?T.maxx:N.maxx,I.maxy=T.maxy>N.maxy?T.maxy:N.maxy;var L=r.aabb,V=l.aabb,D=j.aabb;L.minx=V.minx<D.minx?V.minx:D.minx,L.miny=V.miny<D.miny?V.miny:D.miny,L.maxx=V.maxx>D.maxx?V.maxx:D.maxx,L.maxy=V.maxy>D.maxy?V.maxy:D.maxy;var F=o.height,R=E.height;l.height=1+(F>R?F:R);var Z=l.height,B=j.height;r.height=1+(Z>B?Z:B)}else{r.child2=E,l.child1=j,j.parent=l;var G=l.aabb,q=o.aabb,U=j.aabb;G.minx=q.minx<U.minx?q.minx:U.minx,G.miny=q.miny<U.miny?q.miny:U.miny,G.maxx=q.maxx>U.maxx?q.maxx:U.maxx,G.maxy=q.maxy>U.maxy?q.maxy:U.maxy;var K=r.aabb,W=l.aabb,Y=E.aabb;K.minx=W.minx<Y.minx?W.minx:Y.minx,K.miny=W.miny<Y.miny?W.miny:Y.miny,K.maxx=W.maxx>Y.maxx?W.maxx:Y.maxx,K.maxy=W.maxy>Y.maxy?W.maxy:Y.maxy;var J=o.height,X=j.height;l.height=1+(J>X?J:X);var H=l.height,$=E.height;r.height=1+(H>$?H:$)}l=r}else l=l}var Q=l.child1,nn=l.child2,en=l.aabb,tn=Q.aabb,pn=nn.aabb;en.minx=tn.minx<pn.minx?tn.minx:pn.minx,en.miny=tn.miny<pn.miny?tn.miny:pn.miny,en.maxx=tn.maxx>pn.maxx?tn.maxx:pn.maxx,en.maxy=tn.maxy>pn.maxy?tn.maxy:pn.maxy;var ln=Q.height,rn=nn.height;l.height=1+(ln>rn?ln:rn),l=l.parent}}else{this.root=i,i.parent=null,e.height=-1;var on=e.aabb;null!=on.outer&&(on.outer.zpp_inner=null,on.outer=null),on.wrap_min=on.wrap_max=null,on._invalidate=null,on._validate=null,on.next=Te.zpp_pool,Te.zpp_pool=on,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=kt.zpp_pool,kt.zpp_pool=e}}else this.root=null},Pt.prototype.balance=function(n){if(null==n.child1||n.height<2)return n;var e=n.child1,t=n.child2,i=t.height-e.height;if(i>1){var p=t.child1,l=t.child2;if(t.child1=n,t.parent=n.parent,n.parent=t,null!=t.parent?t.parent.child1==n?t.parent.child1=t:t.parent.child2=t:this.root=t,p.height>l.height){t.child2=p,n.child2=l,l.parent=n;var r=n.aabb,o=e.aabb,a=l.aabb;r.minx=o.minx<a.minx?o.minx:a.minx,r.miny=o.miny<a.miny?o.miny:a.miny,r.maxx=o.maxx>a.maxx?o.maxx:a.maxx,r.maxy=o.maxy>a.maxy?o.maxy:a.maxy;var s=t.aabb,_=n.aabb,h=p.aabb;s.minx=_.minx<h.minx?_.minx:h.minx,s.miny=_.miny<h.miny?_.miny:h.miny,s.maxx=_.maxx>h.maxx?_.maxx:h.maxx,s.maxy=_.maxy>h.maxy?_.maxy:h.maxy;var u=e.height,x=l.height;n.height=1+(u>x?u:x);var d=n.height,y=p.height;t.height=1+(d>y?d:y)}else{t.child2=l,n.child2=p,p.parent=n;var z=n.aabb,v=e.aabb,c=p.aabb;z.minx=v.minx<c.minx?v.minx:c.minx,z.miny=v.miny<c.miny?v.miny:c.miny,z.maxx=v.maxx>c.maxx?v.maxx:c.maxx,z.maxy=v.maxy>c.maxy?v.maxy:c.maxy;var f=t.aabb,m=n.aabb,b=l.aabb;f.minx=m.minx<b.minx?m.minx:b.minx,f.miny=m.miny<b.miny?m.miny:b.miny,f.maxx=m.maxx>b.maxx?m.maxx:b.maxx,f.maxy=m.maxy>b.maxy?m.maxy:b.maxy;var g=e.height,w=p.height;n.height=1+(g>w?g:w);var M=n.height,C=l.height;t.height=1+(M>C?M:C)}return t}if(i<-1){var k=e.child1,O=e.child2;if(e.child1=n,e.parent=n.parent,n.parent=e,null!=e.parent?e.parent.child1==n?e.parent.child1=e:e.parent.child2=e:this.root=e,k.height>O.height){e.child2=k,n.child1=O,O.parent=n;var P=n.aabb,S=t.aabb,A=O.aabb;P.minx=S.minx<A.minx?S.minx:A.minx,P.miny=S.miny<A.miny?S.miny:A.miny,P.maxx=S.maxx>A.maxx?S.maxx:A.maxx,P.maxy=S.maxy>A.maxy?S.maxy:A.maxy;var j=e.aabb,E=n.aabb,I=k.aabb;j.minx=E.minx<I.minx?E.minx:I.minx,j.miny=E.miny<I.miny?E.miny:I.miny,j.maxx=E.maxx>I.maxx?E.maxx:I.maxx,j.maxy=E.maxy>I.maxy?E.maxy:I.maxy;var T=t.height,N=O.height;n.height=1+(T>N?T:N);var L=n.height,V=k.height;e.height=1+(L>V?L:V)}else{e.child2=O,n.child1=k,k.parent=n;var D=n.aabb,F=t.aabb,R=k.aabb;D.minx=F.minx<R.minx?F.minx:R.minx,D.miny=F.miny<R.miny?F.miny:R.miny,D.maxx=F.maxx>R.maxx?F.maxx:R.maxx,D.maxy=F.maxy>R.maxy?F.maxy:R.maxy;var Z=e.aabb,B=n.aabb,G=O.aabb;Z.minx=B.minx<G.minx?B.minx:G.minx,Z.miny=B.miny<G.miny?B.miny:G.miny,Z.maxx=B.maxx>G.maxx?B.maxx:G.maxx,Z.maxy=B.maxy>G.maxy?B.maxy:G.maxy;var q=t.height,U=k.height;n.height=1+(q>U?q:U);var K=n.height,W=O.height;e.height=1+(K>W?K:W)}return e}return n},Pt.prototype.__class__=Pt;var St=zpp_nape.space.ZPP_DynAABBPhase=function(n){this.openlist=null,this.failed=null,this.treeStack2=null,this.treeStack=null,this.moves=null,this.syncs=null,this.pairs=null,this.dtree=null,this.stree=null,Ct.call(this),this.space=n,this.is_sweep=!1,this.dynab=this,this.stree=new Pt,this.dtree=new Pt};St.__name__=["zpp_nape","space","ZPP_DynAABBPhase"],St.__super__=Ct,St.prototype=Object.create(Ct.prototype),St.prototype.stree=null,St.prototype.dtree=null,St.prototype.pairs=null,St.prototype.syncs=null,St.prototype.moves=null,St.prototype.dyn=function(n){return 1!=n.body.type&&!n.body.component.sleeping},St.prototype.__insert=function(n){var e;null==kt.zpp_pool?e=new kt:(e=kt.zpp_pool,kt.zpp_pool=e.next,e.next=null),null==Te.zpp_pool?e.aabb=new Te:(e.aabb=Te.zpp_pool,Te.zpp_pool=e.aabb.next,e.aabb.next=null),e.moved=!1,e.synced=!1,e.first_sync=!1,e.shape=n,n.node=e,e.synced=!0,e.first_sync=!0,e.snext=this.syncs,this.syncs=e},St.prototype.__remove=function(n){var e=n.node;if(e.first_sync||(e.dyn?this.dtree.removeLeaf(e):this.stree.removeLeaf(e)),n.node=null,e.synced){for(var t=null,i=this.syncs;null!=i&&i!=e;)t=i,i=i.snext;null==t?this.syncs=i.snext:t.snext=i.snext,i.snext=null,e.synced=!1}if(e.moved){for(var p=null,l=this.moves;null!=l&&l!=e;)p=l,l=l.mnext;null==p?this.moves=l.mnext:p.mnext=l.mnext,l.mnext=null,e.moved=!1}for(var r=null,o=this.pairs;null!=o;){var a=o.next;if(o.n1!=e&&o.n2!=e)r=o,o=a;else{null==r?this.pairs=a:r.next=a,null!=o.arb&&(o.arb.pair=null),o.arb=null,o.n1.shape.pairs.remove(o),o.n2.shape.pairs.remove(o);var s=o;s.n1=s.n2=null,s.sleeping=!1,s.next=Ot.zpp_pool,Ot.zpp_pool=s,o=a}}for(;null!=n.pairs.head;){var _=n.pairs.pop_unsafe();_.n1==e?_.n2.shape.pairs.remove(_):_.n1.shape.pairs.remove(_),null!=_.arb&&(_.arb.pair=null),_.arb=null,_.n1=_.n2=null,_.sleeping=!1,_.next=Ot.zpp_pool,Ot.zpp_pool=_}e.height=-1;var h=e.aabb;null!=h.outer&&(h.outer.zpp_inner=null,h.outer=null),h.wrap_min=h.wrap_max=null,h._invalidate=null,h._validate=null,h.next=Te.zpp_pool,Te.zpp_pool=h,e.child1=e.child2=e.parent=null,e.next=null,e.snext=null,e.mnext=null,e.next=kt.zpp_pool,kt.zpp_pool=e},St.prototype.__sync=function(n){var e=n.node;if(!e.synced){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var t=n.circle;if(t.zip_worldCOM&&null!=t.body){if(t.zip_worldCOM=!1,t.zip_localCOM){if(t.zip_localCOM=!1,1==t.type){var i=t.polygon;if(null==i.lverts.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y;else if(null==i.lverts.next.next.next)i.localCOMx=i.lverts.next.x,i.localCOMy=i.lverts.next.y,i.localCOMx+=i.lverts.next.next.x,i.localCOMy+=i.lverts.next.next.y,i.localCOMx*=.5,i.localCOMy*=.5;else{i.localCOMx=0,i.localCOMy=0;var p=0,l=i.lverts.next,r=l,o=l=l.next;for(l=l.next;null!=l;){var a=l;p+=o.x*(a.y-r.y);var s=a.y*o.x-a.x*o.y;i.localCOMx+=(o.x+a.x)*s,i.localCOMy+=(o.y+a.y)*s,r=o,o=a,l=l.next}var _=l=i.lverts.next;p+=o.x*(_.y-r.y);var h=_.y*o.x-_.x*o.y;i.localCOMx+=(o.x+_.x)*h,i.localCOMy+=(o.y+_.y)*h,r=o;var u=l=l.next;p+=_.x*(u.y-r.y);var x=u.y*_.x-u.x*_.y;i.localCOMx+=(_.x+u.x)*x,i.localCOMy+=(_.y+u.y)*x;var d=p=1/(3*p);i.localCOMx*=d,i.localCOMy*=d}}null!=t.wrap_localCOM&&(t.wrap_localCOM.zpp_inner.x=t.localCOMx,t.wrap_localCOM.zpp_inner.y=t.localCOMy)}var y=t.body;y.zip_axis&&(y.zip_axis=!1,y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot)),t.worldCOMx=t.body.posx+(t.body.axisy*t.localCOMx-t.body.axisx*t.localCOMy),t.worldCOMy=t.body.posy+(t.localCOMx*t.body.axisx+t.localCOMy*t.body.axisy)}var z=t.radius,v=t.radius;t.aabb.minx=t.worldCOMx-z,t.aabb.miny=t.worldCOMy-v,t.aabb.maxx=t.worldCOMx+z,t.aabb.maxy=t.worldCOMy+v}else{var c=n.polygon;if(c.zip_gverts&&null!=c.body){c.zip_gverts=!1,c.validate_lverts();var f=c.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot));for(var m=c.lverts.next,b=c.gverts.next;null!=b;){var g=b,w=m;m=m.next,g.x=c.body.posx+(c.body.axisy*w.x-c.body.axisx*w.y),g.y=c.body.posy+(w.x*c.body.axisx+w.y*c.body.axisy),b=b.next}}var M=c.gverts.next;c.aabb.minx=M.x,c.aabb.miny=M.y,c.aabb.maxx=M.x,c.aabb.maxy=M.y;for(var C=c.gverts.next.next;null!=C;){var k=C;k.x<c.aabb.minx&&(c.aabb.minx=k.x),k.x>c.aabb.maxx&&(c.aabb.maxx=k.x),k.y<c.aabb.miny&&(c.aabb.miny=k.y),k.y>c.aabb.maxy&&(c.aabb.maxy=k.y),C=C.next}}var O;if(e.dyn==(1!=n.body.type&&!n.body.component.sleeping)){var P=e.aabb,S=n.aabb;O=!(S.minx>=P.minx&&S.miny>=P.miny&&S.maxx<=P.maxx&&S.maxy<=P.maxy)}else O=!0;O&&(e.synced=!0,e.snext=this.syncs,this.syncs=e)}},St.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.syncs)if(null==this.moves){for(var n=this.syncs;null!=n;){var e=n.shape;if(n.first_sync)n.first_sync=!1;else{var t=n.dyn?this.dtree:this.stree;if(n==t.root)t.root=null;else{var i=n.parent,p=i.parent,l=i.child1==n?i.child2:i.child1;if(null!=p){p.child1==i?p.child1=l:p.child2=l,l.parent=p,i.height=-1;var r=i.aabb;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r.wrap_min=r.wrap_max=null,r._invalidate=null,r._validate=null,r.next=Te.zpp_pool,Te.zpp_pool=r,i.child1=i.child2=i.parent=null,i.next=null,i.snext=null,i.mnext=null,i.next=kt.zpp_pool,kt.zpp_pool=i;for(var o=p;null!=o;){if(null==o.child1||o.height<2)o=o;else{var a=o.child1,s=o.child2,_=s.height-a.height;if(_>1){var h=s.child1,u=s.child2;if(s.child1=o,s.parent=o.parent,o.parent=s,null!=s.parent?s.parent.child1==o?s.parent.child1=s:s.parent.child2=s:t.root=s,h.height>u.height){s.child2=h,o.child2=u,u.parent=o;var x=o.aabb,d=a.aabb,y=u.aabb;x.minx=d.minx<y.minx?d.minx:y.minx,x.miny=d.miny<y.miny?d.miny:y.miny,x.maxx=d.maxx>y.maxx?d.maxx:y.maxx,x.maxy=d.maxy>y.maxy?d.maxy:y.maxy;var z=s.aabb,v=o.aabb,c=h.aabb;z.minx=v.minx<c.minx?v.minx:c.minx,z.miny=v.miny<c.miny?v.miny:c.miny,z.maxx=v.maxx>c.maxx?v.maxx:c.maxx,z.maxy=v.maxy>c.maxy?v.maxy:c.maxy;var f=a.height,m=u.height;o.height=1+(f>m?f:m);var b=o.height,g=h.height;s.height=1+(b>g?b:g)}else{s.child2=u,o.child2=h,h.parent=o;var w=o.aabb,M=a.aabb,C=h.aabb;w.minx=M.minx<C.minx?M.minx:C.minx,w.miny=M.miny<C.miny?M.miny:C.miny,w.maxx=M.maxx>C.maxx?M.maxx:C.maxx,w.maxy=M.maxy>C.maxy?M.maxy:C.maxy;var k=s.aabb,O=o.aabb,P=u.aabb;k.minx=O.minx<P.minx?O.minx:P.minx,k.miny=O.miny<P.miny?O.miny:P.miny,k.maxx=O.maxx>P.maxx?O.maxx:P.maxx,k.maxy=O.maxy>P.maxy?O.maxy:P.maxy;var S=a.height,A=h.height;o.height=1+(S>A?S:A);var j=o.height,E=u.height;s.height=1+(j>E?j:E)}o=s}else if(_<-1){var I=a.child1,T=a.child2;if(a.child1=o,a.parent=o.parent,o.parent=a,null!=a.parent?a.parent.child1==o?a.parent.child1=a:a.parent.child2=a:t.root=a,I.height>T.height){a.child2=I,o.child1=T,T.parent=o;var N=o.aabb,L=s.aabb,V=T.aabb;N.minx=L.minx<V.minx?L.minx:V.minx,N.miny=L.miny<V.miny?L.miny:V.miny,N.maxx=L.maxx>V.maxx?L.maxx:V.maxx,N.maxy=L.maxy>V.maxy?L.maxy:V.maxy;var D=a.aabb,F=o.aabb,R=I.aabb;D.minx=F.minx<R.minx?F.minx:R.minx,D.miny=F.miny<R.miny?F.miny:R.miny,D.maxx=F.maxx>R.maxx?F.maxx:R.maxx,D.maxy=F.maxy>R.maxy?F.maxy:R.maxy;var Z=s.height,B=T.height;o.height=1+(Z>B?Z:B);var G=o.height,q=I.height;a.height=1+(G>q?G:q)}else{a.child2=T,o.child1=I,I.parent=o;var U=o.aabb,K=s.aabb,W=I.aabb;U.minx=K.minx<W.minx?K.minx:W.minx,U.miny=K.miny<W.miny?K.miny:W.miny,U.maxx=K.maxx>W.maxx?K.maxx:W.maxx,U.maxy=K.maxy>W.maxy?K.maxy:W.maxy;var Y=a.aabb,J=o.aabb,X=T.aabb;Y.minx=J.minx<X.minx?J.minx:X.minx,Y.miny=J.miny<X.miny?J.miny:X.miny,Y.maxx=J.maxx>X.maxx?J.maxx:X.maxx,Y.maxy=J.maxy>X.maxy?J.maxy:X.maxy;var H=s.height,$=I.height;o.height=1+(H>$?H:$);var Q=o.height,nn=T.height;a.height=1+(Q>nn?Q:nn)}o=a}else o=o}var en=o.child1,tn=o.child2,pn=o.aabb,ln=en.aabb,rn=tn.aabb;pn.minx=ln.minx<rn.minx?ln.minx:rn.minx,pn.miny=ln.miny<rn.miny?ln.miny:rn.miny,pn.maxx=ln.maxx>rn.maxx?ln.maxx:rn.maxx,pn.maxy=ln.maxy>rn.maxy?ln.maxy:rn.maxy;var on=en.height,an=tn.height;o.height=1+(on>an?on:an),o=o.parent}}else{t.root=l,l.parent=null,i.height=-1;var sn=i.aabb;null!=sn.outer&&(sn.outer.zpp_inner=null,sn.outer=null),sn.wrap_min=sn.wrap_max=null,sn._invalidate=null,sn._validate=null,sn.next=Te.zpp_pool,Te.zpp_pool=sn,i.child1=i.child2=i.parent=null,i.next=null,i.snext=null,i.mnext=null,i.next=kt.zpp_pool,kt.zpp_pool=i}}}var _n=n.aabb;if(!this.space.continuous&&e.zip_aabb&&null!=e.body)if(e.zip_aabb=!1,0==e.type){var hn=e.circle;if(hn.zip_worldCOM&&null!=hn.body){if(hn.zip_worldCOM=!1,hn.zip_localCOM){if(hn.zip_localCOM=!1,1==hn.type){var un=hn.polygon;if(null==un.lverts.next.next)un.localCOMx=un.lverts.next.x,un.localCOMy=un.lverts.next.y;else if(null==un.lverts.next.next.next)un.localCOMx=un.lverts.next.x,un.localCOMy=un.lverts.next.y,un.localCOMx+=un.lverts.next.next.x,un.localCOMy+=un.lverts.next.next.y,un.localCOMx*=.5,un.localCOMy*=.5;else{un.localCOMx=0,un.localCOMy=0;var xn=0,dn=un.lverts.next,yn=dn,zn=dn=dn.next;for(dn=dn.next;null!=dn;){var vn=dn;xn+=zn.x*(vn.y-yn.y);var cn=vn.y*zn.x-vn.x*zn.y;un.localCOMx+=(zn.x+vn.x)*cn,un.localCOMy+=(zn.y+vn.y)*cn,yn=zn,zn=vn,dn=dn.next}var fn=dn=un.lverts.next;xn+=zn.x*(fn.y-yn.y);var mn=fn.y*zn.x-fn.x*zn.y;un.localCOMx+=(zn.x+fn.x)*mn,un.localCOMy+=(zn.y+fn.y)*mn,yn=zn;var bn=dn=dn.next;xn+=fn.x*(bn.y-yn.y);var gn=bn.y*fn.x-bn.x*fn.y;un.localCOMx+=(fn.x+bn.x)*gn,un.localCOMy+=(fn.y+bn.y)*gn;var wn=xn=1/(3*xn);un.localCOMx*=wn,un.localCOMy*=wn}}null!=hn.wrap_localCOM&&(hn.wrap_localCOM.zpp_inner.x=hn.localCOMx,hn.wrap_localCOM.zpp_inner.y=hn.localCOMy)}var Mn=hn.body;Mn.zip_axis&&(Mn.zip_axis=!1,Mn.axisx=Math.sin(Mn.rot),Mn.axisy=Math.cos(Mn.rot)),hn.worldCOMx=hn.body.posx+(hn.body.axisy*hn.localCOMx-hn.body.axisx*hn.localCOMy),hn.worldCOMy=hn.body.posy+(hn.localCOMx*hn.body.axisx+hn.localCOMy*hn.body.axisy)}var Cn=hn.radius,kn=hn.radius;hn.aabb.minx=hn.worldCOMx-Cn,hn.aabb.miny=hn.worldCOMy-kn,hn.aabb.maxx=hn.worldCOMx+Cn,hn.aabb.maxy=hn.worldCOMy+kn}else{var On=e.polygon;if(On.zip_gverts&&null!=On.body){On.zip_gverts=!1,On.validate_lverts();var Pn=On.body;Pn.zip_axis&&(Pn.zip_axis=!1,Pn.axisx=Math.sin(Pn.rot),Pn.axisy=Math.cos(Pn.rot));for(var Sn=On.lverts.next,An=On.gverts.next;null!=An;){var jn=An,En=Sn;Sn=Sn.next,jn.x=On.body.posx+(On.body.axisy*En.x-On.body.axisx*En.y),jn.y=On.body.posy+(En.x*On.body.axisx+En.y*On.body.axisy),An=An.next}}var In=On.gverts.next;On.aabb.minx=In.x,On.aabb.miny=In.y,On.aabb.maxx=In.x,On.aabb.maxy=In.y;for(var Tn=On.gverts.next.next;null!=Tn;){var Nn=Tn;Nn.x<On.aabb.minx&&(On.aabb.minx=Nn.x),Nn.x>On.aabb.maxx&&(On.aabb.maxx=Nn.x),Nn.y<On.aabb.miny&&(On.aabb.miny=Nn.y),Nn.y>On.aabb.maxy&&(On.aabb.maxy=Nn.y),Tn=Tn.next}}var Ln=e.aabb;_n.minx=Ln.minx-3,_n.miny=Ln.miny-3,_n.maxx=Ln.maxx+3,_n.maxy=Ln.maxy+3;var Vn=(n.dyn=1!=e.body.type&&!e.body.component.sleeping)?this.dtree:this.stree;if(null==Vn.root)Vn.root=n,Vn.root.parent=null;else{for(var Dn=n.aabb,Fn=Vn.root;null!=Fn.child1;){var Rn=Fn.child1,Zn=Fn.child2,Bn=Fn.aabb,Gn=2*(Bn.maxx-Bn.minx+(Bn.maxy-Bn.miny)),qn=Pt.tmpaabb,Un=Fn.aabb;qn.minx=Un.minx<Dn.minx?Un.minx:Dn.minx,qn.miny=Un.miny<Dn.miny?Un.miny:Dn.miny,qn.maxx=Un.maxx>Dn.maxx?Un.maxx:Dn.maxx,qn.maxy=Un.maxy>Dn.maxy?Un.maxy:Dn.maxy;var Kn,Wn=Pt.tmpaabb,Yn=2*(Wn.maxx-Wn.minx+(Wn.maxy-Wn.miny)),Jn=2*Yn,Xn=2*(Yn-Gn),Hn=Pt.tmpaabb,$n=Rn.aabb;if(Hn.minx=Dn.minx<$n.minx?Dn.minx:$n.minx,Hn.miny=Dn.miny<$n.miny?Dn.miny:$n.miny,Hn.maxx=Dn.maxx>$n.maxx?Dn.maxx:$n.maxx,Hn.maxy=Dn.maxy>$n.maxy?Dn.maxy:$n.maxy,null==Rn.child1){var Qn=Pt.tmpaabb;Kn=2*(Qn.maxx-Qn.minx+(Qn.maxy-Qn.miny))+Xn}else{var ne=Rn.aabb,ee=2*(ne.maxx-ne.minx+(ne.maxy-ne.miny)),te=Pt.tmpaabb;Kn=2*(te.maxx-te.minx+(te.maxy-te.miny))-ee+Xn}var ie,pe=Pt.tmpaabb,le=Zn.aabb;if(pe.minx=Dn.minx<le.minx?Dn.minx:le.minx,pe.miny=Dn.miny<le.miny?Dn.miny:le.miny,pe.maxx=Dn.maxx>le.maxx?Dn.maxx:le.maxx,pe.maxy=Dn.maxy>le.maxy?Dn.maxy:le.maxy,null==Zn.child1){var re=Pt.tmpaabb;ie=2*(re.maxx-re.minx+(re.maxy-re.miny))+Xn}else{var oe=Zn.aabb,ae=2*(oe.maxx-oe.minx+(oe.maxy-oe.miny)),se=Pt.tmpaabb;ie=2*(se.maxx-se.minx+(se.maxy-se.miny))-ae+Xn}if(Jn<Kn&&Jn<ie)break;Fn=Kn<ie?Rn:Zn}var _e,he=Fn,ue=he.parent;null==kt.zpp_pool?_e=new kt:(_e=kt.zpp_pool,kt.zpp_pool=_e.next,_e.next=null),null==Te.zpp_pool?_e.aabb=new Te:(_e.aabb=Te.zpp_pool,Te.zpp_pool=_e.aabb.next,_e.aabb.next=null),_e.moved=!1,_e.synced=!1,_e.first_sync=!1,_e.parent=ue;var xe=_e.aabb,de=he.aabb;for(xe.minx=Dn.minx<de.minx?Dn.minx:de.minx,xe.miny=Dn.miny<de.miny?Dn.miny:de.miny,xe.maxx=Dn.maxx>de.maxx?Dn.maxx:de.maxx,xe.maxy=Dn.maxy>de.maxy?Dn.maxy:de.maxy,_e.height=he.height+1,null!=ue?(ue.child1==he?ue.child1=_e:ue.child2=_e,_e.child1=he,_e.child2=n,he.parent=_e,n.parent=_e):(_e.child1=he,_e.child2=n,he.parent=_e,n.parent=_e,Vn.root=_e),Fn=n.parent;null!=Fn;){if(null==Fn.child1||Fn.height<2)Fn=Fn;else{var ye=Fn.child1,ze=Fn.child2,ve=ze.height-ye.height;if(ve>1){var ce=ze.child1,fe=ze.child2;if(ze.child1=Fn,ze.parent=Fn.parent,Fn.parent=ze,null!=ze.parent?ze.parent.child1==Fn?ze.parent.child1=ze:ze.parent.child2=ze:Vn.root=ze,ce.height>fe.height){ze.child2=ce,Fn.child2=fe,fe.parent=Fn;var me=Fn.aabb,be=ye.aabb,ge=fe.aabb;me.minx=be.minx<ge.minx?be.minx:ge.minx,me.miny=be.miny<ge.miny?be.miny:ge.miny,me.maxx=be.maxx>ge.maxx?be.maxx:ge.maxx,me.maxy=be.maxy>ge.maxy?be.maxy:ge.maxy;var we=ze.aabb,Me=Fn.aabb,Ce=ce.aabb;we.minx=Me.minx<Ce.minx?Me.minx:Ce.minx,we.miny=Me.miny<Ce.miny?Me.miny:Ce.miny,we.maxx=Me.maxx>Ce.maxx?Me.maxx:Ce.maxx,we.maxy=Me.maxy>Ce.maxy?Me.maxy:Ce.maxy;var ke=ye.height,Oe=fe.height;Fn.height=1+(ke>Oe?ke:Oe);var Pe=Fn.height,Se=ce.height;ze.height=1+(Pe>Se?Pe:Se)}else{ze.child2=fe,Fn.child2=ce,ce.parent=Fn;var Ae=Fn.aabb,je=ye.aabb,Ee=ce.aabb;Ae.minx=je.minx<Ee.minx?je.minx:Ee.minx,Ae.miny=je.miny<Ee.miny?je.miny:Ee.miny,Ae.maxx=je.maxx>Ee.maxx?je.maxx:Ee.maxx,Ae.maxy=je.maxy>Ee.maxy?je.maxy:Ee.maxy;var Ie=ze.aabb,Ne=Fn.aabb,Le=fe.aabb;Ie.minx=Ne.minx<Le.minx?Ne.minx:Le.minx,Ie.miny=Ne.miny<Le.miny?Ne.miny:Le.miny,Ie.maxx=Ne.maxx>Le.maxx?Ne.maxx:Le.maxx,Ie.maxy=Ne.maxy>Le.maxy?Ne.maxy:Le.maxy;var Ve=ye.height,De=ce.height;Fn.height=1+(Ve>De?Ve:De);var Fe=Fn.height,Re=fe.height;ze.height=1+(Fe>Re?Fe:Re)}Fn=ze}else if(ve<-1){var Ze=ye.child1,Be=ye.child2;if(ye.child1=Fn,ye.parent=Fn.parent,Fn.parent=ye,null!=ye.parent?ye.parent.child1==Fn?ye.parent.child1=ye:ye.parent.child2=ye:Vn.root=ye,Ze.height>Be.height){ye.child2=Ze,Fn.child1=Be,Be.parent=Fn;var Ge=Fn.aabb,qe=ze.aabb,Ue=Be.aabb;Ge.minx=qe.minx<Ue.minx?qe.minx:Ue.minx,Ge.miny=qe.miny<Ue.miny?qe.miny:Ue.miny,Ge.maxx=qe.maxx>Ue.maxx?qe.maxx:Ue.maxx,Ge.maxy=qe.maxy>Ue.maxy?qe.maxy:Ue.maxy;var Ke=ye.aabb,We=Fn.aabb,Ye=Ze.aabb;Ke.minx=We.minx<Ye.minx?We.minx:Ye.minx,Ke.miny=We.miny<Ye.miny?We.miny:Ye.miny,Ke.maxx=We.maxx>Ye.maxx?We.maxx:Ye.maxx,Ke.maxy=We.maxy>Ye.maxy?We.maxy:Ye.maxy;var Je=ze.height,Xe=Be.height;Fn.height=1+(Je>Xe?Je:Xe);var He=Fn.height,$e=Ze.height;ye.height=1+(He>$e?He:$e)}else{ye.child2=Be,Fn.child1=Ze,Ze.parent=Fn;var Qe=Fn.aabb,nt=ze.aabb,et=Ze.aabb;Qe.minx=nt.minx<et.minx?nt.minx:et.minx,Qe.miny=nt.miny<et.miny?nt.miny:et.miny,Qe.maxx=nt.maxx>et.maxx?nt.maxx:et.maxx,Qe.maxy=nt.maxy>et.maxy?nt.maxy:et.maxy;var tt=ye.aabb,it=Fn.aabb,pt=Be.aabb;tt.minx=it.minx<pt.minx?it.minx:pt.minx,tt.miny=it.miny<pt.miny?it.miny:pt.miny,tt.maxx=it.maxx>pt.maxx?it.maxx:pt.maxx,tt.maxy=it.maxy>pt.maxy?it.maxy:pt.maxy;var lt=ze.height,rt=Ze.height;Fn.height=1+(lt>rt?lt:rt);var ot=Fn.height,at=Be.height;ye.height=1+(ot>at?ot:at)}Fn=ye}else Fn=Fn}var st=Fn.child1,_t=Fn.child2,ht=st.height,ut=_t.height;Fn.height=1+(ht>ut?ht:ut);var xt=Fn.aabb,dt=st.aabb,yt=_t.aabb;xt.minx=dt.minx<yt.minx?dt.minx:yt.minx,xt.miny=dt.miny<yt.miny?dt.miny:yt.miny,xt.maxx=dt.maxx>yt.maxx?dt.maxx:yt.maxx,xt.maxy=dt.maxy>yt.maxy?dt.maxy:yt.maxy,Fn=Fn.parent}}n.synced=!1,n.moved=!0,n.mnext=n.snext,n.snext=null,n=n.mnext}var zt=this.syncs;this.syncs=this.moves,this.moves=zt}else for(;null!=this.syncs;){var vt=this.syncs;this.syncs=vt.snext,vt.snext=null;var ct=vt.shape;if(vt.first_sync)vt.first_sync=!1;else{var ft=vt.dyn?this.dtree:this.stree;if(vt==ft.root)ft.root=null;else{var mt=vt.parent,bt=mt.parent,gt=mt.child1==vt?mt.child2:mt.child1;if(null!=bt){bt.child1==mt?bt.child1=gt:bt.child2=gt,gt.parent=bt,mt.height=-1;var wt=mt.aabb;null!=wt.outer&&(wt.outer.zpp_inner=null,wt.outer=null),wt.wrap_min=wt.wrap_max=null,wt._invalidate=null,wt._validate=null,wt.next=Te.zpp_pool,Te.zpp_pool=wt,mt.child1=mt.child2=mt.parent=null,mt.next=null,mt.snext=null,mt.mnext=null,mt.next=kt.zpp_pool,kt.zpp_pool=mt;for(var Mt=bt;null!=Mt;){if(null==Mt.child1||Mt.height<2)Mt=Mt;else{var Ct=Mt.child1,Ot=Mt.child2,St=Ot.height-Ct.height;if(St>1){var At=Ot.child1,jt=Ot.child2;if(Ot.child1=Mt,Ot.parent=Mt.parent,Mt.parent=Ot,null!=Ot.parent?Ot.parent.child1==Mt?Ot.parent.child1=Ot:Ot.parent.child2=Ot:ft.root=Ot,At.height>jt.height){Ot.child2=At,Mt.child2=jt,jt.parent=Mt;var Et=Mt.aabb,It=Ct.aabb,Tt=jt.aabb;Et.minx=It.minx<Tt.minx?It.minx:Tt.minx,Et.miny=It.miny<Tt.miny?It.miny:Tt.miny,Et.maxx=It.maxx>Tt.maxx?It.maxx:Tt.maxx,Et.maxy=It.maxy>Tt.maxy?It.maxy:Tt.maxy;var Nt=Ot.aabb,Lt=Mt.aabb,Vt=At.aabb;Nt.minx=Lt.minx<Vt.minx?Lt.minx:Vt.minx,Nt.miny=Lt.miny<Vt.miny?Lt.miny:Vt.miny,Nt.maxx=Lt.maxx>Vt.maxx?Lt.maxx:Vt.maxx,Nt.maxy=Lt.maxy>Vt.maxy?Lt.maxy:Vt.maxy;var Dt=Ct.height,Ft=jt.height;Mt.height=1+(Dt>Ft?Dt:Ft);var Rt=Mt.height,Zt=At.height;Ot.height=1+(Rt>Zt?Rt:Zt)}else{Ot.child2=jt,Mt.child2=At,At.parent=Mt;var Bt=Mt.aabb,Gt=Ct.aabb,qt=At.aabb;Bt.minx=Gt.minx<qt.minx?Gt.minx:qt.minx,Bt.miny=Gt.miny<qt.miny?Gt.miny:qt.miny,Bt.maxx=Gt.maxx>qt.maxx?Gt.maxx:qt.maxx,Bt.maxy=Gt.maxy>qt.maxy?Gt.maxy:qt.maxy;var Ut=Ot.aabb,Kt=Mt.aabb,Wt=jt.aabb;Ut.minx=Kt.minx<Wt.minx?Kt.minx:Wt.minx,Ut.miny=Kt.miny<Wt.miny?Kt.miny:Wt.miny,Ut.maxx=Kt.maxx>Wt.maxx?Kt.maxx:Wt.maxx,Ut.maxy=Kt.maxy>Wt.maxy?Kt.maxy:Wt.maxy;var Yt=Ct.height,Jt=At.height;Mt.height=1+(Yt>Jt?Yt:Jt);var Xt=Mt.height,Ht=jt.height;Ot.height=1+(Xt>Ht?Xt:Ht)}Mt=Ot}else if(St<-1){var $t=Ct.child1,Qt=Ct.child2;if(Ct.child1=Mt,Ct.parent=Mt.parent,Mt.parent=Ct,null!=Ct.parent?Ct.parent.child1==Mt?Ct.parent.child1=Ct:Ct.parent.child2=Ct:ft.root=Ct,$t.height>Qt.height){Ct.child2=$t,Mt.child1=Qt,Qt.parent=Mt;var ni=Mt.aabb,ei=Ot.aabb,ti=Qt.aabb;ni.minx=ei.minx<ti.minx?ei.minx:ti.minx,ni.miny=ei.miny<ti.miny?ei.miny:ti.miny,ni.maxx=ei.maxx>ti.maxx?ei.maxx:ti.maxx,ni.maxy=ei.maxy>ti.maxy?ei.maxy:ti.maxy;var ii=Ct.aabb,pi=Mt.aabb,li=$t.aabb;ii.minx=pi.minx<li.minx?pi.minx:li.minx,ii.miny=pi.miny<li.miny?pi.miny:li.miny,ii.maxx=pi.maxx>li.maxx?pi.maxx:li.maxx,ii.maxy=pi.maxy>li.maxy?pi.maxy:li.maxy;var ri=Ot.height,oi=Qt.height;Mt.height=1+(ri>oi?ri:oi);var ai=Mt.height,si=$t.height;Ct.height=1+(ai>si?ai:si)}else{Ct.child2=Qt,Mt.child1=$t,$t.parent=Mt;var _i=Mt.aabb,hi=Ot.aabb,ui=$t.aabb;_i.minx=hi.minx<ui.minx?hi.minx:ui.minx,_i.miny=hi.miny<ui.miny?hi.miny:ui.miny,_i.maxx=hi.maxx>ui.maxx?hi.maxx:ui.maxx,_i.maxy=hi.maxy>ui.maxy?hi.maxy:ui.maxy;var xi=Ct.aabb,di=Mt.aabb,yi=Qt.aabb;xi.minx=di.minx<yi.minx?di.minx:yi.minx,xi.miny=di.miny<yi.miny?di.miny:yi.miny,xi.maxx=di.maxx>yi.maxx?di.maxx:yi.maxx,xi.maxy=di.maxy>yi.maxy?di.maxy:yi.maxy;var zi=Ot.height,vi=$t.height;Mt.height=1+(zi>vi?zi:vi);var ci=Mt.height,fi=Qt.height;Ct.height=1+(ci>fi?ci:fi)}Mt=Ct}else Mt=Mt}var mi=Mt.child1,bi=Mt.child2,gi=Mt.aabb,wi=mi.aabb,Mi=bi.aabb;gi.minx=wi.minx<Mi.minx?wi.minx:Mi.minx,gi.miny=wi.miny<Mi.miny?wi.miny:Mi.miny,gi.maxx=wi.maxx>Mi.maxx?wi.maxx:Mi.maxx,gi.maxy=wi.maxy>Mi.maxy?wi.maxy:Mi.maxy;var Ci=mi.height,ki=bi.height;Mt.height=1+(Ci>ki?Ci:ki),Mt=Mt.parent}}else{ft.root=gt,gt.parent=null,mt.height=-1;var Oi=mt.aabb;null!=Oi.outer&&(Oi.outer.zpp_inner=null,Oi.outer=null),Oi.wrap_min=Oi.wrap_max=null,Oi._invalidate=null,Oi._validate=null,Oi.next=Te.zpp_pool,Te.zpp_pool=Oi,mt.child1=mt.child2=mt.parent=null,mt.next=null,mt.snext=null,mt.mnext=null,mt.next=kt.zpp_pool,kt.zpp_pool=mt}}}var Pi=vt.aabb;if(!this.space.continuous&&ct.zip_aabb&&null!=ct.body)if(ct.zip_aabb=!1,0==ct.type){var Si=ct.circle;if(Si.zip_worldCOM&&null!=Si.body){if(Si.zip_worldCOM=!1,Si.zip_localCOM){if(Si.zip_localCOM=!1,1==Si.type){var Ai=Si.polygon;if(null==Ai.lverts.next.next)Ai.localCOMx=Ai.lverts.next.x,Ai.localCOMy=Ai.lverts.next.y;else if(null==Ai.lverts.next.next.next)Ai.localCOMx=Ai.lverts.next.x,Ai.localCOMy=Ai.lverts.next.y,Ai.localCOMx+=Ai.lverts.next.next.x,Ai.localCOMy+=Ai.lverts.next.next.y,Ai.localCOMx*=.5,Ai.localCOMy*=.5;else{Ai.localCOMx=0,Ai.localCOMy=0;var ji=0,Ei=Ai.lverts.next,Ii=Ei,Ti=Ei=Ei.next;for(Ei=Ei.next;null!=Ei;){var Ni=Ei;ji+=Ti.x*(Ni.y-Ii.y);var Li=Ni.y*Ti.x-Ni.x*Ti.y;Ai.localCOMx+=(Ti.x+Ni.x)*Li,Ai.localCOMy+=(Ti.y+Ni.y)*Li,Ii=Ti,Ti=Ni,Ei=Ei.next}var Vi=Ei=Ai.lverts.next;ji+=Ti.x*(Vi.y-Ii.y);var Di=Vi.y*Ti.x-Vi.x*Ti.y;Ai.localCOMx+=(Ti.x+Vi.x)*Di,Ai.localCOMy+=(Ti.y+Vi.y)*Di,Ii=Ti;var Fi=Ei=Ei.next;ji+=Vi.x*(Fi.y-Ii.y);var Ri=Fi.y*Vi.x-Fi.x*Vi.y;Ai.localCOMx+=(Vi.x+Fi.x)*Ri,Ai.localCOMy+=(Vi.y+Fi.y)*Ri;var Zi=ji=1/(3*ji);Ai.localCOMx*=Zi,Ai.localCOMy*=Zi}}null!=Si.wrap_localCOM&&(Si.wrap_localCOM.zpp_inner.x=Si.localCOMx,Si.wrap_localCOM.zpp_inner.y=Si.localCOMy)}var Bi=Si.body;Bi.zip_axis&&(Bi.zip_axis=!1,Bi.axisx=Math.sin(Bi.rot),Bi.axisy=Math.cos(Bi.rot)),Si.worldCOMx=Si.body.posx+(Si.body.axisy*Si.localCOMx-Si.body.axisx*Si.localCOMy),Si.worldCOMy=Si.body.posy+(Si.localCOMx*Si.body.axisx+Si.localCOMy*Si.body.axisy)}var Gi=Si.radius,qi=Si.radius;Si.aabb.minx=Si.worldCOMx-Gi,Si.aabb.miny=Si.worldCOMy-qi,Si.aabb.maxx=Si.worldCOMx+Gi,Si.aabb.maxy=Si.worldCOMy+qi}else{var Ui=ct.polygon;if(Ui.zip_gverts&&null!=Ui.body){Ui.zip_gverts=!1,Ui.validate_lverts();var Ki=Ui.body;Ki.zip_axis&&(Ki.zip_axis=!1,Ki.axisx=Math.sin(Ki.rot),Ki.axisy=Math.cos(Ki.rot));for(var Wi=Ui.lverts.next,Yi=Ui.gverts.next;null!=Yi;){var Ji=Yi,Xi=Wi;Wi=Wi.next,Ji.x=Ui.body.posx+(Ui.body.axisy*Xi.x-Ui.body.axisx*Xi.y),Ji.y=Ui.body.posy+(Xi.x*Ui.body.axisx+Xi.y*Ui.body.axisy),Yi=Yi.next}}var Hi=Ui.gverts.next;Ui.aabb.minx=Hi.x,Ui.aabb.miny=Hi.y,Ui.aabb.maxx=Hi.x,Ui.aabb.maxy=Hi.y;for(var $i=Ui.gverts.next.next;null!=$i;){var Qi=$i;Qi.x<Ui.aabb.minx&&(Ui.aabb.minx=Qi.x),Qi.x>Ui.aabb.maxx&&(Ui.aabb.maxx=Qi.x),Qi.y<Ui.aabb.miny&&(Ui.aabb.miny=Qi.y),Qi.y>Ui.aabb.maxy&&(Ui.aabb.maxy=Qi.y),$i=$i.next}}var np=ct.aabb;Pi.minx=np.minx-3,Pi.miny=np.miny-3,Pi.maxx=np.maxx+3,Pi.maxy=np.maxy+3;var ep=(vt.dyn=1!=ct.body.type&&!ct.body.component.sleeping)?this.dtree:this.stree;if(null==ep.root)ep.root=vt,ep.root.parent=null;else{for(var tp=vt.aabb,ip=ep.root;null!=ip.child1;){var pp=ip.child1,lp=ip.child2,rp=ip.aabb,op=2*(rp.maxx-rp.minx+(rp.maxy-rp.miny)),ap=Pt.tmpaabb,sp=ip.aabb;ap.minx=sp.minx<tp.minx?sp.minx:tp.minx,ap.miny=sp.miny<tp.miny?sp.miny:tp.miny,ap.maxx=sp.maxx>tp.maxx?sp.maxx:tp.maxx,ap.maxy=sp.maxy>tp.maxy?sp.maxy:tp.maxy;var _p,hp=Pt.tmpaabb,up=2*(hp.maxx-hp.minx+(hp.maxy-hp.miny)),xp=2*up,dp=2*(up-op),yp=Pt.tmpaabb,zp=pp.aabb;if(yp.minx=tp.minx<zp.minx?tp.minx:zp.minx,yp.miny=tp.miny<zp.miny?tp.miny:zp.miny,yp.maxx=tp.maxx>zp.maxx?tp.maxx:zp.maxx,yp.maxy=tp.maxy>zp.maxy?tp.maxy:zp.maxy,null==pp.child1){var vp=Pt.tmpaabb;_p=2*(vp.maxx-vp.minx+(vp.maxy-vp.miny))+dp}else{var cp=pp.aabb,fp=2*(cp.maxx-cp.minx+(cp.maxy-cp.miny)),mp=Pt.tmpaabb;_p=2*(mp.maxx-mp.minx+(mp.maxy-mp.miny))-fp+dp}var bp,gp=Pt.tmpaabb,wp=lp.aabb;if(gp.minx=tp.minx<wp.minx?tp.minx:wp.minx,gp.miny=tp.miny<wp.miny?tp.miny:wp.miny,gp.maxx=tp.maxx>wp.maxx?tp.maxx:wp.maxx,gp.maxy=tp.maxy>wp.maxy?tp.maxy:wp.maxy,null==lp.child1){var Mp=Pt.tmpaabb;bp=2*(Mp.maxx-Mp.minx+(Mp.maxy-Mp.miny))+dp}else{var Cp=lp.aabb,kp=2*(Cp.maxx-Cp.minx+(Cp.maxy-Cp.miny)),Op=Pt.tmpaabb;bp=2*(Op.maxx-Op.minx+(Op.maxy-Op.miny))-kp+dp}if(xp<_p&&xp<bp)break;ip=_p<bp?pp:lp}var Pp,Sp=ip,Ap=Sp.parent;null==kt.zpp_pool?Pp=new kt:(Pp=kt.zpp_pool,kt.zpp_pool=Pp.next,Pp.next=null),null==Te.zpp_pool?Pp.aabb=new Te:(Pp.aabb=Te.zpp_pool,Te.zpp_pool=Pp.aabb.next,Pp.aabb.next=null),Pp.moved=!1,Pp.synced=!1,Pp.first_sync=!1,Pp.parent=Ap;var jp=Pp.aabb,Ep=Sp.aabb;for(jp.minx=tp.minx<Ep.minx?tp.minx:Ep.minx,jp.miny=tp.miny<Ep.miny?tp.miny:Ep.miny,jp.maxx=tp.maxx>Ep.maxx?tp.maxx:Ep.maxx,jp.maxy=tp.maxy>Ep.maxy?tp.maxy:Ep.maxy,Pp.height=Sp.height+1,null!=Ap?(Ap.child1==Sp?Ap.child1=Pp:Ap.child2=Pp,Pp.child1=Sp,Pp.child2=vt,Sp.parent=Pp,vt.parent=Pp):(Pp.child1=Sp,Pp.child2=vt,Sp.parent=Pp,vt.parent=Pp,ep.root=Pp),ip=vt.parent;null!=ip;){if(null==ip.child1||ip.height<2)ip=ip;else{var Ip=ip.child1,Tp=ip.child2,Np=Tp.height-Ip.height;if(Np>1){var Lp=Tp.child1,Vp=Tp.child2;if(Tp.child1=ip,Tp.parent=ip.parent,ip.parent=Tp,null!=Tp.parent?Tp.parent.child1==ip?Tp.parent.child1=Tp:Tp.parent.child2=Tp:ep.root=Tp,Lp.height>Vp.height){Tp.child2=Lp,ip.child2=Vp,Vp.parent=ip;var Dp=ip.aabb,Fp=Ip.aabb,Rp=Vp.aabb;Dp.minx=Fp.minx<Rp.minx?Fp.minx:Rp.minx,Dp.miny=Fp.miny<Rp.miny?Fp.miny:Rp.miny,Dp.maxx=Fp.maxx>Rp.maxx?Fp.maxx:Rp.maxx,Dp.maxy=Fp.maxy>Rp.maxy?Fp.maxy:Rp.maxy;var Zp=Tp.aabb,Bp=ip.aabb,Gp=Lp.aabb;Zp.minx=Bp.minx<Gp.minx?Bp.minx:Gp.minx,Zp.miny=Bp.miny<Gp.miny?Bp.miny:Gp.miny,Zp.maxx=Bp.maxx>Gp.maxx?Bp.maxx:Gp.maxx,Zp.maxy=Bp.maxy>Gp.maxy?Bp.maxy:Gp.maxy;var qp=Ip.height,Up=Vp.height;ip.height=1+(qp>Up?qp:Up);var Kp=ip.height,Wp=Lp.height;Tp.height=1+(Kp>Wp?Kp:Wp)}else{Tp.child2=Vp,ip.child2=Lp,Lp.parent=ip;var Yp=ip.aabb,Jp=Ip.aabb,Xp=Lp.aabb;Yp.minx=Jp.minx<Xp.minx?Jp.minx:Xp.minx,Yp.miny=Jp.miny<Xp.miny?Jp.miny:Xp.miny,Yp.maxx=Jp.maxx>Xp.maxx?Jp.maxx:Xp.maxx,Yp.maxy=Jp.maxy>Xp.maxy?Jp.maxy:Xp.maxy;var Hp=Tp.aabb,$p=ip.aabb,Qp=Vp.aabb;Hp.minx=$p.minx<Qp.minx?$p.minx:Qp.minx,Hp.miny=$p.miny<Qp.miny?$p.miny:Qp.miny,Hp.maxx=$p.maxx>Qp.maxx?$p.maxx:Qp.maxx,Hp.maxy=$p.maxy>Qp.maxy?$p.maxy:Qp.maxy;var nl=Ip.height,el=Lp.height;ip.height=1+(nl>el?nl:el);var tl=ip.height,il=Vp.height;Tp.height=1+(tl>il?tl:il)}ip=Tp}else if(Np<-1){var pl=Ip.child1,ll=Ip.child2;if(Ip.child1=ip,Ip.parent=ip.parent,ip.parent=Ip,null!=Ip.parent?Ip.parent.child1==ip?Ip.parent.child1=Ip:Ip.parent.child2=Ip:ep.root=Ip,pl.height>ll.height){Ip.child2=pl,ip.child1=ll,ll.parent=ip;var rl=ip.aabb,ol=Tp.aabb,al=ll.aabb;rl.minx=ol.minx<al.minx?ol.minx:al.minx,rl.miny=ol.miny<al.miny?ol.miny:al.miny,rl.maxx=ol.maxx>al.maxx?ol.maxx:al.maxx,rl.maxy=ol.maxy>al.maxy?ol.maxy:al.maxy;var sl=Ip.aabb,_l=ip.aabb,hl=pl.aabb;sl.minx=_l.minx<hl.minx?_l.minx:hl.minx,sl.miny=_l.miny<hl.miny?_l.miny:hl.miny,sl.maxx=_l.maxx>hl.maxx?_l.maxx:hl.maxx,sl.maxy=_l.maxy>hl.maxy?_l.maxy:hl.maxy;var ul=Tp.height,xl=ll.height;ip.height=1+(ul>xl?ul:xl);var dl=ip.height,yl=pl.height;Ip.height=1+(dl>yl?dl:yl)}else{Ip.child2=ll,ip.child1=pl,pl.parent=ip;var zl=ip.aabb,vl=Tp.aabb,cl=pl.aabb;zl.minx=vl.minx<cl.minx?vl.minx:cl.minx,zl.miny=vl.miny<cl.miny?vl.miny:cl.miny,zl.maxx=vl.maxx>cl.maxx?vl.maxx:cl.maxx,zl.maxy=vl.maxy>cl.maxy?vl.maxy:cl.maxy;var fl=Ip.aabb,ml=ip.aabb,bl=ll.aabb;fl.minx=ml.minx<bl.minx?ml.minx:bl.minx,fl.miny=ml.miny<bl.miny?ml.miny:bl.miny,fl.maxx=ml.maxx>bl.maxx?ml.maxx:bl.maxx,fl.maxy=ml.maxy>bl.maxy?ml.maxy:bl.maxy;var gl=Tp.height,wl=pl.height;ip.height=1+(gl>wl?gl:wl);var Ml=ip.height,Cl=ll.height;Ip.height=1+(Ml>Cl?Ml:Cl)}ip=Ip}else ip=ip}var kl=ip.child1,Ol=ip.child2,Pl=kl.height,Sl=Ol.height;ip.height=1+(Pl>Sl?Pl:Sl);var Al=ip.aabb,jl=kl.aabb,El=Ol.aabb;Al.minx=jl.minx<El.minx?jl.minx:El.minx,Al.miny=jl.miny<El.miny?jl.miny:El.miny,Al.maxx=jl.maxx>El.maxx?jl.maxx:El.maxx,Al.maxy=jl.maxy>El.maxy?jl.maxy:El.maxy,ip=ip.parent}}vt.synced=!1,vt.moved||(vt.moved=!0,vt.mnext=this.moves,this.moves=vt)}},St.prototype.broadphase=function(n,e){for(var t=this.syncs;null!=t;){var i=t.shape;if(t.first_sync)t.first_sync=!1;else{var p=t.dyn?this.dtree:this.stree;if(t==p.root)p.root=null;else{var l=t.parent,r=l.parent,o=l.child1==t?l.child2:l.child1;if(null!=r){r.child1==l?r.child1=o:r.child2=o,o.parent=r,l.height=-1;var a=l.aabb;null!=a.outer&&(a.outer.zpp_inner=null,a.outer=null),a.wrap_min=a.wrap_max=null,a._invalidate=null,a._validate=null,a.next=Te.zpp_pool,Te.zpp_pool=a,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=kt.zpp_pool,kt.zpp_pool=l;for(var s=r;null!=s;){if(null==s.child1||s.height<2)s=s;else{var _=s.child1,h=s.child2,u=h.height-_.height;if(u>1){var x=h.child1,d=h.child2;if(h.child1=s,h.parent=s.parent,s.parent=h,null!=h.parent?h.parent.child1==s?h.parent.child1=h:h.parent.child2=h:p.root=h,x.height>d.height){h.child2=x,s.child2=d,d.parent=s;var y=s.aabb,z=_.aabb,v=d.aabb;y.minx=z.minx<v.minx?z.minx:v.minx,y.miny=z.miny<v.miny?z.miny:v.miny,y.maxx=z.maxx>v.maxx?z.maxx:v.maxx,y.maxy=z.maxy>v.maxy?z.maxy:v.maxy;var c=h.aabb,f=s.aabb,m=x.aabb;c.minx=f.minx<m.minx?f.minx:m.minx,c.miny=f.miny<m.miny?f.miny:m.miny,c.maxx=f.maxx>m.maxx?f.maxx:m.maxx,c.maxy=f.maxy>m.maxy?f.maxy:m.maxy;var b=_.height,g=d.height;s.height=1+(b>g?b:g);var w=s.height,M=x.height;h.height=1+(w>M?w:M)}else{h.child2=d,s.child2=x,x.parent=s;var C=s.aabb,k=_.aabb,O=x.aabb;C.minx=k.minx<O.minx?k.minx:O.minx,C.miny=k.miny<O.miny?k.miny:O.miny,C.maxx=k.maxx>O.maxx?k.maxx:O.maxx,C.maxy=k.maxy>O.maxy?k.maxy:O.maxy;var P=h.aabb,S=s.aabb,A=d.aabb;P.minx=S.minx<A.minx?S.minx:A.minx,P.miny=S.miny<A.miny?S.miny:A.miny,P.maxx=S.maxx>A.maxx?S.maxx:A.maxx,P.maxy=S.maxy>A.maxy?S.maxy:A.maxy;var j=_.height,E=x.height;s.height=1+(j>E?j:E);var I=s.height,T=d.height;h.height=1+(I>T?I:T)}s=h}else if(u<-1){var N=_.child1,L=_.child2;if(_.child1=s,_.parent=s.parent,s.parent=_,null!=_.parent?_.parent.child1==s?_.parent.child1=_:_.parent.child2=_:p.root=_,N.height>L.height){_.child2=N,s.child1=L,L.parent=s;var V=s.aabb,D=h.aabb,F=L.aabb;V.minx=D.minx<F.minx?D.minx:F.minx,V.miny=D.miny<F.miny?D.miny:F.miny,V.maxx=D.maxx>F.maxx?D.maxx:F.maxx,V.maxy=D.maxy>F.maxy?D.maxy:F.maxy;var R=_.aabb,Z=s.aabb,B=N.aabb;R.minx=Z.minx<B.minx?Z.minx:B.minx,R.miny=Z.miny<B.miny?Z.miny:B.miny,R.maxx=Z.maxx>B.maxx?Z.maxx:B.maxx,R.maxy=Z.maxy>B.maxy?Z.maxy:B.maxy;var G=h.height,q=L.height;s.height=1+(G>q?G:q);var U=s.height,K=N.height;_.height=1+(U>K?U:K)}else{_.child2=L,s.child1=N,N.parent=s;var W=s.aabb,Y=h.aabb,J=N.aabb;W.minx=Y.minx<J.minx?Y.minx:J.minx,W.miny=Y.miny<J.miny?Y.miny:J.miny,W.maxx=Y.maxx>J.maxx?Y.maxx:J.maxx,W.maxy=Y.maxy>J.maxy?Y.maxy:J.maxy;var X=_.aabb,H=s.aabb,$=L.aabb;X.minx=H.minx<$.minx?H.minx:$.minx,X.miny=H.miny<$.miny?H.miny:$.miny,X.maxx=H.maxx>$.maxx?H.maxx:$.maxx,X.maxy=H.maxy>$.maxy?H.maxy:$.maxy;var Q=h.height,nn=N.height;s.height=1+(Q>nn?Q:nn);var en=s.height,tn=L.height;_.height=1+(en>tn?en:tn)}s=_}else s=s}var pn=s.child1,ln=s.child2,rn=s.aabb,on=pn.aabb,an=ln.aabb;rn.minx=on.minx<an.minx?on.minx:an.minx,rn.miny=on.miny<an.miny?on.miny:an.miny,rn.maxx=on.maxx>an.maxx?on.maxx:an.maxx,rn.maxy=on.maxy>an.maxy?on.maxy:an.maxy;var sn=pn.height,_n=ln.height;s.height=1+(sn>_n?sn:_n),s=s.parent}}else{p.root=o,o.parent=null,l.height=-1;var hn=l.aabb;null!=hn.outer&&(hn.outer.zpp_inner=null,hn.outer=null),hn.wrap_min=hn.wrap_max=null,hn._invalidate=null,hn._validate=null,hn.next=Te.zpp_pool,Te.zpp_pool=hn,l.child1=l.child2=l.parent=null,l.next=null,l.snext=null,l.mnext=null,l.next=kt.zpp_pool,kt.zpp_pool=l}}}var un=t.aabb;if(!n.continuous&&i.zip_aabb&&null!=i.body)if(i.zip_aabb=!1,0==i.type){var xn=i.circle;if(xn.zip_worldCOM&&null!=xn.body){if(xn.zip_worldCOM=!1,xn.zip_localCOM){if(xn.zip_localCOM=!1,1==xn.type){var dn=xn.polygon;if(null==dn.lverts.next.next)dn.localCOMx=dn.lverts.next.x,dn.localCOMy=dn.lverts.next.y;else if(null==dn.lverts.next.next.next)dn.localCOMx=dn.lverts.next.x,dn.localCOMy=dn.lverts.next.y,dn.localCOMx+=dn.lverts.next.next.x,dn.localCOMy+=dn.lverts.next.next.y,dn.localCOMx*=.5,dn.localCOMy*=.5;else{dn.localCOMx=0,dn.localCOMy=0;var yn=0,zn=dn.lverts.next,vn=zn,cn=zn=zn.next;for(zn=zn.next;null!=zn;){var fn=zn;yn+=cn.x*(fn.y-vn.y);var mn=fn.y*cn.x-fn.x*cn.y;dn.localCOMx+=(cn.x+fn.x)*mn,dn.localCOMy+=(cn.y+fn.y)*mn,vn=cn,cn=fn,zn=zn.next}var bn=zn=dn.lverts.next;yn+=cn.x*(bn.y-vn.y);var gn=bn.y*cn.x-bn.x*cn.y;dn.localCOMx+=(cn.x+bn.x)*gn,dn.localCOMy+=(cn.y+bn.y)*gn,vn=cn;var wn=zn=zn.next;yn+=bn.x*(wn.y-vn.y);var Mn=wn.y*bn.x-wn.x*bn.y;dn.localCOMx+=(bn.x+wn.x)*Mn,dn.localCOMy+=(bn.y+wn.y)*Mn;var Cn=yn=1/(3*yn);dn.localCOMx*=Cn,dn.localCOMy*=Cn}}null!=xn.wrap_localCOM&&(xn.wrap_localCOM.zpp_inner.x=xn.localCOMx,xn.wrap_localCOM.zpp_inner.y=xn.localCOMy)}var kn=xn.body;kn.zip_axis&&(kn.zip_axis=!1,kn.axisx=Math.sin(kn.rot),kn.axisy=Math.cos(kn.rot)),xn.worldCOMx=xn.body.posx+(xn.body.axisy*xn.localCOMx-xn.body.axisx*xn.localCOMy),xn.worldCOMy=xn.body.posy+(xn.localCOMx*xn.body.axisx+xn.localCOMy*xn.body.axisy)}var On=xn.radius,Pn=xn.radius;xn.aabb.minx=xn.worldCOMx-On,xn.aabb.miny=xn.worldCOMy-Pn,xn.aabb.maxx=xn.worldCOMx+On,xn.aabb.maxy=xn.worldCOMy+Pn}else{var Sn=i.polygon;if(Sn.zip_gverts&&null!=Sn.body){Sn.zip_gverts=!1,Sn.validate_lverts();var An=Sn.body;An.zip_axis&&(An.zip_axis=!1,An.axisx=Math.sin(An.rot),An.axisy=Math.cos(An.rot));for(var jn=Sn.lverts.next,En=Sn.gverts.next;null!=En;){var In=En,Tn=jn;jn=jn.next,In.x=Sn.body.posx+(Sn.body.axisy*Tn.x-Sn.body.axisx*Tn.y),In.y=Sn.body.posy+(Tn.x*Sn.body.axisx+Tn.y*Sn.body.axisy),En=En.next}}var Nn=Sn.gverts.next;Sn.aabb.minx=Nn.x,Sn.aabb.miny=Nn.y,Sn.aabb.maxx=Nn.x,Sn.aabb.maxy=Nn.y;for(var Ln=Sn.gverts.next.next;null!=Ln;){var Vn=Ln;Vn.x<Sn.aabb.minx&&(Sn.aabb.minx=Vn.x),Vn.x>Sn.aabb.maxx&&(Sn.aabb.maxx=Vn.x),Vn.y<Sn.aabb.miny&&(Sn.aabb.miny=Vn.y),Vn.y>Sn.aabb.maxy&&(Sn.aabb.maxy=Vn.y),Ln=Ln.next}}var Dn=i.aabb;un.minx=Dn.minx-3,un.miny=Dn.miny-3,un.maxx=Dn.maxx+3,un.maxy=Dn.maxy+3;var Fn=(t.dyn=1!=i.body.type&&!i.body.component.sleeping)?this.dtree:this.stree;if(null==Fn.root)Fn.root=t,Fn.root.parent=null;else{for(var Rn=t.aabb,Zn=Fn.root;null!=Zn.child1;){var Bn=Zn.child1,Gn=Zn.child2,qn=Zn.aabb,Un=2*(qn.maxx-qn.minx+(qn.maxy-qn.miny)),Kn=Pt.tmpaabb,Wn=Zn.aabb;Kn.minx=Wn.minx<Rn.minx?Wn.minx:Rn.minx,Kn.miny=Wn.miny<Rn.miny?Wn.miny:Rn.miny,Kn.maxx=Wn.maxx>Rn.maxx?Wn.maxx:Rn.maxx,Kn.maxy=Wn.maxy>Rn.maxy?Wn.maxy:Rn.maxy;var Yn,Jn=Pt.tmpaabb,Xn=2*(Jn.maxx-Jn.minx+(Jn.maxy-Jn.miny)),Hn=2*Xn,$n=2*(Xn-Un),Qn=Pt.tmpaabb,ne=Bn.aabb;if(Qn.minx=Rn.minx<ne.minx?Rn.minx:ne.minx,Qn.miny=Rn.miny<ne.miny?Rn.miny:ne.miny,Qn.maxx=Rn.maxx>ne.maxx?Rn.maxx:ne.maxx,Qn.maxy=Rn.maxy>ne.maxy?Rn.maxy:ne.maxy,null==Bn.child1){var ee=Pt.tmpaabb;Yn=2*(ee.maxx-ee.minx+(ee.maxy-ee.miny))+$n}else{var te=Bn.aabb,ie=2*(te.maxx-te.minx+(te.maxy-te.miny)),pe=Pt.tmpaabb;Yn=2*(pe.maxx-pe.minx+(pe.maxy-pe.miny))-ie+$n}var le,re=Pt.tmpaabb,oe=Gn.aabb;if(re.minx=Rn.minx<oe.minx?Rn.minx:oe.minx,re.miny=Rn.miny<oe.miny?Rn.miny:oe.miny,re.maxx=Rn.maxx>oe.maxx?Rn.maxx:oe.maxx,re.maxy=Rn.maxy>oe.maxy?Rn.maxy:oe.maxy,null==Gn.child1){var ae=Pt.tmpaabb;le=2*(ae.maxx-ae.minx+(ae.maxy-ae.miny))+$n}else{var se=Gn.aabb,_e=2*(se.maxx-se.minx+(se.maxy-se.miny)),he=Pt.tmpaabb;le=2*(he.maxx-he.minx+(he.maxy-he.miny))-_e+$n}if(Hn<Yn&&Hn<le)break;Zn=Yn<le?Bn:Gn}var ue,xe=Zn,de=xe.parent;null==kt.zpp_pool?ue=new kt:(ue=kt.zpp_pool,kt.zpp_pool=ue.next,ue.next=null),null==Te.zpp_pool?ue.aabb=new Te:(ue.aabb=Te.zpp_pool,Te.zpp_pool=ue.aabb.next,ue.aabb.next=null),ue.moved=!1,ue.synced=!1,ue.first_sync=!1,ue.parent=de;var ye=ue.aabb,ze=xe.aabb;for(ye.minx=Rn.minx<ze.minx?Rn.minx:ze.minx,ye.miny=Rn.miny<ze.miny?Rn.miny:ze.miny,ye.maxx=Rn.maxx>ze.maxx?Rn.maxx:ze.maxx,ye.maxy=Rn.maxy>ze.maxy?Rn.maxy:ze.maxy,ue.height=xe.height+1,null!=de?(de.child1==xe?de.child1=ue:de.child2=ue,ue.child1=xe,ue.child2=t,xe.parent=ue,t.parent=ue):(ue.child1=xe,ue.child2=t,xe.parent=ue,t.parent=ue,Fn.root=ue),Zn=t.parent;null!=Zn;){if(null==Zn.child1||Zn.height<2)Zn=Zn;else{var ve=Zn.child1,ce=Zn.child2,fe=ce.height-ve.height;if(fe>1){var me=ce.child1,be=ce.child2;if(ce.child1=Zn,ce.parent=Zn.parent,Zn.parent=ce,null!=ce.parent?ce.parent.child1==Zn?ce.parent.child1=ce:ce.parent.child2=ce:Fn.root=ce,me.height>be.height){ce.child2=me,Zn.child2=be,be.parent=Zn;var ge=Zn.aabb,we=ve.aabb,Me=be.aabb;ge.minx=we.minx<Me.minx?we.minx:Me.minx,ge.miny=we.miny<Me.miny?we.miny:Me.miny,ge.maxx=we.maxx>Me.maxx?we.maxx:Me.maxx,ge.maxy=we.maxy>Me.maxy?we.maxy:Me.maxy;var Ce=ce.aabb,ke=Zn.aabb,Oe=me.aabb;Ce.minx=ke.minx<Oe.minx?ke.minx:Oe.minx,Ce.miny=ke.miny<Oe.miny?ke.miny:Oe.miny,Ce.maxx=ke.maxx>Oe.maxx?ke.maxx:Oe.maxx,Ce.maxy=ke.maxy>Oe.maxy?ke.maxy:Oe.maxy;var Pe=ve.height,Se=be.height;Zn.height=1+(Pe>Se?Pe:Se);var Ae=Zn.height,je=me.height;ce.height=1+(Ae>je?Ae:je)}else{ce.child2=be,Zn.child2=me,me.parent=Zn;var Ee=Zn.aabb,Ie=ve.aabb,Ne=me.aabb;Ee.minx=Ie.minx<Ne.minx?Ie.minx:Ne.minx,Ee.miny=Ie.miny<Ne.miny?Ie.miny:Ne.miny,Ee.maxx=Ie.maxx>Ne.maxx?Ie.maxx:Ne.maxx,Ee.maxy=Ie.maxy>Ne.maxy?Ie.maxy:Ne.maxy;var Le=ce.aabb,Ve=Zn.aabb,De=be.aabb;Le.minx=Ve.minx<De.minx?Ve.minx:De.minx,Le.miny=Ve.miny<De.miny?Ve.miny:De.miny,Le.maxx=Ve.maxx>De.maxx?Ve.maxx:De.maxx,Le.maxy=Ve.maxy>De.maxy?Ve.maxy:De.maxy;var Fe=ve.height,Re=me.height;Zn.height=1+(Fe>Re?Fe:Re);var Ze=Zn.height,Be=be.height;ce.height=1+(Ze>Be?Ze:Be)}Zn=ce}else if(fe<-1){var Ge=ve.child1,qe=ve.child2;if(ve.child1=Zn,ve.parent=Zn.parent,Zn.parent=ve,null!=ve.parent?ve.parent.child1==Zn?ve.parent.child1=ve:ve.parent.child2=ve:Fn.root=ve,Ge.height>qe.height){ve.child2=Ge,Zn.child1=qe,qe.parent=Zn;var Ue=Zn.aabb,Ke=ce.aabb,We=qe.aabb;Ue.minx=Ke.minx<We.minx?Ke.minx:We.minx,Ue.miny=Ke.miny<We.miny?Ke.miny:We.miny,Ue.maxx=Ke.maxx>We.maxx?Ke.maxx:We.maxx,Ue.maxy=Ke.maxy>We.maxy?Ke.maxy:We.maxy;var Ye=ve.aabb,Je=Zn.aabb,Xe=Ge.aabb;Ye.minx=Je.minx<Xe.minx?Je.minx:Xe.minx,Ye.miny=Je.miny<Xe.miny?Je.miny:Xe.miny,Ye.maxx=Je.maxx>Xe.maxx?Je.maxx:Xe.maxx,Ye.maxy=Je.maxy>Xe.maxy?Je.maxy:Xe.maxy;var He=ce.height,$e=qe.height;Zn.height=1+(He>$e?He:$e);var Qe=Zn.height,nt=Ge.height;ve.height=1+(Qe>nt?Qe:nt)}else{ve.child2=qe,Zn.child1=Ge,Ge.parent=Zn;var et=Zn.aabb,tt=ce.aabb,it=Ge.aabb;et.minx=tt.minx<it.minx?tt.minx:it.minx,et.miny=tt.miny<it.miny?tt.miny:it.miny,et.maxx=tt.maxx>it.maxx?tt.maxx:it.maxx,et.maxy=tt.maxy>it.maxy?tt.maxy:it.maxy;var pt=ve.aabb,lt=Zn.aabb,rt=qe.aabb;pt.minx=lt.minx<rt.minx?lt.minx:rt.minx,pt.miny=lt.miny<rt.miny?lt.miny:rt.miny,pt.maxx=lt.maxx>rt.maxx?lt.maxx:rt.maxx,pt.maxy=lt.maxy>rt.maxy?lt.maxy:rt.maxy;var ot=ce.height,at=Ge.height;Zn.height=1+(ot>at?ot:at);var st=Zn.height,_t=qe.height;ve.height=1+(st>_t?st:_t)}Zn=ve}else Zn=Zn}var ht=Zn.child1,ut=Zn.child2,xt=ht.height,dt=ut.height;Zn.height=1+(xt>dt?xt:dt);var yt=Zn.aabb,zt=ht.aabb,vt=ut.aabb;yt.minx=zt.minx<vt.minx?zt.minx:vt.minx,yt.miny=zt.miny<vt.miny?zt.miny:vt.miny,yt.maxx=zt.maxx>vt.maxx?zt.maxx:vt.maxx,yt.maxy=zt.maxy>vt.maxy?zt.maxy:vt.maxy,Zn=Zn.parent}}t.synced=!1,t=t.snext}for(;null!=this.syncs;){var ct=this.syncs;if(this.syncs=ct.snext,ct.snext=null,!ct.moved){ct.moved=!1;var ft=ct.shape;if(!ft.body.component.sleeping){var mt=ct.aabb,bt=null;for(null!=this.dtree.root&&(this.dtree.root.next=bt,bt=this.dtree.root);null!=bt;){var gt=bt;if(bt=gt.next,gt.next=null,gt!=ct)if(null==gt.child1){var wt=gt.shape;if(wt.body!=ft.body&&(1!=wt.body.type||1!=ft.body.type)){var Mt=gt.aabb;if(Mt.miny<=mt.maxy&&mt.miny<=Mt.maxy&&Mt.minx<=mt.maxx&&mt.minx<=Mt.maxx){var Ct,St;ft.id<wt.id?(Ct=ft.id,St=wt.id):(Ct=wt.id,St=ft.id);for(var At=null,jt=(ft.pairs.length<wt.pairs.length?ft:wt).pairs.head;null!=jt;){var Et=jt.elt;if(Et.id==Ct&&Et.di==St){At=Et;break}jt=jt.next}if(null!=At){At.sleeping&&(At.sleeping=!1,At.next=this.pairs,this.pairs=At,At.first=!0);continue}null==Ot.zpp_pool?At=new Ot:(At=Ot.zpp_pool,Ot.zpp_pool=At.next,At.next=null),At.n1=ct,At.n2=gt,At.id=Ct,At.di=St,At.next=this.pairs,this.pairs=At,At.first=!0;var It,Tt=ft.pairs;null==Vi.zpp_pool?It=new Vi:(It=Vi.zpp_pool,Vi.zpp_pool=It.next,It.next=null),It.elt=At;var Nt=It;Nt.next=Tt.head,Tt.head=Nt,Tt.modified=!0,Tt.length++;var Lt,Vt=wt.pairs;null==Vi.zpp_pool?Lt=new Vi:(Lt=Vi.zpp_pool,Vi.zpp_pool=Lt.next,Lt.next=null),Lt.elt=At;var Dt=Lt;Dt.next=Vt.head,Vt.head=Dt,Vt.modified=!0,Vt.length++}}}else{var Ft=gt.aabb;Ft.miny<=mt.maxy&&mt.miny<=Ft.maxy&&Ft.minx<=mt.maxx&&mt.minx<=Ft.maxx&&(null!=gt.child1&&(gt.child1.next=bt,bt=gt.child1),null!=gt.child2&&(gt.child2.next=bt,bt=gt.child2))}}for(null!=this.stree.root&&(this.stree.root.next=bt,bt=this.stree.root);null!=bt;){var Rt=bt;if(bt=Rt.next,Rt.next=null,Rt!=ct)if(null==Rt.child1){var Zt=Rt.shape;if(Zt.body!=ft.body&&(1!=Zt.body.type||1!=ft.body.type)){var Bt=Rt.aabb;if(Bt.miny<=mt.maxy&&mt.miny<=Bt.maxy&&Bt.minx<=mt.maxx&&mt.minx<=Bt.maxx){var Gt,qt;ft.id<Zt.id?(Gt=ft.id,qt=Zt.id):(Gt=Zt.id,qt=ft.id);for(var Ut=null,Kt=(ft.pairs.length<Zt.pairs.length?ft:Zt).pairs.head;null!=Kt;){var Wt=Kt.elt;if(Wt.id==Gt&&Wt.di==qt){Ut=Wt;break}Kt=Kt.next}if(null!=Ut){Ut.sleeping&&(Ut.sleeping=!1,Ut.next=this.pairs,this.pairs=Ut,Ut.first=!0);continue}null==Ot.zpp_pool?Ut=new Ot:(Ut=Ot.zpp_pool,Ot.zpp_pool=Ut.next,Ut.next=null),Ut.n1=ct,Ut.n2=Rt,Ut.id=Gt,Ut.di=qt,Ut.next=this.pairs,this.pairs=Ut,Ut.first=!0;var Yt,Jt=ft.pairs;null==Vi.zpp_pool?Yt=new Vi:(Yt=Vi.zpp_pool,Vi.zpp_pool=Yt.next,Yt.next=null),Yt.elt=Ut;var Xt=Yt;Xt.next=Jt.head,Jt.head=Xt,Jt.modified=!0,Jt.length++;var Ht,$t=Zt.pairs;null==Vi.zpp_pool?Ht=new Vi:(Ht=Vi.zpp_pool,Vi.zpp_pool=Ht.next,Ht.next=null),Ht.elt=Ut;var Qt=Ht;Qt.next=$t.head,$t.head=Qt,$t.modified=!0,$t.length++}}}else{var ni=Rt.aabb;ni.miny<=mt.maxy&&mt.miny<=ni.maxy&&ni.minx<=mt.maxx&&mt.minx<=ni.maxx&&(null!=Rt.child1&&(Rt.child1.next=bt,bt=Rt.child1),null!=Rt.child2&&(Rt.child2.next=bt,bt=Rt.child2))}}}}}for(;null!=this.moves;){var ei=this.moves;this.moves=ei.mnext,ei.mnext=null,ei.moved=!1;var ti=ei.shape;if(!ti.body.component.sleeping){var ii=ei.aabb,pi=null;for(null!=this.dtree.root&&(this.dtree.root.next=pi,pi=this.dtree.root);null!=pi;){var li=pi;if(pi=li.next,li.next=null,li!=ei)if(null==li.child1){var ri=li.shape;if(ri.body!=ti.body&&(1!=ri.body.type||1!=ti.body.type)){var oi=li.aabb;if(oi.miny<=ii.maxy&&ii.miny<=oi.maxy&&oi.minx<=ii.maxx&&ii.minx<=oi.maxx){var ai,si;ti.id<ri.id?(ai=ti.id,si=ri.id):(ai=ri.id,si=ti.id);for(var _i=null,hi=(ti.pairs.length<ri.pairs.length?ti:ri).pairs.head;null!=hi;){var ui=hi.elt;if(ui.id==ai&&ui.di==si){_i=ui;break}hi=hi.next}if(null!=_i){_i.sleeping&&(_i.sleeping=!1,_i.next=this.pairs,this.pairs=_i,_i.first=!0);continue}null==Ot.zpp_pool?_i=new Ot:(_i=Ot.zpp_pool,Ot.zpp_pool=_i.next,_i.next=null),_i.n1=ei,_i.n2=li,_i.id=ai,_i.di=si,_i.next=this.pairs,this.pairs=_i,_i.first=!0;var xi,di=ti.pairs;null==Vi.zpp_pool?xi=new Vi:(xi=Vi.zpp_pool,Vi.zpp_pool=xi.next,xi.next=null),xi.elt=_i;var yi=xi;yi.next=di.head,di.head=yi,di.modified=!0,di.length++;var zi,vi=ri.pairs;null==Vi.zpp_pool?zi=new Vi:(zi=Vi.zpp_pool,Vi.zpp_pool=zi.next,zi.next=null),zi.elt=_i;var ci=zi;ci.next=vi.head,vi.head=ci,vi.modified=!0,vi.length++}}}else{var fi=li.aabb;fi.miny<=ii.maxy&&ii.miny<=fi.maxy&&fi.minx<=ii.maxx&&ii.minx<=fi.maxx&&(null!=li.child1&&(li.child1.next=pi,pi=li.child1),null!=li.child2&&(li.child2.next=pi,pi=li.child2))}}for(null!=this.stree.root&&(this.stree.root.next=pi,pi=this.stree.root);null!=pi;){var mi=pi;if(pi=mi.next,mi.next=null,mi!=ei)if(null==mi.child1){var bi=mi.shape;if(bi.body!=ti.body&&(1!=bi.body.type||1!=ti.body.type)){var gi=mi.aabb;if(gi.miny<=ii.maxy&&ii.miny<=gi.maxy&&gi.minx<=ii.maxx&&ii.minx<=gi.maxx){var wi,Mi;ti.id<bi.id?(wi=ti.id,Mi=bi.id):(wi=bi.id,Mi=ti.id);for(var Ci=null,ki=(ti.pairs.length<bi.pairs.length?ti:bi).pairs.head;null!=ki;){var Oi=ki.elt;if(Oi.id==wi&&Oi.di==Mi){Ci=Oi;break}ki=ki.next}if(null!=Ci){Ci.sleeping&&(Ci.sleeping=!1,Ci.next=this.pairs,this.pairs=Ci,Ci.first=!0);continue}null==Ot.zpp_pool?Ci=new Ot:(Ci=Ot.zpp_pool,Ot.zpp_pool=Ci.next,Ci.next=null),Ci.n1=ei,Ci.n2=mi,Ci.id=wi,Ci.di=Mi,Ci.next=this.pairs,this.pairs=Ci,Ci.first=!0;var Pi,Si=ti.pairs;null==Vi.zpp_pool?Pi=new Vi:(Pi=Vi.zpp_pool,Vi.zpp_pool=Pi.next,Pi.next=null),Pi.elt=Ci;var Ai=Pi;Ai.next=Si.head,Si.head=Ai,Si.modified=!0,Si.length++;var ji,Ei=bi.pairs;null==Vi.zpp_pool?ji=new Vi:(ji=Vi.zpp_pool,Vi.zpp_pool=ji.next,ji.next=null),ji.elt=Ci;var Ii=ji;Ii.next=Ei.head,Ei.head=Ii,Ei.modified=!0,Ei.length++}}}else{var Ti=mi.aabb;Ti.miny<=ii.maxy&&ii.miny<=Ti.maxy&&Ti.minx<=ii.maxx&&ii.minx<=Ti.maxx&&(null!=mi.child1&&(mi.child1.next=pi,pi=mi.child1),null!=mi.child2&&(mi.child2.next=pi,pi=mi.child2))}}}}for(var Ni=null,Li=this.pairs;null!=Li;){var Di;if(Li.first)Di=!1;else{var Fi=Li.n1.aabb,Ri=Li.n2.aabb;Di=!(Ri.miny<=Fi.maxy&&Fi.miny<=Ri.maxy&&Ri.minx<=Fi.maxx&&Fi.minx<=Ri.maxx)}if(Di){null==Ni?this.pairs=Li.next:Ni.next=Li.next;for(var Zi=Li.n1.shape.pairs,Bi=null,Gi=Zi.head;null!=Gi;){if(Gi.elt==Li){var qi,Ui;null==Bi?(Ui=(qi=Zi.head).next,Zi.head=Ui,null==Zi.head&&(Zi.pushmod=!0)):(Ui=(qi=Bi.next).next,Bi.next=Ui,null==Ui&&(Zi.pushmod=!0));var Ki=qi;Ki.elt=null,Ki.next=Vi.zpp_pool,Vi.zpp_pool=Ki,Zi.modified=!0,Zi.length--,Zi.pushmod=!0;break}Bi=Gi,Gi=Gi.next}for(var Wi=Li.n2.shape.pairs,Yi=null,Ji=Wi.head;null!=Ji;){if(Ji.elt==Li){var Xi,Hi;null==Yi?(Hi=(Xi=Wi.head).next,Wi.head=Hi,null==Wi.head&&(Wi.pushmod=!0)):(Hi=(Xi=Yi.next).next,Yi.next=Hi,null==Hi&&(Wi.pushmod=!0));var $i=Xi;$i.elt=null,$i.next=Vi.zpp_pool,Vi.zpp_pool=$i,Wi.modified=!0,Wi.length--,Wi.pushmod=!0;break}Yi=Ji,Ji=Ji.next}var Qi=Li.next;null!=Li.arb&&(Li.arb.pair=null),Li.arb=null;var np=Li;np.n1=np.n2=null,np.sleeping=!1,np.next=Ot.zpp_pool,Ot.zpp_pool=np,Li=Qi}else{var ep=Li.n1.shape,tp=ep.body,ip=Li.n2.shape,pp=ip.body;if(Li.first||!tp.component.sleeping&&1!=tp.type||!pp.component.sleeping&&1!=pp.type){Li.first=!1;var lp=ep.aabb,rp=ip.aabb;if(rp.miny<=lp.maxy&&lp.miny<=rp.maxy&&rp.minx<=lp.maxx&&lp.minx<=rp.maxx){var op=Li.arb;Li.arb=e?n.narrowPhase(ep,ip,2!=tp.type||2!=pp.type,Li.arb,!1):n.continuousEvent(ep,ip,2!=tp.type||2!=pp.type,Li.arb,!1),null==Li.arb?null!=op&&(op.pair=null):Li.arb.pair=Li}Ni=Li,Li=Li.next}else Li.sleeping=!0,null==Ni?this.pairs=Li.next:Ni.next=Li.next,Li=Li.next}}},St.prototype.clear=function(){for(;null!=this.syncs;){var n=this.syncs.snext;this.syncs.snext=null,this.syncs.first_sync&&(this.syncs.shape.node=null,this.syncs.shape.removedFromSpace(),this.syncs.shape=null),this.syncs=n}for(;null!=this.moves;){var e=this.moves.mnext;this.moves.mnext=null,this.moves.first_sync&&(this.moves.shape.node=null,this.moves.shape.removedFromSpace(),this.moves.shape=null),this.moves=e}for(;null!=this.pairs;){var t=this.pairs.next;null!=this.pairs.arb&&(this.pairs.arb.pair=null),this.pairs.arb=null;for(var i=this.pairs.n1.shape.pairs,p=this.pairs,l=null,r=i.head;null!=r;){if(r.elt==p){var o,a;null==l?(a=(o=i.head).next,i.head=a,null==i.head&&(i.pushmod=!0)):(a=(o=l.next).next,l.next=a,null==a&&(i.pushmod=!0));var s=o;s.elt=null,s.next=Vi.zpp_pool,Vi.zpp_pool=s,i.modified=!0,i.length--,i.pushmod=!0;break}l=r,r=r.next}for(var _=this.pairs.n2.shape.pairs,h=this.pairs,u=null,x=_.head;null!=x;){if(x.elt==h){var d,y;null==u?(y=(d=_.head).next,_.head=y,null==_.head&&(_.pushmod=!0)):(y=(d=u.next).next,u.next=y,null==y&&(_.pushmod=!0));var z=d;z.elt=null,z.next=Vi.zpp_pool,Vi.zpp_pool=z,_.modified=!0,_.length--,_.pushmod=!0;break}u=x,x=x.next}var v=this.pairs;v.n1=v.n2=null,v.sleeping=!1,v.next=Ot.zpp_pool,Ot.zpp_pool=v,this.pairs=t}this.dtree.clear(),this.stree.clear()},St.prototype.treeStack=null,St.prototype.shapesUnderPoint=function(n,e,t,i){var p;this.sync_broadphase(),null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=e;var l=p,r=null==i?new Bn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;if(l.x>=a.minx&&l.x<=a.maxx&&l.y>=a.miny&&l.y<=a.maxy)if(null==o.child1){var s;if(null!=t){var _=o.shape.filter;s=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else s=!0;s&&(0==o.shape.type?Le.circleContains(o.shape.circle,l)&&r.push(o.shape.outer):Le.polyContains(o.shape.polygon,l)&&r.push(o.shape.outer))}else null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var h=this.treeStack.pop_unsafe(),u=h.aabb;if(l.x>=u.minx&&l.x<=u.maxx&&l.y>=u.miny&&l.y<=u.maxy)if(null==h.child1){var x;if(null!=t){var d=h.shape.filter;x=0!=(d.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&d.collisionGroup)}else x=!0;x&&(0==h.shape.type?Le.circleContains(h.shape.circle,l)&&r.push(h.shape.outer):Le.polyContains(h.shape.polygon,l)&&r.push(h.shape.outer))}else null!=h.child1&&this.treeStack.add(h.child1),null!=h.child2&&this.treeStack.add(h.child2)}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=xt.zpp_pool,xt.zpp_pool=l,r},St.prototype.bodiesUnderPoint=function(n,e,t,i){var p;this.sync_broadphase(),null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=e;var l=p,r=null==i?new wn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;if(l.x>=a.minx&&l.x<=a.maxx&&l.y>=a.miny&&l.y<=a.maxy)if(null==o.child1){var s=o.shape.body.outer;if(!r.has(s)){var _;if(null!=t){var h=o.shape.filter;_=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else _=!0;_&&(0==o.shape.type?Le.circleContains(o.shape.circle,l)&&r.push(s):Le.polyContains(o.shape.polygon,l)&&r.push(s))}}else null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),x=u.aabb;if(l.x>=x.minx&&l.x<=x.maxx&&l.y>=x.miny&&l.y<=x.maxy)if(null==u.child1){var d=u.shape.body.outer;if(!r.has(d)){var y;if(null!=t){var z=u.shape.filter;y=0!=(z.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&z.collisionGroup)}else y=!0;y&&(0==u.shape.type?Le.circleContains(u.shape.circle,l)&&r.push(d):Le.polyContains(u.shape.polygon,l)&&r.push(d))}}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=xt.zpp_pool,xt.zpp_pool=l,r},St.prototype.treeStack2=null,St.prototype.shapesInAABB=function(n,e,t,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new Bn:p;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;if(a.minx>=l.minx&&a.miny>=l.miny&&a.maxx<=l.maxx&&a.maxy<=l.maxy)if(null==o.child1){var s;if(null!=i){var _=o.shape.filter;s=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else s=!0;s&&r.push(o.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new pi),this.treeStack2.add(o);null!=this.treeStack2.head;){var h=this.treeStack2.pop_unsafe();if(null==h.child1){var u;if(null!=i){var x=h.shape.filter;u=0!=(x.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&x.collisionGroup)}else u=!0;u&&r.push(h.shape.outer)}else null!=h.child1&&this.treeStack2.add(h.child1),null!=h.child2&&this.treeStack2.add(h.child2)}else{var d=o.aabb;if(l.miny<=d.maxy&&d.miny<=l.maxy&&l.minx<=d.maxx&&d.minx<=l.maxx)if(null==o.child1){var y;if(null!=i){var z=o.shape.filter;y=0!=(z.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&z.collisionGroup)}else y=!0;if(y)if(e)if(t)Le.containTest(this.aabbShape.zpp_inner,o.shape)&&r.push(o.shape.outer);else{var v=o.shape.aabb;v.minx>=l.minx&&v.miny>=l.miny&&v.maxx<=l.maxx&&v.maxy<=l.maxy?r.push(o.shape.outer):Le.testCollide_safe(o.shape,this.aabbShape.zpp_inner)&&r.push(o.shape.outer)}else{var c;if(t){var f=o.shape.aabb;c=f.minx>=l.minx&&f.miny>=l.miny&&f.maxx<=l.maxx&&f.maxy<=l.maxy}else c=!0;c&&r.push(o.shape.outer)}}else null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var m=this.treeStack.pop_unsafe(),b=m.aabb;if(b.minx>=l.minx&&b.miny>=l.miny&&b.maxx<=l.maxx&&b.maxy<=l.maxy)if(null==m.child1){var g;if(null!=i){var w=m.shape.filter;g=0!=(w.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&w.collisionGroup)}else g=!0;g&&r.push(m.shape.outer)}else for(null==this.treeStack2&&(this.treeStack2=new pi),this.treeStack2.add(m);null!=this.treeStack2.head;){var M=this.treeStack2.pop_unsafe();if(null==M.child1){var C;if(null!=i){var k=M.shape.filter;C=0!=(k.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&k.collisionGroup)}else C=!0;C&&r.push(M.shape.outer)}else null!=M.child1&&this.treeStack2.add(M.child1),null!=M.child2&&this.treeStack2.add(M.child2)}else{var O=m.aabb;if(l.miny<=O.maxy&&O.miny<=l.maxy&&l.minx<=O.maxx&&O.minx<=l.maxx)if(null==m.child1){var P;if(null!=i){var S=m.shape.filter;P=0!=(S.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&S.collisionGroup)}else P=!0;if(P)if(e)if(t)Le.containTest(this.aabbShape.zpp_inner,m.shape)&&r.push(m.shape.outer);else{var A=m.shape.aabb;A.minx>=l.minx&&A.miny>=l.miny&&A.maxx<=l.maxx&&A.maxy<=l.maxy?r.push(m.shape.outer):Le.testCollide_safe(m.shape,this.aabbShape.zpp_inner)&&r.push(m.shape.outer)}else{var j;if(t){var E=m.shape.aabb;j=E.minx>=l.minx&&E.miny>=l.miny&&E.maxx<=l.maxx&&E.maxy<=l.maxy}else j=!0;j&&r.push(m.shape.outer)}}else null!=m.child1&&this.treeStack.add(m.child1),null!=m.child2&&this.treeStack.add(m.child2)}}return r},St.prototype.failed=null,St.prototype.bodiesInAABB=function(n,e,t,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new wn:p;if(null==this.failed&&(this.failed=new wn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var o=this.treeStack.pop_unsafe(),a=o.aabb;if(a.minx>=l.minx&&a.miny>=l.miny&&a.maxx<=l.maxx&&a.maxy<=l.maxy)if(null==o.child1){var s;if(null!=i){var _=o.shape.filter;s=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else s=!0;if(s){var h=o.shape.body.outer;r.has(h)||r.push(h)}}else for(null==this.treeStack2&&(this.treeStack2=new pi),this.treeStack2.add(o);null!=this.treeStack2.head;){var u=this.treeStack2.pop_unsafe();if(null==u.child1){var x;if(null!=i){var d=u.shape.filter;x=0!=(d.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&d.collisionGroup)}else x=!0;if(x){var y=u.shape.body.outer;r.has(y)||r.push(y)}}else null!=u.child1&&this.treeStack2.add(u.child1),null!=u.child2&&this.treeStack2.add(u.child2)}else{var z=o.aabb;if(l.miny<=z.maxy&&z.miny<=l.maxy&&l.minx<=z.maxx&&z.minx<=l.maxx)if(null==o.child1){var v,c=o.shape.body.outer;if(null!=i){var f=o.shape.filter;v=0!=(f.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&f.collisionGroup)}else v=!0;if(v)if(e)if(t){if(!this.failed.has(c)){var m=Le.containTest(this.aabbShape.zpp_inner,o.shape);!r.has(c)&&m?r.push(c):m||(r.remove(c),this.failed.push(c))}}else!r.has(c)&&Le.testCollide_safe(o.shape,this.aabbShape.zpp_inner)&&r.push(c);else if(t){if(!this.failed.has(c)){var b=o.shape.aabb,g=b.minx>=l.minx&&b.miny>=l.miny&&b.maxx<=l.maxx&&b.maxy<=l.maxy;!r.has(c)&&g?r.push(c):g||(r.remove(c),this.failed.push(c))}}else{var w;if(r.has(c))w=!1;else{var M=o.shape.aabb;w=M.minx>=l.minx&&M.miny>=l.miny&&M.maxx<=l.maxx&&M.maxy<=l.maxy}w&&r.push(c)}}else null!=o.child1&&this.treeStack.add(o.child1),null!=o.child2&&this.treeStack.add(o.child2)}}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var C=this.treeStack.pop_unsafe(),k=C.aabb;if(k.minx>=l.minx&&k.miny>=l.miny&&k.maxx<=l.maxx&&k.maxy<=l.maxy)if(null==C.child1){var O;if(null!=i){var P=C.shape.filter;O=0!=(P.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&P.collisionGroup)}else O=!0;if(O){var S=C.shape.body.outer;r.has(S)||r.push(S)}}else for(null==this.treeStack2&&(this.treeStack2=new pi),this.treeStack2.add(C);null!=this.treeStack2.head;){var A=this.treeStack2.pop_unsafe();if(null==A.child1){var j;if(null!=i){var E=A.shape.filter;j=0!=(E.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&E.collisionGroup)}else j=!0;if(j){var I=A.shape.body.outer;r.has(I)||r.push(I)}}else null!=A.child1&&this.treeStack2.add(A.child1),null!=A.child2&&this.treeStack2.add(A.child2)}else{var T=C.aabb;if(l.miny<=T.maxy&&T.miny<=l.maxy&&l.minx<=T.maxx&&T.minx<=l.maxx)if(null==C.child1){var N,L=C.shape.body.outer;if(null!=i){var V=C.shape.filter;N=0!=(V.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&V.collisionGroup)}else N=!0;if(N)if(e)if(t){if(!this.failed.has(L)){var D=Le.containTest(this.aabbShape.zpp_inner,C.shape);!r.has(L)&&D?r.push(L):D||(r.remove(L),this.failed.push(L))}}else!r.has(L)&&Le.testCollide_safe(C.shape,this.aabbShape.zpp_inner)&&r.push(L);else if(t){if(!this.failed.has(L)){var F=C.shape.aabb,R=F.minx>=l.minx&&F.miny>=l.miny&&F.maxx<=l.maxx&&F.maxy<=l.maxy;!r.has(L)&&R?r.push(L):R||(r.remove(L),this.failed.push(L))}}else{var Z;if(r.has(L))Z=!1;else{var B=C.shape.aabb;Z=B.minx>=l.minx&&B.miny>=l.miny&&B.maxx<=l.maxx&&B.maxy<=l.maxy}Z&&r.push(L)}}else null!=C.child1&&this.treeStack.add(C.child1),null!=C.child2&&this.treeStack.add(C.child2)}}return this.failed.clear(),r},St.prototype.shapesInCircle=function(n,e,t,i,p,l){this.sync_broadphase(),this.updateCircShape(n,e,t);var r=this.circShape.zpp_inner.aabb,o=null==l?new Bn:l;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;if(r.miny<=s.maxy&&s.miny<=r.maxy&&r.minx<=s.maxx&&s.minx<=r.maxx)if(null==a.child1){var _;if(null!=p){var h=a.shape.filter;_=0!=(h.collisionMask&p.collisionGroup)&&0!=(p.collisionMask&h.collisionGroup)}else _=!0;_&&(i?Le.containTest(this.circShape.zpp_inner,a.shape)&&o.push(a.shape.outer):Le.testCollide_safe(a.shape,this.circShape.zpp_inner)&&o.push(a.shape.outer))}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),x=u.aabb;if(r.miny<=x.maxy&&x.miny<=r.maxy&&r.minx<=x.maxx&&x.minx<=r.maxx)if(null==u.child1){var d;if(null!=p){var y=u.shape.filter;d=0!=(y.collisionMask&p.collisionGroup)&&0!=(p.collisionMask&y.collisionGroup)}else d=!0;d&&(i?Le.containTest(this.circShape.zpp_inner,u.shape)&&o.push(u.shape.outer):Le.testCollide_safe(u.shape,this.circShape.zpp_inner)&&o.push(u.shape.outer))}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}return o},St.prototype.bodiesInCircle=function(n,e,t,i,p,l){this.sync_broadphase(),this.updateCircShape(n,e,t);var r=this.circShape.zpp_inner.aabb,o=null==l?new wn:l;if(null==this.failed&&(this.failed=new wn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var a=this.treeStack.pop_unsafe(),s=a.aabb;if(r.miny<=s.maxy&&s.miny<=r.maxy&&r.minx<=s.maxx&&s.minx<=r.maxx)if(null==a.child1){var _,h=a.shape.body.outer;if(null!=p){var u=a.shape.filter;_=0!=(u.collisionMask&p.collisionGroup)&&0!=(p.collisionMask&u.collisionGroup)}else _=!0;if(_)if(i){if(!this.failed.has(h)){var x=Le.containTest(this.circShape.zpp_inner,a.shape);!o.has(h)&&x?o.push(h):x||(o.remove(h),this.failed.push(h))}}else!o.has(h)&&Le.testCollide_safe(a.shape,this.circShape.zpp_inner)&&o.push(h)}else null!=a.child1&&this.treeStack.add(a.child1),null!=a.child2&&this.treeStack.add(a.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var d=this.treeStack.pop_unsafe(),y=d.aabb;if(r.miny<=y.maxy&&y.miny<=r.maxy&&r.minx<=y.maxx&&y.minx<=r.maxx)if(null==d.child1){var z,v=d.shape.body.outer;if(null!=p){var c=d.shape.filter;z=0!=(c.collisionMask&p.collisionGroup)&&0!=(p.collisionMask&c.collisionGroup)}else z=!0;if(z)if(i){if(!this.failed.has(v)){var f=Le.containTest(this.circShape.zpp_inner,d.shape);!o.has(v)&&f?o.push(v):f||(o.remove(v),this.failed.push(v))}}else!o.has(v)&&Le.testCollide_safe(d.shape,this.circShape.zpp_inner)&&o.push(v)}else null!=d.child1&&this.treeStack.add(d.child1),null!=d.child2&&this.treeStack.add(d.child2)}return this.failed.clear(),o},St.prototype.shapesInShape=function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new Bn:i;if(null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r=this.treeStack.pop_unsafe(),o=r.aabb;if(p.miny<=o.maxy&&o.miny<=p.maxy&&p.minx<=o.maxx&&o.minx<=p.maxx)if(null==r.child1){var a;if(null!=t){var s=r.shape.filter;a=0!=(s.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&s.collisionGroup)}else a=!0;a&&(e?Le.containTest(n,r.shape)&&l.push(r.shape.outer):Le.testCollide_safe(r.shape,n)&&l.push(r.shape.outer))}else null!=r.child1&&this.treeStack.add(r.child1),null!=r.child2&&this.treeStack.add(r.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var _=this.treeStack.pop_unsafe(),h=_.aabb;if(p.miny<=h.maxy&&h.miny<=p.maxy&&p.minx<=h.maxx&&h.minx<=p.maxx)if(null==_.child1){var u;if(null!=t){var x=_.shape.filter;u=0!=(x.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&x.collisionGroup)}else u=!0;u&&(e?Le.containTest(n,_.shape)&&l.push(_.shape.outer):Le.testCollide_safe(_.shape,n)&&l.push(_.shape.outer))}else null!=_.child1&&this.treeStack.add(_.child1),null!=_.child2&&this.treeStack.add(_.child2)}return l},St.prototype.bodiesInShape=function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new wn:i;if(null==this.failed&&(this.failed=new wn),null!=this.stree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.stree.root);null!=this.treeStack.head;){var r=this.treeStack.pop_unsafe(),o=r.aabb;if(p.miny<=o.maxy&&o.miny<=p.maxy&&p.minx<=o.maxx&&o.minx<=p.maxx)if(null==r.child1){var a,s=r.shape.body.outer;if(null!=t){var _=r.shape.filter;a=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else a=!0;if(a)if(e){if(!this.failed.has(s)){var h=Le.containTest(n,r.shape);!l.has(s)&&h?l.push(s):h||(l.remove(s),this.failed.push(s))}}else!l.has(s)&&Le.testCollide_safe(r.shape,n)&&l.push(s)}else null!=r.child1&&this.treeStack.add(r.child1),null!=r.child2&&this.treeStack.add(r.child2)}if(null!=this.dtree.root)for(null==this.treeStack&&(this.treeStack=new pi),this.treeStack.add(this.dtree.root);null!=this.treeStack.head;){var u=this.treeStack.pop_unsafe(),x=u.aabb;if(p.miny<=x.maxy&&x.miny<=p.maxy&&p.minx<=x.maxx&&x.minx<=p.maxx)if(null==u.child1){var d,y=u.shape.body.outer;if(null!=t){var z=u.shape.filter;d=0!=(z.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&z.collisionGroup)}else d=!0;if(d)if(e){if(!this.failed.has(y)){var v=Le.containTest(n,u.shape);!l.has(y)&&v?l.push(y):v||(l.remove(y),this.failed.push(y))}}else!l.has(y)&&Le.testCollide_safe(u.shape,n)&&l.push(y)}else null!=u.child1&&this.treeStack.add(u.child1),null!=u.child2&&this.treeStack.add(u.child2)}return this.failed.clear(),l},St.prototype.openlist=null,St.prototype.rayCast=function(n,e,t){null==this.openlist&&(this.openlist=new pi),this.sync_broadphase(),n.validate_dir();var i=n.maxdist;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb)){var p=n.aabbsect(this.dtree.root.aabb);if(p>=0&&p<i){this.dtree.root.rayt=p;for(var l=null,r=this.openlist.head;null!=r&&!(this.dtree.root.rayt<r.elt.rayt);)l=r,r=r.next;var o,a=this.openlist;null==Fi.zpp_pool?o=new Fi:(o=Fi.zpp_pool,Fi.zpp_pool=o.next,o.next=null),o.elt=this.dtree.root;var s=o;null==l?(s.next=a.head,a.head=s):(s.next=l.next,l.next=s),a.pushmod=a.modified=!0,a.length++}}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb)){var _=n.aabbsect(this.stree.root.aabb);if(_>=0&&_<i){this.stree.root.rayt=_;for(var h=null,u=this.openlist.head;null!=u&&!(this.stree.root.rayt<u.elt.rayt);)h=u,u=u.next;var x,d=this.openlist;null==Fi.zpp_pool?x=new Fi:(x=Fi.zpp_pool,Fi.zpp_pool=x.next,x.next=null),x.elt=this.stree.root;var y=x;null==h?(y.next=d.head,d.head=y):(y.next=h.next,h.next=y),d.pushmod=d.modified=!0,d.length++}}for(var z=null;null!=this.openlist.head;){var v=this.openlist.pop_unsafe();if(v.rayt>=i)break;if(null==v.child1){var c,f=v.shape;if(null!=t){var m=f.filter;c=0!=(m.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&m.collisionGroup)}else c=!0;if(c){var b=0==f.type?n.circlesect(f.circle,e,i):n.aabbtest(f.aabb)?n.polysect(f.polygon,e,i):null;null!=b&&(i=b.zpp_inner.toiDistance,null!=z&&z.zpp_inner.free(),z=b)}}else{if(null!=v.child1&&n.aabbtest(v.child1.aabb)){var g=n.aabbsect(v.child1.aabb);if(g>=0&&g<i){v.child1.rayt=g;for(var w=null,M=this.openlist.head;null!=M&&!(v.child1.rayt<M.elt.rayt);)w=M,M=M.next;var C,k=this.openlist;null==Fi.zpp_pool?C=new Fi:(C=Fi.zpp_pool,Fi.zpp_pool=C.next,C.next=null),C.elt=v.child1;var O=C;null==w?(O.next=k.head,k.head=O):(O.next=w.next,w.next=O),k.pushmod=k.modified=!0,k.length++}}if(null!=v.child2&&n.aabbtest(v.child2.aabb)){var P=n.aabbsect(v.child2.aabb);if(P>=0&&P<i){v.child2.rayt=P;for(var S=null,A=this.openlist.head;null!=A&&!(v.child2.rayt<A.elt.rayt);)S=A,A=A.next;var j,E=this.openlist;null==Fi.zpp_pool?j=new Fi:(j=Fi.zpp_pool,Fi.zpp_pool=j.next,j.next=null),j.elt=v.child2;var I=j;null==S?(I.next=E.head,E.head=I):(I.next=S.next,S.next=I),E.pushmod=E.modified=!0,E.length++}}}}return this.openlist.clear(),z},St.prototype.rayMultiCast=function(n,e,t,i){null==this.openlist&&(this.openlist=new pi),this.sync_broadphase(),n.validate_dir();var p=n.maxdist>=1/0,l=null==i?new dn:i;if(null!=this.dtree.root&&n.aabbtest(this.dtree.root.aabb))if(p)this.openlist.add(this.dtree.root);else{var r=n.aabbsect(this.dtree.root.aabb);r>=0&&r<n.maxdist&&this.openlist.add(this.dtree.root)}if(null!=this.stree.root&&n.aabbtest(this.stree.root.aabb))if(p)this.openlist.add(this.stree.root);else{var o=n.aabbsect(this.stree.root.aabb);o>=0&&o<n.maxdist&&this.openlist.add(this.stree.root)}for(;null!=this.openlist.head;){var a=this.openlist.pop_unsafe();if(null==a.child1){var s,_=a.shape;if(null!=t){var h=_.filter;s=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else s=!0;s&&(0==_.type?n.circlesect2(_.circle,e,l):n.aabbtest(_.aabb)&&n.polysect2(_.polygon,e,l))}else{if(null!=a.child1&&n.aabbtest(a.child1.aabb))if(p)this.openlist.add(a.child1);else{var u=n.aabbsect(a.child1.aabb);u>=0&&u<n.maxdist&&this.openlist.add(a.child1)}if(null!=a.child2&&n.aabbtest(a.child2.aabb))if(p)this.openlist.add(a.child2);else{var x=n.aabbsect(a.child2.aabb);x>=0&&x<n.maxdist&&this.openlist.add(a.child2)}}}return this.openlist.clear(),l},St.prototype.__class__=St;var At=zpp_nape.space.ZPP_Island=function(){this.waket=0,this.sleep=!1,this.comps=null,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.comps=new li};At.__name__=["zpp_nape","space","ZPP_Island"],At.prototype.next=null,At.prototype.elem=function(){return this},At.prototype.begin=function(){return this.next},At.prototype._inuse=null,At.prototype.modified=null,At.prototype.pushmod=null,At.prototype.length=null,At.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},At.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},At.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},At.prototype.addAll=function(n){for(var e=n.next;null!=e;)this.add(e),e=e.next},At.prototype.insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},At.prototype.inlined_insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},At.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},At.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},At.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},At.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},At.prototype.remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},At.prototype.try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},At.prototype.inlined_remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},At.prototype.inlined_try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var p,l;null==e?(l=(p=this.next).next,this.next=l,null==this.next&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0)),p._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},At.prototype.erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},At.prototype.inlined_erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},At.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},At.prototype.clear=function(){},At.prototype.inlined_clear=function(){},At.prototype.reverse=function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},At.prototype.empty=function(){return null==this.next},At.prototype.size=function(){return this.length},At.prototype.has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},At.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},At.prototype.front=function(){return this.next},At.prototype.back=function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},At.prototype.iterator_at=function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},At.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e:null},At.prototype.comps=null,At.prototype.sleep=null,At.prototype.waket=null,At.prototype.free=function(){},At.prototype.alloc=function(){this.waket=0},At.prototype.__class__=At;var jt=zpp_nape.space.ZPP_Component=function(){this.woken=!1,this.waket=0,this.sleeping=!1,this.island=null,this.constraint=null,this.body=null,this.isBody=!1,this.rank=0,this.parent=null,this.next=null,this.sleeping=!1,this.island=null,this.parent=this,this.rank=0,this.woken=!1};jt.__name__=["zpp_nape","space","ZPP_Component"],jt.prototype.next=null,jt.prototype.parent=null,jt.prototype.rank=null,jt.prototype.isBody=null,jt.prototype.body=null,jt.prototype.constraint=null,jt.prototype.island=null,jt.prototype.sleeping=null,jt.prototype.waket=null,jt.prototype.woken=null,jt.prototype.free=function(){this.body=null,this.constraint=null},jt.prototype.alloc=function(){},jt.prototype.reset=function(){this.sleeping=!1,this.island=null,this.parent=this,this.rank=0},jt.prototype.__class__=jt;var Et=zpp_nape.space.ZPP_CallbackSet=function(){this.lazydel=!1,this.freed=!1,this.length=0,this.pushmod=!1,this.modified=!1,this._inuse=!1,this.next=null,this.int2=null,this.int1=null,this.di=0,this.id=0,this.arbiters=new Kt};Et.__name__=["zpp_nape","space","ZPP_CallbackSet"],Et.get=function(n,e){var t;return null==Et.zpp_pool?t=new Et:(t=Et.zpp_pool,Et.zpp_pool=t.next,t.next=null),t.freed=!1,t.lazydel=!1,t.COLLISIONstate=1,t.COLLISIONstamp=0,t.SENSORstate=1,t.SENSORstamp=0,t.FLUIDstate=1,t.FLUIDstamp=0,n.id<e.id?(t.int1=n,t.int2=e):(t.int1=e,t.int2=n),t.id=t.int1.id,t.di=t.int2.id,t},Et.prototype.id=null,Et.prototype.di=null,Et.prototype.int1=null,Et.prototype.int2=null,Et.prototype.arbiters=null,Et.prototype.COLLISIONstate=null,Et.prototype.COLLISIONstamp=null,Et.prototype.SENSORstate=null,Et.prototype.SENSORstamp=null,Et.prototype.FLUIDstate=null,Et.prototype.FLUIDstamp=null,Et.prototype.next=null,Et.prototype.elem=function(){return this},Et.prototype.begin=function(){return this.next},Et.prototype._inuse=null,Et.prototype.modified=null,Et.prototype.pushmod=null,Et.prototype.length=null,Et.prototype.setbegin=function(n){this.next=n,this.modified=!0,this.pushmod=!0},Et.prototype.add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Et.prototype.inlined_add=function(n){return n._inuse=!0,n.next=this.next,this.next=n,this.modified=!0,this.length++,n},Et.prototype.addAll=function(n){for(var e=n.next;null!=e;)this.add(e),e=e.next},Et.prototype.insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Et.prototype.inlined_insert=function(n,e){return e._inuse=!0,null==n?(e.next=this.next,this.next=e):(e.next=n.next,n.next=e),this.pushmod=this.modified=!0,this.length++,e},Et.prototype.pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Et.prototype.inlined_pop=function(){var n=this.next;this.next=n.next,n._inuse=!1,null==this.next&&(this.pushmod=!0),this.modified=!0,this.length--},Et.prototype.pop_unsafe=function(){var n=this.next;return this.pop(),n},Et.prototype.inlined_pop_unsafe=function(){var n=this.next;return this.pop(),n},Et.prototype.remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Et.prototype.try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Et.prototype.inlined_remove=function(n){for(var e=null,t=this.next;null!=t;){if(t==n){var i,p;null==e?(p=(i=this.next).next,this.next=p,null==this.next&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0)),i._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Et.prototype.inlined_try_remove=function(n){for(var e=null,t=this.next,i=!1;null!=t;){if(t==n){var p,l;null==e?(l=(p=this.next).next,this.next=l,null==this.next&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0)),p._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Et.prototype.erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},Et.prototype.inlined_erase=function(n){var e,t;return null==n?(t=(e=this.next).next,this.next=t,null==this.next&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0)),e._inuse=!1,this.modified=!0,this.length--,this.pushmod=!0,t},Et.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Et.prototype.clear=function(){},Et.prototype.inlined_clear=function(){},Et.prototype.reverse=function(){for(var n=this.next,e=null;null!=n;){var t=n.next;n.next=e,this.next=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Et.prototype.empty=function(){return null==this.next},Et.prototype.size=function(){return this.length},Et.prototype.has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},Et.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.next;null!=t;){if(t==n){e=!0;break}t=t.next}return e},Et.prototype.front=function(){return this.next},Et.prototype.back=function(){for(var n=this.next,e=n;null!=e;)n=e,e=e.next;return n},Et.prototype.iterator_at=function(n){for(var e=this.next;n-- >0&&null!=e;)e=e.next;return e},Et.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e:null},Et.prototype.freed=null,Et.prototype.lazydel=null,Et.prototype.free=function(){this.int1=this.int2=null,this.id=this.di=-1,this.freed=!0},Et.prototype.alloc=function(){this.freed=!1,this.lazydel=!1,this.COLLISIONstate=1,this.COLLISIONstamp=0,this.SENSORstate=1,this.SENSORstamp=0,this.FLUIDstate=1,this.FLUIDstamp=0},Et.prototype.add_arb=function(n){var e;e=!1;for(var t=this.arbiters.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}if(e)return!1;var i,p=this.arbiters;null==bi.zpp_pool?i=new bi:(i=bi.zpp_pool,bi.zpp_pool=i.next,i.next=null),i.elt=n;var l=i;return l.next=p.head,p.head=l,p.modified=!0,p.length++,!0},Et.prototype.try_remove_arb=function(n){for(var e=this.arbiters,t=null,i=e.head,p=!1;null!=i;){if(i.elt==n){var l,r;null==t?(r=(l=e.head).next,e.head=r,null==e.head&&(e.pushmod=!0)):(r=(l=t.next).next,t.next=r,null==r&&(e.pushmod=!0));var o=l;o.elt=null,o.next=bi.zpp_pool,bi.zpp_pool=o,e.modified=!0,e.length--,e.pushmod=!0,p=!0;break}t=i,i=i.next}return p},Et.prototype.remove_arb=function(n){for(var e=this.arbiters,t=null,i=e.head;null!=i;){if(i.elt==n){var p,l;null==t?(l=(p=e.head).next,e.head=l,null==e.head&&(e.pushmod=!0)):(l=(p=t.next).next,t.next=l,null==l&&(e.pushmod=!0));var r=p;r.elt=null,r.next=bi.zpp_pool,bi.zpp_pool=r,e.modified=!0,e.length--,e.pushmod=!0;break}t=i,i=i.next}},Et.prototype.empty_arb=function(n){var e;e=!0;for(var t=this.arbiters.head;null!=t;){if(0!=(t.elt.type&n)){e=!1;break}t=t.next}return e},Et.prototype.really_empty=function(){return null==this.arbiters.head},Et.prototype.sleeping=function(){var n;n=!0;for(var e=this.arbiters.head;null!=e;){if(!e.elt.sleeping){n=!1;break}e=e.next}return n},Et.prototype.__class__=Et;var It=zpp_nape.space.ZPP_CbSetManager=function(n){this.space=null,this.cbsets=null,null==bp.zpp_pool?this.cbsets=new bp:(this.cbsets=bp.zpp_pool,bp.zpp_pool=this.cbsets.next,this.cbsets.next=null),this.cbsets.lt=$n.setlt,this.space=n};It.__name__=["zpp_nape","space","ZPP_CbSetManager"],It.prototype.cbsets=null,It.prototype.space=null,It.prototype.get=function(n){if(null==n.head)return null;var e;null==$n.zpp_pool?e=new $n:(e=$n.zpp_pool,$n.zpp_pool=e.next,e.next=null);var t=e.cbTypes;e.cbTypes=n;var i,p=this.cbsets.find_weak(e);if(null!=p)i=p.data;else{var l=$n.get(n);this.cbsets.insert(l),l.manager=this,i=l}e.cbTypes=t;var r=e;for(r.listeners.clear(),r.zip_listeners=!0,r.bodylisteners.clear(),r.zip_bodylisteners=!0,r.conlisteners.clear(),r.zip_conlisteners=!0;null!=r.cbTypes.head;)r.cbTypes.pop_unsafe().cbsets.remove(r);return r.next=$n.zpp_pool,$n.zpp_pool=r,i},It.prototype.remove=function(n){for(this.cbsets.remove(n);null!=n.cbpairs.head;){var e=n.cbpairs.pop_unsafe();e.a!=e.b&&(n==e.a?e.b.cbpairs.remove(e):e.a.cbpairs.remove(e)),e.a=e.b=null,e.listeners.clear(),e.next=Qn.zpp_pool,Qn.zpp_pool=e}n.manager=null},It.prototype.clear=function(){},It.prototype.validate=function(){if(!this.cbsets.empty()){for(var n=this.cbsets.parent;null!=n.prev;)n=n.prev;for(;null!=n;)if(n.data.validate(),null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}},It.prototype.pair=function(n,e){for(var t,i=null,p=(n.cbpairs.length<e.cbpairs.length?n.cbpairs:e.cbpairs).head;null!=p;){var l=p.elt;if(l.a==n&&l.b==e||l.a==e&&l.b==n){i=l;break}p=p.next}null==i&&(null==Qn.zpp_pool?t=new Qn:(t=Qn.zpp_pool,Qn.zpp_pool=t.next,t.next=null),t.zip_listeners=!0,$n.setlt(n,e)?(t.a=n,t.b=e):(t.a=e,t.b=n),i=t,n.cbpairs.add(i),e!=n&&e.cbpairs.add(i));return i.zip_listeners&&(i.zip_listeners=!1,i.__validate()),i},It.prototype.valid_listener=function(n){return n.space==this.space},It.prototype.__class__=It;var Tt=zpp_nape.space.ZPP_Space=function(n,t){var i;this.prelisteners=null,this.precb=null,this.continuous=!1,this.toiEvents=null,this.pre_dt=0,this.convexShapeList=null,this.cbsets=null,this.callbackset_list=null,this.callbacks=null,this.wrap_listeners=null,this.listeners=null,this.islands=null,this.staticsleep=null,this.wrap_livecon=null,this.live_constraints=null,this.wrap_live=null,this.live=null,this.wrap_arbiters=null,this.s_arbiters=null,this.f_arbiters=null,this.c_arbiters_false=null,this.c_arbiters_true=null,this.sortcontacts=!1,this.time=0,this.midstep=!1,this.stamp=0,this.global_ang_drag=0,this.global_lin_drag=0,this.__static=null,this.bphase=null,this.kinematics=null,this.wrap_constraints=null,this.constraints=null,this.wrap_compounds=null,this.compounds=null,this.wrap_bodies=null,this.bodies=null,this.wrap_gravity=null,this.gravityy=0,this.gravityx=0,this.userData=null,this.outer=null,this.toiEvents=new hi,this.global_lin_drag=.015,this.global_ang_drag=.015,this.precb=new C,this.precb.zpp_inner=new Hn,this.sortcontacts=!0,this.pre_dt=0,null!=t?(null==oe.Broadphase_DYNAMIC_AABB_TREE&&(oe.internal=!0,oe.Broadphase_DYNAMIC_AABB_TREE=new Un,oe.internal=!1),i=t==oe.Broadphase_DYNAMIC_AABB_TREE):i=!0,i?this.bphase=new St(this):(null==oe.Broadphase_SWEEP_AND_PRUNE&&(oe.internal=!0,oe.Broadphase_SWEEP_AND_PRUNE=new Un,oe.internal=!1),t==oe.Broadphase_SWEEP_AND_PRUNE&&(this.bphase=new Lt(this))),this.time=0,null!=n?(this.gravityx=n.x,this.gravityy=n.y):(this.gravityx=0,this.gravityy=0),this.bodies=new qt,this.wrap_bodies=$i.get(this.bodies),this.wrap_bodies.zpp_inner.adder=e(this,this.bodies_adder),this.wrap_bodies.zpp_inner.subber=e(this,this.bodies_subber),this.compounds=new Ut,this.wrap_compounds=np.get(this.compounds),this.wrap_compounds.zpp_inner.adder=e(this,this.compounds_adder),this.wrap_compounds.zpp_inner.subber=e(this,this.compounds_subber),this.kinematics=new qt,this.c_arbiters_true=new si,this.c_arbiters_false=new si,this.f_arbiters=new ri,this.s_arbiters=new oi,this.islands=new At,this.live=new qt,this.wrap_live=$i.get(this.live,!0),this.staticsleep=new qt,this.constraints=new ie,this.wrap_constraints=Hi.get(this.constraints),this.wrap_constraints.zpp_inner.adder=e(this,this.constraints_adder),this.wrap_constraints.zpp_inner.subber=e(this,this.constraints_subber),this.live_constraints=new ie,this.wrap_livecon=Hi.get(this.live_constraints,!0),this.__static=vt.__static(),this.__static.zpp_inner.space=this,this.callbacks=new Hn,this.midstep=!1,this.listeners=new ai,this.wrap_listeners=ep.get(this.listeners),this.wrap_listeners.zpp_inner.adder=e(this,this.listeners_adder),this.wrap_listeners.zpp_inner.subber=e(this,this.listeners_subber),this.callbackset_list=new Et,this.mrca1=new pe,this.mrca2=new pe,this.prelisteners=new ne,this.cbsets=new It(this)};Tt.__name__=["zpp_nape","space","ZPP_Space"],Tt.prototype.outer=null,Tt.prototype.userData=null,Tt.prototype.gravityx=null,Tt.prototype.gravityy=null,Tt.prototype.wrap_gravity=null,Tt.prototype.getgravity=function(){var n,t=this.gravityx,i=this.gravityy;if(null==xp.poolVec2?n=new yn:(n=xp.poolVec2,xp.poolVec2=n.zpp_pool,n.zpp_pool=null),null==n.zpp_inner){var p;null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=t,p.y=i,n.zpp_inner=p,n.zpp_inner.outer=n}else{var l,r=n.zpp_inner;if(null!=r._validate&&r._validate(),n.zpp_inner.x==t){var o=n.zpp_inner;null!=o._validate&&o._validate(),l=n.zpp_inner.y==i}else l=!1;if(!l){n.zpp_inner.x=t,n.zpp_inner.y=i;var a=n.zpp_inner;null!=a._invalidate&&a._invalidate(a)}}n.zpp_inner.weak=!1,this.wrap_gravity=n,this.wrap_gravity.zpp_inner._inuse=!0,this.wrap_gravity.zpp_inner._invalidate=e(this,this.gravity_invalidate),this.wrap_gravity.zpp_inner._validate=e(this,this.gravity_validate)},Tt.prototype.gravity_invalidate=function(n){this.gravityx=n.x,this.gravityy=n.y;for(var e=new Ut,t=this.bodies.head;null!=t;){var i=t.elt;i.world||(i.component.waket=this.stamp+(this.midstep?0:1),3==i.type&&(i.kinematicDelaySleep=!0),i.component.sleeping&&this.really_wake(i,!1)),t=t.next}for(var p=this.compounds.head;null!=p;)e.add(p.elt),p=p.next;for(;null!=e.head;){for(var l=e.pop_unsafe(),r=l.bodies.head;null!=r;){var o=r.elt;o.world||(o.component.waket=this.stamp+(this.midstep?0:1),3==o.type&&(o.kinematicDelaySleep=!0),o.component.sleeping&&this.really_wake(o,!1)),r=r.next}for(var a=l.compounds.head;null!=a;)e.add(a.elt),a=a.next}},Tt.prototype.gravity_validate=function(){this.wrap_gravity.zpp_inner.x=this.gravityx,this.wrap_gravity.zpp_inner.y=this.gravityy},Tt.prototype.bodies=null,Tt.prototype.wrap_bodies=null,Tt.prototype.compounds=null,Tt.prototype.wrap_compounds=null,Tt.prototype.constraints=null,Tt.prototype.wrap_constraints=null,Tt.prototype.kinematics=null,Tt.prototype.bphase=null,Tt.prototype.__static=null,Tt.prototype.global_lin_drag=null,Tt.prototype.global_ang_drag=null,Tt.prototype.stamp=null,Tt.prototype.midstep=null,Tt.prototype.time=null,Tt.prototype.sortcontacts=null,Tt.prototype.c_arbiters_true=null,Tt.prototype.c_arbiters_false=null,Tt.prototype.f_arbiters=null,Tt.prototype.s_arbiters=null,Tt.prototype.wrap_arbiters=null,Tt.prototype.live=null,Tt.prototype.wrap_live=null,Tt.prototype.live_constraints=null,Tt.prototype.wrap_livecon=null,Tt.prototype.staticsleep=null,Tt.prototype.islands=null,Tt.prototype.listeners=null,Tt.prototype.wrap_listeners=null,Tt.prototype.callbacks=null,Tt.prototype.callbackset_list=null,Tt.prototype.cbsets=null,Tt.prototype.clear=function(){for(;null!=this.listeners.head;)this.remListener(this.listeners.pop_unsafe());for(;null!=this.callbackset_list.next;){var n=this.callbackset_list.pop_unsafe();n.arbiters.clear(),n.int1=n.int2=null,n.id=n.di=-1,n.freed=!0,n.next=Et.zpp_pool,Et.zpp_pool=n}for(;null!=this.c_arbiters_true.head;){var e=this.c_arbiters_true.pop_unsafe();if(!e.cleared){for(var t=e.b1.arbiters,i=null,p=t.head;null!=p;){if(p.elt==e){var l,r;null==i?(r=(l=t.head).next,t.head=r,null==t.head&&(t.pushmod=!0)):(r=(l=i.next).next,i.next=r,null==r&&(t.pushmod=!0));var o=l;o.elt=null,o.next=bi.zpp_pool,bi.zpp_pool=o,t.modified=!0,t.length--,t.pushmod=!0;break}i=p,p=p.next}for(var a=e.b2.arbiters,s=null,_=a.head;null!=_;){if(_.elt==e){var h,u;null==s?(u=(h=a.head).next,a.head=u,null==a.head&&(a.pushmod=!0)):(u=(h=s.next).next,s.next=u,null==u&&(a.pushmod=!0));var x=h;x.elt=null,x.next=bi.zpp_pool,bi.zpp_pool=x,a.modified=!0,a.length--,a.pushmod=!0;break}s=_,_=_.next}null!=e.pair&&(e.pair.arb=null,e.pair=null)}for(e.b1=e.b2=null,e.active=!1,e.intchange=!1;null!=e.contacts.next;){var d=e.contacts,y=d.next;d.pop(),y.arbiter=null,y.next=Se.zpp_pool,Se.zpp_pool=y;var z=e.innards,v=z.next;z.next=v.next,v._inuse=!1,null==z.next&&(z.pushmod=!0),z.modified=!0,z.length--}e.userdef_dyn_fric=!1,e.userdef_stat_fric=!1,e.userdef_restitution=!1,e.userdef_rfric=!1,e.__ref_edge1=e.__ref_edge2=null,e.next=Pe.zpp_pool,Pe.zpp_pool=e,e.pre_dt=-1}for(;null!=this.c_arbiters_false.head;){var c=this.c_arbiters_false.pop_unsafe();if(!c.cleared){for(var f=c.b1.arbiters,m=null,b=f.head;null!=b;){if(b.elt==c){var g,w;null==m?(w=(g=f.head).next,f.head=w,null==f.head&&(f.pushmod=!0)):(w=(g=m.next).next,m.next=w,null==w&&(f.pushmod=!0));var M=g;M.elt=null,M.next=bi.zpp_pool,bi.zpp_pool=M,f.modified=!0,f.length--,f.pushmod=!0;break}m=b,b=b.next}for(var C=c.b2.arbiters,k=null,O=C.head;null!=O;){if(O.elt==c){var P,S;null==k?(S=(P=C.head).next,C.head=S,null==C.head&&(C.pushmod=!0)):(S=(P=k.next).next,k.next=S,null==S&&(C.pushmod=!0));var A=P;A.elt=null,A.next=bi.zpp_pool,bi.zpp_pool=A,C.modified=!0,C.length--,C.pushmod=!0;break}k=O,O=O.next}null!=c.pair&&(c.pair.arb=null,c.pair=null)}for(c.b1=c.b2=null,c.active=!1,c.intchange=!1;null!=c.contacts.next;){var j=c.contacts,E=j.next;j.pop(),E.arbiter=null,E.next=Se.zpp_pool,Se.zpp_pool=E;var I=c.innards,T=I.next;I.next=T.next,T._inuse=!1,null==I.next&&(I.pushmod=!0),I.modified=!0,I.length--}c.userdef_dyn_fric=!1,c.userdef_stat_fric=!1,c.userdef_restitution=!1,c.userdef_rfric=!1,c.__ref_edge1=c.__ref_edge2=null,c.next=Pe.zpp_pool,Pe.zpp_pool=c,c.pre_dt=-1}for(;null!=this.s_arbiters.head;){var N=this.s_arbiters.pop_unsafe();if(!N.cleared){for(var L=N.b1.arbiters,V=null,D=L.head;null!=D;){if(D.elt==N){var F,R;null==V?(R=(F=L.head).next,L.head=R,null==L.head&&(L.pushmod=!0)):(R=(F=V.next).next,V.next=R,null==R&&(L.pushmod=!0));var Z=F;Z.elt=null,Z.next=bi.zpp_pool,bi.zpp_pool=Z,L.modified=!0,L.length--,L.pushmod=!0;break}V=D,D=D.next}for(var B=N.b2.arbiters,G=null,q=B.head;null!=q;){if(q.elt==N){var U,K;null==G?(K=(U=B.head).next,B.head=K,null==B.head&&(B.pushmod=!0)):(K=(U=G.next).next,G.next=K,null==K&&(B.pushmod=!0));var W=U;W.elt=null,W.next=bi.zpp_pool,bi.zpp_pool=W,B.modified=!0,B.length--,B.pushmod=!0;break}G=q,q=q.next}null!=N.pair&&(N.pair.arb=null,N.pair=null)}N.b1=N.b2=null,N.active=!1,N.intchange=!1,N.next=ke.zpp_pool,ke.zpp_pool=N}for(;null!=this.f_arbiters.head;){var Y=this.f_arbiters.pop_unsafe();if(!Y.cleared){for(var J=Y.b1.arbiters,X=null,H=J.head;null!=H;){if(H.elt==Y){var $,Q;null==X?(Q=($=J.head).next,J.head=Q,null==J.head&&(J.pushmod=!0)):(Q=($=X.next).next,X.next=Q,null==Q&&(J.pushmod=!0));var nn=$;nn.elt=null,nn.next=bi.zpp_pool,bi.zpp_pool=nn,J.modified=!0,J.length--,J.pushmod=!0;break}X=H,H=H.next}for(var en=Y.b2.arbiters,tn=null,pn=en.head;null!=pn;){if(pn.elt==Y){var ln,rn;null==tn?(rn=(ln=en.head).next,en.head=rn,null==en.head&&(en.pushmod=!0)):(rn=(ln=tn.next).next,tn.next=rn,null==rn&&(en.pushmod=!0));var on=ln;on.elt=null,on.next=bi.zpp_pool,bi.zpp_pool=on,en.modified=!0,en.length--,en.pushmod=!0;break}tn=pn,pn=pn.next}null!=Y.pair&&(Y.pair.arb=null,Y.pair=null)}Y.b1=Y.b2=null,Y.active=!1,Y.intchange=!1,Y.next=Oe.zpp_pool,Oe.zpp_pool=Y,Y.pre_dt=-1}for(this.bphase.clear();null!=this.bodies.head;){var an=this.bodies.pop_unsafe();if(null!=an.component){var sn=an.component.island;if(null!=sn){for(;null!=sn.comps.head;){var _n=sn.comps.pop_unsafe();_n.sleeping=!1,_n.island=null,_n.parent=_n,_n.rank=0}sn.next=At.zpp_pool,At.zpp_pool=sn}}an.removedFromSpace(),an.space=null}for(;null!=this.constraints.head;){var hn=this.constraints.pop_unsafe();if(null!=hn.component){var un=hn.component.island;if(null!=un){for(;null!=un.comps.head;){var xn=un.comps.pop_unsafe();xn.sleeping=!1,xn.island=null,xn.parent=xn,xn.rank=0}un.next=At.zpp_pool,At.zpp_pool=un}}hn.removedFromSpace(),hn.space=null}this.kinematics.clear();for(var dn=new Ut;null!=this.compounds.head;)dn.add(this.compounds.pop_unsafe());for(;null!=dn.head;){var yn=dn.pop_unsafe();yn.removedFromSpace(),yn.space=null;for(var zn=yn.bodies.head;null!=zn;){var vn=zn.elt;if(null!=vn.component){var cn=vn.component.island;if(null!=cn){for(;null!=cn.comps.head;){var fn=cn.comps.pop_unsafe();fn.sleeping=!1,fn.island=null,fn.parent=fn,fn.rank=0}cn.next=At.zpp_pool,At.zpp_pool=cn}}vn.removedFromSpace(),vn.space=null,zn=zn.next}for(var mn=yn.constraints.head;null!=mn;){var bn=mn.elt;if(null!=bn.component){var gn=bn.component.island;if(null!=gn){for(;null!=gn.comps.head;){var wn=gn.comps.pop_unsafe();wn.sleeping=!1,wn.island=null,wn.parent=wn,wn.rank=0}gn.next=At.zpp_pool,At.zpp_pool=gn}}bn.removedFromSpace(),bn.space=null,mn=mn.next}for(var Mn=yn.compounds.head;null!=Mn;)dn.add(Mn.elt),Mn=Mn.next}this.staticsleep.clear(),this.live.clear(),this.live_constraints.clear(),this.stamp=0,this.time=0,this.mrca1.clear(),this.mrca2.clear(),this.prelisteners.clear(),this.cbsets.clear()},Tt.prototype.bodies_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_bodies.remove(n),this.addBody(n.zpp_inner),!0)},Tt.prototype.bodies_subber=function(n){this.remBody(n.zpp_inner)},Tt.prototype.compounds_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.wrap_compounds.remove(n),this.addCompound(n.zpp_inner),!0)},Tt.prototype.compounds_subber=function(n){this.remCompound(n.zpp_inner)},Tt.prototype.constraints_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_constraints.remove(n),this.addConstraint(n.zpp_inner),!0)},Tt.prototype.constraints_subber=function(n){this.remConstraint(n.zpp_inner)},Tt.prototype.listeners_adder=function(n){return n.zpp_inner.space!=this&&(null!=n.zpp_inner.space&&n.zpp_inner.space.outer.zpp_inner.wrap_listeners.remove(n),this.addListener(n.zpp_inner),!0)},Tt.prototype.listeners_subber=function(n){this.remListener(n.zpp_inner)},Tt.prototype.revoke_listener=function(n){},Tt.prototype.unrevoke_listener=function(n){},Tt.prototype.addListener=function(n){n.space=this,n.addedToSpace()},Tt.prototype.remListener=function(n){n.removedFromSpace(),n.space=null},Tt.prototype.add_callbackset=function(n){var e,t=n.int1.cbsets;null==zi.zpp_pool?e=new zi:(e=zi.zpp_pool,zi.zpp_pool=e.next,e.next=null),e.elt=n;var i=e;i.next=t.head,t.head=i,t.modified=!0,t.length++;var p,l=n.int2.cbsets;null==zi.zpp_pool?p=new zi:(p=zi.zpp_pool,zi.zpp_pool=p.next,p.next=null),p.elt=n;var r=p;r.next=l.head,l.head=r,l.modified=!0,l.length++;var o=this.callbackset_list;n._inuse=!0,n.next=o.next,o.next=n,o.modified=!0,o.length++},Tt.prototype.remove_callbackset=function(n){n.lazydel=!0;for(var e=n.int1.cbsets,t=null,i=e.head;null!=i;){if(i.elt==n){var p,l;null==t?(l=(p=e.head).next,e.head=l,null==e.head&&(e.pushmod=!0)):(l=(p=t.next).next,t.next=l,null==l&&(e.pushmod=!0));var r=p;r.elt=null,r.next=zi.zpp_pool,zi.zpp_pool=r,e.modified=!0,e.length--,e.pushmod=!0;break}t=i,i=i.next}for(var o=n.int2.cbsets,a=null,s=o.head;null!=s;){if(s.elt==n){var _,h;null==a?(h=(_=o.head).next,o.head=h,null==o.head&&(o.pushmod=!0)):(h=(_=a.next).next,a.next=h,null==h&&(o.pushmod=!0));var u=_;u.elt=null,u.next=zi.zpp_pool,zi.zpp_pool=u,o.modified=!0,o.length--,o.pushmod=!0;break}a=s,s=s.next}},Tt.prototype.transmitType=function(n,e){n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!1)),2==n.type?this.live.remove(n):3==n.type?(this.kinematics.remove(n),this.staticsleep.remove(n)):1==n.type&&this.staticsleep.remove(n),n.type=e,3==n.type&&this.kinematics.add(n),1==n.type&&this.static_validation(n),n.component.sleeping=!0,n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0))},Tt.prototype.added_shape=function(n,e){if(null==e&&(e=!1),!e){var t=n.body;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1))}this.bphase.insert(n),n.addedToSpace()},Tt.prototype.removed_shape=function(n,e){null==e&&(e=!1);var t=n.body;e||t.wake();for(var i=null,p=t.arbiters.head;null!=p;){var l=p.elt;if(l.ws1!=n&&l.ws2!=n)i=p,p=p.next;else{if(0!=l.present){this.MRCA_chains(l.ws1,l.ws2);for(var r=this.mrca1.head;null!=r;){for(var o=r.elt,a=this.mrca2.head;null!=a;){var s=a.elt,_=o.cbSet,h=s.cbSet;_.validate(),h.validate();for(var u,x=null,d=(_.cbpairs.length<h.cbpairs.length?_.cbpairs:h.cbpairs).head;null!=d;){var y=d.elt;if(y.a==_&&y.b==h||y.a==h&&y.b==_){x=y;break}d=d.next}if(null==x)null==Qn.zpp_pool?u=new Qn:(u=Qn.zpp_pool,Qn.zpp_pool=u.next,u.next=null),u.zip_listeners=!0,$n.setlt(_,h)?(u.a=_,u.b=h):(u.a=h,u.b=_),x=u,_.cbpairs.add(x),h!=_&&h.cbpairs.add(x);if(x.zip_listeners&&(x.zip_listeners=!1,x.__validate()),null!=x.listeners.head){var z=zt.get(o,s);z.remove_arb(l),l.present--;for(var v,c=null,f=(_.cbpairs.length<h.cbpairs.length?_.cbpairs:h.cbpairs).head;null!=f;){var m=f.elt;if(m.a==_&&m.b==h||m.a==h&&m.b==_){c=m;break}f=f.next}if(null==c)null==Qn.zpp_pool?v=new Qn:(v=Qn.zpp_pool,Qn.zpp_pool=v.next,v.next=null),v.zip_listeners=!0,$n.setlt(_,h)?(v.a=_,v.b=h):(v.a=h,v.b=_),c=v,_.cbpairs.add(c),h!=_&&h.cbpairs.add(c);c.zip_listeners&&(c.zip_listeners=!1,c.__validate());for(var b=c.listeners.head;null!=b;){var g=b.elt;if(1==g.event&&0!=(g.itype&l.type)&&z.empty_arb(g.itype)){var w=this.push_callback(g);w.event=1;var M,C=z.int1,k=z.int2,O=g.options1,P=C.cbTypes;if(O.nonemptyintersection(P,O.includes)&&!O.nonemptyintersection(P,O.excludes)){var S=g.options2,A=k.cbTypes;M=!!S.nonemptyintersection(A,S.includes)&&!S.nonemptyintersection(A,S.excludes)}else M=!1;M?(w.int1=C,w.int2=k):(w.int1=k,w.int2=C),w.set=z}b=b.next}null==z.arbiters.head&&this.remove_callbackset(z),a=a.next}else a=a.next}r=r.next}}if(l.b1!=t&&2==l.b1.type){var j=l.b1;j.world||(j.component.waket=this.stamp+(this.midstep?0:1),3==j.type&&(j.kinematicDelaySleep=!0),j.component.sleeping&&this.really_wake(j,!1))}if(l.b2!=t&&2==l.b2.type){var E=l.b2;E.world||(E.component.waket=this.stamp+(this.midstep?0:1),3==E.type&&(E.kinematicDelaySleep=!0),E.component.sleeping&&this.really_wake(E,!1))}if(l.cleared=!0,null==t||l.b2==t)for(var I=l.b1.arbiters,T=null,N=I.head;null!=N;){if(N.elt==l){var L,V;null==T?(V=(L=I.head).next,I.head=V,null==I.head&&(I.pushmod=!0)):(V=(L=T.next).next,T.next=V,null==V&&(I.pushmod=!0));var D=L;D.elt=null,D.next=bi.zpp_pool,bi.zpp_pool=D,I.modified=!0,I.length--,I.pushmod=!0;break}T=N,N=N.next}if(null==t||l.b1==t)for(var F=l.b2.arbiters,R=null,Z=F.head;null!=Z;){if(Z.elt==l){var B,G;null==R?(G=(B=F.head).next,F.head=G,null==F.head&&(F.pushmod=!0)):(G=(B=R.next).next,R.next=G,null==G&&(F.pushmod=!0));var q=B;q.elt=null,q.next=bi.zpp_pool,bi.zpp_pool=q,F.modified=!0,F.length--,F.pushmod=!0;break}R=Z,Z=Z.next}null!=l.pair&&(l.pair.arb=null,l.pair=null),l.active=!1,this.f_arbiters.modified=!0,p=t.arbiters.erase(i)}}this.bphase.remove(n),n.removedFromSpace()},Tt.prototype.addConstraint=function(n){n.space=this,n.addedToSpace(),n.active&&(n.component.sleeping=!0,this.wake_constraint(n,!0))},Tt.prototype.remConstraint=function(n){n.active&&(this.wake_constraint(n,!0),this.live_constraints.remove(n)),n.removedFromSpace(),n.space=null},Tt.prototype.addCompound=function(n){n.space=this,n.addedToSpace();for(var e=n.bodies.head;null!=e;)this.addBody(e.elt),e=e.next;for(var t=n.constraints.head;null!=t;)this.addConstraint(t.elt),t=t.next;for(var i=n.compounds.head;null!=i;)this.addCompound(i.elt),i=i.next},Tt.prototype.remCompound=function(n){for(var e=n.bodies.head;null!=e;)this.remBody(e.elt),e=e.next;for(var t=n.constraints.head;null!=t;)this.remConstraint(t.elt),t=t.next;for(var i=n.compounds.head;null!=i;)this.remCompound(i.elt),i=i.next;n.removedFromSpace(),n.space=null},Tt.prototype.addBody=function(n,e){null==e&&(e=-1),n.space=this,n.addedToSpace(),n.component.sleeping=!0,n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0));for(var t=n.shapes.head;null!=t;){var i=t.elt;this.bphase.insert(i),i.addedToSpace(),t=t.next}1==n.type?this.static_validation(n):2!=n.type&&3!=e&&this.kinematics.add(n)},Tt.prototype.remBody=function(n,e){null==e&&(e=-1),1==n.type?(n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.staticsleep.remove(n)):2==n.type?(n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.live.remove(n)):(3!=e&&this.kinematics.remove(n),n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,!0)),this.staticsleep.remove(n));for(var t=n.shapes.head;null!=t;)this.removed_shape(t.elt,!0),t=t.next;n.removedFromSpace(),n.space=null},Tt.prototype.shapesUnderPoint=function(n,e,t,i){return this.bphase.shapesUnderPoint(n,e,t,i)},Tt.prototype.bodiesUnderPoint=function(n,e,t,i){return this.bphase.bodiesUnderPoint(n,e,t,i)},Tt.prototype.shapesInAABB=function(n,e,t,i,p){return this.bphase.shapesInAABB(n.zpp_inner,e,t,i,p)},Tt.prototype.bodiesInAABB=function(n,e,t,i,p){return this.bphase.bodiesInAABB(n.zpp_inner,e,t,i,p)},Tt.prototype.shapesInCircle=function(n,e,t,i,p){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,o=n.zpp_inner;return null!=o._validate&&o._validate(),this.bphase.shapesInCircle(r,n.zpp_inner.y,e,t,i,p)},Tt.prototype.bodiesInCircle=function(n,e,t,i,p){var l=n.zpp_inner;null!=l._validate&&l._validate();var r=n.zpp_inner.x,o=n.zpp_inner;return null!=o._validate&&o._validate(),this.bphase.bodiesInCircle(r,n.zpp_inner.y,e,t,i,p)},Tt.prototype.shapesInShape=function(n,e,t,i){return this.bphase.shapesInShape(n,e,t,i)},Tt.prototype.bodiesInShape=function(n,e,t,i){return this.bphase.bodiesInShape(n,e,t,i)},Tt.prototype.rayCast=function(n,e,t){return this.bphase.rayCast(n.zpp_inner,e,null==t?null:t.zpp_inner)},Tt.prototype.rayMultiCast=function(n,e,t,i){return this.bphase.rayMultiCast(n.zpp_inner,e,null==t?null:t.zpp_inner,i)},Tt.prototype.convexShapeList=null,Tt.prototype.convexCast=function(n,e,t,i){var p;if(null==st.zpp_pool?p=new st:(p=st.zpp_pool,st.zpp_pool=p.next,p.next=null),p.failed=!1,p.s1=p.s2=null,p.arbiter=null,0==n.type){var l=n.circle;if(l.zip_worldCOM&&null!=l.body){if(l.zip_worldCOM=!1,l.zip_localCOM){if(l.zip_localCOM=!1,1==l.type){var r=l.polygon;if(null==r.lverts.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y;else if(null==r.lverts.next.next.next)r.localCOMx=r.lverts.next.x,r.localCOMy=r.lverts.next.y,r.localCOMx+=r.lverts.next.next.x,r.localCOMy+=r.lverts.next.next.y,r.localCOMx*=.5,r.localCOMy*=.5;else{r.localCOMx=0,r.localCOMy=0;var o=0,a=r.lverts.next,s=a,_=a=a.next;for(a=a.next;null!=a;){var h=a;o+=_.x*(h.y-s.y);var u=h.y*_.x-h.x*_.y;r.localCOMx+=(_.x+h.x)*u,r.localCOMy+=(_.y+h.y)*u,s=_,_=h,a=a.next}var x=a=r.lverts.next;o+=_.x*(x.y-s.y);var d=x.y*_.x-x.x*_.y;r.localCOMx+=(_.x+x.x)*d,r.localCOMy+=(_.y+x.y)*d,s=_;var y=a=a.next;o+=x.x*(y.y-s.y);var z=y.y*x.x-y.x*x.y;r.localCOMx+=(x.x+y.x)*z,r.localCOMy+=(x.y+y.y)*z;var v=o=1/(3*o);r.localCOMx*=v,r.localCOMy*=v}}null!=l.wrap_localCOM&&(l.wrap_localCOM.zpp_inner.x=l.localCOMx,l.wrap_localCOM.zpp_inner.y=l.localCOMy)}var c=l.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot)),l.worldCOMx=l.body.posx+(l.body.axisy*l.localCOMx-l.body.axisx*l.localCOMy),l.worldCOMy=l.body.posy+(l.localCOMx*l.body.axisx+l.localCOMy*l.body.axisy)}}else{var f=n.polygon;if(f.zip_gaxi&&null!=f.body){f.zip_gaxi=!1,f.validate_laxi();var m=f.body;if(m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot)),f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var b=f.body;b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot));for(var g=f.lverts.next,w=f.gverts.next;null!=w;){var M=w,C=g;g=g.next,M.x=f.body.posx+(f.body.axisy*C.x-f.body.axisx*C.y),M.y=f.body.posy+(C.x*f.body.axisx+C.y*f.body.axisy),w=w.next}}var k=f.edges.head,O=f.gverts.next,P=O;for(O=O.next;null!=O;){var S=O,A=k.elt;k=k.next,A.gp0=P,A.gp1=S,A.gnormx=f.body.axisy*A.lnormx-f.body.axisx*A.lnormy,A.gnormy=A.lnormx*f.body.axisx+A.lnormy*f.body.axisy,A.gprojection=f.body.posx*A.gnormx+f.body.posy*A.gnormy+A.lprojection,null!=A.wrap_gnorm&&(A.wrap_gnorm.zpp_inner.x=A.gnormx,A.wrap_gnorm.zpp_inner.y=A.gnormy),A.tp0=A.gp0.y*A.gnormx-A.gp0.x*A.gnormy,A.tp1=A.gp1.y*A.gnormx-A.gp1.x*A.gnormy,P=S,O=O.next}var j=k.elt;j.gp0=P,j.gp1=f.gverts.next,j.gnormx=f.body.axisy*j.lnormx-f.body.axisx*j.lnormy,j.gnormy=j.lnormx*f.body.axisx+j.lnormy*f.body.axisy,j.gprojection=f.body.posx*j.gnormx+f.body.posy*j.gnormy+j.lprojection,null!=j.wrap_gnorm&&(j.wrap_gnorm.zpp_inner.x=j.gnormx,j.wrap_gnorm.zpp_inner.y=j.gnormy),j.tp0=j.gp0.y*j.gnormx-j.gp0.x*j.gnormy,j.tp1=j.gp1.y*j.gnormx-j.gp1.x*j.gnormy}}var E=n.body,I=E.posx,T=E.posy;E.sweepTime=0,E.sweep_angvel=E.angvel;var N=e-E.sweepTime;if(0!=N&&(E.sweepTime=e,E.posx+=E.velx*N,E.posy+=E.vely*N,0!=E.angvel)){var L=E.sweep_angvel*N;if(E.rot+=L,L*L>1e-4)E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot);else{var V=L*L,D=1-.5*V,F=1-V*V/8,R=(D*E.axisx+L*E.axisy)*F;E.axisy=(D*E.axisy-L*E.axisx)*F,E.axisx=R}}var Z=E.posx,B=E.posy;n.validate_sweepRadius();var G,q=n.sweepRadius;null==Te.zpp_pool?G=new Te:(G=Te.zpp_pool,Te.zpp_pool=G.next,G.next=null),G.minx=(I<Z?I:Z)-q,G.maxx=(I>Z?I:Z)+q,G.miny=(T<B?T:B)-q,G.maxy=(T>B?T:B)+q;var U=this.convexShapeList=this.bphase.shapesInAABB(G,!1,!1,null==t?null:t.zpp_inner,this.convexShapeList),K=G;null!=K.outer&&(K.outer.zpp_inner=null,K.outer=null),K.wrap_min=K.wrap_max=null,K._invalidate=null,K._validate=null,K.next=Te.zpp_pool,Te.zpp_pool=K;var W=0,Y=0;W=0,Y=0;var J=0,X=0;J=0,X=0;var H=null,$=e+1;U.zpp_inner.valmod();for(var Q=Zn.get(U);;){Q.zpp_inner.zpp_inner.valmod();var nn=Q.zpp_inner;nn.zpp_inner.valmod(),nn.zpp_inner.zip_length&&(nn.zpp_inner.zip_length=!1,nn.zpp_inner.user_length=nn.zpp_inner.inner.length);var en,tn=nn.zpp_inner.user_length;if(Q.zpp_critical=!0,Q.zpp_i<tn?en=!0:(Q.zpp_next=Zn.zpp_pool,Zn.zpp_pool=Q,Q.zpp_inner=null,en=!1),!en)break;Q.zpp_critical=!1;var pn=Q.zpp_inner.at(Q.zpp_i++);if(pn!=n.outer&&(null!=pn.zpp_inner.body?pn.zpp_inner.body.outer:null)!=E.outer){if(p.s1=n,p.s2=pn.zpp_inner,i){pn.zpp_inner.validate_sweepRadius(),(null!=pn.zpp_inner.body?pn.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=pn.zpp_inner.body?pn.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=pn.zpp_inner.body?pn.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,_t.dynamicSweep(p,e,0,0,!0);var ln=(null!=pn.zpp_inner.body?pn.zpp_inner.body.outer:null).zpp_inner,rn=0-ln.sweepTime;if(0!=rn&&(ln.sweepTime=0,ln.posx+=ln.velx*rn,ln.posy+=ln.vely*rn,0!=ln.angvel)){var on=ln.sweep_angvel*rn;if(ln.rot+=on,on*on>1e-4)ln.axisx=Math.sin(ln.rot),ln.axisy=Math.cos(ln.rot);else{var an=on*on,sn=1-.5*an,_n=1-an*an/8,hn=(sn*ln.axisx+on*ln.axisy)*_n;ln.axisy=(sn*ln.axisy-on*ln.axisx)*_n,ln.axisx=hn}}var un=(null!=pn.zpp_inner.body?pn.zpp_inner.body.outer:null).zpp_inner,xn=pn.zpp_inner;if(0==xn.type)xn.worldCOMx=un.posx+(un.axisy*xn.localCOMx-un.axisx*xn.localCOMy),xn.worldCOMy=un.posy+(xn.localCOMx*un.axisx+xn.localCOMy*un.axisy);else{for(var dn=xn.polygon,zn=dn.lverts.next,vn=dn.gverts.next;null!=vn;){var cn=vn,fn=zn;zn=zn.next,cn.x=un.posx+(un.axisy*fn.x-un.axisx*fn.y),cn.y=un.posy+(fn.x*un.axisx+fn.y*un.axisy),vn=vn.next}var mn=dn.edges.head,bn=dn.gverts.next,gn=bn;for(bn=bn.next;null!=bn;){var wn=bn,Mn=mn.elt;mn=mn.next,Mn.gnormx=un.axisy*Mn.lnormx-un.axisx*Mn.lnormy,Mn.gnormy=Mn.lnormx*un.axisx+Mn.lnormy*un.axisy,Mn.gprojection=un.posx*Mn.gnormx+un.posy*Mn.gnormy+Mn.lprojection,Mn.tp0=gn.y*Mn.gnormx-gn.x*Mn.gnormy,Mn.tp1=wn.y*Mn.gnormx-wn.x*Mn.gnormy,gn=wn,bn=bn.next}var Cn=dn.gverts.next,kn=mn.elt;kn.gnormx=un.axisy*kn.lnormx-un.axisx*kn.lnormy,kn.gnormy=kn.lnormx*un.axisx+kn.lnormy*un.axisy,kn.gprojection=un.posx*kn.gnormx+un.posy*kn.gnormy+kn.lprojection,kn.tp0=gn.y*kn.gnormx-gn.x*kn.gnormy,kn.tp1=Cn.y*kn.gnormx-Cn.x*kn.gnormy}}else _t.staticSweep(p,e,0,0);p.toi*=e,p.toi>0&&p.toi<$&&($=p.toi,W=p.axis.x,Y=p.axis.y,J=p.c2.x,X=p.c2.y,H=pn)}}U.clear();var On=p;On.next=st.zpp_pool,st.zpp_pool=On;var Pn=0-E.sweepTime;if(0!=Pn&&(E.sweepTime=0,E.posx+=E.velx*Pn,E.posy+=E.vely*Pn,0!=E.angvel)){var Sn=E.sweep_angvel*Pn;if(E.rot+=Sn,Sn*Sn>1e-4)E.axisx=Math.sin(E.rot),E.axisy=Math.cos(E.rot);else{var An=Sn*Sn,jn=1-.5*An,En=1-An*An/8,In=(jn*E.axisx+Sn*E.axisy)*En;E.axisy=(jn*E.axisy-Sn*E.axisx)*En,E.axisx=In}}if(0==n.type)n.worldCOMx=E.posx+(E.axisy*n.localCOMx-E.axisx*n.localCOMy),n.worldCOMy=E.posy+(n.localCOMx*E.axisx+n.localCOMy*E.axisy);else{for(var Tn=n.polygon,Nn=Tn.lverts.next,Ln=Tn.gverts.next;null!=Ln;){var Vn=Ln,Dn=Nn;Nn=Nn.next,Vn.x=E.posx+(E.axisy*Dn.x-E.axisx*Dn.y),Vn.y=E.posy+(Dn.x*E.axisx+Dn.y*E.axisy),Ln=Ln.next}var Fn=Tn.edges.head,Rn=Tn.gverts.next,Bn=Rn;for(Rn=Rn.next;null!=Rn;){var Gn=Rn,qn=Fn.elt;Fn=Fn.next,qn.gnormx=E.axisy*qn.lnormx-E.axisx*qn.lnormy,qn.gnormy=qn.lnormx*E.axisx+qn.lnormy*E.axisy,qn.gprojection=E.posx*qn.gnormx+E.posy*qn.gnormy+qn.lprojection,qn.tp0=Bn.y*qn.gnormx-Bn.x*qn.gnormy,qn.tp1=Gn.y*qn.gnormx-Gn.x*qn.gnormy,Bn=Gn,Rn=Rn.next}var Un=Tn.gverts.next,Kn=Fn.elt;Kn.gnormx=E.axisy*Kn.lnormx-E.axisx*Kn.lnormy,Kn.gnormy=Kn.lnormx*E.axisx+Kn.lnormy*E.axisy,Kn.gprojection=E.posx*Kn.gnormx+E.posy*Kn.gnormy+Kn.lprojection,Kn.tp0=Bn.y*Kn.gnormx-Bn.x*Kn.gnormy,Kn.tp1=Un.y*Kn.gnormx-Un.x*Kn.gnormy}if($<=e){var Wn,Yn=-W,Jn=-Y;if(null==xp.poolVec2?Wn=new yn:(Wn=xp.poolVec2,xp.poolVec2=Wn.zpp_pool,Wn.zpp_pool=null),null==Wn.zpp_inner){var Xn;null==xt.zpp_pool?Xn=new xt:(Xn=xt.zpp_pool,xt.zpp_pool=Xn.next,Xn.next=null),Xn.weak=!1,Xn._immutable=!1,Xn.x=Yn,Xn.y=Jn,Wn.zpp_inner=Xn,Wn.zpp_inner.outer=Wn}else{var Hn,$n=Wn.zpp_inner;if(null!=$n._validate&&$n._validate(),Wn.zpp_inner.x==Yn){var Qn=Wn.zpp_inner;null!=Qn._validate&&Qn._validate(),Hn=Wn.zpp_inner.y==Jn}else Hn=!1;if(!Hn){Wn.zpp_inner.x=Yn,Wn.zpp_inner.y=Jn;var ne=Wn.zpp_inner;null!=ne._invalidate&&ne._invalidate(ne)}}Wn.zpp_inner.weak=!1;var ee,te=Wn;if(null==xp.poolVec2?ee=new yn:(ee=xp.poolVec2,xp.poolVec2=ee.zpp_pool,ee.zpp_pool=null),null==ee.zpp_inner){var ie;null==xt.zpp_pool?ie=new xt:(ie=xt.zpp_pool,xt.zpp_pool=ie.next,ie.next=null),ie.weak=!1,ie._immutable=!1,ie.x=J,ie.y=X,ee.zpp_inner=ie,ee.zpp_inner.outer=ee}else{var pe,le=ee.zpp_inner;if(null!=le._validate&&le._validate(),ee.zpp_inner.x==J){var re=ee.zpp_inner;null!=re._validate&&re._validate(),pe=ee.zpp_inner.y==X}else pe=!1;if(!pe){ee.zpp_inner.x=J,ee.zpp_inner.y=X;var oe=ee.zpp_inner;null!=oe._invalidate&&oe._invalidate(oe)}}return ee.zpp_inner.weak=!1,De.getConvex(te,ee,$,H)}return null},Tt.prototype.prepareCast=function(n){if(0==n.type){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var t=e.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0,t.localCOMy=0;var i=0,p=t.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;t.localCOMx+=(r.x+o.x)*a,t.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=t.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*_,t.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);var u=h.y*s.x-h.x*s.y;t.localCOMx+=(s.x+h.x)*u,t.localCOMy+=(s.y+h.y)*u;var x=i=1/(3*i);t.localCOMx*=x,t.localCOMy*=x}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}}else{var y=n.polygon;if(y.zip_gaxi&&null!=y.body){y.zip_gaxi=!1,y.validate_laxi();var z=y.body;if(z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),y.zip_gverts&&null!=y.body){y.zip_gverts=!1,y.validate_lverts();var v=y.body;v.zip_axis&&(v.zip_axis=!1,v.axisx=Math.sin(v.rot),v.axisy=Math.cos(v.rot));for(var c=y.lverts.next,f=y.gverts.next;null!=f;){var m=f,b=c;c=c.next,m.x=y.body.posx+(y.body.axisy*b.x-y.body.axisx*b.y),m.y=y.body.posy+(b.x*y.body.axisx+b.y*y.body.axisy),f=f.next}}var g=y.edges.head,w=y.gverts.next,M=w;for(w=w.next;null!=w;){var C=w,k=g.elt;g=g.next,k.gp0=M,k.gp1=C,k.gnormx=y.body.axisy*k.lnormx-y.body.axisx*k.lnormy,k.gnormy=k.lnormx*y.body.axisx+k.lnormy*y.body.axisy,k.gprojection=y.body.posx*k.gnormx+y.body.posy*k.gnormy+k.lprojection,null!=k.wrap_gnorm&&(k.wrap_gnorm.zpp_inner.x=k.gnormx,k.wrap_gnorm.zpp_inner.y=k.gnormy),k.tp0=k.gp0.y*k.gnormx-k.gp0.x*k.gnormy,k.tp1=k.gp1.y*k.gnormx-k.gp1.x*k.gnormy,M=C,w=w.next}var O=g.elt;O.gp0=M,O.gp1=y.gverts.next,O.gnormx=y.body.axisy*O.lnormx-y.body.axisx*O.lnormy,O.gnormy=O.lnormx*y.body.axisx+O.lnormy*y.body.axisy,O.gprojection=y.body.posx*O.gnormx+y.body.posy*O.gnormy+O.lprojection,null!=O.wrap_gnorm&&(O.wrap_gnorm.zpp_inner.x=O.gnormx,O.wrap_gnorm.zpp_inner.y=O.gnormy),O.tp0=O.gp0.y*O.gnormx-O.gp0.x*O.gnormy,O.tp1=O.gp1.y*O.gnormx-O.gp1.x*O.gnormy}}},Tt.prototype.convexMultiCast=function(n,e,t,i,p){var l;if(null==st.zpp_pool?l=new st:(l=st.zpp_pool,st.zpp_pool=l.next,l.next=null),l.failed=!1,l.s1=l.s2=null,l.arbiter=null,0==n.type){var r=n.circle;if(r.zip_worldCOM&&null!=r.body){if(r.zip_worldCOM=!1,r.zip_localCOM){if(r.zip_localCOM=!1,1==r.type){var o=r.polygon;if(null==o.lverts.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y;else if(null==o.lverts.next.next.next)o.localCOMx=o.lverts.next.x,o.localCOMy=o.lverts.next.y,o.localCOMx+=o.lverts.next.next.x,o.localCOMy+=o.lverts.next.next.y,o.localCOMx*=.5,o.localCOMy*=.5;else{o.localCOMx=0,o.localCOMy=0;var a=0,s=o.lverts.next,_=s,h=s=s.next;for(s=s.next;null!=s;){var u=s;a+=h.x*(u.y-_.y);var x=u.y*h.x-u.x*h.y;o.localCOMx+=(h.x+u.x)*x,o.localCOMy+=(h.y+u.y)*x,_=h,h=u,s=s.next}var d=s=o.lverts.next;a+=h.x*(d.y-_.y);var y=d.y*h.x-d.x*h.y;o.localCOMx+=(h.x+d.x)*y,o.localCOMy+=(h.y+d.y)*y,_=h;var z=s=s.next;a+=d.x*(z.y-_.y);var v=z.y*d.x-z.x*d.y;o.localCOMx+=(d.x+z.x)*v,o.localCOMy+=(d.y+z.y)*v;var c=a=1/(3*a);o.localCOMx*=c,o.localCOMy*=c}}null!=r.wrap_localCOM&&(r.wrap_localCOM.zpp_inner.x=r.localCOMx,r.wrap_localCOM.zpp_inner.y=r.localCOMy)}var f=r.body;f.zip_axis&&(f.zip_axis=!1,f.axisx=Math.sin(f.rot),f.axisy=Math.cos(f.rot)),r.worldCOMx=r.body.posx+(r.body.axisy*r.localCOMx-r.body.axisx*r.localCOMy),r.worldCOMy=r.body.posy+(r.localCOMx*r.body.axisx+r.localCOMy*r.body.axisy)}}else{var m=n.polygon;if(m.zip_gaxi&&null!=m.body){m.zip_gaxi=!1,m.validate_laxi();var b=m.body;if(b.zip_axis&&(b.zip_axis=!1,b.axisx=Math.sin(b.rot),b.axisy=Math.cos(b.rot)),m.zip_gverts&&null!=m.body){m.zip_gverts=!1,m.validate_lverts();var g=m.body;g.zip_axis&&(g.zip_axis=!1,g.axisx=Math.sin(g.rot),g.axisy=Math.cos(g.rot));for(var w=m.lverts.next,M=m.gverts.next;null!=M;){var C=M,k=w;w=w.next,C.x=m.body.posx+(m.body.axisy*k.x-m.body.axisx*k.y),C.y=m.body.posy+(k.x*m.body.axisx+k.y*m.body.axisy),M=M.next}}var O=m.edges.head,P=m.gverts.next,S=P;for(P=P.next;null!=P;){var A=P,j=O.elt;O=O.next,j.gp0=S,j.gp1=A,j.gnormx=m.body.axisy*j.lnormx-m.body.axisx*j.lnormy,j.gnormy=j.lnormx*m.body.axisx+j.lnormy*m.body.axisy,j.gprojection=m.body.posx*j.gnormx+m.body.posy*j.gnormy+j.lprojection,null!=j.wrap_gnorm&&(j.wrap_gnorm.zpp_inner.x=j.gnormx,j.wrap_gnorm.zpp_inner.y=j.gnormy),j.tp0=j.gp0.y*j.gnormx-j.gp0.x*j.gnormy,j.tp1=j.gp1.y*j.gnormx-j.gp1.x*j.gnormy,S=A,P=P.next}var E=O.elt;E.gp0=S,E.gp1=m.gverts.next,E.gnormx=m.body.axisy*E.lnormx-m.body.axisx*E.lnormy,E.gnormy=E.lnormx*m.body.axisx+E.lnormy*m.body.axisy,E.gprojection=m.body.posx*E.gnormx+m.body.posy*E.gnormy+E.lprojection,null!=E.wrap_gnorm&&(E.wrap_gnorm.zpp_inner.x=E.gnormx,E.wrap_gnorm.zpp_inner.y=E.gnormy),E.tp0=E.gp0.y*E.gnormx-E.gp0.x*E.gnormy,E.tp1=E.gp1.y*E.gnormx-E.gp1.x*E.gnormy}}var I=n.body,T=I.posx,N=I.posy;I.sweepTime=0,I.sweep_angvel=I.angvel;var L=e-I.sweepTime;if(0!=L&&(I.sweepTime=e,I.posx+=I.velx*L,I.posy+=I.vely*L,0!=I.angvel)){var V=I.sweep_angvel*L;if(I.rot+=V,V*V>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var D=V*V,F=1-.5*D,R=1-D*D/8,Z=(F*I.axisx+V*I.axisy)*R;I.axisy=(F*I.axisy-V*I.axisx)*R,I.axisx=Z}}var B=I.posx,G=I.posy;n.validate_sweepRadius();var q,U=n.sweepRadius;null==Te.zpp_pool?q=new Te:(q=Te.zpp_pool,Te.zpp_pool=q.next,q.next=null),q.minx=(T<B?T:B)-U,q.maxx=(T>B?T:B)+U,q.miny=(N<G?N:G)-U,q.maxy=(N>G?N:G)+U;var K=this.convexShapeList=this.bphase.shapesInAABB(q,!1,!1,null==t?null:t.zpp_inner,this.convexShapeList),W=q;null!=W.outer&&(W.outer.zpp_inner=null,W.outer=null),W.wrap_min=W.wrap_max=null,W._invalidate=null,W._validate=null,W.next=Te.zpp_pool,Te.zpp_pool=W;var Y=null==p?new en:p;K.zpp_inner.valmod();for(var J=Zn.get(K);;){J.zpp_inner.zpp_inner.valmod();var X=J.zpp_inner;X.zpp_inner.valmod(),X.zpp_inner.zip_length&&(X.zpp_inner.zip_length=!1,X.zpp_inner.user_length=X.zpp_inner.inner.length);var H,$=X.zpp_inner.user_length;if(J.zpp_critical=!0,J.zpp_i<$?H=!0:(J.zpp_next=Zn.zpp_pool,Zn.zpp_pool=J,J.zpp_inner=null,H=!1),!H)break;J.zpp_critical=!1;var Q=J.zpp_inner.at(J.zpp_i++);if(Q!=n.outer&&(null!=Q.zpp_inner.body?Q.zpp_inner.body.outer:null)!=I.outer){if(l.s1=n,l.s2=Q.zpp_inner,i){Q.zpp_inner.validate_sweepRadius(),(null!=Q.zpp_inner.body?Q.zpp_inner.body.outer:null).zpp_inner.sweep_angvel=(null!=Q.zpp_inner.body?Q.zpp_inner.body.outer:null).zpp_inner.angvel,(null!=Q.zpp_inner.body?Q.zpp_inner.body.outer:null).zpp_inner.sweepTime=0,_t.dynamicSweep(l,e,0,0,!0);var nn=(null!=Q.zpp_inner.body?Q.zpp_inner.body.outer:null).zpp_inner,tn=0-nn.sweepTime;if(0!=tn&&(nn.sweepTime=0,nn.posx+=nn.velx*tn,nn.posy+=nn.vely*tn,0!=nn.angvel)){var pn=nn.sweep_angvel*tn;if(nn.rot+=pn,pn*pn>1e-4)nn.axisx=Math.sin(nn.rot),nn.axisy=Math.cos(nn.rot);else{var ln=pn*pn,rn=1-.5*ln,on=1-ln*ln/8,an=(rn*nn.axisx+pn*nn.axisy)*on;nn.axisy=(rn*nn.axisy-pn*nn.axisx)*on,nn.axisx=an}}var sn=(null!=Q.zpp_inner.body?Q.zpp_inner.body.outer:null).zpp_inner,_n=Q.zpp_inner;if(0==_n.type)_n.worldCOMx=sn.posx+(sn.axisy*_n.localCOMx-sn.axisx*_n.localCOMy),_n.worldCOMy=sn.posy+(_n.localCOMx*sn.axisx+_n.localCOMy*sn.axisy);else{for(var hn=_n.polygon,un=hn.lverts.next,xn=hn.gverts.next;null!=xn;){var dn=xn,zn=un;un=un.next,dn.x=sn.posx+(sn.axisy*zn.x-sn.axisx*zn.y),dn.y=sn.posy+(zn.x*sn.axisx+zn.y*sn.axisy),xn=xn.next}var vn=hn.edges.head,cn=hn.gverts.next,fn=cn;for(cn=cn.next;null!=cn;){var mn=cn,bn=vn.elt;vn=vn.next,bn.gnormx=sn.axisy*bn.lnormx-sn.axisx*bn.lnormy,bn.gnormy=bn.lnormx*sn.axisx+bn.lnormy*sn.axisy,bn.gprojection=sn.posx*bn.gnormx+sn.posy*bn.gnormy+bn.lprojection,bn.tp0=fn.y*bn.gnormx-fn.x*bn.gnormy,bn.tp1=mn.y*bn.gnormx-mn.x*bn.gnormy,fn=mn,cn=cn.next}var gn=hn.gverts.next,wn=vn.elt;wn.gnormx=sn.axisy*wn.lnormx-sn.axisx*wn.lnormy,wn.gnormy=wn.lnormx*sn.axisx+wn.lnormy*sn.axisy,wn.gprojection=sn.posx*wn.gnormx+sn.posy*wn.gnormy+wn.lprojection,wn.tp0=fn.y*wn.gnormx-fn.x*wn.gnormy,wn.tp1=gn.y*wn.gnormx-gn.x*wn.gnormy}}else _t.staticSweep(l,e,0,0);if(l.toi*=e,l.toi>0){var Mn,Cn=-l.axis.x,kn=-l.axis.y;if(null==xp.poolVec2?Mn=new yn:(Mn=xp.poolVec2,xp.poolVec2=Mn.zpp_pool,Mn.zpp_pool=null),null==Mn.zpp_inner){var On;null==xt.zpp_pool?On=new xt:(On=xt.zpp_pool,xt.zpp_pool=On.next,On.next=null),On.weak=!1,On._immutable=!1,On.x=Cn,On.y=kn,Mn.zpp_inner=On,Mn.zpp_inner.outer=Mn}else{var Pn,Sn=Mn.zpp_inner;if(null!=Sn._validate&&Sn._validate(),Mn.zpp_inner.x==Cn){var An=Mn.zpp_inner;null!=An._validate&&An._validate(),Pn=Mn.zpp_inner.y==kn}else Pn=!1;if(!Pn){Mn.zpp_inner.x=Cn,Mn.zpp_inner.y=kn;var jn=Mn.zpp_inner;null!=jn._invalidate&&jn._invalidate(jn)}}Mn.zpp_inner.weak=!1;var En,In=Mn,Tn=l.c2.x,Nn=l.c2.y;if(null==xp.poolVec2?En=new yn:(En=xp.poolVec2,xp.poolVec2=En.zpp_pool,En.zpp_pool=null),null==En.zpp_inner){var Ln;null==xt.zpp_pool?Ln=new xt:(Ln=xt.zpp_pool,xt.zpp_pool=Ln.next,Ln.next=null),Ln.weak=!1,Ln._immutable=!1,Ln.x=Tn,Ln.y=Nn,En.zpp_inner=Ln,En.zpp_inner.outer=En}else{var Vn,Dn=En.zpp_inner;if(null!=Dn._validate&&Dn._validate(),En.zpp_inner.x==Tn){var Fn=En.zpp_inner;null!=Fn._validate&&Fn._validate(),Vn=En.zpp_inner.y==Nn}else Vn=!1;if(!Vn){En.zpp_inner.x=Tn,En.zpp_inner.y=Nn;var Rn=En.zpp_inner;null!=Rn._invalidate&&Rn._invalidate(Rn)}}En.zpp_inner.weak=!1;for(var Bn=De.getConvex(In,En,l.toi,Q),Gn=null,qn=Y.zpp_inner.inner.head;null!=qn&&!(Bn.zpp_inner.toiDistance<qn.elt.zpp_inner.toiDistance);)Gn=qn,qn=qn.next;var Un,Kn=Y.zpp_inner.inner;null==Wi.zpp_pool?Un=new Wi:(Un=Wi.zpp_pool,Wi.zpp_pool=Un.next,Un.next=null),Un.elt=Bn;var Wn=Un;null==Gn?(Wn.next=Kn.head,Kn.head=Wn):(Wn.next=Gn.next,Gn.next=Wn),Kn.pushmod=Kn.modified=!0,Kn.length++}}}K.clear();var Yn=l;Yn.next=st.zpp_pool,st.zpp_pool=Yn;var Jn=0-I.sweepTime;if(0!=Jn&&(I.sweepTime=0,I.posx+=I.velx*Jn,I.posy+=I.vely*Jn,0!=I.angvel)){var Xn=I.sweep_angvel*Jn;if(I.rot+=Xn,Xn*Xn>1e-4)I.axisx=Math.sin(I.rot),I.axisy=Math.cos(I.rot);else{var Hn=Xn*Xn,$n=1-.5*Hn,Qn=1-Hn*Hn/8,ne=($n*I.axisx+Xn*I.axisy)*Qn;I.axisy=($n*I.axisy-Xn*I.axisx)*Qn,I.axisx=ne}}if(0==n.type)n.worldCOMx=I.posx+(I.axisy*n.localCOMx-I.axisx*n.localCOMy),n.worldCOMy=I.posy+(n.localCOMx*I.axisx+n.localCOMy*I.axisy);else{for(var ee=n.polygon,te=ee.lverts.next,ie=ee.gverts.next;null!=ie;){var pe=ie,le=te;te=te.next,pe.x=I.posx+(I.axisy*le.x-I.axisx*le.y),pe.y=I.posy+(le.x*I.axisx+le.y*I.axisy),ie=ie.next}var re=ee.edges.head,oe=ee.gverts.next,ae=oe;for(oe=oe.next;null!=oe;){var se=oe,_e=re.elt;re=re.next,_e.gnormx=I.axisy*_e.lnormx-I.axisx*_e.lnormy,_e.gnormy=_e.lnormx*I.axisx+_e.lnormy*I.axisy,_e.gprojection=I.posx*_e.gnormx+I.posy*_e.gnormy+_e.lprojection,_e.tp0=ae.y*_e.gnormx-ae.x*_e.gnormy,_e.tp1=se.y*_e.gnormx-se.x*_e.gnormy,ae=se,oe=oe.next}var he=ee.gverts.next,ue=re.elt;ue.gnormx=I.axisy*ue.lnormx-I.axisx*ue.lnormy,ue.gnormy=ue.lnormx*I.axisx+ue.lnormy*I.axisy,ue.gprojection=I.posx*ue.gnormx+I.posy*ue.gnormy+ue.lprojection,ue.tp0=ae.y*ue.gnormx-ae.x*ue.gnormy,ue.tp1=he.y*ue.gnormx-he.x*ue.gnormy}return Y},Tt.prototype.push_callback=function(n){var e;return null==Hn.zpp_pool?e=new Hn:(e=Hn.zpp_pool,Hn.zpp_pool=e.next,e.next=null),this.callbacks.push(e),e.listener=n,e},Tt.prototype.pre_dt=null,Tt.prototype.step=function(n,e,t){if(this.time+=n,this.pre_dt=n,this.midstep=!0,this.stamp++,this.validation(),this.bphase.broadphase(this,!0),this.prestep(n),this.sortcontacts){var i=this.c_arbiters_false;if(null!=i.head&&null!=i.head.next){for(var p,l,r,o=i.head,a=null,s=null,_=null,h=null,u=1;;){for(p=0,s=o,a=o=null;null!=s;){for(++p,_=s,l=0,r=u;null!=_&&l<u;)++l,_=_.next;for(;l>0||r>0&&null!=_;)0==l?(h=_,_=_.next,--r):0==r||null==_?(h=s,s=s.next,--l):!s.elt.active||!_.elt.active||s.elt.oc1.dist<_.elt.oc1.dist?(h=s,s=s.next,--l):(h=_,_=_.next,--r),null!=a?a.next=h:o=h,a=h;s=_}if(a.next=null,u<<=1,!(p>1))break}i.head=o,i.modified=!0,i.pushmod=!0}}this.updateVel(n),this.warmStart(),this.iterateVel(e);for(var x=this.kinematics.head;null!=x;){var d=x.elt;d.pre_posx=d.posx,d.pre_posy=d.posy,d.pre_rot=d.rot,x=x.next}for(var y=this.live.head;null!=y;){var z=y.elt;z.pre_posx=z.posx,z.pre_posy=z.posy,z.pre_rot=z.rot,y=y.next}this.updatePos(n),this.continuous=!0,this.continuousCollisions(n),this.continuous=!1,this.iteratePos(t);for(var v=this.kinematics.head;null!=v;){var c=v.elt,f=!(c.posx==c.pre_posx&&c.posy==c.pre_posy),m=c.pre_rot!=c.rot;if(f){for(var b=c.shapes.head;null!=b;){var g=b.elt;1==g.type&&(g.polygon.invalidate_gverts(),g.polygon.invalidate_gaxi()),g.invalidate_worldCOM(),b=b.next}c.zip_worldCOM=!0}if(m){c.zip_axis=!0;for(var w=c.shapes.head;null!=w;){var M=w.elt;1==M.type&&(M.polygon.invalidate_gverts(),M.polygon.invalidate_gaxi()),M.invalidate_worldCOM(),w=w.next}c.zip_worldCOM=!0}v=v.next}for(var C=this.live.head;null!=C;){var k=C.elt,O=!(k.posx==k.pre_posx&&k.posy==k.pre_posy),P=k.pre_rot!=k.rot;if(O){for(var S=k.shapes.head;null!=S;){var A=S.elt;1==A.type&&(A.polygon.invalidate_gverts(),A.polygon.invalidate_gaxi()),A.invalidate_worldCOM(),S=S.next}k.zip_worldCOM=!0}if(P){k.zip_axis=!0;for(var j=k.shapes.head;null!=j;){var E=j.elt;1==E.type&&(E.polygon.invalidate_gverts(),E.polygon.invalidate_gaxi()),E.invalidate_worldCOM(),j=j.next}k.zip_worldCOM=!0}C=C.next}for(var I=null,T=this.staticsleep.head;null!=T;){var N=T.elt;if(3!=N.type||0==N.velx&&0==N.vely&&0==N.angvel){if(N.kinematicDelaySleep){N.kinematicDelaySleep=!1,T=T.next;continue}N.component.sleeping=!0;var L,V,D=this.staticsleep;null==I?(V=(L=D.head).next,D.head=V,null==D.head&&(D.pushmod=!0)):(V=(L=I.next).next,I.next=V,null==V&&(D.pushmod=!0));var F=L;F.elt=null,F.next=ci.zpp_pool,ci.zpp_pool=F,D.modified=!0,D.length--,D.pushmod=!0,T=V}else I=T,T=T.next}this.doForests(n),this.sleepArbiters(),this.midstep=!1;for(var R=null,Z=this.callbackset_list.next;null!=Z;){var B=Z;if(null!=B.arbiters.head){var G;G=!0;for(var q=B.arbiters.head;null!=q;){if(!q.elt.sleeping){G=!1;break}q=q.next}for(var U,K=G,W=B.int1.cbSet,Y=B.int2.cbSet,J=null,X=(W.cbpairs.length<Y.cbpairs.length?W.cbpairs:Y.cbpairs).head;null!=X;){var H=X.elt;if(H.a==W&&H.b==Y||H.a==Y&&H.b==W){J=H;break}X=X.next}if(null==J)null==Qn.zpp_pool?U=new Qn:(U=Qn.zpp_pool,Qn.zpp_pool=U.next,U.next=null),U.zip_listeners=!0,$n.setlt(W,Y)?(U.a=W,U.b=Y):(U.a=Y,U.b=W),J=U,W.cbpairs.add(J),Y!=W&&Y.cbpairs.add(J);J.zip_listeners&&(J.zip_listeners=!1,J.__validate());for(var $=J.listeners.head;null!=$;){var Q=$.elt;if(6==Q.event&&(!K||Q.allowSleepingCallbacks)&&!B.empty_arb(Q.itype)){var nn=this.push_callback(Q);nn.event=6;var en,tn=B.int1,pn=B.int2,ln=Q.options1,rn=tn.cbTypes;if(ln.nonemptyintersection(rn,ln.includes)&&!ln.nonemptyintersection(rn,ln.excludes)){var on=Q.options2,an=pn.cbTypes;en=!!on.nonemptyintersection(an,on.includes)&&!on.nonemptyintersection(an,on.excludes)}else en=!1;en?(nn.int1=tn,nn.int2=pn):(nn.int1=pn,nn.int2=tn),nn.set=B}$=$.next}R=Z,Z=Z.next}else{var sn,_n,hn=this.callbackset_list;null==R?(_n=(sn=hn.next).next,hn.next=_n,null==hn.next&&(hn.pushmod=!0)):(_n=(sn=R.next).next,R.next=_n,null==_n&&(hn.pushmod=!0)),sn._inuse=!1,hn.modified=!0,hn.length--,hn.pushmod=!0,Z=_n,B.int1=B.int2=null,B.id=B.di=-1,B.freed=!0,B.next=Et.zpp_pool,Et.zpp_pool=B}}for(;!this.callbacks.empty();){var un=this.callbacks.pop();0==un.listener.type?un.listener.body.handler(un.wrapper_body()):1==un.listener.type?un.listener.constraint.handler(un.wrapper_con()):2==un.listener.type&&un.listener.interaction.handleri(un.wrapper_int()),un.int1=un.int2=null,un.body=null,un.constraint=null,un.listener=null,null!=un.wrap_arbiters&&(un.wrap_arbiters.zpp_inner.inner=null),un.set=null,un.next=Hn.zpp_pool,Hn.zpp_pool=un}},Tt.prototype.toiEvents=null,Tt.prototype.continuousCollisions=function(n){var e=2*Math.PI/n;this.bphase.broadphase(this,!1);for(var t=0;t<1&&null!=this.toiEvents.head;){for(var i=null,p=2,l=!1,r=null,a=null,s=this.toiEvents.head;null!=s;){var _=s.elt,h=_.s1.body,u=_.s2.body;if(h.sweepFrozen&&u.sweepFrozen){if(0==_.toi||!Le.testCollide_safe(_.s1,_.s2)){s=this.toiEvents.erase(a),_.next=st.zpp_pool,st.zpp_pool=_;continue}_.toi=0}if(_.frozen1!=h.sweepFrozen||_.frozen2!=u.sweepFrozen){if(_.kinematic){s=this.toiEvents.erase(a),_.next=st.zpp_pool,st.zpp_pool=_;continue}if(_.frozen1=h.sweepFrozen,_.frozen2=u.sweepFrozen,_.frozen1){var x=_.s1;_.s1=_.s2,_.s2=x,_.frozen1=!1,_.frozen2=!0}if(_t.staticSweep(_,n,0,o.collisionSlopCCD),_.toi<0){s=this.toiEvents.erase(a),_.next=st.zpp_pool,st.zpp_pool=_;continue}}_.toi>=0&&(_.toi<p||!l&&_.kinematic)&&(i=_,p=_.toi,l=_.kinematic,r=a),a=s,s=s.next}if(null==i)break;this.toiEvents.erase(r),t=i.toi;var d=i.s1.body,y=i.s2.body;if(!d.sweepFrozen){var z=t*n,v=z-d.sweepTime;if(0!=v&&(d.sweepTime=z,d.posx+=d.velx*v,d.posy+=d.vely*v,0!=d.angvel)){var c=d.sweep_angvel*v;if(d.rot+=c,c*c>1e-4)d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot);else{var f=c*c,m=1-.5*f,b=1-f*f/8,g=(m*d.axisx+c*d.axisy)*b;d.axisy=(m*d.axisy-c*d.axisx)*b,d.axisx=g}}var w=i.s1;if(0==w.type)w.worldCOMx=d.posx+(d.axisy*w.localCOMx-d.axisx*w.localCOMy),w.worldCOMy=d.posy+(w.localCOMx*d.axisx+w.localCOMy*d.axisy);else{for(var M=w.polygon,C=M.lverts.next,k=M.gverts.next;null!=k;){var O=k,P=C;C=C.next,O.x=d.posx+(d.axisy*P.x-d.axisx*P.y),O.y=d.posy+(P.x*d.axisx+P.y*d.axisy),k=k.next}var S=M.edges.head,A=M.gverts.next,j=A;for(A=A.next;null!=A;){var E=A,I=S.elt;S=S.next,I.gnormx=d.axisy*I.lnormx-d.axisx*I.lnormy,I.gnormy=I.lnormx*d.axisx+I.lnormy*d.axisy,I.gprojection=d.posx*I.gnormx+d.posy*I.gnormy+I.lprojection,I.tp0=j.y*I.gnormx-j.x*I.gnormy,I.tp1=E.y*I.gnormx-E.x*I.gnormy,j=E,A=A.next}var T=M.gverts.next,N=S.elt;N.gnormx=d.axisy*N.lnormx-d.axisx*N.lnormy,N.gnormy=N.lnormx*d.axisx+N.lnormy*d.axisy,N.gprojection=d.posx*N.gnormx+d.posy*N.gnormy+N.lprojection,N.tp0=j.y*N.gnormx-j.x*N.gnormy,N.tp1=T.y*N.gnormx-T.x*N.gnormy}}if(!y.sweepFrozen){var L=t*n,V=L-y.sweepTime;if(0!=V&&(y.sweepTime=L,y.posx+=y.velx*V,y.posy+=y.vely*V,0!=y.angvel)){var D=y.sweep_angvel*V;if(y.rot+=D,D*D>1e-4)y.axisx=Math.sin(y.rot),y.axisy=Math.cos(y.rot);else{var F=D*D,R=1-.5*F,Z=1-F*F/8,B=(R*y.axisx+D*y.axisy)*Z;y.axisy=(R*y.axisy-D*y.axisx)*Z,y.axisx=B}}var G=i.s2;if(0==G.type)G.worldCOMx=y.posx+(y.axisy*G.localCOMx-y.axisx*G.localCOMy),G.worldCOMy=y.posy+(G.localCOMx*y.axisx+G.localCOMy*y.axisy);else{for(var q=G.polygon,U=q.lverts.next,K=q.gverts.next;null!=K;){var W=K,Y=U;U=U.next,W.x=y.posx+(y.axisy*Y.x-y.axisx*Y.y),W.y=y.posy+(Y.x*y.axisx+Y.y*y.axisy),K=K.next}var J=q.edges.head,X=q.gverts.next,H=X;for(X=X.next;null!=X;){var $=X,Q=J.elt;J=J.next,Q.gnormx=y.axisy*Q.lnormx-y.axisx*Q.lnormy,Q.gnormy=Q.lnormx*y.axisx+Q.lnormy*y.axisy,Q.gprojection=y.posx*Q.gnormx+y.posy*Q.gnormy+Q.lprojection,Q.tp0=H.y*Q.gnormx-H.x*Q.gnormy,Q.tp1=$.y*Q.gnormx-$.x*Q.gnormy,H=$,X=X.next}var nn=q.gverts.next,en=J.elt;en.gnormx=y.axisy*en.lnormx-y.axisx*en.lnormy,en.gnormy=en.lnormx*y.axisx+en.lnormy*y.axisy,en.gprojection=y.posx*en.gnormx+y.posy*en.gnormy+en.lprojection,en.tp0=H.y*en.gnormx-H.x*en.gnormy,en.tp1=nn.y*en.gnormx-nn.x*en.gnormy}}var tn=this.narrowPhase(i.s1,i.s2,!0,i.arbiter,!0);if(null==tn)null!=i.arbiter&&null!=i.arbiter.pair&&(i.arbiter.pair.arb=null,i.arbiter.pair=null);else if(!this.presteparb(tn,n,!0)&&tn.type==Ce.COL&&tn.active&&0!=(1&tn.immState)){var pn=tn.colarb,ln=pn.nx*pn.c1.jnAcc-pn.ny*pn.c1.jtAcc,rn=pn.ny*pn.c1.jnAcc+pn.nx*pn.c1.jtAcc,on=pn.b1.imass;pn.b1.velx-=ln*on,pn.b1.vely-=rn*on,pn.b1.angvel-=pn.b1.iinertia*(rn*pn.c1.r1x-ln*pn.c1.r1y);var an=pn.b2.imass;if(pn.b2.velx+=ln*an,pn.b2.vely+=rn*an,pn.b2.angvel+=pn.b2.iinertia*(rn*pn.c1.r2x-ln*pn.c1.r2y),pn.hc2){var sn=pn.nx*pn.c2.jnAcc-pn.ny*pn.c2.jtAcc,_n=pn.ny*pn.c2.jnAcc+pn.nx*pn.c2.jtAcc,hn=pn.b1.imass;pn.b1.velx-=sn*hn,pn.b1.vely-=_n*hn,pn.b1.angvel-=pn.b1.iinertia*(_n*pn.c2.r1x-sn*pn.c2.r1y);var un=pn.b2.imass;pn.b2.velx+=sn*un,pn.b2.vely+=_n*un,pn.b2.angvel+=pn.b2.iinertia*(_n*pn.c2.r2x-sn*pn.c2.r2y)}pn.b2.angvel+=pn.jrAcc*pn.b2.iinertia,pn.b1.angvel-=pn.jrAcc*pn.b1.iinertia;var xn,dn,yn,zn,vn,cn,fn=tn.colarb,mn=fn.k1x+fn.b2.velx-fn.c1.r2y*fn.b2.angvel-(fn.b1.velx-fn.c1.r1y*fn.b1.angvel),bn=fn.k1y+fn.b2.vely+fn.c1.r2x*fn.b2.angvel-(fn.b1.vely+fn.c1.r1x*fn.b1.angvel);if(yn=(bn*fn.nx-mn*fn.ny+fn.surfacex)*fn.c1.tMass,zn=fn.c1.friction*fn.c1.jnAcc,(cn=(vn=fn.c1.jtAcc)-yn)>zn?cn=zn:cn<-zn&&(cn=-zn),yn=cn-vn,fn.c1.jtAcc=cn,xn=-fn.ny*yn,dn=fn.nx*yn,fn.b2.velx+=xn*fn.b2.imass,fn.b2.vely+=dn*fn.b2.imass,fn.b1.velx-=xn*fn.b1.imass,fn.b1.vely-=dn*fn.b1.imass,fn.b2.angvel+=fn.rt1b*yn*fn.b2.iinertia,fn.b1.angvel-=fn.rt1a*yn*fn.b1.iinertia,fn.hc2){var gn=fn.k2x+fn.b2.velx-fn.c2.r2y*fn.b2.angvel-(fn.b1.velx-fn.c2.r1y*fn.b1.angvel),wn=fn.k2y+fn.b2.vely+fn.c2.r2x*fn.b2.angvel-(fn.b1.vely+fn.c2.r1x*fn.b1.angvel);yn=(wn*fn.nx-gn*fn.ny+fn.surfacex)*fn.c2.tMass,zn=fn.c2.friction*fn.c2.jnAcc,(cn=(vn=fn.c2.jtAcc)-yn)>zn?cn=zn:cn<-zn&&(cn=-zn),yn=cn-vn,fn.c2.jtAcc=cn,xn=-fn.ny*yn,dn=fn.nx*yn,fn.b2.velx+=xn*fn.b2.imass,fn.b2.vely+=dn*fn.b2.imass,fn.b1.velx-=xn*fn.b1.imass,fn.b1.vely-=dn*fn.b1.imass,fn.b2.angvel+=fn.rt2b*yn*fn.b2.iinertia,fn.b1.angvel-=fn.rt2a*yn*fn.b1.iinertia,mn=fn.k1x+fn.b2.velx-fn.c1.r2y*fn.b2.angvel-(fn.b1.velx-fn.c1.r1y*fn.b1.angvel),bn=fn.k1y+fn.b2.vely+fn.c1.r2x*fn.b2.angvel-(fn.b1.vely+fn.c1.r1x*fn.b1.angvel),gn=fn.k2x+fn.b2.velx-fn.c2.r2y*fn.b2.angvel-(fn.b1.velx-fn.c2.r1y*fn.b1.angvel),wn=fn.k2y+fn.b2.vely+fn.c2.r2x*fn.b2.angvel-(fn.b1.vely+fn.c2.r1x*fn.b1.angvel);var Mn=fn.c1.jnAcc,Cn=fn.c2.jnAcc,kn=mn*fn.nx+bn*fn.ny+fn.surfacey+fn.c1.bounce-(fn.Ka*Mn+fn.Kb*Cn),On=gn*fn.nx+wn*fn.ny+fn.surfacey+fn.c2.bounce-(fn.Kb*Mn+fn.Kc*Cn),Pn=-(fn.kMassa*kn+fn.kMassb*On),Sn=-(fn.kMassb*kn+fn.kMassc*On);Pn>=0&&Sn>=0?(kn=Pn-Mn,On=Sn-Cn,fn.c1.jnAcc=Pn,fn.c2.jnAcc=Sn):(Pn=-fn.c1.nMass*kn)>=0&&fn.Kb*Pn+On>=0?(kn=Pn-Mn,On=-Cn,fn.c1.jnAcc=Pn,fn.c2.jnAcc=0):(Sn=-fn.c2.nMass*On)>=0&&fn.Kb*Sn+kn>=0?(kn=-Mn,On=Sn-Cn,fn.c1.jnAcc=0,fn.c2.jnAcc=Sn):kn>=0&&On>=0?(kn=-Mn,On=-Cn,fn.c1.jnAcc=fn.c2.jnAcc=0):(kn=0,On=0),yn=kn+On,xn=fn.nx*yn,dn=fn.ny*yn,fn.b2.velx+=xn*fn.b2.imass,fn.b2.vely+=dn*fn.b2.imass,fn.b1.velx-=xn*fn.b1.imass,fn.b1.vely-=dn*fn.b1.imass,fn.b2.angvel+=(fn.rn1b*kn+fn.rn2b*On)*fn.b2.iinertia,fn.b1.angvel-=(fn.rn1a*kn+fn.rn2a*On)*fn.b1.iinertia}else 0!=fn.radius&&(yn=(fn.b2.angvel-fn.b1.angvel)*fn.rMass,zn=fn.rfric*fn.c1.jnAcc,vn=fn.jrAcc,fn.jrAcc-=yn,fn.jrAcc>zn?fn.jrAcc=zn:fn.jrAcc<-zn&&(fn.jrAcc=-zn),yn=fn.jrAcc-vn,fn.b2.angvel+=yn*fn.b2.iinertia,fn.b1.angvel-=yn*fn.b1.iinertia),mn=fn.k1x+fn.b2.velx-fn.c1.r2y*fn.b2.angvel-(fn.b1.velx-fn.c1.r1y*fn.b1.angvel),bn=fn.k1y+fn.b2.vely+fn.c1.r2x*fn.b2.angvel-(fn.b1.vely+fn.c1.r1x*fn.b1.angvel),yn=(fn.c1.bounce+(fn.nx*mn+fn.ny*bn)+fn.surfacey)*fn.c1.nMass,(cn=(vn=fn.c1.jnAcc)-yn)<0&&(cn=0),yn=cn-vn,fn.c1.jnAcc=cn,xn=fn.nx*yn,dn=fn.ny*yn,fn.b2.velx+=xn*fn.b2.imass,fn.b2.vely+=dn*fn.b2.imass,fn.b1.velx-=xn*fn.b1.imass,fn.b1.vely-=dn*fn.b1.imass,fn.b2.angvel+=fn.rn1b*yn*fn.b2.iinertia,fn.b1.angvel-=fn.rn1a*yn*fn.b1.iinertia;var An,jn,En,In,Tn,Nn,Ln=tn.colarb,Vn=Ln.k1x+Ln.b2.velx-Ln.c1.r2y*Ln.b2.angvel-(Ln.b1.velx-Ln.c1.r1y*Ln.b1.angvel),Dn=Ln.k1y+Ln.b2.vely+Ln.c1.r2x*Ln.b2.angvel-(Ln.b1.vely+Ln.c1.r1x*Ln.b1.angvel);if(En=(Dn*Ln.nx-Vn*Ln.ny+Ln.surfacex)*Ln.c1.tMass,In=Ln.c1.friction*Ln.c1.jnAcc,(Nn=(Tn=Ln.c1.jtAcc)-En)>In?Nn=In:Nn<-In&&(Nn=-In),En=Nn-Tn,Ln.c1.jtAcc=Nn,An=-Ln.ny*En,jn=Ln.nx*En,Ln.b2.velx+=An*Ln.b2.imass,Ln.b2.vely+=jn*Ln.b2.imass,Ln.b1.velx-=An*Ln.b1.imass,Ln.b1.vely-=jn*Ln.b1.imass,Ln.b2.angvel+=Ln.rt1b*En*Ln.b2.iinertia,Ln.b1.angvel-=Ln.rt1a*En*Ln.b1.iinertia,Ln.hc2){var Fn=Ln.k2x+Ln.b2.velx-Ln.c2.r2y*Ln.b2.angvel-(Ln.b1.velx-Ln.c2.r1y*Ln.b1.angvel),Rn=Ln.k2y+Ln.b2.vely+Ln.c2.r2x*Ln.b2.angvel-(Ln.b1.vely+Ln.c2.r1x*Ln.b1.angvel);En=(Rn*Ln.nx-Fn*Ln.ny+Ln.surfacex)*Ln.c2.tMass,In=Ln.c2.friction*Ln.c2.jnAcc,(Nn=(Tn=Ln.c2.jtAcc)-En)>In?Nn=In:Nn<-In&&(Nn=-In),En=Nn-Tn,Ln.c2.jtAcc=Nn,An=-Ln.ny*En,jn=Ln.nx*En,Ln.b2.velx+=An*Ln.b2.imass,Ln.b2.vely+=jn*Ln.b2.imass,Ln.b1.velx-=An*Ln.b1.imass,Ln.b1.vely-=jn*Ln.b1.imass,Ln.b2.angvel+=Ln.rt2b*En*Ln.b2.iinertia,Ln.b1.angvel-=Ln.rt2a*En*Ln.b1.iinertia,Vn=Ln.k1x+Ln.b2.velx-Ln.c1.r2y*Ln.b2.angvel-(Ln.b1.velx-Ln.c1.r1y*Ln.b1.angvel),Dn=Ln.k1y+Ln.b2.vely+Ln.c1.r2x*Ln.b2.angvel-(Ln.b1.vely+Ln.c1.r1x*Ln.b1.angvel),Fn=Ln.k2x+Ln.b2.velx-Ln.c2.r2y*Ln.b2.angvel-(Ln.b1.velx-Ln.c2.r1y*Ln.b1.angvel),Rn=Ln.k2y+Ln.b2.vely+Ln.c2.r2x*Ln.b2.angvel-(Ln.b1.vely+Ln.c2.r1x*Ln.b1.angvel);var Zn=Ln.c1.jnAcc,Bn=Ln.c2.jnAcc,Gn=Vn*Ln.nx+Dn*Ln.ny+Ln.surfacey+Ln.c1.bounce-(Ln.Ka*Zn+Ln.Kb*Bn),qn=Fn*Ln.nx+Rn*Ln.ny+Ln.surfacey+Ln.c2.bounce-(Ln.Kb*Zn+Ln.Kc*Bn),Un=-(Ln.kMassa*Gn+Ln.kMassb*qn),Kn=-(Ln.kMassb*Gn+Ln.kMassc*qn);Un>=0&&Kn>=0?(Gn=Un-Zn,qn=Kn-Bn,Ln.c1.jnAcc=Un,Ln.c2.jnAcc=Kn):(Un=-Ln.c1.nMass*Gn)>=0&&Ln.Kb*Un+qn>=0?(Gn=Un-Zn,qn=-Bn,Ln.c1.jnAcc=Un,Ln.c2.jnAcc=0):(Kn=-Ln.c2.nMass*qn)>=0&&Ln.Kb*Kn+Gn>=0?(Gn=-Zn,qn=Kn-Bn,Ln.c1.jnAcc=0,Ln.c2.jnAcc=Kn):Gn>=0&&qn>=0?(Gn=-Zn,qn=-Bn,Ln.c1.jnAcc=Ln.c2.jnAcc=0):(Gn=0,qn=0),En=Gn+qn,An=Ln.nx*En,jn=Ln.ny*En,Ln.b2.velx+=An*Ln.b2.imass,Ln.b2.vely+=jn*Ln.b2.imass,Ln.b1.velx-=An*Ln.b1.imass,Ln.b1.vely-=jn*Ln.b1.imass,Ln.b2.angvel+=(Ln.rn1b*Gn+Ln.rn2b*qn)*Ln.b2.iinertia,Ln.b1.angvel-=(Ln.rn1a*Gn+Ln.rn2a*qn)*Ln.b1.iinertia}else 0!=Ln.radius&&(En=(Ln.b2.angvel-Ln.b1.angvel)*Ln.rMass,In=Ln.rfric*Ln.c1.jnAcc,Tn=Ln.jrAcc,Ln.jrAcc-=En,Ln.jrAcc>In?Ln.jrAcc=In:Ln.jrAcc<-In&&(Ln.jrAcc=-In),En=Ln.jrAcc-Tn,Ln.b2.angvel+=En*Ln.b2.iinertia,Ln.b1.angvel-=En*Ln.b1.iinertia),Vn=Ln.k1x+Ln.b2.velx-Ln.c1.r2y*Ln.b2.angvel-(Ln.b1.velx-Ln.c1.r1y*Ln.b1.angvel),Dn=Ln.k1y+Ln.b2.vely+Ln.c1.r2x*Ln.b2.angvel-(Ln.b1.vely+Ln.c1.r1x*Ln.b1.angvel),En=(Ln.c1.bounce+(Ln.nx*Vn+Ln.ny*Dn)+Ln.surfacey)*Ln.c1.nMass,(Nn=(Tn=Ln.c1.jnAcc)-En)<0&&(Nn=0),En=Nn-Tn,Ln.c1.jnAcc=Nn,An=Ln.nx*En,jn=Ln.ny*En,Ln.b2.velx+=An*Ln.b2.imass,Ln.b2.vely+=jn*Ln.b2.imass,Ln.b1.velx-=An*Ln.b1.imass,Ln.b1.vely-=jn*Ln.b1.imass,Ln.b2.angvel+=Ln.rn1b*En*Ln.b2.iinertia,Ln.b1.angvel-=Ln.rn1a*En*Ln.b1.iinertia;var Wn,Yn,Jn,Xn,Hn,$n,Qn=tn.colarb,ne=Qn.k1x+Qn.b2.velx-Qn.c1.r2y*Qn.b2.angvel-(Qn.b1.velx-Qn.c1.r1y*Qn.b1.angvel),ee=Qn.k1y+Qn.b2.vely+Qn.c1.r2x*Qn.b2.angvel-(Qn.b1.vely+Qn.c1.r1x*Qn.b1.angvel);if(Jn=(ee*Qn.nx-ne*Qn.ny+Qn.surfacex)*Qn.c1.tMass,Xn=Qn.c1.friction*Qn.c1.jnAcc,($n=(Hn=Qn.c1.jtAcc)-Jn)>Xn?$n=Xn:$n<-Xn&&($n=-Xn),Jn=$n-Hn,Qn.c1.jtAcc=$n,Wn=-Qn.ny*Jn,Yn=Qn.nx*Jn,Qn.b2.velx+=Wn*Qn.b2.imass,Qn.b2.vely+=Yn*Qn.b2.imass,Qn.b1.velx-=Wn*Qn.b1.imass,Qn.b1.vely-=Yn*Qn.b1.imass,Qn.b2.angvel+=Qn.rt1b*Jn*Qn.b2.iinertia,Qn.b1.angvel-=Qn.rt1a*Jn*Qn.b1.iinertia,Qn.hc2){var te=Qn.k2x+Qn.b2.velx-Qn.c2.r2y*Qn.b2.angvel-(Qn.b1.velx-Qn.c2.r1y*Qn.b1.angvel),ie=Qn.k2y+Qn.b2.vely+Qn.c2.r2x*Qn.b2.angvel-(Qn.b1.vely+Qn.c2.r1x*Qn.b1.angvel);Jn=(ie*Qn.nx-te*Qn.ny+Qn.surfacex)*Qn.c2.tMass,Xn=Qn.c2.friction*Qn.c2.jnAcc,($n=(Hn=Qn.c2.jtAcc)-Jn)>Xn?$n=Xn:$n<-Xn&&($n=-Xn),Jn=$n-Hn,Qn.c2.jtAcc=$n,Wn=-Qn.ny*Jn,Yn=Qn.nx*Jn,Qn.b2.velx+=Wn*Qn.b2.imass,Qn.b2.vely+=Yn*Qn.b2.imass,Qn.b1.velx-=Wn*Qn.b1.imass,Qn.b1.vely-=Yn*Qn.b1.imass,Qn.b2.angvel+=Qn.rt2b*Jn*Qn.b2.iinertia,Qn.b1.angvel-=Qn.rt2a*Jn*Qn.b1.iinertia,ne=Qn.k1x+Qn.b2.velx-Qn.c1.r2y*Qn.b2.angvel-(Qn.b1.velx-Qn.c1.r1y*Qn.b1.angvel),ee=Qn.k1y+Qn.b2.vely+Qn.c1.r2x*Qn.b2.angvel-(Qn.b1.vely+Qn.c1.r1x*Qn.b1.angvel),te=Qn.k2x+Qn.b2.velx-Qn.c2.r2y*Qn.b2.angvel-(Qn.b1.velx-Qn.c2.r1y*Qn.b1.angvel),ie=Qn.k2y+Qn.b2.vely+Qn.c2.r2x*Qn.b2.angvel-(Qn.b1.vely+Qn.c2.r1x*Qn.b1.angvel);var pe=Qn.c1.jnAcc,le=Qn.c2.jnAcc,re=ne*Qn.nx+ee*Qn.ny+Qn.surfacey+Qn.c1.bounce-(Qn.Ka*pe+Qn.Kb*le),oe=te*Qn.nx+ie*Qn.ny+Qn.surfacey+Qn.c2.bounce-(Qn.Kb*pe+Qn.Kc*le),ae=-(Qn.kMassa*re+Qn.kMassb*oe),se=-(Qn.kMassb*re+Qn.kMassc*oe);ae>=0&&se>=0?(re=ae-pe,oe=se-le,Qn.c1.jnAcc=ae,Qn.c2.jnAcc=se):(ae=-Qn.c1.nMass*re)>=0&&Qn.Kb*ae+oe>=0?(re=ae-pe,oe=-le,Qn.c1.jnAcc=ae,Qn.c2.jnAcc=0):(se=-Qn.c2.nMass*oe)>=0&&Qn.Kb*se+re>=0?(re=-pe,oe=se-le,Qn.c1.jnAcc=0,Qn.c2.jnAcc=se):re>=0&&oe>=0?(re=-pe,oe=-le,Qn.c1.jnAcc=Qn.c2.jnAcc=0):(re=0,oe=0),Jn=re+oe,Wn=Qn.nx*Jn,Yn=Qn.ny*Jn,Qn.b2.velx+=Wn*Qn.b2.imass,Qn.b2.vely+=Yn*Qn.b2.imass,Qn.b1.velx-=Wn*Qn.b1.imass,Qn.b1.vely-=Yn*Qn.b1.imass,Qn.b2.angvel+=(Qn.rn1b*re+Qn.rn2b*oe)*Qn.b2.iinertia,Qn.b1.angvel-=(Qn.rn1a*re+Qn.rn2a*oe)*Qn.b1.iinertia}else 0!=Qn.radius&&(Jn=(Qn.b2.angvel-Qn.b1.angvel)*Qn.rMass,Xn=Qn.rfric*Qn.c1.jnAcc,Hn=Qn.jrAcc,Qn.jrAcc-=Jn,Qn.jrAcc>Xn?Qn.jrAcc=Xn:Qn.jrAcc<-Xn&&(Qn.jrAcc=-Xn),Jn=Qn.jrAcc-Hn,Qn.b2.angvel+=Jn*Qn.b2.iinertia,Qn.b1.angvel-=Jn*Qn.b1.iinertia),ne=Qn.k1x+Qn.b2.velx-Qn.c1.r2y*Qn.b2.angvel-(Qn.b1.velx-Qn.c1.r1y*Qn.b1.angvel),ee=Qn.k1y+Qn.b2.vely+Qn.c1.r2x*Qn.b2.angvel-(Qn.b1.vely+Qn.c1.r1x*Qn.b1.angvel),Jn=(Qn.c1.bounce+(Qn.nx*ne+Qn.ny*ee)+Qn.surfacey)*Qn.c1.nMass,($n=(Hn=Qn.c1.jnAcc)-Jn)<0&&($n=0),Jn=$n-Hn,Qn.c1.jnAcc=$n,Wn=Qn.nx*Jn,Yn=Qn.ny*Jn,Qn.b2.velx+=Wn*Qn.b2.imass,Qn.b2.vely+=Yn*Qn.b2.imass,Qn.b1.velx-=Wn*Qn.b1.imass,Qn.b1.vely-=Yn*Qn.b1.imass,Qn.b2.angvel+=Qn.rn1b*Jn*Qn.b2.iinertia,Qn.b1.angvel-=Qn.rn1a*Jn*Qn.b1.iinertia;var _e,he,ue,xe,de,ye,ze=tn.colarb,ve=ze.k1x+ze.b2.velx-ze.c1.r2y*ze.b2.angvel-(ze.b1.velx-ze.c1.r1y*ze.b1.angvel),ce=ze.k1y+ze.b2.vely+ze.c1.r2x*ze.b2.angvel-(ze.b1.vely+ze.c1.r1x*ze.b1.angvel);if(ue=(ce*ze.nx-ve*ze.ny+ze.surfacex)*ze.c1.tMass,xe=ze.c1.friction*ze.c1.jnAcc,(ye=(de=ze.c1.jtAcc)-ue)>xe?ye=xe:ye<-xe&&(ye=-xe),ue=ye-de,ze.c1.jtAcc=ye,_e=-ze.ny*ue,he=ze.nx*ue,ze.b2.velx+=_e*ze.b2.imass,ze.b2.vely+=he*ze.b2.imass,ze.b1.velx-=_e*ze.b1.imass,ze.b1.vely-=he*ze.b1.imass,ze.b2.angvel+=ze.rt1b*ue*ze.b2.iinertia,ze.b1.angvel-=ze.rt1a*ue*ze.b1.iinertia,ze.hc2){var fe=ze.k2x+ze.b2.velx-ze.c2.r2y*ze.b2.angvel-(ze.b1.velx-ze.c2.r1y*ze.b1.angvel),me=ze.k2y+ze.b2.vely+ze.c2.r2x*ze.b2.angvel-(ze.b1.vely+ze.c2.r1x*ze.b1.angvel);ue=(me*ze.nx-fe*ze.ny+ze.surfacex)*ze.c2.tMass,xe=ze.c2.friction*ze.c2.jnAcc,(ye=(de=ze.c2.jtAcc)-ue)>xe?ye=xe:ye<-xe&&(ye=-xe),ue=ye-de,ze.c2.jtAcc=ye,_e=-ze.ny*ue,he=ze.nx*ue,ze.b2.velx+=_e*ze.b2.imass,ze.b2.vely+=he*ze.b2.imass,ze.b1.velx-=_e*ze.b1.imass,ze.b1.vely-=he*ze.b1.imass,ze.b2.angvel+=ze.rt2b*ue*ze.b2.iinertia,ze.b1.angvel-=ze.rt2a*ue*ze.b1.iinertia,ve=ze.k1x+ze.b2.velx-ze.c1.r2y*ze.b2.angvel-(ze.b1.velx-ze.c1.r1y*ze.b1.angvel),ce=ze.k1y+ze.b2.vely+ze.c1.r2x*ze.b2.angvel-(ze.b1.vely+ze.c1.r1x*ze.b1.angvel),fe=ze.k2x+ze.b2.velx-ze.c2.r2y*ze.b2.angvel-(ze.b1.velx-ze.c2.r1y*ze.b1.angvel),me=ze.k2y+ze.b2.vely+ze.c2.r2x*ze.b2.angvel-(ze.b1.vely+ze.c2.r1x*ze.b1.angvel);var be=ze.c1.jnAcc,ge=ze.c2.jnAcc,we=ve*ze.nx+ce*ze.ny+ze.surfacey+ze.c1.bounce-(ze.Ka*be+ze.Kb*ge),Me=fe*ze.nx+me*ze.ny+ze.surfacey+ze.c2.bounce-(ze.Kb*be+ze.Kc*ge),ke=-(ze.kMassa*we+ze.kMassb*Me),Oe=-(ze.kMassb*we+ze.kMassc*Me);ke>=0&&Oe>=0?(we=ke-be,Me=Oe-ge,ze.c1.jnAcc=ke,ze.c2.jnAcc=Oe):(ke=-ze.c1.nMass*we)>=0&&ze.Kb*ke+Me>=0?(we=ke-be,Me=-ge,ze.c1.jnAcc=ke,ze.c2.jnAcc=0):(Oe=-ze.c2.nMass*Me)>=0&&ze.Kb*Oe+we>=0?(we=-be,Me=Oe-ge,ze.c1.jnAcc=0,ze.c2.jnAcc=Oe):we>=0&&Me>=0?(we=-be,Me=-ge,ze.c1.jnAcc=ze.c2.jnAcc=0):(we=0,Me=0),ue=we+Me,_e=ze.nx*ue,he=ze.ny*ue,ze.b2.velx+=_e*ze.b2.imass,ze.b2.vely+=he*ze.b2.imass,ze.b1.velx-=_e*ze.b1.imass,ze.b1.vely-=he*ze.b1.imass,ze.b2.angvel+=(ze.rn1b*we+ze.rn2b*Me)*ze.b2.iinertia,ze.b1.angvel-=(ze.rn1a*we+ze.rn2a*Me)*ze.b1.iinertia}else 0!=ze.radius&&(ue=(ze.b2.angvel-ze.b1.angvel)*ze.rMass,xe=ze.rfric*ze.c1.jnAcc,de=ze.jrAcc,ze.jrAcc-=ue,ze.jrAcc>xe?ze.jrAcc=xe:ze.jrAcc<-xe&&(ze.jrAcc=-xe),ue=ze.jrAcc-de,ze.b2.angvel+=ue*ze.b2.iinertia,ze.b1.angvel-=ue*ze.b1.iinertia),ve=ze.k1x+ze.b2.velx-ze.c1.r2y*ze.b2.angvel-(ze.b1.velx-ze.c1.r1y*ze.b1.angvel),ce=ze.k1y+ze.b2.vely+ze.c1.r2x*ze.b2.angvel-(ze.b1.vely+ze.c1.r1x*ze.b1.angvel),ue=(ze.c1.bounce+(ze.nx*ve+ze.ny*ce)+ze.surfacey)*ze.c1.nMass,(ye=(de=ze.c1.jnAcc)-ue)<0&&(ye=0),ue=ye-de,ze.c1.jnAcc=ye,_e=ze.nx*ue,he=ze.ny*ue,ze.b2.velx+=_e*ze.b2.imass,ze.b2.vely+=he*ze.b2.imass,ze.b1.velx-=_e*ze.b1.imass,ze.b1.vely-=he*ze.b1.imass,ze.b2.angvel+=ze.rn1b*ue*ze.b2.iinertia,ze.b1.angvel-=ze.rn1a*ue*ze.b1.iinertia;d.sweep_angvel=d.angvel%e,y.sweep_angvel=y.angvel%e}null!=tn&&tn.active&&0!=(1&tn.immState)&&tn.type==Ce.COL&&(d.sweepFrozen||3==d.type||(d.sweepFrozen=!0,i.failed?d.angvel=d.sweep_angvel=0:i.slipped?d.angvel=d.sweep_angvel*=o.angularCCDSlipScale:d.angvel=d.sweep_angvel),y.sweepFrozen||3==y.type||(y.sweepFrozen=!0,i.failed?y.angvel=y.sweep_angvel=0:i.slipped?y.angvel=y.sweep_angvel*=o.angularCCDSlipScale:y.angvel=y.sweep_angvel));var Pe=i;Pe.next=st.zpp_pool,st.zpp_pool=Pe}for(;null!=this.toiEvents.head;){var Se=this.toiEvents.pop_unsafe();Se.next=st.zpp_pool,st.zpp_pool=Se}for(var Ae=this.kinematics.head;null!=Ae;){var je=Ae.elt,Ee=n-je.sweepTime;if(0!=Ee&&(je.sweepTime=n,je.posx+=je.velx*Ee,je.posy+=je.vely*Ee,0!=je.angvel)){var Ie=je.sweep_angvel*Ee;if(je.rot+=Ie,Ie*Ie>1e-4)je.axisx=Math.sin(je.rot),je.axisy=Math.cos(je.rot);else{var Te=Ie*Ie,Ne=1-.5*Te,Ve=1-Te*Te/8,De=(Ne*je.axisx+Ie*je.axisy)*Ve;je.axisy=(Ne*je.axisy-Ie*je.axisx)*Ve,je.axisx=De}}je.sweepTime=0,Ae=Ae.next}for(var Fe=this.live.head;null!=Fe;){var Re=Fe.elt;if(!Re.sweepFrozen){var Ze=n-Re.sweepTime;if(0!=Ze&&(Re.sweepTime=n,Re.posx+=Re.velx*Ze,Re.posy+=Re.vely*Ze,0!=Re.angvel)){var Be=Re.sweep_angvel*Ze;if(Re.rot+=Be,Be*Be>1e-4)Re.axisx=Math.sin(Re.rot),Re.axisy=Math.cos(Re.rot);else{var Ge=Be*Be,qe=1-.5*Ge,Ue=1-Ge*Ge/8,Ke=(qe*Re.axisx+Be*Re.axisy)*Ue;Re.axisy=(qe*Re.axisy-Be*Re.axisx)*Ue,Re.axisx=Ke}}}Re.sweepTime=0,Fe=Fe.next}},Tt.prototype.continuousEvent=function(n,e,t,i,p){if(n.body.sweepFrozen&&e.body.sweepFrozen)return i;if(n.body.disableCCD||e.body.disableCCD)return i;var l;if(null==i||null!=i.colarb){var r,a=n.body,s=e.body;r=!1;for(var _,h,u=a.constraints.head;null!=u;){var x=u.elt;if(x.ignore&&x.pair_exists(a.id,s.id)){r=!0;break}u=u.next}if(r)h=!1;else{for(var d=n;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var y,z=null==d?null:d.group;if(null==z)y=!1;else{for(var v=e;null!=v&&null==v.group;)v=null!=v.ishape?v.ishape.body:null!=v.icompound?v.icompound.compound:v.ibody.compound;var c=null==v?null:v.group;if(null==c)y=!1;else{for(var f=!1;null!=z&&null!=c;){if(z==c){f=z.ignore;break}z.depth<c.depth?c=c.group:z=z.group}y=f}}h=!y}if(h){var m;if(n.sensorEnabled||e.sensorEnabled){var b=n.filter,g=e.filter;m=0!=(b.sensorMask&g.sensorGroup)&&0!=(g.sensorMask&b.sensorGroup)}else m=!1;if(m)_=2;else{var w;if(n.fluidEnabled||e.fluidEnabled){var M=n.filter,C=e.filter;w=0!=(M.fluidMask&C.fluidGroup)&&0!=(C.fluidMask&M.fluidGroup)}else w=!1;if(!!w&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia))_=0;else{var k=n.filter,O=e.filter;_=0!=(k.collisionMask&O.collisionGroup)&&0!=(O.collisionMask&k.collisionGroup)&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia)?1:-1}}}else _=-1;l=_<=0}else l=!0;if(l)return i;var P=n.body,S=e.body;if(t||P.bullet||S.bullet){var A;null==st.zpp_pool?A=new st:(A=st.zpp_pool,st.zpp_pool=A.next,A.next=null),A.failed=!1,A.s1=A.s2=null,A.arbiter=null;var j=3==P.type||3==S.type;if(t&&!j)2!=n.body.type?(A.s2=n,A.s1=e):(A.s1=n,A.s2=e),A.kinematic=!1,_t.staticSweep(A,this.pre_dt,0,o.collisionSlopCCD);else if(A.s1=n,A.s2=e,A.kinematic=j,A.s1.body.sweepFrozen||A.s2.body.sweepFrozen){if(A.s1.body.sweepFrozen){var E=A.s1;A.s1=A.s2,A.s2=E,A.frozen1=!1,A.frozen2=!0}_t.staticSweep(A,this.pre_dt,0,o.collisionSlopCCD)}else _t.dynamicSweep(A,this.pre_dt,0,o.collisionSlopCCD);if(t&&A.toi<0||A.failed){var I=A;I.next=st.zpp_pool,st.zpp_pool=I}else this.toiEvents.add(A),A.frozen1=A.s1.body.sweepFrozen,A.frozen2=A.s2.body.sweepFrozen,A.arbiter=null!=i?i.colarb:null}return i},Tt.prototype.bodyCbWake=function(n){if(2==n.type&&null!=n.cbSet)if(this.midstep)for(var e=n.cbSet.bodylisteners.head;null!=e;){var t=e.elt;if(2==t.event){var i=this.push_callback(t);i.event=2,i.body=n,e=e.next}else e=e.next}else n.component.woken=!0},Tt.prototype.bodyCbSleep=function(n){if(2==n.type&&null!=n.cbSet)for(var e=n.cbSet.bodylisteners.head;null!=e;){var t=e.elt;if(3==t.event){var i=this.push_callback(t);i.event=3,i.body=n,e=e.next}else e=e.next}},Tt.prototype.constraintCbWake=function(n){if(null!=n.cbSet)if(this.midstep)for(var e=n.cbSet.conlisteners.head;null!=e;){var t=e.elt;if(2==t.event){var i=this.push_callback(t);i.event=2,i.constraint=n,e=e.next}else e=e.next}else n.component.woken=!0},Tt.prototype.constraintCbSleep=function(n){if(null!=n.cbSet)for(var e=n.cbSet.conlisteners.head;null!=e;){var t=e.elt;if(3==t.event){var i=this.push_callback(t);i.event=3,i.constraint=n,e=e.next}else e=e.next}},Tt.prototype.constraintCbBreak=function(n){if(null!=n.cbSet)for(var e=n.cbSet.conlisteners.head;null!=e;){var t=e.elt;if(4==t.event){var i=this.push_callback(t);i.event=4,i.constraint=n,e=e.next}else e=e.next}},Tt.prototype.nullListenerType=function(n,e){for(var t=new pe,i=n.interactors.head;null!=i;)t.add(i.elt),i=i.next;if(n!=e)for(var p=e.interactors.head;null!=p;)t.add(p.elt),p=p.next;for(;null!=t.head;){var l=t.pop_unsafe();if(null!=l.icompound){for(var r=l.icompound,o=r.bodies.head;null!=o;)t.add(o.elt),o=o.next;for(var a=r.compounds.head;null!=a;)t.add(a.elt),a=a.next}else for(var s=null!=l.ibody?l.ibody:l.ishape.body,_=null!=l.ishape?l.ishape:null,h=s.arbiters.head;null!=h;){var u=h.elt;if(0!=u.present)if(null==_||u.ws1==_||u.ws2==_){this.MRCA_chains(u.ws1,u.ws2);for(var x=this.mrca1.head;null!=x;){var d=x.elt;if(d.cbSet==n||d.cbSet==e){for(var y=this.mrca2.head;null!=y;){var z=y.elt;if(d.cbSet==n&&z.cbSet!=e||d.cbSet==e&&z.cbSet!=n)y=y.next;else{var v=zt.get(d,z);if(null!=v){for(;null!=v.arbiters.head;)v.arbiters.pop_unsafe().present--;this.remove_callbackset(v)}y=y.next}}x=x.next}else x=x.next}h=h.next}else h=h.next;else h=h.next}}},Tt.prototype.nullInteractorType=function(n,e){if(null==e&&(e=n),null!=n.icompound){for(var t=n.icompound,i=t.bodies.head;null!=i;)this.nullInteractorType(i.elt,e),i=i.next;for(var p=t.compounds.head;null!=p;)this.nullInteractorType(p.elt,e),p=p.next}else for(var l=null!=n.ibody?n.ibody:n.ishape.body,r=null!=n.ishape?n.ishape:null,o=l.arbiters.head;null!=o;){var a=o.elt;if(0!=a.present)if(null==r||a.ws1==r||a.ws2==r){this.MRCA_chains(a.ws1,a.ws2);for(var s=this.mrca1.head;null!=s;){for(var _=s.elt,h=this.mrca2.head;null!=h;){var u=h.elt;if(_==e||u==e){var x=zt.get(_,u);null!=x&&(a.present--,x.remove_arb(a),null==x.arbiters.head&&this.remove_callbackset(x)),h=h.next}else h=h.next}s=s.next}o=o.next}else o=o.next;else o=o.next}},Tt.prototype.freshListenerType=function(n,e){for(var t=new pe,i=n.interactors.head;null!=i;)t.add(i.elt),i=i.next;if(n!=e)for(var p=e.interactors.head;null!=p;)t.add(p.elt),p=p.next;for(;null!=t.head;){var l=t.pop_unsafe();if(null!=l.icompound){for(var r=l.icompound,o=r.bodies.head;null!=o;)t.add(o.elt),o=o.next;for(var a=r.compounds.head;null!=a;)t.add(a.elt),a=a.next}else for(var s=null!=l.ibody?l.ibody:l.ishape.body,_=null!=l.ishape?l.ishape:null,h=s.arbiters.head;null!=h;){var u=h.elt;if(u.presentable)if(null==_||u.ws1==_||u.ws2==_){this.MRCA_chains(u.ws1,u.ws2);for(var x=this.mrca1.head;null!=x;){var d=x.elt;if(d.cbSet==n||d.cbSet==e){for(var y=this.mrca2.head;null!=y;){var z=y.elt;if(d.cbSet==n&&z.cbSet!=e||d.cbSet==e&&z.cbSet!=n)y=y.next;else{var v,c,f=zt.get(d,z);null==f&&(f=Et.get(d,z),this.add_callbackset(f)),c=!1;for(var m=f.arbiters.head;null!=m;){if(m.elt==u){c=!0;break}m=m.next}if(c)v=!1;else{var b,g=f.arbiters;null==bi.zpp_pool?b=new bi:(b=bi.zpp_pool,bi.zpp_pool=b.next,b.next=null),b.elt=u;var w=b;w.next=g.head,g.head=w,g.modified=!0,g.length++,v=!0}v&&u.present++,y=y.next}}x=x.next}else x=x.next}h=h.next}else h=h.next;else h=h.next}}},Tt.prototype.freshInteractorType=function(n,e){if(null==e&&(e=n),null!=n.icompound){for(var t=n.icompound,i=t.bodies.head;null!=i;)this.freshInteractorType(i.elt,e),i=i.next;for(var p=t.compounds.head;null!=p;)this.freshInteractorType(p.elt,e),p=p.next}else for(var l=null!=n.ibody?n.ibody:n.ishape.body,r=null!=n.ishape?n.ishape:null,o=l.arbiters.head;null!=o;){var a=o.elt;if(a.presentable)if(null==r||a.ws1==r||a.ws2==r){this.MRCA_chains(a.ws1,a.ws2);for(var s=this.mrca1.head;null!=s;){for(var _=s.elt,h=this.mrca2.head;null!=h;){var u=h.elt;if(_==e||u==e){var x=_.cbSet,d=u.cbSet;x.validate(),d.validate();for(var y,z=null,v=(x.cbpairs.length<d.cbpairs.length?x.cbpairs:d.cbpairs).head;null!=v;){var c=v.elt;if(c.a==x&&c.b==d||c.a==d&&c.b==x){z=c;break}v=v.next}if(null==z)null==Qn.zpp_pool?y=new Qn:(y=Qn.zpp_pool,Qn.zpp_pool=y.next,y.next=null),y.zip_listeners=!0,$n.setlt(x,d)?(y.a=x,y.b=d):(y.a=d,y.b=x),z=y,x.cbpairs.add(z),d!=x&&d.cbpairs.add(z);if(z.zip_listeners&&(z.zip_listeners=!1,z.__validate()),null!=z.listeners.head){var f,m,b=zt.get(_,u);null==b&&(b=Et.get(_,u),this.add_callbackset(b)),m=!1;for(var g=b.arbiters.head;null!=g;){if(g.elt==a){m=!0;break}g=g.next}if(m)f=!1;else{var w,M=b.arbiters;null==bi.zpp_pool?w=new bi:(w=bi.zpp_pool,bi.zpp_pool=w.next,w.next=null),w.elt=a;var C=w;C.next=M.head,M.head=C,M.modified=!0,M.length++,f=!0}f&&a.present++}h=h.next}else h=h.next}s=s.next}o=o.next}else o=o.next;else o=o.next}},Tt.prototype.wakeCompound=function(n){for(var e=n.bodies.head;null!=e;){var t=e.elt;t.world||(t.component.waket=this.stamp+(this.midstep?0:1),3==t.type&&(t.kinematicDelaySleep=!0),t.component.sleeping&&this.really_wake(t,!1)),e=e.next}for(var i=n.constraints.head;null!=i;)this.wake_constraint(i.elt),i=i.next;for(var p=n.compounds.head;null!=p;)this.wakeCompound(p.elt),p=p.next},Tt.prototype.wakeIsland=function(n){for(;null!=n.comps.head;){var e=n.comps.pop_unsafe();if(e.waket=this.stamp+(this.midstep?0:1),e.isBody){var t=e.body;this.live.add(t);for(var i=t.arbiters.head;null!=i;){var p=i.elt;if(p.sleeping)if(p.sleeping=!1,p.up_stamp+=this.stamp-p.sleep_stamp,p.type==Ce.COL){var l=p.colarb;if(l.stat){var r,o=this.c_arbiters_true;null==qi.zpp_pool?r=new qi:(r=qi.zpp_pool,qi.zpp_pool=r.next,r.next=null),r.elt=l;var a=r;a.next=o.head,o.head=a,o.modified=!0,o.length++}else{var s,_=this.c_arbiters_false;null==qi.zpp_pool?s=new qi:(s=qi.zpp_pool,qi.zpp_pool=s.next,s.next=null),s.elt=l;var h=s;h.next=_.head,_.head=h,_.modified=!0,_.length++}}else if(p.type==Ce.FLUID){var u,x=this.f_arbiters,d=p.fluidarb;null==Zi.zpp_pool?u=new Zi:(u=Zi.zpp_pool,Zi.zpp_pool=u.next,u.next=null),u.elt=d;var y=u;y.next=x.head,x.head=y,x.modified=!0,x.length++}else{var z,v=this.s_arbiters,c=p.sensorarb;null==Bi.zpp_pool?z=new Bi:(z=Bi.zpp_pool,Bi.zpp_pool=z.next,z.next=null),z.elt=c;var f=z;f.next=v.head,v.head=f,v.modified=!0,v.length++}i=i.next}if(this.bodyCbWake(t),e.sleeping=!1,e.island=null,e.parent=e,e.rank=0,1!=t.type)for(var m=t.shapes.head;null!=m;){var b=m.elt;null!=b.node&&this.bphase.sync(b),m=m.next}}else{var g,w=e.constraint,M=this.live_constraints;null==fi.zpp_pool?g=new fi:(g=fi.zpp_pool,fi.zpp_pool=g.next,g.next=null),g.elt=w;var C=g;C.next=M.head,M.head=C,M.modified=!0,M.length++,this.constraintCbWake(w),e.sleeping=!1,e.island=null,e.parent=e,e.rank=0}}n.next=At.zpp_pool,At.zpp_pool=n},Tt.prototype.non_inlined_wake=function(n,e){null==e&&(e=!1),n.world||(n.component.waket=this.stamp+(this.midstep?0:1),3==n.type&&(n.kinematicDelaySleep=!0),n.component.sleeping&&this.really_wake(n,e))},Tt.prototype.really_wake=function(n,e){if(null==e&&(e=!1),null==n.component.island){if(n.component.sleeping=!1,3==n.type||1==n.type){var t,i=this.staticsleep;null==ci.zpp_pool?t=new ci:(t=ci.zpp_pool,ci.zpp_pool=t.next,t.next=null),t.elt=n;var p=t;p.next=i.head,i.head=p,i.modified=!0,i.length++}else{var l,r=this.live;null==ci.zpp_pool?l=new ci:(l=ci.zpp_pool,ci.zpp_pool=l.next,l.next=null),l.elt=n;var o=l;o.next=r.head,r.head=o,r.modified=!0,r.length++}for(var a=n.constraints.head;null!=a;){var s=a.elt;s.space==this&&this.wake_constraint(s),a=a.next}for(var _=n.arbiters.head;null!=_;){var h=_.elt;if(h.sleeping)if(h.sleeping=!1,h.up_stamp+=this.stamp+(this.midstep?0:1)-h.sleep_stamp,h.type==Ce.COL){var u=h.colarb;if(u.stat){var x,d=this.c_arbiters_true;null==qi.zpp_pool?x=new qi:(x=qi.zpp_pool,qi.zpp_pool=x.next,x.next=null),x.elt=u;var y=x;y.next=d.head,d.head=y,d.modified=!0,d.length++}else{var z,v=this.c_arbiters_false;null==qi.zpp_pool?z=new qi:(z=qi.zpp_pool,qi.zpp_pool=z.next,z.next=null),z.elt=u;var c=z;c.next=v.head,v.head=c,v.modified=!0,v.length++}}else if(h.type==Ce.FLUID){var f,m=this.f_arbiters,b=h.fluidarb;null==Zi.zpp_pool?f=new Zi:(f=Zi.zpp_pool,Zi.zpp_pool=f.next,f.next=null),f.elt=b;var g=f;g.next=m.head,m.head=g,m.modified=!0,m.length++}else{var w,M=this.s_arbiters,C=h.sensorarb;null==Bi.zpp_pool?w=new Bi:(w=Bi.zpp_pool,Bi.zpp_pool=w.next,w.next=null),w.elt=C;var k=w;k.next=M.head,M.head=k,M.modified=!0,M.length++}if(h.type!=Ce.SENSOR&&!h.cleared&&h.up_stamp>=this.stamp&&0!=(1&h.immState)){if(2==h.b1.type&&h.b1.component.sleeping){var O=h.b1;O.world||(O.component.waket=this.stamp+(this.midstep?0:1),3==O.type&&(O.kinematicDelaySleep=!0),O.component.sleeping&&this.really_wake(O,!1))}if(2==h.b2.type&&h.b2.component.sleeping){var P=h.b2;P.world||(P.component.waket=this.stamp+(this.midstep?0:1),3==P.type&&(P.kinematicDelaySleep=!0),P.component.sleeping&&this.really_wake(P,!1))}}_=_.next}if(e||2!=n.type||this.bodyCbWake(n),!e&&!this.bphase.is_sweep&&1!=n.type)for(var S=n.shapes.head;null!=S;){var A=S.elt;null!=A.node&&this.bphase.sync(A),S=S.next}}else this.wakeIsland(n.component.island)},Tt.prototype.wake_constraint=function(n,e){if(null==e&&(e=!1),n.active){if(n.component.waket=this.stamp+(this.midstep?0:1),n.component.sleeping){if(null==n.component.island){n.component.sleeping=!1;var t,i=this.live_constraints;null==fi.zpp_pool?t=new fi:(t=fi.zpp_pool,fi.zpp_pool=t.next,t.next=null),t.elt=n;var p=t;p.next=i.head,i.head=p,i.modified=!0,i.length++,n.wake_connected(),e||this.constraintCbWake(n)}else this.wakeIsland(n.component.island);return!0}return!1}return!1},Tt.prototype.doForests=function(n){for(var e=this.c_arbiters_false.head;null!=e;){var t=e.elt;if(!t.cleared&&t.up_stamp==this.stamp&&0!=(1&t.immState)&&2==t.b1.type&&2==t.b2.type){var i,p;if(t.b1.component==t.b1.component.parent)i=t.b1.component;else{for(var l=t.b1.component,r=null;l!=l.parent;){var o=l.parent;l.parent=r,r=l,l=o}for(;null!=r;){var a=r.parent;r.parent=l,r=a}i=l}if(t.b2.component==t.b2.component.parent)p=t.b2.component;else{for(var s=t.b2.component,_=null;s!=s.parent;){var h=s.parent;s.parent=_,_=s,s=h}for(;null!=_;){var u=_.parent;_.parent=s,_=u}p=s}i!=p&&(i.rank<p.rank?i.parent=p:i.rank>p.rank?p.parent=i:(p.parent=i,i.rank++))}e=e.next}for(var x=this.f_arbiters.head;null!=x;){var d=x.elt;if(!d.cleared&&d.up_stamp==this.stamp&&0!=(1&d.immState)&&2==d.b1.type&&2==d.b2.type){var y,z;if(d.b1.component==d.b1.component.parent)y=d.b1.component;else{for(var v=d.b1.component,c=null;v!=v.parent;){var f=v.parent;v.parent=c,c=v,v=f}for(;null!=c;){var m=c.parent;c.parent=v,c=m}y=v}if(d.b2.component==d.b2.component.parent)z=d.b2.component;else{for(var b=d.b2.component,g=null;b!=b.parent;){var w=b.parent;b.parent=g,g=b,b=w}for(;null!=g;){var M=g.parent;g.parent=b,g=M}z=b}y!=z&&(y.rank<z.rank?y.parent=z:y.rank>z.rank?z.parent=y:(z.parent=y,y.rank++))}x=x.next}for(var C=this.live_constraints.head;null!=C;)C.elt.forest(),C=C.next;for(;null!=this.live.head;){var k=this.live,O=k.head.elt;k.pop();var P,S=O.component;if(S==S.parent)P=S;else{for(var A=S,j=null;A!=A.parent;){var E=A.parent;A.parent=j,j=A,A=E}for(;null!=j;){var I=j.parent;j.parent=A,j=I}P=A}if(null==P.island){null==At.zpp_pool?P.island=new At:(P.island=At.zpp_pool,At.zpp_pool=P.island.next,P.island.next=null),P.island.waket=0;var T=this.islands,N=P.island;N._inuse=!0,N.next=T.next,T.next=N,T.modified=!0,T.length++,P.island.sleep=!0}S.island=P.island;var L,V=S.island.comps;null==Ri.zpp_pool?L=new Ri:(L=Ri.zpp_pool,Ri.zpp_pool=L.next,L.next=null),L.elt=S;var D=L;D.next=V.head,V.head=D,V.modified=!0,V.length++;var F=O.atRest(n);S.island.sleep=S.island.sleep&&F,S.waket>S.island.waket&&(S.island.waket=S.waket)}for(;null!=this.live_constraints.head;){var R=this.live_constraints,Z=R.head.elt;R.pop();var B,G=Z.component;if(G==G.parent)B=G;else{for(var q=G,U=null;q!=q.parent;){var K=q.parent;q.parent=U,U=q,q=K}for(;null!=U;){var W=U.parent;U.parent=q,U=W}B=q}G.island=B.island;var Y,J=G.island.comps;null==Ri.zpp_pool?Y=new Ri:(Y=Ri.zpp_pool,Ri.zpp_pool=Y.next,Y.next=null),Y.elt=G;var X=Y;X.next=J.head,J.head=X,J.modified=!0,J.length++,G.waket>G.island.waket&&(G.island.waket=G.waket)}for(;null!=this.islands.next;){var H=this.islands,$=H.next;if(H.pop(),$.sleep)for(var Q=$.comps.head;null!=Q;){var nn=Q.elt;if(nn.isBody){var en=nn.body;en.velx=0,en.vely=0,en.angvel=0,nn.sleeping=!0;for(var tn=en.shapes.head;null!=tn;)this.bphase.sync(tn.elt),tn=tn.next;this.bodyCbSleep(en)}else this.constraintCbSleep(nn.constraint),nn.sleeping=!0;Q=Q.next}else{for(;null!=$.comps.head;){var pn=$.comps,ln=pn.head.elt;if(pn.pop(),ln.waket=$.waket,ln.isBody){var rn,on=this.live,an=ln.body;null==ci.zpp_pool?rn=new ci:(rn=ci.zpp_pool,ci.zpp_pool=rn.next,rn.next=null),rn.elt=an;var sn=rn;sn.next=on.head,on.head=sn,on.modified=!0,on.length++}else{var _n,hn=this.live_constraints,un=ln.constraint;null==fi.zpp_pool?_n=new fi:(_n=fi.zpp_pool,fi.zpp_pool=_n.next,_n.next=null),_n.elt=un;var xn=_n;xn.next=hn.head,hn.head=xn,hn.modified=!0,hn.length++}ln.sleeping=!1,ln.island=null,ln.parent=ln,ln.rank=0}$.next=At.zpp_pool,At.zpp_pool=$}}},Tt.prototype.sleepArbiters=function(){var n=null,e=this.c_arbiters_true,t=e.head,i=null!=this.c_arbiters_false;for(i&&null==t&&(i=!1,t=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null);null!=t;){var p=t.elt;if(p.b1.component.sleeping&&p.b2.component.sleeping){var l,r;p.sleep_stamp=this.stamp,p.sleeping=!0,null==n?(r=(l=e.head).next,e.head=r,null==e.head&&(e.pushmod=!0)):(r=(l=n.next).next,n.next=r,null==r&&(e.pushmod=!0));var o=l;o.elt=null,o.next=qi.zpp_pool,qi.zpp_pool=o,e.modified=!0,e.length--,e.pushmod=!0,t=r,i&&null==t&&(i=!1,t=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null)}else n=t,t=t.next,i&&null==t&&(i=!1,t=this.c_arbiters_false.head,e=this.c_arbiters_false,n=null)}for(var a=null,s=this.f_arbiters,_=s.head;null!=_;){var h=_.elt;if(h.b1.component.sleeping&&h.b2.component.sleeping){var u,x;h.sleep_stamp=this.stamp,h.sleeping=!0,null==a?(x=(u=s.head).next,s.head=x,null==s.head&&(s.pushmod=!0)):(x=(u=a.next).next,a.next=x,null==x&&(s.pushmod=!0));var d=u;d.elt=null,d.next=Zi.zpp_pool,Zi.zpp_pool=d,s.modified=!0,s.length--,s.pushmod=!0,_=x}else a=_,_=_.next}for(var y=null,z=this.s_arbiters,v=z.head;null!=v;){var c=v.elt;if(c.b1.component.sleeping&&c.b2.component.sleeping){var f,m;c.sleep_stamp=this.stamp,c.sleeping=!0,null==y?(m=(f=z.head).next,z.head=m,null==z.head&&(z.pushmod=!0)):(m=(f=y.next).next,y.next=m,null==m&&(z.pushmod=!0));var b=f;b.elt=null,b.next=Bi.zpp_pool,Bi.zpp_pool=b,z.modified=!0,z.length--,z.pushmod=!0,v=m}else y=v,v=v.next}},Tt.prototype.static_validation=function(n){if(null!=n.shapes.head&&n.zip_aabb){n.zip_aabb=!1,n.aabb.minx=1/0,n.aabb.miny=1/0,n.aabb.maxx=-1/0,n.aabb.maxy=-1/0;for(var e=n.shapes.head;null!=e;){var t=e.elt;if(t.zip_aabb&&null!=t.body)if(t.zip_aabb=!1,0==t.type){var i=t.circle;if(i.zip_worldCOM&&null!=i.body){if(i.zip_worldCOM=!1,i.zip_localCOM){if(i.zip_localCOM=!1,1==i.type){var p=i.polygon;if(null==p.lverts.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y;else if(null==p.lverts.next.next.next)p.localCOMx=p.lverts.next.x,p.localCOMy=p.lverts.next.y,p.localCOMx+=p.lverts.next.next.x,p.localCOMy+=p.lverts.next.next.y,p.localCOMx*=.5,p.localCOMy*=.5;else{p.localCOMx=0,p.localCOMy=0;var l=0,r=p.lverts.next,o=r,a=r=r.next;for(r=r.next;null!=r;){var s=r;l+=a.x*(s.y-o.y);var _=s.y*a.x-s.x*a.y;p.localCOMx+=(a.x+s.x)*_,p.localCOMy+=(a.y+s.y)*_,o=a,a=s,r=r.next}var h=r=p.lverts.next;l+=a.x*(h.y-o.y);var u=h.y*a.x-h.x*a.y;p.localCOMx+=(a.x+h.x)*u,p.localCOMy+=(a.y+h.y)*u,o=a;var x=r=r.next;l+=h.x*(x.y-o.y);var d=x.y*h.x-x.x*h.y;p.localCOMx+=(h.x+x.x)*d,p.localCOMy+=(h.y+x.y)*d;var y=l=1/(3*l);p.localCOMx*=y,p.localCOMy*=y}}null!=i.wrap_localCOM&&(i.wrap_localCOM.zpp_inner.x=i.localCOMx,i.wrap_localCOM.zpp_inner.y=i.localCOMy)}var z=i.body;z.zip_axis&&(z.zip_axis=!1,z.axisx=Math.sin(z.rot),z.axisy=Math.cos(z.rot)),i.worldCOMx=i.body.posx+(i.body.axisy*i.localCOMx-i.body.axisx*i.localCOMy),i.worldCOMy=i.body.posy+(i.localCOMx*i.body.axisx+i.localCOMy*i.body.axisy)}var v=i.radius,c=i.radius;i.aabb.minx=i.worldCOMx-v,i.aabb.miny=i.worldCOMy-c,i.aabb.maxx=i.worldCOMx+v,i.aabb.maxy=i.worldCOMy+c}else{var f=t.polygon;if(f.zip_gverts&&null!=f.body){f.zip_gverts=!1,f.validate_lverts();var m=f.body;m.zip_axis&&(m.zip_axis=!1,m.axisx=Math.sin(m.rot),m.axisy=Math.cos(m.rot));for(var b=f.lverts.next,g=f.gverts.next;null!=g;){var w=g,M=b;b=b.next,w.x=f.body.posx+(f.body.axisy*M.x-f.body.axisx*M.y),w.y=f.body.posy+(M.x*f.body.axisx+M.y*f.body.axisy),g=g.next}}var C=f.gverts.next;f.aabb.minx=C.x,f.aabb.miny=C.y,f.aabb.maxx=C.x,f.aabb.maxy=C.y;for(var k=f.gverts.next.next;null!=k;){var O=k;O.x<f.aabb.minx&&(f.aabb.minx=O.x),O.x>f.aabb.maxx&&(f.aabb.maxx=O.x),O.y<f.aabb.miny&&(f.aabb.miny=O.y),O.y>f.aabb.maxy&&(f.aabb.maxy=O.y),k=k.next}}var P=n.aabb,S=t.aabb;S.minx<P.minx&&(P.minx=S.minx),S.maxx>P.maxx&&(P.maxx=S.maxx),S.miny<P.miny&&(P.miny=S.miny),S.maxy>P.maxy&&(P.maxy=S.maxy),e=e.next}}n.validate_mass(),n.validate_inertia();for(var A=n.shapes.head;null!=A;){var j=A.elt;if(1==j.type){var E=j.polygon;E.zip_sanitation&&(E.zip_sanitation=!1,E.splice_collinear_real());var I=j.polygon;if(I.zip_gaxi&&null!=I.body){I.zip_gaxi=!1,I.validate_laxi();var T=I.body;if(T.zip_axis&&(T.zip_axis=!1,T.axisx=Math.sin(T.rot),T.axisy=Math.cos(T.rot)),I.zip_gverts&&null!=I.body){I.zip_gverts=!1,I.validate_lverts();var N=I.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot));for(var L=I.lverts.next,V=I.gverts.next;null!=V;){var D=V,F=L;L=L.next,D.x=I.body.posx+(I.body.axisy*F.x-I.body.axisx*F.y),D.y=I.body.posy+(F.x*I.body.axisx+F.y*I.body.axisy),V=V.next}}var R=I.edges.head,Z=I.gverts.next,B=Z;for(Z=Z.next;null!=Z;){var G=Z,q=R.elt;R=R.next,q.gp0=B,q.gp1=G,q.gnormx=I.body.axisy*q.lnormx-I.body.axisx*q.lnormy,q.gnormy=q.lnormx*I.body.axisx+q.lnormy*I.body.axisy,q.gprojection=I.body.posx*q.gnormx+I.body.posy*q.gnormy+q.lprojection,null!=q.wrap_gnorm&&(q.wrap_gnorm.zpp_inner.x=q.gnormx,q.wrap_gnorm.zpp_inner.y=q.gnormy),q.tp0=q.gp0.y*q.gnormx-q.gp0.x*q.gnormy,q.tp1=q.gp1.y*q.gnormx-q.gp1.x*q.gnormy,B=G,Z=Z.next}var U=R.elt;U.gp0=B,U.gp1=I.gverts.next,U.gnormx=I.body.axisy*U.lnormx-I.body.axisx*U.lnormy,U.gnormy=U.lnormx*I.body.axisx+U.lnormy*I.body.axisy,U.gprojection=I.body.posx*U.gnormx+I.body.posy*U.gnormy+U.lprojection,null!=U.wrap_gnorm&&(U.wrap_gnorm.zpp_inner.x=U.gnormx,U.wrap_gnorm.zpp_inner.y=U.gnormy),U.tp0=U.gp0.y*U.gnormx-U.gp0.x*U.gnormy,U.tp1=U.gp1.y*U.gnormx-U.gp1.x*U.gnormy}}A=A.next}n.sweepFrozen=!0},Tt.prototype.validation=function(){var n=this.cbsets;if(!n.cbsets.empty()){for(var e=n.cbsets.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(e.data.validate(),null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}for(var t=this.live.head;null!=t;){var i=t.elt;i.sweepRadius=0;for(var p=i.shapes.head;null!=p;){var l=p.elt;if(1==l.type){var r=l.polygon;r.zip_sanitation&&(r.zip_sanitation=!1,r.splice_collinear_real());var o=l.polygon;if(o.zip_gaxi&&null!=o.body){o.zip_gaxi=!1,o.validate_laxi();var a=o.body;if(a.zip_axis&&(a.zip_axis=!1,a.axisx=Math.sin(a.rot),a.axisy=Math.cos(a.rot)),o.zip_gverts&&null!=o.body){o.zip_gverts=!1,o.validate_lverts();var s=o.body;s.zip_axis&&(s.zip_axis=!1,s.axisx=Math.sin(s.rot),s.axisy=Math.cos(s.rot));for(var _=o.lverts.next,h=o.gverts.next;null!=h;){var u=h,x=_;_=_.next,u.x=o.body.posx+(o.body.axisy*x.x-o.body.axisx*x.y),u.y=o.body.posy+(x.x*o.body.axisx+x.y*o.body.axisy),h=h.next}}var d=o.edges.head,y=o.gverts.next,z=y;for(y=y.next;null!=y;){var v=y,c=d.elt;d=d.next,c.gp0=z,c.gp1=v,c.gnormx=o.body.axisy*c.lnormx-o.body.axisx*c.lnormy,c.gnormy=c.lnormx*o.body.axisx+c.lnormy*o.body.axisy,c.gprojection=o.body.posx*c.gnormx+o.body.posy*c.gnormy+c.lprojection,null!=c.wrap_gnorm&&(c.wrap_gnorm.zpp_inner.x=c.gnormx,c.wrap_gnorm.zpp_inner.y=c.gnormy),c.tp0=c.gp0.y*c.gnormx-c.gp0.x*c.gnormy,c.tp1=c.gp1.y*c.gnormx-c.gp1.x*c.gnormy,z=v,y=y.next}var f=d.elt;f.gp0=z,f.gp1=o.gverts.next,f.gnormx=o.body.axisy*f.lnormx-o.body.axisx*f.lnormy,f.gnormy=f.lnormx*o.body.axisx+f.lnormy*o.body.axisy,f.gprojection=o.body.posx*f.gnormx+o.body.posy*f.gnormy+f.lprojection,null!=f.wrap_gnorm&&(f.wrap_gnorm.zpp_inner.x=f.gnormx,f.wrap_gnorm.zpp_inner.y=f.gnormy),f.tp0=f.gp0.y*f.gnormx-f.gp0.x*f.gnormy,f.tp1=f.gp1.y*f.gnormx-f.gp1.x*f.gnormy}}l.validate_sweepRadius(),l.sweepRadius>i.sweepRadius&&(i.sweepRadius=l.sweepRadius),p=p.next}if(i.validate_mass(),i.validate_inertia(),null!=i.shapes.head){if(i.zip_aabb){i.zip_aabb=!1,i.aabb.minx=1/0,i.aabb.miny=1/0,i.aabb.maxx=-1/0,i.aabb.maxy=-1/0;for(var m=i.shapes.head;null!=m;){var b=m.elt;if(b.zip_aabb&&null!=b.body)if(b.zip_aabb=!1,0==b.type){var g=b.circle;if(g.zip_worldCOM&&null!=g.body){if(g.zip_worldCOM=!1,g.zip_localCOM){if(g.zip_localCOM=!1,1==g.type){var w=g.polygon;if(null==w.lverts.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y;else if(null==w.lverts.next.next.next)w.localCOMx=w.lverts.next.x,w.localCOMy=w.lverts.next.y,w.localCOMx+=w.lverts.next.next.x,w.localCOMy+=w.lverts.next.next.y,w.localCOMx*=.5,w.localCOMy*=.5;else{w.localCOMx=0,w.localCOMy=0;var M=0,C=w.lverts.next,k=C,O=C=C.next;for(C=C.next;null!=C;){var P=C;M+=O.x*(P.y-k.y);var S=P.y*O.x-P.x*O.y;w.localCOMx+=(O.x+P.x)*S,w.localCOMy+=(O.y+P.y)*S,k=O,O=P,C=C.next}var A=C=w.lverts.next;M+=O.x*(A.y-k.y);var j=A.y*O.x-A.x*O.y;w.localCOMx+=(O.x+A.x)*j,w.localCOMy+=(O.y+A.y)*j,k=O;var E=C=C.next;M+=A.x*(E.y-k.y);var I=E.y*A.x-E.x*A.y;w.localCOMx+=(A.x+E.x)*I,w.localCOMy+=(A.y+E.y)*I;var T=M=1/(3*M);w.localCOMx*=T,w.localCOMy*=T}}null!=g.wrap_localCOM&&(g.wrap_localCOM.zpp_inner.x=g.localCOMx,g.wrap_localCOM.zpp_inner.y=g.localCOMy)}var N=g.body;N.zip_axis&&(N.zip_axis=!1,N.axisx=Math.sin(N.rot),N.axisy=Math.cos(N.rot)),g.worldCOMx=g.body.posx+(g.body.axisy*g.localCOMx-g.body.axisx*g.localCOMy),g.worldCOMy=g.body.posy+(g.localCOMx*g.body.axisx+g.localCOMy*g.body.axisy)}var L=g.radius,V=g.radius;g.aabb.minx=g.worldCOMx-L,g.aabb.miny=g.worldCOMy-V,g.aabb.maxx=g.worldCOMx+L,g.aabb.maxy=g.worldCOMy+V}else{var D=b.polygon;if(D.zip_gverts&&null!=D.body){D.zip_gverts=!1,D.validate_lverts();var F=D.body;F.zip_axis&&(F.zip_axis=!1,F.axisx=Math.sin(F.rot),F.axisy=Math.cos(F.rot));for(var R=D.lverts.next,Z=D.gverts.next;null!=Z;){var B=Z,G=R;R=R.next,B.x=D.body.posx+(D.body.axisy*G.x-D.body.axisx*G.y),B.y=D.body.posy+(G.x*D.body.axisx+G.y*D.body.axisy),Z=Z.next}}var q=D.gverts.next;D.aabb.minx=q.x,D.aabb.miny=q.y,D.aabb.maxx=q.x,D.aabb.maxy=q.y;for(var U=D.gverts.next.next;null!=U;){var K=U;K.x<D.aabb.minx&&(D.aabb.minx=K.x),K.x>D.aabb.maxx&&(D.aabb.maxx=K.x),K.y<D.aabb.miny&&(D.aabb.miny=K.y),K.y>D.aabb.maxy&&(D.aabb.maxy=K.y),U=U.next}}var W=i.aabb,Y=b.aabb;Y.minx<W.minx&&(W.minx=Y.minx),Y.maxx>W.maxx&&(W.maxx=Y.maxx),Y.miny<W.miny&&(W.miny=Y.miny),Y.maxy>W.maxy&&(W.maxy=Y.maxy),m=m.next}}i.validate_worldCOM()}if(i.validate_gravMass(),i.zip_axis&&(i.zip_axis=!1,i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot)),i.component.woken&&null!=i.cbSet)for(var J=i.cbSet.bodylisteners.head;null!=J;){var X=J.elt;if(2==X.event){var H=this.push_callback(X);H.event=2,H.body=i,J=J.next}else J=J.next}i.component.woken=!1;for(var $=i.shapes.head;null!=$;)this.bphase.sync($.elt),$=$.next;t=t.next}for(var Q=this.kinematics.head;null!=Q;){var nn=Q.elt;nn.sweepRadius=0;for(var en=nn.shapes.head;null!=en;){var tn=en.elt;if(1==tn.type){var pn=tn.polygon;pn.zip_sanitation&&(pn.zip_sanitation=!1,pn.splice_collinear_real());var ln=tn.polygon;if(ln.zip_gaxi&&null!=ln.body){ln.zip_gaxi=!1,ln.validate_laxi();var rn=ln.body;if(rn.zip_axis&&(rn.zip_axis=!1,rn.axisx=Math.sin(rn.rot),rn.axisy=Math.cos(rn.rot)),ln.zip_gverts&&null!=ln.body){ln.zip_gverts=!1,ln.validate_lverts();var on=ln.body;on.zip_axis&&(on.zip_axis=!1,on.axisx=Math.sin(on.rot),on.axisy=Math.cos(on.rot));for(var an=ln.lverts.next,sn=ln.gverts.next;null!=sn;){var _n=sn,hn=an;an=an.next,_n.x=ln.body.posx+(ln.body.axisy*hn.x-ln.body.axisx*hn.y),_n.y=ln.body.posy+(hn.x*ln.body.axisx+hn.y*ln.body.axisy),sn=sn.next}}var un=ln.edges.head,xn=ln.gverts.next,dn=xn;for(xn=xn.next;null!=xn;){var yn=xn,zn=un.elt;un=un.next,zn.gp0=dn,zn.gp1=yn,zn.gnormx=ln.body.axisy*zn.lnormx-ln.body.axisx*zn.lnormy,zn.gnormy=zn.lnormx*ln.body.axisx+zn.lnormy*ln.body.axisy,zn.gprojection=ln.body.posx*zn.gnormx+ln.body.posy*zn.gnormy+zn.lprojection,null!=zn.wrap_gnorm&&(zn.wrap_gnorm.zpp_inner.x=zn.gnormx,zn.wrap_gnorm.zpp_inner.y=zn.gnormy),zn.tp0=zn.gp0.y*zn.gnormx-zn.gp0.x*zn.gnormy,zn.tp1=zn.gp1.y*zn.gnormx-zn.gp1.x*zn.gnormy,dn=yn,xn=xn.next}var vn=un.elt;vn.gp0=dn,vn.gp1=ln.gverts.next,vn.gnormx=ln.body.axisy*vn.lnormx-ln.body.axisx*vn.lnormy,vn.gnormy=vn.lnormx*ln.body.axisx+vn.lnormy*ln.body.axisy,vn.gprojection=ln.body.posx*vn.gnormx+ln.body.posy*vn.gnormy+vn.lprojection,null!=vn.wrap_gnorm&&(vn.wrap_gnorm.zpp_inner.x=vn.gnormx,vn.wrap_gnorm.zpp_inner.y=vn.gnormy),vn.tp0=vn.gp0.y*vn.gnormx-vn.gp0.x*vn.gnormy,vn.tp1=vn.gp1.y*vn.gnormx-vn.gp1.x*vn.gnormy}}tn.validate_sweepRadius(),tn.sweepRadius>nn.sweepRadius&&(nn.sweepRadius=tn.sweepRadius),en=en.next}if(nn.validate_mass(),nn.validate_inertia(),null!=nn.shapes.head){if(nn.zip_aabb){nn.zip_aabb=!1,nn.aabb.minx=1/0,nn.aabb.miny=1/0,nn.aabb.maxx=-1/0,nn.aabb.maxy=-1/0;for(var cn=nn.shapes.head;null!=cn;){var fn=cn.elt;if(fn.zip_aabb&&null!=fn.body)if(fn.zip_aabb=!1,0==fn.type){var mn=fn.circle;if(mn.zip_worldCOM&&null!=mn.body){if(mn.zip_worldCOM=!1,mn.zip_localCOM){if(mn.zip_localCOM=!1,1==mn.type){var bn=mn.polygon;if(null==bn.lverts.next.next)bn.localCOMx=bn.lverts.next.x,bn.localCOMy=bn.lverts.next.y;else if(null==bn.lverts.next.next.next)bn.localCOMx=bn.lverts.next.x,bn.localCOMy=bn.lverts.next.y,bn.localCOMx+=bn.lverts.next.next.x,bn.localCOMy+=bn.lverts.next.next.y,bn.localCOMx*=.5,bn.localCOMy*=.5;else{bn.localCOMx=0,bn.localCOMy=0;var gn=0,wn=bn.lverts.next,Mn=wn,Cn=wn=wn.next;for(wn=wn.next;null!=wn;){var kn=wn;gn+=Cn.x*(kn.y-Mn.y);var On=kn.y*Cn.x-kn.x*Cn.y;bn.localCOMx+=(Cn.x+kn.x)*On,bn.localCOMy+=(Cn.y+kn.y)*On,Mn=Cn,Cn=kn,wn=wn.next}var Pn=wn=bn.lverts.next;gn+=Cn.x*(Pn.y-Mn.y);var Sn=Pn.y*Cn.x-Pn.x*Cn.y;bn.localCOMx+=(Cn.x+Pn.x)*Sn,bn.localCOMy+=(Cn.y+Pn.y)*Sn,Mn=Cn;var An=wn=wn.next;gn+=Pn.x*(An.y-Mn.y);var jn=An.y*Pn.x-An.x*Pn.y;bn.localCOMx+=(Pn.x+An.x)*jn,bn.localCOMy+=(Pn.y+An.y)*jn;var En=gn=1/(3*gn);bn.localCOMx*=En,bn.localCOMy*=En}}null!=mn.wrap_localCOM&&(mn.wrap_localCOM.zpp_inner.x=mn.localCOMx,mn.wrap_localCOM.zpp_inner.y=mn.localCOMy)}var In=mn.body;In.zip_axis&&(In.zip_axis=!1,In.axisx=Math.sin(In.rot),In.axisy=Math.cos(In.rot)),mn.worldCOMx=mn.body.posx+(mn.body.axisy*mn.localCOMx-mn.body.axisx*mn.localCOMy),mn.worldCOMy=mn.body.posy+(mn.localCOMx*mn.body.axisx+mn.localCOMy*mn.body.axisy)}var Tn=mn.radius,Nn=mn.radius;mn.aabb.minx=mn.worldCOMx-Tn,mn.aabb.miny=mn.worldCOMy-Nn,mn.aabb.maxx=mn.worldCOMx+Tn,mn.aabb.maxy=mn.worldCOMy+Nn}else{var Ln=fn.polygon;if(Ln.zip_gverts&&null!=Ln.body){Ln.zip_gverts=!1,Ln.validate_lverts();var Vn=Ln.body;Vn.zip_axis&&(Vn.zip_axis=!1,Vn.axisx=Math.sin(Vn.rot),Vn.axisy=Math.cos(Vn.rot));for(var Dn=Ln.lverts.next,Fn=Ln.gverts.next;null!=Fn;){var Rn=Fn,Zn=Dn;Dn=Dn.next,Rn.x=Ln.body.posx+(Ln.body.axisy*Zn.x-Ln.body.axisx*Zn.y),Rn.y=Ln.body.posy+(Zn.x*Ln.body.axisx+Zn.y*Ln.body.axisy),Fn=Fn.next}}var Bn=Ln.gverts.next;Ln.aabb.minx=Bn.x,Ln.aabb.miny=Bn.y,Ln.aabb.maxx=Bn.x,Ln.aabb.maxy=Bn.y;for(var Gn=Ln.gverts.next.next;null!=Gn;){var qn=Gn;qn.x<Ln.aabb.minx&&(Ln.aabb.minx=qn.x),qn.x>Ln.aabb.maxx&&(Ln.aabb.maxx=qn.x),qn.y<Ln.aabb.miny&&(Ln.aabb.miny=qn.y),qn.y>Ln.aabb.maxy&&(Ln.aabb.maxy=qn.y),Gn=Gn.next}}var Un=nn.aabb,Kn=fn.aabb;Kn.minx<Un.minx&&(Un.minx=Kn.minx),Kn.maxx>Un.maxx&&(Un.maxx=Kn.maxx),Kn.miny<Un.miny&&(Un.miny=Kn.miny),Kn.maxy>Un.maxy&&(Un.maxy=Kn.maxy),cn=cn.next}}nn.validate_worldCOM()}nn.validate_gravMass(),nn.zip_axis&&(nn.zip_axis=!1,nn.axisx=Math.sin(nn.rot),nn.axisy=Math.cos(nn.rot));for(var Wn=nn.shapes.head;null!=Wn;)this.bphase.sync(Wn.elt),Wn=Wn.next;Q=Q.next}for(var Yn=this.live_constraints.head;null!=Yn;){var Jn=Yn.elt;if(Jn.active){if(Jn.component.woken&&null!=Jn.cbSet)for(var Xn=Jn.cbSet.conlisteners.head;null!=Xn;){var Hn=Xn.elt;if(2==Hn.event){var $n=this.push_callback(Hn);$n.event=2,$n.constraint=Jn,Xn=Xn.next}else Xn=Xn.next}Jn.component.woken=!1}Yn=Yn.next}},Tt.prototype.updateVel=function(n){for(var e=1-n*this.global_lin_drag,t=1-n*this.global_ang_drag,i=this.live.head;null!=i;){var p=i.elt;if(0!=p.smass){var l=n*p.imass;p.velx=e*p.velx+(p.forcex+this.gravityx*p.gravMass)*l,p.vely=e*p.vely+(p.forcey+this.gravityy*p.gravMass)*l}if(0!=p.sinertia){var r,o;r=p.worldCOMx-p.posx,o=p.worldCOMy-p.posy,p.angvel=t*p.angvel+(p.torque+(this.gravityy*r-this.gravityx*o)*p.gravMass)*n*p.iinertia}i=i.next}},Tt.prototype.updatePos=function(n){for(var e=2*Math.PI/n,t=this.live.head;null!=t;){var i=t.elt;i.pre_posx=i.posx,i.pre_posy=i.posy,i.pre_rot=i.rot,i.sweepTime=0,i.sweep_angvel=i.angvel%e;var p=n-i.sweepTime;if(0!=p&&(i.sweepTime=n,i.posx+=i.velx*p,i.posy+=i.vely*p,0!=i.angvel)){var l=i.sweep_angvel*p;if(i.rot+=l,l*l>1e-4)i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot);else{var r=l*l,a=1-.5*r,s=1-r*r/8,_=(a*i.axisx+l*i.axisy)*s;i.axisy=(a*i.axisy-l*i.axisx)*s,i.axisx=_}}if(i.disableCCD)i.sweepFrozen=!0,i.bullet=!1;else{var h=o.staticCCDLinearThreshold*i.sweepRadius,u=o.staticCCDAngularThreshold;if((i.velx*i.velx+i.vely*i.vely)*n*n>h*h||i.angvel*i.angvel*n*n>u*u||3==i.type){var x=i.sweep_angvel;x<0&&(x=-x);for(var d=1/x,y=i.shapes.head;null!=y;){var z=y.elt,v=z.aabb,c=v.minx,f=v.miny,m=v.maxx,b=v.maxy,g=x*n*z.sweepCoef*.008333333333333333|0;g>8&&(g=8);var w=x*n/g,M=n-i.sweepTime;if(0!=M&&(i.sweepTime=n,i.posx+=i.velx*M,i.posy+=i.vely*M,0!=i.angvel)){var C=i.sweep_angvel*M;if(i.rot+=C,C*C>1e-4)i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot);else{var k=C*C,O=1-.5*k,P=1-k*k/8,S=(O*i.axisx+C*i.axisy)*P;i.axisy=(O*i.axisy-C*i.axisx)*P,i.axisx=S}}if(0==z.type){var A=z.circle;A.worldCOMx=A.body.posx+(A.body.axisy*A.localCOMx-A.body.axisx*A.localCOMy),A.worldCOMy=A.body.posy+(A.localCOMx*A.body.axisx+A.localCOMy*A.body.axisy),A.aabb.minx=A.worldCOMx-A.radius,A.aabb.miny=A.worldCOMy-A.radius,A.aabb.maxx=A.worldCOMx+A.radius,A.aabb.maxy=A.worldCOMy+A.radius}else{var j=z.polygon,E=j.lverts.next,I=j.gverts.next,T=E;E=E.next,I.x=j.body.posx+(j.body.axisy*T.x-j.body.axisx*T.y),I.y=j.body.posy+(T.x*j.body.axisx+T.y*j.body.axisy),j.aabb.minx=I.x,j.aabb.miny=I.y,j.aabb.maxx=I.x,j.aabb.maxy=I.y;for(var N=j.gverts.next.next;null!=N;){var L=N,V=E;E=E.next,L.x=j.body.posx+(j.body.axisy*V.x-j.body.axisx*V.y),L.y=j.body.posy+(V.x*j.body.axisx+V.y*j.body.axisy),L.x<j.aabb.minx&&(j.aabb.minx=L.x),L.x>j.aabb.maxx&&(j.aabb.maxx=L.x),L.y<j.aabb.miny&&(j.aabb.miny=L.y),L.y>j.aabb.maxy&&(j.aabb.maxy=L.y),N=N.next}}c<v.minx?v.minx=c:c=v.minx,f<v.miny?v.miny=f:f=v.miny,m>v.maxx?v.maxx=m:m=v.maxx,b>v.maxy?v.maxy=b:b=v.maxy;for(var D=1,F=g;D<F;){var R=w*D++*d,Z=R-i.sweepTime;if(0!=Z&&(i.sweepTime=R,i.posx+=i.velx*Z,i.posy+=i.vely*Z,0!=i.angvel)){var B=i.sweep_angvel*Z;if(i.rot+=B,B*B>1e-4)i.axisx=Math.sin(i.rot),i.axisy=Math.cos(i.rot);else{var G=B*B,q=1-.5*G,U=1-G*G/8,K=(q*i.axisx+B*i.axisy)*U;i.axisy=(q*i.axisy-B*i.axisx)*U,i.axisx=K}}if(0==z.type){var W=z.circle;W.worldCOMx=W.body.posx+(W.body.axisy*W.localCOMx-W.body.axisx*W.localCOMy),W.worldCOMy=W.body.posy+(W.localCOMx*W.body.axisx+W.localCOMy*W.body.axisy),W.aabb.minx=W.worldCOMx-W.radius,W.aabb.miny=W.worldCOMy-W.radius,W.aabb.maxx=W.worldCOMx+W.radius,W.aabb.maxy=W.worldCOMy+W.radius}else{var Y=z.polygon,J=Y.lverts.next,X=Y.gverts.next,H=J;J=J.next,X.x=Y.body.posx+(Y.body.axisy*H.x-Y.body.axisx*H.y),X.y=Y.body.posy+(H.x*Y.body.axisx+H.y*Y.body.axisy),Y.aabb.minx=X.x,Y.aabb.miny=X.y,Y.aabb.maxx=X.x,Y.aabb.maxy=X.y;for(var $=Y.gverts.next.next;null!=$;){var Q=$,nn=J;J=J.next,Q.x=Y.body.posx+(Y.body.axisy*nn.x-Y.body.axisx*nn.y),Q.y=Y.body.posy+(nn.x*Y.body.axisx+nn.y*Y.body.axisy),Q.x<Y.aabb.minx&&(Y.aabb.minx=Q.x),Q.x>Y.aabb.maxx&&(Y.aabb.maxx=Q.x),Q.y<Y.aabb.miny&&(Y.aabb.miny=Q.y),Q.y>Y.aabb.maxy&&(Y.aabb.maxy=Q.y),$=$.next}}c<v.minx?v.minx=c:c=v.minx,f<v.miny?v.miny=f:f=v.miny,m>v.maxx?v.maxx=m:m=v.maxx,b>v.maxy?v.maxy=b:b=v.maxy}this.bphase.sync(z),y=y.next}if(i.sweepFrozen=!1,2==i.type&&i.bulletEnabled){var en=o.bulletCCDLinearThreshold*i.sweepRadius,tn=o.bulletCCDAngularThreshold;((i.velx*i.velx+i.vely*i.vely)*n*n>en*en||i.angvel*i.angvel*n*n>tn*tn)&&(i.bullet=!0)}}else i.sweepFrozen=!0,i.bullet=!1}t=t.next}for(var pn=this.kinematics.head;null!=pn;){var ln=pn.elt;ln.pre_posx=ln.posx,ln.pre_posy=ln.posy,ln.pre_rot=ln.rot,ln.sweepTime=0,ln.sweep_angvel=ln.angvel%e;var rn=n-ln.sweepTime;if(0!=rn&&(ln.sweepTime=n,ln.posx+=ln.velx*rn,ln.posy+=ln.vely*rn,0!=ln.angvel)){var on=ln.sweep_angvel*rn;if(ln.rot+=on,on*on>1e-4)ln.axisx=Math.sin(ln.rot),ln.axisy=Math.cos(ln.rot);else{var an=on*on,sn=1-.5*an,_n=1-an*an/8,hn=(sn*ln.axisx+on*ln.axisy)*_n;ln.axisy=(sn*ln.axisy-on*ln.axisx)*_n,ln.axisx=hn}}if(ln.disableCCD)ln.sweepFrozen=!0,ln.bullet=!1;else{var un=o.staticCCDLinearThreshold*ln.sweepRadius,xn=o.staticCCDAngularThreshold;if((ln.velx*ln.velx+ln.vely*ln.vely)*n*n>un*un||ln.angvel*ln.angvel*n*n>xn*xn||3==ln.type){var dn=ln.sweep_angvel;dn<0&&(dn=-dn);for(var yn=1/dn,zn=ln.shapes.head;null!=zn;){var vn=zn.elt,cn=vn.aabb,fn=cn.minx,mn=cn.miny,bn=cn.maxx,gn=cn.maxy,wn=dn*n*vn.sweepCoef*.008333333333333333|0;wn>8&&(wn=8);var Mn=dn*n/wn,Cn=n-ln.sweepTime;if(0!=Cn&&(ln.sweepTime=n,ln.posx+=ln.velx*Cn,ln.posy+=ln.vely*Cn,0!=ln.angvel)){var kn=ln.sweep_angvel*Cn;if(ln.rot+=kn,kn*kn>1e-4)ln.axisx=Math.sin(ln.rot),ln.axisy=Math.cos(ln.rot);else{var On=kn*kn,Pn=1-.5*On,Sn=1-On*On/8,An=(Pn*ln.axisx+kn*ln.axisy)*Sn;ln.axisy=(Pn*ln.axisy-kn*ln.axisx)*Sn,ln.axisx=An}}if(0==vn.type){var jn=vn.circle;jn.worldCOMx=jn.body.posx+(jn.body.axisy*jn.localCOMx-jn.body.axisx*jn.localCOMy),jn.worldCOMy=jn.body.posy+(jn.localCOMx*jn.body.axisx+jn.localCOMy*jn.body.axisy),jn.aabb.minx=jn.worldCOMx-jn.radius,jn.aabb.miny=jn.worldCOMy-jn.radius,jn.aabb.maxx=jn.worldCOMx+jn.radius,jn.aabb.maxy=jn.worldCOMy+jn.radius}else{var En=vn.polygon,In=En.lverts.next,Tn=En.gverts.next,Nn=In;In=In.next,Tn.x=En.body.posx+(En.body.axisy*Nn.x-En.body.axisx*Nn.y),Tn.y=En.body.posy+(Nn.x*En.body.axisx+Nn.y*En.body.axisy),En.aabb.minx=Tn.x,En.aabb.miny=Tn.y,En.aabb.maxx=Tn.x,En.aabb.maxy=Tn.y;for(var Ln=En.gverts.next.next;null!=Ln;){var Vn=Ln,Dn=In;In=In.next,Vn.x=En.body.posx+(En.body.axisy*Dn.x-En.body.axisx*Dn.y),Vn.y=En.body.posy+(Dn.x*En.body.axisx+Dn.y*En.body.axisy),Vn.x<En.aabb.minx&&(En.aabb.minx=Vn.x),Vn.x>En.aabb.maxx&&(En.aabb.maxx=Vn.x),Vn.y<En.aabb.miny&&(En.aabb.miny=Vn.y),Vn.y>En.aabb.maxy&&(En.aabb.maxy=Vn.y),Ln=Ln.next}}fn<cn.minx?cn.minx=fn:fn=cn.minx,mn<cn.miny?cn.miny=mn:mn=cn.miny,bn>cn.maxx?cn.maxx=bn:bn=cn.maxx,gn>cn.maxy?cn.maxy=gn:gn=cn.maxy;for(var Fn=1,Rn=wn;Fn<Rn;){var Zn=Mn*Fn++*yn,Bn=Zn-ln.sweepTime;if(0!=Bn&&(ln.sweepTime=Zn,ln.posx+=ln.velx*Bn,ln.posy+=ln.vely*Bn,0!=ln.angvel)){var Gn=ln.sweep_angvel*Bn;if(ln.rot+=Gn,Gn*Gn>1e-4)ln.axisx=Math.sin(ln.rot),ln.axisy=Math.cos(ln.rot);else{var qn=Gn*Gn,Un=1-.5*qn,Kn=1-qn*qn/8,Wn=(Un*ln.axisx+Gn*ln.axisy)*Kn;ln.axisy=(Un*ln.axisy-Gn*ln.axisx)*Kn,ln.axisx=Wn}}if(0==vn.type){var Yn=vn.circle;Yn.worldCOMx=Yn.body.posx+(Yn.body.axisy*Yn.localCOMx-Yn.body.axisx*Yn.localCOMy),Yn.worldCOMy=Yn.body.posy+(Yn.localCOMx*Yn.body.axisx+Yn.localCOMy*Yn.body.axisy),Yn.aabb.minx=Yn.worldCOMx-Yn.radius,Yn.aabb.miny=Yn.worldCOMy-Yn.radius,Yn.aabb.maxx=Yn.worldCOMx+Yn.radius,Yn.aabb.maxy=Yn.worldCOMy+Yn.radius}else{var Jn=vn.polygon,Xn=Jn.lverts.next,Hn=Jn.gverts.next,$n=Xn;Xn=Xn.next,Hn.x=Jn.body.posx+(Jn.body.axisy*$n.x-Jn.body.axisx*$n.y),Hn.y=Jn.body.posy+($n.x*Jn.body.axisx+$n.y*Jn.body.axisy),Jn.aabb.minx=Hn.x,Jn.aabb.miny=Hn.y,Jn.aabb.maxx=Hn.x,Jn.aabb.maxy=Hn.y;for(var Qn=Jn.gverts.next.next;null!=Qn;){var ne=Qn,ee=Xn;Xn=Xn.next,ne.x=Jn.body.posx+(Jn.body.axisy*ee.x-Jn.body.axisx*ee.y),ne.y=Jn.body.posy+(ee.x*Jn.body.axisx+ee.y*Jn.body.axisy),ne.x<Jn.aabb.minx&&(Jn.aabb.minx=ne.x),ne.x>Jn.aabb.maxx&&(Jn.aabb.maxx=ne.x),ne.y<Jn.aabb.miny&&(Jn.aabb.miny=ne.y),ne.y>Jn.aabb.maxy&&(Jn.aabb.maxy=ne.y),Qn=Qn.next}}fn<cn.minx?cn.minx=fn:fn=cn.minx,mn<cn.miny?cn.miny=mn:mn=cn.miny,bn>cn.maxx?cn.maxx=bn:bn=cn.maxx,gn>cn.maxy?cn.maxy=gn:gn=cn.maxy}this.bphase.sync(vn),zn=zn.next}if(ln.sweepFrozen=!1,2==ln.type&&ln.bulletEnabled){var te=o.bulletCCDLinearThreshold*ln.sweepRadius,ie=o.bulletCCDAngularThreshold;((ln.velx*ln.velx+ln.vely*ln.vely)*n*n>te*te||ln.angvel*ln.angvel*n*n>ie*ie)&&(ln.bullet=!0)}}else ln.sweepFrozen=!0,ln.bullet=!1}pn=pn.next}},Tt.prototype.continuous=null,Tt.prototype.presteparb=function(n,e,t){null==t&&(t=!1);if(!n.cleared&&n.b1.component.sleeping&&n.b2.component.sleeping)return n.sleep_stamp=this.stamp,n.sleeping=!0,!0;if(!n.cleared||0!=n.present||n.intchange){var i=!t&&n.up_stamp==this.stamp-1&&!n.cleared&&!n.intchange,p=n.fresh&&!n.cleared&&!n.intchange;if(i&&(n.endGenerated=this.stamp),p||i||n.cleared||n.intchange){for(var l=n.ws1,r=n.ws2,a=this.mrca1;null!=a.head;){var s=a.head;a.head=s.next,s.elt=null,s.next=Mi.zpp_pool,Mi.zpp_pool=s,null==a.head&&(a.pushmod=!0),a.modified=!0,a.length--}a.pushmod=!0;for(var _=this.mrca2;null!=_.head;){var h=_.head;_.head=h.next,h.elt=null,h.next=Mi.zpp_pool,Mi.zpp_pool=h,null==_.head&&(_.pushmod=!0),_.modified=!0,_.length--}if(_.pushmod=!0,null!=l.cbSet){var u,x=this.mrca1;null==Mi.zpp_pool?u=new Mi:(u=Mi.zpp_pool,Mi.zpp_pool=u.next,u.next=null),u.elt=l;var d=u;d.next=x.head,x.head=d,x.modified=!0,x.length++}if(null!=l.body.cbSet){var y,z=this.mrca1,v=l.body;null==Mi.zpp_pool?y=new Mi:(y=Mi.zpp_pool,Mi.zpp_pool=y.next,y.next=null),y.elt=v;var c=y;c.next=z.head,z.head=c,z.modified=!0,z.length++}if(null!=r.cbSet){var f,m=this.mrca2;null==Mi.zpp_pool?f=new Mi:(f=Mi.zpp_pool,Mi.zpp_pool=f.next,f.next=null),f.elt=r;var b=f;b.next=m.head,m.head=b,m.modified=!0,m.length++}if(null!=r.body.cbSet){var g,w=this.mrca2,M=r.body;null==Mi.zpp_pool?g=new Mi:(g=Mi.zpp_pool,Mi.zpp_pool=g.next,g.next=null),g.elt=M;var C=g;C.next=w.head,w.head=C,w.modified=!0,w.length++}for(var k=l.body.compound,O=r.body.compound;k!=O;)if((null==k?0:k.depth)<(null==O?0:O.depth)){if(null!=O.cbSet){var P,S=this.mrca2;null==Mi.zpp_pool?P=new Mi:(P=Mi.zpp_pool,Mi.zpp_pool=P.next,P.next=null),P.elt=O;var A=P;A.next=S.head,S.head=A,S.modified=!0,S.length++}O=O.compound}else{if(null!=k.cbSet){var j,E=this.mrca1;null==Mi.zpp_pool?j=new Mi:(j=Mi.zpp_pool,Mi.zpp_pool=j.next,j.next=null),j.elt=k;var I=j;I.next=E.head,E.head=I,E.modified=!0,E.length++}k=k.compound}for(var T=this.mrca1.head;null!=T;){for(var N=T.elt,L=this.mrca2.head;null!=L;){for(var V,D=L.elt,F=N.cbSet,R=D.cbSet,Z=null,B=(F.cbpairs.length<R.cbpairs.length?F.cbpairs:R.cbpairs).head;null!=B;){var G=B.elt;if(G.a==F&&G.b==R||G.a==R&&G.b==F){Z=G;break}B=B.next}if(null==Z)null==Qn.zpp_pool?V=new Qn:(V=Qn.zpp_pool,Qn.zpp_pool=V.next,V.next=null),V.zip_listeners=!0,$n.setlt(F,R)?(V.a=F,V.b=R):(V.a=R,V.b=F),Z=V,F.cbpairs.add(Z),R!=F&&R.cbpairs.add(Z);if(Z.zip_listeners&&(Z.zip_listeners=!1,Z.__validate()),null!=Z.listeners.head){var q=zt.get(N,D);if(p||n.intchange){null==q&&(q=Et.get(N,D),this.add_callbackset(q));for(var U,K=null,W=(F.cbpairs.length<R.cbpairs.length?F.cbpairs:R.cbpairs).head;null!=W;){var Y=W.elt;if(Y.a==F&&Y.b==R||Y.a==R&&Y.b==F){K=Y;break}W=W.next}if(null==K)null==Qn.zpp_pool?U=new Qn:(U=Qn.zpp_pool,Qn.zpp_pool=U.next,U.next=null),U.zip_listeners=!0,$n.setlt(F,R)?(U.a=F,U.b=R):(U.a=R,U.b=F),K=U,F.cbpairs.add(K),R!=F&&R.cbpairs.add(K);K.zip_listeners&&(K.zip_listeners=!1,K.__validate());for(var J,X,H=K.listeners.head;null!=H;){var $=H.elt;if(0==$.event&&0!=($.itype&n.type)&&q.empty_arb($.itype)){var Q=this.push_callback($);Q.event=0;var nn,en=q.int1,tn=q.int2,pn=$.options1,ln=en.cbTypes;if(pn.nonemptyintersection(ln,pn.includes)&&!pn.nonemptyintersection(ln,pn.excludes)){var rn=$.options2,on=tn.cbTypes;nn=!!rn.nonemptyintersection(on,rn.includes)&&!rn.nonemptyintersection(on,rn.excludes)}else nn=!1;nn?(Q.int1=en,Q.int2=tn):(Q.int1=tn,Q.int2=en),Q.set=q}H=H.next}X=!1;for(var an=q.arbiters.head;null!=an;){if(an.elt==n){X=!0;break}an=an.next}if(X)J=!1;else{var sn,_n=q.arbiters;null==bi.zpp_pool?sn=new bi:(sn=bi.zpp_pool,bi.zpp_pool=sn.next,sn.next=null),sn.elt=n;var hn=sn;hn.next=_n.head,_n.head=hn,_n.modified=!0,_n.length++,J=!0}J&&n.present++}else{n.present--,q.remove_arb(n);for(var un,xn=null,dn=(F.cbpairs.length<R.cbpairs.length?F.cbpairs:R.cbpairs).head;null!=dn;){var yn=dn.elt;if(yn.a==F&&yn.b==R||yn.a==R&&yn.b==F){xn=yn;break}dn=dn.next}if(null==xn)null==Qn.zpp_pool?un=new Qn:(un=Qn.zpp_pool,Qn.zpp_pool=un.next,un.next=null),un.zip_listeners=!0,$n.setlt(F,R)?(un.a=F,un.b=R):(un.a=R,un.b=F),xn=un,F.cbpairs.add(xn),R!=F&&R.cbpairs.add(xn);xn.zip_listeners&&(xn.zip_listeners=!1,xn.__validate());for(var zn=xn.listeners.head;null!=zn;){var vn=zn.elt;if(1==vn.event&&0!=(vn.itype&n.type)&&q.empty_arb(vn.itype)){var cn=this.push_callback(vn);cn.event=1;var fn,mn=q.int1,bn=q.int2,gn=vn.options1,wn=mn.cbTypes;if(gn.nonemptyintersection(wn,gn.includes)&&!gn.nonemptyintersection(wn,gn.excludes)){var Mn=vn.options2,Cn=bn.cbTypes;fn=!!Mn.nonemptyintersection(Cn,Mn.includes)&&!Mn.nonemptyintersection(Cn,Mn.excludes)}else fn=!1;fn?(cn.int1=mn,cn.int2=bn):(cn.int1=bn,cn.int2=mn),cn.set=q}zn=zn.next}null==q.arbiters.head&&this.remove_callbackset(q)}L=L.next}else L=L.next}T=T.next}}n.fresh=!1,n.intchange=!1}if(n.cleared||n.up_stamp+(n.type==Ce.COL?o.arbiterExpirationDelay:0)<this.stamp){if(n.type==Ce.SENSOR){var kn=n.sensorarb;if(!kn.cleared){for(var On=kn.b1.arbiters,Pn=null,Sn=On.head;null!=Sn;){if(Sn.elt==kn){var An,jn;null==Pn?(jn=(An=On.head).next,On.head=jn,null==On.head&&(On.pushmod=!0)):(jn=(An=Pn.next).next,Pn.next=jn,null==jn&&(On.pushmod=!0));var En=An;En.elt=null,En.next=bi.zpp_pool,bi.zpp_pool=En,On.modified=!0,On.length--,On.pushmod=!0;break}Pn=Sn,Sn=Sn.next}for(var In=kn.b2.arbiters,Tn=null,Nn=In.head;null!=Nn;){if(Nn.elt==kn){var Ln,Vn;null==Tn?(Vn=(Ln=In.head).next,In.head=Vn,null==In.head&&(In.pushmod=!0)):(Vn=(Ln=Tn.next).next,Tn.next=Vn,null==Vn&&(In.pushmod=!0));var Dn=Ln;Dn.elt=null,Dn.next=bi.zpp_pool,bi.zpp_pool=Dn,In.modified=!0,In.length--,In.pushmod=!0;break}Tn=Nn,Nn=Nn.next}null!=kn.pair&&(kn.pair.arb=null,kn.pair=null)}kn.b1=kn.b2=null,kn.active=!1,kn.intchange=!1,kn.next=ke.zpp_pool,ke.zpp_pool=kn}else if(n.type==Ce.FLUID){var Fn=n.fluidarb;if(!Fn.cleared){for(var Rn=Fn.b1.arbiters,Zn=null,Bn=Rn.head;null!=Bn;){if(Bn.elt==Fn){var Gn,qn;null==Zn?(qn=(Gn=Rn.head).next,Rn.head=qn,null==Rn.head&&(Rn.pushmod=!0)):(qn=(Gn=Zn.next).next,Zn.next=qn,null==qn&&(Rn.pushmod=!0));var Un=Gn;Un.elt=null,Un.next=bi.zpp_pool,bi.zpp_pool=Un,Rn.modified=!0,Rn.length--,Rn.pushmod=!0;break}Zn=Bn,Bn=Bn.next}for(var Kn=Fn.b2.arbiters,Wn=null,Yn=Kn.head;null!=Yn;){if(Yn.elt==Fn){var Jn,Xn;null==Wn?(Xn=(Jn=Kn.head).next,Kn.head=Xn,null==Kn.head&&(Kn.pushmod=!0)):(Xn=(Jn=Wn.next).next,Wn.next=Xn,null==Xn&&(Kn.pushmod=!0));var Hn=Jn;Hn.elt=null,Hn.next=bi.zpp_pool,bi.zpp_pool=Hn,Kn.modified=!0,Kn.length--,Kn.pushmod=!0;break}Wn=Yn,Yn=Yn.next}null!=Fn.pair&&(Fn.pair.arb=null,Fn.pair=null)}Fn.b1=Fn.b2=null,Fn.active=!1,Fn.intchange=!1,Fn.next=Oe.zpp_pool,Oe.zpp_pool=Fn,Fn.pre_dt=-1}else{var ne=n.colarb;if(!ne.cleared){for(var ee=ne.b1.arbiters,te=null,ie=ee.head;null!=ie;){if(ie.elt==ne){var pe,le;null==te?(le=(pe=ee.head).next,ee.head=le,null==ee.head&&(ee.pushmod=!0)):(le=(pe=te.next).next,te.next=le,null==le&&(ee.pushmod=!0));var re=pe;re.elt=null,re.next=bi.zpp_pool,bi.zpp_pool=re,ee.modified=!0,ee.length--,ee.pushmod=!0;break}te=ie,ie=ie.next}for(var oe=ne.b2.arbiters,ae=null,se=oe.head;null!=se;){if(se.elt==ne){var _e,he;null==ae?(he=(_e=oe.head).next,oe.head=he,null==oe.head&&(oe.pushmod=!0)):(he=(_e=ae.next).next,ae.next=he,null==he&&(oe.pushmod=!0));var ue=_e;ue.elt=null,ue.next=bi.zpp_pool,bi.zpp_pool=ue,oe.modified=!0,oe.length--,oe.pushmod=!0;break}ae=se,se=se.next}null!=ne.pair&&(ne.pair.arb=null,ne.pair=null)}for(ne.b1=ne.b2=null,ne.active=!1,ne.intchange=!1;null!=ne.contacts.next;){var xe=ne.contacts,de=xe.next;xe.pop(),de.arbiter=null,de.next=Se.zpp_pool,Se.zpp_pool=de;var ye=ne.innards,ze=ye.next;ye.next=ze.next,ze._inuse=!1,null==ye.next&&(ye.pushmod=!0),ye.modified=!0,ye.length--}ne.userdef_dyn_fric=!1,ne.userdef_stat_fric=!1,ne.userdef_restitution=!1,ne.userdef_rfric=!1,ne.__ref_edge1=ne.__ref_edge2=null,ne.next=Pe.zpp_pool,Pe.zpp_pool=ne,ne.pre_dt=-1}return!0}var ve=n.active;if(n.active=n.presentable=n.up_stamp==this.stamp,0!=(1&n.immState)){if(n.active&&n.type!=Ce.SENSOR)if(null!=n.colarb){var ce=n.colarb;ce.invalidated&&(ce.invalidated=!1,ce.userdef_restitution||(ce.s1.material.elasticity<=-1/0||ce.s2.material.elasticity<=-1/0?ce.restitution=0:ce.s1.material.elasticity>=1/0||ce.s2.material.elasticity>=1/0?ce.restitution=1:ce.restitution=(ce.s1.material.elasticity+ce.s2.material.elasticity)/2,ce.restitution<0&&(ce.restitution=0),ce.restitution>1&&(ce.restitution=1)),ce.userdef_dyn_fric||(ce.dyn_fric=Math.sqrt(ce.s1.material.dynamicFriction*ce.s2.material.dynamicFriction)),ce.userdef_stat_fric||(ce.stat_fric=Math.sqrt(ce.s1.material.staticFriction*ce.s2.material.staticFriction)),ce.userdef_rfric||(ce.rfric=Math.sqrt(ce.s1.material.rollingFriction*ce.s2.material.rollingFriction))),-1==ce.pre_dt&&(ce.pre_dt=e);var fe=e/ce.pre_dt;ce.pre_dt=e;var me=ce.b1.smass+ce.b2.smass;ce.hc2=!1;var be=!0;ce.biasCoef=2!=ce.b1.type||2!=ce.b2.type?ce.continuous?o.contactContinuousStaticBiasCoef:o.contactStaticBiasCoef:ce.continuous?o.contactContinuousBiasCoef:o.contactBiasCoef,ce.continuous=!1;for(var ge=null,we=null,Me=ce.innards.next,Ae=ce.contacts.next;null!=Ae;){var je=Ae;if(je.stamp+o.arbiterExpirationDelay<ce.stamp){var Ee,Ie,Te=ce.contacts;null==ge?(Ie=(Ee=Te.next).next,Te.next=Ie,null==Te.next&&(Te.pushmod=!0)):(Ie=(Ee=ge.next).next,ge.next=Ie,null==Ie&&(Te.pushmod=!0)),Ee._inuse=!1,Te.modified=!0,Te.length--,Te.pushmod=!0,Ae=Ie;var Ne,Le,Ve=ce.innards;null==we?(Le=(Ne=Ve.next).next,Ve.next=Le,null==Ve.next&&(Ve.pushmod=!0)):(Le=(Ne=we.next).next,we.next=Le,null==Le&&(Ve.pushmod=!0)),Ne._inuse=!1,Ve.modified=!0,Ve.length--,Ve.pushmod=!0,Me=Le,je.arbiter=null,je.next=Se.zpp_pool,Se.zpp_pool=je}else{var De=je.inner,Fe=je.active;if(je.active=je.stamp==ce.stamp,je.active){be?(be=!1,ce.c1=De,ce.oc1=je):(ce.hc2=!0,ce.c2=De,ce.oc2=je),De.r2x=je.px-ce.b2.posx,De.r2y=je.py-ce.b2.posy,De.r1x=je.px-ce.b1.posx,De.r1y=je.py-ce.b1.posy;var Re=De.r2x*ce.nx+De.r2y*ce.ny,Ze=me+ce.b2.sinertia*(Re*Re),Be=De.r1x*ce.nx+De.r1y*ce.ny;Ze+=ce.b1.sinertia*(Be*Be),De.tMass=Ze<o.epsilon*o.epsilon?0:1/Ze;var Ge=ce.ny*De.r2x-ce.nx*De.r2y,qe=me+ce.b2.sinertia*(Ge*Ge),Ue=ce.ny*De.r1x-ce.nx*De.r1y;qe+=ce.b1.sinertia*(Ue*Ue),De.nMass=qe<o.epsilon*o.epsilon?0:1/qe;var Ke=0,We=0,Ye=ce.b2.angvel+ce.b2.kinangvel;Ke=ce.b2.velx+ce.b2.kinvelx-De.r2y*Ye,We=ce.b2.vely+ce.b2.kinvely+De.r2x*Ye,Ye=ce.b1.angvel+ce.b1.kinangvel,Ke-=ce.b1.velx+ce.b1.kinvelx-De.r1y*Ye,We-=ce.b1.vely+ce.b1.kinvely+De.r1x*Ye;var Je=ce.nx*Ke+ce.ny*We;je.elasticity=ce.restitution,De.bounce=Je*je.elasticity,De.bounce>-o.elasticThreshold&&(De.bounce=0),Je=We*ce.nx-Ke*ce.ny;var Xe=o.staticFrictionThreshold;De.friction=Je*Je>Xe*Xe?ce.dyn_fric:ce.stat_fric,De.jnAcc*=fe,De.jtAcc*=fe}Fe!=je.active&&(ce.contacts.modified=!0),ge=Ae,we=Me,Me=Me.next,Ae=Ae.next}}if(ce.hc2){if(ce.hpc2=!0,ce.oc1.posOnly){var He=ce.c1;ce.c1=ce.c2,ce.c2=He;var $e=ce.oc1;ce.oc1=ce.oc2,ce.oc2=$e,ce.hc2=!1}else ce.oc2.posOnly&&(ce.hc2=!1);ce.oc1.posOnly&&(be=!0)}else ce.hpc2=!1;if(ce.jrAcc*=fe,be||(ce.rn1a=ce.ny*ce.c1.r1x-ce.nx*ce.c1.r1y,ce.rt1a=ce.c1.r1x*ce.nx+ce.c1.r1y*ce.ny,ce.rn1b=ce.ny*ce.c1.r2x-ce.nx*ce.c1.r2y,ce.rt1b=ce.c1.r2x*ce.nx+ce.c1.r2y*ce.ny,ce.k1x=ce.b2.kinvelx-ce.c1.r2y*ce.b2.kinangvel-(ce.b1.kinvelx-ce.c1.r1y*ce.b1.kinangvel),ce.k1y=ce.b2.kinvely+ce.c1.r2x*ce.b2.kinangvel-(ce.b1.kinvely+ce.c1.r1x*ce.b1.kinangvel)),ce.hc2)if(ce.rn2a=ce.ny*ce.c2.r1x-ce.nx*ce.c2.r1y,ce.rt2a=ce.c2.r1x*ce.nx+ce.c2.r1y*ce.ny,ce.rn2b=ce.ny*ce.c2.r2x-ce.nx*ce.c2.r2y,ce.rt2b=ce.c2.r2x*ce.nx+ce.c2.r2y*ce.ny,ce.k2x=ce.b2.kinvelx-ce.c2.r2y*ce.b2.kinangvel-(ce.b1.kinvelx-ce.c2.r1y*ce.b1.kinangvel),ce.k2y=ce.b2.kinvely+ce.c2.r2x*ce.b2.kinangvel-(ce.b1.kinvely+ce.c2.r1x*ce.b1.kinangvel),ce.kMassa=me+ce.b1.sinertia*ce.rn1a*ce.rn1a+ce.b2.sinertia*ce.rn1b*ce.rn1b,ce.kMassb=me+ce.b1.sinertia*ce.rn1a*ce.rn2a+ce.b2.sinertia*ce.rn1b*ce.rn2b,ce.kMassc=me+ce.b1.sinertia*ce.rn2a*ce.rn2a+ce.b2.sinertia*ce.rn2b*ce.rn2b,ce.kMassa*ce.kMassa+2*ce.kMassb*ce.kMassb+ce.kMassc*ce.kMassc<o.illConditionedThreshold*(ce.kMassa*ce.kMassc-ce.kMassb*ce.kMassb)){ce.Ka=ce.kMassa,ce.Kb=ce.kMassb,ce.Kc=ce.kMassc;var Qe=ce.kMassa*ce.kMassc-ce.kMassb*ce.kMassb;if(Qe!=Qe)ce.kMassa=ce.kMassb=ce.kMassc=0;else if(0==Qe)0!=ce.kMassa?ce.kMassa=1/ce.kMassa:ce.kMassa=0,0!=ce.kMassc?ce.kMassc=1/ce.kMassc:ce.kMassc=0,ce.kMassb=0;else{Qe=1/Qe;var nt=ce.kMassc*Qe;ce.kMassc=ce.kMassa*Qe,ce.kMassa=nt,ce.kMassb*=-Qe}}else{if(ce.hc2=!1,ce.oc2.dist<ce.oc1.dist){var et=ce.c1;ce.c1=ce.c2,ce.c2=et}ce.oc2.active=!1,ce.contacts.modified=!0}ce.surfacex=ce.b2.svelx,ce.surfacey=ce.b2.svely,ce.surfacex+=ce.b1.svelx,ce.surfacey+=ce.b1.svely,ce.surfacex=-ce.surfacex,ce.surfacey=-ce.surfacey,ce.rMass=ce.b1.sinertia+ce.b2.sinertia,0!=ce.rMass&&(ce.rMass=1/ce.rMass),be&&(n.active=!1)}else{var tt=n.fluidarb;-1==tt.pre_dt&&(tt.pre_dt=e);var it=e/tt.pre_dt;tt.pre_dt=e,tt.r1x=tt.centroidx-tt.b1.posx,tt.r1y=tt.centroidy-tt.b1.posy,tt.r2x=tt.centroidx-tt.b2.posx,tt.r2y=tt.centroidy-tt.b2.posy;var pt=0,lt=0;tt.ws1.fluidEnabled&&null!=tt.ws1.fluidProperties.wrap_gravity?(pt=tt.ws1.fluidProperties.gravityx,lt=tt.ws1.fluidProperties.gravityy):(pt=this.gravityx,lt=this.gravityy);var rt=0,ot=0;tt.ws2.fluidEnabled&&null!=tt.ws2.fluidProperties.wrap_gravity?(rt=tt.ws2.fluidProperties.gravityx,ot=tt.ws2.fluidProperties.gravityy):(rt=this.gravityx,ot=this.gravityy);var at=0,st=0;if(tt.ws1.fluidEnabled&&tt.ws2.fluidEnabled){var _t=tt.overlap*tt.ws1.fluidProperties.density,ht=tt.overlap*tt.ws2.fluidProperties.density;if(_t>ht){var ut=_t+ht;at-=pt*ut,st-=lt*ut}else if(_t<ht){var xt=_t+ht;at+=rt*xt,st+=ot*xt}else{var dt=0,yt=0;if(dt=pt+rt,yt=lt+ot,dt*=.5,yt*=.5,tt.ws1.worldCOMx*dt+tt.ws1.worldCOMy*yt>tt.ws2.worldCOMx*dt+tt.ws2.worldCOMy*yt){var vt=_t+ht;at-=dt*vt,st-=yt*vt}else{var ct=_t+ht;at+=dt*ct,st+=yt*ct}}}else if(tt.ws1.fluidEnabled){var ft=tt.overlap*tt.ws1.fluidProperties.density;at-=pt*ft,st-=lt*ft}else if(tt.ws2.fluidEnabled){var mt=tt.overlap*tt.ws2.fluidProperties.density;at+=rt*mt,st+=ot*mt}if(at*=e,st*=e,tt.buoyx=at,tt.buoyy=st,2==tt.b1.type){var bt=tt.b1.imass;tt.b1.velx-=at*bt,tt.b1.vely-=st*bt,tt.b1.angvel-=(st*tt.r1x-at*tt.r1y)*tt.b1.iinertia}if(2==tt.b2.type){var gt=tt.b2.imass;tt.b2.velx+=at*gt,tt.b2.vely+=st*gt,tt.b2.angvel+=(st*tt.r2x-at*tt.r2y)*tt.b2.iinertia}if(tt.ws1.fluidEnabled&&0!=tt.ws1.fluidProperties.viscosity||tt.ws2.fluidEnabled&&0!=tt.ws2.fluidProperties.viscosity){tt.nodrag=!1;var wt=0;if(tt.ws1.fluidEnabled&&(tt.ws2.validate_angDrag(),wt=tt.ws1.fluidProperties.viscosity*tt.ws2.angDrag*tt.overlap/tt.ws2.area),tt.ws2.fluidEnabled&&(tt.ws1.validate_angDrag(),wt+=tt.ws2.fluidProperties.viscosity*tt.ws1.angDrag*tt.overlap/tt.ws1.area),0!=wt){var Mt=tt.b1.sinertia+tt.b2.sinertia;tt.wMass=0!=Mt?1/Mt:0,wt*=4e-4;var Ct=2*Math.PI*wt;tt.agamma=1/(e*Ct*(2+Ct*e));var kt=1/(1+tt.agamma);tt.agamma*=kt,tt.wMass*=kt}else tt.wMass=0,tt.agamma=0;var Ot=tt.b2.velx+tt.b2.kinvelx-tt.r2y*(tt.b2.angvel+tt.b2.kinangvel)-(tt.b1.velx+tt.b1.kinvelx-tt.r1y*(tt.b2.angvel+tt.b2.kinangvel)),Pt=tt.b2.vely+tt.b2.kinvely+tt.r2x*(tt.b2.angvel+tt.b2.kinangvel)-(tt.b1.vely+tt.b1.kinvely+tt.r1x*(tt.b1.angvel+tt.b1.kinangvel));if(!(Ot*Ot+Pt*Pt<o.epsilon*o.epsilon)){var St=1/Math.sqrt(Ot*Ot+Pt*Pt);Ot*=St,Pt*=St,tt.nx=Ot,tt.ny=Pt}var At=0;if(tt.ws1.fluidEnabled){var jt=-tt.ws1.fluidProperties.viscosity*tt.overlap/tt.ws2.area;if(0==tt.ws2.type)At=0-jt*tt.ws2.circle.radius*o.fluidLinearDrag/(2*tt.ws2.circle.radius*Math.PI);else{for(var It=0,Tt=0,Nt=tt.ws2.polygon.edges.head;null!=Nt;){var Lt=Nt.elt;It+=Lt.length;var Vt=jt*Lt.length*(Lt.gnormx*tt.nx+Lt.gnormy*tt.ny);Vt>0&&(Vt=Vt*=-o.fluidVacuumDrag),Tt-=.5*Vt*o.fluidLinearDrag,Nt=Nt.next}At=Tt/It}}if(tt.ws2.fluidEnabled){var Dt=-tt.ws2.fluidProperties.viscosity*tt.overlap/tt.ws1.area;if(0==tt.ws1.type)At-=Dt*tt.ws1.circle.radius*o.fluidLinearDrag/(2*tt.ws1.circle.radius*Math.PI);else{for(var Ft=0,Rt=0,Zt=tt.ws1.polygon.edges.head;null!=Zt;){var Bt=Zt.elt;Ft+=Bt.length;var Gt=Dt*Bt.length*(Bt.gnormx*tt.nx+Bt.gnormy*tt.ny);Gt>0&&(Gt=Gt*=-o.fluidVacuumDrag),Rt-=.5*Gt*o.fluidLinearDrag,Zt=Zt.next}At+=Rt/Ft}}if(0!=At){var qt=tt.b1.smass+tt.b2.smass,Ut=0,Kt=0,Wt=0;if(Ut=qt,Kt=0,Wt=qt,0!=tt.b1.sinertia){var Yt=tt.r1x*tt.b1.sinertia,Jt=tt.r1y*tt.b1.sinertia;Ut=qt+Jt*tt.r1y,Kt+=-Jt*tt.r1x,Wt=qt+Yt*tt.r1x}if(0!=tt.b2.sinertia){var Xt=tt.r2x*tt.b2.sinertia,Ht=tt.r2y*tt.b2.sinertia;Ut+=Ht*tt.r2y,Kt+=-Ht*tt.r2x,Wt+=Xt*tt.r2x}var $t=Ut*Wt-Kt*Kt;if($t!=$t)Ut=Kt=Wt=0;else if(0==$t)Ut=0!=Ut?1/Ut:0,Wt=0!=Wt?1/Wt:0,Kt=0;else{var Qt=Wt*($t=1/$t);Wt=Ut*$t,Ut=Qt,Kt*=-$t}tt.vMassa=Ut,tt.vMassb=Kt,tt.vMassc=Wt;var ni=2*Math.PI*At;tt.lgamma=1/(e*ni*(2+ni*e));var ei=1/(1+tt.lgamma);tt.lgamma*=ei,tt.vMassa*=ei,tt.vMassb*=ei,tt.vMassc*=ei}else tt.vMassa=0,tt.vMassb=0,tt.vMassc=0,tt.lgamma=0}else tt.nodrag=!0,tt.dampx=0,tt.dampy=0,tt.adamp=0;tt.dampx*=it,tt.dampy*=it,tt.adamp*=it}}else if(null!=n.colarb){var ti=n.colarb,ii=!0,pi=null,li=null,ri=ti.innards.next;ti.hc2=!1;for(var oi=ti.contacts.next;null!=oi;){var ai=oi;if(ai.stamp+o.arbiterExpirationDelay<ti.stamp){var si,_i,hi=ti.contacts;null==pi?(_i=(si=hi.next).next,hi.next=_i,null==hi.next&&(hi.pushmod=!0)):(_i=(si=pi.next).next,pi.next=_i,null==_i&&(hi.pushmod=!0)),si._inuse=!1,hi.modified=!0,hi.length--,hi.pushmod=!0,oi=_i;var ui,xi,di=ti.innards;null==li?(xi=(ui=di.next).next,di.next=xi,null==di.next&&(di.pushmod=!0)):(xi=(ui=li.next).next,li.next=xi,null==xi&&(di.pushmod=!0)),ui._inuse=!1,di.modified=!0,di.length--,di.pushmod=!0,ri=xi,ai.arbiter=null,ai.next=Se.zpp_pool,Se.zpp_pool=ai}else{var yi=ai.inner,zi=ai.active;ai.active=ai.stamp==ti.stamp,ai.active&&(ii?(ii=!1,ti.c1=yi,ti.oc1=ai):(ti.hc2=!0,ti.c2=yi,ti.oc2=ai)),zi!=ai.active&&(ti.contacts.modified=!0),pi=oi,li=ri,ri=ri.next,oi=oi.next}}if(ti.hc2){if(ti.hpc2=!0,ti.oc1.posOnly){var vi=ti.c1;ti.c1=ti.c2,ti.c2=vi;var ci=ti.oc1;ti.oc1=ti.oc2,ti.oc2=ci,ti.hc2=!1}else ti.oc2.posOnly&&(ti.hc2=!1);ti.oc1.posOnly&&(ii=!0)}else ti.hpc2=!1;ii&&(n.active=!1)}return ve!=n.active&&(n.b1.arbiters.modified=!0,n.b2.arbiters.modified=!0,this.c_arbiters_true.modified=this.c_arbiters_false.modified=!0,this.s_arbiters.modified=this.f_arbiters.modified=!0),!1},Tt.prototype.prestep=function(n){for(var e=null,t=this.live_constraints.head;null!=t;){var i=t.elt;i.preStep(n)?(t=this.live_constraints.erase(e),i.broken(),this.constraintCbBreak(i),i.removeOnBreak?(i.component.sleeping=!0,this.midstep=!1,null!=i.compound?i.compound.wrap_constraints.remove(i.outer):this.wrap_constraints.remove(i.outer),this.midstep=!0):i.active=!1,i.clearcache()):(e=t,t=t.next)}var p=null,l=this.c_arbiters_true,r=l.head,o=null!=this.c_arbiters_false;for(o&&null==r&&(o=!1,r=this.c_arbiters_false.head,l=this.c_arbiters_false,p=null);null!=r;)if(this.presteparb(r.elt,n)){var a,s;null==p?(s=(a=l.head).next,l.head=s,null==l.head&&(l.pushmod=!0)):(s=(a=p.next).next,p.next=s,null==s&&(l.pushmod=!0));var _=a;_.elt=null,_.next=qi.zpp_pool,qi.zpp_pool=_,l.modified=!0,l.length--,l.pushmod=!0,r=s,o&&null==r&&(o=!1,r=this.c_arbiters_false.head,l=this.c_arbiters_false,p=null)}else p=r,r=r.next,o&&null==r&&(o=!1,r=this.c_arbiters_false.head,l=this.c_arbiters_false,p=null);for(var h=null,u=this.f_arbiters,x=u.head;null!=x;)if(this.presteparb(x.elt,n)){var d,y;null==h?(y=(d=u.head).next,u.head=y,null==u.head&&(u.pushmod=!0)):(y=(d=h.next).next,h.next=y,null==y&&(u.pushmod=!0));var z=d;z.elt=null,z.next=Zi.zpp_pool,Zi.zpp_pool=z,u.modified=!0,u.length--,u.pushmod=!0,x=y}else h=x,x=x.next;for(var v=null,c=this.s_arbiters,f=c.head;null!=f;)if(this.presteparb(f.elt,n)){var m,b;null==v?(b=(m=c.head).next,c.head=b,null==c.head&&(c.pushmod=!0)):(b=(m=v.next).next,v.next=b,null==b&&(c.pushmod=!0));var g=m;g.elt=null,g.next=Bi.zpp_pool,Bi.zpp_pool=g,c.modified=!0,c.length--,c.pushmod=!0,f=b}else v=f,f=f.next},Tt.prototype.warmStart=function(){for(var n=this.f_arbiters.head;null!=n;){var e=n.elt;if(e.active&&0!=(1&e.immState)){var t=e.b1.imass;e.b1.velx-=e.dampx*t,e.b1.vely-=e.dampy*t;var i=e.b2.imass;e.b2.velx+=e.dampx*i,e.b2.vely+=e.dampy*i,e.b1.angvel-=e.b1.iinertia*(e.dampy*e.r1x-e.dampx*e.r1y),e.b2.angvel+=e.b2.iinertia*(e.dampy*e.r2x-e.dampx*e.r2y),e.b1.angvel-=e.adamp*e.b1.iinertia,e.b2.angvel+=e.adamp*e.b2.iinertia}n=n.next}var p=this.c_arbiters_false.head,l=!0;for(null==p&&(p=this.c_arbiters_true.head,l=!1);null!=p;){var r=p.elt;if(r.active&&0!=(1&r.immState)){var o=r.nx*r.c1.jnAcc-r.ny*r.c1.jtAcc,a=r.ny*r.c1.jnAcc+r.nx*r.c1.jtAcc,s=r.b1.imass;r.b1.velx-=o*s,r.b1.vely-=a*s,r.b1.angvel-=r.b1.iinertia*(a*r.c1.r1x-o*r.c1.r1y);var _=r.b2.imass;if(r.b2.velx+=o*_,r.b2.vely+=a*_,r.b2.angvel+=r.b2.iinertia*(a*r.c1.r2x-o*r.c1.r2y),r.hc2){var h=r.nx*r.c2.jnAcc-r.ny*r.c2.jtAcc,u=r.ny*r.c2.jnAcc+r.nx*r.c2.jtAcc,x=r.b1.imass;r.b1.velx-=h*x,r.b1.vely-=u*x,r.b1.angvel-=r.b1.iinertia*(u*r.c2.r1x-h*r.c2.r1y);var d=r.b2.imass;r.b2.velx+=h*d,r.b2.vely+=u*d,r.b2.angvel+=r.b2.iinertia*(u*r.c2.r2x-h*r.c2.r2y)}r.b2.angvel+=r.jrAcc*r.b2.iinertia,r.b1.angvel-=r.jrAcc*r.b1.iinertia}p=p.next,l&&null==p&&(p=this.c_arbiters_true.head,l=!1)}for(var y=this.live_constraints.head;null!=y;)y.elt.warmStart(),y=y.next},Tt.prototype.iterateVel=function(n){for(var e=0;e<n;){++e;for(var t=this.f_arbiters.head;null!=t;){var i=t.elt;if(i.active&&0!=(1&i.immState)&&!i.nodrag){var p=i.b1.angvel+i.b1.kinangvel,l=i.b2.angvel+i.b2.kinangvel,r=i.b1.velx+i.b1.kinvelx-i.r1y*p-(i.b2.velx+i.b2.kinvelx-i.r2y*l),o=i.b1.vely+i.b1.kinvely+i.r1x*p-(i.b2.vely+i.b2.kinvely+i.r2x*l),a=i.vMassa*r+i.vMassb*o;o=i.vMassb*r+i.vMassc*o,r=a;var s=i.lgamma;r-=i.dampx*s,o-=i.dampy*s,i.dampx+=r,i.dampy+=o;var _=i.b1.imass;i.b1.velx-=r*_,i.b1.vely-=o*_;var h=i.b2.imass;i.b2.velx+=r*h,i.b2.vely+=o*h,i.b1.angvel-=i.b1.iinertia*(o*i.r1x-r*i.r1y),i.b2.angvel+=i.b2.iinertia*(o*i.r2x-r*i.r2y);var u=(p-l)*i.wMass-i.adamp*i.agamma;i.adamp+=u,i.b1.angvel-=u*i.b1.iinertia,i.b2.angvel+=u*i.b2.iinertia}t=t.next}for(var x=null,d=this.live_constraints.head;null!=d;){var y=d.elt;y.applyImpulseVel()?(d=this.live_constraints.erase(x),y.broken(),this.constraintCbBreak(y),y.removeOnBreak?(y.component.sleeping=!0,this.midstep=!1,null!=y.compound?y.compound.wrap_constraints.remove(y.outer):this.wrap_constraints.remove(y.outer),this.midstep=!0):y.active=!1,y.clearcache()):(x=d,d=d.next)}var z=this.c_arbiters_false.head,v=!0;for(null==z&&(z=this.c_arbiters_true.head,v=!1);null!=z;){var c=z.elt;if(c.active&&0!=(1&c.immState)){var f,m,b,g,w,M,C=c.k1x+c.b2.velx-c.c1.r2y*c.b2.angvel-(c.b1.velx-c.c1.r1y*c.b1.angvel),k=c.k1y+c.b2.vely+c.c1.r2x*c.b2.angvel-(c.b1.vely+c.c1.r1x*c.b1.angvel);if(b=(k*c.nx-C*c.ny+c.surfacex)*c.c1.tMass,g=c.c1.friction*c.c1.jnAcc,(M=(w=c.c1.jtAcc)-b)>g?M=g:M<-g&&(M=-g),b=M-w,c.c1.jtAcc=M,f=-c.ny*b,m=c.nx*b,c.b2.velx+=f*c.b2.imass,c.b2.vely+=m*c.b2.imass,c.b1.velx-=f*c.b1.imass,c.b1.vely-=m*c.b1.imass,c.b2.angvel+=c.rt1b*b*c.b2.iinertia,c.b1.angvel-=c.rt1a*b*c.b1.iinertia,c.hc2){var O=c.k2x+c.b2.velx-c.c2.r2y*c.b2.angvel-(c.b1.velx-c.c2.r1y*c.b1.angvel),P=c.k2y+c.b2.vely+c.c2.r2x*c.b2.angvel-(c.b1.vely+c.c2.r1x*c.b1.angvel);b=(P*c.nx-O*c.ny+c.surfacex)*c.c2.tMass,g=c.c2.friction*c.c2.jnAcc,(M=(w=c.c2.jtAcc)-b)>g?M=g:M<-g&&(M=-g),b=M-w,c.c2.jtAcc=M,f=-c.ny*b,m=c.nx*b,c.b2.velx+=f*c.b2.imass,c.b2.vely+=m*c.b2.imass,c.b1.velx-=f*c.b1.imass,c.b1.vely-=m*c.b1.imass,c.b2.angvel+=c.rt2b*b*c.b2.iinertia,c.b1.angvel-=c.rt2a*b*c.b1.iinertia,C=c.k1x+c.b2.velx-c.c1.r2y*c.b2.angvel-(c.b1.velx-c.c1.r1y*c.b1.angvel),k=c.k1y+c.b2.vely+c.c1.r2x*c.b2.angvel-(c.b1.vely+c.c1.r1x*c.b1.angvel),O=c.k2x+c.b2.velx-c.c2.r2y*c.b2.angvel-(c.b1.velx-c.c2.r1y*c.b1.angvel),P=c.k2y+c.b2.vely+c.c2.r2x*c.b2.angvel-(c.b1.vely+c.c2.r1x*c.b1.angvel);var S=c.c1.jnAcc,A=c.c2.jnAcc,j=C*c.nx+k*c.ny+c.surfacey+c.c1.bounce-(c.Ka*S+c.Kb*A),E=O*c.nx+P*c.ny+c.surfacey+c.c2.bounce-(c.Kb*S+c.Kc*A),I=-(c.kMassa*j+c.kMassb*E),T=-(c.kMassb*j+c.kMassc*E);I>=0&&T>=0?(j=I-S,E=T-A,c.c1.jnAcc=I,c.c2.jnAcc=T):(I=-c.c1.nMass*j)>=0&&c.Kb*I+E>=0?(j=I-S,E=-A,c.c1.jnAcc=I,c.c2.jnAcc=0):(T=-c.c2.nMass*E)>=0&&c.Kb*T+j>=0?(j=-S,E=T-A,c.c1.jnAcc=0,c.c2.jnAcc=T):j>=0&&E>=0?(j=-S,E=-A,c.c1.jnAcc=c.c2.jnAcc=0):(j=0,E=0),b=j+E,f=c.nx*b,m=c.ny*b,c.b2.velx+=f*c.b2.imass,c.b2.vely+=m*c.b2.imass,c.b1.velx-=f*c.b1.imass,c.b1.vely-=m*c.b1.imass,c.b2.angvel+=(c.rn1b*j+c.rn2b*E)*c.b2.iinertia,c.b1.angvel-=(c.rn1a*j+c.rn2a*E)*c.b1.iinertia}else 0!=c.radius&&(b=(c.b2.angvel-c.b1.angvel)*c.rMass,g=c.rfric*c.c1.jnAcc,w=c.jrAcc,c.jrAcc-=b,c.jrAcc>g?c.jrAcc=g:c.jrAcc<-g&&(c.jrAcc=-g),b=c.jrAcc-w,c.b2.angvel+=b*c.b2.iinertia,c.b1.angvel-=b*c.b1.iinertia),C=c.k1x+c.b2.velx-c.c1.r2y*c.b2.angvel-(c.b1.velx-c.c1.r1y*c.b1.angvel),k=c.k1y+c.b2.vely+c.c1.r2x*c.b2.angvel-(c.b1.vely+c.c1.r1x*c.b1.angvel),b=(c.c1.bounce+(c.nx*C+c.ny*k)+c.surfacey)*c.c1.nMass,(M=(w=c.c1.jnAcc)-b)<0&&(M=0),b=M-w,c.c1.jnAcc=M,f=c.nx*b,m=c.ny*b,c.b2.velx+=f*c.b2.imass,c.b2.vely+=m*c.b2.imass,c.b1.velx-=f*c.b1.imass,c.b1.vely-=m*c.b1.imass,c.b2.angvel+=c.rn1b*b*c.b2.iinertia,c.b1.angvel-=c.rn1a*b*c.b1.iinertia}z=z.next,v&&null==z&&(z=this.c_arbiters_true.head,v=!1)}}},Tt.prototype.iteratePos=function(n){for(var e=0;e<n;){++e;for(var t=null,i=this.live_constraints.head;null!=i;){var p=i.elt;!p.__velocity&&p.stiff&&p.applyImpulsePos()?(i=this.live_constraints.erase(t),p.broken(),this.constraintCbBreak(p),p.removeOnBreak?(p.component.sleeping=!0,this.midstep=!1,null!=p.compound?p.compound.wrap_constraints.remove(p.outer):this.wrap_constraints.remove(p.outer),this.midstep=!0):p.active=!1,p.clearcache()):(t=i,i=i.next)}var l=this.c_arbiters_false.head,r=!0;for(null==l&&(l=this.c_arbiters_true.head,r=!1);null!=l;){var a=l.elt;if(a.active&&0!=(1&a.immState))if(2==a.ptype){var s=a.c1,_=0,h=0;_=a.b2.axisy*s.lr2x-a.b2.axisx*s.lr2y,h=s.lr2x*a.b2.axisx+s.lr2y*a.b2.axisy,_+=a.b2.posx,h+=a.b2.posy;var u=0,x=0;u=a.b1.axisy*s.lr1x-a.b1.axisx*s.lr1y,x=s.lr1x*a.b1.axisx+s.lr1y*a.b1.axisy;var d=0,y=0;d=_-(u+=a.b1.posx),y=h-(x+=a.b1.posy);var z=Math.sqrt(d*d+y*y),v=a.radius-o.collisionSlop,c=z-v;if(d*a.nx+y*a.ny<0&&(d=-d,y=-y,c-=a.radius),c<0)if(z<o.epsilon)0!=a.b1.smass?a.b1.posx+=10*o.epsilon:a.b2.posx+=10*o.epsilon;else{var f=1/z;d*=f;var m=.5*(u+_),b=.5*(x+h),g=z-v,w=(y*=f)*(u=m-a.b1.posx)-d*(x=b-a.b1.posy),M=y*(_=m-a.b2.posx)-d*(h=b-a.b2.posy),C=a.b2.smass+M*M*a.b2.sinertia+a.b1.smass+w*w*a.b1.sinertia;if(0!=C){var k,O,P=-a.biasCoef*g/C;k=d*P,O=y*P;var S=a.b1.imass;a.b1.posx-=k*S,a.b1.posy-=O*S;var A=a.b1,j=-w*a.b1.iinertia*P;if(A.rot+=j,j*j>1e-4)A.axisx=Math.sin(A.rot),A.axisy=Math.cos(A.rot);else{var E=j*j,I=1-.5*E,T=1-E*E/8,N=(I*A.axisx+j*A.axisy)*T;A.axisy=(I*A.axisy-j*A.axisx)*T,A.axisx=N}var L=a.b2.imass;a.b2.posx+=k*L,a.b2.posy+=O*L;var V=a.b2,D=M*a.b2.iinertia*P;if(V.rot+=D,D*D>1e-4)V.axisx=Math.sin(V.rot),V.axisy=Math.cos(V.rot);else{var F=D*D,R=1-.5*F,Z=1-F*F/8,B=(R*V.axisx+D*V.axisy)*Z;V.axisy=(R*V.axisy-D*V.axisx)*Z,V.axisx=B}}}}else{var G,q=0,U=0,K=0,W=0,Y=0,J=0;0==a.ptype?(q=a.b1.axisy*a.lnormx-a.b1.axisx*a.lnormy,U=a.lnormx*a.b1.axisx+a.lnormy*a.b1.axisy,G=a.lproj+(q*a.b1.posx+U*a.b1.posy),K=a.b2.axisy*a.c1.lr1x-a.b2.axisx*a.c1.lr1y,W=a.c1.lr1x*a.b2.axisx+a.c1.lr1y*a.b2.axisy,K+=a.b2.posx,W+=a.b2.posy,a.hpc2&&(Y=a.b2.axisy*a.c2.lr1x-a.b2.axisx*a.c2.lr1y,J=a.c2.lr1x*a.b2.axisx+a.c2.lr1y*a.b2.axisy,Y+=a.b2.posx,J+=a.b2.posy)):(q=a.b2.axisy*a.lnormx-a.b2.axisx*a.lnormy,U=a.lnormx*a.b2.axisx+a.lnormy*a.b2.axisy,G=a.lproj+(q*a.b2.posx+U*a.b2.posy),K=a.b1.axisy*a.c1.lr1x-a.b1.axisx*a.c1.lr1y,W=a.c1.lr1x*a.b1.axisx+a.c1.lr1y*a.b1.axisy,K+=a.b1.posx,W+=a.b1.posy,a.hpc2&&(Y=a.b1.axisy*a.c2.lr1x-a.b1.axisx*a.c2.lr1y,J=a.c2.lr1x*a.b1.axisx+a.c2.lr1y*a.b1.axisy,Y+=a.b1.posx,J+=a.b1.posy));var X=K*q+W*U-G-a.radius;X+=o.collisionSlop;var H=0;if(a.hpc2&&(H=Y*q+J*U-G-a.radius,H+=o.collisionSlop),X<0||H<0){a.rev&&(q=-q,U=-U);var $,Q;$=K-a.b1.posx,Q=W-a.b1.posy;var nn,en;nn=K-a.b2.posx,en=W-a.b2.posy;if(a.hpc2){var tn=U*$-q*Q,pn=U*nn-q*en,ln=U*(Y-a.b1.posx)-q*(J-a.b1.posy),rn=U*(Y-a.b2.posx)-q*(J-a.b2.posy),on=a.b1.smass+a.b2.smass;a.kMassa=on+a.b1.sinertia*tn*tn+a.b2.sinertia*pn*pn,a.kMassb=on+a.b1.sinertia*tn*ln+a.b2.sinertia*pn*rn,a.kMassc=on+a.b1.sinertia*ln*ln+a.b2.sinertia*rn*rn;var an,sn,_n;an=a.kMassa,sn=a.kMassb,_n=a.kMassc;for(var hn=X*a.biasCoef,un=H*a.biasCoef;;){var xn=0,dn=0;xn=hn,dn=un,xn=-hn,dn=-un;var yn=a.kMassa*a.kMassc-a.kMassb*a.kMassb;if(yn!=yn)xn=dn=0;else if(0==yn)0!=a.kMassa?xn/=a.kMassa:xn=0,0!=a.kMassc?dn/=a.kMassc:dn=0;else{var zn=(yn=1/yn)*(a.kMassc*xn-a.kMassb*dn);dn=yn*(a.kMassa*dn-a.kMassb*xn),xn=zn}if(xn>=0&&dn>=0){var vn=(xn+dn)*a.b1.imass;a.b1.posx-=q*vn,a.b1.posy-=U*vn;var cn=a.b1,fn=-a.b1.iinertia*(tn*xn+ln*dn);if(cn.rot+=fn,fn*fn>1e-4)cn.axisx=Math.sin(cn.rot),cn.axisy=Math.cos(cn.rot);else{var mn=fn*fn,bn=1-.5*mn,gn=1-mn*mn/8,wn=(bn*cn.axisx+fn*cn.axisy)*gn;cn.axisy=(bn*cn.axisy-fn*cn.axisx)*gn,cn.axisx=wn}var Mn=(xn+dn)*a.b2.imass;a.b2.posx+=q*Mn,a.b2.posy+=U*Mn;var Cn=a.b2,kn=a.b2.iinertia*(pn*xn+rn*dn);if(Cn.rot+=kn,kn*kn>1e-4)Cn.axisx=Math.sin(Cn.rot),Cn.axisy=Math.cos(Cn.rot);else{var On=kn*kn,Pn=1-.5*On,Sn=1-On*On/8,An=(Pn*Cn.axisx+kn*Cn.axisy)*Sn;Cn.axisy=(Pn*Cn.axisy-kn*Cn.axisx)*Sn,Cn.axisx=An}break}if(dn=0,(xn=-hn/an)>=0&&sn*xn+un>=0){var jn=(xn+dn)*a.b1.imass;a.b1.posx-=q*jn,a.b1.posy-=U*jn;var En=a.b1,In=-a.b1.iinertia*(tn*xn+ln*dn);if(En.rot+=In,In*In>1e-4)En.axisx=Math.sin(En.rot),En.axisy=Math.cos(En.rot);else{var Tn=In*In,Nn=1-.5*Tn,Ln=1-Tn*Tn/8,Vn=(Nn*En.axisx+In*En.axisy)*Ln;En.axisy=(Nn*En.axisy-In*En.axisx)*Ln,En.axisx=Vn}var Dn=(xn+dn)*a.b2.imass;a.b2.posx+=q*Dn,a.b2.posy+=U*Dn;var Fn=a.b2,Rn=a.b2.iinertia*(pn*xn+rn*dn);if(Fn.rot+=Rn,Rn*Rn>1e-4)Fn.axisx=Math.sin(Fn.rot),Fn.axisy=Math.cos(Fn.rot);else{var Zn=Rn*Rn,Bn=1-.5*Zn,Gn=1-Zn*Zn/8,qn=(Bn*Fn.axisx+Rn*Fn.axisy)*Gn;Fn.axisy=(Bn*Fn.axisy-Rn*Fn.axisx)*Gn,Fn.axisx=qn}break}if(xn=0,(dn=-un/_n)>=0&&sn*dn+hn>=0){var Un=(xn+dn)*a.b1.imass;a.b1.posx-=q*Un,a.b1.posy-=U*Un;var Kn=a.b1,Wn=-a.b1.iinertia*(tn*xn+ln*dn);if(Kn.rot+=Wn,Wn*Wn>1e-4)Kn.axisx=Math.sin(Kn.rot),Kn.axisy=Math.cos(Kn.rot);else{var Yn=Wn*Wn,Jn=1-.5*Yn,Xn=1-Yn*Yn/8,Hn=(Jn*Kn.axisx+Wn*Kn.axisy)*Xn;Kn.axisy=(Jn*Kn.axisy-Wn*Kn.axisx)*Xn,Kn.axisx=Hn}var $n=(xn+dn)*a.b2.imass;a.b2.posx+=q*$n,a.b2.posy+=U*$n;var Qn=a.b2,ne=a.b2.iinertia*(pn*xn+rn*dn);if(Qn.rot+=ne,ne*ne>1e-4)Qn.axisx=Math.sin(Qn.rot),Qn.axisy=Math.cos(Qn.rot);else{var ee=ne*ne,te=1-.5*ee,ie=1-ee*ee/8,pe=(te*Qn.axisx+ne*Qn.axisy)*ie;Qn.axisy=(te*Qn.axisy-ne*Qn.axisx)*ie,Qn.axisx=pe}break}break}}else{var le=U*$-q*Q,re=U*nn-q*en,oe=a.b2.smass+re*re*a.b2.sinertia+a.b1.smass+le*le*a.b1.sinertia;if(0!=oe){var ae,se,_e=-a.biasCoef*X/oe;ae=q*_e,se=U*_e;var he=a.b1.imass;a.b1.posx-=ae*he,a.b1.posy-=se*he;var ue=a.b1,xe=-le*a.b1.iinertia*_e;if(ue.rot+=xe,xe*xe>1e-4)ue.axisx=Math.sin(ue.rot),ue.axisy=Math.cos(ue.rot);else{var de=xe*xe,ye=1-.5*de,ze=1-de*de/8,ve=(ye*ue.axisx+xe*ue.axisy)*ze;ue.axisy=(ye*ue.axisy-xe*ue.axisx)*ze,ue.axisx=ve}var ce=a.b2.imass;a.b2.posx+=ae*ce,a.b2.posy+=se*ce;var fe=a.b2,me=re*a.b2.iinertia*_e;if(fe.rot+=me,me*me>1e-4)fe.axisx=Math.sin(fe.rot),fe.axisy=Math.cos(fe.rot);else{var be=me*me,ge=1-.5*be,we=1-be*be/8,Me=(ge*fe.axisx+me*fe.axisy)*we;fe.axisy=(ge*fe.axisy-me*fe.axisx)*we,fe.axisx=Me}}}}}l=l.next,r&&null==l&&(l=this.c_arbiters_true.head,r=!1)}}},Tt.prototype.group_ignore=function(n,e){for(var t=n;null!=t&&null==t.group;)t=null!=t.ishape?t.ishape.body:null!=t.icompound?t.icompound.compound:t.ibody.compound;var i=null==t?null:t.group;if(null==i)return!1;for(var p=e;null!=p&&null==p.group;)p=null!=p.ishape?p.ishape.body:null!=p.icompound?p.icompound.compound:p.ibody.compound;var l=null==p?null:p.group;if(null==l)return!1;for(var r=!1;null!=i&&null!=l;){if(i==l){r=i.ignore;break}i.depth<l.depth?l=l.group:i=i.group}return r},Tt.prototype.interactionType=function(n,e,t,i){var p;p=!1;for(var l,r=t.constraints.head;null!=r;){var o=r.elt;if(o.ignore&&o.pair_exists(t.id,i.id)){p=!0;break}r=r.next}if(p)l=!1;else{for(var a=n;null!=a&&null==a.group;)a=null!=a.ishape?a.ishape.body:null!=a.icompound?a.icompound.compound:a.ibody.compound;var s,_=null==a?null:a.group;if(null==_)s=!1;else{for(var h=e;null!=h&&null==h.group;)h=null!=h.ishape?h.ishape.body:null!=h.icompound?h.icompound.compound:h.ibody.compound;var u=null==h?null:h.group;if(null==u)s=!1;else{for(var x=!1;null!=_&&null!=u;){if(_==u){x=_.ignore;break}_.depth<u.depth?u=u.group:_=_.group}s=x}}l=!s}if(l){var d,y;if(n.sensorEnabled||e.sensorEnabled){var z=n.filter,v=e.filter;d=0!=(z.sensorMask&v.sensorGroup)&&0!=(v.sensorMask&z.sensorGroup)}else d=!1;if(d)return 2;if(n.fluidEnabled||e.fluidEnabled){var c=n.filter,f=e.filter;y=0!=(c.fluidMask&f.fluidGroup)&&0!=(f.fluidMask&c.fluidGroup)}else y=!1;if(!!y&&!(0==t.imass&&0==i.imass&&0==t.iinertia&&0==i.iinertia))return 0;var m=n.filter,b=e.filter;return 0!=(m.collisionMask&b.collisionGroup)&&0!=(b.collisionMask&m.collisionGroup)&&!(0==t.imass&&0==i.imass&&0==t.iinertia&&0==i.iinertia)?1:-1}return-1},Tt.prototype.precb=null,Tt.prototype.prelisteners=null,Tt.prototype.narrowPhase=function(n,e,t,i,p){var l,r=null,a=n.body,s=e.body;l=!1;for(var _,h,u=a.constraints.head;null!=u;){var x=u.elt;if(x.ignore&&x.pair_exists(a.id,s.id)){l=!0;break}u=u.next}if(l)h=!1;else{for(var d=n;null!=d&&null==d.group;)d=null!=d.ishape?d.ishape.body:null!=d.icompound?d.icompound.compound:d.ibody.compound;var y,z=null==d?null:d.group;if(null==z)y=!1;else{for(var v=e;null!=v&&null==v.group;)v=null!=v.ishape?v.ishape.body:null!=v.icompound?v.icompound.compound:v.ibody.compound;var c=null==v?null:v.group;if(null==c)y=!1;else{for(var f=!1;null!=z&&null!=c;){if(z==c){f=z.ignore;break}z.depth<c.depth?c=c.group:z=z.group}y=f}}h=!y}if(h){var m;if(n.sensorEnabled||e.sensorEnabled){var b=n.filter,g=e.filter;m=0!=(b.sensorMask&g.sensorGroup)&&0!=(g.sensorMask&b.sensorGroup)}else m=!1;if(m)_=2;else{var w;if(n.fluidEnabled||e.fluidEnabled){var M=n.filter,C=e.filter;w=0!=(M.fluidMask&C.fluidGroup)&&0!=(C.fluidMask&M.fluidGroup)}else w=!1;if(!!w&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia))_=0;else{var O=n.filter,P=e.filter;_=0!=(O.collisionMask&P.collisionGroup)&&0!=(P.collisionMask&O.collisionGroup)&&!(0==a.imass&&0==s.imass&&0==a.iinertia&&0==s.iinertia)?1:-1}}}else _=-1;if(-1!=_){var S,A;n.type>e.type?(S=e,A=n):n.type==e.type?n.id<e.id?(S=n,A=e):(A=n,S=e):(S=n,A=e);var j=S==e;if(0==_){var E;if(null==i){for(var I=null,T=(a.arbiters.length<s.arbiters.length?a:s).arbiters.head;null!=T;){var N=T.elt;if(N.id==S.id&&N.di==A.id){I=N;break}T=T.next}E=I}else E=i;var L,V=null==E,D=!1;if(V)null==Oe.zpp_pool?L=new Oe:(L=Oe.zpp_pool,Oe.zpp_pool=L.next,L.next=null);else if(null==E.fluidarb){E.cleared=!0;for(var F=E.b1.arbiters,R=null,Z=F.head;null!=Z;){if(Z.elt==E){var B,G;null==R?(G=(B=F.head).next,F.head=G,null==F.head&&(F.pushmod=!0)):(G=(B=R.next).next,R.next=G,null==G&&(F.pushmod=!0));var q=B;q.elt=null,q.next=bi.zpp_pool,bi.zpp_pool=q,F.modified=!0,F.length--,F.pushmod=!0;break}R=Z,Z=Z.next}for(var U=E.b2.arbiters,K=null,W=U.head;null!=W;){if(W.elt==E){var Y,J;null==K?(J=(Y=U.head).next,U.head=J,null==U.head&&(U.pushmod=!0)):(J=(Y=K.next).next,K.next=J,null==J&&(U.pushmod=!0));var X=Y;X.elt=null,X.next=bi.zpp_pool,bi.zpp_pool=X,U.modified=!0,U.length--,U.pushmod=!0;break}K=W,W=W.next}null!=E.pair&&(E.pair.arb=null,E.pair=null),E.active=!1,this.f_arbiters.modified=!0,null==Oe.zpp_pool?L=new Oe:(L=Oe.zpp_pool,Oe.zpp_pool=L.next,L.next=null),L.intchange=!0,V=!0,D=!0}else L=E.fluidarb;if(V||L.stamp!=this.stamp||p)if(L.stamp=this.stamp,Le.flowCollide(S,A,L)){if(V){var H=S.id,$=A.id;L.b1=n.body,L.ws1=n,L.b2=e.body,L.ws2=e,L.id=H,L.di=$;var Q,nn=L.b1.arbiters;null==bi.zpp_pool?Q=new bi:(Q=bi.zpp_pool,bi.zpp_pool=Q.next,Q.next=null),Q.elt=L;var en=Q;en.next=nn.head,nn.head=en,nn.modified=!0,nn.length++;var tn,pn=L.b2.arbiters;null==bi.zpp_pool?tn=new bi:(tn=bi.zpp_pool,bi.zpp_pool=tn.next,tn.next=null),tn.elt=L;var ln=tn;ln.next=pn.head,pn.head=ln,pn.modified=!0,pn.length++,L.active=!0,L.present=0,L.cleared=!1,L.sleeping=!1,L.fresh=!1,L.presentable=!1,L.nx=0,L.ny=1,L.dampx=0,L.dampy=0,L.adamp=0;var rn,on=this.f_arbiters;null==Zi.zpp_pool?rn=new Zi:(rn=Zi.zpp_pool,Zi.zpp_pool=rn.next,rn.next=null),rn.elt=L;var an=rn;an.next=on.head,on.head=an,on.modified=!0,on.length++,L.fresh=!D}else L.fresh=L.up_stamp<this.stamp-1||L.endGenerated==this.stamp&&p;if(L.up_stamp=L.stamp,L.fresh||0==(4&L.immState)){L.immState=1;for(var sn=!1,_n=L.ws1.id>L.ws2.id?L.ws2:L.ws1,hn=L.ws1.id>L.ws2.id?L.ws1:L.ws2,un=this.mrca1;null!=un.head;){var xn=un.head;un.head=xn.next,xn.elt=null,xn.next=Mi.zpp_pool,Mi.zpp_pool=xn,null==un.head&&(un.pushmod=!0),un.modified=!0,un.length--}un.pushmod=!0;for(var dn=this.mrca2;null!=dn.head;){var yn=dn.head;dn.head=yn.next,yn.elt=null,yn.next=Mi.zpp_pool,Mi.zpp_pool=yn,null==dn.head&&(dn.pushmod=!0),dn.modified=!0,dn.length--}if(dn.pushmod=!0,null!=_n.cbSet){var zn,vn=this.mrca1;null==Mi.zpp_pool?zn=new Mi:(zn=Mi.zpp_pool,Mi.zpp_pool=zn.next,zn.next=null),zn.elt=_n;var cn=zn;cn.next=vn.head,vn.head=cn,vn.modified=!0,vn.length++}if(null!=_n.body.cbSet){var fn,mn=this.mrca1,bn=_n.body;null==Mi.zpp_pool?fn=new Mi:(fn=Mi.zpp_pool,Mi.zpp_pool=fn.next,fn.next=null),fn.elt=bn;var gn=fn;gn.next=mn.head,mn.head=gn,mn.modified=!0,mn.length++}if(null!=hn.cbSet){var wn,Mn=this.mrca2;null==Mi.zpp_pool?wn=new Mi:(wn=Mi.zpp_pool,Mi.zpp_pool=wn.next,wn.next=null),wn.elt=hn;var Cn=wn;Cn.next=Mn.head,Mn.head=Cn,Mn.modified=!0,Mn.length++}if(null!=hn.body.cbSet){var kn,On=this.mrca2,Pn=hn.body;null==Mi.zpp_pool?kn=new Mi:(kn=Mi.zpp_pool,Mi.zpp_pool=kn.next,kn.next=null),kn.elt=Pn;var Sn=kn;Sn.next=On.head,On.head=Sn,On.modified=!0,On.length++}for(var An=_n.body.compound,jn=hn.body.compound;An!=jn;)if((null==An?0:An.depth)<(null==jn?0:jn.depth)){if(null!=jn.cbSet){var En,In=this.mrca2;null==Mi.zpp_pool?En=new Mi:(En=Mi.zpp_pool,Mi.zpp_pool=En.next,En.next=null),En.elt=jn;var Tn=En;Tn.next=In.head,In.head=Tn,In.modified=!0,In.length++}jn=jn.compound}else{if(null!=An.cbSet){var Nn,Ln=this.mrca1;null==Mi.zpp_pool?Nn=new Mi:(Nn=Mi.zpp_pool,Mi.zpp_pool=Nn.next,Nn.next=null),Nn.elt=An;var Vn=Nn;Vn.next=Ln.head,Ln.head=Vn,Ln.modified=!0,Ln.length++}An=An.compound}for(var Dn=this.mrca1.head;null!=Dn;){for(var Fn=Dn.elt,Rn=this.mrca2.head;null!=Rn;){for(var Zn,Bn=Rn.elt,Gn=Fn.cbSet,qn=Bn.cbSet,Un=null,Kn=(Gn.cbpairs.length<qn.cbpairs.length?Gn.cbpairs:qn.cbpairs).head;null!=Kn;){var Wn=Kn.elt;if(Wn.a==Gn&&Wn.b==qn||Wn.a==qn&&Wn.b==Gn){Un=Wn;break}Kn=Kn.next}if(null==Un)null==Qn.zpp_pool?Zn=new Qn:(Zn=Qn.zpp_pool,Qn.zpp_pool=Zn.next,Zn.next=null),Zn.zip_listeners=!0,$n.setlt(Gn,qn)?(Zn.a=Gn,Zn.b=qn):(Zn.a=qn,Zn.b=Gn),Un=Zn,Gn.cbpairs.add(Un),qn!=Gn&&qn.cbpairs.add(Un);if(Un.zip_listeners&&(Un.zip_listeners=!1,Un.__validate()),null!=Un.listeners.head){for(var Yn=null,Jn=null,Xn=this.prelisteners;null!=Xn.head;){var Hn=Xn.head;Xn.head=Hn.next,Hn.elt=null,Hn.next=gi.zpp_pool,gi.zpp_pool=Hn,null==Xn.head&&(Xn.pushmod=!0),Xn.modified=!0,Xn.length--}Xn.pushmod=!0;for(var ne,ee=null,te=null,ie=(Gn.cbpairs.length<qn.cbpairs.length?Gn.cbpairs:qn.cbpairs).head;null!=ie;){var pe=ie.elt;if(pe.a==Gn&&pe.b==qn||pe.a==qn&&pe.b==Gn){te=pe;break}ie=ie.next}if(null==te)null==Qn.zpp_pool?ne=new Qn:(ne=Qn.zpp_pool,Qn.zpp_pool=ne.next,ne.next=null),ne.zip_listeners=!0,$n.setlt(Gn,qn)?(ne.a=Gn,ne.b=qn):(ne.a=qn,ne.b=Gn),te=ne,Gn.cbpairs.add(te),qn!=Gn&&qn.cbpairs.add(te);te.zip_listeners&&(te.zip_listeners=!1,te.__validate());for(var le=te.listeners.head;null!=le;){var re=le.elt;if(5==re.event&&0!=(4&re.itype)){var ae,se=this.prelisteners;null==gi.zpp_pool?ae=new gi:(ae=gi.zpp_pool,gi.zpp_pool=ae.next,ae.next=null),ae.elt=re;var _e=ae;null==ee?(_e.next=se.head,se.head=_e):(_e.next=ee.next,ee.next=_e),se.pushmod=se.modified=!0,se.length++,ee=_e,sn=!!sn||!re.pure}le=le.next}if(null!=this.prelisteners.head){if(null==(Yn=zt.get(Fn,Bn))&&(Jn=Et.get(Fn,Bn),this.add_callbackset(Jn)),null==Yn||(Yn.FLUIDstamp!=this.stamp||p)&&0==(4&Yn.FLUIDstate)){if(null!=Jn&&(Yn=Jn),null!=Yn)for(var he=this.prelisteners.head;null!=he;)7==he.elt.itype?(Yn.COLLISIONstamp=this.stamp,Yn.SENSORstamp=this.stamp,Yn.FLUIDstamp=this.stamp):Yn.FLUIDstamp=this.stamp,he=he.next;var ue=L.active;L.active=!0,this.precb.zpp_inner.pre_arbiter=L,this.precb.zpp_inner.set=Yn;for(var xe=this.prelisteners.head;null!=xe;){var de=xe.elt;this.precb.zpp_inner.listener=de;var ye,ze=this.precb.zpp_inner,ve=Yn.int1,ce=Yn.int2,fe=de.options1,me=ve.cbTypes;if(fe.nonemptyintersection(me,fe.includes)&&!fe.nonemptyintersection(me,fe.excludes)){var be=de.options2,ge=ce.cbTypes;ye=!!be.nonemptyintersection(ge,be.includes)&&!be.nonemptyintersection(ge,be.excludes)}else ye=!1;ye?(ze.int1=ve,ze.int2=ce):(ze.int1=ce,ze.int2=ve),this.precb.zpp_inner.pre_swapped=Fn!=this.precb.zpp_inner.int1;var we,Me=de.handlerp(this.precb);if(null!=Me)null==oe.PreFlag_ACCEPT&&(oe.internal=!0,oe.PreFlag_ACCEPT=new k,oe.internal=!1),Me==oe.PreFlag_ACCEPT?we=5:(null==oe.PreFlag_ACCEPT_ONCE&&(oe.internal=!0,oe.PreFlag_ACCEPT_ONCE=new k,oe.internal=!1),Me==oe.PreFlag_ACCEPT_ONCE?we=1:(null==oe.PreFlag_IGNORE&&(oe.internal=!0,oe.PreFlag_IGNORE=new k,oe.internal=!1),we=Me==oe.PreFlag_IGNORE?6:2)),L.immState=we;xe=xe.next}if(L.active=ue,null!=Yn)for(var Ce=this.prelisteners.head;null!=Ce;)7==Ce.elt.itype?(Yn.COLLISIONstate=L.immState,Yn.SENSORstate=L.immState,Yn.FLUIDstate=L.immState):Yn.FLUIDstate=L.immState,Ce=Ce.next}else null==Yn?0==(4&L.immState)&&(L.immState=1):L.immState=Yn.FLUIDstate;Rn=Rn.next}else Rn=Rn.next}else Rn=Rn.next}Dn=Dn.next}if(sn&&0==(4&L.immState)){if(2==L.b1.type){var Ae=L.b1;Ae.world||(Ae.component.waket=this.stamp+(this.midstep?0:1),3==Ae.type&&(Ae.kinematicDelaySleep=!0),Ae.component.sleeping&&this.really_wake(Ae,!1))}if(2==L.b1.type){var je=L.b2;je.world||(je.component.waket=this.stamp+(this.midstep?0:1),3==je.type&&(je.kinematicDelaySleep=!0),je.component.sleeping&&this.really_wake(je,!1))}}}if(0!=(1&L.immState)){if(2==L.b1.type&&L.b1.component.sleeping){var Ee=L.b1;Ee.world||(Ee.component.waket=this.stamp+(this.midstep?0:1),3==Ee.type&&(Ee.kinematicDelaySleep=!0),Ee.component.sleeping&&this.really_wake(Ee,!1))}if(2==L.b2.type&&L.b2.component.sleeping){var Ie=L.b2;Ie.world||(Ie.component.waket=this.stamp+(this.midstep?0:1),3==Ie.type&&(Ie.kinematicDelaySleep=!0),Ie.component.sleeping&&this.really_wake(Ie,!1))}}if(L.sleeping){L.sleeping=!1;var Te,Ne=this.f_arbiters;null==Zi.zpp_pool?Te=new Zi:(Te=Zi.zpp_pool,Zi.zpp_pool=Te.next,Te.next=null),Te.elt=L;var Ve=Te;Ve.next=Ne.head,Ne.head=Ve,Ne.modified=!0,Ne.length++}r=L}else if(V){var De=L;De.next=Oe.zpp_pool,Oe.zpp_pool=De,r=null}else r=L;else r=L}else if(1==_){var Fe,Re=t?this.c_arbiters_true:this.c_arbiters_false;if(null==i){for(var Ze=null,Be=(a.arbiters.length<s.arbiters.length?a:s).arbiters.head;null!=Be;){var Ge=Be.elt;if(Ge.id==S.id&&Ge.di==A.id){Ze=Ge;break}Be=Be.next}Fe=Ze}else Fe=i;var qe,Ue=null==Fe,Ke=!1;if(Ue)null==Pe.zpp_pool?qe=new Pe:(qe=Pe.zpp_pool,Pe.zpp_pool=qe.next,qe.next=null),qe.stat=t;else if(null==Fe.colarb){Fe.cleared=!0;for(var We=Fe.b1.arbiters,Ye=null,Je=We.head;null!=Je;){if(Je.elt==Fe){var Xe,He;null==Ye?(He=(Xe=We.head).next,We.head=He,null==We.head&&(We.pushmod=!0)):(He=(Xe=Ye.next).next,Ye.next=He,null==He&&(We.pushmod=!0));var $e=Xe;$e.elt=null,$e.next=bi.zpp_pool,bi.zpp_pool=$e,We.modified=!0,We.length--,We.pushmod=!0;break}Ye=Je,Je=Je.next}for(var Qe=Fe.b2.arbiters,nt=null,et=Qe.head;null!=et;){if(et.elt==Fe){var tt,it;null==nt?(it=(tt=Qe.head).next,Qe.head=it,null==Qe.head&&(Qe.pushmod=!0)):(it=(tt=nt.next).next,nt.next=it,null==it&&(Qe.pushmod=!0));var pt=tt;pt.elt=null,pt.next=bi.zpp_pool,bi.zpp_pool=pt,Qe.modified=!0,Qe.length--,Qe.pushmod=!0;break}nt=et,et=et.next}null!=Fe.pair&&(Fe.pair.arb=null,Fe.pair=null),Fe.active=!1,this.f_arbiters.modified=!0,null==Pe.zpp_pool?qe=new Pe:(qe=Pe.zpp_pool,Pe.zpp_pool=qe.next,qe.next=null),qe.intchange=!0,qe.stat=t,Ue=!0,Ke=!0}else j=S!=(qe=Fe.colarb).s1,qe.stat!=t&&(qe.stat=t,qe.sleeping||((t?this.c_arbiters_false:this.c_arbiters_true).remove(qe),Re.add(qe)));if(Ue||qe.stamp!=this.stamp||p)if(qe.stamp=this.stamp,Le.contactCollide(S,A,qe,j)){if(Ue){var lt=S.id,rt=A.id;qe.b1=n.body,qe.ws1=n,qe.b2=e.body,qe.ws2=e,qe.id=lt,qe.di=rt;var ot,at=qe.b1.arbiters;null==bi.zpp_pool?ot=new bi:(ot=bi.zpp_pool,bi.zpp_pool=ot.next,ot.next=null),ot.elt=qe;var st=ot;st.next=at.head,at.head=st,at.modified=!0,at.length++;var _t,ht=qe.b2.arbiters;null==bi.zpp_pool?_t=new bi:(_t=bi.zpp_pool,bi.zpp_pool=_t.next,_t.next=null),_t.elt=qe;var ut,xt=_t;xt.next=ht.head,ht.head=xt,ht.modified=!0,ht.length++,qe.active=!0,qe.present=0,qe.cleared=!1,qe.sleeping=!1,qe.fresh=!1,qe.presentable=!1,qe.s1=n,qe.s2=e,qe.userdef_restitution||(qe.s1.material.elasticity<=-1/0||qe.s2.material.elasticity<=-1/0?qe.restitution=0:qe.s1.material.elasticity>=1/0||qe.s2.material.elasticity>=1/0?qe.restitution=1:qe.restitution=(qe.s1.material.elasticity+qe.s2.material.elasticity)/2,qe.restitution<0&&(qe.restitution=0),qe.restitution>1&&(qe.restitution=1)),qe.userdef_dyn_fric||(qe.dyn_fric=Math.sqrt(qe.s1.material.dynamicFriction*qe.s2.material.dynamicFriction)),qe.userdef_stat_fric||(qe.stat_fric=Math.sqrt(qe.s1.material.staticFriction*qe.s2.material.staticFriction)),qe.userdef_rfric||(qe.rfric=Math.sqrt(qe.s1.material.rollingFriction*qe.s2.material.rollingFriction)),null==qi.zpp_pool?ut=new qi:(ut=qi.zpp_pool,qi.zpp_pool=ut.next,ut.next=null),ut.elt=qe;var dt=ut;dt.next=Re.head,Re.head=dt,Re.modified=!0,Re.length++,qe.fresh=!Ke}else qe.fresh=qe.up_stamp<this.stamp-1||qe.endGenerated==this.stamp&&p;if(qe.up_stamp=qe.stamp,qe.fresh||0==(4&qe.immState)){qe.immState=1;for(var yt=!1,vt=qe.ws1.id>qe.ws2.id?qe.ws2:qe.ws1,ct=qe.ws1.id>qe.ws2.id?qe.ws1:qe.ws2,ft=this.mrca1;null!=ft.head;){var mt=ft.head;ft.head=mt.next,mt.elt=null,mt.next=Mi.zpp_pool,Mi.zpp_pool=mt,null==ft.head&&(ft.pushmod=!0),ft.modified=!0,ft.length--}ft.pushmod=!0;for(var bt=this.mrca2;null!=bt.head;){var gt=bt.head;bt.head=gt.next,gt.elt=null,gt.next=Mi.zpp_pool,Mi.zpp_pool=gt,null==bt.head&&(bt.pushmod=!0),bt.modified=!0,bt.length--}if(bt.pushmod=!0,null!=vt.cbSet){var wt,Mt=this.mrca1;null==Mi.zpp_pool?wt=new Mi:(wt=Mi.zpp_pool,Mi.zpp_pool=wt.next,wt.next=null),wt.elt=vt;var Ct=wt;Ct.next=Mt.head,Mt.head=Ct,Mt.modified=!0,Mt.length++}if(null!=vt.body.cbSet){var kt,Ot=this.mrca1,Pt=vt.body;null==Mi.zpp_pool?kt=new Mi:(kt=Mi.zpp_pool,Mi.zpp_pool=kt.next,kt.next=null),kt.elt=Pt;var St=kt;St.next=Ot.head,Ot.head=St,Ot.modified=!0,Ot.length++}if(null!=ct.cbSet){var At,jt=this.mrca2;null==Mi.zpp_pool?At=new Mi:(At=Mi.zpp_pool,Mi.zpp_pool=At.next,At.next=null),At.elt=ct;var It=At;It.next=jt.head,jt.head=It,jt.modified=!0,jt.length++}if(null!=ct.body.cbSet){var Tt,Nt=this.mrca2,Lt=ct.body;null==Mi.zpp_pool?Tt=new Mi:(Tt=Mi.zpp_pool,Mi.zpp_pool=Tt.next,Tt.next=null),Tt.elt=Lt;var Vt=Tt;Vt.next=Nt.head,Nt.head=Vt,Nt.modified=!0,Nt.length++}for(var Dt=vt.body.compound,Ft=ct.body.compound;Dt!=Ft;)if((null==Dt?0:Dt.depth)<(null==Ft?0:Ft.depth)){if(null!=Ft.cbSet){var Rt,Zt=this.mrca2;null==Mi.zpp_pool?Rt=new Mi:(Rt=Mi.zpp_pool,Mi.zpp_pool=Rt.next,Rt.next=null),Rt.elt=Ft;var Bt=Rt;Bt.next=Zt.head,Zt.head=Bt,Zt.modified=!0,Zt.length++}Ft=Ft.compound}else{if(null!=Dt.cbSet){var Gt,qt=this.mrca1;null==Mi.zpp_pool?Gt=new Mi:(Gt=Mi.zpp_pool,Mi.zpp_pool=Gt.next,Gt.next=null),Gt.elt=Dt;var Ut=Gt;Ut.next=qt.head,qt.head=Ut,qt.modified=!0,qt.length++}Dt=Dt.compound}for(var Kt=this.mrca1.head;null!=Kt;){for(var Wt=Kt.elt,Yt=this.mrca2.head;null!=Yt;){for(var Jt,Xt=Yt.elt,Ht=Wt.cbSet,$t=Xt.cbSet,Qt=null,ni=(Ht.cbpairs.length<$t.cbpairs.length?Ht.cbpairs:$t.cbpairs).head;null!=ni;){var ei=ni.elt;if(ei.a==Ht&&ei.b==$t||ei.a==$t&&ei.b==Ht){Qt=ei;break}ni=ni.next}if(null==Qt)null==Qn.zpp_pool?Jt=new Qn:(Jt=Qn.zpp_pool,Qn.zpp_pool=Jt.next,Jt.next=null),Jt.zip_listeners=!0,$n.setlt(Ht,$t)?(Jt.a=Ht,Jt.b=$t):(Jt.a=$t,Jt.b=Ht),Qt=Jt,Ht.cbpairs.add(Qt),$t!=Ht&&$t.cbpairs.add(Qt);if(Qt.zip_listeners&&(Qt.zip_listeners=!1,Qt.__validate()),null!=Qt.listeners.head){for(var ti=null,ii=null,pi=this.prelisteners;null!=pi.head;){var li=pi.head;pi.head=li.next,li.elt=null,li.next=gi.zpp_pool,gi.zpp_pool=li,null==pi.head&&(pi.pushmod=!0),pi.modified=!0,pi.length--}pi.pushmod=!0;for(var ri,oi=null,ai=null,si=(Ht.cbpairs.length<$t.cbpairs.length?Ht.cbpairs:$t.cbpairs).head;null!=si;){var _i=si.elt;if(_i.a==Ht&&_i.b==$t||_i.a==$t&&_i.b==Ht){ai=_i;break}si=si.next}if(null==ai)null==Qn.zpp_pool?ri=new Qn:(ri=Qn.zpp_pool,Qn.zpp_pool=ri.next,ri.next=null),ri.zip_listeners=!0,$n.setlt(Ht,$t)?(ri.a=Ht,ri.b=$t):(ri.a=$t,ri.b=Ht),ai=ri,Ht.cbpairs.add(ai),$t!=Ht&&$t.cbpairs.add(ai);ai.zip_listeners&&(ai.zip_listeners=!1,ai.__validate());for(var hi=ai.listeners.head;null!=hi;){var ui=hi.elt;if(5==ui.event&&0!=(1&ui.itype)){var xi,di=this.prelisteners;null==gi.zpp_pool?xi=new gi:(xi=gi.zpp_pool,gi.zpp_pool=xi.next,xi.next=null),xi.elt=ui;var yi=xi;null==oi?(yi.next=di.head,di.head=yi):(yi.next=oi.next,oi.next=yi),di.pushmod=di.modified=!0,di.length++,oi=yi,yt=!!yt||!ui.pure}hi=hi.next}if(null!=this.prelisteners.head){if(null==(ti=zt.get(Wt,Xt))&&(ii=Et.get(Wt,Xt),this.add_callbackset(ii)),null==ti||(ti.COLLISIONstamp!=this.stamp||p)&&0==(4&ti.COLLISIONstate)){if(null!=ii&&(ti=ii),null!=ti)for(var zi=this.prelisteners.head;null!=zi;)7==zi.elt.itype?(ti.COLLISIONstamp=this.stamp,ti.SENSORstamp=this.stamp,ti.FLUIDstamp=this.stamp):ti.COLLISIONstamp=this.stamp,zi=zi.next;var vi=qe.active;qe.active=!0;var ci=!0,fi=null,mi=null,wi=qe.innards.next;qe.hc2=!1;for(var Ci=qe.contacts.next;null!=Ci;){var ki=Ci;if(ki.stamp+o.arbiterExpirationDelay<qe.stamp){var Oi,Pi,Si=qe.contacts;null==fi?(Pi=(Oi=Si.next).next,Si.next=Pi,null==Si.next&&(Si.pushmod=!0)):(Pi=(Oi=fi.next).next,fi.next=Pi,null==Pi&&(Si.pushmod=!0)),Oi._inuse=!1,Si.modified=!0,Si.length--,Si.pushmod=!0,Ci=Pi;var Ai,ji,Ei=qe.innards;null==mi?(ji=(Ai=Ei.next).next,Ei.next=ji,null==Ei.next&&(Ei.pushmod=!0)):(ji=(Ai=mi.next).next,mi.next=ji,null==ji&&(Ei.pushmod=!0)),Ai._inuse=!1,Ei.modified=!0,Ei.length--,Ei.pushmod=!0,wi=ji,ki.arbiter=null,ki.next=Se.zpp_pool,Se.zpp_pool=ki}else{var Ii=ki.inner,Ti=ki.active;ki.active=ki.stamp==qe.stamp,ki.active&&(ci?(ci=!1,qe.c1=Ii,qe.oc1=ki):(qe.hc2=!0,qe.c2=Ii,qe.oc2=ki)),Ti!=ki.active&&(qe.contacts.modified=!0),fi=Ci,mi=wi,wi=wi.next,Ci=Ci.next}}if(qe.hc2)if(qe.hpc2=!0,qe.oc1.posOnly){var Ni=qe.c1;qe.c1=qe.c2,qe.c2=Ni;var Li=qe.oc1;qe.oc1=qe.oc2,qe.oc2=Li,qe.hc2=!1}else qe.oc2.posOnly&&(qe.hc2=!1);else qe.hpc2=!1;this.precb.zpp_inner.pre_arbiter=qe,this.precb.zpp_inner.set=ti;for(var Vi=this.prelisteners.head;null!=Vi;){var Di=Vi.elt;this.precb.zpp_inner.listener=Di;var Fi,Ri=this.precb.zpp_inner,Gi=ti.int1,Ui=ti.int2,Ki=Di.options1,Wi=Gi.cbTypes;if(Ki.nonemptyintersection(Wi,Ki.includes)&&!Ki.nonemptyintersection(Wi,Ki.excludes)){var Yi=Di.options2,Ji=Ui.cbTypes;Fi=!!Yi.nonemptyintersection(Ji,Yi.includes)&&!Yi.nonemptyintersection(Ji,Yi.excludes)}else Fi=!1;Fi?(Ri.int1=Gi,Ri.int2=Ui):(Ri.int1=Ui,Ri.int2=Gi),this.precb.zpp_inner.pre_swapped=Wt!=this.precb.zpp_inner.int1;var Xi,Hi=Di.handlerp(this.precb);if(null!=Hi)null==oe.PreFlag_ACCEPT&&(oe.internal=!0,oe.PreFlag_ACCEPT=new k,oe.internal=!1),Hi==oe.PreFlag_ACCEPT?Xi=5:(null==oe.PreFlag_ACCEPT_ONCE&&(oe.internal=!0,oe.PreFlag_ACCEPT_ONCE=new k,oe.internal=!1),Hi==oe.PreFlag_ACCEPT_ONCE?Xi=1:(null==oe.PreFlag_IGNORE&&(oe.internal=!0,oe.PreFlag_IGNORE=new k,oe.internal=!1),Xi=Hi==oe.PreFlag_IGNORE?6:2)),qe.immState=Xi;Vi=Vi.next}if(qe.active=vi,null!=ti)for(var $i=this.prelisteners.head;null!=$i;)7==$i.elt.itype?(ti.COLLISIONstate=qe.immState,ti.SENSORstate=qe.immState,ti.FLUIDstate=qe.immState):ti.COLLISIONstate=qe.immState,$i=$i.next}else null==ti?0==(4&qe.immState)&&(qe.immState=1):qe.immState=ti.COLLISIONstate;Yt=Yt.next}else Yt=Yt.next}else Yt=Yt.next}Kt=Kt.next}if(yt&&0==(4&qe.immState)){if(2==qe.b1.type){var Qi=qe.b1;Qi.world||(Qi.component.waket=this.stamp+(this.midstep?0:1),3==Qi.type&&(Qi.kinematicDelaySleep=!0),Qi.component.sleeping&&this.really_wake(Qi,!1))}if(2==qe.b1.type){var np=qe.b2;np.world||(np.component.waket=this.stamp+(this.midstep?0:1),3==np.type&&(np.kinematicDelaySleep=!0),np.component.sleeping&&this.really_wake(np,!1))}}}if(0!=(1&qe.immState)){if(2==qe.b1.type&&qe.b1.component.sleeping){var ep=qe.b1;ep.world||(ep.component.waket=this.stamp+(this.midstep?0:1),3==ep.type&&(ep.kinematicDelaySleep=!0),ep.component.sleeping&&this.really_wake(ep,!1))}if(2==qe.b2.type&&qe.b2.component.sleeping){var tp=qe.b2;tp.world||(tp.component.waket=this.stamp+(this.midstep?0:1),3==tp.type&&(tp.kinematicDelaySleep=!0),tp.component.sleeping&&this.really_wake(tp,!1))}}if(qe.sleeping){var ip;qe.sleeping=!1,null==qi.zpp_pool?ip=new qi:(ip=qi.zpp_pool,qi.zpp_pool=ip.next,ip.next=null),ip.elt=qe;var pp=ip;pp.next=Re.head,Re.head=pp,Re.modified=!0,Re.length++}r=qe}else if(Ue){var lp=qe;lp.userdef_dyn_fric=!1,lp.userdef_stat_fric=!1,lp.userdef_restitution=!1,lp.userdef_rfric=!1,lp.__ref_edge1=lp.__ref_edge2=null,lp.next=Pe.zpp_pool,Pe.zpp_pool=lp,r=null}else r=qe;else r=qe}else{var rp;if(null==i){for(var op=null,ap=(a.arbiters.length<s.arbiters.length?a:s).arbiters.head;null!=ap;){var sp=ap.elt;if(sp.id==S.id&&sp.di==A.id){op=sp;break}ap=ap.next}rp=op}else rp=i;var _p,hp=null==rp,up=!1;if(hp)null==ke.zpp_pool?_p=new ke:(_p=ke.zpp_pool,ke.zpp_pool=_p.next,_p.next=null);else if(null==rp.sensorarb){rp.cleared=!0;for(var xp=rp.b1.arbiters,dp=null,yp=xp.head;null!=yp;){if(yp.elt==rp){var zp,vp;null==dp?(vp=(zp=xp.head).next,xp.head=vp,null==xp.head&&(xp.pushmod=!0)):(vp=(zp=dp.next).next,dp.next=vp,null==vp&&(xp.pushmod=!0));var cp=zp;cp.elt=null,cp.next=bi.zpp_pool,bi.zpp_pool=cp,xp.modified=!0,xp.length--,xp.pushmod=!0;break}dp=yp,yp=yp.next}for(var fp=rp.b2.arbiters,mp=null,bp=fp.head;null!=bp;){if(bp.elt==rp){var gp,wp;null==mp?(wp=(gp=fp.head).next,fp.head=wp,null==fp.head&&(fp.pushmod=!0)):(wp=(gp=mp.next).next,mp.next=wp,null==wp&&(fp.pushmod=!0));var Mp=gp;Mp.elt=null,Mp.next=bi.zpp_pool,bi.zpp_pool=Mp,fp.modified=!0,fp.length--,fp.pushmod=!0;break}mp=bp,bp=bp.next}null!=rp.pair&&(rp.pair.arb=null,rp.pair=null),rp.active=!1,this.f_arbiters.modified=!0,null==ke.zpp_pool?_p=new ke:(_p=ke.zpp_pool,ke.zpp_pool=_p.next,_p.next=null),_p.intchange=!0,hp=!0,up=!0}else _p=rp.sensorarb;if(hp||_p.stamp!=this.stamp||p)if(_p.stamp=this.stamp,Le.testCollide(S,A)){if(hp){var Cp=S.id,kp=A.id;_p.b1=n.body,_p.ws1=n,_p.b2=e.body,_p.ws2=e,_p.id=Cp,_p.di=kp;var Op,Pp=_p.b1.arbiters;null==bi.zpp_pool?Op=new bi:(Op=bi.zpp_pool,bi.zpp_pool=Op.next,Op.next=null),Op.elt=_p;var Sp=Op;Sp.next=Pp.head,Pp.head=Sp,Pp.modified=!0,Pp.length++;var Ap,jp=_p.b2.arbiters;null==bi.zpp_pool?Ap=new bi:(Ap=bi.zpp_pool,bi.zpp_pool=Ap.next,Ap.next=null),Ap.elt=_p;var Ep=Ap;Ep.next=jp.head,jp.head=Ep,jp.modified=!0,jp.length++,_p.active=!0,_p.present=0,_p.cleared=!1,_p.sleeping=!1,_p.fresh=!1,_p.presentable=!1;var Ip,Tp=this.s_arbiters;null==Bi.zpp_pool?Ip=new Bi:(Ip=Bi.zpp_pool,Bi.zpp_pool=Ip.next,Ip.next=null),Ip.elt=_p;var Np=Ip;Np.next=Tp.head,Tp.head=Np,Tp.modified=!0,Tp.length++,_p.fresh=!up}else _p.fresh=_p.up_stamp<this.stamp-1||_p.endGenerated==this.stamp&&p;if(_p.up_stamp=_p.stamp,_p.fresh||0==(4&_p.immState)){_p.immState=1;for(var Lp=!1,Vp=_p.ws1.id>_p.ws2.id?_p.ws2:_p.ws1,Dp=_p.ws1.id>_p.ws2.id?_p.ws1:_p.ws2,Fp=this.mrca1;null!=Fp.head;){var Rp=Fp.head;Fp.head=Rp.next,Rp.elt=null,Rp.next=Mi.zpp_pool,Mi.zpp_pool=Rp,null==Fp.head&&(Fp.pushmod=!0),Fp.modified=!0,Fp.length--}Fp.pushmod=!0;for(var Zp=this.mrca2;null!=Zp.head;){var Bp=Zp.head;Zp.head=Bp.next,Bp.elt=null,Bp.next=Mi.zpp_pool,Mi.zpp_pool=Bp,null==Zp.head&&(Zp.pushmod=!0),Zp.modified=!0,Zp.length--}if(Zp.pushmod=!0,null!=Vp.cbSet){var Gp,qp=this.mrca1;null==Mi.zpp_pool?Gp=new Mi:(Gp=Mi.zpp_pool,Mi.zpp_pool=Gp.next,Gp.next=null),Gp.elt=Vp;var Up=Gp;Up.next=qp.head,qp.head=Up,qp.modified=!0,qp.length++}if(null!=Vp.body.cbSet){var Kp,Wp=this.mrca1,Yp=Vp.body;null==Mi.zpp_pool?Kp=new Mi:(Kp=Mi.zpp_pool,Mi.zpp_pool=Kp.next,Kp.next=null),Kp.elt=Yp;var Jp=Kp;Jp.next=Wp.head,Wp.head=Jp,Wp.modified=!0,Wp.length++}if(null!=Dp.cbSet){var Xp,Hp=this.mrca2;null==Mi.zpp_pool?Xp=new Mi:(Xp=Mi.zpp_pool,Mi.zpp_pool=Xp.next,Xp.next=null),Xp.elt=Dp;var $p=Xp;$p.next=Hp.head,Hp.head=$p,Hp.modified=!0,Hp.length++}if(null!=Dp.body.cbSet){var Qp,nl=this.mrca2,el=Dp.body;null==Mi.zpp_pool?Qp=new Mi:(Qp=Mi.zpp_pool,Mi.zpp_pool=Qp.next,Qp.next=null),Qp.elt=el;var tl=Qp;tl.next=nl.head,nl.head=tl,nl.modified=!0,nl.length++}for(var il=Vp.body.compound,pl=Dp.body.compound;il!=pl;)if((null==il?0:il.depth)<(null==pl?0:pl.depth)){if(null!=pl.cbSet){var ll,rl=this.mrca2;null==Mi.zpp_pool?ll=new Mi:(ll=Mi.zpp_pool,Mi.zpp_pool=ll.next,ll.next=null),ll.elt=pl;var ol=ll;ol.next=rl.head,rl.head=ol,rl.modified=!0,rl.length++}pl=pl.compound}else{if(null!=il.cbSet){var al,sl=this.mrca1;null==Mi.zpp_pool?al=new Mi:(al=Mi.zpp_pool,Mi.zpp_pool=al.next,al.next=null),al.elt=il;var _l=al;_l.next=sl.head,sl.head=_l,sl.modified=!0,sl.length++}il=il.compound}for(var hl=this.mrca1.head;null!=hl;){for(var ul=hl.elt,xl=this.mrca2.head;null!=xl;){for(var dl,yl=xl.elt,zl=ul.cbSet,vl=yl.cbSet,cl=null,fl=(zl.cbpairs.length<vl.cbpairs.length?zl.cbpairs:vl.cbpairs).head;null!=fl;){var ml=fl.elt;if(ml.a==zl&&ml.b==vl||ml.a==vl&&ml.b==zl){cl=ml;break}fl=fl.next}if(null==cl)null==Qn.zpp_pool?dl=new Qn:(dl=Qn.zpp_pool,Qn.zpp_pool=dl.next,dl.next=null),dl.zip_listeners=!0,$n.setlt(zl,vl)?(dl.a=zl,dl.b=vl):(dl.a=vl,dl.b=zl),cl=dl,zl.cbpairs.add(cl),vl!=zl&&vl.cbpairs.add(cl);if(cl.zip_listeners&&(cl.zip_listeners=!1,cl.__validate()),null!=cl.listeners.head){for(var bl=null,gl=null,wl=this.prelisteners;null!=wl.head;){var Ml=wl.head;wl.head=Ml.next,Ml.elt=null,Ml.next=gi.zpp_pool,gi.zpp_pool=Ml,null==wl.head&&(wl.pushmod=!0),wl.modified=!0,wl.length--}wl.pushmod=!0;for(var Cl,kl=null,Ol=null,Pl=(zl.cbpairs.length<vl.cbpairs.length?zl.cbpairs:vl.cbpairs).head;null!=Pl;){var Sl=Pl.elt;if(Sl.a==zl&&Sl.b==vl||Sl.a==vl&&Sl.b==zl){Ol=Sl;break}Pl=Pl.next}if(null==Ol)null==Qn.zpp_pool?Cl=new Qn:(Cl=Qn.zpp_pool,Qn.zpp_pool=Cl.next,Cl.next=null),Cl.zip_listeners=!0,$n.setlt(zl,vl)?(Cl.a=zl,Cl.b=vl):(Cl.a=vl,Cl.b=zl),Ol=Cl,zl.cbpairs.add(Ol),vl!=zl&&vl.cbpairs.add(Ol);Ol.zip_listeners&&(Ol.zip_listeners=!1,Ol.__validate());for(var Al=Ol.listeners.head;null!=Al;){var jl=Al.elt;if(5==jl.event&&0!=(2&jl.itype)){var El,Il=this.prelisteners;null==gi.zpp_pool?El=new gi:(El=gi.zpp_pool,gi.zpp_pool=El.next,El.next=null),El.elt=jl;var Tl=El;null==kl?(Tl.next=Il.head,Il.head=Tl):(Tl.next=kl.next,kl.next=Tl),Il.pushmod=Il.modified=!0,Il.length++,kl=Tl,Lp=!!Lp||!jl.pure}Al=Al.next}if(null!=this.prelisteners.head){if(null==(bl=zt.get(ul,yl))&&(gl=Et.get(ul,yl),this.add_callbackset(gl)),null==bl||(bl.SENSORstamp!=this.stamp||p)&&0==(4&bl.SENSORstate)){if(null!=gl&&(bl=gl),null!=bl)for(var Nl=this.prelisteners.head;null!=Nl;)7==Nl.elt.itype?(bl.COLLISIONstamp=this.stamp,bl.SENSORstamp=this.stamp,bl.FLUIDstamp=this.stamp):bl.SENSORstamp=this.stamp,Nl=Nl.next;var Ll=_p.active;_p.active=!0,this.precb.zpp_inner.pre_arbiter=_p,this.precb.zpp_inner.set=bl;for(var Vl=this.prelisteners.head;null!=Vl;){var Dl=Vl.elt;this.precb.zpp_inner.listener=Dl;var Fl,Rl=this.precb.zpp_inner,Zl=bl.int1,Bl=bl.int2,Gl=Dl.options1,ql=Zl.cbTypes;if(Gl.nonemptyintersection(ql,Gl.includes)&&!Gl.nonemptyintersection(ql,Gl.excludes)){var Ul=Dl.options2,Kl=Bl.cbTypes;Fl=!!Ul.nonemptyintersection(Kl,Ul.includes)&&!Ul.nonemptyintersection(Kl,Ul.excludes)}else Fl=!1;Fl?(Rl.int1=Zl,Rl.int2=Bl):(Rl.int1=Bl,Rl.int2=Zl),this.precb.zpp_inner.pre_swapped=ul!=this.precb.zpp_inner.int1;var Wl,Yl=Dl.handlerp(this.precb);if(null!=Yl)null==oe.PreFlag_ACCEPT&&(oe.internal=!0,oe.PreFlag_ACCEPT=new k,oe.internal=!1),Yl==oe.PreFlag_ACCEPT?Wl=5:(null==oe.PreFlag_ACCEPT_ONCE&&(oe.internal=!0,oe.PreFlag_ACCEPT_ONCE=new k,oe.internal=!1),Yl==oe.PreFlag_ACCEPT_ONCE?Wl=1:(null==oe.PreFlag_IGNORE&&(oe.internal=!0,oe.PreFlag_IGNORE=new k,oe.internal=!1),Wl=Yl==oe.PreFlag_IGNORE?6:2)),_p.immState=Wl;Vl=Vl.next}if(_p.active=Ll,null!=bl)for(var Jl=this.prelisteners.head;null!=Jl;)7==Jl.elt.itype?(bl.COLLISIONstate=_p.immState,bl.SENSORstate=_p.immState,bl.FLUIDstate=_p.immState):bl.SENSORstate=_p.immState,Jl=Jl.next}else null==bl?0==(4&_p.immState)&&(_p.immState=1):_p.immState=bl.SENSORstate;xl=xl.next}else xl=xl.next}else xl=xl.next}hl=hl.next}if(Lp&&0==(4&_p.immState)){if(1!=_p.b1.type){var Xl=_p.b1;Xl.world||(Xl.component.waket=this.stamp+(this.midstep?0:1),3==Xl.type&&(Xl.kinematicDelaySleep=!0),Xl.component.sleeping&&this.really_wake(Xl,!1))}if(1!=_p.b2.type){var Hl=_p.b2;Hl.world||(Hl.component.waket=this.stamp+(this.midstep?0:1),3==Hl.type&&(Hl.kinematicDelaySleep=!0),Hl.component.sleeping&&this.really_wake(Hl,!1))}}}if(_p.sleeping){_p.sleeping=!1;var $l,Ql=this.s_arbiters;null==Bi.zpp_pool?$l=new Bi:($l=Bi.zpp_pool,Bi.zpp_pool=$l.next,$l.next=null),$l.elt=_p;var nr=$l;nr.next=Ql.head,Ql.head=nr,Ql.modified=!0,Ql.length++}r=_p}else if(hp){var er=_p;er.next=ke.zpp_pool,ke.zpp_pool=er,r=null}else r=_p;else r=_p}}return r},Tt.prototype.mrca1=null,Tt.prototype.mrca2=null,Tt.prototype.MRCA_chains=function(n,e){for(var t=this.mrca1;null!=t.head;){var i=t.head;t.head=i.next,i.elt=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,null==t.head&&(t.pushmod=!0),t.modified=!0,t.length--}t.pushmod=!0;for(var p=this.mrca2;null!=p.head;){var l=p.head;p.head=l.next,l.elt=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,null==p.head&&(p.pushmod=!0),p.modified=!0,p.length--}if(p.pushmod=!0,null!=n.cbSet){var r,o=this.mrca1;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.elt=n;var a=r;a.next=o.head,o.head=a,o.modified=!0,o.length++}if(null!=n.body.cbSet){var s,_=this.mrca1,h=n.body;null==Mi.zpp_pool?s=new Mi:(s=Mi.zpp_pool,Mi.zpp_pool=s.next,s.next=null),s.elt=h;var u=s;u.next=_.head,_.head=u,_.modified=!0,_.length++}if(null!=e.cbSet){var x,d=this.mrca2;null==Mi.zpp_pool?x=new Mi:(x=Mi.zpp_pool,Mi.zpp_pool=x.next,x.next=null),x.elt=e;var y=x;y.next=d.head,d.head=y,d.modified=!0,d.length++}if(null!=e.body.cbSet){var z,v=this.mrca2,c=e.body;null==Mi.zpp_pool?z=new Mi:(z=Mi.zpp_pool,Mi.zpp_pool=z.next,z.next=null),z.elt=c;var f=z;f.next=v.head,v.head=f,v.modified=!0,v.length++}for(var m=n.body.compound,b=e.body.compound;m!=b;)if((null==m?0:m.depth)<(null==b?0:b.depth)){if(null!=b.cbSet){var g,w=this.mrca2;null==Mi.zpp_pool?g=new Mi:(g=Mi.zpp_pool,Mi.zpp_pool=g.next,g.next=null),g.elt=b;var M=g;M.next=w.head,w.head=M,w.modified=!0,w.length++}b=b.compound}else{if(null!=m.cbSet){var C,k=this.mrca1;null==Mi.zpp_pool?C=new Mi:(C=Mi.zpp_pool,Mi.zpp_pool=C.next,C.next=null),C.elt=m;var O=C;O.next=k.head,k.head=O,k.modified=!0,k.length++}m=m.compound}},Tt.prototype.inlined_MRCA_chains=function(n,e){for(var t=this.mrca1;null!=t.head;){var i=t.head;t.head=i.next,i.elt=null,i.next=Mi.zpp_pool,Mi.zpp_pool=i,null==t.head&&(t.pushmod=!0),t.modified=!0,t.length--}t.pushmod=!0;for(var p=this.mrca2;null!=p.head;){var l=p.head;p.head=l.next,l.elt=null,l.next=Mi.zpp_pool,Mi.zpp_pool=l,null==p.head&&(p.pushmod=!0),p.modified=!0,p.length--}if(p.pushmod=!0,null!=n.cbSet){var r,o=this.mrca1;null==Mi.zpp_pool?r=new Mi:(r=Mi.zpp_pool,Mi.zpp_pool=r.next,r.next=null),r.elt=n;var a=r;a.next=o.head,o.head=a,o.modified=!0,o.length++}if(null!=n.body.cbSet){var s,_=this.mrca1,h=n.body;null==Mi.zpp_pool?s=new Mi:(s=Mi.zpp_pool,Mi.zpp_pool=s.next,s.next=null),s.elt=h;var u=s;u.next=_.head,_.head=u,_.modified=!0,_.length++}if(null!=e.cbSet){var x,d=this.mrca2;null==Mi.zpp_pool?x=new Mi:(x=Mi.zpp_pool,Mi.zpp_pool=x.next,x.next=null),x.elt=e;var y=x;y.next=d.head,d.head=y,d.modified=!0,d.length++}if(null!=e.body.cbSet){var z,v=this.mrca2,c=e.body;null==Mi.zpp_pool?z=new Mi:(z=Mi.zpp_pool,Mi.zpp_pool=z.next,z.next=null),z.elt=c;var f=z;f.next=v.head,v.head=f,v.modified=!0,v.length++}for(var m=n.body.compound,b=e.body.compound;m!=b;)if((null==m?0:m.depth)<(null==b?0:b.depth)){if(null!=b.cbSet){var g,w=this.mrca2;null==Mi.zpp_pool?g=new Mi:(g=Mi.zpp_pool,Mi.zpp_pool=g.next,g.next=null),g.elt=b;var M=g;M.next=w.head,w.head=M,w.modified=!0,w.length++}b=b.compound}else{if(null!=m.cbSet){var C,k=this.mrca1;null==Mi.zpp_pool?C=new Mi:(C=Mi.zpp_pool,Mi.zpp_pool=C.next,C.next=null),C.elt=m;var O=C;O.next=k.head,k.head=O,k.modified=!0,k.length++}m=m.compound}},Tt.prototype.__class__=Tt;var Nt=zpp_nape.space.ZPP_SweepData=function(){this.aabb=null,this.shape=null,this.prev=null,this.next=null};Nt.__name__=["zpp_nape","space","ZPP_SweepData"],Nt.prototype.next=null,Nt.prototype.prev=null,Nt.prototype.shape=null,Nt.prototype.aabb=null,Nt.prototype.free=function(){this.prev=null,this.shape=null,this.aabb=null},Nt.prototype.alloc=function(){},Nt.prototype.gt=function(n){return this.aabb.minx>n.aabb.minx},Nt.prototype.__class__=Nt;var Lt=zpp_nape.space.ZPP_SweepPhase=function(n){this.failed=null,this.list=null,Ct.call(this),this.space=n,this.is_sweep=!0,this.sweep=this};Lt.__name__=["zpp_nape","space","ZPP_SweepPhase"],Lt.__super__=Ct,Lt.prototype=Object.create(Ct.prototype),Lt.prototype.list=null,Lt.prototype.__insert=function(n){var e;null==Nt.zpp_pool?e=new Nt:(e=Nt.zpp_pool,Nt.zpp_pool=e.next,e.next=null),n.sweep=e,e.shape=n,e.aabb=n.aabb,e.next=this.list,null!=this.list&&(this.list.prev=e),this.list=e},Lt.prototype.__remove=function(n){var e=n.sweep;null==e.prev?this.list=e.next:e.prev.next=e.next,null!=e.next&&(e.next.prev=e.prev),n.sweep=null,e.prev=null,e.shape=null,e.aabb=null,e.next=Nt.zpp_pool,Nt.zpp_pool=e},Lt.prototype.__sync=function(n){if(!this.space.continuous&&n.zip_aabb&&null!=n.body)if(n.zip_aabb=!1,0==n.type){var e=n.circle;if(e.zip_worldCOM&&null!=e.body){if(e.zip_worldCOM=!1,e.zip_localCOM){if(e.zip_localCOM=!1,1==e.type){var t=e.polygon;if(null==t.lverts.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y;else if(null==t.lverts.next.next.next)t.localCOMx=t.lverts.next.x,t.localCOMy=t.lverts.next.y,t.localCOMx+=t.lverts.next.next.x,t.localCOMy+=t.lverts.next.next.y,t.localCOMx*=.5,t.localCOMy*=.5;else{t.localCOMx=0,t.localCOMy=0;var i=0,p=t.lverts.next,l=p,r=p=p.next;for(p=p.next;null!=p;){var o=p;i+=r.x*(o.y-l.y);var a=o.y*r.x-o.x*r.y;t.localCOMx+=(r.x+o.x)*a,t.localCOMy+=(r.y+o.y)*a,l=r,r=o,p=p.next}var s=p=t.lverts.next;i+=r.x*(s.y-l.y);var _=s.y*r.x-s.x*r.y;t.localCOMx+=(r.x+s.x)*_,t.localCOMy+=(r.y+s.y)*_,l=r;var h=p=p.next;i+=s.x*(h.y-l.y);var u=h.y*s.x-h.x*s.y;t.localCOMx+=(s.x+h.x)*u,t.localCOMy+=(s.y+h.y)*u;var x=i=1/(3*i);t.localCOMx*=x,t.localCOMy*=x}}null!=e.wrap_localCOM&&(e.wrap_localCOM.zpp_inner.x=e.localCOMx,e.wrap_localCOM.zpp_inner.y=e.localCOMy)}var d=e.body;d.zip_axis&&(d.zip_axis=!1,d.axisx=Math.sin(d.rot),d.axisy=Math.cos(d.rot)),e.worldCOMx=e.body.posx+(e.body.axisy*e.localCOMx-e.body.axisx*e.localCOMy),e.worldCOMy=e.body.posy+(e.localCOMx*e.body.axisx+e.localCOMy*e.body.axisy)}var y=e.radius,z=e.radius;e.aabb.minx=e.worldCOMx-y,e.aabb.miny=e.worldCOMy-z,e.aabb.maxx=e.worldCOMx+y,e.aabb.maxy=e.worldCOMy+z}else{var v=n.polygon;if(v.zip_gverts&&null!=v.body){v.zip_gverts=!1,v.validate_lverts();var c=v.body;c.zip_axis&&(c.zip_axis=!1,c.axisx=Math.sin(c.rot),c.axisy=Math.cos(c.rot));for(var f=v.lverts.next,m=v.gverts.next;null!=m;){var b=m,g=f;f=f.next,b.x=v.body.posx+(v.body.axisy*g.x-v.body.axisx*g.y),b.y=v.body.posy+(g.x*v.body.axisx+g.y*v.body.axisy),m=m.next}}var w=v.gverts.next;v.aabb.minx=w.x,v.aabb.miny=w.y,v.aabb.maxx=w.x,v.aabb.maxy=w.y;for(var M=v.gverts.next.next;null!=M;){var C=M;C.x<v.aabb.minx&&(v.aabb.minx=C.x),C.x>v.aabb.maxx&&(v.aabb.maxx=C.x),C.y<v.aabb.miny&&(v.aabb.miny=C.y),C.y>v.aabb.maxy&&(v.aabb.maxy=C.y),M=M.next}}},Lt.prototype.sync_broadphase=function(){if(this.space.validation(),null!=this.list)for(var n=this.list.next;null!=n;){var e=n.next,t=n.prev;if(n.aabb.minx>t.aabb.minx)n=e;else{for(;null!=t.prev&&t.prev.aabb.minx>n.aabb.minx;)t=t.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==t.prev?(n.prev=null,this.list=n,n.next=t,t.prev=n):(n.prev=t.prev,t.prev=n,n.prev.next=n,n.next=t),n=e}}},Lt.prototype.sync_broadphase_fast=function(){for(var n=this.list.next;null!=n;){var e=n.next,t=n.prev;if(n.aabb.minx>t.aabb.minx)n=e;else{for(;null!=t.prev&&t.prev.aabb.minx>n.aabb.minx;)t=t.prev;var i=n.prev;i.next=n.next,null!=n.next&&(n.next.prev=i),null==t.prev?(n.prev=null,this.list=n,n.next=t,t.prev=n):(n.prev=t.prev,t.prev=n,n.prev.next=n,n.next=t),n=e}}},Lt.prototype.broadphase=function(n,e){if(null!=this.list){for(var t=this.list.next;null!=t;){var i=t.next,p=t.prev;if(t.aabb.minx>p.aabb.minx)t=i;else{for(;null!=p.prev&&p.prev.aabb.minx>t.aabb.minx;)p=p.prev;var l=t.prev;l.next=t.next,null!=t.next&&(t.next.prev=l),null==p.prev?(t.prev=null,this.list=t,t.next=p,p.prev=t):(t.prev=p.prev,p.prev=t,t.prev.next=t,t.next=p),t=i}}for(var r=this.list;null!=r;){for(var o=r.next,a=r.shape,s=a.body,_=r.aabb.maxx;null!=o&&!(o.aabb.minx>_);){var h=o.shape,u=h.body;if(u!=s)if(1!=s.type||1!=u.type)if(s.component.sleeping&&u.component.sleeping)o=o.next;else{var x=a.aabb,d=h.aabb;d.miny>x.maxy||x.miny>d.maxy||(e?n.narrowPhase(a,h,2!=s.type||2!=u.type,null,!1):n.continuousEvent(a,h,2!=s.type||2!=u.type,null,!1)),o=o.next}else o=o.next;else o=o.next}r=r.next}}},Lt.prototype.clear=function(){for(;null!=this.list;)this.list.shape.removedFromSpace(),this.__remove(this.list.shape)},Lt.prototype.shapesUnderPoint=function(n,e,t,i){var p;this.sync_broadphase(),null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=e;for(var l=p,r=null==i?new Bn:i,o=this.list;null!=o&&o.aabb.minx>n;)o=o.next;for(;null!=o&&o.aabb.minx<=n;){if(o.aabb.maxx>=n&&o.aabb.miny<=e&&o.aabb.maxy>=e){var a,s=o.shape;if(null!=t){var _=s.filter;a=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else a=!0;a&&(0==s.type?Le.circleContains(s.circle,l)&&r.push(s.outer):Le.polyContains(s.polygon,l)&&r.push(s.outer))}o=o.next}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=xt.zpp_pool,xt.zpp_pool=l,r},Lt.prototype.bodiesUnderPoint=function(n,e,t,i){var p;this.sync_broadphase(),null==xt.zpp_pool?p=new xt:(p=xt.zpp_pool,xt.zpp_pool=p.next,p.next=null),p.weak=!1,p._immutable=!1,p.x=n,p.y=e;for(var l=p,r=null==i?new wn:i,o=this.list;null!=o&&o.aabb.minx>n;)o=o.next;for(;null!=o&&o.aabb.minx<=n;){if(o.aabb.maxx>=n&&o.aabb.miny<=e&&o.aabb.maxy>=e){var a=o.shape,s=a.body.outer;if(!r.has(s)){var _;if(null!=t){var h=a.filter;_=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else _=!0;_&&(0==a.type?Le.circleContains(a.circle,l)&&r.push(s):Le.polyContains(a.polygon,l)&&r.push(s))}}o=o.next}return null!=l.outer&&(l.outer.zpp_inner=null,l.outer=null),l._isimmutable=null,l._validate=null,l._invalidate=null,l.next=xt.zpp_pool,xt.zpp_pool=l,r},Lt.prototype.shapesInAABB=function(n,e,t,i,p){this.sync_broadphase(),this.updateAABBShape(n);for(var l=this.aabbShape.zpp_inner.aabb,r=null==p?new Bn:p,o=this.list;null!=o&&o.aabb.maxx<l.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=l.maxx;){var a,s=o.shape;if(null!=i){var _=s.filter;a=0!=(_.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&_.collisionGroup)}else a=!0;if(a)if(e)if(t)Le.containTest(this.aabbShape.zpp_inner,s)&&r.push(s.outer);else{var h=o.aabb;if(h.minx>=l.minx&&h.miny>=l.miny&&h.maxx<=l.maxx&&h.maxy<=l.maxy)r.push(s.outer);else{var u=o.aabb;l.miny<=u.maxy&&u.miny<=l.maxy&&l.minx<=u.maxx&&u.minx<=l.maxx&&Le.testCollide_safe(s,this.aabbShape.zpp_inner)&&r.push(s.outer)}}else{var x;if(t){var d=o.aabb;x=d.minx>=l.minx&&d.miny>=l.miny&&d.maxx<=l.maxx&&d.maxy<=l.maxy}else{var y=o.aabb;x=l.miny<=y.maxy&&y.miny<=l.maxy&&l.minx<=y.maxx&&y.minx<=l.maxx}x&&r.push(s.outer)}o=o.next}return r},Lt.prototype.failed=null,Lt.prototype.bodiesInAABB=function(n,e,t,i,p){this.sync_broadphase(),this.updateAABBShape(n);var l=this.aabbShape.zpp_inner.aabb,r=null==p?new wn:p;null==this.failed&&(this.failed=new wn);for(var o=this.list;null!=o&&o.aabb.maxx<l.minx;)o=o.next;for(;null!=o&&o.aabb.minx<=l.maxx;){var a=o.shape,s=a.body.outer,_=o.aabb;if(l.miny<=_.maxy&&_.miny<=l.maxy&&l.minx<=_.maxx&&_.minx<=l.maxx){var h;if(null!=i){var u=a.filter;h=0!=(u.collisionMask&i.collisionGroup)&&0!=(i.collisionMask&u.collisionGroup)}else h=!0;if(h)if(e)if(t){if(!this.failed.has(s)){var x=Le.containTest(this.aabbShape.zpp_inner,a);!r.has(s)&&x?r.push(s):x||(r.remove(s),this.failed.push(s))}}else!r.has(s)&&Le.testCollide_safe(a,this.aabbShape.zpp_inner)&&r.push(s);else if(t){if(!this.failed.has(s)){var d=a.aabb,y=d.minx>=l.minx&&d.miny>=l.miny&&d.maxx<=l.maxx&&d.maxy<=l.maxy;!r.has(s)&&y?r.push(s):y||(r.remove(s),this.failed.push(s))}}else{var z;if(r.has(s))z=!1;else{var v=a.aabb;z=v.minx>=l.minx&&v.miny>=l.miny&&v.maxx<=l.maxx&&v.maxy<=l.maxy}z&&r.push(s)}}o=o.next}return this.failed.clear(),r},Lt.prototype.shapesInCircle=function(n,e,t,i,p,l){this.sync_broadphase(),this.updateCircShape(n,e,t);for(var r=this.circShape.zpp_inner.aabb,o=null==l?new Bn:l,a=this.list;null!=a&&a.aabb.maxx<r.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=r.maxx;){var s=a.aabb;if(r.miny<=s.maxy&&s.miny<=r.maxy&&r.minx<=s.maxx&&s.minx<=r.maxx){var _,h=a.shape;if(null!=p){var u=h.filter;_=0!=(u.collisionMask&p.collisionGroup)&&0!=(p.collisionMask&u.collisionGroup)}else _=!0;_&&(i?Le.containTest(this.circShape.zpp_inner,h)&&o.push(h.outer):Le.testCollide_safe(h,this.circShape.zpp_inner)&&o.push(h.outer))}a=a.next}return o},Lt.prototype.bodiesInCircle=function(n,e,t,i,p,l){this.sync_broadphase(),this.updateCircShape(n,e,t);var r=this.circShape.zpp_inner.aabb,o=null==l?new wn:l;null==this.failed&&(this.failed=new wn);for(var a=this.list;null!=a&&a.aabb.maxx<r.minx;)a=a.next;for(;null!=a&&a.aabb.minx<=r.maxx;){var s=a.aabb;if(r.miny<=s.maxy&&s.miny<=r.maxy&&r.minx<=s.maxx&&s.minx<=r.maxx){var _,h=a.shape,u=h.body.outer;if(null!=p){var x=h.filter;_=0!=(x.collisionMask&p.collisionGroup)&&0!=(p.collisionMask&x.collisionGroup)}else _=!0;if(_)if(i){if(!this.failed.has(u)){var d=Le.containTest(this.circShape.zpp_inner,h);!o.has(u)&&d?o.push(u):d||(o.remove(u),this.failed.push(u))}}else!o.has(u)&&Le.testCollide_safe(h,this.circShape.zpp_inner)&&o.push(u)}a=a.next}return this.failed.clear(),o},Lt.prototype.shapesInShape=function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);for(var p=n.aabb,l=null==i?new Bn:i,r=this.list;null!=r&&r.aabb.maxx<p.minx;)r=r.next;for(;null!=r&&r.aabb.minx<=p.maxx;){var o=r.aabb;if(p.miny<=o.maxy&&o.miny<=p.maxy&&p.minx<=o.maxx&&o.minx<=p.maxx){var a,s=r.shape;if(null!=t){var _=s.filter;a=0!=(_.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&_.collisionGroup)}else a=!0;a&&(e?Le.containTest(n,s)&&l.push(s.outer):Le.testCollide_safe(s,n)&&l.push(s.outer))}r=r.next}return l},Lt.prototype.bodiesInShape=function(n,e,t,i){this.sync_broadphase(),this.validateShape(n);var p=n.aabb,l=null==i?new wn:i;null==this.failed&&(this.failed=new wn);for(var r=this.list;null!=r&&r.aabb.maxx<p.minx;)r=r.next;for(;null!=r&&r.aabb.minx<=p.maxx;){var o=r.aabb;if(p.miny<=o.maxy&&o.miny<=p.maxy&&p.minx<=o.maxx&&o.minx<=p.maxx){var a,s=r.shape,_=s.body.outer;if(null!=t){var h=s.filter;a=0!=(h.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&h.collisionGroup)}else a=!0;if(a)if(e){if(!this.failed.has(_)){var u=Le.containTest(n,s);!l.has(_)&&u?l.push(_):u||(l.remove(_),this.failed.push(_))}}else!l.has(_)&&Le.testCollide_safe(n,s)&&l.push(_)}r=r.next}return this.failed.clear(),l},Lt.prototype.rayCast=function(n,e,t){this.sync_broadphase(),n.validate_dir();var i=n.rayAABB(),p=n.maxdist,l=null;if(0==n.dirx)for(var r=this.list;null!=r&&r.aabb.minx<=i.minx;){var o,a=r.aabb;if(i.miny<=a.maxy&&a.miny<=i.maxy&&i.minx<=a.maxx&&a.minx<=i.maxx)if(null!=t){var s=r.shape.filter;o=0!=(s.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&s.collisionGroup)}else o=!0;else o=!1;if(o){var _=n.aabbsect(r.aabb);if(_>=0&&_<p){var h=0==r.shape.type?n.circlesect(r.shape.circle,e,p):n.polysect(r.shape.polygon,e,p);null!=h&&(p=h.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=h)}}r=r.next}else if(n.dirx<0){for(var u=this.list,x=null;null!=u&&u.aabb.minx<=i.maxx;)x=u,u=u.next;for(u=x;null!=u;){var d,y=u.aabb;if(i.miny<=y.maxy&&y.miny<=i.maxy&&i.minx<=y.maxx&&y.minx<=i.maxx)if(null!=t){var z=u.shape.filter;d=0!=(z.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&z.collisionGroup)}else d=!0;else d=!1;if(d){var v=n.aabbsect(u.aabb);if(v>=0&&v<p){var c=0==u.shape.type?n.circlesect(u.shape.circle,e,p):n.polysect(u.shape.polygon,e,p);null!=c&&(p=c.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=c)}}u=u.prev}}else for(var f=this.list;null!=f&&f.aabb.minx<=i.maxx&&f.aabb.minx<n.originx+n.dirx*p;){var m,b=f.aabb;if(i.miny<=b.maxy&&b.miny<=i.maxy&&i.minx<=b.maxx&&b.minx<=i.maxx)if(null!=t){var g=f.shape.filter;m=0!=(g.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&g.collisionGroup)}else m=!0;else m=!1;if(m){var w=n.aabbsect(f.aabb);if(w>=0&&w<p){var M=0==f.shape.type?n.circlesect(f.shape.circle,e,p):n.polysect(f.shape.polygon,e,p);null!=M&&(p=M.zpp_inner.toiDistance,null!=l&&l.zpp_inner.free(),l=M)}}f=f.next}return null!=i.outer&&(i.outer.zpp_inner=null,i.outer=null),i.wrap_min=i.wrap_max=null,i._invalidate=null,i._validate=null,i.next=Te.zpp_pool,Te.zpp_pool=i,l},Lt.prototype.rayMultiCast=function(n,e,t,i){this.sync_broadphase(),n.validate_dir();var p=n.rayAABB(),l=null==i?new dn:i;if(0==n.dirx)for(var r=this.list;null!=r&&r.aabb.minx<=p.minx;){var o,a=r.aabb;if(p.miny<=a.maxy&&a.miny<=p.maxy&&p.minx<=a.maxx&&a.minx<=p.maxx)if(null!=t){var s=r.shape.filter;o=0!=(s.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&s.collisionGroup)}else o=!0;else o=!1;o&&n.aabbsect(r.aabb)>=0&&(0==r.shape.type?n.circlesect2(r.shape.circle,e,l):n.polysect2(r.shape.polygon,e,l)),r=r.next}else if(n.dirx<0){for(var _=this.list,h=null;null!=_&&_.aabb.minx<=p.maxx;)h=_,_=_.next;for(_=h;null!=_;){var u,x=_.aabb;if(p.miny<=x.maxy&&x.miny<=p.maxy&&p.minx<=x.maxx&&x.minx<=p.maxx)if(null!=t){var d=_.shape.filter;u=0!=(d.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&d.collisionGroup)}else u=!0;else u=!1;u&&n.aabbsect(_.aabb)>=0&&(0==_.shape.type?n.circlesect2(_.shape.circle,e,l):n.polysect2(_.shape.polygon,e,l)),_=_.prev}}else for(var y=this.list;null!=y&&y.aabb.minx<=p.maxx;){var z,v=y.aabb;if(p.miny<=v.maxy&&v.miny<=p.maxy&&p.minx<=v.maxx&&v.minx<=p.maxx)if(null!=t){var c=y.shape.filter;z=0!=(c.collisionMask&t.collisionGroup)&&0!=(t.collisionMask&c.collisionGroup)}else z=!0;else z=!1;z&&n.aabbsect(y.aabb)>=0&&(0==y.shape.type?n.circlesect2(y.shape.circle,e,l):n.polysect2(y.shape.polygon,e,l)),y=y.next}return null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p.wrap_min=p.wrap_max=null,p._invalidate=null,p._validate=null,p.next=Te.zpp_pool,Te.zpp_pool=p,l},Lt.prototype.__class__=Lt;var Vt=zpp_nape.util.ZNPArray2_Float=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};Vt.__name__=["zpp_nape","util","ZNPArray2_Float"],Vt.prototype.list=null,Vt.prototype.width=null,Vt.prototype.resize=function(n,e,t){this.width=n;for(var i=0,p=n*e;i<p;)this.list[i++]=t},Vt.prototype.get=function(n,e){return this.list[e*this.width+n]},Vt.prototype.set=function(n,e,t){return this.list[e*this.width+n]=t},Vt.prototype.__class__=Vt;var Dt=zpp_nape.util.ZNPArray2_ZPP_GeomVert=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};Dt.__name__=["zpp_nape","util","ZNPArray2_ZPP_GeomVert"],Dt.prototype.list=null,Dt.prototype.width=null,Dt.prototype.resize=function(n,e,t){this.width=n;for(var i=0,p=n*e;i<p;)this.list[i++]=t},Dt.prototype.get=function(n,e){return this.list[e*this.width+n]},Dt.prototype.set=function(n,e,t){return this.list[e*this.width+n]=t},Dt.prototype.__class__=Dt;var Ft=zpp_nape.util.ZNPArray2_ZPP_MarchPair=function(n,e){this.width=0,this.list=null,this.width=n,this.list=[]};Ft.__name__=["zpp_nape","util","ZNPArray2_ZPP_MarchPair"],Ft.prototype.list=null,Ft.prototype.width=null,Ft.prototype.resize=function(n,e,t){this.width=n;for(var i=0,p=n*e;i<p;)this.list[i++]=t},Ft.prototype.get=function(n,e){return this.list[e*this.width+n]},Ft.prototype.set=function(n,e,t){return this.list[e*this.width+n]=t},Ft.prototype.__class__=Ft;var Rt=zpp_nape.util.Hashable2_Boolfalse=function(){this.di=0,this.id=0,this.hnext=null,this.next=null,this.value=!1};Rt.__name__=["zpp_nape","util","Hashable2_Boolfalse"],Rt.get=function(n,e,t){var i;null==Rt.zpp_pool?i=new Rt:(i=Rt.zpp_pool,Rt.zpp_pool=i.next,i.next=null),i.id=n,i.di=e;var p=i;return p.value=t,p},Rt.getpersist=function(n,e){var t;return null==Rt.zpp_pool?t=new Rt:(t=Rt.zpp_pool,Rt.zpp_pool=t.next,t.next=null),t.id=n,t.di=e,t},Rt.ordered_get=function(n,e,t){if(n<=e){var i;null==Rt.zpp_pool?i=new Rt:(i=Rt.zpp_pool,Rt.zpp_pool=i.next,i.next=null),i.id=n,i.di=e;var p=i;return p.value=t,p}var l;null==Rt.zpp_pool?l=new Rt:(l=Rt.zpp_pool,Rt.zpp_pool=l.next,l.next=null),l.id=e,l.di=n;var r=l;return r.value=t,r},Rt.ordered_get_persist=function(n,e){var t,i;return n<=e?(null==Rt.zpp_pool?t=new Rt:(t=Rt.zpp_pool,Rt.zpp_pool=t.next,t.next=null),t.id=n,t.di=e,t):(null==Rt.zpp_pool?i=new Rt:(i=Rt.zpp_pool,Rt.zpp_pool=i.next,i.next=null),i.id=e,i.di=n,i)},Rt.prototype.value=null,Rt.prototype.next=null,Rt.prototype.hnext=null,Rt.prototype.id=null,Rt.prototype.di=null,Rt.prototype.free=function(){},Rt.prototype.alloc=function(){},Rt.prototype.__class__=Rt;var Zt=zpp_nape.util.FastHash2_Hashable2_Boolfalse=function(){this.cnt=0,this.table=null,this.cnt=0,this.table=[];for(var n=0;n<1048576;)++n,this.table.push(null)};Zt.__name__=["zpp_nape","util","FastHash2_Hashable2_Boolfalse"],Zt.prototype.table=null,Zt.prototype.cnt=null,Zt.prototype.empty=function(){return 0==this.cnt},Zt.prototype.clear=function(){for(var n=0,e=this.table.length;n<e;){var t=n++,i=this.table[t];if(null!=i){for(;null!=i;){var p=i.hnext;i.hnext=null,i=p}this.table[t]=null}}},Zt.prototype.get=function(n,e){var t=this.table[106039*n+e&1048575];if(null==t)return null;if(t.id==n&&t.di==e)return t;for(;null!=(t=t.hnext)&&(t.id!=n||t.di!=e););return t},Zt.prototype.ordered_get=function(n,e){if(n>e){var t=n;n=e,e=t}var i=this.table[106039*n+e&1048575];if(null==i)return null;if(i.id==n&&i.di==e)return i;for(;null!=(i=i.hnext)&&(i.id!=n||i.di!=e););return i},Zt.prototype.has=function(n,e){var t=this.table[106039*n+e&1048575];if(null==t)return!1;if(t.id==n&&t.di==e)return!0;for(;null!=(t=t.hnext)&&(t.id!=n||t.di!=e););return null!=t},Zt.prototype.maybeAdd=function(n){var e=106039*n.id+n.di&1048575,t=this.table[e];null==t?(this.table[e]=n,n.hnext=null):(n.hnext=t.hnext,t.hnext=n),this.cnt++},Zt.prototype.add=function(n){var e=106039*n.id+n.di&1048575,t=this.table[e];null==t?(this.table[e]=n,n.hnext=null):(n.hnext=t.hnext,t.hnext=n),this.cnt++},Zt.prototype.remove=function(n){var e=106039*n.id+n.di&1048575,t=this.table[e];if(t==n)this.table[e]=t.hnext;else if(null!=t){for(var i;i=t,null!=(t=t.hnext)&&t!=n;);i.hnext=t.hnext}n.hnext=null,this.cnt--},Zt.prototype.hash=function(n,e){return 106039*n+e&1048575},Zt.prototype.__class__=Zt;var Bt=zpp_nape.util.ZNPList_ZPP_CallbackSet=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Bt.__name__=["zpp_nape","util","ZNPList_ZPP_CallbackSet"],Bt.prototype.head=null,Bt.prototype.begin=function(){return this.head},Bt.prototype.modified=null,Bt.prototype.pushmod=null,Bt.prototype.length=null,Bt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Bt.prototype.add=function(n){var e;null==zi.zpp_pool?e=new zi:(e=zi.zpp_pool,zi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Bt.prototype.inlined_add=function(n){var e;null==zi.zpp_pool?e=new zi:(e=zi.zpp_pool,zi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Bt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Bt.prototype.insert=function(n,e){var t;null==zi.zpp_pool?t=new zi:(t=zi.zpp_pool,zi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Bt.prototype.inlined_insert=function(n,e){var t;null==zi.zpp_pool?t=new zi:(t=zi.zpp_pool,zi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Bt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Bt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Bt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Bt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Bt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=zi.zpp_pool,zi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Bt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Bt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=zi.zpp_pool,zi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Bt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=zi.zpp_pool,zi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Bt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=zi.zpp_pool,zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Bt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=zi.zpp_pool,zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Bt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Bt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Bt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=zi.zpp_pool,zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Bt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Bt.prototype.empty=function(){return null==this.head},Bt.prototype.size=function(){return this.length},Bt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Bt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Bt.prototype.front=function(){return this.head.elt},Bt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Bt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Bt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Bt.prototype.__class__=Bt;var Gt=zpp_nape.util.ZNPList_ZPP_Shape=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Gt.__name__=["zpp_nape","util","ZNPList_ZPP_Shape"],Gt.prototype.head=null,Gt.prototype.begin=function(){return this.head},Gt.prototype.modified=null,Gt.prototype.pushmod=null,Gt.prototype.length=null,Gt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Gt.prototype.add=function(n){var e;null==vi.zpp_pool?e=new vi:(e=vi.zpp_pool,vi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Gt.prototype.inlined_add=function(n){var e;null==vi.zpp_pool?e=new vi:(e=vi.zpp_pool,vi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Gt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Gt.prototype.insert=function(n,e){var t;null==vi.zpp_pool?t=new vi:(t=vi.zpp_pool,vi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Gt.prototype.inlined_insert=function(n,e){var t;null==vi.zpp_pool?t=new vi:(t=vi.zpp_pool,vi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Gt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Gt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Gt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Gt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Gt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=vi.zpp_pool,vi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Gt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Gt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=vi.zpp_pool,vi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Gt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=vi.zpp_pool,vi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Gt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=vi.zpp_pool,vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Gt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=vi.zpp_pool,vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Gt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Gt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Gt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=vi.zpp_pool,vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Gt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Gt.prototype.empty=function(){return null==this.head},Gt.prototype.size=function(){return this.length},Gt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Gt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Gt.prototype.front=function(){return this.head.elt},Gt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Gt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Gt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Gt.prototype.__class__=Gt;var qt=zpp_nape.util.ZNPList_ZPP_Body=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};qt.__name__=["zpp_nape","util","ZNPList_ZPP_Body"],qt.prototype.head=null,qt.prototype.begin=function(){return this.head},qt.prototype.modified=null,qt.prototype.pushmod=null,qt.prototype.length=null,qt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},qt.prototype.add=function(n){var e;null==ci.zpp_pool?e=new ci:(e=ci.zpp_pool,ci.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},qt.prototype.inlined_add=function(n){var e;null==ci.zpp_pool?e=new ci:(e=ci.zpp_pool,ci.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},qt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},qt.prototype.insert=function(n,e){var t;null==ci.zpp_pool?t=new ci:(t=ci.zpp_pool,ci.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},qt.prototype.inlined_insert=function(n,e){var t;null==ci.zpp_pool?t=new ci:(t=ci.zpp_pool,ci.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},qt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},qt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},qt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},qt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},qt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=ci.zpp_pool,ci.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},qt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},qt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=ci.zpp_pool,ci.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},qt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=ci.zpp_pool,ci.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},qt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ci.zpp_pool,ci.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},qt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ci.zpp_pool,ci.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},qt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},qt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},qt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ci.zpp_pool,ci.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},qt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},qt.prototype.empty=function(){return null==this.head},qt.prototype.size=function(){return this.length},qt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},qt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},qt.prototype.front=function(){return this.head.elt},qt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},qt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},qt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},qt.prototype.__class__=qt;var Ut=zpp_nape.util.ZNPList_ZPP_Compound=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ut.__name__=["zpp_nape","util","ZNPList_ZPP_Compound"],Ut.prototype.head=null,Ut.prototype.begin=function(){return this.head},Ut.prototype.modified=null,Ut.prototype.pushmod=null,Ut.prototype.length=null,Ut.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ut.prototype.add=function(n){var e;null==mi.zpp_pool?e=new mi:(e=mi.zpp_pool,mi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ut.prototype.inlined_add=function(n){var e;null==mi.zpp_pool?e=new mi:(e=mi.zpp_pool,mi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ut.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Ut.prototype.insert=function(n,e){var t;null==mi.zpp_pool?t=new mi:(t=mi.zpp_pool,mi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ut.prototype.inlined_insert=function(n,e){var t;null==mi.zpp_pool?t=new mi:(t=mi.zpp_pool,mi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ut.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ut.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ut.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ut.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ut.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=mi.zpp_pool,mi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ut.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Ut.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=mi.zpp_pool,mi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ut.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=mi.zpp_pool,mi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Ut.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=mi.zpp_pool,mi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Ut.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=mi.zpp_pool,mi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Ut.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Ut.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ut.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=mi.zpp_pool,mi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ut.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Ut.prototype.empty=function(){return null==this.head},Ut.prototype.size=function(){return this.length},Ut.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Ut.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Ut.prototype.front=function(){return this.head.elt},Ut.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Ut.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Ut.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Ut.prototype.__class__=Ut;var Kt=zpp_nape.util.ZNPList_ZPP_Arbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Kt.__name__=["zpp_nape","util","ZNPList_ZPP_Arbiter"],Kt.prototype.head=null,Kt.prototype.begin=function(){return this.head},Kt.prototype.modified=null,Kt.prototype.pushmod=null,Kt.prototype.length=null,Kt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Kt.prototype.add=function(n){var e;null==bi.zpp_pool?e=new bi:(e=bi.zpp_pool,bi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Kt.prototype.inlined_add=function(n){var e;null==bi.zpp_pool?e=new bi:(e=bi.zpp_pool,bi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Kt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Kt.prototype.insert=function(n,e){var t;null==bi.zpp_pool?t=new bi:(t=bi.zpp_pool,bi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Kt.prototype.inlined_insert=function(n,e){var t;null==bi.zpp_pool?t=new bi:(t=bi.zpp_pool,bi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Kt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=bi.zpp_pool,bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Kt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=bi.zpp_pool,bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Kt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Kt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Kt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=bi.zpp_pool,bi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Kt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Kt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=bi.zpp_pool,bi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Kt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=bi.zpp_pool,bi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Kt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=bi.zpp_pool,bi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Kt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=bi.zpp_pool,bi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Kt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Kt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=bi.zpp_pool,bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Kt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=bi.zpp_pool,bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Kt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Kt.prototype.empty=function(){return null==this.head},Kt.prototype.size=function(){return this.length},Kt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Kt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Kt.prototype.front=function(){return this.head.elt},Kt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Kt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Kt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Kt.prototype.__class__=Kt;var Wt=zpp_nape.util.ZNPList_ZPP_CbSetPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Wt.__name__=["zpp_nape","util","ZNPList_ZPP_CbSetPair"],Wt.prototype.head=null,Wt.prototype.begin=function(){return this.head},Wt.prototype.modified=null,Wt.prototype.pushmod=null,Wt.prototype.length=null,Wt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Wt.prototype.add=function(n){var e;null==ki.zpp_pool?e=new ki:(e=ki.zpp_pool,ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Wt.prototype.inlined_add=function(n){var e;null==ki.zpp_pool?e=new ki:(e=ki.zpp_pool,ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Wt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Wt.prototype.insert=function(n,e){var t;null==ki.zpp_pool?t=new ki:(t=ki.zpp_pool,ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Wt.prototype.inlined_insert=function(n,e){var t;null==ki.zpp_pool?t=new ki:(t=ki.zpp_pool,ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Wt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ki.zpp_pool,ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Wt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ki.zpp_pool,ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Wt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Wt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Wt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=ki.zpp_pool,ki.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Wt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Wt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=ki.zpp_pool,ki.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Wt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=ki.zpp_pool,ki.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Wt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ki.zpp_pool,ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Wt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ki.zpp_pool,ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Wt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Wt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ki.zpp_pool,ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Wt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ki.zpp_pool,ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Wt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Wt.prototype.empty=function(){return null==this.head},Wt.prototype.size=function(){return this.length},Wt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Wt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Wt.prototype.front=function(){return this.head.elt},Wt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Wt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Wt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Wt.prototype.__class__=Wt;var Yt=zpp_nape.util.ZNPList_ZPP_CutInt=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Yt.__name__=["zpp_nape","util","ZNPList_ZPP_CutInt"],Yt.prototype.head=null,Yt.prototype.begin=function(){return this.head},Yt.prototype.modified=null,Yt.prototype.pushmod=null,Yt.prototype.length=null,Yt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Yt.prototype.add=function(n){var e;null==Pi.zpp_pool?e=new Pi:(e=Pi.zpp_pool,Pi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Yt.prototype.inlined_add=function(n){var e;null==Pi.zpp_pool?e=new Pi:(e=Pi.zpp_pool,Pi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Yt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Yt.prototype.insert=function(n,e){var t;null==Pi.zpp_pool?t=new Pi:(t=Pi.zpp_pool,Pi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Yt.prototype.inlined_insert=function(n,e){var t;null==Pi.zpp_pool?t=new Pi:(t=Pi.zpp_pool,Pi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Yt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Pi.zpp_pool,Pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Yt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Pi.zpp_pool,Pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Yt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Yt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Yt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Pi.zpp_pool,Pi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Yt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Yt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Pi.zpp_pool,Pi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Yt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Pi.zpp_pool,Pi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Yt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Pi.zpp_pool,Pi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Yt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Pi.zpp_pool,Pi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Yt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Yt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Pi.zpp_pool,Pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Yt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Pi.zpp_pool,Pi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Yt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Yt.prototype.empty=function(){return null==this.head},Yt.prototype.size=function(){return this.length},Yt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Yt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Yt.prototype.front=function(){return this.head.elt},Yt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Yt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Yt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Yt.prototype.__class__=Yt;var Jt=zpp_nape.util.ZNPList_ZPP_CutVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Jt.__name__=["zpp_nape","util","ZNPList_ZPP_CutVert"],Jt.prototype.head=null,Jt.prototype.begin=function(){return this.head},Jt.prototype.modified=null,Jt.prototype.pushmod=null,Jt.prototype.length=null,Jt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Jt.prototype.add=function(n){var e;null==Si.zpp_pool?e=new Si:(e=Si.zpp_pool,Si.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Jt.prototype.inlined_add=function(n){var e;null==Si.zpp_pool?e=new Si:(e=Si.zpp_pool,Si.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Jt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Jt.prototype.insert=function(n,e){var t;null==Si.zpp_pool?t=new Si:(t=Si.zpp_pool,Si.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Jt.prototype.inlined_insert=function(n,e){var t;null==Si.zpp_pool?t=new Si:(t=Si.zpp_pool,Si.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Jt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Si.zpp_pool,Si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Jt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Si.zpp_pool,Si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Jt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Jt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Jt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Si.zpp_pool,Si.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Jt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Jt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Si.zpp_pool,Si.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Jt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Si.zpp_pool,Si.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Jt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Si.zpp_pool,Si.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Jt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Si.zpp_pool,Si.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Jt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Jt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Si.zpp_pool,Si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Jt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Si.zpp_pool,Si.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Jt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Jt.prototype.empty=function(){return null==this.head},Jt.prototype.size=function(){return this.length},Jt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Jt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Jt.prototype.front=function(){return this.head.elt},Jt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Jt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Jt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Jt.prototype.__class__=Jt;var Xt=zpp_nape.util.ZNPList_ZPP_PartitionVertex=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Xt.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionVertex"],Xt.prototype.head=null,Xt.prototype.begin=function(){return this.head},Xt.prototype.modified=null,Xt.prototype.pushmod=null,Xt.prototype.length=null,Xt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Xt.prototype.add=function(n){var e;null==Ai.zpp_pool?e=new Ai:(e=Ai.zpp_pool,Ai.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Xt.prototype.inlined_add=function(n){var e;null==Ai.zpp_pool?e=new Ai:(e=Ai.zpp_pool,Ai.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Xt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Xt.prototype.insert=function(n,e){var t;null==Ai.zpp_pool?t=new Ai:(t=Ai.zpp_pool,Ai.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Xt.prototype.inlined_insert=function(n,e){var t;null==Ai.zpp_pool?t=new Ai:(t=Ai.zpp_pool,Ai.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Xt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ai.zpp_pool,Ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Xt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ai.zpp_pool,Ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Xt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Xt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Xt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ai.zpp_pool,Ai.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Xt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Xt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ai.zpp_pool,Ai.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Xt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ai.zpp_pool,Ai.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Xt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ai.zpp_pool,Ai.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Xt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ai.zpp_pool,Ai.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Xt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Xt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ai.zpp_pool,Ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Xt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ai.zpp_pool,Ai.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Xt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Xt.prototype.empty=function(){return null==this.head},Xt.prototype.size=function(){return this.length},Xt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Xt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Xt.prototype.front=function(){return this.head.elt},Xt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Xt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Xt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Xt.prototype.__class__=Xt;var Ht=zpp_nape.util.ZNPList_ZPP_SimplifyP=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Ht.__name__=["zpp_nape","util","ZNPList_ZPP_SimplifyP"],Ht.prototype.head=null,Ht.prototype.begin=function(){return this.head},Ht.prototype.modified=null,Ht.prototype.pushmod=null,Ht.prototype.length=null,Ht.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Ht.prototype.add=function(n){var e;null==ji.zpp_pool?e=new ji:(e=ji.zpp_pool,ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ht.prototype.inlined_add=function(n){var e;null==ji.zpp_pool?e=new ji:(e=ji.zpp_pool,ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Ht.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Ht.prototype.insert=function(n,e){var t;null==ji.zpp_pool?t=new ji:(t=ji.zpp_pool,ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ht.prototype.inlined_insert=function(n,e){var t;null==ji.zpp_pool?t=new ji:(t=ji.zpp_pool,ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Ht.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ji.zpp_pool,ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ht.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=ji.zpp_pool,ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Ht.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ht.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Ht.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=ji.zpp_pool,ji.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ht.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Ht.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=ji.zpp_pool,ji.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Ht.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=ji.zpp_pool,ji.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Ht.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ji.zpp_pool,ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Ht.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=ji.zpp_pool,ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Ht.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Ht.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ji.zpp_pool,ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ht.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=ji.zpp_pool,ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Ht.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Ht.prototype.empty=function(){return null==this.head},Ht.prototype.size=function(){return this.length},Ht.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Ht.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Ht.prototype.front=function(){return this.head.elt},Ht.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Ht.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Ht.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Ht.prototype.__class__=Ht;var $t=zpp_nape.util.ZNPList_ZPP_PartitionedPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};$t.__name__=["zpp_nape","util","ZNPList_ZPP_PartitionedPoly"],$t.prototype.head=null,$t.prototype.begin=function(){return this.head},$t.prototype.modified=null,$t.prototype.pushmod=null,$t.prototype.length=null,$t.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},$t.prototype.add=function(n){var e;null==Ei.zpp_pool?e=new Ei:(e=Ei.zpp_pool,Ei.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},$t.prototype.inlined_add=function(n){var e;null==Ei.zpp_pool?e=new Ei:(e=Ei.zpp_pool,Ei.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},$t.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},$t.prototype.insert=function(n,e){var t;null==Ei.zpp_pool?t=new Ei:(t=Ei.zpp_pool,Ei.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},$t.prototype.inlined_insert=function(n,e){var t;null==Ei.zpp_pool?t=new Ei:(t=Ei.zpp_pool,Ei.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},$t.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ei.zpp_pool,Ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},$t.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ei.zpp_pool,Ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},$t.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},$t.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},$t.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ei.zpp_pool,Ei.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},$t.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},$t.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ei.zpp_pool,Ei.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},$t.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ei.zpp_pool,Ei.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},$t.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ei.zpp_pool,Ei.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},$t.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ei.zpp_pool,Ei.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},$t.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},$t.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ei.zpp_pool,Ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},$t.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ei.zpp_pool,Ei.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},$t.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},$t.prototype.empty=function(){return null==this.head},$t.prototype.size=function(){return this.length},$t.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},$t.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},$t.prototype.front=function(){return this.head.elt},$t.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},$t.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},$t.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},$t.prototype.__class__=$t;var Qt=zpp_nape.util.ZNPList_ZPP_GeomVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};Qt.__name__=["zpp_nape","util","ZNPList_ZPP_GeomVert"],Qt.prototype.head=null,Qt.prototype.begin=function(){return this.head},Qt.prototype.modified=null,Qt.prototype.pushmod=null,Qt.prototype.length=null,Qt.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},Qt.prototype.add=function(n){var e;null==Ii.zpp_pool?e=new Ii:(e=Ii.zpp_pool,Ii.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Qt.prototype.inlined_add=function(n){var e;null==Ii.zpp_pool?e=new Ii:(e=Ii.zpp_pool,Ii.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},Qt.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},Qt.prototype.insert=function(n,e){var t;null==Ii.zpp_pool?t=new Ii:(t=Ii.zpp_pool,Ii.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Qt.prototype.inlined_insert=function(n,e){var t;null==Ii.zpp_pool?t=new Ii:(t=Ii.zpp_pool,Ii.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},Qt.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ii.zpp_pool,Ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Qt.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ii.zpp_pool,Ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},Qt.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Qt.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},Qt.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ii.zpp_pool,Ii.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Qt.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},Qt.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ii.zpp_pool,Ii.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},Qt.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ii.zpp_pool,Ii.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},Qt.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ii.zpp_pool,Ii.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Qt.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ii.zpp_pool,Ii.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},Qt.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},Qt.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ii.zpp_pool,Ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Qt.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ii.zpp_pool,Ii.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},Qt.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},Qt.prototype.empty=function(){return null==this.head},Qt.prototype.size=function(){return this.length},Qt.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Qt.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},Qt.prototype.front=function(){return this.head.elt},Qt.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},Qt.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},Qt.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},Qt.prototype.__class__=Qt;var ni=zpp_nape.util.ZNPList_ZPP_SimpleVert=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ni.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleVert"],ni.prototype.head=null,ni.prototype.begin=function(){return this.head},ni.prototype.modified=null,ni.prototype.pushmod=null,ni.prototype.length=null,ni.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ni.prototype.add=function(n){var e;null==Ti.zpp_pool?e=new Ti:(e=Ti.zpp_pool,Ti.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ni.prototype.inlined_add=function(n){var e;null==Ti.zpp_pool?e=new Ti:(e=Ti.zpp_pool,Ti.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ni.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ni.prototype.insert=function(n,e){var t;null==Ti.zpp_pool?t=new Ti:(t=Ti.zpp_pool,Ti.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ni.prototype.inlined_insert=function(n,e){var t;null==Ti.zpp_pool?t=new Ti:(t=Ti.zpp_pool,Ti.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ni.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ti.zpp_pool,Ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ni.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ti.zpp_pool,Ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ni.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ni.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ni.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ti.zpp_pool,Ti.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ni.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ni.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ti.zpp_pool,Ti.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ni.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ti.zpp_pool,Ti.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ni.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ti.zpp_pool,Ti.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ni.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ti.zpp_pool,Ti.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ni.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ni.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ti.zpp_pool,Ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ni.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ti.zpp_pool,Ti.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ni.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ni.prototype.empty=function(){return null==this.head},ni.prototype.size=function(){return this.length},ni.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ni.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ni.prototype.front=function(){return this.head.elt},ni.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ni.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ni.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ni.prototype.__class__=ni;var ei=zpp_nape.util.ZNPList_ZPP_SimpleEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ei.__name__=["zpp_nape","util","ZNPList_ZPP_SimpleEvent"],ei.prototype.head=null,ei.prototype.begin=function(){return this.head},ei.prototype.modified=null,ei.prototype.pushmod=null,ei.prototype.length=null,ei.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ei.prototype.add=function(n){var e;null==Ni.zpp_pool?e=new Ni:(e=Ni.zpp_pool,Ni.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ei.prototype.inlined_add=function(n){var e;null==Ni.zpp_pool?e=new Ni:(e=Ni.zpp_pool,Ni.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ei.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ei.prototype.insert=function(n,e){var t;null==Ni.zpp_pool?t=new Ni:(t=Ni.zpp_pool,Ni.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ei.prototype.inlined_insert=function(n,e){var t;null==Ni.zpp_pool?t=new Ni:(t=Ni.zpp_pool,Ni.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ei.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ni.zpp_pool,Ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ei.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ni.zpp_pool,Ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ei.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ei.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ei.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ni.zpp_pool,Ni.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ei.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ei.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ni.zpp_pool,Ni.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ei.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ni.zpp_pool,Ni.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ei.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ni.zpp_pool,Ni.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ei.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ni.zpp_pool,Ni.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ei.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ei.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ni.zpp_pool,Ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ei.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ni.zpp_pool,Ni.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ei.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ei.prototype.empty=function(){return null==this.head},ei.prototype.size=function(){return this.length},ei.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ei.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ei.prototype.front=function(){return this.head.elt},ei.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ei.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ei.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ei.prototype.__class__=ei;var ti=zpp_nape.util.ZNPList_ZPP_AABBPair=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ti.__name__=["zpp_nape","util","ZNPList_ZPP_AABBPair"],ti.prototype.head=null,ti.prototype.begin=function(){return this.head},ti.prototype.modified=null,ti.prototype.pushmod=null,ti.prototype.length=null,ti.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ti.prototype.add=function(n){var e;null==Vi.zpp_pool?e=new Vi:(e=Vi.zpp_pool,Vi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ti.prototype.inlined_add=function(n){var e;null==Vi.zpp_pool?e=new Vi:(e=Vi.zpp_pool,Vi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ti.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ti.prototype.insert=function(n,e){var t;null==Vi.zpp_pool?t=new Vi:(t=Vi.zpp_pool,Vi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ti.prototype.inlined_insert=function(n,e){var t;null==Vi.zpp_pool?t=new Vi:(t=Vi.zpp_pool,Vi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ti.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Vi.zpp_pool,Vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ti.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Vi.zpp_pool,Vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ti.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ti.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ti.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Vi.zpp_pool,Vi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ti.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ti.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Vi.zpp_pool,Vi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ti.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Vi.zpp_pool,Vi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ti.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Vi.zpp_pool,Vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ti.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Vi.zpp_pool,Vi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ti.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ti.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Vi.zpp_pool,Vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ti.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Vi.zpp_pool,Vi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ti.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ti.prototype.empty=function(){return null==this.head},ti.prototype.size=function(){return this.length},ti.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ti.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ti.prototype.front=function(){return this.head.elt},ti.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ti.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ti.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ti.prototype.__class__=ti;var ii=zpp_nape.util.ZNPList_ZPP_Edge=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ii.__name__=["zpp_nape","util","ZNPList_ZPP_Edge"],ii.prototype.head=null,ii.prototype.begin=function(){return this.head},ii.prototype.modified=null,ii.prototype.pushmod=null,ii.prototype.length=null,ii.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ii.prototype.add=function(n){var e;null==Di.zpp_pool?e=new Di:(e=Di.zpp_pool,Di.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ii.prototype.inlined_add=function(n){var e;null==Di.zpp_pool?e=new Di:(e=Di.zpp_pool,Di.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ii.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ii.prototype.insert=function(n,e){var t;null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ii.prototype.inlined_insert=function(n,e){var t;null==Di.zpp_pool?t=new Di:(t=Di.zpp_pool,Di.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ii.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Di.zpp_pool,Di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ii.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Di.zpp_pool,Di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ii.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ii.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ii.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Di.zpp_pool,Di.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ii.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ii.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Di.zpp_pool,Di.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ii.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Di.zpp_pool,Di.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ii.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Di.zpp_pool,Di.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ii.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Di.zpp_pool,Di.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ii.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ii.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Di.zpp_pool,Di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ii.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Di.zpp_pool,Di.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ii.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ii.prototype.empty=function(){return null==this.head},ii.prototype.size=function(){return this.length},ii.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ii.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ii.prototype.front=function(){return this.head.elt},ii.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ii.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ii.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ii.prototype.__class__=ii;var pi=zpp_nape.util.ZNPList_ZPP_AABBNode=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};pi.__name__=["zpp_nape","util","ZNPList_ZPP_AABBNode"],pi.prototype.head=null,pi.prototype.begin=function(){return this.head},pi.prototype.modified=null,pi.prototype.pushmod=null,pi.prototype.length=null,pi.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},pi.prototype.add=function(n){var e;null==Fi.zpp_pool?e=new Fi:(e=Fi.zpp_pool,Fi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},pi.prototype.inlined_add=function(n){var e;null==Fi.zpp_pool?e=new Fi:(e=Fi.zpp_pool,Fi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},pi.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},pi.prototype.insert=function(n,e){var t;null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pi.prototype.inlined_insert=function(n,e){var t;null==Fi.zpp_pool?t=new Fi:(t=Fi.zpp_pool,Fi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},pi.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Fi.zpp_pool,Fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pi.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Fi.zpp_pool,Fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},pi.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},pi.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},pi.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Fi.zpp_pool,Fi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},pi.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},pi.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Fi.zpp_pool,Fi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},pi.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Fi.zpp_pool,Fi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},pi.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Fi.zpp_pool,Fi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},pi.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Fi.zpp_pool,Fi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},pi.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},pi.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Fi.zpp_pool,Fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},pi.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Fi.zpp_pool,Fi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},pi.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},pi.prototype.empty=function(){return null==this.head},pi.prototype.size=function(){return this.length},pi.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},pi.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},pi.prototype.front=function(){return this.head.elt},pi.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},pi.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},pi.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},pi.prototype.__class__=pi;var li=zpp_nape.util.ZNPList_ZPP_Component=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};li.__name__=["zpp_nape","util","ZNPList_ZPP_Component"],li.prototype.head=null,li.prototype.begin=function(){return this.head},li.prototype.modified=null,li.prototype.pushmod=null,li.prototype.length=null,li.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},li.prototype.add=function(n){var e;null==Ri.zpp_pool?e=new Ri:(e=Ri.zpp_pool,Ri.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},li.prototype.inlined_add=function(n){var e;null==Ri.zpp_pool?e=new Ri:(e=Ri.zpp_pool,Ri.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},li.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},li.prototype.insert=function(n,e){var t;null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},li.prototype.inlined_insert=function(n,e){var t;null==Ri.zpp_pool?t=new Ri:(t=Ri.zpp_pool,Ri.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},li.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ri.zpp_pool,Ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},li.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ri.zpp_pool,Ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},li.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},li.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},li.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ri.zpp_pool,Ri.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},li.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},li.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ri.zpp_pool,Ri.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},li.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ri.zpp_pool,Ri.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},li.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ri.zpp_pool,Ri.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},li.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ri.zpp_pool,Ri.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},li.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},li.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ri.zpp_pool,Ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},li.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ri.zpp_pool,Ri.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},li.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},li.prototype.empty=function(){return null==this.head},li.prototype.size=function(){return this.length},li.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},li.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},li.prototype.front=function(){return this.head.elt},li.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},li.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},li.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},li.prototype.__class__=li;var ri=zpp_nape.util.ZNPList_ZPP_FluidArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ri.__name__=["zpp_nape","util","ZNPList_ZPP_FluidArbiter"],ri.prototype.head=null,ri.prototype.begin=function(){return this.head},ri.prototype.modified=null,ri.prototype.pushmod=null,ri.prototype.length=null,ri.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ri.prototype.add=function(n){var e;null==Zi.zpp_pool?e=new Zi:(e=Zi.zpp_pool,Zi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ri.prototype.inlined_add=function(n){var e;null==Zi.zpp_pool?e=new Zi:(e=Zi.zpp_pool,Zi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ri.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ri.prototype.insert=function(n,e){var t;null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ri.prototype.inlined_insert=function(n,e){var t;null==Zi.zpp_pool?t=new Zi:(t=Zi.zpp_pool,Zi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ri.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Zi.zpp_pool,Zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ri.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Zi.zpp_pool,Zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ri.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ri.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ri.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Zi.zpp_pool,Zi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ri.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ri.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Zi.zpp_pool,Zi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ri.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Zi.zpp_pool,Zi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ri.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Zi.zpp_pool,Zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ri.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Zi.zpp_pool,Zi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ri.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ri.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Zi.zpp_pool,Zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ri.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Zi.zpp_pool,Zi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ri.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ri.prototype.empty=function(){return null==this.head},ri.prototype.size=function(){return this.length},ri.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ri.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ri.prototype.front=function(){return this.head.elt},ri.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ri.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ri.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ri.prototype.__class__=ri;var oi=zpp_nape.util.ZNPList_ZPP_SensorArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};oi.__name__=["zpp_nape","util","ZNPList_ZPP_SensorArbiter"],oi.prototype.head=null,oi.prototype.begin=function(){return this.head},oi.prototype.modified=null,oi.prototype.pushmod=null,oi.prototype.length=null,oi.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},oi.prototype.add=function(n){var e;null==Bi.zpp_pool?e=new Bi:(e=Bi.zpp_pool,Bi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},oi.prototype.inlined_add=function(n){var e;null==Bi.zpp_pool?e=new Bi:(e=Bi.zpp_pool,Bi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},oi.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},oi.prototype.insert=function(n,e){var t;null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},oi.prototype.inlined_insert=function(n,e){var t;null==Bi.zpp_pool?t=new Bi:(t=Bi.zpp_pool,Bi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},oi.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Bi.zpp_pool,Bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},oi.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Bi.zpp_pool,Bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},oi.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},oi.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},oi.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Bi.zpp_pool,Bi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},oi.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},oi.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Bi.zpp_pool,Bi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},oi.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Bi.zpp_pool,Bi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},oi.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Bi.zpp_pool,Bi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},oi.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Bi.zpp_pool,Bi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},oi.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},oi.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Bi.zpp_pool,Bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},oi.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Bi.zpp_pool,Bi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},oi.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},oi.prototype.empty=function(){return null==this.head},oi.prototype.size=function(){return this.length},oi.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},oi.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},oi.prototype.front=function(){return this.head.elt},oi.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},oi.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},oi.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},oi.prototype.__class__=oi;var ai=zpp_nape.util.ZNPList_ZPP_Listener=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ai.__name__=["zpp_nape","util","ZNPList_ZPP_Listener"],ai.prototype.head=null,ai.prototype.begin=function(){return this.head},ai.prototype.modified=null,ai.prototype.pushmod=null,ai.prototype.length=null,ai.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ai.prototype.add=function(n){var e;null==Gi.zpp_pool?e=new Gi:(e=Gi.zpp_pool,Gi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ai.prototype.inlined_add=function(n){var e;null==Gi.zpp_pool?e=new Gi:(e=Gi.zpp_pool,Gi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ai.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ai.prototype.insert=function(n,e){var t;null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ai.prototype.inlined_insert=function(n,e){var t;null==Gi.zpp_pool?t=new Gi:(t=Gi.zpp_pool,Gi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ai.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ai.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ai.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ai.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ai.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Gi.zpp_pool,Gi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ai.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ai.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Gi.zpp_pool,Gi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ai.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Gi.zpp_pool,Gi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ai.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Gi.zpp_pool,Gi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ai.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Gi.zpp_pool,Gi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ai.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ai.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ai.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Gi.zpp_pool,Gi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ai.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ai.prototype.empty=function(){return null==this.head},ai.prototype.size=function(){return this.length},ai.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ai.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ai.prototype.front=function(){return this.head.elt},ai.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ai.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ai.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ai.prototype.__class__=ai;var si=zpp_nape.util.ZNPList_ZPP_ColArbiter=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};si.__name__=["zpp_nape","util","ZNPList_ZPP_ColArbiter"],si.prototype.head=null,si.prototype.begin=function(){return this.head},si.prototype.modified=null,si.prototype.pushmod=null,si.prototype.length=null,si.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},si.prototype.add=function(n){var e;null==qi.zpp_pool?e=new qi:(e=qi.zpp_pool,qi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},si.prototype.inlined_add=function(n){var e;null==qi.zpp_pool?e=new qi:(e=qi.zpp_pool,qi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},si.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},si.prototype.insert=function(n,e){var t;null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},si.prototype.inlined_insert=function(n,e){var t;null==qi.zpp_pool?t=new qi:(t=qi.zpp_pool,qi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},si.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=qi.zpp_pool,qi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},si.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=qi.zpp_pool,qi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},si.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},si.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},si.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=qi.zpp_pool,qi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},si.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},si.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=qi.zpp_pool,qi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},si.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=qi.zpp_pool,qi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},si.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=qi.zpp_pool,qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},si.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=qi.zpp_pool,qi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},si.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},si.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=qi.zpp_pool,qi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},si.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=qi.zpp_pool,qi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},si.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},si.prototype.empty=function(){return null==this.head},si.prototype.size=function(){return this.length},si.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},si.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},si.prototype.front=function(){return this.head.elt},si.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},si.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},si.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},si.prototype.__class__=si;var _i=zpp_nape.util.ZNPList_ZPP_InteractionGroup=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};_i.__name__=["zpp_nape","util","ZNPList_ZPP_InteractionGroup"],_i.prototype.head=null,_i.prototype.begin=function(){return this.head},_i.prototype.modified=null,_i.prototype.pushmod=null,_i.prototype.length=null,_i.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},_i.prototype.add=function(n){var e;null==Ui.zpp_pool?e=new Ui:(e=Ui.zpp_pool,Ui.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},_i.prototype.inlined_add=function(n){var e;null==Ui.zpp_pool?e=new Ui:(e=Ui.zpp_pool,Ui.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},_i.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},_i.prototype.insert=function(n,e){var t;null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},_i.prototype.inlined_insert=function(n,e){var t;null==Ui.zpp_pool?t=new Ui:(t=Ui.zpp_pool,Ui.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},_i.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ui.zpp_pool,Ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},_i.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ui.zpp_pool,Ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},_i.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},_i.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},_i.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ui.zpp_pool,Ui.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},_i.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},_i.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ui.zpp_pool,Ui.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},_i.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ui.zpp_pool,Ui.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},_i.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ui.zpp_pool,Ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},_i.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ui.zpp_pool,Ui.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},_i.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},_i.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ui.zpp_pool,Ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},_i.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ui.zpp_pool,Ui.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},_i.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},_i.prototype.empty=function(){return null==this.head},_i.prototype.size=function(){return this.length},_i.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},_i.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},_i.prototype.front=function(){return this.head.elt},_i.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},_i.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},_i.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},_i.prototype.__class__=_i;var hi=zpp_nape.util.ZNPList_ZPP_ToiEvent=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};hi.__name__=["zpp_nape","util","ZNPList_ZPP_ToiEvent"],hi.prototype.head=null,hi.prototype.begin=function(){return this.head},hi.prototype.modified=null,hi.prototype.pushmod=null,hi.prototype.length=null,hi.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},hi.prototype.add=function(n){var e;null==Ki.zpp_pool?e=new Ki:(e=Ki.zpp_pool,Ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},hi.prototype.inlined_add=function(n){var e;null==Ki.zpp_pool?e=new Ki:(e=Ki.zpp_pool,Ki.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},hi.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},hi.prototype.insert=function(n,e){var t;null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},hi.prototype.inlined_insert=function(n,e){var t;null==Ki.zpp_pool?t=new Ki:(t=Ki.zpp_pool,Ki.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},hi.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ki.zpp_pool,Ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},hi.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ki.zpp_pool,Ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},hi.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},hi.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},hi.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ki.zpp_pool,Ki.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},hi.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},hi.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ki.zpp_pool,Ki.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},hi.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ki.zpp_pool,Ki.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},hi.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ki.zpp_pool,Ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},hi.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ki.zpp_pool,Ki.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},hi.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},hi.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ki.zpp_pool,Ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},hi.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ki.zpp_pool,Ki.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},hi.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},hi.prototype.empty=function(){return null==this.head},hi.prototype.size=function(){return this.length},hi.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},hi.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},hi.prototype.front=function(){return this.head.elt},hi.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},hi.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},hi.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},hi.prototype.__class__=hi;var ui=zpp_nape.util.ZNPList_ConvexResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};ui.__name__=["zpp_nape","util","ZNPList_ConvexResult"],ui.prototype.head=null,ui.prototype.begin=function(){return this.head},ui.prototype.modified=null,ui.prototype.pushmod=null,ui.prototype.length=null,ui.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},ui.prototype.add=function(n){var e;null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ui.prototype.inlined_add=function(n){var e;null==Wi.zpp_pool?e=new Wi:(e=Wi.zpp_pool,Wi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},ui.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},ui.prototype.insert=function(n,e){var t;null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ui.prototype.inlined_insert=function(n,e){var t;null==Wi.zpp_pool?t=new Wi:(t=Wi.zpp_pool,Wi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},ui.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Wi.zpp_pool,Wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ui.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Wi.zpp_pool,Wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},ui.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ui.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},ui.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Wi.zpp_pool,Wi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ui.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},ui.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Wi.zpp_pool,Wi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},ui.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Wi.zpp_pool,Wi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},ui.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Wi.zpp_pool,Wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ui.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Wi.zpp_pool,Wi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},ui.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},ui.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Wi.zpp_pool,Wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ui.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Wi.zpp_pool,Wi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},ui.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},ui.prototype.empty=function(){return null==this.head},ui.prototype.size=function(){return this.length},ui.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ui.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},ui.prototype.front=function(){return this.head.elt},ui.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},ui.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},ui.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},ui.prototype.__class__=ui;var xi=zpp_nape.util.ZNPList_ZPP_GeomPoly=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};xi.__name__=["zpp_nape","util","ZNPList_ZPP_GeomPoly"],xi.prototype.head=null,xi.prototype.begin=function(){return this.head},xi.prototype.modified=null,xi.prototype.pushmod=null,xi.prototype.length=null,xi.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},xi.prototype.add=function(n){var e;null==Yi.zpp_pool?e=new Yi:(e=Yi.zpp_pool,Yi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},xi.prototype.inlined_add=function(n){var e;null==Yi.zpp_pool?e=new Yi:(e=Yi.zpp_pool,Yi.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},xi.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},xi.prototype.insert=function(n,e){var t;null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},xi.prototype.inlined_insert=function(n,e){var t;null==Yi.zpp_pool?t=new Yi:(t=Yi.zpp_pool,Yi.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},xi.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Yi.zpp_pool,Yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},xi.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Yi.zpp_pool,Yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},xi.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},xi.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},xi.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Yi.zpp_pool,Yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},xi.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},xi.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Yi.zpp_pool,Yi.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},xi.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Yi.zpp_pool,Yi.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},xi.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Yi.zpp_pool,Yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},xi.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Yi.zpp_pool,Yi.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},xi.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},xi.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Yi.zpp_pool,Yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},xi.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Yi.zpp_pool,Yi.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},xi.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},xi.prototype.empty=function(){return null==this.head},xi.prototype.size=function(){return this.length},xi.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},xi.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},xi.prototype.front=function(){return this.head.elt},xi.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},xi.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},xi.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},xi.prototype.__class__=xi;var di=zpp_nape.util.ZNPList_RayResult=function(){this.length=0,this.pushmod=!1,this.modified=!1,this.head=null};di.__name__=["zpp_nape","util","ZNPList_RayResult"],di.prototype.head=null,di.prototype.begin=function(){return this.head},di.prototype.modified=null,di.prototype.pushmod=null,di.prototype.length=null,di.prototype.setbegin=function(n){this.head=n,this.modified=!0,this.pushmod=!0},di.prototype.add=function(n){var e;null==Ji.zpp_pool?e=new Ji:(e=Ji.zpp_pool,Ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},di.prototype.inlined_add=function(n){var e;null==Ji.zpp_pool?e=new Ji:(e=Ji.zpp_pool,Ji.zpp_pool=e.next,e.next=null),e.elt=n;var t=e;return t.next=this.head,this.head=t,this.modified=!0,this.length++,n},di.prototype.addAll=function(n){for(var e=n.head;null!=e;)this.add(e.elt),e=e.next},di.prototype.insert=function(n,e){var t;null==Ji.zpp_pool?t=new Ji:(t=Ji.zpp_pool,Ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},di.prototype.inlined_insert=function(n,e){var t;null==Ji.zpp_pool?t=new Ji:(t=Ji.zpp_pool,Ji.zpp_pool=t.next,t.next=null),t.elt=e;var i=t;return null==n?(i.next=this.head,this.head=i):(i.next=n.next,n.next=i),this.pushmod=this.modified=!0,this.length++,i},di.prototype.pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ji.zpp_pool,Ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},di.prototype.inlined_pop=function(){var n=this.head;this.head=n.next,n.elt=null,n.next=Ji.zpp_pool,Ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--},di.prototype.pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},di.prototype.inlined_pop_unsafe=function(){var n=this.head.elt;return this.pop(),n},di.prototype.remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ji.zpp_pool,Ji.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},di.prototype.try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){this.erase(e),i=!0;break}e=t,t=t.next}return i},di.prototype.inlined_remove=function(n){for(var e=null,t=this.head;null!=t;){if(t.elt==n){var i,p;null==e?(p=(i=this.head).next,this.head=p,null==this.head&&(this.pushmod=!0)):(p=(i=e.next).next,e.next=p,null==p&&(this.pushmod=!0));var l=i;l.elt=null,l.next=Ji.zpp_pool,Ji.zpp_pool=l,this.modified=!0,this.length--,this.pushmod=!0;break}e=t,t=t.next}},di.prototype.inlined_try_remove=function(n){for(var e=null,t=this.head,i=!1;null!=t;){if(t.elt==n){var p,l;null==e?(l=(p=this.head).next,this.head=l,null==this.head&&(this.pushmod=!0)):(l=(p=e.next).next,e.next=l,null==l&&(this.pushmod=!0));var r=p;r.elt=null,r.next=Ji.zpp_pool,Ji.zpp_pool=r,this.modified=!0,this.length--,this.pushmod=!0,i=!0;break}e=t,t=t.next}return i},di.prototype.erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ji.zpp_pool,Ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},di.prototype.inlined_erase=function(n){var e,t;null==n?(t=(e=this.head).next,this.head=t,null==this.head&&(this.pushmod=!0)):(t=(e=n.next).next,n.next=t,null==t&&(this.pushmod=!0));var i=e;return i.elt=null,i.next=Ji.zpp_pool,Ji.zpp_pool=i,this.modified=!0,this.length--,this.pushmod=!0,t},di.prototype.splice=function(n,e){for(;e-- >0&&null!=n.next;)this.erase(n);return n.next},di.prototype.clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ji.zpp_pool,Ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},di.prototype.inlined_clear=function(){for(;null!=this.head;){var n=this.head;this.head=n.next,n.elt=null,n.next=Ji.zpp_pool,Ji.zpp_pool=n,null==this.head&&(this.pushmod=!0),this.modified=!0,this.length--}this.pushmod=!0},di.prototype.reverse=function(){for(var n=this.head,e=null;null!=n;){var t=n.next;n.next=e,this.head=n,e=n,n=t}this.modified=!0,this.pushmod=!0},di.prototype.empty=function(){return null==this.head},di.prototype.size=function(){return this.length},di.prototype.has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},di.prototype.inlined_has=function(n){var e;e=!1;for(var t=this.head;null!=t;){if(t.elt==n){e=!0;break}t=t.next}return e},di.prototype.front=function(){return this.head.elt},di.prototype.back=function(){for(var n=this.head,e=n;null!=e;)n=e,e=e.next;return n.elt},di.prototype.iterator_at=function(n){for(var e=this.head;n-- >0&&null!=e;)e=e.next;return e},di.prototype.at=function(n){var e=this.iterator_at(n);return null!=e?e.elt:null},di.prototype.__class__=di;var yi=zpp_nape.util.ZNPNode_ZPP_CbType=function(){this.elt=null,this.next=null};yi.__name__=["zpp_nape","util","ZNPNode_ZPP_CbType"],yi.prototype.next=null,yi.prototype.alloc=function(){},yi.prototype.free=function(){this.elt=null},yi.prototype.elt=null,yi.prototype.elem=function(){return this.elt},yi.prototype.__class__=yi;var zi=zpp_nape.util.ZNPNode_ZPP_CallbackSet=function(){this.elt=null,this.next=null};zi.__name__=["zpp_nape","util","ZNPNode_ZPP_CallbackSet"],zi.prototype.next=null,zi.prototype.alloc=function(){},zi.prototype.free=function(){this.elt=null},zi.prototype.elt=null,zi.prototype.elem=function(){return this.elt},zi.prototype.__class__=zi;var vi=zpp_nape.util.ZNPNode_ZPP_Shape=function(){this.elt=null,this.next=null};vi.__name__=["zpp_nape","util","ZNPNode_ZPP_Shape"],vi.prototype.next=null,vi.prototype.alloc=function(){},vi.prototype.free=function(){this.elt=null},vi.prototype.elt=null,vi.prototype.elem=function(){return this.elt},vi.prototype.__class__=vi;var ci=zpp_nape.util.ZNPNode_ZPP_Body=function(){this.elt=null,this.next=null};ci.__name__=["zpp_nape","util","ZNPNode_ZPP_Body"],ci.prototype.next=null,ci.prototype.alloc=function(){},ci.prototype.free=function(){this.elt=null},ci.prototype.elt=null,ci.prototype.elem=function(){return this.elt},ci.prototype.__class__=ci;var fi=zpp_nape.util.ZNPNode_ZPP_Constraint=function(){this.elt=null,this.next=null};fi.__name__=["zpp_nape","util","ZNPNode_ZPP_Constraint"],fi.prototype.next=null,fi.prototype.alloc=function(){},fi.prototype.free=function(){this.elt=null},fi.prototype.elt=null,fi.prototype.elem=function(){return this.elt},fi.prototype.__class__=fi;var mi=zpp_nape.util.ZNPNode_ZPP_Compound=function(){this.elt=null,this.next=null};mi.__name__=["zpp_nape","util","ZNPNode_ZPP_Compound"],mi.prototype.next=null,mi.prototype.alloc=function(){},mi.prototype.free=function(){this.elt=null},mi.prototype.elt=null,mi.prototype.elem=function(){return this.elt},mi.prototype.__class__=mi;var bi=zpp_nape.util.ZNPNode_ZPP_Arbiter=function(){this.elt=null,this.next=null};bi.__name__=["zpp_nape","util","ZNPNode_ZPP_Arbiter"],bi.prototype.next=null,bi.prototype.alloc=function(){},bi.prototype.free=function(){this.elt=null},bi.prototype.elt=null,bi.prototype.elem=function(){return this.elt},bi.prototype.__class__=bi;var gi=zpp_nape.util.ZNPNode_ZPP_InteractionListener=function(){this.elt=null,this.next=null};gi.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionListener"],gi.prototype.next=null,gi.prototype.alloc=function(){},gi.prototype.free=function(){this.elt=null},gi.prototype.elt=null,gi.prototype.elem=function(){return this.elt},gi.prototype.__class__=gi;var wi=zpp_nape.util.ZNPNode_ZPP_CbSet=function(){this.elt=null,this.next=null};wi.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSet"],wi.prototype.next=null,wi.prototype.alloc=function(){},wi.prototype.free=function(){this.elt=null},wi.prototype.elt=null,wi.prototype.elem=function(){return this.elt},wi.prototype.__class__=wi;var Mi=zpp_nape.util.ZNPNode_ZPP_Interactor=function(){this.elt=null,this.next=null};Mi.__name__=["zpp_nape","util","ZNPNode_ZPP_Interactor"],Mi.prototype.next=null,Mi.prototype.alloc=function(){},Mi.prototype.free=function(){this.elt=null},Mi.prototype.elt=null,Mi.prototype.elem=function(){return this.elt},Mi.prototype.__class__=Mi;var Ci=zpp_nape.util.ZNPNode_ZPP_BodyListener=function(){this.elt=null,this.next=null};Ci.__name__=["zpp_nape","util","ZNPNode_ZPP_BodyListener"],Ci.prototype.next=null,Ci.prototype.alloc=function(){},Ci.prototype.free=function(){this.elt=null},Ci.prototype.elt=null,Ci.prototype.elem=function(){return this.elt},Ci.prototype.__class__=Ci;var ki=zpp_nape.util.ZNPNode_ZPP_CbSetPair=function(){this.elt=null,this.next=null};ki.__name__=["zpp_nape","util","ZNPNode_ZPP_CbSetPair"],ki.prototype.next=null,ki.prototype.alloc=function(){},ki.prototype.free=function(){this.elt=null},ki.prototype.elt=null,ki.prototype.elem=function(){return this.elt},ki.prototype.__class__=ki;var Oi=zpp_nape.util.ZNPNode_ZPP_ConstraintListener=function(){this.elt=null,this.next=null};Oi.__name__=["zpp_nape","util","ZNPNode_ZPP_ConstraintListener"],Oi.prototype.next=null,Oi.prototype.alloc=function(){},Oi.prototype.free=function(){this.elt=null},Oi.prototype.elt=null,Oi.prototype.elem=function(){return this.elt},Oi.prototype.__class__=Oi;var Pi=zpp_nape.util.ZNPNode_ZPP_CutInt=function(){this.elt=null,this.next=null};Pi.__name__=["zpp_nape","util","ZNPNode_ZPP_CutInt"],Pi.prototype.next=null,Pi.prototype.alloc=function(){},Pi.prototype.free=function(){this.elt=null},Pi.prototype.elt=null,Pi.prototype.elem=function(){return this.elt},Pi.prototype.__class__=Pi;var Si=zpp_nape.util.ZNPNode_ZPP_CutVert=function(){this.elt=null,this.next=null};Si.__name__=["zpp_nape","util","ZNPNode_ZPP_CutVert"],Si.prototype.next=null,Si.prototype.alloc=function(){},Si.prototype.free=function(){this.elt=null},Si.prototype.elt=null,Si.prototype.elem=function(){return this.elt},Si.prototype.__class__=Si;var Ai=zpp_nape.util.ZNPNode_ZPP_PartitionVertex=function(){this.elt=null,this.next=null};Ai.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionVertex"],Ai.prototype.next=null,Ai.prototype.alloc=function(){},Ai.prototype.free=function(){this.elt=null},Ai.prototype.elt=null,Ai.prototype.elem=function(){return this.elt},Ai.prototype.__class__=Ai;var ji=zpp_nape.util.ZNPNode_ZPP_SimplifyP=function(){this.elt=null,this.next=null};ji.__name__=["zpp_nape","util","ZNPNode_ZPP_SimplifyP"],ji.prototype.next=null,ji.prototype.alloc=function(){},ji.prototype.free=function(){this.elt=null},ji.prototype.elt=null,ji.prototype.elem=function(){return this.elt},ji.prototype.__class__=ji;var Ei=zpp_nape.util.ZNPNode_ZPP_PartitionedPoly=function(){this.elt=null,this.next=null};Ei.__name__=["zpp_nape","util","ZNPNode_ZPP_PartitionedPoly"],Ei.prototype.next=null,Ei.prototype.alloc=function(){},Ei.prototype.free=function(){this.elt=null},Ei.prototype.elt=null,Ei.prototype.elem=function(){return this.elt},Ei.prototype.__class__=Ei;var Ii=zpp_nape.util.ZNPNode_ZPP_GeomVert=function(){this.elt=null,this.next=null};Ii.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomVert"],Ii.prototype.next=null,Ii.prototype.alloc=function(){},Ii.prototype.free=function(){this.elt=null},Ii.prototype.elt=null,Ii.prototype.elem=function(){return this.elt},Ii.prototype.__class__=Ii;var Ti=zpp_nape.util.ZNPNode_ZPP_SimpleVert=function(){this.elt=null,this.next=null};Ti.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleVert"],Ti.prototype.next=null,Ti.prototype.alloc=function(){},Ti.prototype.free=function(){this.elt=null},Ti.prototype.elt=null,Ti.prototype.elem=function(){return this.elt},Ti.prototype.__class__=Ti;var Ni=zpp_nape.util.ZNPNode_ZPP_SimpleEvent=function(){this.elt=null,this.next=null};Ni.__name__=["zpp_nape","util","ZNPNode_ZPP_SimpleEvent"],Ni.prototype.next=null,Ni.prototype.alloc=function(){},Ni.prototype.free=function(){this.elt=null},Ni.prototype.elt=null,Ni.prototype.elem=function(){return this.elt},Ni.prototype.__class__=Ni;var Li=zpp_nape.util.ZNPNode_ZPP_Vec2=function(){this.elt=null,this.next=null};Li.__name__=["zpp_nape","util","ZNPNode_ZPP_Vec2"],Li.prototype.next=null,Li.prototype.alloc=function(){},Li.prototype.free=function(){this.elt=null},Li.prototype.elt=null,Li.prototype.elem=function(){return this.elt},Li.prototype.__class__=Li;var Vi=zpp_nape.util.ZNPNode_ZPP_AABBPair=function(){this.elt=null,this.next=null};Vi.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBPair"],Vi.prototype.next=null,Vi.prototype.alloc=function(){},Vi.prototype.free=function(){this.elt=null},Vi.prototype.elt=null,Vi.prototype.elem=function(){return this.elt},Vi.prototype.__class__=Vi;var Di=zpp_nape.util.ZNPNode_ZPP_Edge=function(){this.elt=null,this.next=null};Di.__name__=["zpp_nape","util","ZNPNode_ZPP_Edge"],Di.prototype.next=null,Di.prototype.alloc=function(){},Di.prototype.free=function(){this.elt=null},Di.prototype.elt=null,Di.prototype.elem=function(){return this.elt},Di.prototype.__class__=Di;var Fi=zpp_nape.util.ZNPNode_ZPP_AABBNode=function(){this.elt=null,this.next=null};Fi.__name__=["zpp_nape","util","ZNPNode_ZPP_AABBNode"],Fi.prototype.next=null,Fi.prototype.alloc=function(){},Fi.prototype.free=function(){this.elt=null},Fi.prototype.elt=null,Fi.prototype.elem=function(){return this.elt},Fi.prototype.__class__=Fi;var Ri=zpp_nape.util.ZNPNode_ZPP_Component=function(){this.elt=null,this.next=null};Ri.__name__=["zpp_nape","util","ZNPNode_ZPP_Component"],Ri.prototype.next=null,Ri.prototype.alloc=function(){},Ri.prototype.free=function(){this.elt=null},Ri.prototype.elt=null,Ri.prototype.elem=function(){return this.elt},Ri.prototype.__class__=Ri;var Zi=zpp_nape.util.ZNPNode_ZPP_FluidArbiter=function(){this.elt=null,this.next=null};Zi.__name__=["zpp_nape","util","ZNPNode_ZPP_FluidArbiter"],Zi.prototype.next=null,Zi.prototype.alloc=function(){},Zi.prototype.free=function(){this.elt=null},Zi.prototype.elt=null,Zi.prototype.elem=function(){return this.elt},Zi.prototype.__class__=Zi;var Bi=zpp_nape.util.ZNPNode_ZPP_SensorArbiter=function(){this.elt=null,this.next=null};Bi.__name__=["zpp_nape","util","ZNPNode_ZPP_SensorArbiter"],Bi.prototype.next=null,Bi.prototype.alloc=function(){},Bi.prototype.free=function(){this.elt=null},Bi.prototype.elt=null,Bi.prototype.elem=function(){return this.elt},Bi.prototype.__class__=Bi;var Gi=zpp_nape.util.ZNPNode_ZPP_Listener=function(){this.elt=null,this.next=null};Gi.__name__=["zpp_nape","util","ZNPNode_ZPP_Listener"],Gi.prototype.next=null,Gi.prototype.alloc=function(){},Gi.prototype.free=function(){this.elt=null},Gi.prototype.elt=null,Gi.prototype.elem=function(){return this.elt},Gi.prototype.__class__=Gi;var qi=zpp_nape.util.ZNPNode_ZPP_ColArbiter=function(){this.elt=null,this.next=null};qi.__name__=["zpp_nape","util","ZNPNode_ZPP_ColArbiter"],qi.prototype.next=null,qi.prototype.alloc=function(){},qi.prototype.free=function(){this.elt=null},qi.prototype.elt=null,qi.prototype.elem=function(){return this.elt},qi.prototype.__class__=qi;var Ui=zpp_nape.util.ZNPNode_ZPP_InteractionGroup=function(){this.elt=null,this.next=null};Ui.__name__=["zpp_nape","util","ZNPNode_ZPP_InteractionGroup"],Ui.prototype.next=null,Ui.prototype.alloc=function(){},Ui.prototype.free=function(){this.elt=null},Ui.prototype.elt=null,Ui.prototype.elem=function(){return this.elt},Ui.prototype.__class__=Ui;var Ki=zpp_nape.util.ZNPNode_ZPP_ToiEvent=function(){this.elt=null,this.next=null};Ki.__name__=["zpp_nape","util","ZNPNode_ZPP_ToiEvent"],Ki.prototype.next=null,Ki.prototype.alloc=function(){},Ki.prototype.free=function(){this.elt=null},Ki.prototype.elt=null,Ki.prototype.elem=function(){return this.elt},Ki.prototype.__class__=Ki;var Wi=zpp_nape.util.ZNPNode_ConvexResult=function(){this.elt=null,this.next=null};Wi.__name__=["zpp_nape","util","ZNPNode_ConvexResult"],Wi.prototype.next=null,Wi.prototype.alloc=function(){},Wi.prototype.free=function(){this.elt=null},Wi.prototype.elt=null,Wi.prototype.elem=function(){return this.elt},Wi.prototype.__class__=Wi;var Yi=zpp_nape.util.ZNPNode_ZPP_GeomPoly=function(){this.elt=null,this.next=null};Yi.__name__=["zpp_nape","util","ZNPNode_ZPP_GeomPoly"],Yi.prototype.next=null,Yi.prototype.alloc=function(){},Yi.prototype.free=function(){this.elt=null},Yi.prototype.elt=null,Yi.prototype.elem=function(){return this.elt},Yi.prototype.__class__=Yi;var Ji=zpp_nape.util.ZNPNode_RayResult=function(){this.elt=null,this.next=null};Ji.__name__=["zpp_nape","util","ZNPNode_RayResult"],Ji.prototype.next=null,Ji.prototype.alloc=function(){},Ji.prototype.free=function(){this.elt=null},Ji.prototype.elt=null,Ji.prototype.elem=function(){return this.elt},Ji.prototype.__class__=Ji;var Xi=zpp_nape.util.ZPP_MixVec2List=function(){this.at_index=0,this.at_ite=null,this.zip_length=!1,this._length=0,this.inner=null,vn.call(this),this.at_ite=null,this.at_index=0,this.zip_length=!0,this._length=0};Xi.__name__=["zpp_nape","util","ZPP_MixVec2List"],Xi.__super__=vn,Xi.prototype=Object.create(vn.prototype),Xi.get=function(n,e){null==e&&(e=!1);var t=new Xi;return t.inner=n,t.zpp_inner.immutable=e,t},Xi.prototype.inner=null,Xi.prototype._length=null,Xi.prototype.zip_length=null,Xi.prototype.at_ite=null,Xi.prototype.at_index=null,Xi.prototype.zpp_gl=function(){if(this.zpp_vm(),this.zip_length){this._length=0;for(var n=this.inner.next;null!=n;)this._length++,n=n.next;this.zip_length=!1}return this._length},Xi.prototype.zpp_vm=function(){this.zpp_inner.validate(),this.inner.modified&&(this.zip_length=!0,this._length=0,this.at_ite=null)},Xi.prototype.at=function(n){for(this.zpp_vm(),this.zpp_inner.reverse_flag&&(n=this.zpp_gl()-1-n),(n<this.at_index||null==this.at_ite)&&(this.at_index=0,this.at_ite=this.inner.next);this.at_index!=n;)this.at_index++,this.at_ite=this.at_ite.next;var e=this.at_ite;if(null==e.outer){e.outer=new yn;var t=e.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t,e.outer.zpp_inner=e}return e.outer},Xi.prototype.push=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.inner.add(n.zpp_inner):this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},Xi.prototype.unshift=function(n){this.zpp_inner.modify_test(),this.zpp_vm();var e=null==this.zpp_inner.adder||this.zpp_inner.adder(n);return e&&(this.zpp_inner.reverse_flag?this.inner.insert(this.inner.iterator_at(this.zpp_gl()-1),n.zpp_inner):this.inner.add(n.zpp_inner),this.zpp_inner.invalidate(),null!=this.zpp_inner.post_adder&&this.zpp_inner.post_adder(n)),e},Xi.prototype.pop=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){if(null==(n=this.inner.next).outer){n.outer=new yn;var e=n.outer.zpp_inner;null!=e.outer&&(e.outer.zpp_inner=null,e.outer=null),e._isimmutable=null,e._validate=null,e._invalidate=null,e.next=xt.zpp_pool,xt.zpp_pool=e,n.outer.zpp_inner=n}var t=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(t),this.zpp_inner.dontremove||this.inner.pop()}else{null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var i=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(null==(n=null==i?this.inner.next:i.next).outer){n.outer=new yn;var p=n.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,n.outer.zpp_inner=n}var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.inner.erase(i)}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new yn;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},Xi.prototype.shift=function(){this.zpp_inner.modify_test(),this.zpp_vm();var n=null;if(this.zpp_inner.reverse_flag){null!=this.at_ite&&null==this.at_ite.next&&(this.at_ite=null);var e=1==this.zpp_gl()?null:this.inner.iterator_at(this.zpp_gl()-2);if(null==(n=null==e?this.inner.next:e.next).outer){n.outer=new yn;var t=n.outer.zpp_inner;null!=t.outer&&(t.outer.zpp_inner=null,t.outer=null),t._isimmutable=null,t._validate=null,t._invalidate=null,t.next=xt.zpp_pool,xt.zpp_pool=t,n.outer.zpp_inner=n}var i=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(i),this.zpp_inner.dontremove||this.inner.erase(e)}else{if(null==(n=this.inner.next).outer){n.outer=new yn;var p=n.outer.zpp_inner;null!=p.outer&&(p.outer.zpp_inner=null,p.outer=null),p._isimmutable=null,p._validate=null,p._invalidate=null,p.next=xt.zpp_pool,xt.zpp_pool=p,n.outer.zpp_inner=n}var l=n.outer;null!=this.zpp_inner.subber&&this.zpp_inner.subber(l),this.zpp_inner.dontremove||this.inner.pop()}if(this.zpp_inner.invalidate(),null==n.outer){n.outer=new yn;var r=n.outer.zpp_inner;null!=r.outer&&(r.outer.zpp_inner=null,r.outer=null),r._isimmutable=null,r._validate=null,r._invalidate=null,r.next=xt.zpp_pool,xt.zpp_pool=r,n.outer.zpp_inner=n}return n.outer},Xi.prototype.remove=function(n){var e;this.zpp_inner.modify_test(),this.zpp_vm(),e=!1;for(var t=this.inner.next;null!=t;){if(n.zpp_inner==t){e=!0;break}t=t.next}return e&&(null!=this.zpp_inner.subber&&this.zpp_inner.subber(n),this.zpp_inner.dontremove||this.inner.remove(n.zpp_inner),this.zpp_inner.invalidate()),e},Xi.prototype.clear=function(){if(this.zpp_inner.reverse_flag)for(;!this.empty();)this.pop();else for(;!this.empty();)this.shift()},Xi.prototype.__class__=Xi;var Hi=zpp_nape.util.ZPP_ConstraintList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ie,this._invalidated=!0};Hi.__name__=["zpp_nape","util","ZPP_ConstraintList"],Hi.get=function(n,e){null==e&&(e=!1);var t=new j;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},Hi.prototype.outer=null,Hi.prototype.inner=null,Hi.prototype.immutable=null,Hi.prototype._invalidated=null,Hi.prototype._invalidate=null,Hi.prototype._validate=null,Hi.prototype._modifiable=null,Hi.prototype.adder=null,Hi.prototype.post_adder=null,Hi.prototype.subber=null,Hi.prototype.dontremove=null,Hi.prototype.reverse_flag=null,Hi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Hi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Hi.prototype.modify_test=function(){},Hi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Hi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Hi.prototype.at_index=null,Hi.prototype.at_ite=null,Hi.prototype.push_ite=null,Hi.prototype.zip_length=null,Hi.prototype.user_length=null,Hi.prototype.__class__=Hi;var $i=zpp_nape.util.ZPP_BodyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new qt,this._invalidated=!0};$i.__name__=["zpp_nape","util","ZPP_BodyList"],$i.get=function(n,e){null==e&&(e=!1);var t=new wn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},$i.prototype.outer=null,$i.prototype.inner=null,$i.prototype.immutable=null,$i.prototype._invalidated=null,$i.prototype._invalidate=null,$i.prototype._validate=null,$i.prototype._modifiable=null,$i.prototype.adder=null,$i.prototype.post_adder=null,$i.prototype.subber=null,$i.prototype.dontremove=null,$i.prototype.reverse_flag=null,$i.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},$i.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},$i.prototype.modify_test=function(){},$i.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},$i.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},$i.prototype.at_index=null,$i.prototype.at_ite=null,$i.prototype.push_ite=null,$i.prototype.zip_length=null,$i.prototype.user_length=null,$i.prototype.__class__=$i;var Qi=zpp_nape.util.ZPP_InteractorList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new pe,this._invalidated=!0};Qi.__name__=["zpp_nape","util","ZPP_InteractorList"],Qi.get=function(n,e){null==e&&(e=!1);var t=new En;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},Qi.prototype.outer=null,Qi.prototype.inner=null,Qi.prototype.immutable=null,Qi.prototype._invalidated=null,Qi.prototype._invalidate=null,Qi.prototype._validate=null,Qi.prototype._modifiable=null,Qi.prototype.adder=null,Qi.prototype.post_adder=null,Qi.prototype.subber=null,Qi.prototype.dontremove=null,Qi.prototype.reverse_flag=null,Qi.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},Qi.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},Qi.prototype.modify_test=function(){},Qi.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},Qi.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},Qi.prototype.at_index=null,Qi.prototype.at_ite=null,Qi.prototype.push_ite=null,Qi.prototype.zip_length=null,Qi.prototype.user_length=null,Qi.prototype.__class__=Qi;var np=zpp_nape.util.ZPP_CompoundList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ut,this._invalidated=!0};np.__name__=["zpp_nape","util","ZPP_CompoundList"],np.get=function(n,e){null==e&&(e=!1);var t=new On;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},np.prototype.outer=null,np.prototype.inner=null,np.prototype.immutable=null,np.prototype._invalidated=null,np.prototype._invalidate=null,np.prototype._validate=null,np.prototype._modifiable=null,np.prototype.adder=null,np.prototype.post_adder=null,np.prototype.subber=null,np.prototype.dontremove=null,np.prototype.reverse_flag=null,np.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},np.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},np.prototype.modify_test=function(){},np.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},np.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},np.prototype.at_index=null,np.prototype.at_ite=null,np.prototype.push_ite=null,np.prototype.zip_length=null,np.prototype.user_length=null,np.prototype.__class__=np;var ep=zpp_nape.util.ZPP_ListenerList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ai,this._invalidated=!0};ep.__name__=["zpp_nape","util","ZPP_ListenerList"],ep.get=function(n,e){null==e&&(e=!1);var t=new g;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},ep.prototype.outer=null,ep.prototype.inner=null,ep.prototype.immutable=null,ep.prototype._invalidated=null,ep.prototype._invalidate=null,ep.prototype._validate=null,ep.prototype._modifiable=null,ep.prototype.adder=null,ep.prototype.post_adder=null,ep.prototype.subber=null,ep.prototype.dontremove=null,ep.prototype.reverse_flag=null,ep.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ep.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ep.prototype.modify_test=function(){},ep.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ep.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ep.prototype.at_index=null,ep.prototype.at_ite=null,ep.prototype.push_ite=null,ep.prototype.zip_length=null,ep.prototype.user_length=null,ep.prototype.__class__=ep;var tp=zpp_nape.util.ZPP_CbTypeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new he,this._invalidated=!0};tp.__name__=["zpp_nape","util","ZPP_CbTypeList"],tp.get=function(n,e){null==e&&(e=!1);var t=new y;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},tp.prototype.outer=null,tp.prototype.inner=null,tp.prototype.immutable=null,tp.prototype._invalidated=null,tp.prototype._invalidate=null,tp.prototype._validate=null,tp.prototype._modifiable=null,tp.prototype.adder=null,tp.prototype.post_adder=null,tp.prototype.subber=null,tp.prototype.dontremove=null,tp.prototype.reverse_flag=null,tp.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},tp.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},tp.prototype.modify_test=function(){},tp.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},tp.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},tp.prototype.at_index=null,tp.prototype.at_ite=null,tp.prototype.push_ite=null,tp.prototype.zip_length=null,tp.prototype.user_length=null,tp.prototype.__class__=tp;var ip=zpp_nape.util.ZPP_Vec2List=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Ne,this._invalidated=!0};ip.__name__=["zpp_nape","util","ZPP_Vec2List"],ip.get=function(n,e){null==e&&(e=!1);var t=new vn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},ip.prototype.outer=null,ip.prototype.inner=null,ip.prototype.immutable=null,ip.prototype._invalidated=null,ip.prototype._invalidate=null,ip.prototype._validate=null,ip.prototype._modifiable=null,ip.prototype.adder=null,ip.prototype.post_adder=null,ip.prototype.subber=null,ip.prototype.dontremove=null,ip.prototype.reverse_flag=null,ip.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ip.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ip.prototype.modify_test=function(){},ip.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ip.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ip.prototype.at_index=null,ip.prototype.at_ite=null,ip.prototype.push_ite=null,ip.prototype.zip_length=null,ip.prototype.user_length=null,ip.prototype.__class__=ip;var pp=zpp_nape.util.ZPP_GeomPolyList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new xi,this._invalidated=!0};pp.__name__=["zpp_nape","util","ZPP_GeomPolyList"],pp.get=function(n,e){null==e&&(e=!1);var t=new rn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},pp.prototype.outer=null,pp.prototype.inner=null,pp.prototype.immutable=null,pp.prototype._invalidated=null,pp.prototype._invalidate=null,pp.prototype._validate=null,pp.prototype._modifiable=null,pp.prototype.adder=null,pp.prototype.post_adder=null,pp.prototype.subber=null,pp.prototype.dontremove=null,pp.prototype.reverse_flag=null,pp.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},pp.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},pp.prototype.modify_test=function(){},pp.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},pp.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},pp.prototype.at_index=null,pp.prototype.at_ite=null,pp.prototype.push_ite=null,pp.prototype.zip_length=null,pp.prototype.user_length=null,pp.prototype.__class__=pp;var lp=zpp_nape.util.ZPP_RayResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new di,this._invalidated=!0};lp.__name__=["zpp_nape","util","ZPP_RayResultList"],lp.get=function(n,e){null==e&&(e=!1);var t=new dn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},lp.prototype.outer=null,lp.prototype.inner=null,lp.prototype.immutable=null,lp.prototype._invalidated=null,lp.prototype._invalidate=null,lp.prototype._validate=null,lp.prototype._modifiable=null,lp.prototype.adder=null,lp.prototype.post_adder=null,lp.prototype.subber=null,lp.prototype.dontremove=null,lp.prototype.reverse_flag=null,lp.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},lp.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},lp.prototype.modify_test=function(){},lp.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},lp.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},lp.prototype.at_index=null,lp.prototype.at_ite=null,lp.prototype.push_ite=null,lp.prototype.zip_length=null,lp.prototype.user_length=null,lp.prototype.__class__=lp;var rp=zpp_nape.util.ZPP_ConvexResultList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ui,this._invalidated=!0};rp.__name__=["zpp_nape","util","ZPP_ConvexResultList"],rp.get=function(n,e){null==e&&(e=!1);var t=new en;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},rp.prototype.outer=null,rp.prototype.inner=null,rp.prototype.immutable=null,rp.prototype._invalidated=null,rp.prototype._invalidate=null,rp.prototype._validate=null,rp.prototype._modifiable=null,rp.prototype.adder=null,rp.prototype.post_adder=null,rp.prototype.subber=null,rp.prototype.dontremove=null,rp.prototype.reverse_flag=null,rp.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},rp.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},rp.prototype.modify_test=function(){},rp.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},rp.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},rp.prototype.at_index=null,rp.prototype.at_ite=null,rp.prototype.push_ite=null,rp.prototype.zip_length=null,rp.prototype.user_length=null,rp.prototype.__class__=rp;var op=zpp_nape.util.ZPP_EdgeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new ii,this._invalidated=!0};op.__name__=["zpp_nape","util","ZPP_EdgeList"],op.get=function(n,e){null==e&&(e=!1);var t=new Fn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},op.prototype.outer=null,op.prototype.inner=null,op.prototype.immutable=null,op.prototype._invalidated=null,op.prototype._invalidate=null,op.prototype._validate=null,op.prototype._modifiable=null,op.prototype.adder=null,op.prototype.post_adder=null,op.prototype.subber=null,op.prototype.dontremove=null,op.prototype.reverse_flag=null,op.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},op.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},op.prototype.modify_test=function(){},op.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},op.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},op.prototype.at_index=null,op.prototype.at_ite=null,op.prototype.push_ite=null,op.prototype.zip_length=null,op.prototype.user_length=null,op.prototype.__class__=op;var ap=zpp_nape.util.ZPP_ShapeList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Gt,this._invalidated=!0};ap.__name__=["zpp_nape","util","ZPP_ShapeList"],ap.get=function(n,e){null==e&&(e=!1);var t=new Bn;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},ap.prototype.outer=null,ap.prototype.inner=null,ap.prototype.immutable=null,ap.prototype._invalidated=null,ap.prototype._invalidate=null,ap.prototype._validate=null,ap.prototype._modifiable=null,ap.prototype.adder=null,ap.prototype.post_adder=null,ap.prototype.subber=null,ap.prototype.dontremove=null,ap.prototype.reverse_flag=null,ap.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},ap.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},ap.prototype.modify_test=function(){},ap.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},ap.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},ap.prototype.at_index=null,ap.prototype.at_ite=null,ap.prototype.push_ite=null,ap.prototype.zip_length=null,ap.prototype.user_length=null,ap.prototype.__class__=ap;var sp=zpp_nape.util.ZPP_InteractionGroupList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new _i,this._invalidated=!0};sp.__name__=["zpp_nape","util","ZPP_InteractionGroupList"],sp.get=function(n,e){null==e&&(e=!1);var t=new H;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},sp.prototype.outer=null,sp.prototype.inner=null,sp.prototype.immutable=null,sp.prototype._invalidated=null,sp.prototype._invalidate=null,sp.prototype._validate=null,sp.prototype._modifiable=null,sp.prototype.adder=null,sp.prototype.post_adder=null,sp.prototype.subber=null,sp.prototype.dontremove=null,sp.prototype.reverse_flag=null,sp.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},sp.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},sp.prototype.modify_test=function(){},sp.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},sp.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},sp.prototype.at_index=null,sp.prototype.at_ite=null,sp.prototype.push_ite=null,sp.prototype.zip_length=null,sp.prototype.user_length=null,sp.prototype.__class__=sp;var _p=zpp_nape.util.ZPP_ArbiterList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Kt,this._invalidated=!0};_p.__name__=["zpp_nape","util","ZPP_ArbiterList"],_p.get=function(n,e){null==e&&(e=!1);var t=new Z;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},_p.prototype.outer=null,_p.prototype.inner=null,_p.prototype.immutable=null,_p.prototype._invalidated=null,_p.prototype._invalidate=null,_p.prototype._validate=null,_p.prototype._modifiable=null,_p.prototype.adder=null,_p.prototype.post_adder=null,_p.prototype.subber=null,_p.prototype.dontremove=null,_p.prototype.reverse_flag=null,_p.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},_p.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},_p.prototype.modify_test=function(){},_p.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},_p.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},_p.prototype.at_index=null,_p.prototype.at_ite=null,_p.prototype.push_ite=null,_p.prototype.zip_length=null,_p.prototype.user_length=null,_p.prototype.__class__=_p;var hp=zpp_nape.util.ZPP_ContactList=function(){this.user_length=0,this.zip_length=!1,this.push_ite=null,this.at_ite=null,this.at_index=0,this.reverse_flag=!1,this.dontremove=!1,this.subber=null,this.post_adder=null,this.adder=null,this._modifiable=null,this._validate=null,this._invalidate=null,this._invalidated=!1,this.immutable=!1,this.inner=null,this.outer=null,this.inner=new Se,this._invalidated=!0};hp.__name__=["zpp_nape","util","ZPP_ContactList"],hp.get=function(n,e){null==e&&(e=!1);var t=new K;return t.zpp_inner.inner=n,e&&(t.zpp_inner.immutable=!0),t.zpp_inner.zip_length=!0,t},hp.prototype.outer=null,hp.prototype.inner=null,hp.prototype.immutable=null,hp.prototype._invalidated=null,hp.prototype._invalidate=null,hp.prototype._validate=null,hp.prototype._modifiable=null,hp.prototype.adder=null,hp.prototype.post_adder=null,hp.prototype.subber=null,hp.prototype.dontremove=null,hp.prototype.reverse_flag=null,hp.prototype.valmod=function(){this.validate(),this.inner.modified&&(this.inner.pushmod&&(this.push_ite=null),this.at_ite=null,this.inner.modified=!1,this.inner.pushmod=!1,this.zip_length=!0)},hp.prototype.modified=function(){this.zip_length=!0,this.at_ite=null,this.push_ite=null},hp.prototype.modify_test=function(){},hp.prototype.validate=function(){this._invalidated&&(this._invalidated=!1,null!=this._validate&&this._validate())},hp.prototype.invalidate=function(){this._invalidated=!0,null!=this._invalidate&&this._invalidate(this)},hp.prototype.at_index=null,hp.prototype.at_ite=null,hp.prototype.push_ite=null,hp.prototype.zip_length=null,hp.prototype.user_length=null,hp.prototype.__class__=hp;var up=zpp_nape.util.ZPP_Math=function(){};up.__name__=["zpp_nape","util","ZPP_Math"],up.sqrt=function(n){return Math.sqrt(n)},up.invsqrt=function(n){return 1/Math.sqrt(n)},up.sqr=function(n){return n*n},up.clamp2=function(n,e){var t=-e;return n<t?t:n>e?e:n},up.clamp=function(n,e,t){return n<e?e:n>t?t:n},up.prototype.__class__=up;var xp=zpp_nape.util.ZPP_PubPool=function(){};xp.__name__=["zpp_nape","util","ZPP_PubPool"],xp.prototype.__class__=xp;var dp=zpp_nape.util.ZPP_Set_ZPP_Body=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};dp.__name__=["zpp_nape","util","ZPP_Set_ZPP_Body"],dp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},dp.prototype.alloc=function(){},dp.prototype.lt=null,dp.prototype.swapped=null,dp.prototype.data=null,dp.prototype.prev=null,dp.prototype.next=null,dp.prototype.parent=null,dp.prototype.colour=null,dp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},dp.prototype.empty=function(){return null==this.parent},dp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},dp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},dp.prototype.has=function(n){return null!=this.find(n)},dp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},dp.prototype.has_weak=function(n){return null!=this.find_weak(n)},dp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},dp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},dp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},dp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},dp.prototype.remove=function(n){this.remove_node(this.find(n))},dp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},dp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},dp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},dp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},dp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=dp.zpp_pool,dp.zpp_pool=a},dp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=dp.zpp_pool,dp.zpp_pool=t,n=e}this.parent=null}},dp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=dp.zpp_pool,dp.zpp_pool=i,e=t}this.parent=null}},dp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=dp.zpp_pool,dp.zpp_pool=n,t},dp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},dp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},dp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==dp.zpp_pool?e=new dp:(e=dp.zpp_pool,dp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==dp.zpp_pool?e=new dp:(e=dp.zpp_pool,dp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==dp.zpp_pool?e=new dp:(e=dp.zpp_pool,dp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},dp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==dp.zpp_pool?e=new dp:(e=dp.zpp_pool,dp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==dp.zpp_pool?e=new dp:(e=dp.zpp_pool,dp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==dp.zpp_pool?e=new dp:(e=dp.zpp_pool,dp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},dp.prototype.insert=function(n){var e;if(null==dp.zpp_pool?e=new dp:(e=dp.zpp_pool,dp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},dp.prototype.__class__=dp;var yp=zpp_nape.util.ZPP_Set_ZPP_CbSetPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};yp.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSetPair"],yp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},yp.prototype.alloc=function(){},yp.prototype.lt=null,yp.prototype.swapped=null,yp.prototype.data=null,yp.prototype.prev=null,yp.prototype.next=null,yp.prototype.parent=null,yp.prototype.colour=null,yp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},yp.prototype.empty=function(){return null==this.parent},yp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},yp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},yp.prototype.has=function(n){return null!=this.find(n)},yp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},yp.prototype.has_weak=function(n){return null!=this.find_weak(n)},yp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},yp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},yp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},yp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},yp.prototype.remove=function(n){this.remove_node(this.find(n))},yp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},yp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},yp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},yp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},yp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=yp.zpp_pool,yp.zpp_pool=a},yp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=yp.zpp_pool,yp.zpp_pool=t,n=e}this.parent=null}},yp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=yp.zpp_pool,yp.zpp_pool=i,e=t}this.parent=null}},yp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=yp.zpp_pool,yp.zpp_pool=n,t},yp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},yp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},yp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},yp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},yp.prototype.insert=function(n){var e;if(null==yp.zpp_pool?e=new yp:(e=yp.zpp_pool,yp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},yp.prototype.__class__=yp;var zp=zpp_nape.util.ZPP_Set_ZPP_PartitionVertex=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};zp.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionVertex"],zp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},zp.prototype.alloc=function(){},zp.prototype.lt=null,zp.prototype.swapped=null,zp.prototype.data=null,zp.prototype.prev=null,zp.prototype.next=null,zp.prototype.parent=null,zp.prototype.colour=null,zp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},zp.prototype.empty=function(){return null==this.parent},zp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},zp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},zp.prototype.has=function(n){return null!=this.find(n)},zp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},zp.prototype.has_weak=function(n){return null!=this.find_weak(n)},zp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},zp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},zp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},zp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},zp.prototype.remove=function(n){this.remove_node(this.find(n))},zp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},zp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},zp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},zp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},zp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=zp.zpp_pool,zp.zpp_pool=a},zp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=zp.zpp_pool,zp.zpp_pool=t,n=e}this.parent=null}},zp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=zp.zpp_pool,zp.zpp_pool=i,e=t}this.parent=null}},zp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=zp.zpp_pool,zp.zpp_pool=n,t},zp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},zp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},zp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==zp.zpp_pool?e=new zp:(e=zp.zpp_pool,zp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==zp.zpp_pool?e=new zp:(e=zp.zpp_pool,zp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==zp.zpp_pool?e=new zp:(e=zp.zpp_pool,zp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},zp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==zp.zpp_pool?e=new zp:(e=zp.zpp_pool,zp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==zp.zpp_pool?e=new zp:(e=zp.zpp_pool,zp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==zp.zpp_pool?e=new zp:(e=zp.zpp_pool,zp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},zp.prototype.insert=function(n){var e;if(null==zp.zpp_pool?e=new zp:(e=zp.zpp_pool,zp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},zp.prototype.__class__=zp;var vp=zpp_nape.util.ZPP_Set_ZPP_PartitionPair=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};vp.__name__=["zpp_nape","util","ZPP_Set_ZPP_PartitionPair"],vp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},vp.prototype.alloc=function(){},vp.prototype.lt=null,vp.prototype.swapped=null,vp.prototype.data=null,vp.prototype.prev=null,vp.prototype.next=null,vp.prototype.parent=null,vp.prototype.colour=null,vp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},vp.prototype.empty=function(){return null==this.parent},vp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},vp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},vp.prototype.has=function(n){return null!=this.find(n)},vp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},vp.prototype.has_weak=function(n){return null!=this.find_weak(n)},vp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},vp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},vp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},vp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},vp.prototype.remove=function(n){this.remove_node(this.find(n))},vp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},vp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},vp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},vp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},vp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=vp.zpp_pool,vp.zpp_pool=a},vp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=vp.zpp_pool,vp.zpp_pool=t,n=e}this.parent=null}},vp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=vp.zpp_pool,vp.zpp_pool=i,e=t}this.parent=null}},vp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=vp.zpp_pool,vp.zpp_pool=n,t},vp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},vp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},vp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==vp.zpp_pool?e=new vp:(e=vp.zpp_pool,vp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==vp.zpp_pool?e=new vp:(e=vp.zpp_pool,vp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==vp.zpp_pool?e=new vp:(e=vp.zpp_pool,vp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},vp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==vp.zpp_pool?e=new vp:(e=vp.zpp_pool,vp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==vp.zpp_pool?e=new vp:(e=vp.zpp_pool,vp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==vp.zpp_pool?e=new vp:(e=vp.zpp_pool,vp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},vp.prototype.insert=function(n){var e;if(null==vp.zpp_pool?e=new vp:(e=vp.zpp_pool,vp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},vp.prototype.__class__=vp;var cp=zpp_nape.util.ZPP_Set_ZPP_SimpleVert=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};cp.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleVert"],cp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},cp.prototype.alloc=function(){},cp.prototype.lt=null,cp.prototype.swapped=null,cp.prototype.data=null,cp.prototype.prev=null,cp.prototype.next=null,cp.prototype.parent=null,cp.prototype.colour=null,cp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},cp.prototype.empty=function(){return null==this.parent},cp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},cp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},cp.prototype.has=function(n){return null!=this.find(n)},cp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},cp.prototype.has_weak=function(n){return null!=this.find_weak(n)},cp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},cp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},cp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},cp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},cp.prototype.remove=function(n){this.remove_node(this.find(n))},cp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},cp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},cp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},cp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},cp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=cp.zpp_pool,cp.zpp_pool=a},cp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=cp.zpp_pool,cp.zpp_pool=t,n=e}this.parent=null}},cp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=cp.zpp_pool,cp.zpp_pool=i,e=t}this.parent=null}},cp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=cp.zpp_pool,cp.zpp_pool=n,t},cp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},cp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},cp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==cp.zpp_pool?e=new cp:(e=cp.zpp_pool,cp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==cp.zpp_pool?e=new cp:(e=cp.zpp_pool,cp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==cp.zpp_pool?e=new cp:(e=cp.zpp_pool,cp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},cp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==cp.zpp_pool?e=new cp:(e=cp.zpp_pool,cp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==cp.zpp_pool?e=new cp:(e=cp.zpp_pool,cp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==cp.zpp_pool?e=new cp:(e=cp.zpp_pool,cp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},cp.prototype.insert=function(n){var e;if(null==cp.zpp_pool?e=new cp:(e=cp.zpp_pool,cp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},cp.prototype.__class__=cp;var fp=zpp_nape.util.ZPP_Set_ZPP_SimpleSeg=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};fp.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleSeg"],fp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},fp.prototype.alloc=function(){},fp.prototype.lt=null,fp.prototype.swapped=null,fp.prototype.data=null,fp.prototype.prev=null,fp.prototype.next=null,fp.prototype.parent=null,fp.prototype.colour=null,fp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},fp.prototype.empty=function(){return null==this.parent},fp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},fp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},fp.prototype.has=function(n){return null!=this.find(n)},fp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},fp.prototype.has_weak=function(n){return null!=this.find_weak(n)},fp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},fp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},fp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},fp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},fp.prototype.remove=function(n){this.remove_node(this.find(n))},fp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},fp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},fp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},fp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},fp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=fp.zpp_pool,fp.zpp_pool=a},fp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=fp.zpp_pool,fp.zpp_pool=t,n=e}this.parent=null}},fp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=fp.zpp_pool,fp.zpp_pool=i,e=t}this.parent=null}},fp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=fp.zpp_pool,fp.zpp_pool=n,t},fp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},fp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},fp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==fp.zpp_pool?e=new fp:(e=fp.zpp_pool,fp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==fp.zpp_pool?e=new fp:(e=fp.zpp_pool,fp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==fp.zpp_pool?e=new fp:(e=fp.zpp_pool,fp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},fp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==fp.zpp_pool?e=new fp:(e=fp.zpp_pool,fp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==fp.zpp_pool?e=new fp:(e=fp.zpp_pool,fp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==fp.zpp_pool?e=new fp:(e=fp.zpp_pool,fp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},fp.prototype.insert=function(n){var e;if(null==fp.zpp_pool?e=new fp:(e=fp.zpp_pool,fp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},fp.prototype.__class__=fp;var mp=zpp_nape.util.ZPP_Set_ZPP_SimpleEvent=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};mp.__name__=["zpp_nape","util","ZPP_Set_ZPP_SimpleEvent"],mp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},mp.prototype.alloc=function(){},mp.prototype.lt=null,mp.prototype.swapped=null,mp.prototype.data=null,mp.prototype.prev=null,mp.prototype.next=null,mp.prototype.parent=null,mp.prototype.colour=null,mp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},mp.prototype.empty=function(){return null==this.parent},mp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},mp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},mp.prototype.has=function(n){return null!=this.find(n)},mp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},mp.prototype.has_weak=function(n){return null!=this.find_weak(n)},mp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},mp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},mp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},mp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},mp.prototype.remove=function(n){this.remove_node(this.find(n))},mp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},mp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},mp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},mp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},mp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=mp.zpp_pool,mp.zpp_pool=a},mp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=mp.zpp_pool,mp.zpp_pool=t,n=e}this.parent=null}},mp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=mp.zpp_pool,mp.zpp_pool=i,e=t}this.parent=null}},mp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=mp.zpp_pool,mp.zpp_pool=n,t},mp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},mp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},mp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==mp.zpp_pool?e=new mp:(e=mp.zpp_pool,mp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==mp.zpp_pool?e=new mp:(e=mp.zpp_pool,mp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==mp.zpp_pool?e=new mp:(e=mp.zpp_pool,mp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},mp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==mp.zpp_pool?e=new mp:(e=mp.zpp_pool,mp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==mp.zpp_pool?e=new mp:(e=mp.zpp_pool,mp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==mp.zpp_pool?e=new mp:(e=mp.zpp_pool,mp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},mp.prototype.insert=function(n){var e;if(null==mp.zpp_pool?e=new mp:(e=mp.zpp_pool,mp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},mp.prototype.__class__=mp;var bp=zpp_nape.util.ZPP_Set_ZPP_CbSet=function(){this.colour=0,this.parent=null,this.next=null,this.prev=null,this.data=null,this.swapped=null,this.lt=null};bp.__name__=["zpp_nape","util","ZPP_Set_ZPP_CbSet"],bp.prototype.free=function(){this.data=null,this.lt=null,this.swapped=null},bp.prototype.alloc=function(){},bp.prototype.lt=null,bp.prototype.swapped=null,bp.prototype.data=null,bp.prototype.prev=null,bp.prototype.next=null,bp.prototype.parent=null,bp.prototype.colour=null,bp.prototype.verify=function(){if(!this.empty()){for(var n=this.parent;null!=n.prev;)n=n.prev;for(;null!=n;){var e=n.data,t=!0;if(!this.empty()){for(var i=this.parent;null!=i.prev;)i=i.prev;for(;null!=i;){var p=i.data;if(t){if(e==p)t=!1;else if(!this.lt(p,e)&&this.lt(e,p))return!1}else if(!this.lt(e,p)&&this.lt(p,e))return!1;if(null!=i.next)for(i=i.next;null!=i.prev;)i=i.prev;else{for(;null!=i.parent&&i==i.parent.next;)i=i.parent;i=i.parent}}}if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{for(;null!=n.parent&&n==n.parent.next;)n=n.parent;n=n.parent}}}return!0},bp.prototype.empty=function(){return null==this.parent},bp.prototype.singular=function(){return null!=this.parent&&null==this.parent.prev&&null==this.parent.next},bp.prototype.size=function(){var n=0;if(!this.empty()){for(var e=this.parent;null!=e.prev;)e=e.prev;for(;null!=e;)if(++n,null!=e.next)for(e=e.next;null!=e.prev;)e=e.prev;else{for(;null!=e.parent&&e==e.parent.next;)e=e.parent;e=e.parent}}return n},bp.prototype.has=function(n){return null!=this.find(n)},bp.prototype.find=function(n){for(var e=this.parent;null!=e&&e.data!=n;)e=this.lt(n,e.data)?e.prev:e.next;return e},bp.prototype.has_weak=function(n){return null!=this.find_weak(n)},bp.prototype.find_weak=function(n){for(var e=this.parent;null!=e;)if(this.lt(n,e.data))e=e.prev;else{if(!this.lt(e.data,n))break;e=e.next}return e},bp.prototype.lower_bound=function(n){var e=null;if(!this.empty()){for(var t=this.parent;null!=t.prev;)t=t.prev;for(;null!=t;){var i=t.data;if(!this.lt(i,n)){e=i;break}if(null!=t.next)for(t=t.next;null!=t.prev;)t=t.prev;else{for(;null!=t.parent&&t==t.parent.next;)t=t.parent;t=t.parent}}}return e},bp.prototype.first=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;return n.data},bp.prototype.pop_front=function(){for(var n=this.parent;null!=n.prev;)n=n.prev;var e=n.data;return this.remove_node(n),e},bp.prototype.remove=function(n){this.remove_node(this.find(n))},bp.prototype.successor_node=function(n){if(null!=n.next)for(n=n.next;null!=n.prev;)n=n.prev;else{var e=n;for(n=n.parent;null!=n&&n.prev!=e;)e=n,n=n.parent}return n},bp.prototype.predecessor_node=function(n){if(null!=n.prev)for(n=n.prev;null!=n.next;)n=n.next;else{var e=n;for(n=n.parent;null!=n&&n.next!=e;)e=n,n=n.parent}return n},bp.prototype.successor=function(n){var e=this.successor_node(this.find(n));return null==e?null:e.data},bp.prototype.predecessor=function(n){var e=this.predecessor_node(this.find(n));return null==e?null:e.data},bp.prototype.remove_node=function(n){if(null!=n.next&&null!=n.prev){for(var e=n.next;null!=e.prev;)e=e.prev;var t=n.data;n.data=e.data,e.data=t,null!=this.swapped&&this.swapped(n.data,e.data),n=e}var i=null==n.prev?n.next:n.prev;if(1==n.colour)if(null!=n.prev||null!=n.next)i.colour=1;else if(null!=n.parent)for(var p=n.parent;;){p.colour++,p.prev.colour--,p.next.colour--;var l=p.prev;if(-1==l.colour){this.__fix_neg_red(l);break}if(0==l.colour){if(null!=l.prev&&0==l.prev.colour){this.__fix_dbl_red(l.prev);break}if(null!=l.next&&0==l.next.colour){this.__fix_dbl_red(l.next);break}}var r=p.next;if(-1==r.colour){this.__fix_neg_red(r);break}if(0==r.colour){if(null!=r.prev&&0==r.prev.colour){this.__fix_dbl_red(r.prev);break}if(null!=r.next&&0==r.next.colour){this.__fix_dbl_red(r.next);break}}if(2==p.colour){if(null!=p.parent){p=p.parent;continue}p.colour=1}break}var o=n.parent;null==o?this.parent=i:o.prev==n?o.prev=i:o.next=i,null!=i&&(i.parent=o),n.parent=n.prev=n.next=null;var a=n;a.data=null,a.lt=null,a.swapped=null,a.next=bp.zpp_pool,bp.zpp_pool=a},bp.prototype.clear=function(){if(null!=this.parent){for(var n=this.parent;null!=n;)if(null!=n.prev)n=n.prev;else if(null!=n.next)n=n.next;else{var e=n.parent;null!=e&&(n==e.prev?e.prev=null:e.next=null,n.parent=null);var t=n;t.data=null,t.lt=null,t.swapped=null,t.next=bp.zpp_pool,bp.zpp_pool=t,n=e}this.parent=null}},bp.prototype.clear_with=function(n){if(null!=this.parent){for(var e=this.parent;null!=e;)if(null!=e.prev)e=e.prev;else if(null!=e.next)e=e.next;else{n(e.data);var t=e.parent;null!=t&&(e==t.prev?t.prev=null:t.next=null,e.parent=null);var i=e;i.data=null,i.lt=null,i.swapped=null,i.next=bp.zpp_pool,bp.zpp_pool=i,e=t}this.parent=null}},bp.prototype.clear_node=function(n,e){e(n.data);var t=n.parent;return null!=t&&(n==t.prev?t.prev=null:t.next=null,n.parent=null),n.data=null,n.lt=null,n.swapped=null,n.next=bp.zpp_pool,bp.zpp_pool=n,t},bp.prototype.__fix_neg_red=function(n){var e,t=n.parent;if(t.prev==n){var i=n.prev,p=n.next,l=p.prev,r=p.next;i.colour=0,n.colour=t.colour=1,n.next=l,null!=l&&(l.parent=n);var o=t.data;t.data=p.data,p.data=o,null!=this.swapped&&this.swapped(t.data,p.data),p.prev=r,null!=r&&(r.parent=p),p.next=t.next,null!=t.next&&(t.next.parent=p),t.next=p,null!=p&&(p.parent=t),e=i}else{var a=n.next,s=n.prev,_=s.next,h=s.prev;a.colour=0,n.colour=t.colour=1,n.prev=_,null!=_&&(_.parent=n);var u=t.data;t.data=s.data,s.data=u,null!=this.swapped&&this.swapped(t.data,s.data),s.next=h,null!=h&&(h.parent=s),s.prev=t.prev,null!=t.prev&&(t.prev.parent=s),t.prev=s,null!=s&&(s.parent=t),e=a}null!=e.prev&&0==e.prev.colour?this.__fix_dbl_red(e.prev):null!=e.next&&0==e.next.colour&&this.__fix_dbl_red(e.next)},bp.prototype.__fix_dbl_red=function(n){for(;;){var e,t,i,p,l,r,o,a=n.parent,s=a.parent;if(null==s){a.colour=1;break}a==s.prev?(i=s,o=s.next,n==a.prev?(e=n,t=a,p=n.prev,l=n.next,r=a.next):(e=a,t=n,p=a.prev,l=n.prev,r=n.next)):(e=s,p=s.prev,n==a.prev?(t=n,i=a,l=n.prev,r=n.next,o=a.next):(t=a,i=n,l=a.prev,r=n.prev,o=n.next));var _=s.parent;if(null==_?this.parent=t:_.prev==s?_.prev=t:_.next=t,null!=t&&(t.parent=_),e.prev=p,null!=p&&(p.parent=e),e.next=l,null!=l&&(l.parent=e),t.prev=e,null!=e&&(e.parent=t),t.next=i,null!=i&&(i.parent=t),i.prev=r,null!=r&&(r.parent=i),i.next=o,null!=o&&(o.parent=i),t.colour=s.colour-1,e.colour=1,i.colour=1,t==this.parent)this.parent.colour=1;else if(0==t.colour&&0==t.parent.colour){n=t;continue}break}},bp.prototype.try_insert_bool=function(n){var e=null,t=null;if(null==this.parent)null==bp.zpp_pool?e=new bp:(e=bp.zpp_pool,bp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==bp.zpp_pool?e=new bp:(e=bp.zpp_pool,bp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==bp.zpp_pool?e=new bp:(e=bp.zpp_pool,bp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null!=e&&(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),!0)},bp.prototype.try_insert=function(n){var e=null,t=null;if(null==this.parent)null==bp.zpp_pool?e=new bp:(e=bp.zpp_pool,bp.zpp_pool=e.next,e.next=null),e.data=n,this.parent=e;else for(t=this.parent;;)if(this.lt(n,t.data)){if(null==t.prev){null==bp.zpp_pool?e=new bp:(e=bp.zpp_pool,bp.zpp_pool=e.next,e.next=null),e.data=n,t.prev=e,e.parent=t;break}t=t.prev}else{if(!this.lt(t.data,n))break;if(null==t.next){null==bp.zpp_pool?e=new bp:(e=bp.zpp_pool,bp.zpp_pool=e.next,e.next=null),e.data=n,t.next=e,e.parent=t;break}t=t.next}return null==e?t:(null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e)},bp.prototype.insert=function(n){var e;if(null==bp.zpp_pool?e=new bp:(e=bp.zpp_pool,bp.zpp_pool=e.next,e.next=null),e.data=n,null==this.parent)this.parent=e;else for(var t=this.parent;;)if(this.lt(e.data,t.data)){if(null==t.prev){t.prev=e,e.parent=t;break}t=t.prev}else{if(null==t.next){t.next=e,e.parent=t;break}t=t.next}return null==e.parent?e.colour=1:(e.colour=0,0==e.parent.colour&&this.__fix_dbl_red(e)),e},bp.prototype.__class__=bp,String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0;var gp={__name__:["Int"]},wp={__name__:["Dynamic"]},Mp=Number;Mp.__name__=["Float"];var Cp=Boolean;Cp.__ename__=["Bool"];var kp={__name__:["Class"]},Op={};r.__toStr={}.toString,o.epsilon=1e-8,o.fluidAngularDragFriction=2.5,o.fluidAngularDrag=100,o.fluidVacuumDrag=.5,o.fluidLinearDrag=.5,o.collisionSlop=.2,o.collisionSlopCCD=.5,o.distanceThresholdCCD=.05,o.staticCCDLinearThreshold=.05,o.staticCCDAngularThreshold=.005,o.bulletCCDLinearThreshold=.125,o.bulletCCDAngularThreshold=.0125,o.dynamicSweepLinearThreshold=17,o.dynamicSweepAngularThreshold=.6,o.angularCCDSlipScale=.75,o.arbiterExpirationDelay=6,o.staticFrictionThreshold=2,o.elasticThreshold=20,o.sleepDelay=60,o.linearSleepThreshold=.2,o.angularSleepThreshold=.4,o.contactBiasCoef=.3,o.contactStaticBiasCoef=.6,o.contactContinuousBiasCoef=.4,o.contactContinuousStaticBiasCoef=.5,o.constraintLinearSlop=.1,o.constraintAngularSlop=.001,o.illConditionedThreshold=2e8,d.zpp_pool=null,b.zpp_pool=null,A.zpp_pool=null,R.zpp_pool=null,U.zpp_pool=null,X.zpp_pool=null,nn.zpp_pool=null,ln.zpp_pool=null,xn.zpp_pool=null,zn.zpp_pool=null,gn.zpp_pool=null,kn.zpp_pool=null,jn.zpp_pool=null,Dn.zpp_pool=null,Zn.zpp_pool=null,Jn.FMAX=1e100,Xn._Constraint=0,Xn._Interactor=0,Xn._CbType=0,Xn._CbSet=0,Xn._Listener=0,Xn._ZPP_SimpleVert=0,Xn._ZPP_SimpleSeg=0,Xn._Space=0,Xn._InteractionGroup=0,Hn.zpp_pool=null,$n.zpp_pool=null,Qn.zpp_pool=null,re.ANY_SHAPE=new x,re.ANY_BODY=new x,re.ANY_COMPOUND=new x,re.ANY_CONSTRAINT=new x,oe.internal=!1,oe.id_ImmState_ACCEPT=1,oe.id_ImmState_IGNORE=2,oe.id_ImmState_ALWAYS=4,oe.id_GravMassMode_DEFAULT=0,oe.id_GravMassMode_FIXED=1,oe.id_GravMassMode_SCALED=2,oe.id_InertiaMode_DEFAULT=0,oe.id_InertiaMode_FIXED=1,oe.id_MassMode_DEFAULT=0,oe.id_MassMode_FIXED=1,oe.id_BodyType_STATIC=1,oe.id_BodyType_DYNAMIC=2,oe.id_BodyType_KINEMATIC=3,oe.id_ListenerType_BODY=0,oe.id_PreFlag_ACCEPT=1,oe.id_ListenerType_CONSTRAINT=1,oe.id_PreFlag_IGNORE=2,oe.id_ListenerType_INTERACTION=2,oe.id_PreFlag_ACCEPT_ONCE=3,oe.id_ListenerType_PRE=3,oe.id_PreFlag_IGNORE_ONCE=4,oe.id_CbEvent_BEGIN=0,oe.id_InteractionType_COLLISION=1,oe.id_CbEvent_ONGOING=6,oe.id_InteractionType_SENSOR=2,oe.id_CbEvent_END=1,oe.id_InteractionType_FLUID=4,oe.id_CbEvent_WAKE=2,oe.id_InteractionType_ANY=7,oe.id_CbEvent_SLEEP=3,oe.id_CbEvent_BREAK=4,oe.id_CbEvent_PRE=5,oe.id_Winding_UNDEFINED=0,oe.id_Winding_CLOCKWISE=1,oe.id_Winding_ANTICLOCKWISE=2,oe.id_ValidationResult_VALID=0,oe.id_ValidationResult_DEGENERATE=1,oe.id_ValidationResult_CONCAVE=2,oe.id_ValidationResult_SELF_INTERSECTING=3,oe.id_ShapeType_CIRCLE=0,oe.id_ShapeType_POLYGON=1,oe.id_Broadphase_DYNAMIC_AABB_TREE=0,oe.id_Broadphase_SWEEP_AND_PRUNE=1,oe.id_ArbiterType_COLLISION=1,oe.id_ArbiterType_SENSOR=2,oe.id_ArbiterType_FLUID=4,ae.types=function(n){null==oe.ListenerType_BODY&&(oe.internal=!0,oe.ListenerType_BODY=new w,oe.internal=!1);var e=oe.ListenerType_BODY;null==oe.ListenerType_CONSTRAINT&&(oe.internal=!0,oe.ListenerType_CONSTRAINT=new w,oe.internal=!1);var t=oe.ListenerType_CONSTRAINT;null==oe.ListenerType_INTERACTION&&(oe.internal=!0,oe.ListenerType_INTERACTION=new w,oe.internal=!1);var i=oe.ListenerType_INTERACTION;return null==oe.ListenerType_PRE&&(oe.internal=!0,oe.ListenerType_PRE=new w,oe.internal=!1),[e,t,i,oe.ListenerType_PRE]}(),ae.events=function(n){null==oe.CbEvent_BEGIN&&(oe.internal=!0,oe.CbEvent_BEGIN=new u,oe.internal=!1);var e=oe.CbEvent_BEGIN;null==oe.CbEvent_END&&(oe.internal=!0,oe.CbEvent_END=new u,oe.internal=!1);var t=oe.CbEvent_END;null==oe.CbEvent_WAKE&&(oe.internal=!0,oe.CbEvent_WAKE=new u,oe.internal=!1);var i=oe.CbEvent_WAKE;null==oe.CbEvent_SLEEP&&(oe.internal=!0,oe.CbEvent_SLEEP=new u,oe.internal=!1);var p=oe.CbEvent_SLEEP;null==oe.CbEvent_BREAK&&(oe.internal=!0,oe.CbEvent_BREAK=new u,oe.internal=!1);var l=oe.CbEvent_BREAK;null==oe.CbEvent_PRE&&(oe.internal=!0,oe.CbEvent_PRE=new u,oe.internal=!1);var r=oe.CbEvent_PRE;return null==oe.CbEvent_ONGOING&&(oe.internal=!0,oe.CbEvent_ONGOING=new u,oe.internal=!1),[e,t,i,p,l,r,oe.CbEvent_ONGOING]}(),ue.UCbSet=new le,ue.VCbSet=new le,ue.WCbSet=new le,ue.UCbType=new he,ue.VCbType=new he,ue.WCbType=new he,Ce.internal=!1,Ce.COL=1,Ce.FLUID=4,Ce.SENSOR=2,Ce.types=function(n){null==oe.ArbiterType_COLLISION&&(oe.internal=!0,oe.ArbiterType_COLLISION=new B,oe.internal=!1);var e=oe.ArbiterType_COLLISION;null==oe.ArbiterType_SENSOR&&(oe.internal=!0,oe.ArbiterType_SENSOR=new B,oe.internal=!1);var t=oe.ArbiterType_SENSOR;return null==oe.ArbiterType_FLUID&&(oe.internal=!0,oe.ArbiterType_FLUID=new B,oe.internal=!1),[null,e,t,null,oe.ArbiterType_FLUID]}(),ke.zpp_pool=null,Oe.zpp_pool=null,Pe.FACE1=0,Pe.FACE2=1,Pe.CIRCLE=2,Pe.zpp_pool=null,Se.internal=!1,Se.zpp_pool=null,je.zpp_pool=null,Ee.SHAPE=1,Ee.BODY=2,Te.zpp_pool=null,Le.flowpoly=new Ne,Le.flowsegs=new Ne,De.convexPool=null,De.rayPool=null,De.internal=!1,Fe.zpp_pool=null,Re.zpp_pool=null,Ze.ints=null,Ze.paths=null,Ge.zpp_pool=null,Ue.zpp_pool=null,Ke.zpp_pool=null,We.zpp_pool=null,Ye.me=new Ye,Ye.look_march=[-1,224,56,216,14,-1,54,214,131,99,-1,91,141,109,181,85],Je.zpp_pool=null,He.queue=null,He.edges=null,$e.nextId=0,$e.zpp_pool=null,Qe.zpp_pool=null,et.zpp_pool=null,tt.zpp_pool=null,it.zpp_pool=null,lt.sweep=null,lt.inthash=null,lt.vertices=null,lt.queue=null,lt.ints=null,lt.list_vertices=null,lt.list_queue=null,rt.zpp_pool=null,ot.zpp_pool=null,at.stack=null,st.zpp_pool=null,ht.zpp_pool=null,ut.queue=null,ut.stack=null,ut.edgeSet=null,xt.zpp_pool=null,vt.types=function(n){null==oe.BodyType_STATIC&&(oe.internal=!0,oe.BodyType_STATIC=new Mn,oe.internal=!1);var e=oe.BodyType_STATIC;null==oe.BodyType_DYNAMIC&&(oe.internal=!0,oe.BodyType_DYNAMIC=new Mn,oe.internal=!1);var t=oe.BodyType_DYNAMIC;return null==oe.BodyType_KINEMATIC&&(oe.internal=!0,oe.BodyType_KINEMATIC=new Mn,oe.internal=!1),[null,e,t,oe.BodyType_KINEMATIC]}(),vt.bodystack=null,vt.bodyset=null,vt.cur_graph_depth=0,ft.zpp_pool=null,mt.zpp_pool=null,mt.WAKE=1,mt.PROPS=2,mt.ANGDRAG=4,mt.ARBITERS=8,bt.types=function(n){null==oe.ShapeType_CIRCLE&&(oe.internal=!0,oe.ShapeType_CIRCLE=new Gn,oe.internal=!1);var e=oe.ShapeType_CIRCLE;return null==oe.ShapeType_POLYGON&&(oe.internal=!0,oe.ShapeType_POLYGON=new Gn,oe.internal=!1),[e,oe.ShapeType_POLYGON]}(),wt.zpp_pool=null,wt.internal=!1,kt.zpp_pool=null,Ot.zpp_pool=null,Pt.tmpaabb=new Te,St.FATTEN=3,St.VEL_STEPS=2,At.zpp_pool=null,jt.zpp_pool=null,Et.zpp_pool=null,Nt.zpp_pool=null,Rt.zpp_pool=null,yi.zpp_pool=null,zi.zpp_pool=null,vi.zpp_pool=null,ci.zpp_pool=null,fi.zpp_pool=null,mi.zpp_pool=null,bi.zpp_pool=null,gi.zpp_pool=null,wi.zpp_pool=null,Mi.zpp_pool=null,Ci.zpp_pool=null,ki.zpp_pool=null,Oi.zpp_pool=null,Pi.zpp_pool=null,Si.zpp_pool=null,Ai.zpp_pool=null,ji.zpp_pool=null,Ei.zpp_pool=null,Ii.zpp_pool=null,Ti.zpp_pool=null,Ni.zpp_pool=null,Li.zpp_pool=null,Vi.zpp_pool=null,Di.zpp_pool=null,Fi.zpp_pool=null,Ri.zpp_pool=null,Zi.zpp_pool=null,Bi.zpp_pool=null,Gi.zpp_pool=null,qi.zpp_pool=null,Ui.zpp_pool=null,Ki.zpp_pool=null,Wi.zpp_pool=null,Yi.zpp_pool=null,Ji.zpp_pool=null,Hi.internal=!1,$i.internal=!1,Qi.internal=!1,np.internal=!1,ep.internal=!1,tp.internal=!1,ip.internal=!1,pp.internal=!1,lp.internal=!1,rp.internal=!1,op.internal=!1,ap.internal=!1,sp.internal=!1,_p.internal=!1,hp.internal=!1,xp.poolGeomPoly=null,xp.poolVec2=null,xp.poolVec3=null,dp.zpp_pool=null,yp.zpp_pool=null,zp.zpp_pool=null,vp.zpp_pool=null,cp.zpp_pool=null,fp.zpp_pool=null,mp.zpp_pool=null,bp.zpp_pool=null,Yn.main()}();
var nape_DebugDraw;!function(o){var p,t,n;p=o.constraint||(o.constraint={}),t=nape.geom.Vec2,n=function(){function p(){}return p.indicator=function(o,p,n,e,l){var i=t.get(Math.cos(n),Math.sin(n));o.drawFilledCircle(p.add(i.mul(e,!0),!0),2,l),i.dispose()},p.drawSpiralSpring=function(p,n,e,l,i,r,a,s){if(void 0===s&&(s=4),e>l){var _=e;e=l,l=_;var u=i;i=r,r=u}if(e!=l){for(var d=r-i,z=l-e,h=2*Math.PI*d/z,x=h<0?-h:h,c=Math.ceil(z/o.constraint.ZPP_AngleDraw.maxarc*3),f=4*s,y=c>f?c:f,b=z/y,P=1/y,m=Math.cos(e),g=Math.sin(e),w=i+0*d+.75*x*Math.sin(2*s*Math.PI*0),v=t.get(n.x+w*m,n.y+w*g),C=d+1.5*s*x*Math.PI*Math.cos(2*s*Math.PI*0),S=C*m-w*z*g,Z=C*g+w*z*m,A=t.get(0,0,!1),M=t.get(0,0,!1),T=0;T<y;){var N=T++,O=e+b,D=Math.cos(O),I=Math.sin(O),B=i+d*(N+1)*P+.75*x*Math.sin(2*s*Math.PI*(N+1)*P);A.setxy(n.x+B*D,n.y+B*I);var k=d+1.5*s*x*Math.PI*Math.cos(2*s*Math.PI*(N+1)*P),L=k*D-B*z*I,E=k*I+B*z*D,F=S*E-Z*L;if(F*F<nape.Config.epsilon||S*L+Z*E<=0||S*L+Z*E>.999)p.drawLine(v,A,a);else{var V=((A.x-v.x)*E+(v.y-A.y)*L)/F;V<=0?p.drawLine(v,A,a):(M.x=v.x+S*V,M.y=v.y+Z*V,p.drawCurve(v,M,A,a))}e=O,m=D,g=I,S=L,Z=E,v.set(A)}v.dispose(),A.dispose(),M.dispose()}},p.drawSpiral=function(p,n,e,l,i,r,a){if(e>l){var s=e;e=l,l=s;var _=i;i=r,r=_}if(e!=l){for(var u=r-i,d=l-e,z=Math.ceil(d/o.constraint.ZPP_AngleDraw.maxarc),h=u/z,x=d/z,c=Math.cos(e),f=Math.sin(e),y=t.get(n.x+i*c,n.y+i*f),b=u*c-i*d*f,P=u*f+i*d*c,m=t.get(0,0,!1),g=t.get(0,0,!1),w=0;w<z;){++w;var v=i+h,C=e+x,S=Math.cos(C),Z=Math.sin(C);m.setxy(n.x+v*S,n.y+v*Z);var A=u*S-v*d*Z,M=u*Z+v*d*S,T=b*M-P*A;if(T*T<nape.Config.epsilon)p.drawLine(y,m,a);else{var N=((m.x-y.x)*M+(y.y-m.y)*A)/T;N<=0?p.drawLine(y,m,a):(g.x=y.x+b*N,g.y=y.y+P*N,p.drawCurve(y,g,m,a))}i=v,e=C,c=S,f=Z,b=A,P=M,y.set(m)}y.dispose(),m.dispose(),g.dispose()}},p.maxarc=Math.PI/4,p}(),p.ZPP_AngleDraw=n}(zpp_nape||(zpp_nape={})),function(o){var p=zpp_nape.constraint.ZPP_AngleJoint,t=zpp_nape.constraint.ZPP_PivotJoint,n=zpp_nape.constraint.ZPP_AngleDraw,e=zpp_nape.constraint.ZPP_DistanceJoint,l=zpp_nape.constraint.ZPP_LineJoint,i=zpp_nape.constraint.ZPP_PulleyJoint,r=zpp_nape.constraint.ZPP_UserConstraint,a=zpp_nape.constraint.ZPP_WeldJoint;p.prototype.draw=function(o){var p=this.outer_zn,t=5/Math.PI/2;if(p.body1!=p.body1.space.world){var e=p.ratio*p.body2.rotation-this.jointMin,l=p.ratio*p.body2.rotation-this.jointMax;if(e>l){var i=e;e=l,l=i}if(p.body1.rotation>e){var r=p.body1.rotation,a=r<l?r:l;n.drawSpiral(o,p.body1.position,e,a,10+(e-e)*t,10+(a-e)*t,16776960)}else!this.stiff&&p.body1.rotation<e&&n.drawSpiralSpring(o,p.body1.position,p.body1.rotation,e,10+(p.body1.rotation-e)*t,10+(e-e)*t,16776960);if(p.body1.rotation<l){var s=p.body1.rotation,_=s>e?s:e;n.drawSpiral(o,p.body1.position,_,l,10+(_-e)*t,10+(l-e)*t,65535)}else!this.stiff&&p.body1.rotation>l&&n.drawSpiralSpring(o,p.body1.position,p.body1.rotation,l,10+(p.body1.rotation-e)*t,10+(l-e)*t,65535);n.indicator(o,p.body1.position,p.body1.rotation,10+(p.body1.rotation-e)*t,255)}if(p.body2!=p.body2.space.world){var u=(this.jointMin+p.body1.rotation)/p.ratio,d=(this.jointMax+p.body1.rotation)/p.ratio;if(u>d){var z=u;u=d,d=z}if(p.body2.rotation>u){var h=p.body2.rotation,x=h<d?h:d;n.drawSpiral(o,p.body2.position,u,x,10+(u-u)*t,10+(x-u)*t,16776960)}else!this.stiff&&p.body2.rotation<u&&n.drawSpiralSpring(o,p.body2.position,p.body2.rotation,u,10+(p.body2.rotation-u)*t,10+(u-u)*t,16776960);if(p.body2.rotation<d){var c=p.body2.rotation,f=c>u?c:u;n.drawSpiral(o,p.body2.position,f,d,10+(f-u)*t,10+(d-u)*t,65535)}else!this.stiff&&p.body2.rotation>d&&n.drawSpiralSpring(o,p.body2.position,p.body2.rotation,d,10+(p.body2.rotation-u)*t,10+(d-u)*t,65535);n.indicator(o,p.body2.position,p.body2.rotation,10+(p.body2.rotation-u)*t,16711680)}},t.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e);if(!this.stiff){var i=l.sub(n);0!=i.length&&o.drawSpring(n,l,16711935),i.dispose()}o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),n.dispose(),l.dispose()},e.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e),i=l.sub(n),r=i.length;if(0!=r){i.muleq(1/r);var a=n.add(l).muleq(.5),s=a.sub(i.mul(.5*this.jointMin,!0)),_=a.add(i.mul(.5*this.jointMin,!0)),u=a.sub(i.mul(.5*this.jointMax,!0)),d=a.add(i.mul(.5*this.jointMax,!0));o.drawLine(s,_,16776960),o.drawLine(u,s,65535),o.drawLine(d,_,65535),this.stiff||(r>this.jointMax?(o.drawSpring(u,n,65535),o.drawSpring(d,l,65535)):r<this.jointMin&&(o.drawSpring(s,n,16776960),o.drawSpring(_,l,16776960))),a.dispose(),s.dispose(),_.dispose(),u.dispose(),d.dispose()}o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),n.dispose(),l.dispose(),i.dispose()},l.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e),i=p.direction,r=p.body1.localVectorToWorld(i);r.muleq(1/r.length);var a=p.jointMin,s=p.jointMax;a<=zpp_nape.ZPP_Const.NEGINF()&&(a=-1e3),s>=zpp_nape.ZPP_Const.POSINF()&&(s=1e3);var _=l.sub(n),u=_.dot(r);_.dispose();var d=n.add(r.mul(a,!0)),z=n.add(r.mul(s,!0));if(u>a){var h=s;o.drawLine(d,n.add(r.mul(u<h?u:h,!0),!0),16776960)}if(u<s){var x=a;o.drawLine(n.add(r.mul(u>x?u:x,!0),!0),z,65535)}if(!this.stiff){var c=u<this.jointMin?d.copy():u>this.jointMax?z.copy():n.add(r.mul(u,!0));o.drawSpring(c,l,16711935),c.dispose()}o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),n.dispose(),l.dispose(),d.dispose(),z.dispose()},i.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,n=p.body1.localPointToWorld(t),e=p.anchor2,l=p.body2.localPointToWorld(e),i=p.anchor3,r=p.body3.localPointToWorld(i),a=p.anchor4,s=p.body4.localPointToWorld(a),_=l.sub(n),u=s.sub(r),d=_.length,z=u.length;this.drawLink(o,n,l,_,d,z*this.ratio,1,16776960,65535),this.drawLink(o,r,s,u,z,d,1/this.ratio,65535,16711935),o.drawFilledCircle(n,2,255),o.drawFilledCircle(l,2,16711680),o.drawFilledCircle(r,2,65280),o.drawFilledCircle(s,2,16711935),n.dispose(),l.dispose(),r.dispose(),s.dispose(),_.dispose(),u.dispose()},i.prototype.drawLink=function(o,p,t,n,e,l,i,r,a){if(0!=e){n.muleq(1/e);var s=p.add(t).muleq(.5),_=(this.jointMin-l)*i;_<0&&(_=0);var u=(this.jointMax-l)*i;u<0&&(u=0);var d=s.sub(n.mul(.5*_,!0)),z=s.add(n.mul(.5*_,!0)),h=s.sub(n.mul(.5*u,!0)),x=s.add(n.mul(.5*u,!0));o.drawLine(d,z,r),o.drawLine(h,d,a),o.drawLine(x,z,a),this.stiff||(e>u?(o.drawSpring(h,p,a),o.drawSpring(x,t,a)):e<_&&(o.drawSpring(d,p,r),o.drawSpring(z,t,r))),s.dispose(),d.dispose(),z.dispose(),h.dispose(),x.dispose()}},r.prototype.draw=function(o){this.outer_zn.__draw(o)},a.prototype.draw=function(o){var p=this.outer_zn,t=p.anchor1,e=p.body1.localPointToWorld(t),l=p.anchor2,i=p.body2.localPointToWorld(l);if(!this.stiff){var r=i.sub(e);0!=r.length&&o.drawSpring(e,i,16711935),r.dispose();var a=5/Math.PI/2;if(p.body1!=p.body1.space.world){var s=p.body2.rotation-p.phase,_=p.body1.rotation;if(_>s){var u=_;_=s,s=u}n.drawSpiralSpring(o,p.body1.position,_,s,10+(_-_)*a,10+(s-_)*a,16711808),n.indicator(o,p.body1.position,p.body1.rotation,10+(p.body1.rotation-_)*a,16711808)}if(p.body2!=p.body2.space.world){var d=p.phase+p.body1.rotation,z=p.body2.rotation;if(z>d){var h=z;z=d,d=h}n.drawSpiralSpring(o,p.body2.position,z,d,10+(z-z)*a,10+(d-z)*a,8388863),n.indicator(o,p.body2.position,p.body2.rotation,10+(p.body2.rotation-z)*a,8388863)}}o.drawFilledCircle(e,2,255),o.drawFilledCircle(i,2,16711680),e.dispose(),i.dispose()}}(nape_DebugDraw||(nape_DebugDraw={})),function(o){var p,t,n,e,l,i,r,a,s,_,u,d,z,h,x,c,f,y,b,P,m,g,w,v,C,S,Z,A,M,T,N,O,D,I,B,k,L,E,F,V,W,R,j,K,G,H,q,J,U,Q,X,Y,$,oo,po,to,no,eo,lo,io,ro,ao,so,_o,uo,zo,ho,xo,co,fo,yo,bo,Po,mo,go,wo,vo,Co,So,Zo,Ao,Mo,To,No,Oo,Do,Io,Bo,ko,Lo,Eo,Fo,Vo,Wo,Ro,jo,Ko,Go,Ho,qo,Jo,Uo,Qo,Xo,Yo;p=o.util||(o.util={}),t=o.constraint.ConstraintIterator,n=o.phys.InteractorIterator,e=o.phys.BodyIterator,l=o.phys.CompoundIterator,i=o.callbacks.ListenerIterator,r=o.callbacks.CbTypeIterator,a=o.geom.ConvexResultIterator,s=o.geom.GeomPolyIterator,_=o.geom.RayResultIterator,u=o.geom.Vec2Iterator,d=o.shape.ShapeIterator,z=o.shape.EdgeIterator,h=o.dynamics.ContactIterator,x=o.dynamics.ArbiterIterator,c=o.dynamics.InteractionGroupIterator,f=zpp_nape.util.ZNPNode_ZPP_CbType,y=zpp_nape.util.ZNPNode_ZPP_CallbackSet,b=zpp_nape.phys.ZPP_Material,P=zpp_nape.util.ZNPNode_ZPP_Shape,m=zpp_nape.phys.ZPP_FluidProperties,g=zpp_nape.util.ZNPNode_ZPP_Body,w=zpp_nape.util.ZNPNode_ZPP_Constraint,v=zpp_nape.util.ZNPNode_ZPP_Compound,C=zpp_nape.util.ZNPNode_ZPP_Arbiter,S=zpp_nape.util.ZPP_Set_ZPP_Body,Z=zpp_nape.callbacks.ZPP_CbSetPair,A=zpp_nape.util.ZNPNode_ZPP_InteractionListener,M=zpp_nape.util.ZNPNode_ZPP_CbSet,T=zpp_nape.util.ZNPNode_ZPP_Interactor,N=zpp_nape.util.ZNPNode_ZPP_BodyListener,O=zpp_nape.callbacks.ZPP_Callback,D=zpp_nape.callbacks.ZPP_CbSet,I=zpp_nape.util.ZNPNode_ZPP_CbSetPair,B=zpp_nape.util.ZNPNode_ZPP_ConstraintListener,k=zpp_nape.geom.ZPP_GeomVertexIterator,L=zpp_nape.geom.ZPP_GeomVert,E=zpp_nape.geom.ZPP_Mat23,F=zpp_nape.util.ZPP_Set_ZPP_CbSetPair,V=zpp_nape.geom.ZPP_CutVert,W=zpp_nape.geom.ZPP_CutInt,R=zpp_nape.util.ZNPNode_ZPP_CutInt,j=zpp_nape.util.ZNPNode_ZPP_CutVert,K=zpp_nape.geom.ZPP_Vec2,G=zpp_nape.util.ZNPNode_ZPP_PartitionVertex,H=zpp_nape.geom.ZPP_PartitionVertex,q=zpp_nape.util.ZPP_Set_ZPP_PartitionVertex,J=zpp_nape.geom.ZPP_SimplifyV,U=zpp_nape.geom.ZPP_SimplifyP,Q=zpp_nape.geom.ZPP_PartitionedPoly,X=zpp_nape.util.ZNPNode_ZPP_SimplifyP,Y=zpp_nape.util.ZNPNode_ZPP_PartitionedPoly,$=zpp_nape.util.ZPP_Set_ZPP_PartitionPair,oo=zpp_nape.util.ZNPNode_ZPP_GeomVert,po=zpp_nape.geom.ZPP_AABB,to=zpp_nape.util.ZPP_Set_ZPP_SimpleVert,no=zpp_nape.geom.ZPP_PartitionPair,eo=zpp_nape.geom.ZPP_SimpleVert,lo=zpp_nape.geom.ZPP_SimpleSeg,io=zpp_nape.util.ZPP_Set_ZPP_SimpleSeg,ro=zpp_nape.util.ZPP_Set_ZPP_SimpleEvent,ao=zpp_nape.geom.ZPP_SimpleEvent,so=zpp_nape.util.Hashable2_Boolfalse,_o=zpp_nape.geom.ZPP_ToiEvent,uo=zpp_nape.util.ZNPNode_ZPP_SimpleVert,zo=zpp_nape.util.ZNPNode_ZPP_SimpleEvent,ho=zpp_nape.geom.ZPP_MarchSpan,xo=zpp_nape.geom.ZPP_MarchPair,co=zpp_nape.util.ZNPNode_ZPP_Vec2,fo=zpp_nape.shape.ZPP_Edge,yo=zpp_nape.util.ZNPNode_ZPP_AABBPair,bo=zpp_nape.util.ZNPNode_ZPP_Edge,Po=zpp_nape.space.ZPP_SweepData,mo=zpp_nape.space.ZPP_AABBNode,go=zpp_nape.space.ZPP_AABBPair,wo=zpp_nape.util.ZNPNode_ZPP_AABBNode,vo=zpp_nape.dynamics.ZPP_Contact,Co=zpp_nape.util.ZNPNode_ZPP_Component,So=zpp_nape.space.ZPP_Island,Zo=zpp_nape.space.ZPP_Component,Ao=zpp_nape.space.ZPP_CallbackSet,Mo=zpp_nape.util.ZPP_Set_ZPP_CbSet,To=zpp_nape.util.ZNPNode_ZPP_FluidArbiter,No=zpp_nape.dynamics.ZPP_ColArbiter,Oo=zpp_nape.util.ZNPNode_ZPP_SensorArbiter,Do=zpp_nape.util.ZNPNode_ZPP_Listener,Io=zpp_nape.util.ZNPNode_ZPP_ColArbiter,Bo=zpp_nape.util.ZNPNode_ZPP_InteractionGroup,ko=zpp_nape.util.ZNPNode_ZPP_ToiEvent,Lo=zpp_nape.dynamics.ZPP_InteractionFilter,Eo=zpp_nape.util.ZNPNode_ConvexResult,Fo=zpp_nape.util.ZNPNode_ZPP_GeomPoly,Vo=zpp_nape.util.ZNPNode_RayResult,Wo=zpp_nape.util.ZPP_PubPool,Ro=zpp_nape.dynamics.ZPP_SensorArbiter,jo=zpp_nape.dynamics.ZPP_FluidArbiter,Ko=o.space.Space,Go=o.phys.Body,Ho=o.geom.Vec2,qo=o.geom.Vec2List,Jo=o.geom.GeomPoly,Uo=o.phys.Compound,Qo=o.shape.Shape,Xo=o.constraint.Constraint,Yo=function(){function o(){this.zpp_inner=null,this.drawCollisionArbiters=!1,this.drawFluidArbiters=!1,this.drawSensorArbiters=!1,this.drawBodies=!1,this.drawBodyDetail=!1,this.drawShapeDetail=!1,this.drawShapeAngleIndicators=!1,this.drawConstraints=!1,this.cullingEnabled=!1,this.drawCollisionArbiters=!1,this.drawFluidArbiters=!1,this.drawSensorArbiters=!1,this.drawBodies=!0,this.drawShapeAngleIndicators=!0,this.drawBodyDetail=!1,this.drawShapeDetail=!1,this.drawConstraints=!1,this.cullingEnabled=!1,this.colour=null}return o.version=function(){return"Nape 2.0.19"},o.clearObjectPools=function(){for(;null!=t.zpp_pool;){var o=t.zpp_pool.zpp_next;t.zpp_pool.zpp_next=null,t.zpp_pool=o}for(;null!=n.zpp_pool;){o=n.zpp_pool.zpp_next;n.zpp_pool.zpp_next=null,n.zpp_pool=o}for(;null!=e.zpp_pool;){o=e.zpp_pool.zpp_next;e.zpp_pool.zpp_next=null,e.zpp_pool=o}for(;null!=l.zpp_pool;){o=l.zpp_pool.zpp_next;l.zpp_pool.zpp_next=null,l.zpp_pool=o}for(;null!=i.zpp_pool;){o=i.zpp_pool.zpp_next;i.zpp_pool.zpp_next=null,i.zpp_pool=o}for(;null!=r.zpp_pool;){o=r.zpp_pool.zpp_next;r.zpp_pool.zpp_next=null,r.zpp_pool=o}for(;null!=a.zpp_pool;){o=a.zpp_pool.zpp_next;a.zpp_pool.zpp_next=null,a.zpp_pool=o}for(;null!=s.zpp_pool;){o=s.zpp_pool.zpp_next;s.zpp_pool.zpp_next=null,s.zpp_pool=o}for(;null!=u.zpp_pool;){o=u.zpp_pool.zpp_next;u.zpp_pool.zpp_next=null,u.zpp_pool=o}for(;null!=_.zpp_pool;){o=_.zpp_pool.zpp_next;_.zpp_pool.zpp_next=null,_.zpp_pool=o}for(;null!=d.zpp_pool;){o=d.zpp_pool.zpp_next;d.zpp_pool.zpp_next=null,d.zpp_pool=o}for(;null!=z.zpp_pool;){o=z.zpp_pool.zpp_next;z.zpp_pool.zpp_next=null,z.zpp_pool=o}for(;null!=h.zpp_pool;){o=h.zpp_pool.zpp_next;h.zpp_pool.zpp_next=null,h.zpp_pool=o}for(;null!=x.zpp_pool;){o=x.zpp_pool.zpp_next;x.zpp_pool.zpp_next=null,x.zpp_pool=o}for(;null!=c.zpp_pool;){o=c.zpp_pool.zpp_next;c.zpp_pool.zpp_next=null,c.zpp_pool=o}for(;null!=f.zpp_pool;){o=f.zpp_pool.next;f.zpp_pool.next=null,f.zpp_pool=o}for(;null!=y.zpp_pool;){o=y.zpp_pool.next;y.zpp_pool.next=null,y.zpp_pool=o}for(;null!=b.zpp_pool;){o=b.zpp_pool.next;b.zpp_pool.next=null,b.zpp_pool=o}for(;null!=P.zpp_pool;){o=P.zpp_pool.next;P.zpp_pool.next=null,P.zpp_pool=o}for(;null!=m.zpp_pool;){o=m.zpp_pool.next;m.zpp_pool.next=null,m.zpp_pool=o}for(;null!=g.zpp_pool;){o=g.zpp_pool.next;g.zpp_pool.next=null,g.zpp_pool=o}for(;null!=w.zpp_pool;){o=w.zpp_pool.next;w.zpp_pool.next=null,w.zpp_pool=o}for(;null!=v.zpp_pool;){o=v.zpp_pool.next;v.zpp_pool.next=null,v.zpp_pool=o}for(;null!=C.zpp_pool;){o=C.zpp_pool.next;C.zpp_pool.next=null,C.zpp_pool=o}for(;null!=S.zpp_pool;){o=S.zpp_pool.next;S.zpp_pool.next=null,S.zpp_pool=o}for(;null!=Z.zpp_pool;){o=Z.zpp_pool.next;Z.zpp_pool.next=null,Z.zpp_pool=o}for(;null!=A.zpp_pool;){o=A.zpp_pool.next;A.zpp_pool.next=null,A.zpp_pool=o}for(;null!=M.zpp_pool;){o=M.zpp_pool.next;M.zpp_pool.next=null,M.zpp_pool=o}for(;null!=T.zpp_pool;){o=T.zpp_pool.next;T.zpp_pool.next=null,T.zpp_pool=o}for(;null!=N.zpp_pool;){o=N.zpp_pool.next;N.zpp_pool.next=null,N.zpp_pool=o}for(;null!=O.zpp_pool;){o=O.zpp_pool.next;O.zpp_pool.next=null,O.zpp_pool=o}for(;null!=D.zpp_pool;){o=D.zpp_pool.next;D.zpp_pool.next=null,D.zpp_pool=o}for(;null!=I.zpp_pool;){o=I.zpp_pool.next;I.zpp_pool.next=null,I.zpp_pool=o}for(;null!=B.zpp_pool;){o=B.zpp_pool.next;B.zpp_pool.next=null,B.zpp_pool=o}for(;null!=L.zpp_pool;){o=L.zpp_pool.next;L.zpp_pool.next=null,L.zpp_pool=o}for(;null!=k.zpp_pool;){o=k.zpp_pool.next;k.zpp_pool.next=null,k.zpp_pool=o}for(;null!=E.zpp_pool;){o=E.zpp_pool.next;E.zpp_pool.next=null,E.zpp_pool=o}for(;null!=F.zpp_pool;){o=F.zpp_pool.next;F.zpp_pool.next=null,F.zpp_pool=o}for(;null!=V.zpp_pool;){o=V.zpp_pool.next;V.zpp_pool.next=null,V.zpp_pool=o}for(;null!=W.zpp_pool;){o=W.zpp_pool.next;W.zpp_pool.next=null,W.zpp_pool=o}for(;null!=R.zpp_pool;){o=R.zpp_pool.next;R.zpp_pool.next=null,R.zpp_pool=o}for(;null!=j.zpp_pool;){o=j.zpp_pool.next;j.zpp_pool.next=null,j.zpp_pool=o}for(;null!=K.zpp_pool;){o=K.zpp_pool.next;K.zpp_pool.next=null,K.zpp_pool=o}for(;null!=G.zpp_pool;){o=G.zpp_pool.next;G.zpp_pool.next=null,G.zpp_pool=o}for(;null!=H.zpp_pool;){o=H.zpp_pool.next;H.zpp_pool.next=null,H.zpp_pool=o}for(;null!=q.zpp_pool;){o=q.zpp_pool.next;q.zpp_pool.next=null,q.zpp_pool=o}for(;null!=J.zpp_pool;){o=J.zpp_pool.next;J.zpp_pool.next=null,J.zpp_pool=o}for(;null!=U.zpp_pool;){o=U.zpp_pool.next;U.zpp_pool.next=null,U.zpp_pool=o}for(;null!=Q.zpp_pool;){o=Q.zpp_pool.next;Q.zpp_pool.next=null,Q.zpp_pool=o}for(;null!=X.zpp_pool;){o=X.zpp_pool.next;X.zpp_pool.next=null,X.zpp_pool=o}for(;null!=Y.zpp_pool;){o=Y.zpp_pool.next;Y.zpp_pool.next=null,Y.zpp_pool=o}for(;null!=no.zpp_pool;){o=no.zpp_pool.next;no.zpp_pool.next=null,no.zpp_pool=o}for(;null!=$.zpp_pool;){o=$.zpp_pool.next;$.zpp_pool.next=null,$.zpp_pool=o}for(;null!=oo.zpp_pool;){o=oo.zpp_pool.next;oo.zpp_pool.next=null,oo.zpp_pool=o}for(;null!=po.zpp_pool;){o=po.zpp_pool.next;po.zpp_pool.next=null,po.zpp_pool=o}for(;null!=to.zpp_pool;){o=to.zpp_pool.next;to.zpp_pool.next=null,to.zpp_pool=o}for(;null!=eo.zpp_pool;){o=eo.zpp_pool.next;eo.zpp_pool.next=null,eo.zpp_pool=o}for(;null!=lo.zpp_pool;){o=lo.zpp_pool.next;lo.zpp_pool.next=null,lo.zpp_pool=o}for(;null!=io.zpp_pool;){o=io.zpp_pool.next;io.zpp_pool.next=null,io.zpp_pool=o}for(;null!=ro.zpp_pool;){o=ro.zpp_pool.next;ro.zpp_pool.next=null,ro.zpp_pool=o}for(;null!=ao.zpp_pool;){o=ao.zpp_pool.next;ao.zpp_pool.next=null,ao.zpp_pool=o}for(;null!=so.zpp_pool;){o=so.zpp_pool.next;so.zpp_pool.next=null,so.zpp_pool=o}for(;null!=_o.zpp_pool;){o=_o.zpp_pool.next;_o.zpp_pool.next=null,_o.zpp_pool=o}for(;null!=uo.zpp_pool;){o=uo.zpp_pool.next;uo.zpp_pool.next=null,uo.zpp_pool=o}for(;null!=zo.zpp_pool;){o=zo.zpp_pool.next;zo.zpp_pool.next=null,zo.zpp_pool=o}for(;null!=ho.zpp_pool;){o=ho.zpp_pool.next;ho.zpp_pool.next=null,ho.zpp_pool=o}for(;null!=xo.zpp_pool;){o=xo.zpp_pool.next;xo.zpp_pool.next=null,xo.zpp_pool=o}for(;null!=co.zpp_pool;){o=co.zpp_pool.next;co.zpp_pool.next=null,co.zpp_pool=o}for(;null!=fo.zpp_pool;){o=fo.zpp_pool.next;fo.zpp_pool.next=null,fo.zpp_pool=o}for(;null!=yo.zpp_pool;){o=yo.zpp_pool.next;yo.zpp_pool.next=null,yo.zpp_pool=o}for(;null!=bo.zpp_pool;){o=bo.zpp_pool.next;bo.zpp_pool.next=null,bo.zpp_pool=o}for(;null!=Po.zpp_pool;){o=Po.zpp_pool.next;Po.zpp_pool.next=null,Po.zpp_pool=o}for(;null!=mo.zpp_pool;){o=mo.zpp_pool.next;mo.zpp_pool.next=null,mo.zpp_pool=o}for(;null!=go.zpp_pool;){o=go.zpp_pool.next;go.zpp_pool.next=null,go.zpp_pool=o}for(;null!=wo.zpp_pool;){o=wo.zpp_pool.next;wo.zpp_pool.next=null,wo.zpp_pool=o}for(;null!=vo.zpp_pool;){o=vo.zpp_pool.next;vo.zpp_pool.next=null,vo.zpp_pool=o}for(;null!=Co.zpp_pool;){o=Co.zpp_pool.next;Co.zpp_pool.next=null,Co.zpp_pool=o}for(;null!=So.zpp_pool;){o=So.zpp_pool.next;So.zpp_pool.next=null,So.zpp_pool=o}for(;null!=Zo.zpp_pool;){o=Zo.zpp_pool.next;Zo.zpp_pool.next=null,Zo.zpp_pool=o}for(;null!=Ao.zpp_pool;){o=Ao.zpp_pool.next;Ao.zpp_pool.next=null,Ao.zpp_pool=o}for(;null!=Ro.zpp_pool;){o=Ro.zpp_pool.next;Ro.zpp_pool.next=null,Ro.zpp_pool=o}for(;null!=jo.zpp_pool;){o=jo.zpp_pool.next;jo.zpp_pool.next=null,jo.zpp_pool=o}for(;null!=Mo.zpp_pool;){o=Mo.zpp_pool.next;Mo.zpp_pool.next=null,Mo.zpp_pool=o}for(;null!=To.zpp_pool;){o=To.zpp_pool.next;To.zpp_pool.next=null,To.zpp_pool=o}for(;null!=No.zpp_pool;){o=No.zpp_pool.next;No.zpp_pool.next=null,No.zpp_pool=o}for(;null!=Oo.zpp_pool;){o=Oo.zpp_pool.next;Oo.zpp_pool.next=null,Oo.zpp_pool=o}for(;null!=Do.zpp_pool;){o=Do.zpp_pool.next;Do.zpp_pool.next=null,Do.zpp_pool=o}for(;null!=Io.zpp_pool;){o=Io.zpp_pool.next;Io.zpp_pool.next=null,Io.zpp_pool=o}for(;null!=Bo.zpp_pool;){o=Bo.zpp_pool.next;Bo.zpp_pool.next=null,Bo.zpp_pool=o}for(;null!=ko.zpp_pool;){o=ko.zpp_pool.next;ko.zpp_pool.next=null,ko.zpp_pool=o}for(;null!=Lo.zpp_pool;){o=Lo.zpp_pool.next;Lo.zpp_pool.next=null,Lo.zpp_pool=o}for(;null!=Eo.zpp_pool;){o=Eo.zpp_pool.next;Eo.zpp_pool.next=null,Eo.zpp_pool=o}for(;null!=Fo.zpp_pool;){o=Fo.zpp_pool.next;Fo.zpp_pool.next=null,Fo.zpp_pool=o}for(;null!=Vo.zpp_pool;){o=Vo.zpp_pool.next;Vo.zpp_pool.next=null,Vo.zpp_pool=o}for(;null!=Wo.poolGeomPoly;){o=Wo.poolGeomPoly.zpp_pool;Wo.poolGeomPoly.zpp_pool=null,Wo.poolGeomPoly=o}for(;null!=Wo.poolVec2;){o=Wo.poolVec2.zpp_pool;Wo.poolVec2.zpp_pool=null,Wo.poolVec2=o}for(;null!=Wo.poolVec3;){o=Wo.poolVec3.zpp_pool;Wo.poolVec3.zpp_pool=null,Wo.poolVec3=o}},o.TIMES=function(p){var t="",n=p.timeStamp-o.ltime;return t+="Validation:    "+(o.VALID/n).toString().substr(0,5)+"ms\n",t+="Broadphase:    "+((o.BROAD-o.NARROW)/n).toString().substr(0,5)+"ms :: total = "+(o.BROAD/n).toString().substr(0,5)+"ms\n",t+="Narrowphase:   "+(o.NARROW/n).toString().substr(0,5)+"ms\n",t+="Set-Forest:    "+(o.FOR/n).toString().substr(0,5)+"ms\n",t+="Prestep:       "+(o.PRE/n).toString().substr(0,5)+"ms\n",t+="Contact sort:  "+(o.SORT/n).toString().substr(0,5)+"ms\n",t+="Position It.:  "+(o.POS/n).toString().substr(0,5)+"ms\n",t+="Velocity It.:  "+(o.VEL/n).toString().substr(0,5)+"ms\n",t+="Debug Draw:    "+(o.DRAW/n).toString().substr(0,5)+"ms\n",t+="\n",t+="arb:        "+o.ACNT+"\n",t+="active arb: "+o.AACNT+"\n",t+="con:        "+o.CCNT+"\n",t+="active con: "+o.ACCNT+"\n",t+="\n",t+="hash collisions: "+(o.HASH/o.HASHT*100).toString().substr(0,5)+"%\n",t+="\n",t+="Broadphase adjustments: "+(o.BROADCLASH/o.BROADTOTAL*100).toString().substr(0,5)+"%\n",p.timeStamp-o.ltime>50&&(o.FOR=o.BROAD=o.PRE=o.POS=o.VEL=o.DRAW=o.VALID=o.SORT=o.NARROW=o.BROADCLASH=o.BROADTOTAL=0,o.ltime=p.timeStamp),t},o.createGraphic=function(p){if(null==p)throw new Error("Error: Cannot create debug graphic for null Body");var t=new createjs.Shape,n=t.graphics,e=Math.floor(16777215*Math.exp(-p.id/1500)),l=.7*((16711680&e)>>16),i=.7*((65280&e)>>8),r=.7*(255&e),a=Math.floor(l)<<16|Math.floor(i)<<8|Math.floor(r);o.lineStyle(n,.1,a,1);for(var s=p.shapes.iterator();s.hasNext();){var _=s.next();if(_.isCircle()){var u=_.castCircle;n.drawCircle(u.localCOM.x,u.localCOM.y,u.radius)}else{var d=_.castPolygon;n.moveTo(_.localCOM.x,_.localCOM.y);for(var z=-0,h=d.worldVerts.length;z<h;z++){var x=d.localVerts.at(z);n.lineTo(x.x,x.y)}x=d.localVerts.at(0);n.lineTo(x.x,x.y)}if(_.isCircle()){u=_.castCircle;n.moveTo(u.localCOM.x+.3*u.radius,u.localCOM.y),n.lineTo(u.localCOM.x+u.radius,u.localCOM.y)}}return t},Object.defineProperty(o.prototype,"bgColour",{get:function(){return this.zpp_inner.bg_col},set:function(o){this.zpp_inner.d_shape.setbg(o)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"display",{get:function(){return this.zpp_inner.d_shape.shape},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"transform",{get:function(){return null==this.zpp_inner.xform&&this.zpp_inner.setform(),this.zpp_inner.xform.outer},set:function(o){this.transform.set(o)},enumerable:!0,configurable:!0}),o.prototype.clear=function(){},o.prototype.flush=function(){},o.prototype.draw=function(o){},o.prototype.drawLine=function(o,p,t){},o.prototype.drawCurve=function(o,p,t,n){},o.prototype.drawCircle=function(o,p,t){},o.prototype.drawAABB=function(o,p){},o.prototype.drawFilledTriangle=function(o,p,t,n){},o.prototype.drawFilledCircle=function(o,p,t){},o.prototype.drawPolygon=function(o,p){},o.prototype.drawFilledPolygon=function(o,p){},o.prototype.drawSpring=function(o,p,t,n,e){void 0===n&&(n=3),void 0===e&&(e=3)},o.lineStyle=function(o,p,t,n){void 0===n&&(n=1);var e=(16711680&t)>>16,l=(65280&t)>>8,i=255&t;o.setStrokeStyle(p).beginStroke("rgba("+e+","+l+","+i+","+n+")")},o.WEAK=function(o){return!!o.zpp_inner.weak&&(o.dispose(),!0)},o.PolyWeak=function(p){if(p instanceof Array&&null==p.__enum__)for(var t=p,n=0;n<t.length;){var e=t[n];o.WEAK(e)?t.splice(n,1):n++}else if(p instanceof qo){null!=(t=p).zpp_inner._validate&&t.zpp_inner._validate();var l=t.zpp_inner.inner,i=null;for(e=l.begin();null!=e;){var r=e.elem();r.outer.zpp_inner.weak?(e=l.erase(i),o.WEAK(r.outer)):(i=e,e=e.next)}}},o.PolyIter=function(o,p){if(o instanceof Array&&null==o.__enum__)for(var t in o)p(o[t]);else if(o instanceof qo)for(var n=o.iterator();n.hasNext();)p(n.next());else if(o instanceof Jo)for(n=o.iterator();n.hasNext();)p(n.next())},o.debug_draw=function(o,p){o.zpp_inner.xnull?p instanceof Ko?o.zpp_inner_zn.draw_space(p.zpp_inner,null,1,!0):p instanceof Uo?o.zpp_inner_zn.draw_compound(p.zpp_inner,null,1,!0):p instanceof Go?o.zpp_inner_zn.draw_body(p.zpp_inner,null,1,!0):p instanceof Qo?o.zpp_inner_zn.draw_shape(p.zpp_inner,null,1,!0):p instanceof Xo&&p.zpp_inner.draw(o):p instanceof Ko?o.zpp_inner_zn.draw_space(p.zpp_inner,o.zpp_inner.xform,o.zpp_inner.xdet,!1):p instanceof Go?o.zpp_inner_zn.draw_body(p.zpp_inner,o.zpp_inner.xform,o.zpp_inner.xdet,!1):p instanceof Qo?o.zpp_inner_zn.draw_shape(p.zpp_inner,o.zpp_inner.xform,o.zpp_inner.xdet,!1):p instanceof Xo&&p.zpp_inner.draw(o)},o.debug_spring=function(p,t,n,e,l,i){if(0==l)p.drawLine(t,n,e);else{var r=n.x-t.x,a=n.y-t.y,s=r*=z=1/(4*l),_=a*=z;if(s*s+_*_<.1)return;var u=s*s+_*_,d=1/Math.sqrt(u),z=s*=d;s=-(_*=d),_=z,s*=z=2*i,_*=z;for(var h=t.copy(),x=Ho.get(0,0,!1),c=Ho.get(0,0,!1),f=0;f<l;f++)x.x=h.x+r+s,x.y=h.y+a+_,c.x=h.x+2*r,c.y=h.y+2*a,p.drawCurve(h,x,c,e),h.x=c.x,h.y=c.y,x.x=h.x+r-s,x.y=h.y+a-_,c.x=h.x+2*r,c.y=h.y+2*a,p.drawCurve(h,x,c,e),h.x=c.x,h.y=c.y;h.dispose(),x.dispose(),c.dispose()}o.WEAK(t),o.WEAK(n)},o.ltime=0,o.ACNT=0,o.AACNT=0,o.CCNT=0,o.ACCNT=0,o.FOR=0,o.PRE=0,o.VEL=0,o.POS=0,o.BROAD=0,o.NARROW=0,o.DRAW=0,o.VALID=0,o.SORT=0,o.HASH=0,o.HASHT=0,o.BROADCLASH=0,o.BROADTOTAL=0,o}(),p.Debug=Yo}(nape||(nape={})),function(o){var p,t,n,e,l;p=o.util||(o.util={}),t=o.geom.ZPP_AABB,n=nape.geom.Vec2,e=nape.geom.Mat23,l=function(){function o(o,p){this.outer=null,this.isbmp=!1,this.d_shape=null,this.bg_r=0,this.bg_g=0,this.bg_b=0,this.bg_col=0,this.xform=null,this.xnull=!1,this.xdet=0,this.width=0,this.height=0,this.viewport=null,this.iport=null,this.tmpab=null,this.xnull=!0,this.xdet=1,this.width=o,this.height=p,this.viewport=t.get(0,0,o,p),this.iport=t.get(0,0,o,p),this.tmpab=new t}return o.prototype.xform_invalidate=function(){var o=this.xform.outer.determinant;this.xdet=Math.sqrt(o<0?-o:o),this.xnull=1==this.xform.a&&0==this.xform.b&&0==this.xform.c&&1==this.xform.d&&0==this.xform.tx&&0==this.xform.ty;var p=this.xform.outer.inverse(),t=n.get(0,0,!1),e=p.transform(t);this.iport.minx=e.x,this.iport.miny=e.y,this.iport.maxx=this.iport.minx,this.iport.maxy=this.iport.miny,e.dispose(),t.x=this.width,e=p.transform(t),this.iport.setExpandPoint(e.x,e.y),e.dispose(),t.y=this.height,e=p.transform(t),this.iport.setExpandPoint(e.x,e.y),e.dispose(),t.x=0,e=p.transform(t),this.iport.setExpandPoint(e.x,e.y),e.dispose(),t.dispose()},o.prototype.setform=function(){this.xform=(new e).zpp_inner,this.xform._invalidate=this.xform_invalidate},o.prototype.cull=function(o){if(this.xnull)return o.intersect(this.viewport);var p=0,t=0,n=0,e=0;return n=o.minx,e=o.miny,this.tmpab.minx=this.xform.a*n+this.xform.b*e+this.xform.tx,this.tmpab.miny=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.maxx=this.tmpab.minx,this.tmpab.maxy=this.tmpab.miny,n=o.maxx,p=this.xform.a*n+this.xform.b*e+this.xform.tx,t=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.setExpandPoint(p,t),e=o.maxy,p=this.xform.a*n+this.xform.b*e+this.xform.tx,t=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.setExpandPoint(p,t),n=o.minx,p=this.xform.a*n+this.xform.b*e+this.xform.tx,t=this.xform.c*n+this.xform.d*e+this.xform.ty,this.tmpab.setExpandPoint(p,t),this.tmpab.intersect(this.viewport)},o.prototype.sup_setbg=function(o){this.bg_r=o>>16&255,this.bg_g=o>>8&255,this.bg_b=255&o,this.bg_col=o},o.prototype.colour=function(o,p){var t,n=.7*((16711680&(t=null==this.outer.colour?Math.floor(16777215*Math.exp(-o%500/1500)):this.outer.colour(o)))>>16),e=.7*((65280&t)>>8),l=.7*(255&t);return p&&(n=.4*n+.6*this.bg_r,e=.4*e+.6*this.bg_g,l=.4*l+.6*this.bg_b),4278190080|Math.floor(n)<<16|Math.floor(e)<<8|Math.floor(l)},o.prototype.tint=function(o,p,t){var n=o,e=p,l=t;return 4278190080|Math.floor((n>>16&255)*l+(e>>16&255)*(1-l))<<16|Math.floor((n>>8&255)*l+(e>>8&255)*(1-l))<<8|Math.floor((255&n)*l+(255&e)*(1-l))},o.internal=!1,o}(),p.ZPP_Debug=l}(zpp_nape||(zpp_nape={}));var zpp_nape,__extends=this&&this.__extends||function(o,p){for(var t in p)p.hasOwnProperty(t)&&(o[t]=p[t]);function n(){this.constructor=o}o.prototype=null===p?Object.create(p):(n.prototype=p.prototype,new n)};!function(o){var p,t;p=o.util||(o.util={}),t=function(o){function t(p,t){o.call(this,p,t),this.outer_zn=null,this.shape=null,this.graphics=null,this.compoundstack=null,this.shapeList=null,this.bodyList=null,this.shape=new createjs.Shape,this.graphics=this.shape.graphics,this.isbmp=!1,this.d_shape=this}return __extends(t,o),t.prototype.setbg=function(o){this.sup_setbg(o)},t.prototype.draw_compound=function(o,p,t,n){for(var e=o.compounds.begin();null!=e;){var l=e.elem();this.draw_compound(l,p,t,n),e=e.next}for(e=o.bodies.begin();null!=e;){var i=e.elem();i.outer.debugDraw&&this.draw_body(i,p,t,n),e=e.next}for(e=o.constraints.begin();null!=e;){(l=e.elem()).active&&l.outer.debugDraw&&l.draw(this.outer),e=e.next}},t.prototype.draw_space=function(o,t,n,e){if(this.outer.cullingEnabled){if(this.outer.drawBodies)if(this.outer.drawBodyDetail)for(var l=this.bodyList=o.bphase.bodiesInAABB(this.iport,!1,!1,null,this.bodyList);!l.empty();){var i=l.shift();i.debugDraw&&this.draw_body(i.zpp_inner,t,n,e)}else for(var r=this.shapeList=o.bphase.shapesInAABB(this.iport,!1,!1,null,this.shapeList);!r.empty();){var a=r.shift();a.body.debugDraw&&this.draw_shape(a.zpp_inner,t,n,e)}}else if(this.outer.drawBodies){null==this.compoundstack&&(this.compoundstack=new p.ZNPList_ZPP_Compound);for(var s=o.bodies.begin();null!=s;){var _=s.elem();_.outer.debugDraw&&this.draw_body(_,t,n,e),s=s.next}for(s=o.compounds.begin();null!=s;){var u=s.elem();this.compoundstack.add(u),s=s.next}for(;!this.compoundstack.empty();){for(s=(x=this.compoundstack.pop_unsafe()).bodies.begin();null!=s;){var d=s.elem();d.outer.debugDraw&&this.draw_body(d,t,n,e),s=s.next}for(s=x.compounds.begin();null!=s;){u=s.elem();this.compoundstack.add(u),s=s.next}}}if(this.outer.drawCollisionArbiters||this.outer.drawFluidArbiters||this.outer.drawSensorArbiters)for(var z=o.outer.arbiters.iterator();z.hasNext();){var h=z.next();this.draw_arbiter(h.zpp_inner,t,n,e)}if(this.outer.drawConstraints){null==this.compoundstack&&(this.compoundstack=new p.ZNPList_ZPP_Compound);for(s=o.constraints.begin();null!=s;){(u=s.elem()).active&&u.outer.debugDraw&&u.draw(this.outer),s=s.next}for(s=o.compounds.begin();null!=s;){u=s.elem();this.compoundstack.add(u),s=s.next}for(;!this.compoundstack.empty();){var x;for(s=(x=this.compoundstack.pop_unsafe()).constraints.begin();null!=s;){(u=s.elem()).active&&u.outer.debugDraw&&u.draw(this.outer),s=s.next}for(s=x.compounds.begin();null!=s;){u=s.elem();this.compoundstack.add(u),s=s.next}}}},t.prototype.draw_body=function(o,p,t,n){for(var e=this.graphics,l=o.shapes.begin();null!=l;){var i=l.elem();this.draw_shape(i,p,t,n),l=l.next}if(this.outer.drawBodyDetail){var r=this.colour(o.id,null!=o.space&&o.outer.isSleeping);this.lineStyle(this.tint(r,16711680,.8),1);var a=0,s=0,_=0,u=0;o.shapes.empty()||(o.validate_worldCOM(),n?(a=o.worldCOMx,s=o.worldCOMy):(a=p.a*o.worldCOMx+p.b*o.worldCOMy+p.tx,s=p.c*o.worldCOMx+p.d*o.worldCOMy+p.ty),e.drawCircle(a,s,1),o.validate_aabb(),this.AABB(o,n,p,o.aabb)),n?(_=o.pre_posx,u=o.pre_posy):(_=p.a*o.pre_posx+p.b*o.pre_posy+p.tx,u=p.c*o.pre_posx+p.d*o.pre_posy+p.ty),n?(a=o.posx,s=o.posy):(a=p.a*o.posx+p.b*o.posy+p.tx,s=p.c*o.posx+p.d*o.posy+p.ty),e.moveTo(_,u),e.lineTo(a,s),e.drawCircle(a,s,1)}},t.prototype.draw_shape=function(o,p,t,n){var e=this.graphics,l=this.outer,i=this.colour(o.id,!1),r=o.body;if(null!=r){var a=this.colour(r.id,null!=r.space&&r.outer.isSleeping);if(i=this.tint(i,a,.2),this.lineStyle(i,1),o.isCircle()){var s=o.circle;s.validate_worldCOM();var _=s.worldCOMx,u=s.worldCOMy;if(!n){var d=p.a*_+p.b*u+p.tx;u=p.c*_+p.d*u+p.ty,_=d}if(e.drawCircle(_,u,s.radius*t),l.drawShapeAngleIndicators){var z=s.worldCOMx+.3*s.radius*r.axisy,h=s.worldCOMy+.3*s.radius*r.axisx,x=s.worldCOMx+s.radius*r.axisy,c=s.worldCOMy+s.radius*r.axisx;if(!n){d=p.a*z+p.b*h+p.tx;h=p.c*z+p.d*h+p.ty,z=d}if(!n){d=p.a*x+p.b*c+p.tx;c=p.c*x+p.d*c+p.ty,x=d}e.moveTo(z,h),e.lineTo(x,c)}}else{var f=o.polygon;f.validate_gverts();var y=f.gverts.front(),b=y.x,P=y.y;if(!n){var m=p.a*b+p.b*P+p.tx;P=p.c*b+p.d*P+p.ty,b=m}e.moveTo(b,P);for(var g=b,w=P,v=f.gverts.begin().next;null!=v;){var C=v.elem();if(b=C.x,P=C.y,!n){var S=p.a*b+p.b*P+p.tx;P=p.c*b+p.d*P+p.ty,b=S}e.lineTo(b,P),v=v.next}e.lineTo(g,w),l.drawShapeAngleIndicators&&(f.validate_worldCOM(),n?(b=f.worldCOMx,P=f.worldCOMy):(b=p.a*f.worldCOMx+p.b*f.worldCOMy+p.tx,P=p.c*f.worldCOMx+p.d*f.worldCOMy+p.ty),e.moveTo(b,P),e.lineTo(g,w))}if(l.drawShapeDetail){o.validate_worldCOM(),this.lineStyle(this.tint(i,16711680,.8),1);var Z=0,A=0;n?(Z=o.worldCOMx,A=o.worldCOMy):(Z=p.a*o.worldCOMx+p.b*o.worldCOMy+p.tx,A=p.c*o.worldCOMx+p.d*o.worldCOMy+p.ty),e.drawCircle(Z,A,1),o.validate_aabb(),this.AABB(r,n,p,o.aabb)}}},t.prototype.draw_arbiter=function(o,p,t,n){var e=this.outer,l=0,i=0;if(o.outer.isSensorArbiter()){if(e.drawSensorArbiters){var r=o.outer;this.lineStyle(this.tint(65280,~this.bg_col,.7),1),n?(l=r.shape1.worldCOM.x,i=r.shape1.worldCOM.y):(l=p.a*r.shape1.worldCOM.x+p.b*r.shape1.worldCOM.y+p.tx,i=p.c*r.shape1.worldCOM.x+p.d*r.shape1.worldCOM.y+p.ty),this.graphics.moveTo(l,i),n?(l=r.shape2.worldCOM.x,i=r.shape2.worldCOM.y):(l=p.a*r.shape2.worldCOM.x+p.b*r.shape2.worldCOM.y+p.tx,i=p.c*r.shape2.worldCOM.x+p.d*r.shape2.worldCOM.y+p.ty),this.graphics.lineTo(l,i)}}else if(o.outer.isFluidArbiter()){if(e.drawFluidArbiters){var a=o.outer.fluidArbiter;this.lineStyle(this.tint(255,~this.bg_col,.7),1),n?(l=a.position.x,i=a.position.y):(l=p.a*a.position.x+p.b*a.position.y+p.tx,i=p.c*a.position.x+p.d*a.position.y+p.ty),this.graphics.drawCircle(l,i,.75)}}else if(e.drawCollisionArbiters){var s=o.outer.collisionArbiter;if(!s.contacts.empty()){var _=0,u=0;if(2==s.contacts.length){var d=s.contacts.at(0).position,z=s.contacts.at(1).position,h=s.normal,x=.661437828,c=.75;if(h.y*d.x-h.x*d.y<h.y*z.x-h.x*z.y&&(x=-x,c=-c),this.lineStyle(this.tint(255,~this.bg_col,.7),1),l=d.x+h.x*c-h.y*x,i=d.y+h.y*c+h.x*x,!n){var f=p.a*l+p.b*i+p.tx;i=p.c*l+p.d*i+p.ty,l=f}if(this.graphics.moveTo(l,i),l=z.x+h.x*c+h.y*x,i=z.y+h.y*c-h.x*x,!n){f=p.a*l+p.b*i+p.tx;i=p.c*l+p.d*i+p.ty,l=f}if(this.graphics.lineTo(l,i),this.lineStyle(this.tint(16711680,~this.bg_col,.7),1),l=d.x-h.x*c-h.y*x,i=d.y-h.y*c+h.x*x,!n){f=p.a*l+p.b*i+p.tx;i=p.c*l+p.d*i+p.ty,l=f}if(this.graphics.moveTo(l,i),l=z.x-h.x*c+h.y*x,i=z.y-h.y*c-h.x*x,!n){f=p.a*l+p.b*i+p.tx;i=p.c*l+p.d*i+p.ty,l=f}if(this.graphics.lineTo(l,i),_=.5*(d.x+z.x),u=.5*(d.y+z.y),!n){f=p.a*_+p.b*u+p.tx;u=p.c*_+p.d*u+p.ty,_=f}}else{if(_=s.contacts.at(0).position.x,u=s.contacts.at(0).position.y,!n){f=p.a*_+p.b*u+p.tx;u=p.c*_+p.d*u+p.ty,_=f}this.lineStyle(this.tint(16711935,~this.bg_col,.7),1),this.graphics.drawCircle(_,u,1)}if(this.lineStyle(this.tint(~this.bg_col,this.bg_col,.7),1),this.graphics.moveTo(_,u),l=5*s.normal.x,i=5*s.normal.y,!n){f=p.a*l+p.b*i;i=p.c*l+p.d*i,l=f}this.graphics.lineTo(_+l,u+i)}}},t.prototype.lineStyle=function(o,p,t){void 0===t&&(t=1),2==arguments.length&&(t=p,p=o,o=this.outer_zn.thickness);var n=(16711680&p)>>16,e=(65280&p)>>8,l=255&p;this.graphics.setStrokeStyle(o).beginStroke("rgba("+n+","+e+","+l+","+t+")")},t.prototype.AABB=function(o,p,t,n){if(p)this.graphics.drawRect(o.aabb.minx,o.aabb.miny,o.aabb.width(),o.aabb.height());else{var e,l;e=t.a*o.aabb.minx+t.b*o.aabb.miny+t.tx,l=t.c*o.aabb.minx+t.d*o.aabb.miny+t.ty;var i=o.aabb.width(),r=0,a=t.a*i+t.b*r;r=t.c*i+t.d*r,i=a;var s=0,_=o.aabb.height();a=t.a*s+t.b*_;_=t.c*s+t.d*_,s=a,this.graphics.moveTo(e,l),this.graphics.lineTo(e+i,l+r),this.graphics.lineTo(e+i+s,l+r+_),this.graphics.lineTo(e+s,l+_),this.graphics.lineTo(e,l)}},t}(p.ZPP_Debug),p.ZPP_ShapeDebug=t}(zpp_nape||(zpp_nape={}));var nape;__extends=this&&this.__extends||function(o,p){for(var t in p)p.hasOwnProperty(t)&&(o[t]=p[t]);function n(){this.constructor=o}o.prototype=null===p?Object.create(p):(n.prototype=p.prototype,new n)};!function(o){var p,t,n,e;p=o.util||(o.util={}),t=zpp_nape.util.ZPP_ShapeDebug,n=o.geom.Vec2,e=function(o){function e(p,n,e){void 0===e&&(e=3355443),o.call(this),this.zpp_inner_zn=null,this.thickness=0,this.zpp_inner_zn=new t(p,n),this.zpp_inner_zn.outer_zn=this,this.zpp_inner=this.zpp_inner_zn,this.zpp_inner.outer=this,this.bgColour=e,this.thickness=.1}return __extends(e,o),e.prototype.clear=function(){this.zpp_inner_zn.graphics.clear()},e.prototype.drawLine=function(o,t,n){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,this.thickness,16777215&n,1),e.xnull)l.moveTo(o.x,o.y),l.lineTo(t.x,t.y),p.Debug.WEAK(o),p.Debug.WEAK(t);else{var i=e.xform.outer.transform(o);l.moveTo(i.x,i.y),i.dispose(),i=e.xform.outer.transform(t),l.lineTo(i.x,i.y),i.dispose()}l.endStroke()},e.prototype.drawCurve=function(o,t,n,e){var l=this.zpp_inner,i=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(i,this.thickness,16777215&e,1),l.xnull)i.moveTo(o.x,o.y),i.curveTo(t.x,t.y,n.x,n.y),p.Debug.WEAK(o),p.Debug.WEAK(t),p.Debug.WEAK(n);else{var r=l.xform.outer.transform(o),a=l.xform.outer.transform(t),s=l.xform.outer.transform(n);i.moveTo(r.x,r.y),i.curveTo(a.x,a.y,s.x,s.y),r.dispose(),a.dispose(),s.dispose()}i.endStroke()},e.prototype.drawCircle=function(o,t,n){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,this.thickness,16777215&n,1),e.xnull)l.drawCircle(o.x,o.y,t),p.Debug.WEAK(o);else{var i=e.xform.outer.transform(o);l.drawCircle(i.x,i.y,t*e.xdet),i.dispose()}l.endStroke()},e.prototype.drawAABB=function(o,t){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,this.thickness,16777215&t,1),e.xnull)l.drawRect(o.x,o.y,o.width,o.height);else{var i=e.xform.outer.transform(o.min),r=n.get(o.width,0,!1),a=e.xform.outer.transform(r,!0),s=n.get(0,o.height,!1),_=e.xform.outer.transform(s,!0);l.moveTo(i.x,i.y),l.lineTo(i.x+a.x,i.y+a.y),l.lineTo(i.x+a.x+_.x,i.y+a.y+_.y),l.lineTo(i.x+_.x,i.y+_.y),l.lineTo(i.x,i.y),i.dispose(),r.dispose(),a.dispose(),s.dispose(),_.dispose()}l.endStroke()},e.prototype.drawFilledTriangle=function(o,t,n,e){var l=this.zpp_inner,i=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(i,0,0,0),i.beginFill(this.rgba(16777215&e,1)),l.xnull)i.moveTo(o.x,o.y),i.lineTo(t.x,t.y),i.lineTo(n.x,n.y),p.Debug.WEAK(o),p.Debug.WEAK(t),p.Debug.WEAK(n);else{var r=l.xform.outer.transform(o);i.moveTo(r.x,r.y),r.dispose(),r=l.xform.outer.transform(t),i.lineTo(r.x,r.y),r.dispose(),r=l.xform.outer.transform(n),i.lineTo(r.x,r.y),r.dispose()}i.endFill()},e.prototype.drawFilledCircle=function(o,t,n){var e=this.zpp_inner,l=this.zpp_inner_zn.graphics;if(p.Debug.lineStyle(l,0,0,0),l.beginFill(this.rgba(16777215&n,1)),e.xnull)l.drawCircle(o.x,o.y,t),p.Debug.WEAK(o);else{var i=e.xform.outer.transform(o);l.drawCircle(i.x,i.y,t*e.xdet),i.dispose()}l.endFill()},e.prototype.drawPolygon=function(o,t){var n=this.zpp_inner,e=this.zpp_inner_zn.graphics;p.Debug.lineStyle(e,this.thickness,16777215&t,1);var l=null,i=!0;n.xnull?(p.Debug.PolyIter(o,function(o){i?(l=o.copy(!1),e.moveTo(o.x,o.y)):e.lineTo(o.x,o.y),i=!1}),e.lineTo(l.x,l.y),l.dispose()):(p.Debug.PolyIter(o,function(o){var p=n.xform.outer.transform(o);i?(l=p,e.moveTo(p.x,p.y)):e.lineTo(p.x,p.y),i||p.dispose(),i=!1}),e.lineTo(l.x,l.y),l.dispose()),p.Debug.PolyWeak(o),e.endStroke()},e.prototype.drawFilledPolygon=function(o,t){var n=this.zpp_inner,e=this.zpp_inner_zn.graphics;e.beginFill(this.rgba(16777215&t,1)),p.Debug.lineStyle(e,0,0,0);var l=null,i=!0;n.xnull?(p.Debug.PolyIter(o,function(o){i?(l=o.copy(!1),e.moveTo(o.x,o.y)):e.lineTo(o.x,o.y),i=!1}),e.lineTo(l.x,l.y),l.dispose()):(p.Debug.PolyIter(o,function(o){var p=n.xform.outer.transform(o);i?(l=p,e.moveTo(p.x,p.y)):e.lineTo(p.x,p.y),i||p.dispose(),i=!1}),e.lineTo(l.x,l.y),l.dispose()),e.endFill(),p.Debug.PolyWeak(o)},e.prototype.draw=function(o){p.Debug.debug_draw(this,o)},e.prototype.drawSpring=function(o,t,n,e,l){void 0===e&&(e=3),void 0===l&&(l=3),p.Debug.debug_spring(this,o,t,n,e,l)},e.prototype.rgba=function(o,p){return void 0===p&&(p=1),"rgba("+((16711680&o)>>16)+","+((65280&o)>>8)+","+(255&o)+","+p+")"},e}(p.Debug),p.ShapeDebug=e}(nape||(nape={}));
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";var n=[],r=e.document,i=Object.getPrototypeOf,o=n.slice,a=n.concat,s=n.push,u=n.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={};function g(e,t){var n=(t=t||r).createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)}var v="3.1.1",m=function(e,t){return new m.fn.init(e,t)},y=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^-ms-/,b=/-([a-z])/g,w=function(e,t){return t.toUpperCase()};function T(e){var t=!!e&&"length"in e&&e.length,n=m.type(e);return"function"!==n&&!m.isWindow(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}m.fn=m.prototype={jquery:v,constructor:m,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=m.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return m.each(this,e)},map:function(e){return this.pushStack(m.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:n.sort,splice:n.splice},m.extend=m.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m.isFunction(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)n=a[t],a!==(r=e[t])&&(l&&r&&(m.isPlainObject(r)||(i=m.isArray(r)))?(i?(i=!1,o=n&&m.isArray(n)?n:[]):o=n&&m.isPlainObject(n)?n:{},a[t]=m.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},m.extend({expando:"jQuery"+(v+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===m.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=m.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==c.call(e)||(t=i(e))&&(n=f.call(t,"constructor")&&t.constructor,"function"!=typeof n||p.call(n)!==d))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[c.call(e)]||"object":typeof e},globalEval:function(e){g(e)},camelCase:function(e){return e.replace(x,"ms-").replace(b,w)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var n,r=0;if(T(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(y,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(T(Object(e))?m.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,s=[];if(T(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return a.apply([],s)},guid:1,proxy:function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m.isFunction(e))return r=o.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(o.call(arguments)))}).guid=e.guid=e.guid||m.guid++,i},now:Date.now,support:h}),"function"==typeof Symbol&&(m.fn[Symbol.iterator]=n[Symbol.iterator]),m.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});var C=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,v,m,y,x,b="sizzle"+1*new Date,w=e.document,T=0,C=0,E=ae(),k=ae(),N=ae(),S=function(e,t){return e===t&&(f=!0),0},D={}.hasOwnProperty,j=[],A=j.pop,q=j.push,L=j.push,H=j.slice,F=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},O="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",M="\\["+P+"*("+R+")(?:"+P+"*([*^$|!~]?=)"+P+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+R+"))|)"+P+"*\\]",I=":("+R+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+M+")*)|.*)\\)|)",W=new RegExp(P+"+","g"),$=new RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g"),B=new RegExp("^"+P+"*,"+P+"*"),_=new RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),z=new RegExp("="+P+"*([^\\]'\"]*?)"+P+"*\\]","g"),X=new RegExp(I),U=new RegExp("^"+R+"$"),V={ID:new RegExp("^#("+R+")"),CLASS:new RegExp("^\\.("+R+")"),TAG:new RegExp("^("+R+"|[*])"),ATTR:new RegExp("^"+M),PSEUDO:new RegExp("^"+I),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:new RegExp("^(?:"+O+")$","i"),needsContext:new RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},G=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,J=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,K=/[+~]/,Z=new RegExp("\\\\([\\da-f]{1,6}"+P+"?|("+P+")|.)","ig"),ee=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},te=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},re=function(){p()},ie=ye(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{L.apply(j=H.call(w.childNodes),w.childNodes),j[w.childNodes.length].nodeType}catch(e){L={apply:j.length?function(e,t){q.apply(e,H.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function oe(e,t,r,i){var o,s,l,c,f,h,m,y=t&&t.ownerDocument,T=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==T&&9!==T&&11!==T)return r;if(!i&&((t?t.ownerDocument||t:w)!==d&&p(t),t=t||d,g)){if(11!==T&&(f=J.exec(e)))if(o=f[1]){if(9===T){if(!(l=t.getElementById(o)))return r;if(l.id===o)return r.push(l),r}else if(y&&(l=y.getElementById(o))&&x(t,l)&&l.id===o)return r.push(l),r}else{if(f[2])return L.apply(r,t.getElementsByTagName(e)),r;if((o=f[3])&&n.getElementsByClassName&&t.getElementsByClassName)return L.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!N[e+" "]&&(!v||!v.test(e))){if(1!==T)y=t,m=e;else if("object"!==t.nodeName.toLowerCase()){for((c=t.getAttribute("id"))?c=c.replace(te,ne):t.setAttribute("id",c=b),s=(h=a(e)).length;s--;)h[s]="#"+c+" "+me(h[s]);m=h.join(","),y=K.test(e)&&ge(t.parentNode)||t}if(m)try{return L.apply(r,y.querySelectorAll(m)),r}catch(e){}finally{c===b&&t.removeAttribute("id")}}}return u(e.replace($,"$1"),t,r,i)}function ae(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function se(e){return e[b]=!0,e}function ue(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function le(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function ce(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function de(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ie(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function he(e){return se(function(t){return t=+t,se(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ge(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=oe.support={},o=oe.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},p=oe.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:w;return a!==d&&9===a.nodeType&&a.documentElement?(h=(d=a).documentElement,g=!o(d),w!==d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",re,!1):i.attachEvent&&i.attachEvent("onunload",re)),n.attributes=ue(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ue(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(d.getElementsByClassName),n.getById=ue(function(e){return h.appendChild(e).id=b,!d.getElementsByName||!d.getElementsByName(b).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(Z,ee);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},m=[],v=[],(n.qsa=Q.test(d.querySelectorAll))&&(ue(function(e){h.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+P+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+P+"*(?:value|"+O+")"),e.querySelectorAll("[id~="+b+"-]").length||v.push("~="),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||v.push(".#.+[+~]")}),ue(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+P+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(n.matchesSelector=Q.test(y=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ue(function(e){n.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),m.push("!=",I)}),v=v.length&&new RegExp(v.join("|")),m=m.length&&new RegExp(m.join("|")),t=Q.test(h.compareDocumentPosition),x=t||Q.test(h.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},S=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===d||e.ownerDocument===w&&x(w,e)?-1:t===d||t.ownerDocument===w&&x(w,t)?1:c?F(c,e)-F(c,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===d?-1:t===d?1:i?-1:o?1:c?F(c,e)-F(c,t):0;if(i===o)return ce(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?ce(a[r],s[r]):a[r]===w?-1:s[r]===w?1:0},d):d},oe.matches=function(e,t){return oe(e,null,null,t)},oe.matchesSelector=function(e,t){if((e.ownerDocument||e)!==d&&p(e),t=t.replace(z,"='$1']"),n.matchesSelector&&g&&!N[t+" "]&&(!m||!m.test(t))&&(!v||!v.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return oe(t,d,null,[e]).length>0},oe.contains=function(e,t){return(e.ownerDocument||e)!==d&&p(e),x(e,t)},oe.attr=function(e,t){(e.ownerDocument||e)!==d&&p(e);var i=r.attrHandle[t.toLowerCase()],o=i&&D.call(r.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==o?o:n.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},oe.escape=function(e){return(e+"").replace(te,ne)},oe.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},oe.uniqueSort=function(e){var t,r=[],i=0,o=0;if(f=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(S),f){for(;t=e[o++];)t===e[o]&&(i=r.push(o));for(;i--;)e.splice(r[i],1)}return c=null,e},i=oe.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=oe.selectors={cacheLength:50,createPseudo:se,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Z,ee),e[3]=(e[3]||e[4]||e[5]||"").replace(Z,ee),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||oe.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&oe.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return V.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Z,ee).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+P+")"+e+"("+P+"|$)"))&&E(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=oe.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(W," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",v=t.parentNode,m=s&&t.nodeName.toLowerCase(),y=!u&&!s,x=!1;if(v){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===m:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?v.firstChild:v.lastChild],a&&y){for(x=(d=(l=(c=(f=(p=v)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1])&&l[2],p=d&&v.childNodes[d];p=++d&&p&&p[g]||(x=d=0)||h.pop();)if(1===p.nodeType&&++x&&p===t){c[e]=[T,d,x];break}}else if(y&&(x=d=(l=(c=(f=(p=t)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1]),!1===x)for(;(p=++d&&p&&p[g]||(x=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==m:1!==p.nodeType)||!++x||(y&&((c=(f=p[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]=[T,x]),p!==t)););return(x-=i)===r||x%r==0&&x/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||oe.error("unsupported pseudo: "+e);return i[b]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,n){for(var r,o=i(e,t),a=o.length;a--;)e[r=F(e,o[a])]=!(n[r]=o[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:se(function(e){var t=[],n=[],r=s(e.replace($,"$1"));return r[b]?se(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:se(function(e){return function(t){return oe(e,t).length>0}}),contains:se(function(e){return e=e.replace(Z,ee),function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:se(function(e){return U.test(e||"")||oe.error("unsupported lang: "+e),e=e.replace(Z,ee).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:de(!1),disabled:de(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Y.test(e.nodeName)},input:function(e){return G.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:he(function(){return[0]}),last:he(function(e,t){return[t-1]}),eq:he(function(e,t,n){return[n<0?n+t:n]}),even:he(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:he(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:he(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:he(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=fe(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pe(t);function ve(){}function me(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function ye(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=C++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||a)return e(t,n,i);return!1}:function(t,n,u){var l,c,f,p=[T,s];if(u){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(c=(f=t[b]||(t[b]={}))[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===T&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}return!1}}function xe(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function be(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function we(e,t,n,r,i,o){return r&&!r[b]&&(r=we(r)),i&&!i[b]&&(i=we(i,o)),se(function(o,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=o||function(e,t,n){for(var r=0,i=t.length;r<i;r++)oe(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),v=!e||!o&&t?g:be(g,p,e,s,u),m=n?i||(o?e:h||r)?[]:a:v;if(n&&n(v,m,s,u),r)for(l=be(m,d),r(l,[],s,u),c=l.length;c--;)(f=l[c])&&(m[d[c]]=!(v[d[c]]=f));if(o){if(i||e){if(i){for(l=[],c=m.length;c--;)(f=m[c])&&l.push(v[c]=f);i(null,m=[],l,u)}for(c=m.length;c--;)(f=m[c])&&(l=i?F(o,f):p[c])>-1&&(o[l]=!(a[l]=f))}}else m=be(m===a?m.splice(h,m.length):m),i?i(null,a,m,u):L.apply(a,m)})}function Te(e){for(var t,n,i,o=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],u=a?1:0,c=ye(function(e){return e===t},s,!0),f=ye(function(e){return F(t,e)>-1},s,!0),p=[function(e,n,r){var i=!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):f(e,n,r));return t=null,i}];u<o;u++)if(n=r.relative[e[u].type])p=[ye(xe(p),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[b]){for(i=++u;i<o&&!r.relative[e[i].type];i++);return we(u>1&&xe(p),u>1&&me(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace($,"$1"),n,u<i&&Te(e.slice(u,i)),i<o&&Te(e=e.slice(i)),i<o&&me(e))}p.push(n)}return xe(p)}function Ce(e,t){var n=t.length>0,i=e.length>0,o=function(o,a,s,u,c){var f,h,v,m=0,y="0",x=o&&[],b=[],w=l,C=o||i&&r.find.TAG("*",c),E=T+=null==w?1:Math.random()||.1,k=C.length;for(c&&(l=a===d||a||c);y!==k&&null!=(f=C[y]);y++){if(i&&f){for(h=0,a||f.ownerDocument===d||(p(f),s=!g);v=e[h++];)if(v(f,a||d,s)){u.push(f);break}c&&(T=E)}n&&((f=!v&&f)&&m--,o&&x.push(f))}if(m+=y,n&&y!==m){for(h=0;v=t[h++];)v(x,b,a,s);if(o){if(m>0)for(;y--;)x[y]||b[y]||(b[y]=A.call(u));b=be(b)}L.apply(u,b),c&&!o&&b.length>0&&m+t.length>1&&oe.uniqueSort(u)}return c&&(T=E,l=w),x};return n?se(o):o}return ve.prototype=r.filters=r.pseudos,r.setFilters=new ve,a=oe.tokenize=function(e,t){var n,i,o,a,s,u,l,c=k[e+" "];if(c)return t?0:c.slice(0);for(s=e,u=[],l=r.preFilter;s;){for(a in n&&!(i=B.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),n=!1,(i=_.exec(s))&&(n=i.shift(),o.push({value:n,type:i[0].replace($," ")}),s=s.slice(n.length)),r.filter)!(i=V[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),o.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?oe.error(e):k(e,u).slice(0)},s=oe.compile=function(e,t){var n,r=[],i=[],o=N[e+" "];if(!o){for(t||(t=a(e)),n=t.length;n--;)(o=Te(t[n]))[b]?r.push(o):i.push(o);(o=N(e,Ce(i,r))).selector=e}return o},u=oe.select=function(e,t,n,i){var o,u,l,c,f,p="function"==typeof e&&e,d=!i&&a(e=p.selector||e);if(n=n||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&9===t.nodeType&&g&&r.relative[u[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(Z,ee),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(o=V.needsContext.test(e)?0:u.length;o--&&(l=u[o],!r.relative[c=l.type]);)if((f=r.find[c])&&(i=f(l.matches[0].replace(Z,ee),K.test(u[0].type)&&ge(t.parentNode)||t))){if(u.splice(o,1),!(e=i.length&&me(u)))return L.apply(n,i),n;break}}return(p||s(e,d))(i,t,!g,n,!t||K.test(e)&&ge(t.parentNode)||t),n},n.sortStable=b.split("").sort(S).join("")===b,n.detectDuplicates=!!f,p(),n.sortDetached=ue(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),ue(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||le("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ue(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||le("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ue(function(e){return null==e.getAttribute("disabled")})||le(O,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),oe}(e);m.find=C,m.expr=C.selectors,m.expr[":"]=m.expr.pseudos,m.uniqueSort=m.unique=C.uniqueSort,m.text=C.getText,m.isXMLDoc=C.isXML,m.contains=C.contains,m.escapeSelector=C.escape;var E=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&m(e).is(n))break;r.push(e)}return r},k=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},N=m.expr.match.needsContext,S=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,D=/^.[^:#\[\.,]*$/;function j(e,t,n){return m.isFunction(t)?m.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?m.grep(e,function(e){return e===t!==n}):"string"!=typeof t?m.grep(e,function(e){return u.call(t,e)>-1!==n}):D.test(t)?m.filter(t,e,n):(t=m.filter(t,e),m.grep(e,function(e){return u.call(t,e)>-1!==n&&1===e.nodeType}))}m.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?m.find.matchesSelector(r,e)?[r]:[]:m.find.matches(e,m.grep(t,function(e){return 1===e.nodeType}))},m.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(m(e).filter(function(){for(t=0;t<r;t++)if(m.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)m.find(e,i[t],n);return r>1?m.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&N.test(e)?m(e):e||[],!1).length}});var A,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(m.fn.init=function(e,t,n){var i,o;if(!e)return this;if(n=n||A,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:q.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof m?t[0]:t,m.merge(this,m.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:r,!0)),S.test(i[1])&&m.isPlainObject(t))for(i in t)m.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return(o=r.getElementById(i[2]))&&(this[0]=o,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m.isFunction(e)?void 0!==n.ready?n.ready(e):e(m):m.makeArray(e,this)}).prototype=m.fn,A=m(r);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function F(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}m.fn.extend({has:function(e){var t=m(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(m.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&m(e);if(!N.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&m.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?m.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?u.call(m(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(m.uniqueSort(m.merge(this.get(),m(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),m.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return E(e,"parentNode")},parentsUntil:function(e,t,n){return E(e,"parentNode",n)},next:function(e){return F(e,"nextSibling")},prev:function(e){return F(e,"previousSibling")},nextAll:function(e){return E(e,"nextSibling")},prevAll:function(e){return E(e,"previousSibling")},nextUntil:function(e,t,n){return E(e,"nextSibling",n)},prevUntil:function(e,t,n){return E(e,"previousSibling",n)},siblings:function(e){return k((e.parentNode||{}).firstChild,e)},children:function(e){return k(e.firstChild)},contents:function(e){return e.contentDocument||m.merge([],e.childNodes)}},function(e,t){m.fn[e]=function(n,r){var i=m.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=m.filter(r,i)),this.length>1&&(H[e]||m.uniqueSort(i),L.test(e)&&i.reverse()),this.pushStack(i)}});var O=/[^\x20\t\r\n\f]+/g;function P(e){return e}function R(e){throw e}function M(e,t,n){var r;try{e&&m.isFunction(r=e.promise)?r.call(e).done(t).fail(n):e&&m.isFunction(r=e.then)?r.call(e,t,n):t.call(void 0,e)}catch(e){n.call(void 0,e)}}m.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return m.each(e.match(O)||[],function(e,n){t[n]=!0}),t}(e):m.extend({},e);var t,n,r,i,o=[],a=[],s=-1,u=function(){for(i=e.once,r=t=!0;a.length;s=-1)for(n=a.shift();++s<o.length;)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,a.push(n)),function t(n){m.each(n,function(n,r){m.isFunction(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&"string"!==m.type(r)&&t(r)})}(arguments),n&&!t&&u()),this},remove:function(){return m.each(arguments,function(e,t){for(var n;(n=m.inArray(t,o,n))>-1;)o.splice(n,1),n<=s&&s--}),this},has:function(e){return e?m.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=a=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=a=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},m.extend({Deferred:function(t){var n=[["notify","progress",m.Callbacks("memory"),m.Callbacks("memory"),2],["resolve","done",m.Callbacks("once memory"),m.Callbacks("once memory"),0,"resolved"],["reject","fail",m.Callbacks("once memory"),m.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return m.Deferred(function(t){m.each(n,function(n,r){var i=m.isFunction(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&m.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(t,r,i){var o=0;function a(t,n,r,i){return function(){var s=this,u=arguments,l=function(){var e,l;if(!(t<o)){if((e=r.apply(s,u))===n.promise())throw new TypeError("Thenable self-resolution");l=e&&("object"==typeof e||"function"==typeof e)&&e.then,m.isFunction(l)?i?l.call(e,a(o,n,P,i),a(o,n,R,i)):(o++,l.call(e,a(o,n,P,i),a(o,n,R,i),a(o,n,P,n.notifyWith))):(r!==P&&(s=void 0,u=[e]),(i||n.resolveWith)(s,u))}},c=i?l:function(){try{l()}catch(e){m.Deferred.exceptionHook&&m.Deferred.exceptionHook(e,c.stackTrace),t+1>=o&&(r!==R&&(s=void 0,u=[e]),n.rejectWith(s,u))}};t?c():(m.Deferred.getStackHook&&(c.stackTrace=m.Deferred.getStackHook()),e.setTimeout(c))}}return m.Deferred(function(e){n[0][3].add(a(0,e,m.isFunction(i)?i:P,e.notifyWith)),n[1][3].add(a(0,e,m.isFunction(t)?t:P)),n[2][3].add(a(0,e,m.isFunction(r)?r:R))}).promise()},promise:function(e){return null!=e?m.extend(e,i):i}},o={};return m.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[0][2].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),t&&t.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=o.call(arguments),a=m.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?o.call(arguments):n,--t||a.resolveWith(r,i)}};if(t<=1&&(M(e,a.done(s(n)).resolve,a.reject),"pending"===a.state()||m.isFunction(i[n]&&i[n].then)))return a.then();for(;n--;)M(i[n],s(n),a.reject);return a.promise()}});var I=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;m.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&I.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},m.readyException=function(t){e.setTimeout(function(){throw t})};var W=m.Deferred();function $(){r.removeEventListener("DOMContentLoaded",$),e.removeEventListener("load",$),m.ready()}m.fn.ready=function(e){return W.then(e).catch(function(e){m.readyException(e)}),this},m.extend({isReady:!1,readyWait:1,holdReady:function(e){e?m.readyWait++:m.ready(!0)},ready:function(e){(!0===e?--m.readyWait:m.isReady)||(m.isReady=!0,!0!==e&&--m.readyWait>0||W.resolveWith(r,[m]))}}),m.ready.then=W.then,"complete"===r.readyState||"loading"!==r.readyState&&!r.documentElement.doScroll?e.setTimeout(m.ready):(r.addEventListener("DOMContentLoaded",$),e.addEventListener("load",$));var B=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===m.type(n))for(s in i=!0,n)B(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m.isFunction(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(m(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function z(){this.expando=m.expando+z.uid++}z.uid=1,z.prototype={cache:function(e){var t=e[this.expando];return t||(t={},_(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[m.camelCase(t)]=n;else for(r in t)i[m.camelCase(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][m.camelCase(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){m.isArray(t)?t=t.map(m.camelCase):t=(t=m.camelCase(t))in r?[t]:t.match(O)||[],n=t.length;for(;n--;)delete r[t[n]]}(void 0===t||m.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!m.isEmptyObject(t)}};var X=new z,U=new z,V=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,G=/[A-Z]/g;function Y(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(G,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:V.test(e)?JSON.parse(e):e)}(n)}catch(e){}U.set(e,t,n)}else n=void 0;return n}m.extend({hasData:function(e){return U.hasData(e)||X.hasData(e)},data:function(e,t,n){return U.access(e,t,n)},removeData:function(e,t){U.remove(e,t)},_data:function(e,t,n){return X.access(e,t,n)},_removeData:function(e,t){X.remove(e,t)}}),m.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=U.get(o),1===o.nodeType&&!X.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&(0===(r=a[n].name).indexOf("data-")&&(r=m.camelCase(r.slice(5)),Y(o,r,i[r])));X.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){U.set(this,e)}):B(this,function(t){var n;if(o&&void 0===t){if(void 0!==(n=U.get(o,e)))return n;if(void 0!==(n=Y(o,e)))return n}else this.each(function(){U.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){U.remove(this,e)})}}),m.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=X.get(e,t),n&&(!r||m.isArray(n)?r=X.access(e,t,m.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=m.queue(e,t),r=n.length,i=n.shift(),o=m._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){m.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return X.get(e,n)||X.access(e,n,{empty:m.Callbacks("once memory").add(function(){X.remove(e,[t+"queue",n])})})}}),m.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?m.queue(this[0],e):void 0===t?this:this.each(function(){var n=m.queue(this,e,t);m._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&m.dequeue(this,e)})},dequeue:function(e){return this.each(function(){m.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=m.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=X.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,J=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),K=["Top","Right","Bottom","Left"],Z=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&m.contains(e.ownerDocument,e)&&"none"===m.css(e,"display")},ee=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=n.apply(e,r||[]),t)e.style[o]=a[o];return i};function te(e,t,n,r){var i,o=1,a=20,s=r?function(){return r.cur()}:function(){return m.css(e,t,"")},u=s(),l=n&&n[3]||(m.cssNumber[t]?"":"px"),c=(m.cssNumber[t]||"px"!==l&&+u)&&J.exec(m.css(e,t));if(c&&c[3]!==l){l=l||c[3],n=n||[],c=+u||1;do{c/=o=o||".5",m.style(e,t,c+l)}while(o!==(o=s()/u)&&1!==o&&--a)}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ne={};function re(e){var t,n=e.ownerDocument,r=e.nodeName,i=ne[r];return i||(t=n.body.appendChild(n.createElement(r)),i=m.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),ne[r]=i,i)}function ie(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=X.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&Z(r)&&(i[o]=re(r))):"none"!==n&&(i[o]="none",X.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}m.fn.extend({show:function(){return ie(this,!0)},hide:function(){return ie(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Z(this)?m(this).show():m(this).hide()})}});var oe=/^(?:checkbox|radio)$/i,ae=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,se=/^$|\/(?:java|ecma)script/i,ue={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function le(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&m.nodeName(e,t)?m.merge([e],n):n}function ce(e,t){for(var n=0,r=e.length;n<r;n++)X.set(e[n],"globalEval",!t||X.get(t[n],"globalEval"))}ue.optgroup=ue.option,ue.tbody=ue.tfoot=ue.colgroup=ue.caption=ue.thead,ue.th=ue.td;var fe=/<|&#?\w+;/;function pe(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===m.type(o))m.merge(p,o.nodeType?[o]:o);else if(fe.test(o)){for(a=a||f.appendChild(t.createElement("div")),s=(ae.exec(o)||["",""])[1].toLowerCase(),u=ue[s]||ue._default,a.innerHTML=u[1]+m.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;m.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&m.inArray(o,r)>-1)i&&i.push(o);else if(l=m.contains(o.ownerDocument,o),a=le(f.appendChild(o),"script"),l&&ce(a),n)for(c=0;o=a[c++];)se.test(o.type||"")&&n.push(o);return f}!function(){var e=r.createDocumentFragment().appendChild(r.createElement("div")),t=r.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),h.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",h.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var de=r.documentElement,he=/^key/,ge=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ve=/^([^.]*)(?:\.(.+)|)/;function me(){return!0}function ye(){return!1}function xe(){try{return r.activeElement}catch(e){}}function be(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)be(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=ye;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return m().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=m.guid++)),e.each(function(){m.event.add(this,t,i,r,n)})}m.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=X.get(e);if(v)for(n.handler&&(n=(o=n).handler,i=o.selector),i&&m.find.matchesSelector(de,i),n.guid||(n.guid=m.guid++),(u=v.events)||(u=v.events={}),(a=v.handle)||(a=v.handle=function(t){return void 0!==m&&m.event.triggered!==t.type?m.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(O)||[""]).length;l--;)d=g=(s=ve.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=m.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=m.event.special[d]||{},c=m.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&m.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,r,h,a)||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),m.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=X.hasData(e)&&X.get(e);if(v&&(u=v.events)){for(l=(t=(t||"").match(O)||[""]).length;l--;)if(d=g=(s=ve.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){for(f=m.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||m.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)m.event.remove(e,d+t[l],n,r,!0);m.isEmptyObject(u)&&X.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=m.event.fix(e),u=new Array(arguments.length),l=(X.get(this,"events")||{})[s.type]||[],c=m.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){for(a=m.event.handlers.call(this,s,l),t=0;(i=a[t++])&&!s.isPropagationStopped();)for(s.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(r=((m.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?m(i,this).index(l)>-1:m.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(m.Event.prototype,e,{enumerable:!0,configurable:!0,get:m.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[m.expando]?e:new m.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==xe()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===xe()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&m.nodeName(this,"input"))return this.click(),!1},_default:function(e){return m.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},m.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},m.Event=function(e,t){return this instanceof m.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?me:ye,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&m.extend(this,t),this.timeStamp=e&&e.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(e,t)},m.Event.prototype={constructor:m.Event,isDefaultPrevented:ye,isPropagationStopped:ye,isImmediatePropagationStopped:ye,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=me,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=me,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=me,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},m.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&he.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&ge.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},m.event.addProp),m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){m.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,i=e.handleObj;return r&&(r===this||m.contains(this,r))||(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),m.fn.extend({on:function(e,t,n,r){return be(this,e,t,n,r)},one:function(e,t,n,r){return be(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,m(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=ye),this.each(function(){m.event.remove(this,e,n,t)})}});var we=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Te=/<script|<style|<link/i,Ce=/checked\s*(?:[^=]|=\s*.checked.)/i,Ee=/^true\/(.*)/,ke=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ne(e,t){return m.nodeName(e,"table")&&m.nodeName(11!==t.nodeType?t:t.firstChild,"tr")&&e.getElementsByTagName("tbody")[0]||e}function Se(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function De(e){var t=Ee.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function je(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(X.hasData(e)&&(o=X.access(e),a=X.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(n=0,r=l[i].length;n<r;n++)m.event.add(t,i,l[i][n]);U.hasData(e)&&(s=U.access(e),u=m.extend({},s),U.set(t,u))}}function Ae(e,t){var n=t.nodeName.toLowerCase();"input"===n&&oe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function qe(e,t,n,r){t=a.apply([],t);var i,o,s,u,l,c,f=0,p=e.length,d=p-1,v=t[0],y=m.isFunction(v);if(y||p>1&&"string"==typeof v&&!h.checkClone&&Ce.test(v))return e.each(function(i){var o=e.eq(i);y&&(t[0]=v.call(this,i,o.html())),qe(o,t,n,r)});if(p&&(o=(i=pe(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=o),o||r)){for(u=(s=m.map(le(i,"script"),Se)).length;f<p;f++)l=i,f!==d&&(l=m.clone(l,!0,!0),u&&m.merge(s,le(l,"script"))),n.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,m.map(s,De),f=0;f<u;f++)l=s[f],se.test(l.type||"")&&!X.access(l,"globalEval")&&m.contains(c,l)&&(l.src?m._evalUrl&&m._evalUrl(l.src):g(l.textContent.replace(ke,""),c))}return e}function Le(e,t,n){for(var r,i=t?m.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||m.cleanData(le(r)),r.parentNode&&(n&&m.contains(r.ownerDocument,r)&&ce(le(r,"script")),r.parentNode.removeChild(r));return e}m.extend({htmlPrefilter:function(e){return e.replace(we,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s=e.cloneNode(!0),u=m.contains(e.ownerDocument,e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||m.isXMLDoc(e)))for(a=le(s),r=0,i=(o=le(e)).length;r<i;r++)Ae(o[r],a[r]);if(t)if(n)for(o=o||le(e),a=a||le(s),r=0,i=o.length;r<i;r++)je(o[r],a[r]);else je(e,s);return(a=le(s,"script")).length>0&&ce(a,!u&&le(e,"script")),s},cleanData:function(e){for(var t,n,r,i=m.event.special,o=0;void 0!==(n=e[o]);o++)if(_(n)){if(t=n[X.expando]){if(t.events)for(r in t.events)i[r]?m.event.remove(n,r):m.removeEvent(n,r,t.handle);n[X.expando]=void 0}n[U.expando]&&(n[U.expando]=void 0)}}}),m.fn.extend({detach:function(e){return Le(this,e,!0)},remove:function(e){return Le(this,e)},text:function(e){return B(this,function(e){return void 0===e?m.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return qe(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ne(this,e).appendChild(e)})},prepend:function(){return qe(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ne(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return qe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return qe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(m.cleanData(le(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return m.clone(this,e,t)})},html:function(e){return B(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Te.test(e)&&!ue[(ae.exec(e)||["",""])[1].toLowerCase()]){e=m.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(m.cleanData(le(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return qe(this,arguments,function(t){var n=this.parentNode;m.inArray(this,e)<0&&(m.cleanData(le(this)),n&&n.replaceChild(t,this))},e)}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){m.fn[e]=function(e){for(var n,r=[],i=m(e),o=i.length-1,a=0;a<=o;a++)n=a===o?this:this.clone(!0),m(i[a])[t](n),s.apply(r,n.get());return this.pushStack(r)}});var He=/^margin/,Fe=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),Oe=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)};function Pe(e,t,n){var r,i,o,a,s=e.style;return(n=n||Oe(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||m.contains(e.ownerDocument,e)||(a=m.style(e,t)),!h.pixelMarginRight()&&Fe.test(a)&&He.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function Re(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}!function(){function t(){if(u){u.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",u.innerHTML="",de.appendChild(s);var t=e.getComputedStyle(u);n="1%"!==t.top,a="2px"===t.marginLeft,i="4px"===t.width,u.style.marginRight="50%",o="4px"===t.marginRight,de.removeChild(s),u=null}}var n,i,o,a,s=r.createElement("div"),u=r.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",h.clearCloneStyle="content-box"===u.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(u),m.extend(h,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return t(),i},pixelMarginRight:function(){return t(),o},reliableMarginLeft:function(){return t(),a}}))}();var Me=/^(none|table(?!-c[ea]).+)/,Ie={position:"absolute",visibility:"hidden",display:"block"},We={letterSpacing:"0",fontWeight:"400"},$e=["Webkit","Moz","ms"],Be=r.createElement("div").style;function _e(e){if(e in Be)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=$e.length;n--;)if((e=$e[n]+t)in Be)return e}function ze(e,t,n){var r=J.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Xe(e,t,n,r,i){var o,a=0;for(o=n===(r?"border":"content")?4:"width"===t?1:0;o<4;o+=2)"margin"===n&&(a+=m.css(e,n+K[o],!0,i)),r?("content"===n&&(a-=m.css(e,"padding"+K[o],!0,i)),"margin"!==n&&(a-=m.css(e,"border"+K[o]+"Width",!0,i))):(a+=m.css(e,"padding"+K[o],!0,i),"padding"!==n&&(a+=m.css(e,"border"+K[o]+"Width",!0,i)));return a}function Ue(e,t,n){var r,i=!0,o=Oe(e),a="border-box"===m.css(e,"boxSizing",!1,o);if(e.getClientRects().length&&(r=e.getBoundingClientRect()[t]),r<=0||null==r){if(((r=Pe(e,t,o))<0||null==r)&&(r=e.style[t]),Fe.test(r))return r;i=a&&(h.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+Xe(e,t,n||(a?"border":"content"),i,o)+"px"}function Ve(e,t,n,r,i){return new Ve.prototype.init(e,t,n,r,i)}m.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Pe(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=m.camelCase(t),u=e.style;return t=m.cssProps[s]||(m.cssProps[s]=_e(s)||s),a=m.cssHooks[t]||m.cssHooks[s],void 0===n?a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:u[t]:("string"===(o=typeof n)&&(i=J.exec(n))&&i[1]&&(n=te(e,t,i),o="number"),void(null!=n&&n==n&&("number"===o&&(n+=i&&i[3]||(m.cssNumber[s]?"":"px")),h.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u[t]=n))))}},css:function(e,t,n,r){var i,o,a,s=m.camelCase(t);return t=m.cssProps[s]||(m.cssProps[s]=_e(s)||s),(a=m.cssHooks[t]||m.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Pe(e,t,r)),"normal"===i&&t in We&&(i=We[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),m.each(["height","width"],function(e,t){m.cssHooks[t]={get:function(e,n,r){if(n)return!Me.test(m.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Ue(e,t,r):ee(e,Ie,function(){return Ue(e,t,r)})},set:function(e,n,r){var i,o=r&&Oe(e),a=r&&Xe(e,t,r,"border-box"===m.css(e,"boxSizing",!1,o),o);return a&&(i=J.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=m.css(e,t)),ze(0,n,a)}}}),m.cssHooks.marginLeft=Re(h.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Pe(e,"marginLeft"))||e.getBoundingClientRect().left-ee(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),m.each({margin:"",padding:"",border:"Width"},function(e,t){m.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+K[r]+t]=o[r]||o[r-2]||o[0];return i}},He.test(e)||(m.cssHooks[e+t].set=ze)}),m.fn.extend({css:function(e,t){return B(this,function(e,t,n){var r,i,o={},a=0;if(m.isArray(t)){for(r=Oe(e),i=t.length;a<i;a++)o[t[a]]=m.css(e,t[a],!1,r);return o}return void 0!==n?m.style(e,t,n):m.css(e,t)},e,t,arguments.length>1)}}),m.Tween=Ve,Ve.prototype={constructor:Ve,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||m.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(m.cssNumber[n]?"":"px")},cur:function(){var e=Ve.propHooks[this.prop];return e&&e.get?e.get(this):Ve.propHooks._default.get(this)},run:function(e){var t,n=Ve.propHooks[this.prop];return this.options.duration?this.pos=t=m.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Ve.propHooks._default.set(this),this}},Ve.prototype.init.prototype=Ve.prototype,Ve.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=m.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){m.fx.step[e.prop]?m.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[m.cssProps[e.prop]]&&!m.cssHooks[e.prop]?e.elem[e.prop]=e.now:m.style(e.elem,e.prop,e.now+e.unit)}}},Ve.propHooks.scrollTop=Ve.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},m.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},m.fx=Ve.prototype.init,m.fx.step={};var Ge,Ye,Qe=/^(?:toggle|show|hide)$/,Je=/queueHooks$/;function Ke(){Ye&&(e.requestAnimationFrame(Ke),m.fx.tick())}function Ze(){return e.setTimeout(function(){Ge=void 0}),Ge=m.now()}function et(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=K[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function tt(e,t,n){for(var r,i=(nt.tweeners[t]||[]).concat(nt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function nt(e,t,n){var r,i,o=0,a=nt.prefilters.length,s=m.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=Ge||Ze(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,a=l.tweens.length;o<a;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&a?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:m.extend({},t),opts:m.extend(!0,{specialEasing:{},easing:m.easing._default},n),originalProperties:t,originalOptions:n,startTime:Ge||Ze(),duration:n.duration,tweens:[],createTween:function(t,n){var r=m.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=m.camelCase(n)],o=e[n],m.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=m.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);o<a;o++)if(r=nt.prefilters[o].call(l,e,c,l.opts))return m.isFunction(r.stop)&&(m._queueHooks(l.elem,l.opts.queue).stop=m.proxy(r.stop,r)),r;return m.map(c,tt,l),m.isFunction(l.opts.start)&&l.opts.start.call(e,l),m.fx.timer(m.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}m.Animation=m.extend(nt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return te(n.elem,e,J.exec(t),n),n}]},tweener:function(e,t){m.isFunction(e)?(t=e,e=["*"]):e=e.match(O);for(var n,r=0,i=e.length;r<i;r++)n=e[r],nt.tweeners[n]=nt.tweeners[n]||[],nt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&Z(e),v=X.get(e,"fxshow");for(r in n.queue||(null==(a=m._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,m.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],Qe.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||m.style(e,r)}if((u=!m.isEmptyObject(t))||!m.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=X.get(e,"display")),"none"===(c=m.css(e,"display"))&&(l?c=l:(ie([e],!0),l=e.style.display||l,c=m.css(e,"display"),ie([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===m.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=X.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&ie([e],!0),p.done(function(){for(r in g||ie([e]),X.remove(e,"fxshow"),d)m.style(e,r,d[r])})),u=tt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?nt.prefilters.unshift(e):nt.prefilters.push(e)}}),m.speed=function(e,t,n){var i=e&&"object"==typeof e?m.extend({},e):{complete:n||!n&&t||m.isFunction(e)&&e,duration:e,easing:n&&t||t&&!m.isFunction(t)&&t};return m.fx.off||r.hidden?i.duration=0:"number"!=typeof i.duration&&(i.duration in m.fx.speeds?i.duration=m.fx.speeds[i.duration]:i.duration=m.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){m.isFunction(i.old)&&i.old.call(this),i.queue&&m.dequeue(this,i.queue)},i},m.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Z).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=m.isEmptyObject(e),o=m.speed(t,n,r),a=function(){var t=nt(this,m.extend({},e),o);(i||X.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=m.timers,a=X.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&Je.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||m.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=X.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=m.timers,a=r?r.length:0;for(n.finish=!0,m.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),m.each(["toggle","show","hide"],function(e,t){var n=m.fn[t];m.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(et(t,!0),e,r,i)}}),m.each({slideDown:et("show"),slideUp:et("hide"),slideToggle:et("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){m.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),m.timers=[],m.fx.tick=function(){var e,t=0,n=m.timers;for(Ge=m.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||m.fx.stop(),Ge=void 0},m.fx.timer=function(e){m.timers.push(e),e()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){Ye||(Ye=e.requestAnimationFrame?e.requestAnimationFrame(Ke):e.setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){e.cancelAnimationFrame?e.cancelAnimationFrame(Ye):e.clearInterval(Ye),Ye=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(t,n){return t=m.fx&&m.fx.speeds[t]||t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=r.createElement("input"),t=r.createElement("select").appendChild(r.createElement("option"));e.type="checkbox",h.checkOn=""!==e.value,h.optSelected=t.selected,(e=r.createElement("input")).value="t",e.type="radio",h.radioValue="t"===e.value}();var rt,it=m.expr.attrHandle;m.fn.extend({attr:function(e,t){return B(this,m.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){m.removeAttr(this,e)})}}),m.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?m.prop(e,t,n):(1===o&&m.isXMLDoc(e)||(i=m.attrHooks[t.toLowerCase()]||(m.expr.match.bool.test(t)?rt:void 0)),void 0!==n?null===n?void m.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=m.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&"radio"===t&&m.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(O);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),rt={set:function(e,t,n){return!1===t?m.removeAttr(e,n):e.setAttribute(n,n),n}},m.each(m.expr.match.bool.source.match(/\w+/g),function(e,t){var n=it[t]||m.find.attr;it[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=it[a],it[a]=i,i=null!=n(e,t,r)?a:null,it[a]=o),i}});var ot=/^(?:input|select|textarea|button)$/i,at=/^(?:a|area)$/i;function st(e){return(e.match(O)||[]).join(" ")}function ut(e){return e.getAttribute&&e.getAttribute("class")||""}m.fn.extend({prop:function(e,t){return B(this,m.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[m.propFix[e]||e]})}}),m.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&m.isXMLDoc(e)||(t=m.propFix[t]||t,i=m.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=m.find.attr(e,"tabindex");return t?parseInt(t,10):ot.test(e.nodeName)||at.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),h.optSelected||(m.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),m.fn.extend({addClass:function(e){var t,n,r,i,o,a,s,u=0;if(m.isFunction(e))return this.each(function(t){m(this).addClass(e.call(this,t,ut(this)))});if("string"==typeof e&&e)for(t=e.match(O)||[];n=this[u++];)if(i=ut(n),r=1===n.nodeType&&" "+st(i)+" "){for(a=0;o=t[a++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=st(r))&&n.setAttribute("class",s)}return this},removeClass:function(e){var t,n,r,i,o,a,s,u=0;if(m.isFunction(e))return this.each(function(t){m(this).removeClass(e.call(this,t,ut(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(O)||[];n=this[u++];)if(i=ut(n),r=1===n.nodeType&&" "+st(i)+" "){for(a=0;o=t[a++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");i!==(s=st(r))&&n.setAttribute("class",s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):m.isFunction(e)?this.each(function(n){m(this).toggleClass(e.call(this,n,ut(this),t),t)}):this.each(function(){var t,r,i,o;if("string"===n)for(r=0,i=m(this),o=e.match(O)||[];t=o[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==e&&"boolean"!==n||((t=ut(this))&&X.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":X.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+st(ut(n))+" ").indexOf(t)>-1)return!0;return!1}});var lt=/\r/g;m.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=m.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,m(this).val()):e)?i="":"number"==typeof i?i+="":m.isArray(i)&&(i=m.map(i,function(e){return null==e?"":e+""})),(t=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=m.valHooks[i.type]||m.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(lt,""):null==n?"":n:void 0}}),m.extend({valHooks:{option:{get:function(e){var t=m.find.attr(e,"value");return null!=t?t:st(m.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!m.nodeName(n.parentNode,"optgroup"))){if(t=m(n).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=m.makeArray(t),a=i.length;a--;)((r=i[a]).selected=m.inArray(m.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(e,t){if(m.isArray(t))return e.checked=m.inArray(m(e).val(),t)>-1}},h.checkOn||(m.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var ct=/^(?:focusinfocus|focusoutblur)$/;m.extend(m.event,{trigger:function(t,n,i,o){var a,s,u,l,c,p,d,h=[i||r],g=f.call(t,"type")?t.type:t,v=f.call(t,"namespace")?t.namespace.split("."):[];if(s=u=i=i||r,3!==i.nodeType&&8!==i.nodeType&&!ct.test(g+m.event.triggered)&&(g.indexOf(".")>-1&&(v=g.split("."),g=v.shift(),v.sort()),c=g.indexOf(":")<0&&"on"+g,(t=t[m.expando]?t:new m.Event(g,"object"==typeof t&&t)).isTrigger=o?2:3,t.namespace=v.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:m.makeArray(n,[t]),d=m.event.special[g]||{},o||!d.trigger||!1!==d.trigger.apply(i,n))){if(!o&&!d.noBubble&&!m.isWindow(i)){for(l=d.delegateType||g,ct.test(l+g)||(s=s.parentNode);s;s=s.parentNode)h.push(s),u=s;u===(i.ownerDocument||r)&&h.push(u.defaultView||u.parentWindow||e)}for(a=0;(s=h[a++])&&!t.isPropagationStopped();)t.type=a>1?l:d.bindType||g,(p=(X.get(s,"events")||{})[t.type]&&X.get(s,"handle"))&&p.apply(s,n),(p=c&&s[c])&&p.apply&&_(s)&&(t.result=p.apply(s,n),!1===t.result&&t.preventDefault());return t.type=g,o||t.isDefaultPrevented()||d._default&&!1!==d._default.apply(h.pop(),n)||!_(i)||c&&m.isFunction(i[g])&&!m.isWindow(i)&&((u=i[c])&&(i[c]=null),m.event.triggered=g,i[g](),m.event.triggered=void 0,u&&(i[c]=u)),t.result}},simulate:function(e,t,n){var r=m.extend(new m.Event,n,{type:e,isSimulated:!0});m.event.trigger(r,null,t)}}),m.fn.extend({trigger:function(e,t){return this.each(function(){m.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return m.event.trigger(e,t,n,!0)}}),m.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){m.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),m.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),h.focusin="onfocusin"in e,h.focusin||m.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){m.event.simulate(t,e.target,m.event.fix(e))};m.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=X.access(r,t);i||r.addEventListener(e,n,!0),X.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=X.access(r,t)-1;i?X.access(r,t,i):(r.removeEventListener(e,n,!0),X.remove(r,t))}}});var ft=e.location,pt=m.now(),dt=/\?/;m.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+t),n};var ht=/\[\]$/,gt=/\r?\n/g,vt=/^(?:submit|button|image|reset|file)$/i,mt=/^(?:input|select|textarea|keygen)/i;function yt(e,t,n,r){var i;if(m.isArray(t))m.each(t,function(t,i){n||ht.test(e)?r(e,i):yt(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==m.type(t))r(e,t);else for(i in t)yt(e+"["+i+"]",t[i],n,r)}m.param=function(e,t){var n,r=[],i=function(e,t){var n=m.isFunction(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(m.isArray(e)||e.jquery&&!m.isPlainObject(e))m.each(e,function(){i(this.name,this.value)});else for(n in e)yt(n,e[n],t,i);return r.join("&")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=m.prop(this,"elements");return e?m.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!m(this).is(":disabled")&&mt.test(this.nodeName)&&!vt.test(e)&&(this.checked||!oe.test(e))}).map(function(e,t){var n=m(this).val();return null==n?null:m.isArray(n)?m.map(n,function(e){return{name:t.name,value:e.replace(gt,"\r\n")}}):{name:t.name,value:n.replace(gt,"\r\n")}}).get()}});var xt=/%20/g,bt=/#.*$/,wt=/([?&])_=[^&]*/,Tt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ct=/^(?:GET|HEAD)$/,Et=/^\/\//,kt={},Nt={},St="*/".concat("*"),Dt=r.createElement("a");function jt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(O)||[];if(m.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function At(e,t,n,r){var i={},o=e===Nt;function a(s){var u;return i[s]=!0,m.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),u}return a(t.dataTypes[0])||!i["*"]&&a("*")}function qt(e,t){var n,r,i=m.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&m.extend(!0,e,r),e}Dt.href=ft.href,m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ft.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ft.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":St,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?qt(qt(e,m.ajaxSettings),t):qt(m.ajaxSettings,e)},ajaxPrefilter:jt(kt),ajaxTransport:jt(Nt),ajax:function(t,n){"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,o,a,s,u,l,c,f,p,d,h=m.ajaxSetup({},n),g=h.context||h,v=h.context&&(g.nodeType||g.jquery)?m(g):m.event,y=m.Deferred(),x=m.Callbacks("once memory"),b=h.statusCode||{},w={},T={},C="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(c){if(!s)for(s={};t=Tt.exec(a);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return c?a:null},setRequestHeader:function(e,t){return null==c&&(e=T[e.toLowerCase()]=T[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==c&&(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(c)E.always(e[E.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||C;return i&&i.abort(t),k(0,t),this}};if(y.promise(E),h.url=((t||h.url||ft.href)+"").replace(Et,ft.protocol+"//"),h.type=n.method||n.type||h.method||h.type,h.dataTypes=(h.dataType||"*").toLowerCase().match(O)||[""],null==h.crossDomain){l=r.createElement("a");try{l.href=h.url,l.href=l.href,h.crossDomain=Dt.protocol+"//"+Dt.host!=l.protocol+"//"+l.host}catch(e){h.crossDomain=!0}}if(h.data&&h.processData&&"string"!=typeof h.data&&(h.data=m.param(h.data,h.traditional)),At(kt,h,n,E),c)return E;for(p in(f=m.event&&h.global)&&0==m.active++&&m.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Ct.test(h.type),o=h.url.replace(bt,""),h.hasContent?h.data&&h.processData&&0===(h.contentType||"").indexOf("application/x-www-form-urlencoded")&&(h.data=h.data.replace(xt,"+")):(d=h.url.slice(o.length),h.data&&(o+=(dt.test(o)?"&":"?")+h.data,delete h.data),!1===h.cache&&(o=o.replace(wt,"$1"),d=(dt.test(o)?"&":"?")+"_="+pt+++d),h.url=o+d),h.ifModified&&(m.lastModified[o]&&E.setRequestHeader("If-Modified-Since",m.lastModified[o]),m.etag[o]&&E.setRequestHeader("If-None-Match",m.etag[o])),(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&E.setRequestHeader("Content-Type",h.contentType),E.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+St+"; q=0.01":""):h.accepts["*"]),h.headers)E.setRequestHeader(p,h.headers[p]);if(h.beforeSend&&(!1===h.beforeSend.call(g,E,h)||c))return E.abort();if(C="abort",x.add(h.complete),E.done(h.success),E.fail(h.error),i=At(Nt,h,n,E)){if(E.readyState=1,f&&v.trigger("ajaxSend",[E,h]),c)return E;h.async&&h.timeout>0&&(u=e.setTimeout(function(){E.abort("timeout")},h.timeout));try{c=!1,i.send(w,k)}catch(e){if(c)throw e;k(-1,e)}}else k(-1,"No Transport");function k(t,n,r,s){var l,p,d,w,T,C=n;c||(c=!0,u&&e.clearTimeout(u),i=void 0,a=s||"",E.readyState=t>0?4:0,l=t>=200&&t<300||304===t,r&&(w=function(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(h,E,r)),w=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(h,w,E,l),l?(h.ifModified&&((T=E.getResponseHeader("Last-Modified"))&&(m.lastModified[o]=T),(T=E.getResponseHeader("etag"))&&(m.etag[o]=T)),204===t||"HEAD"===h.type?C="nocontent":304===t?C="notmodified":(C=w.state,p=w.data,l=!(d=w.error))):(d=C,!t&&C||(C="error",t<0&&(t=0))),E.status=t,E.statusText=(n||C)+"",l?y.resolveWith(g,[p,C,E]):y.rejectWith(g,[E,C,d]),E.statusCode(b),b=void 0,f&&v.trigger(l?"ajaxSuccess":"ajaxError",[E,h,l?p:d]),x.fireWith(g,[E,C]),f&&(v.trigger("ajaxComplete",[E,h]),--m.active||m.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,n){return m.get(e,t,n,"json")},getScript:function(e,t){return m.get(e,void 0,t,"script")}}),m.each(["get","post"],function(e,t){m[t]=function(e,n,r,i){return m.isFunction(n)&&(i=i||r,r=n,n=void 0),m.ajax(m.extend({url:e,type:t,dataType:i,data:n,success:r},m.isPlainObject(e)&&e))}}),m._evalUrl=function(e){return m.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},m.fn.extend({wrapAll:function(e){var t;return this[0]&&(m.isFunction(e)&&(e=e.call(this[0])),t=m(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return m.isFunction(e)?this.each(function(t){m(this).wrapInner(e.call(this,t))}):this.each(function(){var t=m(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=m.isFunction(e);return this.each(function(n){m(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){m(this).replaceWith(this.childNodes)}),this}}),m.expr.pseudos.hidden=function(e){return!m.expr.pseudos.visible(e)},m.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},m.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Lt={0:200,1223:204},Ht=m.ajaxSettings.xhr();h.cors=!!Ht&&"withCredentials"in Ht,h.ajax=Ht=!!Ht,m.ajaxTransport(function(t){var n,r;if(h.cors||Ht&&!t.crossDomain)return{send:function(i,o){var a,s=t.xhr();if(s.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)s[a]=t.xhrFields[a];for(a in t.mimeType&&s.overrideMimeType&&s.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o(Lt[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),m.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return m.globalEval(e),e}}}),m.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),m.ajaxTransport("script",function(e){var t,n;if(e.crossDomain)return{send:function(i,o){t=m("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),r.head.appendChild(t[0])},abort:function(){n&&n()}}});var Ft=[],Ot=/(=)\?(?=&|$)|\?\?/;function Pt(e){return m.isWindow(e)?e:9===e.nodeType&&e.defaultView}m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Ft.pop()||m.expando+"_"+pt++;return this[e]=!0,e}}),m.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,a,s=!1!==t.jsonp&&(Ot.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ot.test(t.data)&&"data");if(s||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=m.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Ot,"$1"+i):!1!==t.jsonp&&(t.url+=(dt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return a||m.error(i+" was not called"),a[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){a=arguments},r.always(function(){void 0===o?m(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,Ft.push(i)),a&&m.isFunction(o)&&o(a[0]),a=o=void 0}),"script"}),h.createHTMLDocument=function(){var e=r.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),m.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(h.createHTMLDocument?((i=(t=r.implementation.createHTMLDocument("")).createElement("base")).href=r.location.href,t.head.appendChild(i)):t=r),a=!n&&[],(o=S.exec(e))?[t.createElement(o[1])]:(o=pe([e],t,a),a&&a.length&&m(a).remove(),m.merge([],o.childNodes)));var i,o,a},m.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=st(e.slice(s)),e=e.slice(0,s)),m.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&m.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?m("<div>").append(m.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){m.fn[t]=function(e){return this.on(t,e)}}),m.expr.pseudos.animated=function(e){return m.grep(m.timers,function(t){return e===t.elem}).length},m.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=m.css(e,"position"),c=m(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=m.css(e,"top"),u=m.css(e,"left"),("absolute"===l||"fixed"===l)&&(o+u).indexOf("auto")>-1?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m.isFunction(t)&&(t=t.call(e,n,m.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},m.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){m.offset.setOffset(this,e,t)});var t,n,r,i,o=this[0];return o?o.getClientRects().length?(r=o.getBoundingClientRect()).width||r.height?(n=Pt(i=o.ownerDocument),t=i.documentElement,{top:r.top+n.pageYOffset-t.clientTop,left:r.left+n.pageXOffset-t.clientLeft}):r:{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===m.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),m.nodeName(e[0],"html")||(r=e.offset()),r={top:r.top+m.css(e[0],"borderTopWidth",!0),left:r.left+m.css(e[0],"borderLeftWidth",!0)}),{top:t.top-r.top-m.css(n,"marginTop",!0),left:t.left-r.left-m.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===m.css(e,"position");)e=e.offsetParent;return e||de})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;m.fn[e]=function(r){return B(this,function(e,r,i){var o=Pt(e);return void 0===i?o?o[t]:e[r]:void(o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i)},e,r,arguments.length)}}),m.each(["top","left"],function(e,t){m.cssHooks[t]=Re(h.pixelPosition,function(e,n){if(n)return n=Pe(e,t),Fe.test(n)?m(e).position()[t]+"px":n})}),m.each({Height:"height",Width:"width"},function(e,t){m.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){m.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===o?"margin":"border");return B(this,function(t,n,i){var o;return m.isWindow(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?m.css(t,n,s):m.style(t,n,i,s)},t,a?i:void 0,a)}})}),m.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),m.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var Rt=e.jQuery,Mt=e.$;return m.noConflict=function(t){return e.$===m&&(e.$=Mt),t&&e.jQuery===m&&(e.jQuery=Rt),m},t||(e.jQuery=e.$=m),m});
this.createjs=this.createjs||{},createjs.extend=function(t,e){"use strict";function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i},this.createjs=this.createjs||{},createjs.promote=function(t,e){"use strict";var i=t.prototype,s=Object.getPrototypeOf&&Object.getPrototypeOf(i)||i.__proto__;if(s)for(var n in i[(e+="_")+"constructor"]=s.constructor,s)i.hasOwnProperty(n)&&"function"==typeof s[n]&&(i[e+n]=s[n]);return t},this.createjs=this.createjs||{},createjs.indexOf=function(t,e){"use strict";for(var i=0,s=t.length;i<s;i++)if(e===t[i])return i;return-1},this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.type=t,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=!!e,this.cancelable=!!i,this.timeStamp=(new Date).getTime(),this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.removed=!1}var e=t.prototype;e.preventDefault=function(){this.defaultPrevented=this.cancelable&&!0},e.stopPropagation=function(){this.propagationStopped=!0},e.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},e.remove=function(){this.removed=!0},e.clone=function(){return new t(this.type,this.bubbles,this.cancelable)},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this._listeners=null,this._captureListeners=null}var e=t.prototype;t.initialize=function(t){t.addEventListener=e.addEventListener,t.on=e.on,t.removeEventListener=t.off=e.removeEventListener,t.removeAllEventListeners=e.removeAllEventListeners,t.hasEventListener=e.hasEventListener,t.dispatchEvent=e.dispatchEvent,t._dispatchEvent=e._dispatchEvent,t.willTrigger=e.willTrigger},e.addEventListener=function(t,e,i){var s,n=(s=i?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{})[t];return n&&this.removeEventListener(t,e,i),(n=s[t])?n.push(e):s[t]=[e],e},e.on=function(t,e,i,s,n,r){return e.handleEvent&&(i=i||e,e=e.handleEvent),i=i||this,this.addEventListener(t,function(t){e.call(i,t,n),s&&t.remove()},r)},e.removeEventListener=function(t,e,i){var s=i?this._captureListeners:this._listeners;if(s){var n=s[t];if(n)for(var r=0,a=n.length;r<a;r++)if(n[r]==e){1==a?delete s[t]:n.splice(r,1);break}}},e.off=e.removeEventListener,e.removeAllEventListeners=function(t){t?(this._listeners&&delete this._listeners[t],this._captureListeners&&delete this._captureListeners[t]):this._listeners=this._captureListeners=null},e.dispatchEvent=function(t,e,i){if("string"==typeof t){var s=this._listeners;if(!(e||s&&s[t]))return!0;t=new createjs.Event(t,e,i)}else t.target&&t.clone&&(t=t.clone());try{t.target=this}catch(t){}if(t.bubbles&&this.parent){for(var n=this,r=[n];n.parent;)r.push(n=n.parent);var a,h=r.length;for(a=h-1;a>=0&&!t.propagationStopped;a--)r[a]._dispatchEvent(t,1+(0==a));for(a=1;a<h&&!t.propagationStopped;a++)r[a]._dispatchEvent(t,3)}else this._dispatchEvent(t,2);return!t.defaultPrevented},e.hasEventListener=function(t){var e=this._listeners,i=this._captureListeners;return!!(e&&e[t]||i&&i[t])},e.willTrigger=function(t){for(var e=this;e;){if(e.hasEventListener(t))return!0;e=e.parent}return!1},e.toString=function(){return"[EventDispatcher]"},e._dispatchEvent=function(t,e){var i,s=1==e?this._captureListeners:this._listeners;if(t&&s){var n=s[t.type];if(!n||!(i=n.length))return;try{t.currentTarget=this}catch(t){}try{t.eventPhase=e}catch(t){}t.removed=!1,n=n.slice();for(var r=0;r<i&&!t.immediatePropagationStopped;r++){var a=n[r];a.handleEvent?a.handleEvent(t):a(t),t.removed&&(this.off(t.type,a,1==e),t.removed=!1)}}},createjs.EventDispatcher=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"Ticker cannot be instantiated."}t.RAF_SYNCHED="synched",t.RAF="raf",t.TIMEOUT="timeout",t.useRAF=!1,t.timingMode=null,t.maxDelta=0,t.paused=!1,t.removeEventListener=null,t.removeAllEventListeners=null,t.dispatchEvent=null,t.hasEventListener=null,t._listeners=null,createjs.EventDispatcher.initialize(t),t._addEventListener=t.addEventListener,t.addEventListener=function(){return!t._inited&&t.init(),t._addEventListener.apply(t,arguments)},t._inited=!1,t._startTime=0,t._pausedTime=0,t._ticks=0,t._pausedTicks=0,t._interval=50,t._lastTime=0,t._times=null,t._tickTimes=null,t._timerId=null,t._raf=!0,t.setInterval=function(e){t._interval=e,t._inited&&t._setupTick()},t.getInterval=function(){return t._interval},t.setFPS=function(e){t.setInterval(1e3/e)},t.getFPS=function(){return 1e3/t._interval};try{Object.defineProperties(t,{interval:{get:t.getInterval,set:t.setInterval},framerate:{get:t.getFPS,set:t.setFPS}})}catch(t){console.log(t)}t.init=function(){t._inited||(t._inited=!0,t._times=[],t._tickTimes=[],t._startTime=t._getTime(),t._times.push(t._lastTime=0),t.interval=t._interval)},t.reset=function(){if(t._raf){var e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;e&&e(t._timerId)}else clearTimeout(t._timerId);t.removeAllEventListeners("tick"),t._timerId=t._times=t._tickTimes=null,t._startTime=t._lastTime=t._ticks=0,t._inited=!1},t.getMeasuredTickTime=function(e){var i=0,s=t._tickTimes;if(!s||s.length<1)return-1;e=Math.min(s.length,e||0|t.getFPS());for(var n=0;n<e;n++)i+=s[n];return i/e},t.getMeasuredFPS=function(e){var i=t._times;return!i||i.length<2?-1:(e=Math.min(i.length-1,e||0|t.getFPS()),1e3/((i[0]-i[e])/e))},t.setPaused=function(e){t.paused=e},t.getPaused=function(){return t.paused},t.getTime=function(e){return t._startTime?t._getTime()-(e?t._pausedTime:0):-1},t.getEventTime=function(e){return t._startTime?(t._lastTime||t._startTime)-(e?t._pausedTime:0):-1},t.getTicks=function(e){return t._ticks-(e?t._pausedTicks:0)},t._handleSynch=function(){t._timerId=null,t._setupTick(),t._getTime()-t._lastTime>=.97*(t._interval-1)&&t._tick()},t._handleRAF=function(){t._timerId=null,t._setupTick(),t._tick()},t._handleTimeout=function(){t._timerId=null,t._setupTick(),t._tick()},t._setupTick=function(){if(null==t._timerId){var e=t.timingMode||t.useRAF&&t.RAF_SYNCHED;if(e==t.RAF_SYNCHED||e==t.RAF){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(i)return t._timerId=i(e==t.RAF?t._handleRAF:t._handleSynch),void(t._raf=!0)}t._raf=!1,t._timerId=setTimeout(t._handleTimeout,t._interval)}},t._tick=function(){var e=t.paused,i=t._getTime(),s=i-t._lastTime;if(t._lastTime=i,t._ticks++,e&&(t._pausedTicks++,t._pausedTime+=s),t.hasEventListener("tick")){var n=new createjs.Event("tick"),r=t.maxDelta;n.delta=r&&s>r?r:s,n.paused=e,n.time=i,n.runTime=i-t._pausedTime,t.dispatchEvent(n)}for(t._tickTimes.unshift(t._getTime()-i);t._tickTimes.length>100;)t._tickTimes.pop();for(t._times.unshift(i);t._times.length>100;)t._times.pop()};var e=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);t._getTime=function(){return(e&&e.call(performance)||(new Date).getTime())-t._startTime},createjs.Ticker=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"UID cannot be instantiated"}t._nextID=0,t.get=function(){return t._nextID++},createjs.UID=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s,n,r,a,h,o,c,l){this.Event_constructor(t,e,i),this.stageX=s,this.stageY=n,this.rawX=null==o?s:o,this.rawY=null==c?n:c,this.nativeEvent=r,this.pointerID=a,this.primary=!!h,this.relatedTarget=l}var e=createjs.extend(t,createjs.Event);e._get_localX=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x},e._get_localY=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y},e._get_isTouch=function(){return-1!==this.pointerID};try{Object.defineProperties(e,{localX:{get:e._get_localX},localY:{get:e._get_localY},isTouch:{get:e._get_isTouch}})}catch(t){}e.clone=function(){return new t(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},e.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=createjs.promote(t,"Event")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s,n,r){this.setValues(t,e,i,s,n,r)}var e=t.prototype;t.DEG_TO_RAD=Math.PI/180,t.identity=null,e.setValues=function(t,e,i,s,n,r){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==s?1:s,this.tx=n||0,this.ty=r||0,this},e.append=function(t,e,i,s,n,r){var a=this.a,h=this.b,o=this.c,c=this.d;return 1==t&&0==e&&0==i&&1==s||(this.a=a*t+o*e,this.b=h*t+c*e,this.c=a*i+o*s,this.d=h*i+c*s),this.tx=a*n+o*r+this.tx,this.ty=h*n+c*r+this.ty,this},e.prepend=function(t,e,i,s,n,r){var a=this.a,h=this.c,o=this.tx;return this.a=t*a+i*this.b,this.b=e*a+s*this.b,this.c=t*h+i*this.d,this.d=e*h+s*this.d,this.tx=t*o+i*this.ty+n,this.ty=e*o+s*this.ty+r,this},e.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.appendTransform=function(e,i,s,n,r,a,h,o,c){if(r%360)var l=r*t.DEG_TO_RAD,u=Math.cos(l),d=Math.sin(l);else u=1,d=0;return a||h?(a*=t.DEG_TO_RAD,h*=t.DEG_TO_RAD,this.append(Math.cos(h),Math.sin(h),-Math.sin(a),Math.cos(a),e,i),this.append(u*s,d*s,-d*n,u*n,0,0)):this.append(u*s,d*s,-d*n,u*n,e,i),(o||c)&&(this.tx-=o*this.a+c*this.c,this.ty-=o*this.b+c*this.d),this},e.prependTransform=function(e,i,s,n,r,a,h,o,c){if(r%360)var l=r*t.DEG_TO_RAD,u=Math.cos(l),d=Math.sin(l);else u=1,d=0;return(o||c)&&(this.tx-=o,this.ty-=c),a||h?(a*=t.DEG_TO_RAD,h*=t.DEG_TO_RAD,this.prepend(u*s,d*s,-d*n,u*n,0,0),this.prepend(Math.cos(h),Math.sin(h),-Math.sin(a),Math.cos(a),e,i)):this.prepend(u*s,d*s,-d*n,u*n,e,i),this},e.rotate=function(e){e*=t.DEG_TO_RAD;var i=Math.cos(e),s=Math.sin(e),n=this.a,r=this.b;return this.a=n*i+this.c*s,this.b=r*i+this.d*s,this.c=-n*s+this.c*i,this.d=-r*s+this.d*i,this},e.skew=function(e,i){return e*=t.DEG_TO_RAD,i*=t.DEG_TO_RAD,this.append(Math.cos(i),Math.sin(i),-Math.sin(e),Math.cos(e),0,0),this},e.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},e.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},e.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},e.invert=function(){var t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,r=t*s-e*i;return this.a=s/r,this.b=-e/r,this.c=-i/r,this.d=t/r,this.tx=(i*this.ty-s*n)/r,this.ty=-(t*this.ty-e*n)/r,this},e.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},e.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},e.transformPoint=function(t,e,i){return(i=i||{}).x=t*this.a+e*this.c+this.tx,i.y=t*this.b+e*this.d+this.ty,i},e.decompose=function(e){null==e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var i=Math.atan2(-this.c,this.d),s=Math.atan2(this.b,this.a);return Math.abs(1-i/s)<1e-5?(e.rotation=s/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=i/t.DEG_TO_RAD,e.skewY=s/t.DEG_TO_RAD),e},e.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)},e.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.identity=new t,createjs.Matrix2D=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s,n){this.setValues(t,e,i,s,n)}var e=t.prototype;e.setValues=function(t,e,i,s,n){return this.visible=null==t||!!t,this.alpha=null==e?1:e,this.shadow=i,this.compositeOperation=s,this.matrix=n||this.matrix&&this.matrix.identity()||new createjs.Matrix2D,this},e.append=function(t,e,i,s,n){return this.alpha*=e,this.shadow=i||this.shadow,this.compositeOperation=s||this.compositeOperation,this.visible=this.visible&&t,n&&this.matrix.appendMatrix(n),this},e.prepend=function(t,e,i,s,n){return this.alpha*=e,this.shadow=this.shadow||i,this.compositeOperation=this.compositeOperation||s,this.visible=this.visible&&t,n&&this.matrix.prependMatrix(n),this},e.identity=function(){return this.visible=!0,this.alpha=1,this.shadow=this.compositeOperation=null,this.matrix.identity(),this},e.clone=function(){return new t(this.alpha,this.shadow,this.compositeOperation,this.visible,this.matrix.clone())},createjs.DisplayProps=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.setValues(t,e)}var e=t.prototype;e.setValues=function(t,e){return this.x=t||0,this.y=e||0,this},e.copy=function(t){return this.x=t.x,this.y=t.y,this},e.clone=function(){return new t(this.x,this.y)},e.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s){this.setValues(t,e,i,s)}var e=t.prototype;e.setValues=function(t,e,i,s){return this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0,this},e.extend=function(t,e,i,s){return s=s||0,t+(i=i||0)>this.x+this.width&&(this.width=t+i-this.x),e+s>this.y+this.height&&(this.height=e+s-this.y),t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),this},e.pad=function(t,e,i,s){return this.x-=e,this.y-=t,this.width+=e+s,this.height+=t+i,this},e.copy=function(t){return this.setValues(t.x,t.y,t.width,t.height)},e.contains=function(t,e,i,s){return i=i||0,s=s||0,t>=this.x&&t+i<=this.x+this.width&&e>=this.y&&e+s<=this.y+this.height},e.union=function(t){return this.clone().extend(t.x,t.y,t.width,t.height)},e.intersection=function(e){var i=e.x,s=e.y,n=i+e.width,r=s+e.height;return this.x>i&&(i=this.x),this.y>s&&(s=this.y),this.x+this.width<n&&(n=this.x+this.width),this.y+this.height<r&&(r=this.y+this.height),n<=i||r<=s?null:new t(i,s,n-i,r-s)},e.intersects=function(t){return t.x<=this.x+this.width&&this.x<=t.x+t.width&&t.y<=this.y+this.height&&this.y<=t.y+t.height},e.isEmpty=function(){return this.width<=0||this.height<=0},e.clone=function(){return new t(this.x,this.y,this.width,this.height)},e.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s,n,r,a){t.addEventListener&&(this.target=t,this.overLabel=null==i?"over":i,this.outLabel=null==e?"out":e,this.downLabel=null==s?"down":s,this.play=n,this._isPressed=!1,this._isOver=!1,this._enabled=!1,t.mouseChildren=!1,this.enabled=!0,this.handleEvent({}),r&&(a&&(r.actionsEnabled=!1,r.gotoAndStop&&r.gotoAndStop(a)),t.hitArea=r))}var e=t.prototype;e.setEnabled=function(t){if(t!=this._enabled){var e=this.target;this._enabled=t,t?(e.cursor="pointer",e.addEventListener("rollover",this),e.addEventListener("rollout",this),e.addEventListener("mousedown",this),e.addEventListener("pressup",this),e._reset&&(e.__reset=e._reset,e._reset=this._reset)):(e.cursor=null,e.removeEventListener("rollover",this),e.removeEventListener("rollout",this),e.removeEventListener("mousedown",this),e.removeEventListener("pressup",this),e.__reset&&(e._reset=e.__reset,delete e.__reset))}},e.getEnabled=function(){return this._enabled};try{Object.defineProperties(e,{enabled:{get:e.getEnabled,set:e.setEnabled}})}catch(t){}e.toString=function(){return"[ButtonHelper]"},e.handleEvent=function(t){var e,i=this.target,s=t.type;"mousedown"==s?(this._isPressed=!0,e=this.downLabel):"pressup"==s?(this._isPressed=!1,e=this._isOver?this.overLabel:this.outLabel):"rollover"==s?(this._isOver=!0,e=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,e=this._isPressed?this.overLabel:this.outLabel),this.play?i.gotoAndPlay&&i.gotoAndPlay(e):i.gotoAndStop&&i.gotoAndStop(e)},e._reset=function(){var t=this.paused;this.__reset(),this.paused=t},createjs.ButtonHelper=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s){this.color=t||"black",this.offsetX=e||0,this.offsetY=i||0,this.blur=s||0}var e=t.prototype;t.identity=new t("transparent",0,0,0),e.toString=function(){return"[Shadow]"},e.clone=function(){return new t(this.color,this.offsetX,this.offsetY,this.blur)},createjs.Shadow=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.EventDispatcher_constructor(),this.complete=!0,this.framerate=0,this._animations=null,this._frames=null,this._images=null,this._data=null,this._loadCount=0,this._frameHeight=0,this._frameWidth=0,this._numFrames=0,this._regX=0,this._regY=0,this._spacing=0,this._margin=0,this._parseData(t)}var e=createjs.extend(t,createjs.EventDispatcher);e.getAnimations=function(){return this._animations.slice()};try{Object.defineProperties(e,{animations:{get:e.getAnimations}})}catch(t){}e.getNumFrames=function(t){if(null==t)return this._frames?this._frames.length:this._numFrames||0;var e=this._data[t];return null==e?0:e.frames.length},e.getAnimation=function(t){return this._data[t]},e.getFrame=function(t){var e;return this._frames&&(e=this._frames[t])?e:null},e.getFrameBounds=function(t,e){var i=this.getFrame(t);return i?(e||new createjs.Rectangle).setValues(-i.regX,-i.regY,i.rect.width,i.rect.height):null},e.toString=function(){return"[SpriteSheet]"},e.clone=function(){throw"SpriteSheet cannot be cloned."},e._parseData=function(t){var e,i,s,n;if(null!=t){if(this.framerate=t.framerate||0,t.images&&(i=t.images.length)>0)for(n=this._images=[],e=0;e<i;e++){var r=t.images[e];if("string"==typeof r){var a=r;(r=document.createElement("img")).src=a}n.push(r),r.getContext||r.naturalWidth||(this._loadCount++,this.complete=!1,function(t,e){r.onload=function(){t._handleImageLoad(e)}}(this,a),function(t,e){r.onerror=function(){t._handleImageError(e)}}(this,a))}if(null==t.frames);else if(Array.isArray(t.frames))for(this._frames=[],e=0,i=(n=t.frames).length;e<i;e++){var h=n[e];this._frames.push({image:this._images[h[4]?h[4]:0],rect:new createjs.Rectangle(h[0],h[1],h[2],h[3]),regX:h[5]||0,regY:h[6]||0})}else s=t.frames,this._frameWidth=s.width,this._frameHeight=s.height,this._regX=s.regX||0,this._regY=s.regY||0,this._spacing=s.spacing||0,this._margin=s.margin||0,this._numFrames=s.count,0==this._loadCount&&this._calculateFrames();var o;if(this._animations=[],null!=(s=t.animations))for(o in this._data={},s){var c={name:o},l=s[o];if("number"==typeof l)n=c.frames=[l];else if(Array.isArray(l))if(1==l.length)c.frames=[l[0]];else for(c.speed=l[3],c.next=l[2],n=c.frames=[],e=l[0];e<=l[1];e++)n.push(e);else{c.speed=l.speed,c.next=l.next;var u=l.frames;n=c.frames="number"==typeof u?[u]:u.slice(0)}!0!==c.next&&void 0!==c.next||(c.next=o),(!1===c.next||n.length<2&&c.next==o)&&(c.next=null),c.speed||(c.speed=1),this._animations.push(o),this._data[o]=c}}},e._handleImageLoad=function(t){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))},e._handleImageError=function(t){var e=new createjs.Event("error");e.src=t,this.dispatchEvent(e),0==--this._loadCount&&this.dispatchEvent("complete")},e._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];var t=this._numFrames||1e5,e=0,i=this._frameWidth,s=this._frameHeight,n=this._spacing,r=this._margin;t:for(var a=0,h=this._images;a<h.length;a++)for(var o=h[a],c=o.width,l=o.height,u=r;u<=l-r-s;){for(var d=r;d<=c-r-i;){if(e>=t)break t;e++,this._frames.push({image:o,rect:new createjs.Rectangle(d,u,i,s),regX:this._regX,regY:this._regY}),d+=i+n}u+=s+n}this._numFrames=e}},createjs.SpriteSheet=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this.command=null,this._stroke=null,this._strokeStyle=null,this._oldStrokeStyle=null,this._strokeDash=null,this._oldStrokeDash=null,this._strokeIgnoreScale=!1,this._fill=null,this._instructions=[],this._commitIndex=0,this._activeInstructions=[],this._dirty=!1,this._storeIndex=0,this.clear()}var e=t.prototype,i=t;t.getRGB=function(t,e,i,s){return null!=t&&null==i&&(s=e,i=255&t,e=t>>8&255,t=t>>16&255),null==s?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+","+s+")"},t.getHSL=function(t,e,i,s){return null==s?"hsl("+t%360+","+e+"%,"+i+"%)":"hsla("+t%360+","+e+"%,"+i+"%,"+s+")"},t.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},t.STROKE_CAPS_MAP=["butt","round","square"],t.STROKE_JOINTS_MAP=["miter","round","bevel"];var s=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");s.getContext&&(t._ctx=s.getContext("2d"),s.width=s.height=1),e.getInstructions=function(){return this._updateInstructions(),this._instructions};try{Object.defineProperties(e,{instructions:{get:e.getInstructions}})}catch(t){}e.isEmpty=function(){return!(this._instructions.length||this._activeInstructions.length)},e.draw=function(t,e){this._updateInstructions();for(var i=this._instructions,s=this._storeIndex,n=i.length;s<n;s++)i[s].exec(t,e)},e.drawAsPath=function(t){this._updateInstructions();for(var e,i=this._instructions,s=this._storeIndex,n=i.length;s<n;s++)!1!==(e=i[s]).path&&e.exec(t)},e.moveTo=function(t,e){return this.append(new i.MoveTo(t,e),!0)},e.lineTo=function(t,e){return this.append(new i.LineTo(t,e))},e.arcTo=function(t,e,s,n,r){return this.append(new i.ArcTo(t,e,s,n,r))},e.arc=function(t,e,s,n,r,a){return this.append(new i.Arc(t,e,s,n,r,a))},e.quadraticCurveTo=function(t,e,s,n){return this.append(new i.QuadraticCurveTo(t,e,s,n))},e.bezierCurveTo=function(t,e,s,n,r,a){return this.append(new i.BezierCurveTo(t,e,s,n,r,a))},e.rect=function(t,e,s,n){return this.append(new i.Rect(t,e,s,n))},e.closePath=function(){return this._activeInstructions.length?this.append(new i.ClosePath):this},e.clear=function(){return this._instructions.length=this._activeInstructions.length=this._commitIndex=0,this._strokeStyle=this._oldStrokeStyle=this._stroke=this._fill=this._strokeDash=this._oldStrokeDash=null,this._dirty=this._strokeIgnoreScale=!1,this},e.beginFill=function(t){return this._setFill(t?new i.Fill(t):null)},e.beginLinearGradientFill=function(t,e,s,n,r,a){return this._setFill((new i.Fill).linearGradient(t,e,s,n,r,a))},e.beginRadialGradientFill=function(t,e,s,n,r,a,h,o){return this._setFill((new i.Fill).radialGradient(t,e,s,n,r,a,h,o))},e.beginBitmapFill=function(t,e,s){return this._setFill(new i.Fill(null,s).bitmap(t,e))},e.endFill=function(){return this.beginFill()},e.setStrokeStyle=function(t,e,s,n,r){return this._updateInstructions(!0),this._strokeStyle=this.command=new i.StrokeStyle(t,e,s,n,r),this._stroke&&(this._stroke.ignoreScale=r),this._strokeIgnoreScale=r,this},e.setStrokeDash=function(t,e){return this._updateInstructions(!0),this._strokeDash=this.command=new i.StrokeDash(t,e),this},e.beginStroke=function(t){return this._setStroke(t?new i.Stroke(t):null)},e.beginLinearGradientStroke=function(t,e,s,n,r,a){return this._setStroke((new i.Stroke).linearGradient(t,e,s,n,r,a))},e.beginRadialGradientStroke=function(t,e,s,n,r,a,h,o){return this._setStroke((new i.Stroke).radialGradient(t,e,s,n,r,a,h,o))},e.beginBitmapStroke=function(t,e){return this._setStroke((new i.Stroke).bitmap(t,e))},e.endStroke=function(){return this.beginStroke()},e.curveTo=e.quadraticCurveTo,e.drawRect=e.rect,e.drawRoundRect=function(t,e,i,s,n){return this.drawRoundRectComplex(t,e,i,s,n,n,n,n)},e.drawRoundRectComplex=function(t,e,s,n,r,a,h,o){return this.append(new i.RoundRect(t,e,s,n,r,a,h,o))},e.drawCircle=function(t,e,s){return this.append(new i.Circle(t,e,s))},e.drawEllipse=function(t,e,s,n){return this.append(new i.Ellipse(t,e,s,n))},e.drawPolyStar=function(t,e,s,n,r,a){return this.append(new i.PolyStar(t,e,s,n,r,a))},e.append=function(t,e){return this._activeInstructions.push(t),this.command=t,e||(this._dirty=!0),this},e.decodePath=function(e){for(var i=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],s=[2,2,4,6,0],n=0,r=e.length,a=[],h=0,o=0,c=t.BASE_64;n<r;){var l=e.charAt(n),u=c[l],d=u>>3,p=i[d];if(!p||3&u)throw"bad path data (@"+n+"): "+l;var f=s[d];d||(h=o=0),a.length=0,n++;for(var _=2+(u>>2&1),m=0;m<f;m++){var g=c[e.charAt(n)],v=g>>5?-1:1;g=(31&g)<<6|c[e.charAt(n+1)],3==_&&(g=g<<6|c[e.charAt(n+2)]),g=v*g/10,m%2?h=g+=h:o=g+=o,a[m]=g,n+=_}p.apply(this,a)}return this},e.store=function(){return this._updateInstructions(!0),this._storeIndex=this._instructions.length,this},e.unstore=function(){return this._storeIndex=0,this},e.clone=function(){var e=new t;return e.command=this.command,e._stroke=this._stroke,e._strokeStyle=this._strokeStyle,e._strokeDash=this._strokeDash,e._strokeIgnoreScale=this._strokeIgnoreScale,e._fill=this._fill,e._instructions=this._instructions.slice(),e._commitIndex=this._commitIndex,e._activeInstructions=this._activeInstructions.slice(),e._dirty=this._dirty,e._storeIndex=this._storeIndex,e},e.toString=function(){return"[Graphics]"},e.mt=e.moveTo,e.lt=e.lineTo,e.at=e.arcTo,e.bt=e.bezierCurveTo,e.qt=e.quadraticCurveTo,e.a=e.arc,e.r=e.rect,e.cp=e.closePath,e.c=e.clear,e.f=e.beginFill,e.lf=e.beginLinearGradientFill,e.rf=e.beginRadialGradientFill,e.bf=e.beginBitmapFill,e.ef=e.endFill,e.ss=e.setStrokeStyle,e.sd=e.setStrokeDash,e.s=e.beginStroke,e.ls=e.beginLinearGradientStroke,e.rs=e.beginRadialGradientStroke,e.bs=e.beginBitmapStroke,e.es=e.endStroke,e.dr=e.drawRect,e.rr=e.drawRoundRect,e.rc=e.drawRoundRectComplex,e.dc=e.drawCircle,e.de=e.drawEllipse,e.dp=e.drawPolyStar,e.p=e.decodePath,e._updateInstructions=function(e){var i=this._instructions,s=this._activeInstructions,n=this._commitIndex;if(this._dirty&&s.length){i.length=n,i.push(t.beginCmd);var r=s.length,a=i.length;i.length=a+r;for(var h=0;h<r;h++)i[h+a]=s[h];this._fill&&i.push(this._fill),this._stroke&&(this._strokeDash!==this._oldStrokeDash&&(this._oldStrokeDash=this._strokeDash,i.push(this._strokeDash)),this._strokeStyle!==this._oldStrokeStyle&&(this._oldStrokeStyle=this._strokeStyle,i.push(this._strokeStyle)),i.push(this._stroke)),this._dirty=!1}e&&(s.length=0,this._commitIndex=i.length)},e._setFill=function(t){return this._updateInstructions(!0),this.command=this._fill=t,this},e._setStroke=function(t){return this._updateInstructions(!0),(this.command=this._stroke=t)&&(t.ignoreScale=this._strokeIgnoreScale),this},(i.LineTo=function(t,e){this.x=t,this.y=e}).prototype.exec=function(t){t.lineTo(this.x,this.y)},(i.MoveTo=function(t,e){this.x=t,this.y=e}).prototype.exec=function(t){t.moveTo(this.x,this.y)},(i.ArcTo=function(t,e,i,s,n){this.x1=t,this.y1=e,this.x2=i,this.y2=s,this.radius=n}).prototype.exec=function(t){t.arcTo(this.x1,this.y1,this.x2,this.y2,this.radius)},(i.Arc=function(t,e,i,s,n,r){this.x=t,this.y=e,this.radius=i,this.startAngle=s,this.endAngle=n,this.anticlockwise=!!r}).prototype.exec=function(t){t.arc(this.x,this.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},(i.QuadraticCurveTo=function(t,e,i,s){this.cpx=t,this.cpy=e,this.x=i,this.y=s}).prototype.exec=function(t){t.quadraticCurveTo(this.cpx,this.cpy,this.x,this.y)},(i.BezierCurveTo=function(t,e,i,s,n,r){this.cp1x=t,this.cp1y=e,this.cp2x=i,this.cp2y=s,this.x=n,this.y=r}).prototype.exec=function(t){t.bezierCurveTo(this.cp1x,this.cp1y,this.cp2x,this.cp2y,this.x,this.y)},(i.Rect=function(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}).prototype.exec=function(t){t.rect(this.x,this.y,this.w,this.h)},(i.ClosePath=function(){}).prototype.exec=function(t){t.closePath()},(i.BeginPath=function(){}).prototype.exec=function(t){t.beginPath()},(e=(i.Fill=function(t,e){this.style=t,this.matrix=e}).prototype).exec=function(t){if(this.style){t.fillStyle=this.style;var e=this.matrix;e&&(t.save(),t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)),t.fill(),e&&t.restore()}},e.linearGradient=function(e,i,s,n,r,a){for(var h=this.style=t._ctx.createLinearGradient(s,n,r,a),o=0,c=e.length;o<c;o++)h.addColorStop(i[o],e[o]);return h.props={colors:e,ratios:i,x0:s,y0:n,x1:r,y1:a,type:"linear"},this},e.radialGradient=function(e,i,s,n,r,a,h,o){for(var c=this.style=t._ctx.createRadialGradient(s,n,r,a,h,o),l=0,u=e.length;l<u;l++)c.addColorStop(i[l],e[l]);return c.props={colors:e,ratios:i,x0:s,y0:n,r0:r,x1:a,y1:h,r1:o,type:"radial"},this},e.bitmap=function(e,i){(e.naturalWidth||e.getContext||e.readyState>=2)&&((this.style=t._ctx.createPattern(e,i||"")).props={image:e,repetition:i,type:"bitmap"});return this},e.path=!1,(e=(i.Stroke=function(t,e){this.style=t,this.ignoreScale=e}).prototype).exec=function(t){this.style&&(t.strokeStyle=this.style,this.ignoreScale&&(t.save(),t.setTransform(1,0,0,1,0,0)),t.stroke(),this.ignoreScale&&t.restore())},e.linearGradient=i.Fill.prototype.linearGradient,e.radialGradient=i.Fill.prototype.radialGradient,e.bitmap=i.Fill.prototype.bitmap,e.path=!1,(e=(i.StrokeStyle=function(t,e,i,s,n){this.width=t,this.caps=e,this.joints=i,this.miterLimit=s,this.ignoreScale=n}).prototype).exec=function(e){e.lineWidth=null==this.width?"1":this.width,e.lineCap=null==this.caps?"butt":isNaN(this.caps)?this.caps:t.STROKE_CAPS_MAP[this.caps],e.lineJoin=null==this.joints?"miter":isNaN(this.joints)?this.joints:t.STROKE_JOINTS_MAP[this.joints],e.miterLimit=null==this.miterLimit?"10":this.miterLimit,e.ignoreScale=null!=this.ignoreScale&&this.ignoreScale},e.path=!1,(i.StrokeDash=function(t,e){this.segments=t,this.offset=e||0}).prototype.exec=function(t){t.setLineDash&&(t.setLineDash(this.segments||i.StrokeDash.EMPTY_SEGMENTS),t.lineDashOffset=this.offset||0)},i.StrokeDash.EMPTY_SEGMENTS=[],(i.RoundRect=function(t,e,i,s,n,r,a,h){this.x=t,this.y=e,this.w=i,this.h=s,this.radiusTL=n,this.radiusTR=r,this.radiusBR=a,this.radiusBL=h}).prototype.exec=function(t){var e=(o<c?o:c)/2,i=0,s=0,n=0,r=0,a=this.x,h=this.y,o=this.w,c=this.h,l=this.radiusTL,u=this.radiusTR,d=this.radiusBR,p=this.radiusBL;l<0&&(l*=i=-1),l>e&&(l=e),u<0&&(u*=s=-1),u>e&&(u=e),d<0&&(d*=n=-1),d>e&&(d=e),p<0&&(p*=r=-1),p>e&&(p=e),t.moveTo(a+o-u,h),t.arcTo(a+o+u*s,h-u*s,a+o,h+u,u),t.lineTo(a+o,h+c-d),t.arcTo(a+o+d*n,h+c+d*n,a+o-d,h+c,d),t.lineTo(a+p,h+c),t.arcTo(a-p*r,h+c+p*r,a,h+c-p,p),t.lineTo(a,h+l),t.arcTo(a-l*i,h-l*i,a+l,h,l),t.closePath()},(i.Circle=function(t,e,i){this.x=t,this.y=e,this.radius=i}).prototype.exec=function(t){t.arc(this.x,this.y,this.radius,0,2*Math.PI)},(i.Ellipse=function(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}).prototype.exec=function(t){var e=this.x,i=this.y,s=this.w,n=this.h,r=.5522848,a=s/2*r,h=n/2*r,o=e+s,c=i+n,l=e+s/2,u=i+n/2;t.moveTo(e,u),t.bezierCurveTo(e,u-h,l-a,i,l,i),t.bezierCurveTo(l+a,i,o,u-h,o,u),t.bezierCurveTo(o,u+h,l+a,c,l,c),t.bezierCurveTo(l-a,c,e,u+h,e,u)},(i.PolyStar=function(t,e,i,s,n,r){this.x=t,this.y=e,this.radius=i,this.sides=s,this.pointSize=n,this.angle=r}).prototype.exec=function(t){var e=this.x,i=this.y,s=this.radius,n=(this.angle||0)/180*Math.PI,r=this.sides,a=1-(this.pointSize||0),h=Math.PI/r;t.moveTo(e+Math.cos(n)*s,i+Math.sin(n)*s);for(var o=0;o<r;o++)n+=h,1!=a&&t.lineTo(e+Math.cos(n)*s*a,i+Math.sin(n)*s*a),n+=h,t.lineTo(e+Math.cos(n)*s,i+Math.sin(n)*s);t.closePath()},t.beginCmd=new i.BeginPath,createjs.Graphics=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this.EventDispatcher_constructor(),this.alpha=1,this.cacheCanvas=null,this.cacheID=0,this.id=createjs.UID.get(),this.mouseEnabled=!0,this.tickEnabled=!0,this.name=null,this.parent=null,this.regX=0,this.regY=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.shadow=null,this.visible=!0,this.x=0,this.y=0,this.transformMatrix=null,this.compositeOperation=null,this.snapToPixel=!0,this.filters=null,this.mask=null,this.hitArea=null,this.cursor=null,this._cacheOffsetX=0,this._cacheOffsetY=0,this._filterOffsetX=0,this._filterOffsetY=0,this._cacheScale=1,this._cacheDataURLID=0,this._cacheDataURL=null,this._props=new createjs.DisplayProps,this._rectangle=new createjs.Rectangle,this._bounds=null}var e=createjs.extend(t,createjs.EventDispatcher);t._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],t.suppressCrossDomainErrors=!1,t._snapToPixelEnabled=!1;var i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.getContext&&(t._hitTestCanvas=i,t._hitTestContext=i.getContext("2d"),i.width=i.height=1),t._nextCacheID=1,e.getStage=function(){for(var t=this,e=createjs.Stage;t.parent;)t=t.parent;return t instanceof e?t:null};try{Object.defineProperties(e,{stage:{get:e.getStage}})}catch(t){}e.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},e.draw=function(t,e){var i=this.cacheCanvas;if(e||!i)return!1;var s=this._cacheScale;return t.drawImage(i,this._cacheOffsetX+this._filterOffsetX,this._cacheOffsetY+this._filterOffsetY,i.width/s,i.height/s),!0},e.updateContext=function(e){var i=this,s=i.mask,n=i._props.matrix;s&&s.graphics&&!s.graphics.isEmpty()&&(s.getMatrix(n),e.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),s.graphics.drawAsPath(e),e.clip(),n.invert(),e.transform(n.a,n.b,n.c,n.d,n.tx,n.ty)),this.getMatrix(n);var r=n.tx,a=n.ty;t._snapToPixelEnabled&&i.snapToPixel&&(r=r+(r<0?-.5:.5)|0,a=a+(a<0?-.5:.5)|0),e.transform(n.a,n.b,n.c,n.d,r,a),e.globalAlpha*=i.alpha,i.compositeOperation&&(e.globalCompositeOperation=i.compositeOperation),i.shadow&&this._applyShadow(e,i.shadow)},e.cache=function(t,e,i,s,n){n=n||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this._cacheWidth=i,this._cacheHeight=s,this._cacheOffsetX=t,this._cacheOffsetY=e,this._cacheScale=n,this.updateCache()},e.updateCache=function(e){var i=this.cacheCanvas;if(!i)throw"cache() must be called before updateCache()";var s=this._cacheScale,n=this._cacheOffsetX*s,r=this._cacheOffsetY*s,a=this._cacheWidth,h=this._cacheHeight,o=i.getContext("2d"),c=this._getFilterBounds();n+=this._filterOffsetX=c.x,r+=this._filterOffsetY=c.y,a=Math.ceil(a*s)+c.width,h=Math.ceil(h*s)+c.height,a!=i.width||h!=i.height?(i.width=a,i.height=h):e||o.clearRect(0,0,a+1,h+1),o.save(),o.globalCompositeOperation=e,o.setTransform(s,0,0,s,-n,-r),this.draw(o,!0),this._applyFilters(),o.restore(),this.cacheID=t._nextCacheID++},e.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=this._filterOffsetX=this._filterOffsetY=0,this._cacheScale=1},e.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},e.localToGlobal=function(t,e,i){return this.getConcatenatedMatrix(this._props.matrix).transformPoint(t,e,i||new createjs.Point)},e.globalToLocal=function(t,e,i){return this.getConcatenatedMatrix(this._props.matrix).invert().transformPoint(t,e,i||new createjs.Point)},e.localToLocal=function(t,e,i,s){return s=this.localToGlobal(t,e,s),i.globalToLocal(s.x,s.y,s)},e.setTransform=function(t,e,i,s,n,r,a,h,o){return this.x=t||0,this.y=e||0,this.scaleX=null==i?1:i,this.scaleY=null==s?1:s,this.rotation=n||0,this.skewX=r||0,this.skewY=a||0,this.regX=h||0,this.regY=o||0,this},e.getMatrix=function(t){var e=this,i=t&&t.identity()||new createjs.Matrix2D;return e.transformMatrix?i.copy(e.transformMatrix):i.appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY)},e.getConcatenatedMatrix=function(t){for(var e=this,i=this.getMatrix(t);e=e.parent;)i.prependMatrix(e.getMatrix(e._props.matrix));return i},e.getConcatenatedDisplayProps=function(t){t=t?t.identity():new createjs.DisplayProps;var e=this,i=e.getMatrix(t.matrix);do{t.prepend(e.visible,e.alpha,e.shadow,e.compositeOperation),e!=this&&i.prependMatrix(e.getMatrix(e._props.matrix))}while(e=e.parent);return t},e.hitTest=function(e,i){var s=t._hitTestContext;s.setTransform(1,0,0,1,-e,-i),this.draw(s);var n=this._testHit(s);return s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,2,2),n},e.set=function(t){for(var e in t)this[e]=t[e];return this},e.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var t=this.cacheCanvas;if(t){var e=this._cacheScale;return this._rectangle.setValues(this._cacheOffsetX,this._cacheOffsetY,t.width/e,t.height/e)}return null},e.getTransformedBounds=function(){return this._getBounds()},e.setBounds=function(t,e,i,s){null==t&&(this._bounds=t),this._bounds=(this._bounds||new createjs.Rectangle).setValues(t,e,i,s)},e.clone=function(){return this._cloneProps(new t)},e.toString=function(){return"[DisplayObject (name="+this.name+")]"},e._cloneProps=function(t){return t.alpha=this.alpha,t.mouseEnabled=this.mouseEnabled,t.tickEnabled=this.tickEnabled,t.name=this.name,t.regX=this.regX,t.regY=this.regY,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.shadow=this.shadow,t.skewX=this.skewX,t.skewY=this.skewY,t.visible=this.visible,t.x=this.x,t.y=this.y,t.compositeOperation=this.compositeOperation,t.snapToPixel=this.snapToPixel,t.filters=null==this.filters?null:this.filters.slice(0),t.mask=this.mask,t.hitArea=this.hitArea,t.cursor=this.cursor,t._bounds=this._bounds,t},e._applyShadow=function(t,e){e=e||Shadow.identity,t.shadowColor=e.color,t.shadowOffsetX=e.offsetX,t.shadowOffsetY=e.offsetY,t.shadowBlur=e.blur},e._tick=function(t){var e=this._listeners;e&&e.tick&&(t.target=null,t.propagationStopped=t.immediatePropagationStopped=!1,this.dispatchEvent(t))},e._testHit=function(e){try{var i=e.getImageData(0,0,1,1).data[3]>1}catch(e){if(!t.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return i},e._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var t=this.filters.length,e=this.cacheCanvas.getContext("2d"),i=this.cacheCanvas.width,s=this.cacheCanvas.height,n=0;n<t;n++)this.filters[n].applyFilter(e,0,0,i,s)},e._getFilterBounds=function(t){var e,i=this.filters,s=this._rectangle.setValues(0,0,0,0);if(!i||!(e=i.length))return s;for(var n=0;n<e;n++){var r=this.filters[n];r.getBounds&&r.getBounds(s)}return s},e._getBounds=function(t,e){return this._transformBounds(this.getBounds(),t,e)},e._transformBounds=function(t,e,i){if(!t)return t;var s=t.x,n=t.y,r=t.width,a=t.height,h=this._props.matrix;h=i?h.identity():this.getMatrix(h),(s||n)&&h.appendTransform(0,0,1,1,0,0,0,-s,-n),e&&h.prependMatrix(e);var o=r*h.a,c=r*h.b,l=a*h.c,u=a*h.d,d=h.tx,p=h.ty,f=d,_=d,m=p,g=p;return(s=o+d)<f?f=s:s>_&&(_=s),(s=o+l+d)<f?f=s:s>_&&(_=s),(s=l+d)<f?f=s:s>_&&(_=s),(n=c+p)<m?m=n:n>g&&(g=n),(n=c+u+p)<m?m=n:n>g&&(g=n),(n=u+p)<m?m=n:n>g&&(g=n),t.setValues(f,m,_-f,g-m)},e._hasMouseEventListener=function(){for(var e=t._MOUSE_EVENTS,i=0,s=e.length;i<s;i++)if(this.hasEventListener(e[i]))return!0;return!!this.cursor},createjs.DisplayObject=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){this.DisplayObject_constructor(),this.children=[],this.mouseChildren=!0,this.tickChildren=!0}var e=createjs.extend(t,createjs.DisplayObject);e.getNumChildren=function(){return this.children.length};try{Object.defineProperties(e,{numChildren:{get:e.getNumChildren}})}catch(t){}e.initialize=t,e.isVisible=function(){var t=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;for(var i=this.children.slice(),s=0,n=i.length;s<n;s++){var r=i[s];r.isVisible()&&(t.save(),r.updateContext(t),r.draw(t),t.restore())}return!0},e.addChild=function(t){if(null==t)return t;var e=arguments.length;if(e>1){for(var i=0;i<e;i++)this.addChild(arguments[i]);return arguments[e-1]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),t.dispatchEvent("added"),t},e.addChildAt=function(t,e){var i=arguments.length,s=arguments[i-1];if(s<0||s>this.children.length)return arguments[i-2];if(i>2){for(var n=0;n<i-1;n++)this.addChildAt(arguments[n],s+n);return arguments[i-2]}return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t.dispatchEvent("added"),t},e.removeChild=function(t){var e=arguments.length;if(e>1){for(var i=!0,s=0;s<e;s++)i=i&&this.removeChild(arguments[s]);return i}return this.removeChildAt(createjs.indexOf(this.children,t))},e.removeChildAt=function(t){var e=arguments.length;if(e>1){for(var i=[],s=0;s<e;s++)i[s]=arguments[s];i.sort(function(t,e){return e-t});var n=!0;for(s=0;s<e;s++)n=n&&this.removeChildAt(i[s]);return n}if(t<0||t>this.children.length-1)return!1;var r=this.children[t];return r&&(r.parent=null),this.children.splice(t,1),r.dispatchEvent("removed"),!0},e.removeAllChildren=function(){for(var t=this.children;t.length;)this.removeChildAt(0)},e.getChildAt=function(t){return this.children[t]},e.getChildByName=function(t){for(var e=this.children,i=0,s=e.length;i<s;i++)if(e[i].name==t)return e[i];return null},e.sortChildren=function(t){this.children.sort(t)},e.getChildIndex=function(t){return createjs.indexOf(this.children,t)},e.swapChildrenAt=function(t,e){var i=this.children,s=i[t],n=i[e];s&&n&&(i[t]=n,i[e]=s)},e.swapChildren=function(t,e){for(var i,s,n=this.children,r=0,a=n.length;r<a&&(n[r]==t&&(i=r),n[r]==e&&(s=r),null==i||null==s);r++);r!=a&&(n[i]=e,n[s]=t)},e.setChildIndex=function(t,e){var i=this.children,s=i.length;if(!(t.parent!=this||e<0||e>=s)){for(var n=0;n<s&&i[n]!=t;n++);n!=s&&n!=e&&(i.splice(n,1),i.splice(e,0,t))}},e.contains=function(t){for(;t;){if(t==this)return!0;t=t.parent}return!1},e.hitTest=function(t,e){return null!=this.getObjectUnderPoint(t,e)},e.getObjectsUnderPoint=function(t,e,i){var s=[],n=this.localToGlobal(t,e);return this._getObjectsUnderPoint(n.x,n.y,s,i>0,1==i),s},e.getObjectUnderPoint=function(t,e,i){var s=this.localToGlobal(t,e);return this._getObjectsUnderPoint(s.x,s.y,null,i>0,1==i)},e.getBounds=function(){return this._getBounds(null,!0)},e.getTransformedBounds=function(){return this._getBounds()},e.clone=function(e){var i=this._cloneProps(new t);return e&&this._cloneChildren(i),i},e.toString=function(){return"[Container (name="+this.name+")]"},e._tick=function(t){if(this.tickChildren)for(var e=this.children.length-1;e>=0;e--){var i=this.children[e];i.tickEnabled&&i._tick&&i._tick(t)}this.DisplayObject__tick(t)},e._cloneChildren=function(t){t.children.length&&t.removeAllChildren();for(var e=t.children,i=0,s=this.children.length;i<s;i++){var n=this.children[i].clone(!0);n.parent=t,e.push(n)}},e._getObjectsUnderPoint=function(e,i,s,n,r,a){if(!(a=a||0)&&!this._testMask(this,e,i))return null;var h,o=createjs.DisplayObject._hitTestContext;r=r||n&&this._hasMouseEventListener();for(var c=this.children,l=c.length-1;l>=0;l--){var u=c[l],d=u.hitArea;if(u.visible&&(d||u.isVisible())&&(!n||u.mouseEnabled)&&(d||this._testMask(u,e,i)))if(!d&&u instanceof t){var p=u._getObjectsUnderPoint(e,i,s,n,r,a+1);if(!s&&p)return n&&!this.mouseChildren?this:p}else{if(n&&!r&&!u._hasMouseEventListener())continue;var f=u.getConcatenatedDisplayProps(u._props);if(h=f.matrix,d&&(h.appendMatrix(d.getMatrix(d._props.matrix)),f.alpha=d.alpha),o.globalAlpha=f.alpha,o.setTransform(h.a,h.b,h.c,h.d,h.tx-e,h.ty-i),(d||u).draw(o),!this._testHit(o))continue;if(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,2,2),!s)return n&&!this.mouseChildren?this:u;s.push(u)}}return null},e._testMask=function(t,e,i){var s=t.mask;if(!s||!s.graphics||s.graphics.isEmpty())return!0;var n=this._props.matrix,r=t.parent;n=r?r.getConcatenatedMatrix(n):n.identity(),n=s.getMatrix(s._props.matrix).prependMatrix(n);var a=createjs.DisplayObject._hitTestContext;return a.setTransform(n.a,n.b,n.c,n.d,n.tx-e,n.ty-i),s.graphics.drawAsPath(a),a.fillStyle="#000",a.fill(),!!this._testHit(a)&&(a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,2,2),!0)},e._getBounds=function(t,e){var i=this.DisplayObject_getBounds();if(i)return this._transformBounds(i,t,e);var s=this._props.matrix;s=e?s.identity():this.getMatrix(s),t&&s.prependMatrix(t);for(var n=this.children.length,r=null,a=0;a<n;a++){var h=this.children[a];h.visible&&(i=h._getBounds(s))&&(r?r.extend(i.x,i.y,i.width,i.height):r=i.clone())}return r},createjs.Container=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.Container_constructor(),this.autoClear=!0,this.canvas="string"==typeof t?document.getElementById(t):t,this.mouseX=0,this.mouseY=0,this.drawRect=null,this.snapToPixelEnabled=!1,this.mouseInBounds=!1,this.tickOnUpdate=!0,this.mouseMoveOutside=!1,this.preventSelection=!0,this._pointerData={},this._pointerCount=0,this._primaryPointerID=null,this._mouseOverIntervalID=null,this._nextStage=null,this._prevStage=null,this.enableDOMEvents(!0)}var e=createjs.extend(t,createjs.Container);e._get_nextStage=function(){return this._nextStage},e._set_nextStage=function(t){this._nextStage&&(this._nextStage._prevStage=null),t&&(t._prevStage=this),this._nextStage=t};try{Object.defineProperties(e,{nextStage:{get:e._get_nextStage,set:e._set_nextStage}})}catch(t){}e.update=function(t){if(this.canvas&&(this.tickOnUpdate&&this.tick(t),!1!==this.dispatchEvent("drawstart",!1,!0))){createjs.DisplayObject._snapToPixelEnabled=this.snapToPixelEnabled;var e=this.drawRect,i=this.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0),this.autoClear&&(e?i.clearRect(e.x,e.y,e.width,e.height):i.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)),i.save(),this.drawRect&&(i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()),this.updateContext(i),this.draw(i,!1),i.restore(),this.dispatchEvent("drawend")}},e.tick=function(t){if(this.tickEnabled&&!1!==this.dispatchEvent("tickstart",!1,!0)){var e=new createjs.Event("tick");if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);this._tick(e),this.dispatchEvent("tickend")}},e.handleEvent=function(t){"tick"==t.type&&this.update(t)},e.clear=function(){if(this.canvas){var t=this.canvas.getContext("2d");t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},e.toDataURL=function(t,e){var i,s=this.canvas.getContext("2d"),n=this.canvas.width,r=this.canvas.height;if(t){i=s.getImageData(0,0,n,r);var a=s.globalCompositeOperation;s.globalCompositeOperation="destination-over",s.fillStyle=t,s.fillRect(0,0,n,r)}var h=this.canvas.toDataURL(e||"image/png");return t&&(s.putImageData(i,0,0),s.globalCompositeOperation=a),h},e.enableMouseOver=function(t){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==t&&this._testMouseOver(!0)),null==t)t=20;else if(t<=0)return;var e=this;this._mouseOverIntervalID=setInterval(function(){e._testMouseOver()},1e3/Math.min(50,t))},e.enableDOMEvents=function(t){null==t&&(t=!0);var e,i,s=this._eventListeners;if(!t&&s){for(e in s)(i=s[e]).t.removeEventListener(e,i.f,!1);this._eventListeners=null}else if(t&&!s&&this.canvas){var n=window.addEventListener?window:document,r=this;for(e in(s=this._eventListeners={}).mouseup={t:n,f:function(t){r._handleMouseUp(t)}},s.mousemove={t:n,f:function(t){r._handleMouseMove(t)}},s.dblclick={t:this.canvas,f:function(t){r._handleDoubleClick(t)}},s.mousedown={t:this.canvas,f:function(t){r._handleMouseDown(t)}},s)(i=s[e]).t.addEventListener(e,i.f,!1)}},e.clone=function(){throw"Stage cannot be cloned."},e.toString=function(){return"[Stage (name="+this.name+")]"},e._getElementRect=function(t){var e;try{e=t.getBoundingClientRect()}catch(i){e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}var i=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),s=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),n=window.getComputedStyle?getComputedStyle(t,null):t.currentStyle,r=parseInt(n.paddingLeft)+parseInt(n.borderLeftWidth),a=parseInt(n.paddingTop)+parseInt(n.borderTopWidth),h=parseInt(n.paddingRight)+parseInt(n.borderRightWidth),o=parseInt(n.paddingBottom)+parseInt(n.borderBottomWidth);return{left:e.left+i+r,right:e.right+i-h,top:e.top+s+a,bottom:e.bottom+s-o}},e._getPointerData=function(t){var e=this._pointerData[t];return e||(e=this._pointerData[t]={x:0,y:0}),e},e._handleMouseMove=function(t){t||(t=window.event),this._handlePointerMove(-1,t,t.pageX,t.pageY)},e._handlePointerMove=function(t,e,i,s,n){if((!this._prevStage||void 0!==n)&&this.canvas){var r=this._nextStage,a=this._getPointerData(t),h=a.inBounds;this._updatePointerPosition(t,e,i,s),(h||a.inBounds||this.mouseMoveOutside)&&(-1===t&&a.inBounds==!h&&this._dispatchMouseEvent(this,h?"mouseleave":"mouseenter",!1,t,a,e),this._dispatchMouseEvent(this,"stagemousemove",!1,t,a,e),this._dispatchMouseEvent(a.target,"pressmove",!0,t,a,e)),r&&r._handlePointerMove(t,e,i,s,null)}},e._updatePointerPosition=function(t,e,i,s){var n=this._getElementRect(this.canvas);i-=n.left,s-=n.top;var r=this.canvas.width,a=this.canvas.height;i/=(n.right-n.left)/r,s/=(n.bottom-n.top)/a;var h=this._getPointerData(t);(h.inBounds=i>=0&&s>=0&&i<=r-1&&s<=a-1)?(h.x=i,h.y=s):this.mouseMoveOutside&&(h.x=i<0?0:i>r-1?r-1:i,h.y=s<0?0:s>a-1?a-1:s),h.posEvtObj=e,h.rawX=i,h.rawY=s,t!==this._primaryPointerID&&-1!==t||(this.mouseX=h.x,this.mouseY=h.y,this.mouseInBounds=h.inBounds)},e._handleMouseUp=function(t){this._handlePointerUp(-1,t,!1)},e._handlePointerUp=function(t,e,i,s){var n=this._nextStage,r=this._getPointerData(t);if(!this._prevStage||void 0!==s){var a=null,h=r.target;s||!h&&!n||(a=this._getObjectsUnderPoint(r.x,r.y,null,!0)),r.down&&(this._dispatchMouseEvent(this,"stagemouseup",!1,t,r,e,a),r.down=!1),a==h&&this._dispatchMouseEvent(h,"click",!0,t,r,e),this._dispatchMouseEvent(h,"pressup",!0,t,r,e),i?(t==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[t]):r.target=null,n&&n._handlePointerUp(t,e,i,s||a&&this)}},e._handleMouseDown=function(t){this._handlePointerDown(-1,t,t.pageX,t.pageY)},e._handlePointerDown=function(t,e,i,s,n){this.preventSelection&&e.preventDefault(),null!=this._primaryPointerID&&-1!==t||(this._primaryPointerID=t),null!=s&&this._updatePointerPosition(t,e,i,s);var r=null,a=this._nextStage,h=this._getPointerData(t);n||(r=h.target=this._getObjectsUnderPoint(h.x,h.y,null,!0)),h.inBounds&&(this._dispatchMouseEvent(this,"stagemousedown",!1,t,h,e,r),h.down=!0),this._dispatchMouseEvent(r,"mousedown",!0,t,h,e),a&&a._handlePointerDown(t,e,i,s,n||r&&this)},e._testMouseOver=function(t,e,i){if(!this._prevStage||void 0!==e){var s=this._nextStage;if(this._mouseOverIntervalID){var n=this._getPointerData(-1);if(n&&(t||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var r,a,h,o=n.posEvtObj,c=i||o&&o.target==this.canvas,l=null,u=-1,d="";!e&&(t||this.mouseInBounds&&c)&&(l=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var p=this._mouseOverTarget||[],f=p[p.length-1],_=this._mouseOverTarget=[];for(r=l;r;)_.unshift(r),d||(d=r.cursor),r=r.parent;for(this.canvas.style.cursor=d,!e&&i&&(i.canvas.style.cursor=d),a=0,h=_.length;a<h&&_[a]==p[a];a++)u=a;for(f!=l&&this._dispatchMouseEvent(f,"mouseout",!0,-1,n,o,l),a=p.length-1;a>u;a--)this._dispatchMouseEvent(p[a],"rollout",!1,-1,n,o,l);for(a=_.length-1;a>u;a--)this._dispatchMouseEvent(_[a],"rollover",!1,-1,n,o,f);f!=l&&this._dispatchMouseEvent(l,"mouseover",!0,-1,n,o,f),s&&s._testMouseOver(t,e||l&&this,i||c&&this)}}else s&&s._testMouseOver(t,e,i)}},e._handleDoubleClick=function(t,e){var i=null,s=this._nextStage,n=this._getPointerData(-1);e||(i=this._getObjectsUnderPoint(n.x,n.y,null,!0),this._dispatchMouseEvent(i,"dblclick",!0,-1,n,t)),s&&s._handleDoubleClick(t,e||i&&this)},e._dispatchMouseEvent=function(t,e,i,s,n,r,a){if(t&&(i||t.hasEventListener(e))){var h=new createjs.MouseEvent(e,i,!1,n.x,n.y,r,s,s===this._primaryPointerID||-1===s,n.rawX,n.rawY,a);t.dispatchEvent(h)}},createjs.Stage=createjs.promote(t,"Container")}(),this.createjs=this.createjs||{},function(){function t(t){this.DisplayObject_constructor(),"string"==typeof t?(this.image=document.createElement("img"),this.image.src=t):this.image=t,this.sourceRect=null}var e=createjs.extend(t,createjs.DisplayObject);e.initialize=t,e.isVisible=function(){var t=this.image,e=this.cacheCanvas||t&&(t.naturalWidth||t.getContext||t.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},e.draw=function(t,e){if(this.DisplayObject_draw(t,e)||!this.image)return!0;var i=this.image,s=this.sourceRect;if(s){var n=s.x,r=s.y,a=n+s.width,h=r+s.height,o=0,c=0,l=i.width,u=i.height;n<0&&(o-=n,n=0),a>l&&(a=l),r<0&&(c-=r,r=0),h>u&&(h=u),t.drawImage(i,n,r,a-n,h-r,o,c,a-n,h-r)}else t.drawImage(i,0,0);return!0},e.getBounds=function(){var t=this.DisplayObject_getBounds();if(t)return t;var e=this.image,i=this.sourceRect||e;return e&&(e.naturalWidth||e.getContext||e.readyState>=2)?this._rectangle.setValues(0,0,i.width,i.height):null},e.clone=function(){var e=new t(this.image);return this.sourceRect&&(e.sourceRect=this.sourceRect.clone()),this._cloneProps(e),e},e.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.DisplayObject_constructor(),this.currentFrame=0,this.currentAnimation=null,this.paused=!0,this.spriteSheet=t,this.currentAnimationFrame=0,this.framerate=0,this._animation=null,this._currentFrame=null,this._skipAdvance=!1,null!=e&&this.gotoAndPlay(e)}var e=createjs.extend(t,createjs.DisplayObject);e.initialize=t,e.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;this._normalizeFrame();var i=this.spriteSheet.getFrame(0|this._currentFrame);if(!i)return!1;var s=i.rect;return s.width&&s.height&&t.drawImage(i.image,s.x,s.y,s.width,s.height,-i.regX,-i.regY,s.width,s.height),!0},e.play=function(){this.paused=!1},e.stop=function(){this.paused=!0},e.gotoAndPlay=function(t){this.paused=!1,this._skipAdvance=!0,this._goto(t)},e.gotoAndStop=function(t){this.paused=!0,this._goto(t)},e.advance=function(t){var e=this.framerate||this.spriteSheet.framerate,i=e&&null!=t?t/(1e3/e):1;this._normalizeFrame(i)},e.getBounds=function(){return this.DisplayObject_getBounds()||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)},e.clone=function(){return this._cloneProps(new t(this.spriteSheet))},e.toString=function(){return"[Sprite (name="+this.name+")]"},e._cloneProps=function(t){return this.DisplayObject__cloneProps(t),t.currentFrame=this.currentFrame,t.currentAnimation=this.currentAnimation,t.paused=this.paused,t.currentAnimationFrame=this.currentAnimationFrame,t.framerate=this.framerate,t._animation=this._animation,t._currentFrame=this._currentFrame,t._skipAdvance=this._skipAdvance,t},e._tick=function(t){this.paused||(this._skipAdvance||this.advance(t&&t.delta),this._skipAdvance=!1),this.DisplayObject__tick(t)},e._normalizeFrame=function(t){t=t||0;var e,i=this._animation,s=this.paused,n=this._currentFrame;if(i){var r=i.speed||1,a=this.currentAnimationFrame;if(a+t*r>=(e=i.frames.length)){var h=i.next;if(this._dispatchAnimationEnd(i,n,s,h,e-1))return;if(h)return this._goto(h,t-(e-a)/r);this.paused=!0,a=i.frames.length-1}else a+=t*r;this.currentAnimationFrame=a,this._currentFrame=i.frames[0|a]}else if((n=this._currentFrame+=t)>=(e=this.spriteSheet.getNumFrames())&&e>0&&!this._dispatchAnimationEnd(i,n,s,e-1)&&(this._currentFrame-=e)>=e)return this._normalizeFrame();n=0|this._currentFrame,this.currentFrame!=n&&(this.currentFrame=n,this.dispatchEvent("change"))},e._dispatchAnimationEnd=function(t,e,i,s,n){var r=t?t.name:null;if(this.hasEventListener("animationend")){var a=new createjs.Event("animationend");a.name=r,a.next=s,this.dispatchEvent(a)}var h=this._animation!=t||this._currentFrame!=e;return h||i||!this.paused||(this.currentAnimationFrame=n,h=!0),h},e._goto=function(t,e){if(this.currentAnimationFrame=0,isNaN(t)){var i=this.spriteSheet.getAnimation(t);i&&(this._animation=i,this.currentAnimation=t,this._normalizeFrame(e))}else this.currentAnimation=this._animation=null,this._currentFrame=t,this._normalizeFrame()},createjs.Sprite=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.DisplayObject_constructor(),this.graphics=t||new createjs.Graphics}var e=createjs.extend(t,createjs.DisplayObject);e.isVisible=function(){var t=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.draw=function(t,e){return!!this.DisplayObject_draw(t,e)||(this.graphics.draw(t,this),!0)},e.clone=function(e){var i=e&&this.graphics?this.graphics.clone():this.graphics;return this._cloneProps(new t(i))},e.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){this.DisplayObject_constructor(),this.text=t,this.font=e,this.color=i,this.textAlign="left",this.textBaseline="top",this.maxWidth=null,this.outline=0,this.lineHeight=0,this.lineWidth=null}var e=createjs.extend(t,createjs.DisplayObject),i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");i.getContext&&(t._workingContext=i.getContext("2d"),i.width=i.height=1),t.H_OFFSETS={start:0,left:0,center:-.5,end:-1,right:-1},t.V_OFFSETS={top:0,hanging:-.01,middle:-.4,alphabetic:-.8,ideographic:-.85,bottom:-1},e.isVisible=function(){var t=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&t)},e.draw=function(t,e){if(this.DisplayObject_draw(t,e))return!0;var i=this.color||"#000";return this.outline?(t.strokeStyle=i,t.lineWidth=1*this.outline):t.fillStyle=i,this._drawText(this._prepContext(t)),!0},e.getMeasuredWidth=function(){return this._getMeasuredWidth(this.text)},e.getMeasuredLineHeight=function(){return 1.2*this._getMeasuredWidth("M")},e.getMeasuredHeight=function(){return this._drawText(null,{}).height},e.getBounds=function(){var e=this.DisplayObject_getBounds();if(e)return e;if(null==this.text||""===this.text)return null;var i=this._drawText(null,{}),s=this.maxWidth&&this.maxWidth<i.width?this.maxWidth:i.width,n=s*t.H_OFFSETS[this.textAlign||"left"],r=(this.lineHeight||this.getMeasuredLineHeight())*t.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.setValues(n,r,s,i.height)},e.getMetrics=function(){var e={lines:[]};return e.lineHeight=this.lineHeight||this.getMeasuredLineHeight(),e.vOffset=e.lineHeight*t.V_OFFSETS[this.textBaseline||"top"],this._drawText(null,e,e.lines)},e.clone=function(){return this._cloneProps(new t(this.text,this.font,this.color))},e.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},e._cloneProps=function(t){return this.DisplayObject__cloneProps(t),t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.maxWidth=this.maxWidth,t.outline=this.outline,t.lineHeight=this.lineHeight,t.lineWidth=this.lineWidth,t},e._prepContext=function(t){return t.font=this.font||"10px sans-serif",t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"top",t},e._drawText=function(e,i,s){var n=!!e;n||((e=t._workingContext).save(),this._prepContext(e));for(var r=this.lineHeight||this.getMeasuredLineHeight(),a=0,h=0,o=String(this.text).split(/(?:\r\n|\r|\n)/),c=0,l=o.length;c<l;c++){var u=o[c],d=null;if(null!=this.lineWidth&&(d=e.measureText(u).width)>this.lineWidth){var p=u.split(/(\s)/);u=p[0],d=e.measureText(u).width;for(var f=1,_=p.length;f<_;f+=2){var m=e.measureText(p[f]+p[f+1]).width;d+m>this.lineWidth?(n&&this._drawTextLine(e,u,h*r),s&&s.push(u),d>a&&(a=d),u=p[f+1],d=e.measureText(u).width,h++):(u+=p[f]+p[f+1],d+=m)}}n&&this._drawTextLine(e,u,h*r),s&&s.push(u),i&&null==d&&(d=e.measureText(u).width),d>a&&(a=d),h++}return i&&(i.width=a,i.height=h*r),n||e.restore(),i},e._drawTextLine=function(t,e,i){this.outline?t.strokeText(e,0,i,this.maxWidth||65535):t.fillText(e,0,i,this.maxWidth||65535)},e._getMeasuredWidth=function(e){var i=t._workingContext;i.save();var s=this._prepContext(i).measureText(e).width;return i.restore(),s},createjs.Text=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e){this.Container_constructor(),this.text=t||"",this.spriteSheet=e,this.lineHeight=0,this.letterSpacing=0,this.spaceWidth=0,this._oldProps={text:0,spriteSheet:0,lineHeight:0,letterSpacing:0,spaceWidth:0}}var e=createjs.extend(t,createjs.Container);t.maxPoolSize=100,t._spritePool=[],e.draw=function(t,e){this.DisplayObject_draw(t,e)||(this._updateText(),this.Container_draw(t,e))},e.getBounds=function(){return this._updateText(),this.Container_getBounds()},e.isVisible=function(){var t=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!==this.scaleX&&0!==this.scaleY&&t)},e.clone=function(){return this._cloneProps(new t(this.text,this.spriteSheet))},e.addChild=e.addChildAt=e.removeChild=e.removeChildAt=e.removeAllChildren=function(){},e._cloneProps=function(t){return this.Container__cloneProps(t),t.lineHeight=this.lineHeight,t.letterSpacing=this.letterSpacing,t.spaceWidth=this.spaceWidth,t},e._getFrameIndex=function(t,e){var i,s=e.getAnimation(t);return s||(t!=(i=t.toUpperCase())||t!=(i=t.toLowerCase())||(i=null),i&&(s=e.getAnimation(i))),s&&s.frames[0]},e._getFrame=function(t,e){var i=this._getFrameIndex(t,e);return null==i?i:e.getFrame(i)},e._getLineHeight=function(t){var e=this._getFrame("1",t)||this._getFrame("T",t)||this._getFrame("L",t)||t.getFrame(0);return e?e.rect.height:1},e._getSpaceWidth=function(t){var e=this._getFrame("1",t)||this._getFrame("l",t)||this._getFrame("e",t)||this._getFrame("a",t)||t.getFrame(0);return e?e.rect.width:1},e._updateText=function(){var e,i=0,s=0,n=this._oldProps,r=!1,a=this.spaceWidth,h=this.lineHeight,o=this.spriteSheet,c=t._spritePool,l=this.children,u=0,d=l.length;for(var p in n)n[p]!=this[p]&&(n[p]=this[p],r=!0);if(r){var f=!!this._getFrame(" ",o);f||a||(a=this._getSpaceWidth(o)),h||(h=this._getLineHeight(o));for(var _=0,m=this.text.length;_<m;_++){var g=this.text.charAt(_);if(" "!=g||f)if("\n"!=g&&"\r"!=g){var v=this._getFrameIndex(g,o);null!=v&&(u<d?e=l[u]:(l.push(e=c.length?c.pop():new createjs.Sprite),e.parent=this,d++),e.spriteSheet=o,e.gotoAndStop(v),e.x=i,e.y=s,u++,i+=e.getBounds().width+this.letterSpacing)}else"\r"==g&&"\n"==this.text.charAt(_+1)&&_++,i=0,s+=h;else i+=a}for(;d>u;)c.push(e=l.pop()),e.parent=null,d--;c.length>t.maxPoolSize&&(c.length=t.maxPoolSize)}},createjs.BitmapText=createjs.promote(t,"Container")}(),this.createjs=this.createjs||{},function(){"use strict";function t(e,i,s,n){this.Container_constructor(),!t.inited&&t.init(),this.mode=e||t.INDEPENDENT,this.startPosition=i||0,this.loop=s,this.currentFrame=0,this.timeline=new createjs.Timeline(null,n,{paused:!0,position:i,useTicks:!0}),this.paused=!1,this.actionsEnabled=!0,this.autoReset=!0,this.frameBounds=this.frameBounds||null,this.framerate=null,this._synchOffset=0,this._prevPos=-1,this._prevPosition=0,this._t=0,this._managed={}}var e=createjs.extend(t,createjs.Container);t.INDEPENDENT="independent",t.SINGLE_FRAME="single",t.SYNCHED="synched",t.inited=!1,t.init=function(){t.inited||(i.install(),t.inited=!0)},e.getLabels=function(){return this.timeline.getLabels()},e.getCurrentLabel=function(){return this._updateTimeline(),this.timeline.getCurrentLabel()},e.getDuration=function(){return this.timeline.duration};try{Object.defineProperties(e,{labels:{get:e.getLabels},currentLabel:{get:e.getCurrentLabel},totalFrames:{get:e.getDuration},duration:{get:e.getDuration}})}catch(t){}function i(){throw"MovieClipPlugin cannot be instantiated."}e.initialize=t,e.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},e.draw=function(t,e){return!!this.DisplayObject_draw(t,e)||(this._updateTimeline(),this.Container_draw(t,e),!0)},e.play=function(){this.paused=!1},e.stop=function(){this.paused=!0},e.gotoAndPlay=function(t){this.paused=!1,this._goto(t)},e.gotoAndStop=function(t){this.paused=!0,this._goto(t)},e.advance=function(e){var i=t.INDEPENDENT;if(this.mode==i){for(var s=this,n=s.framerate;(s=s.parent)&&null==n;)s.mode==i&&(n=s._framerate);this._framerate=n;var r=null!=n&&-1!=n&&null!=e?e/(1e3/n)+this._t:1,a=0|r;for(this._t=r-a;!this.paused&&a--;)this._prevPosition=this._prevPos<0?0:this._prevPosition+1,this._updateTimeline()}},e.clone=function(){throw"MovieClip cannot be cloned."},e.toString=function(){return"[MovieClip (name="+this.name+")]"},e._tick=function(t){this.advance(t&&t.delta),this.Container__tick(t)},e._goto=function(t){var e=this.timeline.resolve(t);null!=e&&(-1==this._prevPos&&(this._prevPos=NaN),this._prevPosition=e,this._t=0,this._updateTimeline())},e._reset=function(){this._prevPos=-1,this._t=this.currentFrame=0,this.paused=!1},e._updateTimeline=function(){var e=this.timeline,i=this.mode!=t.INDEPENDENT;e.loop=null==this.loop||this.loop;var s=i?this.startPosition+(this.mode==t.SINGLE_FRAME?0:this._synchOffset):this._prevPos<0?0:this._prevPosition,n=i||!this.actionsEnabled?createjs.Tween.NONE:null;if(this.currentFrame=e._calcPosition(s),e.setPosition(s,n),this._prevPosition=e._prevPosition,this._prevPos!=e._prevPos){for(var r in this.currentFrame=this._prevPos=e._prevPos,this._managed)this._managed[r]=1;for(var a=e._tweens,h=0,o=a.length;h<o;h++){var c=a[h],l=c._target;if(l!=this&&!c.passive){var u=c._stepPosition;l instanceof createjs.DisplayObject?this._addManagedChild(l,u):this._setState(l.state,u)}}var d=this.children;for(h=d.length-1;h>=0;h--){var p=d[h].id;1==this._managed[p]&&(this.removeChildAt(h),delete this._managed[p])}}},e._setState=function(t,e){if(t)for(var i=t.length-1;i>=0;i--){var s=t[i],n=s.t,r=s.p;for(var a in r)n[a]=r[a];this._addManagedChild(n,e)}},e._addManagedChild=function(e,i){e._off||(this.addChildAt(e,0),e instanceof t&&(e._synchOffset=i,e.mode==t.INDEPENDENT&&e.autoReset&&!this._managed[e.id]&&e._reset()),this._managed[e.id]=2)},e._getBounds=function(t,e){var i=this.DisplayObject_getBounds();return i||(this._updateTimeline(),this.frameBounds&&(i=this._rectangle.copy(this.frameBounds[this.currentFrame]))),i?this._transformBounds(i,t,e):this.Container__getBounds(t,e)},createjs.MovieClip=createjs.promote(t,"Container"),i.priority=100,i.install=function(){createjs.Tween.installPlugin(i,["startPosition"])},i.init=function(t,e,i){return i},i.step=function(){},i.tween=function(e,i,s,n,r,a,h,o){return e.target instanceof t?1==a?r[i]:n[i]:s}}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"SpriteSheetUtils cannot be instantiated"}var e=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");e.getContext&&(t._workingCanvas=e,t._workingContext=e.getContext("2d"),e.width=e.height=1),t.addFlippedFrames=function(e,i,s,n){if(i||s||n){var r=0;i&&t._flip(e,++r,!0,!1),s&&t._flip(e,++r,!1,!0),n&&t._flip(e,++r,!0,!0)}},t.extractFrame=function(e,i){isNaN(i)&&(i=e.getAnimation(i).frames[0]);var s=e.getFrame(i);if(!s)return null;var n=s.rect,r=t._workingCanvas;r.width=n.width,r.height=n.height,t._workingContext.drawImage(s.image,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var a=document.createElement("img");return a.src=r.toDataURL("image/png"),a},t.mergeAlpha=function(t,e,i){i||(i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),i.width=Math.max(e.width,t.width),i.height=Math.max(e.height,t.height);var s=i.getContext("2d");return s.save(),s.drawImage(t,0,0),s.globalCompositeOperation="destination-in",s.drawImage(e,0,0),s.restore(),i},t._flip=function(e,i,s,n){for(var r=e._images,a=t._workingCanvas,h=t._workingContext,o=r.length/i,c=0;c<o;c++){var l=r[c];l.__tmp=c,h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,a.width+1,a.height+1),a.width=l.width,a.height=l.height,h.setTransform(s?-1:1,0,0,n?-1:1,s?l.width:0,n?l.height:0),h.drawImage(l,0,0);var u=document.createElement("img");u.src=a.toDataURL("image/png"),u.width=l.width,u.height=l.height,r.push(u)}var d=e._frames,p=d.length/i;for(c=0;c<p;c++){var f=(l=d[c]).rect.clone(),_={image:u=r[l.image.__tmp+o*i],rect:f,regX:l.regX,regY:l.regY};s&&(f.x=u.width-f.x-f.width,_.regX=f.width-l.regX),n&&(f.y=u.height-f.y-f.height,_.regY=f.height-l.regY),d.push(_)}var m="_"+(s?"h":"")+(n?"v":""),g=e._animations,v=e._data,w=g.length/i;for(c=0;c<w;c++){var x=g[c],y={name:x+m,speed:(l=v[x]).speed,next:l.next,frames:[]};l.next&&(y.next+=m);for(var b=0,E=(d=l.frames).length;b<E;b++)y.frames.push(d[b]+p*i);v[y.name]=y,g.push(y.name)}},createjs.SpriteSheetUtils=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.EventDispatcher_constructor(),this.maxWidth=2048,this.maxHeight=2048,this.spriteSheet=null,this.scale=1,this.padding=1,this.timeSlice=.3,this.progress=-1,this.framerate=t||0,this._frames=[],this._animations={},this._data=null,this._nextFrameIndex=0,this._index=0,this._timerID=null,this._scale=1}var e=createjs.extend(t,createjs.EventDispatcher);t.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",t.ERR_RUNNING="a build is already running",e.addFrame=function(e,i,s,n,r){if(this._data)throw t.ERR_RUNNING;var a=i||e.bounds||e.nominalBounds;return!a&&e.getBounds&&(a=e.getBounds()),a?(s=s||1,this._frames.push({source:e,sourceRect:a,scale:s,funct:n,data:r,index:this._frames.length,height:a.height*s})-1):null},e.addAnimation=function(e,i,s,n){if(this._data)throw t.ERR_RUNNING;this._animations[e]={frames:i,next:s,speed:n}},e.addMovieClip=function(e,i,s,n,r,a){if(this._data)throw t.ERR_RUNNING;var h=e.frameBounds,o=i||e.bounds||e.nominalBounds;if(!o&&e.getBounds&&(o=e.getBounds()),o||h){var c,l,u=this._frames.length,d=e.timeline.duration;for(c=0;c<d;c++){var p=h&&h[c]?h[c]:o;this.addFrame(e,p,s,this._setupMovieClipFrame,{i:c,f:n,d:r})}var f=e.timeline._labels,_=[];for(var m in f)_.push({index:f[m],label:m});if(_.length)for(_.sort(function(t,e){return t.index-e.index}),c=0,l=_.length;c<l;c++){for(var g=_[c].label,v=u+_[c].index,w=u+(c==l-1?d:_[c+1].index),x=[],y=v;y<w;y++)x.push(y);a&&!(g=a(g,e,v,w))||this.addAnimation(g,x,!0)}}},e.build=function(){if(this._data)throw t.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},e.buildAsync=function(e){if(this._data)throw t.ERR_RUNNING;this.timeSlice=e,this._startBuild();var i=this;this._timerID=setTimeout(function(){i._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},e.stopAsync=function(){clearTimeout(this._timerID),this._data=null},e.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},e.toString=function(){return"[SpriteSheetBuilder]"},e._startBuild=function(){var e=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var i=[];this._data={images:[],frames:i,framerate:this.framerate,animations:this._animations};var s=this._frames.slice();if(s.sort(function(t,e){return t.height<=e.height?-1:1}),s[s.length-1].height+2*e>this.maxHeight)throw t.ERR_DIMENSIONS;for(var n=0,r=0,a=0;s.length;){var h=this._fillRow(s,n,a,i,e);if(h.w>r&&(r=h.w),n+=h.h,!h.h||!s.length){var o=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");o.width=this._getSize(r,this.maxWidth),o.height=this._getSize(n,this.maxHeight),this._data.images[a]=o,h.h||(r=n=0,a++)}}},e._setupMovieClipFrame=function(t,e){var i=t.actionsEnabled;t.actionsEnabled=!1,t.gotoAndStop(e.i),t.actionsEnabled=i,e.f&&e.f(t,e.d,e.i)},e._getSize=function(t,e){for(var i=4;Math.pow(2,++i)<t;);return Math.min(e,Math.pow(2,i))},e._fillRow=function(e,i,s,n,r){for(var a=this.maxWidth,h=this.maxHeight-(i+=r),o=r,c=0,l=e.length-1;l>=0;l--){var u=e[l],d=this._scale*u.scale,p=u.sourceRect,f=u.source,_=Math.floor(d*p.x-r),m=Math.floor(d*p.y-r),g=Math.ceil(d*p.height+2*r),v=Math.ceil(d*p.width+2*r);if(v>a)throw t.ERR_DIMENSIONS;g>h||o+v>a||(u.img=s,u.rect=new createjs.Rectangle(o,i,v,g),c=c||g,e.splice(l,1),n[u.index]=[o,i,v,g,s,Math.round(-_+d*f.regX-r),Math.round(-m+d*f.regY-r)],o+=v)}return{w:o,h:c}},e._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")},e._run=function(){for(var t=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),e=(new Date).getTime()+t,i=!1;e>(new Date).getTime();)if(!this._drawNext()){i=!0;break}if(i)this._endBuild();else{var s=this;this._timerID=setTimeout(function(){s._run()},50-t)}var n=this.progress=this._index/this._frames.length;if(this.hasEventListener("progress")){var r=new createjs.Event("progress");r.progress=n,this.dispatchEvent(r)}},e._drawNext=function(){var t=this._frames[this._index],e=t.scale*this._scale,i=t.rect,s=t.sourceRect,n=this._data.images[t.img].getContext("2d");return t.funct&&t.funct(t.source,t.data),n.save(),n.beginPath(),n.rect(i.x,i.y,i.width,i.height),n.clip(),n.translate(Math.ceil(i.x-s.x*e),Math.ceil(i.y-s.y*e)),n.scale(e,e),t.source.draw(n),n.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=createjs.promote(t,"EventDispatcher")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.DisplayObject_constructor(),"string"==typeof t&&(t=document.getElementById(t)),this.mouseEnabled=!1;var e=t.style;e.position="absolute",e.transformOrigin=e.WebkitTransformOrigin=e.msTransformOrigin=e.MozTransformOrigin=e.OTransformOrigin="0% 0%",this.htmlElement=t,this._oldProps=null}var e=createjs.extend(t,createjs.DisplayObject);e.isVisible=function(){return null!=this.htmlElement},e.draw=function(t,e){return!0},e.cache=function(){},e.uncache=function(){},e.updateCache=function(){},e.hitTest=function(){},e.localToGlobal=function(){},e.globalToLocal=function(){},e.localToLocal=function(){},e.clone=function(){throw"DOMElement cannot be cloned."},e.toString=function(){return"[DOMElement (name="+this.name+")]"},e._tick=function(t){var e=this.getStage();e&&e.on("drawend",this._handleDrawEnd,this,!0),this.DisplayObject__tick(t)},e._handleDrawEnd=function(t){var e=this.htmlElement;if(e){var i=e.style,s=this.getConcatenatedDisplayProps(this._props),n=s.matrix,r=s.visible?"visible":"hidden";if(r!=i.visibility&&(i.visibility=r),s.visible){var a=this._oldProps,h=a&&a.matrix,o=1e4;if(!h||!h.equals(n)){var c="matrix("+(n.a*o|0)/o+","+(n.b*o|0)/o+","+(n.c*o|0)/o+","+(n.d*o|0)/o+","+(n.tx+.5|0);i.transform=i.WebkitTransform=i.OTransform=i.msTransform=c+","+(n.ty+.5|0)+")",i.MozTransform=c+"px,"+(n.ty+.5|0)+"px)",a||(a=this._oldProps=new createjs.DisplayProps(!0,NaN)),a.matrix.copy(n)}a.alpha!=s.alpha&&(i.opacity=""+(s.alpha*o|0)/o,a.alpha=s.alpha)}}},createjs.DOMElement=createjs.promote(t,"DisplayObject")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){}var e=t.prototype;e.getBounds=function(t){return t},e.applyFilter=function(t,e,i,s,n,r,a,h){r=r||t,null==a&&(a=e),null==h&&(h=i);try{var o=t.getImageData(e,i,s,n)}catch(t){return!1}return!!this._applyFilter(o)&&(r.putImageData(o,a,h),!0)},e.toString=function(){return"[Filter]"},e.clone=function(){return new t},e._applyFilter=function(t){return!0},createjs.Filter=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i){(isNaN(t)||t<0)&&(t=0),(isNaN(e)||e<0)&&(e=0),(isNaN(i)||i<1)&&(i=1),this.blurX=0|t,this.blurY=0|e,this.quality=0|i}var e=createjs.extend(t,createjs.Filter);t.MUL_TABLE=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],t.SHG_TABLE=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],e.getBounds=function(t){var e=0|this.blurX,i=0|this.blurY;if(e<=0&&i<=0)return t;var s=Math.pow(this.quality,.2);return(t||new createjs.Rectangle).pad(e*s+1,i*s+1,e*s+1,i*s+1)},e.clone=function(){return new t(this.blurX,this.blurY,this.quality)},e.toString=function(){return"[BlurFilter]"},e._applyFilter=function(e){var i=this.blurX>>1;if(isNaN(i)||i<0)return!1;var s=this.blurY>>1;if(isNaN(s)||s<0)return!1;if(0==i&&0==s)return!1;var n=this.quality;(isNaN(n)||n<1)&&(n=1),(n|=0)>3&&(n=3),n<1&&(n=1);var r=e.data,a=0,h=0,o=0,c=0,l=0,u=0,d=0,p=0,f=0,_=0,m=0,g=0,v=0,w=0,x=0,y=i+i+1|0,b=s+s+1|0,E=0|e.width,S=0|e.height,j=E-1|0,T=S-1|0,M=i+1|0,D=s+1|0,C={r:0,b:0,g:0,a:0},P=C;for(o=1;o<y;o++)P=P.n={r:0,b:0,g:0,a:0};P.n=C;var O={r:0,b:0,g:0,a:0},k=O;for(o=1;o<b;o++)k=k.n={r:0,b:0,g:0,a:0};k.n=O;for(var I=null,L=0|t.MUL_TABLE[i],F=0|t.SHG_TABLE[i],A=0|t.MUL_TABLE[s],R=0|t.SHG_TABLE[s];n-- >0;){d=u=0;var N=L,B=F;for(h=S;--h>-1;){for(p=M*(g=r[0|u]),f=M*(v=r[u+1|0]),_=M*(w=r[u+2|0]),m=M*(x=r[u+3|0]),P=C,o=M;--o>-1;)P.r=g,P.g=v,P.b=w,P.a=x,P=P.n;for(o=1;o<M;o++)c=u+((j<o?j:o)<<2)|0,p+=P.r=r[c],f+=P.g=r[c+1],_+=P.b=r[c+2],m+=P.a=r[c+3],P=P.n;for(I=C,a=0;a<E;a++)r[u++]=p*N>>>B,r[u++]=f*N>>>B,r[u++]=_*N>>>B,r[u++]=m*N>>>B,c=d+((c=a+i+1)<j?c:j)<<2,p-=I.r-(I.r=r[c]),f-=I.g-(I.g=r[c+1]),_-=I.b-(I.b=r[c+2]),m-=I.a-(I.a=r[c+3]),I=I.n;d+=E}for(N=A,B=R,a=0;a<E;a++){for(p=D*(g=r[u=a<<2|0])|0,f=D*(v=r[u+1|0])|0,_=D*(w=r[u+2|0])|0,m=D*(x=r[u+3|0])|0,k=O,o=0;o<D;o++)k.r=g,k.g=v,k.b=w,k.a=x,k=k.n;for(l=E,o=1;o<=s;o++)u=l+a<<2,p+=k.r=r[u],f+=k.g=r[u+1],_+=k.b=r[u+2],m+=k.a=r[u+3],k=k.n,o<T&&(l+=E);if(u=a,I=O,n>0)for(h=0;h<S;h++)r[(c=u<<2)+3]=x=m*N>>>B,x>0?(r[c]=p*N>>>B,r[c+1]=f*N>>>B,r[c+2]=_*N>>>B):r[c]=r[c+1]=r[c+2]=0,c=a+((c=h+D)<T?c:T)*E<<2,p-=I.r-(I.r=r[c]),f-=I.g-(I.g=r[c+1]),_-=I.b-(I.b=r[c+2]),m-=I.a-(I.a=r[c+3]),I=I.n,u+=E;else for(h=0;h<S;h++)r[(c=u<<2)+3]=x=m*N>>>B,x>0?(x=255/x,r[c]=(p*N>>>B)*x,r[c+1]=(f*N>>>B)*x,r[c+2]=(_*N>>>B)*x):r[c]=r[c+1]=r[c+2]=0,c=a+((c=h+D)<T?c:T)*E<<2,p-=I.r-(I.r=r[c]),f-=I.g-(I.g=r[c+1]),_-=I.b-(I.b=r[c+2]),m-=I.a-(I.a=r[c+3]),I=I.n,u+=E}}return!0},createjs.BlurFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.alphaMap=t,this._alphaMap=null,this._mapData=null}var e=createjs.extend(t,createjs.Filter);e.clone=function(){var e=new t(this.alphaMap);return e._alphaMap=this._alphaMap,e._mapData=this._mapData,e},e.toString=function(){return"[AlphaMapFilter]"},e._applyFilter=function(t){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;for(var e=t.data,i=this._mapData,s=0,n=e.length;s<n;s+=4)e[s+3]=i[s]||0;return!0},e._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var t,e=this._alphaMap=this.alphaMap,i=e;e instanceof HTMLCanvasElement?t=i.getContext("2d"):((i=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")).width=e.width,i.height=e.height,(t=i.getContext("2d")).drawImage(e,0,0));try{var s=t.getImageData(0,0,e.width,e.height)}catch(t){return!1}return this._mapData=s.data,!0},createjs.AlphaMapFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.mask=t}var e=createjs.extend(t,createjs.Filter);e.applyFilter=function(t,e,i,s,n,r,a,h){return!this.mask||(null==a&&(a=e),null==h&&(h=i),(r=r||t).save(),t==r&&(r.globalCompositeOperation="destination-in",r.drawImage(this.mask,a,h),r.restore(),!0))},e.clone=function(){return new t(this.mask)},e.toString=function(){return"[AlphaMaskFilter]"},createjs.AlphaMaskFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s,n,r,a,h){this.redMultiplier=null!=t?t:1,this.greenMultiplier=null!=e?e:1,this.blueMultiplier=null!=i?i:1,this.alphaMultiplier=null!=s?s:1,this.redOffset=n||0,this.greenOffset=r||0,this.blueOffset=a||0,this.alphaOffset=h||0}var e=createjs.extend(t,createjs.Filter);e.toString=function(){return"[ColorFilter]"},e.clone=function(){return new t(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},e._applyFilter=function(t){for(var e=t.data,i=e.length,s=0;s<i;s+=4)e[s]=e[s]*this.redMultiplier+this.redOffset,e[s+1]=e[s+1]*this.greenMultiplier+this.greenOffset,e[s+2]=e[s+2]*this.blueMultiplier+this.blueOffset,e[s+3]=e[s+3]*this.alphaMultiplier+this.alphaOffset;return!0},createjs.ColorFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function t(t,e,i,s){this.setColor(t,e,i,s)}var e=t.prototype;t.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],t.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],t.LENGTH=t.IDENTITY_MATRIX.length,e.setColor=function(t,e,i,s){return this.reset().adjustColor(t,e,i,s)},e.reset=function(){return this.copy(t.IDENTITY_MATRIX)},e.adjustColor=function(t,e,i,s){return this.adjustHue(s),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i)},e.adjustBrightness=function(t){return 0==t||isNaN(t)?this:(t=this._cleanValue(t,255),this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1]),this)},e.adjustContrast=function(e){return 0==e||isNaN(e)?this:(i=(e=this._cleanValue(e,100))<0?127+e/100*127:127*(i=0==(i=e%1)?t.DELTA_INDEX[e]:t.DELTA_INDEX[e<<0]*(1-i)+t.DELTA_INDEX[1+(e<<0)]*i)+127,this._multiplyMatrix([i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1]),this);var i},e.adjustSaturation=function(t){if(0==t||isNaN(t))return this;var e=1+((t=this._cleanValue(t,100))>0?3*t/100:t/100);return this._multiplyMatrix([.3086*(1-e)+e,.6094*(1-e),.082*(1-e),0,0,.3086*(1-e),.6094*(1-e)+e,.082*(1-e),0,0,.3086*(1-e),.6094*(1-e),.082*(1-e)+e,0,0,0,0,0,1,0,0,0,0,0,1]),this},e.adjustHue=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,180)/180*Math.PI;var e=Math.cos(t),i=Math.sin(t);return this._multiplyMatrix([.213+.787*e+-.213*i,.715+-.715*e+-.715*i,.072+-.072*e+.928*i,0,0,.213+-.213*e+.143*i,.715+e*(1-.715)+.14*i,.072+-.072*e+-.283*i,0,0,.213+-.213*e+-.787*i,.715+-.715*e+.715*i,.072+.928*e+.072*i,0,0,0,0,0,1,0,0,0,0,0,1]),this},e.concat=function(e){return(e=this._fixMatrix(e)).length!=t.LENGTH?this:(this._multiplyMatrix(e),this)},e.clone=function(){return(new t).copy(this)},e.toArray=function(){for(var e=[],i=0,s=t.LENGTH;i<s;i++)e[i]=this[i];return e},e.copy=function(e){for(var i=t.LENGTH,s=0;s<i;s++)this[s]=e[s];return this},e.toString=function(){return"[ColorMatrix]"},e._multiplyMatrix=function(t){var e,i,s,n=[];for(e=0;e<5;e++){for(i=0;i<5;i++)n[i]=this[i+5*e];for(i=0;i<5;i++){var r=0;for(s=0;s<5;s++)r+=t[i+5*s]*n[s];this[i+5*e]=r}}},e._cleanValue=function(t,e){return Math.min(e,Math.max(-e,t))},e._fixMatrix=function(e){return e instanceof t&&(e=e.toArray()),e.length<t.LENGTH?e=e.slice(0,e.length).concat(t.IDENTITY_MATRIX.slice(e.length,t.LENGTH)):e.length>t.LENGTH&&(e=e.slice(0,t.LENGTH)),e},createjs.ColorMatrix=t}(),this.createjs=this.createjs||{},function(){"use strict";function t(t){this.matrix=t}var e=createjs.extend(t,createjs.Filter);e.toString=function(){return"[ColorMatrixFilter]"},e.clone=function(){return new t(this.matrix)},e._applyFilter=function(t){for(var e,i,s,n,r=t.data,a=r.length,h=this.matrix,o=h[0],c=h[1],l=h[2],u=h[3],d=h[4],p=h[5],f=h[6],_=h[7],m=h[8],g=h[9],v=h[10],w=h[11],x=h[12],y=h[13],b=h[14],E=h[15],S=h[16],j=h[17],T=h[18],M=h[19],D=0;D<a;D+=4)e=r[D],i=r[D+1],s=r[D+2],n=r[D+3],r[D]=e*o+i*c+s*l+n*u+d,r[D+1]=e*p+i*f+s*_+n*m+g,r[D+2]=e*v+i*w+s*x+n*y+b,r[D+3]=e*E+i*S+s*j+n*T+M;return!0},createjs.ColorMatrixFilter=createjs.promote(t,"Filter")}(),this.createjs=this.createjs||{},function(){"use strict";function t(){throw"Touch cannot be instantiated"}t.isSupported=function(){return!!("ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0)},t.enable=function(e,i,s){return!!(e&&e.canvas&&t.isSupported())&&(!!e.__touch||(e.__touch={pointers:{},multitouch:!i,preventDefault:!s,count:0},"ontouchstart"in window?t._IOS_enable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_enable(e),!0))},t.disable=function(e){e&&("ontouchstart"in window?t._IOS_disable(e):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&t._IE_disable(e),delete e.__touch)},t._IOS_enable=function(e){var i=e.canvas,s=e.__touch.f=function(i){t._IOS_handleEvent(e,i)};i.addEventListener("touchstart",s,!1),i.addEventListener("touchmove",s,!1),i.addEventListener("touchend",s,!1),i.addEventListener("touchcancel",s,!1)},t._IOS_disable=function(t){var e=t.canvas;if(e){var i=t.__touch.f;e.removeEventListener("touchstart",i,!1),e.removeEventListener("touchmove",i,!1),e.removeEventListener("touchend",i,!1),e.removeEventListener("touchcancel",i,!1)}},t._IOS_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();for(var i=e.changedTouches,s=e.type,n=0,r=i.length;n<r;n++){var a=i[n],h=a.identifier;a.target==t.canvas&&("touchstart"==s?this._handleStart(t,h,e,a.pageX,a.pageY):"touchmove"==s?this._handleMove(t,h,e,a.pageX,a.pageY):"touchend"!=s&&"touchcancel"!=s||this._handleEnd(t,h,e))}}},t._IE_enable=function(e){var i=e.canvas,s=e.__touch.f=function(i){t._IE_handleEvent(e,i)};void 0===window.navigator.pointerEnabled?(i.addEventListener("MSPointerDown",s,!1),window.addEventListener("MSPointerMove",s,!1),window.addEventListener("MSPointerUp",s,!1),window.addEventListener("MSPointerCancel",s,!1),e.__touch.preventDefault&&(i.style.msTouchAction="none")):(i.addEventListener("pointerdown",s,!1),window.addEventListener("pointermove",s,!1),window.addEventListener("pointerup",s,!1),window.addEventListener("pointercancel",s,!1),e.__touch.preventDefault&&(i.style.touchAction="none")),e.__touch.activeIDs={}},t._IE_disable=function(t){var e=t.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",e,!1),window.removeEventListener("MSPointerUp",e,!1),window.removeEventListener("MSPointerCancel",e,!1),t.canvas&&t.canvas.removeEventListener("MSPointerDown",e,!1)):(window.removeEventListener("pointermove",e,!1),window.removeEventListener("pointerup",e,!1),window.removeEventListener("pointercancel",e,!1),t.canvas&&t.canvas.removeEventListener("pointerdown",e,!1))},t._IE_handleEvent=function(t,e){if(t){t.__touch.preventDefault&&e.preventDefault&&e.preventDefault();var i=e.type,s=e.pointerId,n=t.__touch.activeIDs;if("MSPointerDown"==i||"pointerdown"==i){if(e.srcElement!=t.canvas)return;n[s]=!0,this._handleStart(t,s,e,e.pageX,e.pageY)}else n[s]&&("MSPointerMove"==i||"pointermove"==i?this._handleMove(t,s,e,e.pageX,e.pageY):"MSPointerUp"!=i&&"MSPointerCancel"!=i&&"pointerup"!=i&&"pointercancel"!=i||(delete n[s],this._handleEnd(t,s,e)))}},t._handleStart=function(t,e,i,s,n){var r=t.__touch;if(r.multitouch||!r.count){var a=r.pointers;a[e]||(a[e]=!0,r.count++,t._handlePointerDown(e,i,s,n))}},t._handleMove=function(t,e,i,s,n){t.__touch.pointers[e]&&t._handlePointerMove(e,i,s,n)},t._handleEnd=function(t,e,i){var s=t.__touch,n=s.pointers;n[e]&&(s.count--,t._handlePointerUp(e,i,!0),delete n[e])},createjs.Touch=t}(),this.createjs=this.createjs||{},function(){"use strict";var t=createjs.EaselJS=createjs.EaselJS||{};t.version="0.8.2",t.buildDate="Thu, 26 Nov 2015 20:44:34 GMT"}();
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.Promise=t()}}(function(){return function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof _dereq_&&_dereq_;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return i(n||t)},u,u.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";e.exports=function(t){function e(t){var e=new n(t),r=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),r}var n=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},{}],2:[function(t,e,n){"use strict";function r(){this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=c}function i(t,e,n){this._lateQueue.push(t,e,n),this._queueTick()}function o(t,e,n){this._normalQueue.push(t,e,n),this._queueTick()}function s(t){this._normalQueue._pushOne(t),this._queueTick()}var a;try{throw new Error}catch(t){a=t}var c=t("./schedule"),l=t("./queue"),u=t("./util");r.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},r.prototype.disableTrampolineIfNecessary=function(){u.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},r.prototype.fatalError=function(t,e){e?(process.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),process.exit(2)):this.throwLater(t)},r.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},u.hasDevTools?(r.prototype.invokeLater=function(t,e,n){this._trampolineEnabled?i.call(this,t,e,n):this._schedule(function(){setTimeout(function(){t.call(e,n)},100)})},r.prototype.invoke=function(t,e,n){this._trampolineEnabled?o.call(this,t,e,n):this._schedule(function(){t.call(e,n)})},r.prototype.settlePromises=function(t){this._trampolineEnabled?s.call(this,t):this._schedule(function(){t._settlePromises()})}):(r.prototype.invokeLater=i,r.prototype.invoke=o,r.prototype.settlePromises=s),r.prototype.invokeFirst=function(t,e,n){this._normalQueue.unshift(t,e,n),this._queueTick()},r.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var n=t.shift(),r=t.shift();e.call(n,r)}else e._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},e.exports=r,e.exports.firstLineError=a},{"./queue":26,"./schedule":29,"./util":36}],3:[function(t,e,n){"use strict";e.exports=function(t,e,n,r){var i=!1,o=function(t,e){this._reject(e)},s=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(o,o,null,this,t)},a=function(t,e){0==(50397184&this._bitField)&&this._resolveCallback(e.target)},c=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(o){i||(i=!0,t.prototype._propagateFrom=r.propagateFromFunction(),t.prototype._boundValue=r.boundValueFunction());var l=n(o),u=new t(e);u._propagateFrom(this,1);var p=this._target();if(u._setBoundTo(l),l instanceof t){var h={promiseRejectionQueued:!1,promise:u,target:p,bindingPromise:l};p._then(e,s,void 0,u,h),l._then(a,c,void 0,u,h),u._setOnCancel(l)}else u._resolveCallback(p);return u},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=-2097153&this._bitField},t.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},t.bind=function(e,n){return t.resolve(n).bind(e)}}},{}],4:[function(t,e,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=t("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(t){}return i},e.exports=i},{"./promise":22}],5:[function(t,e,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}e.exports=function(e){function n(t,n){var r;if(null!=t&&(r=t[n]),"function"!=typeof r){var i="Object "+s.classString(t)+" has no method '"+s.toString(n)+"'";throw new e.TypeError(i)}return r}function r(t){return n(t,this.pop()).apply(t,this)}function i(t){return t[this]}function o(t){var e=+this;return 0>e&&(e=Math.max(0,e+t.length)),t[e]}var s=t("./util"),a=s.canEvaluate;s.isIdentifier,e.prototype.call=function(t){var e=[].slice.call(arguments,1);return e.push(t),this._then(r,void 0,void 0,e,void 0)},e.prototype.get=function(t){var e;if("number"==typeof t)e=o;else if(a){var n=(void 0)(t);e=null!==n?n:i}else e=i;return this._then(e,void 0,void 0,t,void 0)}}},{"./util":36}],6:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util"),s=o.tryCatch,a=o.errorObj,c=e._async;e.prototype.break=e.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t.isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var n=t._cancellationParent;if(null==n||!n.isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),e=t,t=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(t,e){if(o.isArray(t))for(var n=0;n<t.length;++n)this._doInvokeOnCancel(t[n],e);else if(void 0!==t)if("function"==typeof t){if(!e){var r=s(t).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),c.throwLater(r.e))}}else t._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,t)},e.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(t,e,n){"use strict";e.exports=function(e){var n=t("./util"),r=t("./es5").keys,i=n.tryCatch,o=n.errorObj;return function(t,s,a){return function(c){var l=a._boundValue();t:for(var u=0;u<t.length;++u){var p=t[u];if(p===Error||null!=p&&p.prototype instanceof Error){if(c instanceof p)return i(s).call(l,c)}else if("function"==typeof p){var h=i(p).call(l,c);if(h===o)return h;if(h)return i(s).call(l,c)}else if(n.isObject(c)){for(var f=r(p),_=0;_<f.length;++_){var d=f[_];if(p[d]!=c[d])continue t}return i(s).call(l,c)}}return e}}}},{"./es5":13,"./util":36}],8:[function(t,e,n){"use strict";e.exports=function(t){function e(){this._trace=new e.CapturedTrace(n())}function n(){var t=i.length-1;return t>=0?i[t]:void 0}var r=!1,i=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=i.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=function(){return r?new e:void 0},e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var i=t.prototype._pushContext,o=t.prototype._popContext,s=t._peekContext,a=t.prototype._peekContext,c=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=i,t.prototype._popContext=o,t._peekContext=s,t.prototype._peekContext=a,t.prototype._promiseCreated=c,r=!1},r=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=n,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},{}],9:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t,e){return{promise:e}}function i(){return!1}function o(t,e,n){var r=this;try{t(e,n,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+R.toString(t));r._attachCancellationCallback(t)})}catch(t){return t}}function s(t){if(!this.isCancellable())return this;var e=this._onCancel();void 0!==e?R.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function a(){return this._onCancelField}function c(t){this._onCancelField=t}function l(){this._cancellationParent=void 0,this._onCancelField=void 0}function u(t,e){if(0!=(1&e)){this._cancellationParent=t;var n=t._branchesRemainingToCancel;void 0===n&&(n=0),t._branchesRemainingToCancel=n+1}0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function p(){var t=this._boundTo;return void 0!==t&&t instanceof e?t.isFulfilled()?t.value():void 0:t}function h(){this._trace=new C(this._peekContext())}function f(t,e){if(P(t)){var n=this._trace;if(void 0!==n&&e&&(n=n._parent),void 0!==n)n.attachExtraTrace(t);else if(!t.__stackCleaned__){var r=v(t);R.notEnumerableProp(t,"stack",r.message+"\n"+r.stack.join("\n")),R.notEnumerableProp(t,"__stackCleaned__",!0)}}}function _(t,n,r){if(X.warnings){var i,o=new T(t);if(n)r._attachExtraTrace(o);else if(X.longStackTraces&&(i=e._peekContext()))i.attachExtraTrace(o);else{var s=v(o);o.stack=s.message+"\n"+s.stack.join("\n")}q("warning",o)||y(o,"",!0)}}function d(t){for(var e=[],n=0;n<t.length;++n){var r=t[n],i="    (No stack trace)"===r||S.test(r),o=i&&$(r);i&&!o&&(D&&" "!==r.charAt(0)&&(r="    "+r),e.push(r))}return e}function v(t){var e=t.stack,n=t.toString();return e="string"==typeof e&&e.length>0?function(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),n=0;n<e.length;++n){var r=e[n];if("    (No stack trace)"===r||S.test(r))break}return n>0&&(e=e.slice(n)),e}(t):["    (No stack trace)"],{message:n,stack:d(e)}}function y(t,e,n){if("undefined"!=typeof console){var r;if(R.isObject(t)){var i=t.stack;r=e+A(i,t)}else r=e+String(t);"function"==typeof E?E(r,n):("function"==typeof console.log||"object"==typeof console.log)&&console.log(r)}}function g(t,e,n,r){var i=!1;try{"function"==typeof e&&(i=!0,"rejectionHandled"===t?e(r):e(n,r))}catch(t){x.throwLater(t)}"unhandledRejection"===t?q(t,n,r)||i||y(n,"Unhandled rejection "):q(t,r)}function m(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():R.toString(t);if(/\[object [a-zA-Z0-9$_]+\]/.test(e))try{e=JSON.stringify(t)}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+function(t){return t.length<41?t:t.substr(0,38)+"..."}(e)+">, no stack trace)"}function b(){return"function"==typeof z}function w(t){var e=t.match(G);return e?{fileName:e[1],line:parseInt(e[2],10)}:void 0}function C(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);z(this,C),e>32&&this.uncycle()}var j,k,E,F=e._getDomain,x=e._async,T=t("./errors").Warning,R=t("./util"),P=R.canAttachTrace,O=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,S=null,A=null,D=!1,V=!(0==R.env("BLUEBIRD_DEBUG")||!R.env("BLUEBIRD_DEBUG")&&"development"!==R.env("NODE_ENV")),I=!(0==R.env("BLUEBIRD_WARNINGS")||!V&&!R.env("BLUEBIRD_WARNINGS")),L=!(0==R.env("BLUEBIRD_LONG_STACK_TRACES")||!V&&!R.env("BLUEBIRD_LONG_STACK_TRACES")),H=0!=R.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(I||!!R.env("BLUEBIRD_W_FORGOTTEN_RETURN"));e.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=-1048577&t._bitField|524288},e.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),x.invokeLater(this._notifyUnhandledRejection,this,void 0))},e.prototype._notifyUnhandledRejectionIsHandled=function(){g("rejectionHandled",j,void 0,this)},e.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},e.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),g("unhandledRejection",k,t,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},e.prototype._warn=function(t,e,n){return _(t,e,n||this)},e.onPossiblyUnhandledRejection=function(t){var e=F();k="function"==typeof t?null===e?t:e.bind(t):void 0},e.onUnhandledRejectionHandled=function(t){var e=F();j="function"==typeof t?null===e?t:e.bind(t):void 0};var N=function(){};e.longStackTraces=function(){if(x.haveItemsQueued()&&!X.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!X.longStackTraces&&b()){var t=e.prototype._captureStackTrace,r=e.prototype._attachExtraTrace;X.longStackTraces=!0,N=function(){if(x.haveItemsQueued()&&!X.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");e.prototype._captureStackTrace=t,e.prototype._attachExtraTrace=r,n.deactivateLongStackTraces(),x.enableTrampoline(),X.longStackTraces=!1},e.prototype._captureStackTrace=h,e.prototype._attachExtraTrace=f,n.activateLongStackTraces(),x.disableTrampolineIfNecessary()}},e.hasLongStackTraces=function(){return X.longStackTraces&&b()};var U=function(){try{var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),R.global.dispatchEvent(t),function(t,e){var n=document.createEvent("CustomEvent");return n.initCustomEvent(t.toLowerCase(),!1,!0,e),!R.global.dispatchEvent(n)}}catch(t){}return function(){return!1}}(),B=R.isNode?function(){return process.emit.apply(process,arguments)}:R.global?function(t){var e="on"+t.toLowerCase(),n=R.global[e];return!!n&&(n.apply(R.global,[].slice.call(arguments,1)),!0)}:function(){return!1},M={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(t,e,n){return{promise:e,child:n}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,n){return{reason:e,promise:n}},rejectionHandled:r},q=function(t){var e=!1;try{e=B.apply(null,arguments)}catch(t){x.throwLater(t),e=!0}var n=!1;try{n=U(t,M[t].apply(null,arguments))}catch(t){x.throwLater(t),n=!0}return n||e};e.config=function(t){if("longStackTraces"in(t=Object(t))&&(t.longStackTraces?e.longStackTraces():!t.longStackTraces&&e.hasLongStackTraces()&&N()),"warnings"in t){var n=t.warnings;X.warnings=!!n,H=X.warnings,R.isObject(n)&&"wForgottenReturn"in n&&(H=!!n.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!X.cancellation){if(x.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");e.prototype._clearCancellationData=l,e.prototype._propagateFrom=u,e.prototype._onCancel=a,e.prototype._setOnCancel=c,e.prototype._attachCancellationCallback=s,e.prototype._execute=o,Q=u,X.cancellation=!0}"monitoring"in t&&(t.monitoring&&!X.monitoring?(X.monitoring=!0,e.prototype._fireEvent=q):!t.monitoring&&X.monitoring&&(X.monitoring=!1,e.prototype._fireEvent=i))},e.prototype._fireEvent=i,e.prototype._execute=function(t,e,n){try{t(e,n)}catch(t){return t}},e.prototype._onCancel=function(){},e.prototype._setOnCancel=function(t){},e.prototype._attachCancellationCallback=function(t){},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._clearCancellationData=function(){},e.prototype._propagateFrom=function(t,e){};var Q=function(t,e){0!=(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)},$=function(){return!1},G=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;R.inherits(C,Error),n.CapturedTrace=C,C.prototype.uncycle=function(){var t=this._length;if(!(2>t)){for(var e=[],n={},r=0,i=this;void 0!==i;++r)e.push(i),i=i._parent;for(r=(t=this._length=r)-1;r>=0;--r){var o=e[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;t>r;++r){var s=n[e[r].stack];if(void 0!==s&&s!==r){s>0&&(e[s-1]._parent=void 0,e[s-1]._length=1),e[r]._parent=void 0,e[r]._length=1;var a=r>0?e[r-1]:this;t-1>s?(a._parent=e[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var c=a._length+1,l=r-2;l>=0;--l)e[l]._length=c,c++;return}}}},C.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=v(t),n=e.message,r=[e.stack],i=this;void 0!==i;)r.push(d(i.stack.split("\n"))),i=i._parent;(function(t){for(var e=t[0],n=1;n<t.length;++n){for(var r=t[n],i=e.length-1,o=e[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(a=s;a>=0;--a){var c=r[a];if(e[i]!==c)break;e.pop(),i--}e=r}})(r),function(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}(r),R.notEnumerableProp(t,"stack",function(t,e){for(var n=0;n<e.length-1;++n)e[n].push("From previous event:"),e[n]=e[n].join("\n");return n<e.length&&(e[n]=e[n].join("\n")),t+"\n"+e.join("\n")}(n,r)),R.notEnumerableProp(t,"__stackCleaned__",!0)}};var z=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():m(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,S=t,A=e;var n=Error.captureStackTrace;return $=function(t){return O.test(t)},function(t,e){Error.stackTraceLimit+=6,n(t,e),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&i.stack.split("\n")[0].indexOf("stackDetection@")>=0)return S=/@/,A=e,D=!0,function(t){t.stack=(new Error).stack};try{throw new Error}catch(t){r="stack"in t}return"stack"in i||!r||"number"!=typeof Error.stackTraceLimit?(A=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?m(e):e.toString()},null):(S=t,A=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(E=function(t){console.warn(t)},R.isNode&&process.stderr.isTTY?E=function(t,e){var n=e?"[33m":"[31m";console.warn(n+t+"[0m\n")}:R.isNode||"string"!=typeof(new Error).stack||(E=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var X={warnings:I,longStackTraces:!1,cancellation:!1,monitoring:!1};return L&&e.longStackTraces(),{longStackTraces:function(){return X.longStackTraces},warnings:function(){return X.warnings},cancellation:function(){return X.cancellation},monitoring:function(){return X.monitoring},propagateFromFunction:function(){return Q},boundValueFunction:function(){return p},checkForgottenReturns:function(t,e,n,r,i){if(void 0===t&&null!==e&&H){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="a promise was created in a "+n+"handler but was not returned from it";r._warn(o,!0,e)}},setBounds:function(t,e){if(b()){for(var n,r,i=t.stack.split("\n"),o=e.stack.split("\n"),s=-1,a=-1,c=0;c<i.length;++c)if(l=w(i[c])){n=l.fileName,s=l.line;break}for(c=0;c<o.length;++c){var l;if(l=w(o[c])){r=l.fileName,a=l.line;break}}0>s||0>a||!n||!r||n!==r||s>=a||($=function(t){if(O.test(t))return!0;var e=w(t);return!!(e&&e.fileName===n&&s<=e.line&&e.line<=a)})}},warn:_,deprecated:function(t,e){var n=t+" is deprecated and will be removed in a future version.";return e&&(n+=" Use "+e+" instead."),_(n)},CapturedTrace:C,fireDomEvent:U,fireGlobalEvent:B}}},{"./errors":12,"./util":36}],10:[function(t,e,n){"use strict";e.exports=function(t){function e(){return this.value}function n(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(n){return n instanceof t&&n.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:n},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(n,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:t},void 0);var e=arguments[1];return this.caught(t,function(){throw e})},t.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof t&&n.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:n},void 0);var r=arguments[1];r instanceof t&&r.suppressUnhandledRejections();return this.caught(n,function(){return r})}}},{}],11:[function(t,e,n){"use strict";e.exports=function(t,e){function n(){return o(this)}function r(t,n){return i(t,n,e,e)}var i=t.reduce,o=t.all;t.prototype.each=function(t){return this.mapSeries(t)._then(n,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return i(this,t,e,e)},t.each=function(t,e){return r(t,e)._then(n,void 0,void 0,t,void 0)},t.mapSeries=r}},{}],12:[function(t,e,n){"use strict";function r(t,e){function n(r){return this instanceof n?(p(this,"message","string"==typeof r?r:e),p(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new n(r)}return u(n,Error),n}function i(t){return this instanceof i?(p(this,"name","OperationalError"),p(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(p(this,"message",t.message),p(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new i(t)}var o,s,a=t("./es5"),c=a.freeze,l=t("./util"),u=l.inherits,p=l.notEnumerableProp,h=r("Warning","warning"),f=r("CancellationError","cancellation error"),_=r("TimeoutError","timeout error"),d=r("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(t){o=r("TypeError","type error"),s=r("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<v.length;++y)"function"==typeof Array.prototype[v[y]]&&(d.prototype[v[y]]=Array.prototype[v[y]]);a.defineProperty(d.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),d.prototype.isOperational=!0;var g=0;d.prototype.toString=function(){var t=Array(4*g+1).join(" "),e="\n"+t+"AggregateError of:\n";g++,t=Array(4*g+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=t+i[o];e+=(r=i.join("\n"))+"\n"}return g--,e},u(i,Error);var m=Error.__BluebirdErrorTypes__;m||(m=c({CancellationError:f,TimeoutError:_,OperationalError:i,RejectionError:i,AggregateError:d}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:m,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:m.CancellationError,OperationalError:m.OperationalError,TimeoutError:m.TimeoutError,AggregateError:m.AggregateError,Warning:h}},{"./es5":13,"./util":36}],13:[function(t,e,n){var r=function(){"use strict";return void 0===this}();if(r)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(t){var e=[];for(var n in t)i.call(t,n)&&e.push(n);return e};e.exports={isArray:function(t){try{return"[object Array]"===o.call(t)}catch(t){return!1}},keys:a,names:a,defineProperty:function(t,e,n){return t[e]=n.value,t},getDescriptor:function(t,e){return{value:t[e]}},freeze:function(t){return t},getPrototypeOf:function(t){try{return Object(t).constructor.prototype}catch(t){return s}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(t,e,n){"use strict";e.exports=function(t,e){var n=t.map;t.prototype.filter=function(t,r){return n(this,t,r,e)},t.filter=function(t,r,i){return n(t,r,i,e)}}},{}],15:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t,e,n){this.promise=t,this.type=e,this.handler=n,this.called=!1,this.cancelPromise=null}function i(t){this.finallyHandler=t}function o(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function s(){return c.call(this,this.promise._target()._settledValue())}function a(t){return o(this,t)?void 0:(p.e=t,p)}function c(t){var r=this.promise,c=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?c.call(r._boundValue()):c.call(r._boundValue(),t);if(void 0!==l){r._setReturnedNonUndefined();var h=n(l,r);if(h instanceof e){if(null!=this.cancelPromise){if(h.isCancelled()){var f=new u("late cancellation observer");return r._attachExtraTrace(f),p.e=f,p}h.isPending()&&h._attachCancellationCallback(new i(this))}return h._then(s,a,void 0,this,void 0)}}}return r.isRejected()?(o(this),p.e=t,p):(o(this),t)}var l=t("./util"),u=e.CancellationError,p=l.errorObj;return r.prototype.isFinallyHandler=function(){return 0===this.type},i.prototype._resultCancelled=function(){o(this.finallyHandler)},e.prototype._passThrough=function(t,e,n,i){return"function"!=typeof t?this.then():this._then(n,i,void 0,new r(this,e,t),void 0)},e.prototype.lastly=e.prototype.finally=function(t){return this._passThrough(t,0,c,c)},e.prototype.tap=function(t){return this._passThrough(t,1,c)},r}},{"./util":36}],16:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){function a(t,n,i,o){var s=this._promise=new e(r);s._captureStackTrace(),s._setOnCancel(this),this._stack=o,this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(h):h,this._yieldedPromise=null}var c=t("./errors").TypeError,l=t("./util"),u=l.errorObj,p=l.tryCatch,h=[];l.inherits(a,o),a.prototype._isResolved=function(){return null===this._promise},a.prototype._cleanup=function(){this._promise=this._generator=null},a.prototype._promiseCancelled=function(){if(!this._isResolved()){var t;if(void 0!==this._generator.return)this._promise._pushContext(),t=p(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),t=p(this._generator.throw).call(this._generator,n),this._promise._popContext(),t===u&&t.e===n&&(t=null)}var r=this._promise;this._cleanup(),t===u?r._rejectCallback(t.e,!1):r.cancel()}},a.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=p(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},a.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=p(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},a.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,this._promiseCancelled(),t.cancel()}},a.prototype.promise=function(){return this._promise},a.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},a.prototype._continue=function(t){var n=this._promise;if(t===u)return this._cleanup(),n._rejectCallback(t.e,!1);var r=t.value;if(!0===t.done)return this._cleanup(),n._resolveCallback(r);var o=i(r,this._promise);if(o instanceof e||null!==(o=function(t,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=p(n[o])(t);if(r._popContext(),s===u){r._pushContext();var a=e.reject(u.e);return r._popContext(),a}var c=i(s,r);if(c instanceof e)return c}return null}(o,this._yieldHandlers,this._promise))){var s=(o=o._target())._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?this._promiseFulfilled(o._value()):0!=(16777216&s)?this._promiseRejected(o._reason()):this._promiseCancelled()}else this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",r)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},e.coroutine=function(t,e){if("function"!=typeof t)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(e).yieldHandler,r=a,i=(new Error).stack;return function(){var e=t.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=e,o._promiseFulfilled(void 0),s}},e.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new c("expecting a function but got "+l.classString(t));h.push(t)},e.spawn=function(t){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof t)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new a(t,this),i=r.promise();return r._run(e.spawn),i}}},{"./errors":12,"./util":36}],17:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){var o=t("./util");o.canEvaluate,o.tryCatch,o.errorObj,e.join=function(){var t,e=arguments.length-1;e>0&&"function"==typeof arguments[e]&&(t=arguments[e]);var r=[].slice.call(arguments);t&&r.pop();var i=new n(r).promise();return void 0!==t?i.spread(t):i}}},{"./util":36}],18:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){function a(t,e,n,r){this.constructor$(t),this._promise._captureStackTrace();var i=l();this._callback=null===i?e:i.bind(e),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:f,this._init$(void 0,-2)}function c(t,e,n,i){if("function"!=typeof e)return r("expecting a function but got "+u.classString(e));var o="object"==typeof n&&null!==n?n.concurrency:0;return new a(t,e,o="number"==typeof o&&isFinite(o)&&o>=1?o:0,i).promise()}var l=e._getDomain,u=t("./util"),p=u.tryCatch,h=u.errorObj,f=[];u.inherits(a,n),a.prototype._init=function(){},a.prototype._promiseFulfilled=function(t,n){var r=this._values,o=this.length(),a=this._preservedValues,c=this._limit;if(0>n){if(r[n=-1*n-1]=t,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return r[n]=t,this._queue.push(n),!1;null!==a&&(a[n]=t);var l=this._promise,u=this._callback,f=l._boundValue();l._pushContext();var _=p(u).call(f,t,n,o),d=l._popContext();if(s.checkForgottenReturns(_,d,null!==a?"Promise.filter":"Promise.map",l),_===h)return this._reject(_.e),!0;var v=i(_,this._promise);if(v instanceof e){var y=(v=v._target())._bitField;if(0==(50397184&y))return c>=1&&this._inFlight++,r[n]=v,v._proxy(this,-1*(n+1)),!1;if(0==(33554432&y))return 0!=(16777216&y)?(this._reject(v._reason()),!0):(this._cancel(),!0);_=v._value()}r[n]=_}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},a.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,n=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var r=t.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(t,e){for(var n=e.length,r=new Array(n),i=0,o=0;n>o;++o)t[o]&&(r[i++]=e[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(t,e){return c(this,t,e,null)},e.map=function(t,e,n,r){return c(t,e,n,r)}}},{"./util":36}],19:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){var s=t("./util"),a=s.tryCatch;e.method=function(t){if("function"!=typeof t)throw new e.TypeError("expecting a function but got "+s.classString(t));return function(){var r=new e(n);r._captureStackTrace(),r._pushContext();var i=a(t).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},e.attempt=e.try=function(t){if("function"!=typeof t)return i("expecting a function but got "+s.classString(t));var r,c=new e(n);if(c._captureStackTrace(),c._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var l=arguments[1],u=arguments[2];r=s.isArray(l)?a(t).apply(u,l):a(t).call(u,l)}else r=a(t)();var p=c._popContext();return o.checkForgottenReturns(r,p,"Promise.try",c),c._resolveFromSyncValue(r),c},e.prototype._resolveFromSyncValue=function(t){t===s.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},{"./util":36}],20:[function(t,e,n){"use strict";function r(t){var e;if(function(t){return t instanceof Error&&a.getPrototypeOf(t)===Error.prototype}(t)){(e=new s(t)).name=t.name,e.message=t.message,e.stack=t.stack;for(var n=a.keys(t),r=0;r<n.length;++r){var o=n[r];c.test(o)||(e[o]=t[o])}return e}return i.markAsOriginatingFromRejection(t),t}var i=t("./util"),o=i.maybeWrapAsError,s=t("./errors").OperationalError,a=t("./es5"),c=/^(?:name|message|stack|cause)$/;e.exports=function(t,e){return function(n,i){if(null!==t){if(n){var s=r(o(n));t._attachExtraTrace(s),t._reject(s)}else if(e){var a=[].slice.call(arguments,1);t._fulfill(a)}else t._fulfill(i);t=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){"use strict";e.exports=function(e){function n(t,e){if(!o.isArray(t))return r.call(this,t,e);var n=a(e).apply(this._boundValue(),[null].concat(t));n===c&&s.throwLater(n.e)}function r(t,e){var n=this._boundValue(),r=void 0===t?a(e).call(n,null):a(e).call(n,null,t);r===c&&s.throwLater(r.e)}function i(t,e){if(!t){var n=new Error(t+"");n.cause=t,t=n}var r=a(e).call(this._boundValue(),t);r===c&&s.throwLater(r.e)}var o=t("./util"),s=e._async,a=o.tryCatch,c=o.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(t,e){if("function"==typeof t){var o=r;void 0!==e&&Object(e).spread&&(o=n),this._then(o,i,void 0,this,t)}return this}}},{"./util":36}],22:[function(t,e,n){"use strict";e.exports=function(){function e(){}function n(t){this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,t!==g&&(function(t,e){if("function"!=typeof e)throw new v("expecting a function but got "+p.classString(e));if(t.constructor!==n)throw new v("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n")}(this,t),this._resolveFromExecutor(t)),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function r(t){this.promise._resolveCallback(t)}function i(t){this.promise._rejectCallback(t,!1)}function o(t){var e=new n(g);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var s,a=function(){return new v("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},c=function(){return new n.PromiseInspection(this._target())},l=function(t){return n.reject(new v(t))},u={},p=t("./util");s=p.isNode?function(){var t=process.domain;return void 0===t&&(t=null),t}:function(){return null},p.notEnumerableProp(n,"_getDomain",s);var h=t("./es5"),f=t("./async"),_=new f;h.defineProperty(n,"_async",{value:_});var d=t("./errors"),v=n.TypeError=d.TypeError;n.RangeError=d.RangeError;var y=n.CancellationError=d.CancellationError;n.TimeoutError=d.TimeoutError,n.OperationalError=d.OperationalError,n.RejectionError=d.OperationalError,n.AggregateError=d.AggregateError;var g=function(){},m={},b={},w=t("./thenables")(n,g),C=t("./promise_array")(n,g,w,l,e),j=t("./context")(n),k=j.create,E=t("./debuggability")(n,j),F=(E.CapturedTrace,t("./finally")(n,w)),x=t("./catch_filter")(b),T=t("./nodeback"),R=p.errorObj,P=p.tryCatch;return n.prototype.toString=function(){return"[object Promise]"},n.prototype.caught=n.prototype.catch=function(t){var e=arguments.length;if(e>1){var n,r=new Array(e-1),i=0;for(n=0;e-1>n;++n){var o=arguments[n];if(!p.isObject(o))return l("expecting an object but got "+p.classString(o));r[i++]=o}return r.length=i,t=arguments[n],this.then(void 0,x(r,t,this))}return this.then(void 0,t)},n.prototype.reflect=function(){return this._then(c,c,void 0,this,void 0)},n.prototype.then=function(t,e){if(E.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var n=".then() only accepts functions but was passed: "+p.classString(t);arguments.length>1&&(n+=", "+p.classString(e)),this._warn(n)}return this._then(t,e,void 0,void 0,void 0)},n.prototype.done=function(t,e){this._then(t,e,void 0,void 0,void 0)._setIsFinal()},n.prototype.spread=function(t){return"function"!=typeof t?l("expecting a function but got "+p.classString(t)):this.all()._then(t,void 0,void 0,m,void 0)},n.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},n.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},n.prototype.error=function(t){return this.caught(p.originatesFromRejection,t)},n.is=function(t){return t instanceof n},n.fromNode=n.fromCallback=function(t){var e=new n(g);e._captureStackTrace();var r=arguments.length>1&&!!Object(arguments[1]).multiArgs,i=P(t)(T(e,r));return i===R&&e._rejectCallback(i.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},n.all=function(t){return new C(t).promise()},n.cast=function(t){var e=w(t);return e instanceof n||((e=new n(g))._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},n.resolve=n.fulfilled=n.cast,n.reject=n.rejected=function(t){var e=new n(g);return e._captureStackTrace(),e._rejectCallback(t,!0),e},n.setScheduler=function(t){if("function"!=typeof t)throw new v("expecting a function but got "+p.classString(t));var e=_._schedule;return _._schedule=t,e},n.prototype._then=function(t,e,r,i,o){var a=void 0!==o,c=a?o:new n(g),l=this._target(),u=l._bitField;a||(c._propagateFrom(this,3),c._captureStackTrace(),void 0===i&&0!=(2097152&this._bitField)&&(i=0!=(50397184&u)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,c));var p=s();if(0!=(50397184&u)){var h,f,d=l._settlePromiseCtx;0!=(33554432&u)?(f=l._rejectionHandler0,h=t):0!=(16777216&u)?(f=l._fulfillmentHandler0,h=e,l._unsetRejectionIsUnhandled()):(d=l._settlePromiseLateCancellationObserver,f=new y("late cancellation observer"),l._attachExtraTrace(f),h=e),_.invoke(d,l,{handler:null===p?h:"function"==typeof h&&p.bind(h),promise:c,receiver:i,value:f})}else l._addCallbacks(t,e,c,i,p);return c},n.prototype._length=function(){return 65535&this._bitField},n.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},n.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},n.prototype._setLength=function(t){this._bitField=-65536&this._bitField|65535&t},n.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},n.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},n.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},n.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},n.prototype._isFinal=function(){return(4194304&this._bitField)>0},n.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},n.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},n.prototype._setAsyncGuaranteed=function(){this._bitField=134217728|this._bitField},n.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];return e===u?void 0:void 0===e&&this._isBound()?this._boundValue():e},n.prototype._promiseAt=function(t){return this[4*t-4+2]},n.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},n.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},n.prototype._boundValue=function(){},n.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),n=t._rejectionHandler0,r=t._promise0,i=t._receiverAt(0);void 0===i&&(i=u),this._addCallbacks(e,n,r,i,null)},n.prototype._migrateCallbackAt=function(t,e){var n=t._fulfillmentHandlerAt(e),r=t._rejectionHandlerAt(e),i=t._promiseAt(e),o=t._receiverAt(e);void 0===o&&(o=u),this._addCallbacks(n,r,i,o,null)},n.prototype._addCallbacks=function(t,e,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof t&&(this._fulfillmentHandler0=null===i?t:i.bind(t)),"function"==typeof e&&(this._rejectionHandler0=null===i?e:i.bind(e));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof t&&(this[s+0]=null===i?t:i.bind(t)),"function"==typeof e&&(this[s+1]=null===i?e:i.bind(e))}return this._setLength(o+1),o},n.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},n.prototype._resolveCallback=function(t,e){if(0==(117506048&this._bitField)){if(t===this)return this._rejectCallback(a(),!1);var r=w(t,this);if(!(r instanceof n))return this._fulfill(t);e&&this._propagateFrom(r,2);var i=r._target();if(i===this)return void this._reject(a());var o=i._bitField;if(0==(50397184&o)){var s=this._length();s>0&&i._migrateCallback0(this);for(var c=1;s>c;++c)i._migrateCallbackAt(this,c);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else if(0!=(33554432&o))this._fulfill(i._value());else if(0!=(16777216&o))this._reject(i._reason());else{var l=new y("late cancellation observer");i._attachExtraTrace(l),this._reject(l)}}},n.prototype._rejectCallback=function(t,e,n){var r=p.ensureErrorObject(t),i=r===t;if(!i&&!n&&E.warnings()){var o="a promise was rejected with a non-error: "+p.classString(t);this._warn(o,!0)}this._attachExtraTrace(r,!!e&&i),this._reject(t)},n.prototype._resolveFromExecutor=function(t){var e=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,n)});n=!1,this._popContext(),void 0!==r&&e._rejectCallback(r,!0)},n.prototype._settlePromiseFromHandler=function(t,e,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),e===m?n&&"number"==typeof n.length?o=P(t).apply(this._boundValue(),n):(o=R).e=new v("cannot .spread() a non-array: "+p.classString(n)):o=P(t).call(e,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===b?r._reject(n):o===R?r._rejectCallback(o.e,!1):(E.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},n.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},n.prototype._followee=function(){return this._rejectionHandler0},n.prototype._setFollowee=function(t){this._rejectionHandler0=t},n.prototype._settlePromise=function(t,r,i,o){var s=t instanceof n,a=this._bitField,l=0!=(134217728&a);0!=(65536&a)?(s&&t._invokeInternalOnCancel(),i instanceof F&&i.isFinallyHandler()?(i.cancelPromise=t,P(r).call(i,o)===R&&t._reject(R.e)):r===c?t._fulfill(c.call(i)):i instanceof e?i._promiseCancelled(t):s||t instanceof C?t._cancel():i.cancel()):"function"==typeof r?s?(l&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(r,i,o,t)):r.call(i,o,t):i instanceof e?i._isResolved()||(0!=(33554432&a)?i._promiseFulfilled(o,t):i._promiseRejected(o,t)):s&&(l&&t._setAsyncGuaranteed(),0!=(33554432&a)?t._fulfill(o):t._reject(o))},n.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,r=t.promise,i=t.receiver,o=t.value;"function"==typeof e?r instanceof n?this._settlePromiseFromHandler(e,i,o,r):e.call(i,o,r):r instanceof n&&r._reject(o)},n.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},n.prototype._settlePromise0=function(t,e,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,t,i,e)},n.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},n.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var n=a();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!=(134217728&e)?this._settlePromises():_.settlePromises(this))}},n.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?_.fatalError(t,p.isNode):void((65535&e)>0?_.settlePromises(this):this._ensurePossibleRejectionHandled())},n.prototype._fulfillPromises=function(t,e){for(var n=1;t>n;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},n.prototype._rejectPromises=function(t,e){for(var n=1;t>n;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,e)}},n.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!=(16842752&t)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,t),this._rejectPromises(e,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,t),this._fulfillPromises(e,r)}this._setLength(0)}this._clearCancellationData()},n.prototype._settledValue=function(){var t=this._bitField;return 0!=(33554432&t)?this._rejectionHandler0:0!=(16777216&t)?this._fulfillmentHandler0:void 0},n.defer=n.pending=function(){return E.deprecated("Promise.defer","new Promise"),{promise:new n(g),resolve:r,reject:i}},p.notEnumerableProp(n,"_makeSelfResolutionError",a),t("./method")(n,g,w,l,E),t("./bind")(n,g,w,E),t("./cancel")(n,C,l,E),t("./direct_resolve")(n),t("./synchronous_inspection")(n),t("./join")(n,C,w,g,E),n.Promise=n,t("./map.js")(n,C,l,w,g,E),t("./using.js")(n,l,w,k,g,E),t("./timers.js")(n,g,E),t("./generators.js")(n,l,g,w,e,E),t("./nodeify.js")(n),t("./call_get.js")(n),t("./props.js")(n,C,w,l),t("./race.js")(n,g,w,l),t("./reduce.js")(n,C,l,w,g,E),t("./settle.js")(n,C,E),t("./some.js")(n,C,l),t("./promisify.js")(n,g),t("./any.js")(n),t("./each.js")(n,g),t("./filter.js")(n,g),p.toFastProperties(n),p.toFastProperties(n.prototype),o({a:1}),o({b:2}),o({c:3}),o(1),o(function(){}),o(void 0),o(!1),o(new n(g)),E.setBounds(f.firstLineError,p.lastLineError),n}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o){function s(t){var r=this._promise=new e(n);t instanceof e&&r._propagateFrom(t,3),r._setOnCancel(this),this._values=t,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var a=t("./util");return a.isArray,a.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function t(n,o){var s=r(this._values,this._promise);if(s instanceof e){var c=(s=s._target())._bitField;if(this._values=s,0==(50397184&c))return this._promise._setAsyncGuaranteed(),s._then(t,this._reject,void 0,this,o);if(0==(33554432&c))return 0!=(16777216&c)?this._reject(s._reason()):this._cancel();s=s._value()}if(null!==(s=a.asArray(s)))return 0===s.length?void(-5===o?this._resolveEmptyArray():this._resolve(function(t){switch(t){case-2:return[];case-3:return{}}}(o))):void this._iterate(s);var l=i("expecting an array or an iterable object but got "+a.classString(s)).reason();this._promise._rejectCallback(l,!1)},s.prototype._iterate=function(t){var n=this.getActualLength(t.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;n>a;++a){var c=r(t[a],i);c instanceof e?s=(c=c._target())._bitField:s=null,o?null!==s&&c.suppressUnhandledRejections():null!==s?0==(50397184&s)?(c._proxy(this,a),this._values[a]=c):o=0!=(33554432&s)?this._promiseFulfilled(c._value(),a):0!=(16777216&s)?this._promiseRejected(c._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(c,a)}o||i._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},s.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},s.prototype._promiseFulfilled=function(t,e){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(t){return t},s}},{"./util":36}],24:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t){return!v.test(t)}function i(t){try{return!0===t.__isPromisified__}catch(t){return!1}}function o(t,e,n){var r=l.getDataPropertyOrDefault(t,e+n,d);return!!r&&i(r)}function s(t,e,n,r){for(var s=l.inheritedDataKeys(t),a=[],c=0;c<s.length;++c){var u=s[c],p=t[u],h=r===y||y(u,p,t);"function"!=typeof p||i(p)||o(t,u,e)||!r(u,p,t,h)||a.push(u,p)}return function(t,e,n){for(var r=0;r<t.length;r+=2){var i=t[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<t.length;s+=2)if(t[s]===o)throw new _("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}(a,e,n),a}function a(t,e,n,r,i){for(var o=new RegExp(g(e)+"$"),a=s(t,e,o,n),u=0,p=a.length;p>u;u+=2){var h=a[u],f=a[u+1],_=h+e;if(r===m)t[_]=m(h,c,h,f,e,i);else{var d=r(f,function(){return m(h,c,h,f,e,i)});l.notEnumerableProp(d,"__isPromisified__",!0),t[_]=d}}return l.toFastProperties(t),t}var c={},l=t("./util"),u=t("./nodeback"),p=l.withAppended,h=l.maybeWrapAsError,f=l.canEvaluate,_=t("./errors").TypeError,d={__isPromisified__:!0},v=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),y=function(t){return l.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},g=function(t){return t.replace(/([$])/,"\\$")},m=f?void 0:function(t,r,i,o,s,a){function f(){var i=r;r===c&&(i=this);var o=new e(n);o._captureStackTrace();var s="string"==typeof d&&this!==_?this[d]:t,l=u(o,a);try{s.apply(i,p(arguments,l))}catch(t){o._rejectCallback(h(t),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var _=function(){return this}(),d=t;return"string"==typeof d&&(t=o),l.notEnumerableProp(f,"__isPromisified__",!0),f};e.promisify=function(t,e){if("function"!=typeof t)throw new _("expecting a function but got "+l.classString(t));if(i(t))return t;var n=function(t,e,n){return m(t,e,void 0,t,null,n)}(t,void 0===(e=Object(e)).context?c:e.context,!!e.multiArgs);return l.copyDescriptors(t,n,r),n},e.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new _("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(e=Object(e)).multiArgs,r=e.suffix;"string"!=typeof r&&(r="Async");var i=e.filter;"function"!=typeof i&&(i=y);var o=e.promisifier;if("function"!=typeof o&&(o=m),!l.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=l.inheritedDataKeys(t),c=0;c<s.length;++c){var u=t[s[c]];"constructor"!==s[c]&&l.isClass(u)&&(a(u.prototype,r,i,o,n),a(u,r,i,o,n))}return a(t,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t){var e,n=!1;if(void 0!==a&&t instanceof a)e=p(t),n=!0;else{var r=u.keys(t),i=r.length;e=new Array(2*i);for(var o=0;i>o;++o){var s=r[o];e[o]=t[s],e[o+i]=s}}this.constructor$(e),this._isMap=n,this._init$(void 0,-3)}function s(t){var n,s=r(t);return l(s)?(n=s instanceof e?s._then(e.props,void 0,void 0,void 0,void 0):new o(s).promise(),s instanceof e&&n._propagateFrom(s,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,c=t("./util"),l=c.isObject,u=t("./es5");"function"==typeof Map&&(a=Map);var p=function(){function t(t,r){this[e]=t,this[e+n]=r,e++}var e=0,n=0;return function(r){n=r.size,e=0;var i=new Array(2*r.size);return r.forEach(t,i),i}}();c.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(t,e){if(this._values[e]=t,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(t){for(var e=new a,n=t.length/2|0,r=0;n>r;++r){var i=t[n+r],o=t[r];e.set(i,o)}return e}(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();o>i;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(t){return t>>1},e.prototype.props=function(){return s(this)},e.props=function(t){return s(t)}}},{"./es5":13,"./util":36}],26:[function(t,e,n){"use strict";function r(t){this._capacity=t,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(t){return this._capacity<t},r.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1),this[this._front+e&this._capacity-1]=t,this._length=e+1},r.prototype._unshiftOne=function(t){var e=this._capacity;this._checkCapacity(this.length()+1);var n=(this._front-1&e-1^e)-e;this[n]=t,this._front=n,this._length=this.length()+1},r.prototype.unshift=function(t,e,n){this._unshiftOne(n),this._unshiftOne(e),this._unshiftOne(t)},r.prototype.push=function(t,e,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(t),this._pushOne(e),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=t,this[i+1&o]=e,this[i+2&o]=n,this._length=r},r.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t,function(t,e,n,r,i){for(var o=0;i>o;++o)n[o+r]=t[o+e],t[o+e]=void 0}(this,0,this,e,this._front+this._length&e-1)},e.exports=r},{}],27:[function(t,e,n){"use strict";e.exports=function(e,n,r,i){function o(t,o){var c=r(t);if(c instanceof e)return a(c);if(null===(t=s.asArray(t)))return i("expecting an array or an iterable object but got "+s.classString(t));var l=new e(n);void 0!==o&&l._propagateFrom(o,3);for(var u=l._fulfill,p=l._reject,h=0,f=t.length;f>h;++h){var _=t[h];(void 0!==_||h in t)&&e.cast(_)._then(u,p,void 0,l,null)}return l}var s=t("./util"),a=function(t){return t.then(function(e){return o(e,t)})};e.race=function(t){return o(t,void 0)},e.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){function a(t,n,r,i){this.constructor$(t);var s=h();this._fn=null===s?n:s.bind(n),void 0!==r&&(r=e.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?[]:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function c(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function l(t,e,n,i){return"function"!=typeof e?r("expecting a function but got "+f.classString(e)):new a(t,e,n,i).promise()}function u(t){this.accum=t,this.array._gotAccum(t);var n=i(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(p,void 0,void 0,this,void 0)):p.call(this,n)}function p(t){var n,r=this.array,i=r._promise,o=_(r._fn);i._pushContext(),(n=void 0!==r._eachValues?o.call(i._boundValue(),t,this.index,this.length):o.call(i._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(r._currentCancellable=n);var a=i._popContext();return s.checkForgottenReturns(n,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",i),n}var h=e._getDomain,f=t("./util"),_=f.tryCatch;f.inherits(a,n),a.prototype._gotAccum=function(t){void 0!==this._eachValues&&t!==o&&this._eachValues.push(t)},a.prototype._eachComplete=function(t){return this._eachValues.push(t),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},a.prototype._resultCancelled=function(t){return t===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel()))},a.prototype._iterate=function(t){this._values=t;var n,r,i=t.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=e.resolve(t[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;i>r;++r){var o={accum:null,value:t[r],index:r,length:i,array:this};n=n._then(u,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(c,c,void 0,n,this)},e.prototype.reduce=function(t,e){return l(this,t,e,null)},e.reduce=function(t,e,n,r){return l(t,e,n,r)}}},{"./util":36}],29:[function(t,e,n){"use strict";var r,i=t("./util");if(i.isNode&&"undefined"==typeof MutationObserver){var o=global.setImmediate,s=process.nextTick;r=i.isRecentNode?function(t){o.call(global,t)}:function(t){s.call(process,t)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var t=document.createElement("div"),e={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){t.classList.toggle("foo"),n=!1}).observe(r,e);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(t,e),i()}}();e.exports=r},{"./util":36}],30:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t){this.constructor$(t)}var o=e.PromiseInspection;t("./util").inherits(i,n),i.prototype._promiseResolved=function(t,e){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(t,e){var n=new o;return n._bitField=33554432,n._settledValueField=t,this._promiseResolved(e,n)},i.prototype._promiseRejected=function(t,e){var n=new o;return n._bitField=16777216,n._settledValueField=t,this._promiseResolved(e,n)},e.settle=function(t){return r.deprecated(".settle()",".reflect()"),new i(t).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(t,e){if((0|e)!==e||0>e)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(t),o=n.promise();return n.setHowMany(e),n.init(),o}var s=t("./util"),a=t("./errors").RangeError,c=t("./errors").AggregateError,l=s.isArray,u={};s.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=l(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(t){this._howMany=t},i.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new c,e=this.length();e<this._values.length;++e)this._values[e]!==u&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(t){this._values.push(t)},i.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(t,e){return o(t,e)},e.prototype.some=function(t){return o(this,t)},e._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(t,e,n){"use strict";e.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var n=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=e.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=e.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=e.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};e.prototype.isCancelled=t.prototype._isCancelled=function(){return 65536==(65536&this._bitField)},t.prototype.isCancelled=function(){return this._target()._isCancelled()},t.prototype.isPending=function(){return s.call(this._target())},t.prototype.isRejected=function(){return o.call(this._target())},t.prototype.isFulfilled=function(){return i.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return n.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),r.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},{}],33:[function(t,e,n){"use strict";e.exports=function(e,n){function r(t,r,s){var a=new e(n),c=a;s&&s._pushContext(),a._captureStackTrace(),s&&s._popContext();var l=!0,u=i.tryCatch(r).call(t,function(t){a&&(a._resolveCallback(t),a=null)},function(t){a&&(a._rejectCallback(t,l,!0),a=null)});return l=!1,a&&u===o&&(a._rejectCallback(u.e,!0,!0),a=null),c}var i=t("./util"),o=i.errorObj,s=i.isObject,a={}.hasOwnProperty;return function(t,i){if(s(t)){if(t instanceof e)return t;var c=function(t){try{return function(t){return t.then}(t)}catch(t){return o.e=t,o}}(t);if(c===o){i&&i._pushContext();var l=e.reject(c.e);return i&&i._popContext(),l}if("function"==typeof c)return function(t){return a.call(t,"_promise0")}(t)?(l=new e(n),t._then(l._fulfill,l._reject,void 0,l,null),l):r(t,c,i)}return t}}},{"./util":36}],34:[function(t,e,n){"use strict";e.exports=function(e,n,r){function i(t){this.handle=t}function o(t){return clearTimeout(this.handle),t}function s(t){throw clearTimeout(this.handle),t}var a=t("./util"),c=e.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var l=function(t){return u(+this).thenReturn(t)},u=e.delay=function(t,o){var s,a;return void 0!==o?(s=e.resolve(o)._then(l,null,null,t,void 0),r.cancellation()&&o instanceof e&&s._setOnCancel(o)):(s=new e(n),a=setTimeout(function(){s._fulfill()},+t),r.cancellation()&&s._setOnCancel(new i(a))),s._setAsyncGuaranteed(),s};e.prototype.delay=function(t){return u(t,this)};var p=function(t,e,n){var r;r="string"!=typeof e?e instanceof Error?e:new c("operation timed out"):new c(e),a.markAsOriginatingFromRejection(r),t._attachExtraTrace(r),t._reject(r),null!=n&&n.cancel()};e.prototype.timeout=function(t,e){t=+t;var n,a,c=new i(setTimeout(function(){n.isPending()&&p(n,e,a)},t));return r.cancellation()?(a=this.then(),(n=a._then(o,s,void 0,c,void 0))._setOnCancel(c)):n=this._then(o,s,void 0,c,void 0),n}}},{"./util":36}],35:[function(t,e,n){"use strict";e.exports=function(e,n,r,i,o,s){function a(t){setTimeout(function(){throw t},0)}function c(t,n){var i=0,s=t.length,c=new e(o);return function o(){if(i>=s)return c._fulfill();var l=function(t){var e=r(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}(t[i++]);if(l instanceof e&&l._isDisposable()){try{l=r(l._getDisposer().tryDispose(n),t.promise)}catch(t){return a(t)}if(l instanceof e)return l._then(o,a,null,null,null)}o()}(),c}function l(t,e,n){this._data=t,this._promise=e,this._context=n}function u(t,e,n){this.constructor$(t,e,n)}function p(t){return l.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function h(t){this.length=t,this.promise=null,this[t-1]=null}var f=t("./util"),_=t("./errors").TypeError,d=t("./util").inherits,v=f.errorObj,y=f.tryCatch;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(t){var e=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=null!==e?this.doDispose(e,t):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},l.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},d(u,l),u.prototype.doDispose=function(t,e){return this.data().call(t,t,e)},h.prototype._resultCancelled=function(){for(var t=this.length,n=0;t>n;++n){var r=this[n];r instanceof e&&r.cancel()}},e.using=function(){var t=arguments.length;if(2>t)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[t-1];if("function"!=typeof i)return n("expecting a function but got "+f.classString(i));var o,a=!0;2===t&&Array.isArray(arguments[0])?(t=(o=arguments[0]).length,a=!1):(o=arguments,t--);for(var u=new h(t),_=0;t>_;++_){var d=o[_];if(l.isDisposer(d)){var g=d;(d=d.promise())._setDisposable(g)}else{var m=r(d);m instanceof e&&(d=m._then(p,null,null,{resources:u,index:_},void 0))}u[_]=d}var b=new Array(u.length);for(_=0;_<b.length;++_)b[_]=e.resolve(u[_]).reflect();var w=e.all(b).then(function(t){for(var e=0;e<t.length;++e){var n=t[e];if(n.isRejected())return v.e=n.error(),v;if(!n.isFulfilled())return void w.cancel();t[e]=n.value()}C._pushContext(),i=y(i);var r=a?i.apply(void 0,t):i(t),o=C._popContext();return s.checkForgottenReturns(r,o,"Promise.using",C),r}),C=w.lastly(function(){var t=new e.PromiseInspection(w);return c(u,t)});return u.promise=C,C._setOnCancel(u),C},e.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(t){if("function"==typeof t)return new u(t,this,i());throw new _}}},{"./errors":12,"./util":36}],36:[function(t,e,n){"use strict";function r(){try{var t=u;return u=null,t.apply(this,arguments)}catch(t){return f.e=t,f}}function i(t){return null==t||!0===t||!1===t||"string"==typeof t||"number"==typeof t}function o(t,e,n){if(i(t))return t;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return p.defineProperty(t,e,r),t}function s(t){try{return t+""}catch(t){return"[no string representation]"}}function a(t){return null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function c(t){return a(t)&&p.propertyIsWritable(t,"stack")}function l(t){return{}.toString.call(t)}var u,p=t("./es5"),h="undefined"==typeof navigator,f={e:{}},_="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,d=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var n=0;n<t.length;++n)if(t[n]===e)return!0;return!1};if(p.isES5){var n=Object.getOwnPropertyNames;return function(t){for(var r=[],i=Object.create(null);null!=t&&!e(t);){var o;try{o=n(t)}catch(t){return r}for(var s=0;s<o.length;++s){var a=o[s];if(!i[a]){i[a]=!0;var c=Object.getOwnPropertyDescriptor(t,a);null!=c&&null==c.get&&null==c.set&&r.push(a)}}t=p.getPrototypeOf(t)}return r}}var r={}.hasOwnProperty;return function(n){if(e(n))return[];var i=[];t:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<t.length;++s)if(r.call(t[s],o))continue t;i.push(o)}return i}}(),v=/this\s*\.\s*\S+\s*=/,y=/^[a-z$_][a-z$_0-9]*$/i,g="stack"in new Error?function(t){return c(t)?t:new Error(s(t))}:function(t){if(c(t))return t;try{throw new Error(s(t))}catch(t){return t}},m=function(t){return p.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var b="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,n=[],r=t[Symbol.iterator]();!(e=r.next()).done;)n.push(e.value);return n};m=function(t){return p.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?b(t):null}}var w="undefined"!=typeof process&&"[object process]"===l(process).toLowerCase(),C={isClass:function(t){try{if("function"==typeof t){var e=p.names(t.prototype),n=p.isES5&&e.length>1,r=e.length>0&&!(1===e.length&&"constructor"===e[0]),i=v.test(t+"")&&p.names(t).length>0;if(n||r||i)return!0}return!1}catch(t){return!1}},isIdentifier:function(t){return y.test(t)},inheritedDataKeys:d,getDataPropertyOrDefault:function(t,e,n){if(!p.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var r=Object.getOwnPropertyDescriptor(t,e);return null!=r?null==r.get&&null==r.set?r.value:n:void 0},thrower:function(t){throw t},isArray:p.isArray,asArray:m,notEnumerableProp:o,isPrimitive:i,isObject:function(t){return"function"==typeof t||"object"==typeof t&&null!==t},isError:a,canEvaluate:h,errorObj:f,tryCatch:function(t){return u=t,r},inherits:function(t,e){function n(){for(var n in this.constructor=t,this.constructor$=e,e.prototype)r.call(e.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=e.prototype[n])}var r={}.hasOwnProperty;return n.prototype=e.prototype,t.prototype=new n,t.prototype},withAppended:function(t,e){var n,r=t.length,i=new Array(r+1);for(n=0;r>n;++n)i[n]=t[n];return i[n]=e,i},maybeWrapAsError:function(t){return i(t)?new Error(s(t)):t},toFastProperties:function(t){function e(){}e.prototype=t;for(var n=8;n--;)new e;return t},filledRange:function(t,e,n){for(var r=new Array(t),i=0;t>i;++i)r[i]=e+i+n;return r},toString:s,canAttachTrace:c,ensureErrorObject:g,originatesFromRejection:function(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===t.isOperational)},markAsOriginatingFromRejection:function(t){try{o(t,"isOperational",!0)}catch(t){}},classString:l,copyDescriptors:function(t,e,n){for(var r=p.names(t),i=0;i<r.length;++i){var o=r[i];if(n(o))try{p.defineProperty(e,o,p.getDescriptor(t,o))}catch(t){}}},hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:w,env:function(t,e){return w?process.env[t]:e},global:_};C.isRecentNode=C.isNode&&function(){var t=process.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),C.isNode&&C.toFastProperties(process);try{throw new Error}catch(t){C.lastLineError=t}e.exports=C},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise);
!function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=54)}([function(t,e,i){"use strict";e.__esModule=!0;var s=i(6);e.MyRand=s.MyRand,e.UiStrUtil=s.UiStrUtil;var n=i(40);e.Drawing=n.Drawing;var o=i(15);e.NapeUtil=o.NapeUtil;var a=i(64);e.GameCore=a.GameCore;var r=i(65);e.GameObject=r.GameObject;var h=i(66);e.IDisposed=h.IDisposed;var l=i(67);e.IUpdated=l.IUpdated;var c=i(68);e.ISafed=c.ISafed;var u=i(69);e.IRestarted=u.IRestarted;var d=i(70);e.IActivatable=d.IActivatable;var p=i(41);e.GamePhysics=p.GamePhysics;var f=i(30);e.NapePhysics=f.NapePhysics;var y=i(71);e.GameView=y.GameView;var g=i(31);e.RaceCamera=g.RaceCamera;var m=i(32);e.CameraPathes=m.CameraPathes;var v=i(72);e.CarParams=v.CarParams;var b=i(73);e.CarUpgrades=b.CarUpgrades;var x=i(74);e.RaceCars=x.RaceCars;var _=i(75);e.WeaponParams=_.WeaponParams;var w=i(76);e.Inventory=w.Inventory;var P=i(77);e.LeagueVO=P.LeagueVO;var C=i(78);e.MapVO=C.MapVO;var T=i(79);e.RaceData=T.RaceData;var S=i(80);e.BgElVo=S.BgElVo;var A=i(81);e.ShopCarVO=A.ShopCarVO;var E=i(42);e.CarsData=E.CarsData;var I=i(34);e.GameData=I.GameData;var M=i(33);e.RacesData=M.RacesData;var O=i(82);e.ShopData=O.ShopData;var R=i(83);e.CarBuilder=R.CarBuilder;var B=i(85);e.RaceBuilder=B.RaceBuilder;var L=i(89);e.FrameGraphic=L.FrameGraphic;var D=i(47);e.GroundPartClip=D.GroundPartClip;var k=i(46);e.SmokePartClip=k.SmokePartClip;var F=i(90);e.TrailPart=F.TrailPart;var G=i(91);e.WheelGraphic=G.WheelGraphic;var U=i(92);e.BgEl=U.BgEl;var N=i(93);e.LandscapeShape=N.LandscapeShape;var j=i(48);e.CarObject=j.CarObject;var W=i(94);e.BikeObject=W.BikeObject;var X=i(95);e.CorpseObject=X.CorpseObject;var H=i(96);e.DriverObject=H.DriverObject;var V=i(97);e.FrameObject=V.FrameObject;var Y=i(98);e.PartObject=Y.PartObject;var q=i(99);e.WheelObject=q.WheelObject;var z=i(100);e.BgObject=z.BgObject;var K=i(101);e.DecorActObject=K.DecorActObject;var J=i(102);e.DecorMultiObject=J.DecorMultiObject;var Z=i(49);e.DecorObject=Z.DecorObject;var Q=i(103);e.VectorDecor=Q.VectorDecor;var $=i(37);e.CarExplodeObject=$.CarExplodeObject;var tt=i(104);e.GlassExplodeObject=tt.GlassExplodeObject;var et=i(44);e.TrailParticlesSystem=et.TrailParticlesSystem;var it=i(45);e.TrailPartObject=it.TrailPartObject;var st=i(105);e.GlassBlock=st.GlassBlock;var nt=i(50);e.GlassBlockPart=nt.GlassBlockPart;var ot=i(106);e.GroundObject=ot.GroundObject;var at=i(107);e.PlankObject=at.PlankObject;var rt=i(108);e.ShaperObject=rt.ShaperObject;var ht=i(109);e.WaterObject=ht.WaterObject;var lt=i(111);e.BoostObject=lt.BoostObject;var ct=i(52);e.DynamicBodyObject=ct.DynamicBodyObject;var ut=i(112);e.FinishObject=ut.FinishObject;var dt=i(113);e.MotorObject=dt.MotorObject;var pt=i(114);e.MoverPatherObject=pt.MoverPatherObject;var ft=i(115);e.PivotObject=ft.PivotObject;var yt=i(116);e.RemovedBodyObjects=yt.RemovedBodyObjects;var gt=i(117);e.SafePointObject=gt.SafePointObject;var mt=i(118);e.SpikesObject=mt.SpikesObject;var vt=i(119);e.TntObject=vt.TntObject;var bt=i(120);e.ToggleObject=bt.ToggleObject;var xt=i(121);e.CameraZone=xt.CameraZone;var _t=i(122);e.WaypointObject=_t.WaypointObject;var wt=i(1);e.ObjectTypes=wt.ObjectTypes;var Pt=i(10);e.CbTypes=Pt.CbTypes;var Ct=i(7);e.Filters=Ct.Filters;var Tt=i(8);e.Materials=Tt.Materials;var St=i(123);e.MaxPhysics=St.MaxPhysics;var At=i(124);e.BodyEffector=At.BodyEffector;var Et=i(125);e.BoostEffector=Et.BoostEffector;var It=i(126);e.PlayerController=It.PlayerController;var Mt=i(53);e.CarController=Mt.CarController;var Ot=i(5);e.GraphicUtil=Ot.GraphicUtil;var Rt=i(51);e.PhysicUtil=Rt.PhysicUtil;var Bt=i(2);e.MaxGameView=Bt.MaxGameView},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.BG=0,t.LANDSCAPE=1,t.LANDSCAPE_SHAPE=9,t.CAR=2,t.BULLET=3,t.FRONT=4,t.OBJECT=5,t.EFFECT=6,t.CAR_PART=7,t.LANDSCAPE_BACK=8,t}();e.ObjectTypes=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(16),a=i(1),r=Phaser.Group,h=i(11),l=i(6),c=i(3),u=i(35),d=i(4),p=function(){return function(){}}();e.default=p;var f=function(){return function(t,e,i){this.target=i,this.method=e,this.key=t}}();e.RenderVO=f;var y=function(){function t(){}return t.BG=[["Bg0_0","Bg1_0","Bg2_0"],["Bg0_0","Bg1_0","Bg2_0"]],t.ROAD_LINE=[["line","RoadLine0_1","RoadLine1_4","RoadLine0_3","RoadLine0_4","Plank0","line","line_alum","RoadLine0_8","LineSpike0","UnLine0","UnLine1","line_alum","CandyGround","RoadLine0_Bg"]],t.PILLAR_LINE=[["RoadPillar0_0","CandyPillar","line_alum"]],t.ROAD_TILE=["RoadTile0","RoadTile0","RoadTile0"],t.ROAD_SHAPE=[["RoadTile0_1","RoadTile1_1","RoadTile0","UnTile0","UnTile1","UnTile2","RoadTile0_Bg"],["RoadTile0_1","RoadTile1_1","RoadTile0","UnTile0","UnTile1","UnTile2","RoadTile0_Bg"],["RoadTile0_1","RoadTile1_1","RoadTile0","UnTile0","UnTile1","UnTile2","RoadTile0_Bg"]],t.DECORS=[["Dec13","Dec14","Dec15","Dec16","Dec36","Dec37","Dec38","Dec40","Dec41","Dec42","Dec50","Dec51","Dec52","Dec53","Dec54","Dec55","Dec56","Dec57","Dec58","Dec59","Dec60","Sign1","Sign2","Sign15","Sign21","SignPillar","PillarTop0_0","PillarTop0_1","PillarTop0_2","PillarBot0_0","PillarBot0_1","PillarBot0_2","GlassCrashed0_0","GlassCrashed0_1","GlassCrashed0_2","GlassCrashed0_3","GlassCrashed0_4","GlassCrashed0_5","BoostAnim","RocketAnim","Pivot0","particle_boost","GeyserBase","geyser_anim","PlankCandy0","PlankCandy1"]],t.OBJECTS=[["Tnt1","BarrelE","SpikesE","Removed0","Removed1","Plank0","GlassCrashed0","GlassCrashed1","BoostE","PlankWipe0","RemovedWipe0","SphereE"]],t.FRAMES_ANCHORX=[.48,null,.453,null,.526],t.FRAMES_ANCHORY=[.65,null,.647,null,.596],t.SUSPEND_BACK_ANCHORX=[.05,null,.114,null,-.125],t.SUSPEND_BACK_ANCHORY=[.5,null,.417,null,.5625],t.SUSPEND_FRONT_ANCHORX=[.8,null,.808,null,.836],t.SUSPEND_FRONT_ANCHORY=[.2,null,.333,null,.625],t.HEAD_ANCHORX=[.5,null,.395,null,.486],t.HEAD_ANCHORY=[.5,null,.519,null,.606],t.HIP_ANCHORX=[.5,null,.545,null,.5],t.HIP_ANCHORY=[.5,null,.583,null,.454],t.SHIN_ANCHORX=[.5,null,.4,null,.35],t.SHIN_ANCHORY=[.5,null,.5,null,.5],t.WHEELS=[["Wheel_1_0"],["Wheel_1_0"],["Wheel_3_0"],["Wheel_3_0"],["Wheel_5_0"]],t}();e.AssetsList=y;var g=function(){function t(){this.storage={}}return t.prototype.getByKey=function(t){return this.storage[t]},t.prototype.add=function(t,e){this.storage[t]=e},t.prototype.dispose=function(){for(var t in this.storage)this.storage[t]&&(this.storage[t]=null)},Object.defineProperty(t,"instance",{get:function(){return null===t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.currentAatlass=c.Atlases.Theme0,t._instance=null,t}();e.AssetsStorage=g;var m=function(t){function e(e){var i=t.call(this,e)||this;return i.gamePadLayer=null,i.bg=new r(i.game),i.bg.interactive=!1,i.bg.scale.set(2),i.race=new r(i.game),i.race.interactive=!1,i.landscapeShapes=new r(i.game,i.race),i.landscape=new r(i.game,i.race),i.objects=new r(i.game,i.race),i.front=new r(i.game,i.race),i.gui=new r(i.game),i.raceCamera=new n.RaceCamera,i.raceCamera.setup(i.race,o.default.GAME_W,o.default.GAME_H,d.MaxGameCore.instance),i.gamePadLayer=i.game.add.group(),u.default.instance.init(i.gamePadLayer,i.game),i}return s(e,t),e.prototype.start=function(){t.prototype.start.call(this),this.game.world.addChild(this.bg),this.game.world.addChild(this.race),this.game.world.addChild(this.gui),this.game.world.addChild(this.gamePadLayer),this.raceCamera.setup(this.race,o.default.GAME_W,o.default.GAME_H,d.MaxGameCore.instance)},e.prototype.add=function(t){t.type===a.ObjectTypes.BG?this.bg.addChild(t.graphic):t.type===a.ObjectTypes.LANDSCAPE?this.landscape.addChild(t.graphic):t.type===a.ObjectTypes.LANDSCAPE_SHAPE?this.landscapeShapes.addChild(t.graphic):t.type===a.ObjectTypes.LANDSCAPE_BACK?this.landscape.addChildAt(t.graphic,0):t.type===a.ObjectTypes.CAR?this.objects.addChild(t.graphic):t.type===a.ObjectTypes.OBJECT?this.objects.addChild(t.graphic):t.type===a.ObjectTypes.BULLET?this.objects.addChild(t.graphic):t.type===a.ObjectTypes.EFFECT?this.front.addChild(t.graphic):t.type===a.ObjectTypes.CAR_PART?this.front.addChildAt(t.graphic,0):t.type===a.ObjectTypes.FRONT&&this.front.addChild(t.graphic)},e.prototype.update=function(e,i,s,o){if(t.prototype.update.call(this,e,i,s,o),s){var a=n.RacesData.TARGET_X,r=n.RacesData.TARGET_Y;n.CameraZone.focusedOnPoint?this.raceCamera.focusOnPoint(a,r):n.CameraZone.current?this.raceCamera.focusOnCameraZone(a,r):this.raceCamera.focusOnCar(a,r,e)}},e.prototype.release=function(){this.raceCamera.release(),this.raceCamera=null,this.car=null,this.bg=null,this.landscape=null,this.landscapeShapes=null,this.objects=null,this.front=null,this.gui=null},e}(n.GameView);e.MaxGameView=m;var v=function(){function t(){this.complete=new h.Signal}return Object.defineProperty(t,"instance",{get:function(){return null===t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.theme=0;var t=null,e=0,i="",s=g.instance,o=y.BG[this.theme];for(s.add("Bg0",o[0]),o[2]&&s.add("Bg2",o[2]),t=y.ROAD_LINE[this.theme],e=0;e<t.length;e++)i=t[e],s.add("road_line"+e.toString(),i);for(t=y.PILLAR_LINE[this.theme],e=0;e<t.length;e++)i=t[e],s.add("pillar_line"+e.toString(),i);for(i=y.ROAD_TILE[this.theme],s.add("road_tile",i),t=y.ROAD_SHAPE[this.theme],e=0;e<t.length;e++)i=t[e],s.add("road"+e.toString(),i);for(t=y.DECORS[this.theme],e=0;e<t.length;e++)i=t[e],s.add(i,i);for(t=y.OBJECTS[this.theme],e=0;e<t.length;e++)i=t[e],this.addObject(i);s.add("smoke_part","smoke_part_anim"),s.add("ground_part","ground_part_anim"),s.add("car_exp_anim","CarExplode"),s.add("cloud_anim","DestCloud"),s.add("SafePointAnim","SafePointAnim"),s.add("Motor0","Motor0"),s.add("Motor1","Motor1"),s.add("glass_exp_anim","GlassExplode"),this.addCar(n.CarsData.params,!1)},t.prototype.addObject=function(t,e){void 0===e&&(e="");var i=t,s=n.CarsData.geomObj[i];return g.instance.add(i+"_data",s),g.instance.add(i,i),s},t.prototype.addCar=function(t,e){var i,s,o=g.instance,a=n.Inventory.instance.skin;n.RacesData.data.skinId=a,i=s=y.WHEELS[a-1][t.wheels],o.getByKey(i+"b")||(o.add(i+"b",s),o.add(i+"f",s)),i="car_wheel"+a.toString(),o.getByKey(i)||o.add(i,s),o.add(s,s),o.add("suspend_back","suspend_back"),o.add("suspend_front","suspend_front"),o.add("Car"+a.toString()+"FrameExploded","Car"+a.toString()+"FrameExploded"),i="bike_"+a.toString()+"_base",o.getByKey(i)||o.add(i,i),i="driver_shin",this.parsePart(i),i="driver_hip",this.parsePart(i),i="driver_corpse",this.parsePart(i),i="driver_arm",this.parsePart(i),i="driver_forearm",this.parsePart(i),i="driver_head",this.parsePart(i),this.complete.dispatch(this)},t.prototype.parsePart=function(t){var e={x:0,y:0,r:0*l.default.TO_RAD,w:1,h:1};return g.instance.add(t,t),e},t.prototype.dispose=function(){this.complete.removeAll()},t._instance=null,t}();e.RaceAssetsLoader=v;var b=function(){function t(t){void 0===t&&(t="bg0000"),this.nameTex="",this._bitmapData=null,this._rect=new Phaser.Rectangle(0,0,1,1),this.nameTex=t+"0000"}return Object.defineProperty(t.prototype,"bitmapData",{get:function(){return this._bitmapData=n.GraphicUtil.game.make.sprite(0,0,n.GraphicUtil.currentAtlass,this.nameTex),this._bitmapData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rect",{get:function(){return this._rect=new Phaser.Rectangle(0,0,this._bitmapData.width,this._bitmapData.height),this._rect},enumerable:!0,configurable:!0}),t}();e.SpriteData=b},function(t,e,i){"use strict";e.__esModule=!0;var s=i(28);e.Images=s.default;var n=i(17);e.Constants=n.default;var o=i(18);e.Atlases=o.default;var a=i(24);e.Sounds=a.default;var r=i(29);e.JSONData=r.default},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(30),o=i(0),a=i(2),r=i(36),h=i(32),l=i(9),c=i(3),u=i(14),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.car=null,e.carBuilder=null,e.paused=!1,e.drive=!1,e.finished=!1,e.playerController=null,e.countdown=0,e.countdownTotal=0,e.timer=0,e.signalFinish=null,e.signalLoaded=null,e.pitchPlaying=!1,e.prevPart=0,e.prevAccel=!1,e.enginePitch=null,e.engineGazNum=0,e.engineGaz=null,e.engineStart=null,e.engineLoop=null,e.gamePadLayer=null,e}return s(e,t),Object.defineProperty(e,"instance",{get:function(){return null===e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.init=function(e){t.prototype.init.call(this,e),this.physics=new o.MaxPhysics,this.signalFinish&&this.signalFinish.removeAll(),this.pitchPlaying=!1,this.prevPart=0,this.engineGazNum=Math.round(3*Math.random()),this.signalFinish=new Phaser.Signal,this.signalLoaded=new Phaser.Signal,this.view=new o.MaxGameView(this.game)},e.prototype.add=function(i){if(null!==i){if(t.prototype.add.call(this,i),i.isActive){var s=e.activatables[i.id];s||(s=[],e.activatables[i.id]=s),s[s.length]=i}i.review&&(i instanceof o.DriverObject||(e.safed[e.safed.length]=i))}},e.prototype.release=function(){for(var i in this.playerController=null,this.playerCar=null,this.car=null,this.finished=!1,this.gamePadLayer=null,e.activatables)e.activatables[i]&&(e.activatables[i]=null);h.CameraPathes.instance.clear(),e.targets.splice(0,e.targets.length),e.safed.splice(0,e.safed.length),this.enginePitch&&this.enginePitch.stop(),this.pitchPlaying=!1,this.prevPart=0,this.enginePitch=null,this.stopAllSounds(),o.Drawing.release(),t.prototype.release.call(this)},e.prototype.stopAllSounds=function(){this.engineGaz&&this.engineGaz.stop(),this.engineGaz=null,this.engineLoop&&this.engineLoop.stop(),this.engineLoop=null,this.engineStart&&this.engineStart.stop(),this.engineStart=null},e.prototype.activate=function(t,i){var s=e.activatables[t.toString()];if(s)for(var n=0;n<s.length;n++){s[n].activate(i)}},e.prototype.start=function(){t.prototype.start.call(this),this.timer=0,this.setMap(o.GameData.currentLevel)},e.prototype.setDelayedMasks=function(){for(var t=0;t<o.GraphicUtil.masks.length;t++){var e=o.GraphicUtil.masks[t];o.GraphicUtil.maskOwners[t].mask=e}o.GraphicUtil.masks=[],o.GraphicUtil.maskOwners=[],this.signalLoaded.dispatch()},e.prototype.calcEngineSound=function(t){if(this.enginePitch){if(this.paused)return void(this.pitchPlaying&&(this.pitchPlaying=!1,this.enginePitch.stop()));var e=this.car.dead?0:.5;u.default.getInstance().sfx||(e=0);var i=t/80;i>1&&(i=1);var s=(.1+.5*(i=this.prevPart+.2*(i-this.prevPart)))*e;s<0?s=0:s>1&&(s=1),this.pitchPlaying?(this.prevPart!==i&&(this.enginePitch.volume=s),this.prevPart=i):(this.enginePitch.play("",0,s,!0),this.pitchPlaying=!0)}},e.prototype.update=function(i){if(!this.playerCar){if(!this.car)return;this.playerCar=this.car}if(this.calcEngineSound(this.playerCar.backWheel.body.angularVel),null!==this.engineStart&&(this.engineStart.isPlaying||null===this.engineLoop&&(this.engineLoop=l.default.getInstance().play(c.Sounds.EngineFon,1,!0))),this.paused)null!==this.engineLoop&&(this.engineLoop.volume=0),null!==this.engineStart&&this.engineStart.isPlaying&&(this.engineStart.volume=0),null!==this.engineGaz&&(this.engineGaz.stop(),this.engineGaz=null);else if(null!==this.engineLoop)if(this.car.dead)this.engineLoop.volume=0,null!==this.engineGaz&&(this.engineGaz.stop(),this.engineGaz=null);else{if(this.engineLoop.volume=u.default.getInstance().sfx?1:0,null!==this.engineGaz&&(this.engineGaz.volume=u.default.getInstance().sfx?1:0),!this.prevAccel&&this.car.accell){null!==this.engineGaz&&(this.engineGaz.stop(),this.engineGaz=null),this.engineGazNum++,5===this.engineGazNum&&(this.engineGazNum=1);var s="accel0"+this.engineGazNum;this.engineGaz=l.default.getInstance().play(s)}this.prevAccel=this.car.accell}this.paused||(o.RacesData.data.delayForMaks>0&&(o.RacesData.data.delayForMaks-=i,o.RacesData.data.delayForMaks<=0&&e.instance.setDelayedMasks()),this.updateIternal(i),t.prototype.update.call(this,i),this.view.update(this.car.speed,0,!0,i),this.car.frame.graphic.update2(i))},e.prototype.processFinish=function(){this.finished||(this.finished=!0,this.signalFinish.dispatch(1),l.default.getInstance().play(c.Sounds.Finish))},e.prototype.updateIternal=function(t){this.paused?r.default.instance.hideTimer():this.drive?(this.timer+=t,r.default.instance.showTimer()):(this.playerCar.accell||0!==this.playerCar.tilt)&&(this.drive=!0,r.default.instance.hideControlsHint()),this.playerCar.finished||(o.RacesData.TARGET_X=this.playerCar.x,o.RacesData.TARGET_Y=this.playerCar.y)},e.prototype.setMap=function(t){t.id=o.GameData.raceId,o.RacesData.map=t,this.prepareAssets()},e.prototype.prepareAssets=function(){a.RaceAssetsLoader.instance.complete.add(this.assetsReady,this),a.RaceAssetsLoader.instance.start()},e.prototype.assetsReady=function(t){void 0===t&&(t=null),t&&t.dispose(),o.RacesData.data.assetsReady=!0,this.buildLevel()},e.prototype.buildLevel=function(){o.RacesData.data.restart();var t=new o.RaceBuilder;t.complete.add(this.buildReady,this),t.start()},e.prototype.buildReady=function(t){void 0===t&&(t=null),t&&t.dispose(),this.createCars()},e.prototype.createCars=function(){this.carBuilder||(this.carBuilder=new o.CarBuilder),this.carBuilder.complete.add(this.carsReady,this),this.carBuilder.createAllCars()},e.prototype.carsReady=function(){null!=this.carBuilder&&this.carBuilder.dispose(),this.carBuilder=null,o.RacesData.data.camera=e.instance.view.raceCamera},e.prototype.getSpace=function(){return n.NapePhysics.space},e.prototype.restartFromSafePoint=function(t){for(var i=0;i<e.safed.length;i++)e.safed[i].review()},e.prototype.initialDeactivate=function(){for(var t in e.activatables)if(e.activatables[t])for(var i=e.activatables[t],s=0;s<i.length;s++){var n=i[s];n&&(n.isActive||n.activate(!1))}},e._instance=null,e.activatables={},e.safed=[],e.targets=[],e}(o.GameCore);e.MaxGameCore=d},function(t,e,i){"use strict";e.__esModule=!0;var s=i(40),n=i(11),o=i(0),a=i(6),r=i(3),h=i(2),l=i(16),c=function(){function t(){}return t.createGround=function(e,i,o,a,r,c,u){var d=t.game.add.group();d.x=e,d.y=i;var p=t.game.add.graphics(0,0);d.addChild(p);if(r&&h.AssetsStorage.instance.getByKey("road_tile")){var f=o[0],y=new n.Point(115e3,115e3);p.beginFill(16711935,.5),p.moveTo(f.x,c+l.default.GAME_H);for(var g=o.length,m=0;m<g;m++)o[m].x<y.x&&(y.x=o[m].x),o[m].y<y.y&&(y.y=o[m].y),f=o[m],p.lineTo(f.x,f.y);p.lineTo(f.x,c+l.default.GAME_H),p.endFill();var v=this.game.add.tileSprite(y.x,y.y,p.width,p.height,t.currentAtlass,100===u?"finish0000":"tile0000");d.add(v),v.tilePosition.x=-e%256,v.tilePosition.y=-i%256,d.addChild(p),t.masks.push(p),t.maskOwners.push(v)}if(a){var b=null;0===u?b="line":1===u?b=h.RaceAssetsLoader.instance.theme>0?"line_top":"line_wood_g":2===u?b="line_bg":3===u?b="line_metal_g":13==u&&(b="CandyGround"),b&&("line"===b||b.indexOf("line_top"),s.Drawing.drawBitmapPath(b,d,o))}return d},t.createCarFrameGraphic=function(t,e){return new o.FrameGraphic(t,e)},t.createCarWheelGraphic=function(t,e,i){return new o.WheelGraphic(t,i)},t.createImageWithObj=function(e,i){return null===i?null:((s=t.game.add.sprite(0,0,t.currentAtlass,i+"0000")).anchor.set(.5),e&&(s.position.set(e.x,e.y),s.rotation=a.default.TO_RAD*e.rotation),s);var s},t.createMovieClip=function(e,i,s,n,o){return void 0===s&&(s=12),void 0===n&&(n=!0),void 0===o&&(o=!1),null===i?null:("RocketAnim"==i?((h=t.game.add.sprite(0,0,r.Atlases.Cars,"RocketAnim0000")).animations.add("RocketAnim",Phaser.Animation.generateFrameNames("RocketAnim",0,5,"",4)),h.anchor.set(1,.5),h.animations.getAnimation("RocketAnim").play(30),h.animations.getAnimation("RocketAnim").stop()):"BoostAnim"==i?((h=t.game.add.sprite(0,0,t.currentAtlass,"boost_anim0000")).animations.add("boost_anim",Phaser.Animation.generateFrameNames("boost_anim",0,9,"",4)),h.anchor.set(.5),h.animations.getAnimation("boost_anim").play(30),h.animations.getAnimation("boost_anim").stop()):"SafePointAnim"===i||"CarExplode"===i?((h=t.game.add.sprite(0,0,t.currentAtlass,"bg0000")).animations.add(i,Phaser.Animation.generateFrameNames(i,0,28,"",4)),h.anchor.set(.5),h.animations.getAnimation(i).play(30),h.animations.getAnimation(i).stop()):"CarExplode"===i?((h=t.game.add.sprite(0,0,r.Atlases.Cars,i+"0000")).animations.add(i,Phaser.Animation.generateFrameNames(i,0,28,"",4)),h.anchor.set(.5),h.animations.getAnimation(i).play(30),h.animations.getAnimation(i).stop()):(h=t.game.add.sprite(0,0,t.currentAtlass,"bg0000")).scale.set(.4),e&&(h.position.set(e.x,e.y),h.rotation=a.default.TO_RAD*e.rotation),h);var h},t.createImage=function(e,i,s,n){if(null===n)return null;var l,c=n+"",u=o.Inventory.instance.skin;return 0===c.indexOf("driver")||0===c.indexOf("suspend")?(l=t.game.add.sprite(0,0,r.Atlases.Cars,c+u+"0000"),0===c.indexOf("suspend")?-1!==c.indexOf("back")?l.anchor.set(h.AssetsList.SUSPEND_BACK_ANCHORX[u-1],h.AssetsList.SUSPEND_BACK_ANCHORY[u-1]):l.anchor.set(h.AssetsList.SUSPEND_FRONT_ANCHORX[u-1],h.AssetsList.SUSPEND_FRONT_ANCHORY[u-1]):"driver_head"===c?l.anchor.set(h.AssetsList.HEAD_ANCHORX[u-1],h.AssetsList.HEAD_ANCHORY[u-1]):"driver_hip"===c?l.anchor.set(h.AssetsList.HIP_ANCHORX[u-1],h.AssetsList.HIP_ANCHORY[u-1]):"driver_shin"===c?l.anchor.set(h.AssetsList.SHIN_ANCHORX[u-1],h.AssetsList.SHIN_ANCHORY[u-1]):l.anchor.set(.5)):-1!==c.indexOf("FrameExploded")?(l=t.game.add.sprite(0,0,r.Atlases.Cars,c+"0000")).anchor.set(h.AssetsList.FRAMES_ANCHORX[u-1],h.AssetsList.FRAMES_ANCHORY[u-1]):(l=t.game.add.sprite(0,0,t.currentAtlass,c+"0000")).scale.set(.4),l.rotation=s*a.default.TO_RAD,l},t.createLandscapeShape=function(e,i,r,h){var l=new o.LandscapeShape(e,i,r),c=null,u=e.params.layer;h?c="finish":(c="RoadTile0_1",1===u?c="tile_bg":2===u?c="tile":3===u?c="tile_red_pool":4===u?c="tile_rivet":5===u?c="tile_shape_bg":6===u?c="tile_stone":7==u?c="tile_water_bg":8==u?c="tile_red_pool":9==u&&(c="tile_red_pool"));var d,p=e.params.vertices,f=0,y=16,g=null;0===u?g="RoadLine0_4":1===u?(c="tile_bg",g="RoadLine0_Bg"):2===u?!0===e.params.line&&(g="line"):3===u?(g="line_spike",f=2):4===u?g="line_rivet":5===u?(g="line_shape_bg",y=8):6===u?(g="line_stone_shape",y=8):8===u?(g="line_red_pool",y=8):9===u&&(g="line_spike",f=2);var m=p[0],v=p.length,b=0,x=0,_=0,w=!1;if(4==v)for(w=!0,b=0;b<v;b++){m=p[b];var P;P=0==b?p[v-1]:p[b-1];var C=Math.abs(m.x-P.x),T=Math.abs(m.y-P.y);x<C&&(x=C),_<T&&(_=T),C<10||T<10||(w=!1)}var S,A=null,E=null;if(0===f&&!0===e.params.line&&g){A=[],E=[];for(var I=!1,M=0;M<v;M++){var O=p[M],R=void 0,B=void 0;0==M?(R=new n.Point(p[v-1].x-O.x,p[v-1].y-O.y),B=new n.Point(p[M+1].x-O.x,p[M+1].y-O.y)):M===v-1?(R=new n.Point(p[M-1].x-O.x,p[M-1].y-O.y),B=new n.Point(p[0].x-O.x,p[0].y-O.y)):(R=new n.Point(p[M-1].x-O.x,p[M-1].y-O.y),B=new n.Point(p[M+1].x-O.x,p[M+1].y-O.y));var L=Math.atan2(R.y,R.x),D=Math.atan2(B.y,B.x),k=a.default.normalizeAngle2(L-D),F=.52*Math.PI;if(Math.abs(k)<F){R.setMagnitude(y),B.setMagnitude(y);var G=new n.Point(R.x+O.x,R.y+O.y),U=new n.Point(B.x+O.x,B.y+O.y);E.push(G),E.push(U),w?(A.push(new n.Point(.5*(G.x+U.x),.5*(G.y+U.y))),I=!0):(A.push(G),A.push(U))}else E.push(O),A.push(O)}if(I){x=0,_=0;for(var N=0;N<A.length;N++){var j=N<A.length-1?N+1:0,W=A[N],X=A[j],H=Math.abs(W.x-X.x);H>x&&(x=H);var V=Math.abs(W.y-X.y);V>_&&(_=V)}}}w||((S=new n.Graphics(this.game,0,0)).beginFill(16776960,.5),l.addChildAt(S,0));var Y=new n.Point(115e3,115e3),q=2===f,z=0,K=0,J=0,Z=!1;for(null!=A&&(v=A.length,Z=!0),b=0;b<v;b++){if(m=Z?A[b]:p[b],q)if(0===z)z=a.default.dist(m.x,m.y,0,0),(K=Math.atan2(m.y,m.x))<0&&(K+=2*Math.PI);else{var Q=a.default.dist(m.x,m.y,0,0);if(Math.abs(z-Q)<10){var $=Math.atan2(m.y,m.x);$<0&&($+=2*Math.PI),$>K?(K=$,0===J&&(J=Z?a.default.dist(m.x,m.y,A[b-1].x,A[b-1].y):a.default.dist(m.x,m.y,p[b-1].x,p[b-1].y))):q=!1}else q=!1}m.x+i<Y.x&&(Y.x=m.x+i),m.y+r<Y.y&&(Y.y=m.y+r),null!=S&&(0==b?S.moveTo(m.x+i,m.y+r):S.lineTo(m.x+i,m.y+r))}null!=S&&(S.endFill(),x=S.width,_=S.height);var tt=this.game.add.tileSprite(Y.x,Y.y,x,_,t.currentAtlass,c+"0000");if(tt.tilePosition.x=-(l.x+Y.x)%128,tt.tilePosition.y=-(l.y+Y.y)%128,l.addChildAt(tt,0),w||(t.masks.push(S),t.maskOwners.push(tt)),!0===e.params.line&&g)if(q)s.Drawing.drawBitmapPath2StretchCircle(g,l,J,z);else{var et=new Array;if(0===f)if(null==E){(Math.abs(p[0].x-p[p.length-1].x)>4||Math.abs(p[0].y-p[p.length-1].y)>4)&&(d=new n.Point(.5*(p[0].x+p[p.length-1].x)+i,.5*(p[0].y+p[p.length-1].y)+r),et[0]=d);for(var it=0;it<p.length;it++)et.push(new n.Point(p[it].x+i,p[it].y+r))}else{(Math.abs(E[0].x-E[E.length-1].x)>4||Math.abs(E[0].y-E[E.length-1].y)>4)&&(d=new n.Point(.5*(E[0].x+E[E.length-1].x)+i,.5*(E[0].y+E[E.length-1].y)+r),et[0]=d);for(var st=0;st<E.length;st++)et.push(new n.Point(E[st].x+i,E[st].y+r))}else{et[0]=new n.Point(p[p.length-1].x+i,p[p.length-1].y+r);for(var nt=0;nt<p.length;nt++)et.push(new n.Point(p[nt].x+i,p[nt].y+r))}d&&(et[et.length]=d),2===f?s.Drawing.drawBitmapPath2(g,l,et):1===f?s.Drawing.drawBitmapPath2Stretch(g,l,et):s.Drawing.drawBitmapPath(g,l,et)}return l},t.game=null,t.currentAtlass=r.Atlases.Theme0,t.masks=[],t.maskOwners=[],t}();e.GraphicUtil=c},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.normalizeAngle=function(t){return t>Math.PI?t-=2*Math.PI:t<-Math.PI&&(t+=2*Math.PI),t},t.normalizeAngle2=function(t){return(t%=2*Math.PI)>Math.PI?t-=2*Math.PI:t<-Math.PI&&(t+=2*Math.PI),t},t.normalizeVertices=function(e){var i={};i.className=e.className,i.params={},i.params.vertices=[];var s=e.params,n=s.x,o=s.y;for(var a in s)"vertices"!==a&&(i.params[a]=s[a]);for(var r=t.TO_RAD*s.rotation,h=s.vertices,l=i.params.vertices,c=h.length,u=0;u<c;u++){var d=Math.round(h[u].x),p=Math.round(h[u].y);if(l[u]={},0===d&&0===p)l[u].x=n,l[u].y=o;else{var f=void 0;f=Math.atan2(p,d);var y=Math.sqrt(d*d+p*p);f+=r,l[u].x=n+Math.cos(f)*y,l[u].y=o+Math.sin(f)*y}}return i.params.x=0,i.params.y=0,i.params.rotation=0,i},t.dist=function(t,e,i,s){return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s))},t.TO_RAD=Math.PI/180,t.TO_DEG=180/Math.PI,t.PIdiv2=Math.PI/0,t.PIdiv4=Math.PI/4,t.PIdiv4mul3=3*Math.PI/4,t}();e.default=s;var n=function(){function t(){}return t.rand=function(t,e){return t-.5*e+e*Math.random()},t}();e.MyRand=n;var o=function(){function t(){}return t.formatPrice=function(e,i){void 0===i&&(i="$ ");for(var s=0;e>=1e3;)e/=1e3,++s;return i+e.toString()+t.RANKS[s]+t.PRICE_POSTFIX},t.formatTime=function(t){var e=t/60>>0,i=e.toString();e<10&&(i="0"+i);var s=(e=(t-=60*e)>>0).toString();return e<10&&(s="0"+s),i+":"+s},t.PRICE_POSTFIX="",t.RANKS=["","k","m","omg","wtf"],t}();e.UiStrUtil=o},function(t,e,i){"use strict";e.__esModule=!0;var s=nape.dynamics.InteractionFilter,n=function(){function t(){}return t.NOTHING=new s(0,0,0,0,0,0),t.SENSOR=new s(0,0,1,4369),t.SENS_ONLY_PLAYER=new s(0,0,1,4368),t.TOGGLE=new s(0,0,1,4369),t.WITH_EARTH_ONLY=new s(1,4369,0,0),t.WHEEL=new s(4096,272,17,4369),t.DRIVER_PART=new s(4096,272),t.BODY_COLLIDER=new s(4096,272,17,4369),t.GROUND=new s(17,4369,1,4369),t.PLAYER_ONLY=new s(256,4096,1,4369),t.WATER=new s(0,0,1,4369),t}();e.Filters=n},function(t,e,i){"use strict";e.__esModule=!0;var s=nape.phys.Material,n=function(){function t(){}return t.DEFAULT=new s,t.GROUND=new s,t.WIEGHTLESS=new s(0,1,2,.001),t.TUMBEWEED=new s(0,1,2,.5),t.GBARREL=new s(0,1,2,.5),t}();e.Materials=n},function(t,e,i){"use strict";e.__esModule=!0;var s=i(14),n=function(){function t(t){this.music=null,this.audioInstances={},this.sound=t.sound}return t.getInstance=function(e){if(null===t.instance){if(!e)throw new Error("Cant create a new instance without a game");t.instance=new t(e)}return t.instance},t.prototype.play=function(t,e,i){return void 0===e&&(e=1),void 0===i&&(i=!1),this.audioInstances.hasOwnProperty(t)||(this.audioInstances[t]=this.sound.add(t)),s.default.getInstance().sfx?(this.audioInstances[t].play(void 0,void 0,e,i,!0),this.audioInstances[t]):this.audioInstances[t].play(void 0,void 0,0,i,!0)},t.prototype.isPlaying=function(t){return!!this.audioInstances.hasOwnProperty(t)&&this.audioInstances[t].isPlaying},t.prototype.stop=function(t){this.audioInstances.hasOwnProperty(t)&&this.audioInstances[t].stop()},t.prototype.playMusic=function(t){if(!s.default.getInstance().music)return this.music=this.sound.play(t,.5,!0),void this.music.stop();null!==this.music&&this.music.name===t||(null!==this.music&&this.music.name!==t&&this.music.stop(),this.music=this.sound.play(t,.5,!0))},t.prototype.fadeMusicVolume=function(t,e){this.music&&this.music.fadeTo(t,e)},t.prototype.stopMusic=function(){null!==this.music&&this.music.isPlaying&&this.music.stop()},t.prototype.toggleSfx=function(){s.default.getInstance().sfx=!s.default.getInstance().sfx},t.prototype.toggleMusic=function(){s.default.getInstance().music=!s.default.getInstance().music,s.default.getInstance().music?this.music&&this.music.play(void 0,void 0,1,!0):this.music&&this.music.isPlaying&&this.stopMusic()},t.instance=null,t}();e.default=n},function(t,e,i){"use strict";e.__esModule=!0;var s=nape.callbacks.CbType,n=function(){function t(){}return t.WHEEL=new s,t.BODY_COLLIDER=new s,t.ZONE_FINISH=new s,t.COIN=new s,t.DESTOYED=new s,t.TOGGLE=new s,t.TOGGLE_OFF=new s,t.GROUND=new s,t.DRIVER=new s,t.DRIVER_PART=new s,t.SAFE_POINT=new s,t.SPIKES=new s,t.SAW=new s,t.BARREL=new s,t.WOOD=new s,t.WATER=new s,t.GLASS=new s,t.BOOST=new s,t.GEYSER=new s,t}();e.CbTypes=n},function(t,e,i){(function(e){t.exports=e.Phaser=i(58)}).call(e,i(27))},function(t,e,i){(function(e){t.exports=e.PIXI=i(57)}).call(e,i(27))},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0,i(12),i(11);var n=i(21),o=function(t){function e(e,i,s,o,a,r){void 0===r&&(r=null);var h=t.call(this,e)||this;return h._enable=!0,h._graphics=null,h._texts=null,h.inputEnableChildren=!0,h._graphics=h.game.add.group(h),h._texts=h.game.add.group(h),h.btn=h.game.add.button(0,0,r,o,a),h.btn.anchor.set(.5),h._graphics.addChild(h.btn),h.label=new n.default(h.game,0,2,i,s,70,40),h.label.anchor.set(.5),h._texts.addChild(h.label),null!==o&&null!==a&&h.label.events.onInputDown.add(o,a),h.game.add.existing(h),h}return s(e,t),e.prototype.setText=function(t){this.label.setText(t)},e.prototype.setFrames=function(t,e,i,s){this.btn.setFrames(t,e,i,s)},e.prototype.destroy=function(e){this.id=null,this.label=null,this.btn=null,this._graphics=null,this._texts=null,t.prototype.destroy.call(this,e)},Object.defineProperty(e.prototype,"enable",{get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.btn.inputEnabled=this._enable,this._enable?(this.btn.tint=16777215,this.label.tint=16777215):(this.btn.tint=10066329,this.label.tint=10066329))},enumerable:!0,configurable:!0}),e}(Phaser.Group);e.default=o},function(t,e,i){"use strict";e.__esModule=!0;var s=i(3),n=i(0),o=i(23),a=function(){function t(t,e,i){this.musicOn=!0,this.sfxOn=!0,this.carSaves={},this.game=t,this.callback=e,this.callbackContext=i;var n=o.default.api.localStorage.getItem(s.Constants.STORAGE_KEY);null==n?(this.initFirstSave(),this.callback&&this.callbackContext&&this.callback.call(this.callbackContext)):this.restore()}return t.prototype.initFirstSave=function(){this.sfxOn=!0,this.musicOn=!0,n.Inventory.instance.init(),this.save()},t.getInstance=function(e,i,s){return t.instance?s&&i.call(s):t.instance=new t(e,i,s),t.instance},Object.defineProperty(t.prototype,"music",{get:function(){return this.musicOn},set:function(t){this.musicOn=t,this.save()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sfx",{get:function(){return this.sfxOn},set:function(t){this.sfxOn=t,this.save()},enumerable:!0,configurable:!0}),t.prototype.save=function(){var t=JSON.stringify({m:this.musicOn,sf:this.sfxOn,invsav:n.Inventory.instance.save}),e=this.hash(t);o.default.api.localStorage.setItem(s.Constants.STORAGE_KEY,t),o.default.api.localStorage.setItem(s.Constants.STORAGE_KEY+"h",e)},t.prototype.restore=function(){var t,e,i=this,a=o.default.api.localStorage.getItem(s.Constants.STORAGE_KEY),r=o.default.api.localStorage.getItem(s.Constants.STORAGE_KEY+"h");Promise.all([a,r]).then(function(s){if(t=s[0]||"",e=s[1]||"0",""===t)return i.initFirstSave(),void(i.callback&&i.callbackContext&&i.callback.call(i.callbackContext));if(e!==i.hash(t))return i.initFirstSave(),void(i.callback&&i.callbackContext&&i.callback.call(i.callbackContext));if(t&&""!==t)try{var o=JSON.parse(t);i.musicOn=o.m,i.sfxOn=o.sf,n.Inventory.instance.save=o.invsav}catch(s){i.initFirstSave()}else i.initFirstSave();i.callback&&i.callbackContext&&i.callback.call(i.callbackContext)})},t.prototype.hash=function(t){var e,i,s=0;if(0===t.length)return s.toString();for(e=0,i=t.length;e<i;e++)s=(s<<5)-s+t.charCodeAt(e),s|=0;return s.toString()},t}();e.default=a},function(t,e,i){"use strict";e.__esModule=!0;var s=i(6),n=nape.constraint.PivotJoint,o=nape.geom.GeomPoly,a=nape.geom.GeomPolyList,r=nape.geom.Vec2,h=nape.phys.Body,l=nape.phys.BodyList,c=nape.phys.BodyType,u=nape.shape.Circle,d=nape.shape.Polygon,p=function(){function t(){}return t.disposeBody=function(e){t.clearUserData(e),e.cbTypes.clear(),e.compound?e.compound=null:e.space=null},t.stopBody=function(t,e){void 0===e&&(e=!0),t.type===c.DYNAMIC&&(t.torque=0),t.velocity.x=0,t.velocity.y=0,t.angularVel=0,e||(t.allowMovement=t.allowRotation=e)},t.setupStartPos=function(t){t.userData.sx=t.position.x,t.userData.sy=t.position.y,t.userData.sr=t.rotation},t.resetStartPos=function(t){t.position.x=t.userData.sx,t.position.y=t.userData.sy,t.rotation=t.userData.sr},t.clearUserData=function(t){for(var e in t.userData)t.userData.hasOwnProperty(e)&&(t.userData[e]=null)},t.createRectBody=function(e,i,n,o,a,r){void 0===a&&(a=null),void 0===r&&(r=null);var h=new d(d.box(o.width,o.height,!0),r,i);h.sensorEnabled=n;var l=t.createBody(e,o.x,o.y,s.default.TO_RAD*o.rotation,a);return l.shapes.add(h),l},t.createRectBodyWH=function(e,i,s,n,o,a,r,h,l,c){void 0===a&&(a=0),void 0===r&&(r=0),void 0===h&&(h=0),void 0===l&&(l=null),void 0===c&&(c=null);var u=new d(d.box(n,o,!0),c,i);u.sensorEnabled=s;var p=t.createBody(e,a,r,h,l);return p.shapes.add(u),p},t.createRegularBody=function(e,i,s,n,o,a,r,h,l,c,u){void 0===r&&(r=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===c&&(c=null),void 0===u&&(u=null);var p=new d(d.regular(.5*n,.5*o,a,0,!0),u,i);p.sensorEnabled=s;var f=t.createBody(e,r,h,l,c);return f.shapes.add(p),f},t.createBody=function(t,e,i,s,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=null);var o=new h(t,r.weak(e,i));return o.rotation=s,null!=n&&o.cbTypes.add(n),o},t.createCircleBody=function(e,i,s,n,o,a,r,h,l){void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),void 0===h&&(h=null),void 0===l&&(l=null);var c=new u(n,null,l,i);c.sensorEnabled=s;var d=t.createBody(e,o,a,r,h);return null!=h&&d.cbTypes.add(h),d.shapes.add(c),d},t.bodiesInCircle=function(e,i,s,n,o){return void 0===n&&(n=!1),void 0===o&&(o=null),t.bodyList.clear(),e.bodiesInCircle(i,s,n,o,t.bodyList),t.bodyList},t.bodiesUnderPoint=function(e,i,s){return void 0===s&&(s=null),t.bodyList.clear(),e.bodiesUnderPoint(i,s,t.bodyList),t.bodyList},t.createPolyBody=function(e,i,s,n){var a,l;e instanceof Array?(l=e,a=new h(n)):(l=e.vertices,a=new h(n,r.weak(e.x,e.y)));for(var c=l.length,u=[],p=0;p<c;p++)u[p]=r.get(l[p].x,l[p].y);var f=new o(u);if(f.isConvex())a.shapes.add(new d(f,i,s)),f.dispose();else for(f.convexDecomposition(!1,t.geomPolyList),f.dispose();!t.geomPolyList.empty();)f=t.geomPolyList.pop(),a.shapes.add(new d(f,i,s)),f.dispose();return a},t.createPivot=function(t,e,i){return new n(t,e,t.worldPointToLocal(i,!0),e.worldPointToLocal(i,!0))},t.disposeJoint=function(t){t.active=!1,t.compound&&(t.compound=null),t.space&&(t.space=null),t.space=null,t.body1=null,t.body2=null},t.createPatherBody=function(t,e,i,s){(e=e.copy()).density=t.params.density;var n,a,l=new h(t.params.isStatic?c.STATIC:c.DYNAMIC,r.weak(t.params.x,t.params.y)),u=[r.get(),r.get(),r.get(),r.get()],p=r.get(),f=r.get(),y=t.params.vertices,g=y.length;for(n=0;n<g-1;n++){if(p.setxy(y[n+1].x-y[n].x,y[n+1].y-y[n].y),0===n?(a=p.angle+.5*Math.PI,u[0].x=y[n].x-.5*s*Math.cos(a),u[0].y=y[n].y-.5*s*Math.sin(a),u[1].x=y[n].x+.5*s*Math.cos(a),u[1].y=y[n].y+.5*s*Math.sin(a)):(u[0].x=u[3].x,u[0].y=u[3].y,u[1].x=u[2].x,u[1].y=u[2].y),n===g-2)a=p.angle+.5*Math.PI,u[3].x=y[n+1].x-.5*s*Math.cos(a),u[3].y=y[n+1].y-.5*s*Math.sin(a),u[2].x=y[n+1].x+.5*s*Math.cos(a),u[2].y=y[n+1].y+.5*s*Math.sin(a);else{p.muleq(-1/p.length),f.setxy(y[n+2].x-y[n+1].x,y[n+2].y-y[n+1].y),f.muleq(1/f.length);var m=r.get(p.x+f.x,p.y+f.y);a=m.angle,u[3].x=y[n+1].x-.5*s*Math.cos(a),u[3].y=y[n+1].y-.5*s*Math.sin(a),u[2].x=y[n+1].x+.5*s*Math.cos(a),u[2].y=y[n+1].y+.5*s*Math.sin(a),m.dispose()}if(new o(u).isConvex())new d(u,e,i).body=l;else{var v=u[3];u[3]=u[2],u[2]=v,new d(u,e,i).body=l}}return p.dispose(),f.dispose(),u[0].dispose(),u[1].dispose(),u[2].dispose(),u[3].dispose(),u=null,l.align(),l},t.geomPolyList=new a,t.bodyList=new l,t}();e.NapeUtil=p},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.GAME_W=720,t.GAME_H=480,t.DISPLAY_W=720,t.DISPLAY_H=480,t.CAR_ED_SAVE="mrce",t.ED_SAVE="mre",t.FRONT_FLIP="front_flip",t.BACK_FLIP="back_flip",t.FLIP2="flip2",t.DEATH="death",t.DEATH10="death10",t.IMMORTAL="immortal",t.STAR3="star3",t.STAR25="star25",t.STAR50="star50",t.STAR75="star75",t.MAD_MAX="evel",t.MARTIAN="ninja",t.FIRE_HEAD="ufo",t.ACH_KEYS={front_flip:"5d666019fc04d7987a2a",back_flip:"f1464a11a34859ab2c9c",flip2:"cbee1b928b0c98b5b9d1",death:"152da14de795fcddaab7",death10:"b9a38dafbf599e020094",immortal:"65e17d538092d8c43e0e",star3:"65863075e64b84f5c348",star25:"3e5bdcc3b94051ef2310",star50:"c0412581c1acbe3650df",star75:"10080846ac4f1195e39f",evel:"0a1a7c20fb914e20ea97",ninja:"620eda42d4db8b272639",ufo:"90795a88309ed3985c17"},t.ACH_NAMES={front_flip:"Front Flip",back_flip:"Back Flip",flip2:"Double Flip",death:"First Death",death10:"Suicide Master",immortal:"Immortal",star3:"3 stars",star25:"22 stars",star50:"44 stars",star75:"All stars",evel:"Desert Rider",ninja:"Martian",ufo:"Firehead"},t.ACH_DESCS={front_flip:"Perform front flip",back_flip:"Perform back flip",flip2:"Perform double flip",death:"Die one time",death10:"Die 10 times in one race",immortal:"Complete level without death",star3:"Finish level with 3 stars",star25:"Collect 22 stars",star50:"Collect 44 stars",star75:"Collect 66 stars",evel:"Equip Desert Rider",ninja:"Equip Martian",ufo:"Equip Firehead"},t}();e.default=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.VERSION="5.0.2",t.GAME_SCALE=1,t.CALCULATED_WIDTH=0,t.CALCULATED_HEIGHT=0,t.WIDTH=720,t.HEIGHT=480,t.LANDSCAPE_LOCKED=!0,t.PORTRAIT_LOCKED=!1,t.STORAGE_KEY="mx3m_5_famobi",t.styleMoney={font:"25px Impact",fill:"#DDD9D7"},t.styleBestTime={font:"14px Impact",fill:"#FFFFFF"},t.styleTime={font:"15px Impact",fill:"#DDD9D7"},t.styleTimer={font:"20px Impact",fill:"#DDD9D7"},t.styleHelp={font:"20px Impact",fill:"#FFFFFF"},t.stylePlay={font:"80px CfCrackBold",fill:"#FF8F00"},t.styleTrick={font:"30px CfCrackBold",fill:"#FF8F00"},t.stylePlace={font:"24px CfCrackBold",fill:"#97F337"},t.styleMSGUI={font:"10px Impact",fill:"#FFFFFF"},t.styleGarage={font:"80px CfCrackBold",fill:"#FF8F00"},t.styleGarage2={font:"33px CfCrackBold",fill:"#FFFFFF"},t.stylePopBtn={font:"30px CfCrackBold",fill:"#2C374E"},t.stylePopBtn2={font:"25px CfCrackBold",fill:"#2C374E"},t.styleChooseLevel={font:"36px CfCrackBold",fill:"#FFFFFF"},t.stylePause={font:"40px CfCrackBold",fill:"#FFFFFF"},t.styleFinish={font:"30px CfCrackBold",fill:"#FF8F00"},t.styleFinish1={font:"20px CfCrackBold",fill:"#FFFFFF"},t.styleCredits0={font:"30px CfCrackBold",fill:"#FFFFFF"},t.styleCreditsOK={font:"50px CfCrackBold",fill:"#FF8F00"},t.styleCredits1={font:"18px Impact",fill:"#FFFFFF"},t.styleCredits2={font:"14px Impact",fill:"#FFFFFF"},t.styleVersion={font:15*t.GAME_SCALE+"px Impact",fill:"#FFFFFF"},t}();e.default=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.Garage="garage",t.Cars="cars_game",t.Theme0="theme0",t.preloadList=[t.Cars],t.list=[t.Garage,t.Theme0,t.Cars],t}();e.default=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(3),o=i(20),a=function(t){function e(i,s,a,r){var h=t.call(this,i)||this;h.alpha=0,h.beginFill(s,1),h.drawRect(0,0,h.game.width,h.game.height),h.endFill(),o.default.Name!==a&&(e.prevState=a);var l=h.game.add.text(h.game.width/2,h.game.height/2,"LOADING...",n.Constants.styleCredits0);l.anchor.set(.5),h.addChild(l),i.add.existing(h);var c=h.game.add.tween(h);return c.to({alpha:1},100),c.onComplete.add(function(){i.state.start(a,!0,!1,r)}),c.start(),h}return s(e,t),e.prevState="menu",e}(Phaser.Graphics);e.default=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(13),o=i(18),a=i(17),r=i(22),h=i(26),l=i(9),c=i(24),u=i(14),d=i(38),p=i(19),f=i(34),y=i(42),g=i(0),m=i(2),v=i(21),b=function(t){function e(){var i=t.call(this)||this;return i.name=e.Name,i.changeBike=null,i.priceTxt=null,i.btnLeft=null,i.btnRight=null,i.bike=null,i.parts2=null,i}return s(e,t),e.prototype.init=function(){this.game.world.removeAll(),this.parts2=[],g.GraphicUtil.game=this.game,l.default.getInstance().playMusic(c.default.MenuMusic)},e.prototype.create=function(){t.prototype.create.call(this);var i=this.game.add.sprite(360,240,o.default.Garage,"0popup_bg0000");i.anchor.set(.5);var s=null;this.background=this.game.add.sprite(0,0,o.default.Garage,"bg0000"),(s=this.game.add.sprite(0,0,o.default.Garage,"0bg_garage0000")).alpha=0,this.background.addChild(s),this.background.addChild(i);var r=new n.default(this.game,"BIKE SHOP",a.default.styleGarage,null,null,o.default.Garage);r.setFrames("bg0000","bg0000","bg0000","bg0000"),r.position.set(a.default.WIDTH/2,40),this.background.addChild(r);var l=new n.default(this.game,g.Inventory.instance.getTotalStars()+"",a.default.styleMoney,null,null,o.default.Garage);l.setFrames("w_star0000","w_star0000","w_star0000","w_star0000"),l.position.set(a.default.WIDTH-30,30),l.label.x=-30,this.game.width-a.default.WIDTH>0&&(l.x+=(this.game.width-a.default.WIDTH)/2),this.background.addChild(l),r.label.stroke="#000000",r.label.strokeThickness=4;var c=new v.default(this.game,0,2,"BIKE SHOP",a.default.stylePlay);c.anchor.set(.5),r.label.parent.addChildAt(c,0),c.stroke="#FFFFFF",c.strokeThickness=7,this.playBtn=new n.default(this.game,"",a.default.stylePopBtn2,p.default.prevState===h.default.Name?this.onMenu:this.onPlayDown,this,o.default.Garage),this.playBtn.setFrames("orange_btn0000","orange_btn0000","orange_btn0000","orange_btn0000");var u=this.game.add.sprite(0,-7,o.default.Garage,"next_btn0000");u.anchor.set(.5),u.scale.set(-1,1),this.playBtn.label.parent.addChild(u),this.playBtn.x=10+this.playBtn.width/2,this.playBtn.y=a.default.HEIGHT-10-this.playBtn.height/2,this.btnLeft=new n.default(this.game,"",a.default.styleGarage,this.onPrev,this,o.default.Garage),this.btnLeft.setFrames("arrow_btn0000","arrow_btn0000","arrow_btn0001","arrow_btn0000"),this.btnRight=new n.default(this.game,"",a.default.styleGarage,this.onNext,this,o.default.Garage),this.btnRight.setFrames("arrow_btn0000","arrow_btn0000","arrow_btn0001","arrow_btn0000"),this.btnRight.rotation=Phaser.Math.degToRad(180),this.btnLeft.x=10+this.playBtn.width/2,this.btnRight.x=a.default.WIDTH-10-this.playBtn.width/2,this.btnLeft.y=a.default.HEIGHT/2,this.btnRight.y=a.default.HEIGHT/2,this.game.width-a.default.WIDTH>0&&(this.playBtn.x-=(this.game.width-a.default.WIDTH)/2,this.btnLeft.x-=(this.game.width-a.default.WIDTH)/2,this.btnRight.x+=(this.game.width-a.default.WIDTH)/2),e.currCar=e.carList.indexOf(g.Inventory.instance.skin),f.GameData.carId=e.carList[e.currCar],g.Inventory.instance.skin=e.carList[e.currCar],this.setNewViewCar(),this.background.addChild(this.playBtn),this.background.addChild(this.btnLeft),this.background.addChild(this.btnRight),new d.default(this.game,0,null),this.resize()},e.prototype.getPrice=function(){var t=e.priceList[e.currCar]+"";return"0"===t&&(t="FREE"),t},e.prototype.onPlayerChange=function(){2===e.currCar?this.btnRight.enable=!1:this.btnRight.enable=!0,0===e.currCar?this.btnLeft.enable=!1:this.btnLeft.enable=!0},e.prototype.saveCarId=function(){if(g.Inventory.instance.getTotalStars()>=e.priceList[e.currCar])f.GameData.carId=e.carList[e.currCar],g.Inventory.instance.skin=e.carList[e.currCar],this.setNewViewCar(),u.default.getInstance().save();else{var t=this.game.add.tween(this.priceTxt);t.to({y:this.priceTxt.y-15},150,Phaser.Easing.Bounce.InOut,!1,0,3,!0),t.start()}},e.prototype.onPlayDown=function(){new p.default(this.game,0,r.default.Name)},e.prototype.onMenu=function(){new p.default(this.game,0,h.default.Name)},e.prototype.onNext=function(){e.currCar<2&&e.currCar++,this.setNewViewCar()},e.prototype.parseStaticGraphic=function(t,i){var s=null;(s=this.game.add.image(t[i].x,t[i].y,o.default.Cars,t[i].g+"0000")).angle=t[i].r;var n=e.carList[e.currCar];-1!==i.indexOf("base")?s.anchor.set(m.AssetsList.FRAMES_ANCHORX[n-1],m.AssetsList.FRAMES_ANCHORY[n-1]):-1!==i.indexOf("suspend")?-1!==i.indexOf("front")?s.anchor.set(.8,-1!==t[i].g.indexOf("1")?.2:.5):s.anchor.set(0,.5):"driver_head"===i?s.anchor.set(m.AssetsList.HEAD_ANCHORX[n-1],m.AssetsList.HEAD_ANCHORY[n-1]):"driver_hip"===i?s.anchor.set(m.AssetsList.HIP_ANCHORX[n-1],m.AssetsList.HIP_ANCHORY[n-1]):"driver_shin"===i?s.anchor.set(m.AssetsList.SHIN_ANCHORX[n-1],m.AssetsList.SHIN_ANCHORY[n-1]):s.anchor.set(.5),this.bike.addChild(s)},e.prototype.setNewViewCar=function(){var t=e.carList[e.currCar];null!==this.bike?(this.bike.destroy(),this.bike=this.game.add.group()):this.bike=this.game.add.group();var i,s=y.CarsData.geomObj["bike"+t],r=5===t;i="Wheel0",this.parseStaticGraphic(s,i),i="Wheel1",this.parseStaticGraphic(s,i),i="suspend_back",this.parseStaticGraphic(s,i),r&&(i="suspend_front",this.parseStaticGraphic(s,i)),i="base",this.parseStaticGraphic(s,i),i="driver_shin",this.parseStaticGraphic(s,i),i="driver_hip",this.parseStaticGraphic(s,i),i="driver_corpse",this.parseStaticGraphic(s,i),i="driver_arm",this.parseStaticGraphic(s,i),i="driver_forearm",this.parseStaticGraphic(s,i),i="driver_head",this.parseStaticGraphic(s,i),r||(i="suspend_front",this.parseStaticGraphic(s,i)),this.bike.x=a.default.WIDTH/2,this.bike.y=a.default.HEIGHT/2,this.background.addChild(this.bike),this.changeBike&&this.changeBike.destroy();var h="EQUIPPED";e.carList[e.currCar]!==g.Inventory.instance.skin&&(h="EQUIP IT"),this.changeBike=new n.default(this.game,h,a.default.styleGarage2,this.saveCarId,this,o.default.Garage),this.changeBike.x=a.default.WIDTH/2,this.changeBike.y=a.default.HEIGHT-50,this.changeBike.setFrames("orange_btn_big0000","orange_btn_big0000","orange_btn_big0000","orange_btn_big0000"),this.changeBike.label.setMaxSize(200,40),this.changeBike.label.y=-6,this.changeBike.label.setShadow(1,1,"rgba(0,0,0,0.8)",5),this.priceTxt&&this.priceTxt.destroy(),this.priceTxt=new n.default(this.game,"PRICE:",a.default.styleMoney,null,null,o.default.Garage),this.priceTxt.setFrames("bg0000","bg0000","bg0000","bg0000"),this.priceTxt.label.y=-15;var l=new v.default(this.game,0,15,this.getPrice(),a.default.styleMoney);if("FREE"===this.getPrice())l.anchor.set(.5);else{l.anchor.set(1.05,.5);var c=this.game.add.sprite(0,15,o.default.Garage,"w_star0000");c.anchor.set(.15,.5),this.priceTxt.label.parent.addChild(c)}this.priceTxt.label.parent.addChild(l),this.priceTxt.x=a.default.WIDTH-110,this.game.width-a.default.WIDTH>0&&(this.priceTxt.x+=(this.game.width-a.default.WIDTH)/2),this.priceTxt.y=a.default.HEIGHT-70,this.background.addChild(this.priceTxt),this.background.addChild(this.changeBike),this.onPlayerChange()},e.prototype.update=function(){t.prototype.update.call(this)},e.prototype.onPrev=function(){0!==e.currCar&&e.currCar--,this.setNewViewCar()},e.prototype.shutdown=function(){this.background=null,this.changeBike=null,this.playBtn=null,this.btnLeft=null,this.btnRight=null,this.parts2=null,t.prototype.shutdown.call(this)},e.prototype.resize=function(){t.prototype.resize.call(this);var e=1;e=(e=this.game.width/a.default.WIDTH)>1?1:e,this.background.scale.set(e),this.background.x=(this.game.width-720)/2},e.prevNameState="garage",e.Name="garage",e.pause=!1,e.currCar=0,e.carList=[1,3,5],e.priceList=[0,12,35],e}(Phaser.State);e.default=b},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0,i(12),i(11);var n=function(t){function e(e,i,s,n,o,a,r){var h=t.call(this,e,i,s,n,o)||this;return h.maxWidth=a,h.maxHeight=r,h.game.add.existing(h),h}return s(e,t),e.prototype.setText=function(e){return t.prototype.setText.call(this,e),(this.maxWidth||this.maxHeight)&&this.makeFontFit(),this},e.prototype.setMaxSize=function(t,e){this.maxWidth=t,this.maxHeight=e},e.prototype.makeFontFit=function(){for(var t;this.width>this.maxWidth||this.height>this.maxHeight;){if((t=parseInt(this.fontSize.toString().replace("px",""),10)-1)<10){t=10,this.fontSize=t;break}this.fontSize=t}},e}(Phaser.Text);e.default=n},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(18),o=i(17),a=i(24),r=i(9),h=i(25),l=i(20),c=i(127),u=i(19),d=i(38),p=i(29),f=i(34),y=i(0),g=i(13),m=i(14),v=i(26),b=function(t){function e(){var i=t.call(this)||this;return i.name=e.Name,i}return s(e,t),e.prototype.init=function(){this.game.world.removeAll(),r.default.getInstance().playMusic(a.default.MenuMusic)},e.prototype.create=function(){t.prototype.create.call(this),y.Inventory.instance.signalUnlock.removeAll(),y.Inventory.instance.signalUnlock.addOnce(function(){new u.default(this.game,0,e.Name)},this),this.scaleGroup=this.game.add.group();var i=this.game.add.sprite(0,0,n.default.Garage,"0bg_garage0000"),s=this.game.add.sprite(-30,0,n.default.Garage,"0bg_garage_l0000"),a=this.game.add.sprite(i.width-10,0,n.default.Garage,"0bg_garage_r0000"),r=(this.game.width-720)/2;s.x=-1*r-10,s.width=r+20,a.width=r+20,this.scaleGroup.addChild(s),this.scaleGroup.addChild(a),this.scaleGroup.addChild(i);var h=this.game.add.sprite(0,0,n.default.Garage,"top_bg0000");h.x=this.game.width-h.width,(h=this.game.add.sprite(this.game.width,0,n.default.Garage,"top_bg0000")).x=h.width,h.scale.set(-1,1);var l=new g.default(this.game,"",null,this.onBackDown,this,n.default.Garage);l.setFrames("shop_btn0000","shop_btn0000","shop_btn0000","shop_btn0000"),l.x=45,l.y=30,this.world.addChild(l),this.musicBtn=this.game.add.image(120,25,n.default.Garage,"InGameMusicButton0000"),this.musicBtn.inputEnabled=!0,this.musicBtn.events.onInputUp.add(this.toggleMusic,this),this.musicBtn.anchor.set(.5),this.musicBtn.x=this.game.width-35;var c=new g.default(this.game,y.Inventory.instance.getTotalStars()+"",o.default.styleMoney,null,null,n.default.Garage);c.setFrames("w_star0000","w_star0000","w_star0000","w_star0000"),c.position.set(110,30),c.label.x=20,c.label.anchor.set(0,.5),this.world.addChild(c),this.updateSoundButtons(),this.createButtons();var p=new g.default(this.game,"",o.default.stylePopBtn2,this.onMenu,this,n.default.Garage);p.setFrames("orange_btn0000","orange_btn0000","orange_btn0000","orange_btn0000");var f=this.game.add.sprite(0,-7,n.default.Garage,"next_btn0000");f.anchor.set(.5),f.scale.set(-1,1),p.scale.set(.7),p.label.parent.addChild(f),p.x=10+p.width/2,p.y=o.default.HEIGHT-5-p.height/2,this.game.width-o.default.WIDTH>0&&(p.x-=(this.game.width-o.default.WIDTH)/2),this.scaleGroup.addChild(p),(p=new g.default(this.game,"",o.default.stylePopBtn2,this.onPlayNext,this,n.default.Garage)).setFrames("orange_btn0000","orange_btn0000","orange_btn0000","orange_btn0000"),(f=this.game.add.sprite(0,-7,n.default.Garage,"next_btn0000")).anchor.set(.5),p.scale.set(.7),p.label.parent.addChild(f),p.x=o.default.WIDTH-10-p.width/2,p.y=o.default.HEIGHT-5-p.height/2,this.game.width-o.default.WIDTH>0&&(p.x+=(this.game.width-o.default.WIDTH)/2),this.scaleGroup.addChild(p),new d.default(this.game,0,null),this.resize()},e.prototype.onMenu=function(){new u.default(this.game,0,v.default.Name)},e.prototype.createButtons=function(){for(var t=0;t<22;t++){var e=y.CarsData.geomObj["point"+t].x,i=y.CarsData.geomObj["point"+t].y;this.createButton(t,e,i,0)}},e.prototype.createButton=function(t,e,i,s){void 0===t&&(t=0);var o=t,a=new c.default(this.game,o+""),r="LeveMapItemLocked",h=r+"0000";a.btn.setFrames(h,h,h,h),a.x=e,a.y=i,a.label.visible=!1,o+1<10?a.label.setText("0"+(o+1)):a.label.setText(o+1+"");var l=1;void 0!==y.Inventory.instance.save[y.Inventory.RACE_PREFIX+(o+1).toString()+y.Inventory.RACE_RESULT]&&(l=Number(y.Inventory.instance.save[y.Inventory.RACE_PREFIX+(o+1).toString()+y.Inventory.RACE_RESULT])+2,a.label.visible=!0);var u=this.game.add.sprite(0,0,n.default.Garage,r+"000"+l);u.anchor.set(.5),this.scaleGroup.addChild(a),a.btn.parent.addChild(u),a.label.visible?(a.signalSelect.addOnce(this.onPlayDown,this),this.lastEnabled=a):a.enable=!1},e.prototype.onPlayNext=function(){this.onPlayDown(this.lastEnabled)},e.prototype.onPlayDown=function(t){r.default.getInstance().play(a.default.Click);var i=p.default.list.indexOf(p.default.Level001),s=Number(t.getID());e.LevelNum=s,e.CurrentLevel=p.default.list[i+s],f.GameData.raceId=s+1,f.GameData.currentLevel=this.game.cache.getJSON(e.CurrentLevel),y.GraphicUtil.currentAtlass=n.default.Theme0,new u.default(this.game,0,h.default.Name)},e.prototype.onBackDown=function(){r.default.getInstance().play(a.default.Click),this.game.state.start(l.default.Name)},e.prototype.toggleMusic=function(){m.default.getInstance().music?r.default.getInstance().toggleMusic():m.default.getInstance().sfx?r.default.getInstance().toggleSfx():(r.default.getInstance().toggleSfx(),r.default.getInstance().toggleMusic()),this.updateSoundButtons(),r.default.getInstance().play(a.default.Click)},e.prototype.updateSoundButtons=function(){var t=m.default.getInstance().music?0:1;t+=m.default.getInstance().sfx?0:1,this.musicBtn.loadTexture(n.default.Garage,"InGameMusicButton000"+t)},e.prototype.shutdown=function(){this.scaleGroup=null,this.musicBtn=null,this.lastEnabled=null,this.scaleGroup=null,t.prototype.shutdown.call(this)},e.prototype.resize=function(){var t=1;t=(t=this.game.width/o.default.WIDTH)>1?1:t,this.scaleGroup.scale.set(t),this.scaleGroup.alignIn(this.world.bounds,Phaser.BOTTOM_CENTER)},e.Name="choose_zone",e.pause=!1,e.CurrentLevel="",e.LevelNum=0,e}(Phaser.State);e.default=b},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.init=function(){var e=window;t.api=e.famobi,t.analytics=e.famobi_analytics,t.n_analytics=famobi_analytics},t}();e.default=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.FlySound=function(){return Math.random()>.6?t.Fly1:Math.random()>.3?t.Fly2:t.Fly3},t.FlipSound=function(){return"flip_0"+(Math.round(5*Math.random())+1)},t.DieSound=function(){return"dead_0"+(Math.round(5*Math.random())+1)},t.startSound=function(){return"accel0"+(Math.round(3*Math.random())+1)},t.MenuMusic="menu_track_1",t.GameMusic="game_track",t.Click="button",t.Landing="landing",t.DriverSpikes="driver_spikes",t.SavePoint="safepoint",t.Stones="stones",t.Explode1="explode1",t.Explode2="explode2",t.Barrel1="barrel_hit0",t.Barrel2="barrel_hit1",t.Engine1="motor",t.EngineFon="eng_loop",t.Fly1="fly_01",t.Fly2="fly_02",t.Fly3="fly_03",t.Flip1="flip_01",t.Flip2="flip_02",t.Flip3="flip_03",t.Flip4="flip_04",t.Flip5="flip_05",t.Flip6="flip_06",t.Dead1="dead_01",t.Dead2="dead_02",t.Dead3="dead_03",t.Dead4="dead_04",t.Dead5="dead_05",t.Dead6="dead_06",t.Start="engine_start",t.Finish="engine_finish",t.Start1="accel01",t.Start2="accel02",t.Start3="accel03",t.Start4="accel04",t.Wood="wood_hit0",t.Wendy="wendy",t.Boost="boost",t.GlassCrash="glass_crash",t.preloadList=[],t.list=[t.MenuMusic,t.GameMusic,t.Engine1,t.EngineFon,t.Explode1,t.Explode2,t.Barrel1,t.Barrel2,t.Wood,t.Wendy,t.Stones,t.SavePoint,t.DriverSpikes,t.Landing,t.Fly1,t.Fly2,t.Fly3,t.Flip1,t.Flip2,t.Flip3,t.Flip4,t.Flip5,t.Flip6,t.Dead1,t.Dead2,t.Dead3,t.Dead4,t.Dead5,t.Dead6,t.Finish,t.Start,t.Start1,t.Start2,t.Start3,t.Start4,t.Click,t.Boost,t.GlassCrash],t}();e.default=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0,i(12),i(11);var n=i(3),o=i(22),a=i(18),r=i(13),h=i(14),l=i(9),c=i(19),u=i(4),d=i(0),p=i(28),f=i(21),y=i(36),g=i(20),m=i(2),v=i(23),b=function(t){function e(){var i=t.call(this)||this;return i.name=e.Name,i.popup=null,i.black=null,i.transition=null,i.bike=null,i._armatureDisplay=null,i}return s(e,t),e.prototype.onPlayNextLevel=function(){if(l.default.getInstance().play(n.Sounds.Click),o.default.LevelNum+1>=22)this.onChooseZone();else{o.default.LevelNum++;var t=o.default.LevelNum;d.GameData.raceId=t+1,o.default.CurrentLevel=n.JSONData.list[t],d.GameData.currentLevel=this.game.cache.getJSON(o.default.CurrentLevel),d.GraphicUtil.currentAtlass=a.default.Theme0,new c.default(this.game,0,e.Name)}},e.prototype.init=function(){var i=this;t.prototype.init.call(this),this.game.world.removeAll(),e.loadedLevel=!1,dragonBones.PhaserFactory.init(this.game);var s=this.game.cache.getJSON(n.JSONData.DBBike),a=this.game.cache.getJSON(n.JSONData.DBBike_Texture),r=this.game.cache.getImage(p.default.DBBike,!0).base;dragonBones.PhaserFactory.factory.parseDragonBonesData(s),dragonBones.PhaserFactory.factory.parseTextureAtlasData(a,r),this.initData(),this.game.time.advancedTiming=!0,d.GraphicUtil.game=this.game,u.MaxGameCore.instance.init(this.game),d.CarsData.geom[1]=this.game.cache.getJSON(n.JSONData.Bike),u.MaxGameCore.instance.signalFinish.add(this.onCallPopup,this),u.MaxGameCore.instance.start(),y.default.instance.init(this.game.add.group(),this.game),this.black=this.game.add.graphics(0,0),this.black.beginFill(0,1),this.black.drawRect(0,0,this.game.width,this.game.height),this.black.endFill();var h=this.game.add.text(this.game.width/2,this.game.height/2,"LOADING...",n.Constants.styleCredits0);h.anchor.set(.5),this.black.addChild(h),this.transition=this.game.add.tween(this.black),this.transition.to({alpha:0},100,Phaser.Easing.Linear.None,!1,500),this.transition.onComplete.add(function(){e.loadedLevel=!0,i.hardRestart(),i.black.destroy(),i.black=null,i.transition=null,i.game.device.desktop?(i.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onUp.add(i.onSpace,i),i.game.input.keyboard.addKey(Phaser.Keyboard.P).onUp.add(i.onPause,i),i.game.input.keyboard.addKey(Phaser.Keyboard.R).onUp.add(i.onR,i)):i.game.input.onDown.add(i.onSpaceMobile,i),-1===e.currCar&&(e.currCar=Math.round(2*Math.random())),y.default.instance.signalRestart.add(i.hardRestart,i),y.default.instance.signalPause.add(i.onPause,i),y.default.instance.signalToggleMusic.add(i.onToggleMusic,i),u.MaxGameCore.instance.paused=!1,u.MaxGameCore.instance.enginePitch=l.default.getInstance().play(n.Sounds.Engine1,.1,!0)}),u.MaxGameCore.instance.signalLoaded.removeAll(),u.MaxGameCore.instance.signalLoaded.addOnce(function(){this.transition.start(),u.MaxGameCore.instance.paused=!0},this),l.default.getInstance().playMusic(n.Sounds.GameMusic),d.CarExplodeObject.setupPool(),v.default.analytics.trackEvent(v.default.n_analytics.EVENT_LEVELSTART,{levelName:"level"+(o.default.LevelNum+1)}).then(function(){}).catch(function(){})},e.prototype.create=function(){t.prototype.create.call(this),this.resize()},e.prototype.setNewViewCar=function(){e.currCar++,e.currCar>=2&&(e.currCar=0),null!==this._armatureDisplay&&this._armatureDisplay.destroy();var t="biker"+e.currCar+"_anim_btn";this._armatureDisplay=dragonBones.PhaserFactory.factory.buildArmatureDisplay(t),this._armatureDisplay.x=0,this._armatureDisplay.y=150,this._armatureDisplay.animation.play("animation",0),this.popup.addChild(this._armatureDisplay)},e.prototype.hardRestart=function(){y.default.instance.hideControlsHint(),y.default.instance.continueShow=!1,y.default.instance.helperShow=!1,1===d.GameData.raceId&&y.default.instance.showControlsHint();var t=u.MaxGameCore.instance;t.car.review(),t.restart(),t.drive=!1,t.finished=!1,y.default.instance.showTimer(),t.timer=0,t.car.callbackDie=y.default.instance.showDeathHint,t.car.callbackStunt=y.default.instance.showFlipMsg,t.car.callbackContext=y.default.instance,this.closePopup()},e.prototype.onSpaceMobile=function(){u.MaxGameCore.instance.finished||u.MaxGameCore.instance.car.dead&&(u.MaxGameCore.instance.paused||(y.default.instance.hideControlsHint(),u.MaxGameCore.instance.car.safeId>=0?(u.MaxGameCore.instance.car.review(),u.MaxGameCore.instance.restartFromSafePoint(u.MaxGameCore.instance.car.safeId)):this.hardRestart()))},e.prototype.onSpace=function(){e.isAdsPause||u.MaxGameCore.instance.paused||u.MaxGameCore.instance.finished||u.MaxGameCore.instance.car.dead&&(u.MaxGameCore.instance.paused||(y.default.instance.hideControlsHint(),u.MaxGameCore.instance.car.safeId>=0?(u.MaxGameCore.instance.car.review(),u.MaxGameCore.instance.restartFromSafePoint(u.MaxGameCore.instance.car.safeId)):this.hardRestart()))},e.prototype.onR=function(){v.default.analytics.trackEvent(v.default.n_analytics.EVENT_LEVELRESTART,{levelName:"level"+(o.default.LevelNum+1)}).then(function(){}).catch(function(){}),this.hardRestart()},e.prototype.onPause=function(){u.MaxGameCore.instance.finished||this.onCallPopup(0)},e.prototype.onToggleMusic=function(){this.toggleMusic()},e.prototype.toggleMusic=function(){h.default.getInstance().music?l.default.getInstance().toggleMusic():h.default.getInstance().sfx?l.default.getInstance().toggleSfx():(l.default.getInstance().toggleSfx(),l.default.getInstance().toggleMusic()),y.default.instance.updateSoundButtons(),l.default.getInstance().play(n.Sounds.Click)},e.prototype.setFields=function(t){var e=d.RacesData.data,i=new r.default(this.game,"",n.Constants.styleTime,null,this,a.default.Garage);i.setFrames("bg0000","bg0000","bg0000","bg0000"),t.addChild(i),i.y=20,i.label.setMaxSize(200,50),i.label.stroke="#000000",i.label.strokeThickness=2;var s=this.game.add.sprite(-133,-76,a.default.Garage,"star00000"),o=this.game.add.sprite(0,-88,a.default.Garage,"star00000"),h=this.game.add.sprite(133,-76,a.default.Garage,"star00000");s.anchor.set(.5),o.anchor.set(.5),h.anchor.set(.5),s.scale.set(.9),h.scale.set(.9),s.angle=-10,h.angle=10;var c=this.game.add.sprite(-133,-76,a.default.Garage,"star10000");c.anchor.set(.5);var u=this.game.add.sprite(0,-88,a.default.Garage,"star10000");u.anchor.set(.5);var p=this.game.add.sprite(133,-76,a.default.Garage,"star10000");p.anchor.set(.5),c.angle=-10,p.angle=10;var f=new r.default(this.game,"0",n.Constants.styleTime,null,null);f.x=-133,f.y=-6;var y=new r.default(this.game,"0",n.Constants.styleTime,null,null);y.y=-16;var g=new r.default(this.game,"0",n.Constants.styleTime,null,null);g.x=133,g.y=-6,t.addChild(s),t.addChild(o),t.addChild(h),t.addChild(c),t.addChild(u),t.addChild(p),t.addChild(f),t.addChild(y),t.addChild(g);var m=d.RacesData.map.settings.prizes.split(",");f.setText(m[2]+" sec."),y.setText(m[1]+" sec."),g.setText(m[0]+" sec.");var v=e.stars;c.visible=v>0,u.visible=v>1,p.visible=v>2,c.scale.set(.9),p.scale.set(.9);var b,x=200;v>0&&(c.scale.set(3),c.alpha=0,(b=this.game.add.tween(c)).onComplete.addOnce(function(){l.default.getInstance().play(n.Sounds.Explode2),d.RacesData.data.camera.shakeContainer(this.popup)},this),b.to({alpha:1},400,Phaser.Easing.Linear.None,!0,x-150),(b=this.game.add.tween(c.scale)).to({x:.9,y:.9},400,Phaser.Easing.Back.Out,!0,x),x+=400),v>1&&(u.scale.set(3),u.alpha=0,(b=this.game.add.tween(u)).onComplete.addOnce(function(){l.default.getInstance().play(n.Sounds.Explode1),d.RacesData.data.camera.shakeContainer(this.popup)},this),b.to({alpha:1},400,Phaser.Easing.Linear.None,!0,x-100),(b=this.game.add.tween(u.scale)).to({x:1,y:1},400,Phaser.Easing.Back.Out,!0,x),x+=700),v>2&&(p.scale.set(3),p.alpha=0,(b=this.game.add.tween(p)).onComplete.addOnce(function(){l.default.getInstance().play(n.Sounds.Explode2),d.RacesData.data.camera.shakeContainer(this.popup)},this),b.to({alpha:1},400,Phaser.Easing.Linear.None,!0,x-100),(b=this.game.add.tween(p.scale)).to({x:.9,y:.9},400,Phaser.Easing.Back.Out,!0,x),x+=1e3);var _=Math.ceil(100*e.timer),w=_/100>>0;_-=100*w;var P=this.game.add.sprite(200,90,a.default.Garage,"improved_bg0000");if(P.anchor.set(.5),t.addChild(P),P.visible=e.improved,P.alpha=0,e.improved){var C=new r.default(this.game,"NEW BEST TIME",n.Constants.styleBestTime,null,null);C.angle=25,C.y=-25,P.addChild(C);var T=new r.default(this.game,w.toString()+"."+_.toString()+" sec",n.Constants.styleBestTime,null,null);T.angle=25,T.x=-8,T.y=-5,P.addChild(T),C.label.setShadow(1,1,"rgba(0,0,0,0.8)"),T.label.setShadow(1,1,"rgba(0,0,0,0.8)");var S=P.x,A=P.y;P.x=-500,P.alpha=0,this.game.add.tween(P).to({x:S,y:A,alpha:1},250,Phaser.Easing.Back.InOut,!0)}i.setText("Your time: "+w+"."+_+" sec.")},e.prototype.postRace=function(t){var e=d.RacesData.data;e.timer=u.MaxGameCore.instance.timer;var i,s=0,n=d.RacesData.map.settings.prizes;if(0===n.length);else{i=n.split(",");var o=void 0,a=void 0;for(o=0;o<i.length;o++)a=parseFloat(i[o]),e.timer<=a&&s++}if(e.stars=s,e.improved=d.Inventory.instance.setRaceResult(d.GameData.raceId,s,e.timer),e.improved){d.RacesData.map.id;if(i){var r=parseFloat(i[0])-5,l=parseFloat(i[i.length-1])+10,c=l-r,p=l-e.timer;p<0?p=0:p>c&&(p=c),(3e3+100*(d.RacesData.map.id-1))*p/c}}this.setFields(t),h.default.getInstance().save()},e.prototype.onCallPopup=function(t){if(u.MaxGameCore.instance.paused)this.closePopup();else{this.createPopup(),1!==t&&(u.MaxGameCore.instance.paused=!0,y.default.instance.flipTexts.alpha=0);var i=null,s="GAME PAUSED",h=o.default.LevelNum,l=null,c=null;if(1===t){s=h+1<10?"LEVEL 0"+(h+1)+" COMPLETE":"LEVEL "+(h+1)+" COMPLETE",this.setNewViewCar(),(l=new r.default(this.game,s,n.Constants.styleFinish,null,null,a.default.Garage)).y=-220,l.label.stroke="#000000",l.label.strokeThickness=2;var d=new f.default(this.game,0,2,s,n.Constants.styleFinish);d.anchor.set(.5),l.label.parent.addChildAt(d,0),d.stroke="#FFFFFF",d.strokeThickness=5,2!==e.currCar&&(c=null,(c=new r.default(this.game,"CHANGE BIKE",n.Constants.styleFinish1,this.onGarage,this,a.default.Garage)).y=190,c.setFrames("orange_btn_big0000","orange_btn_big0000","orange_btn_big0000","orange_btn_big0000"),c.label.setMaxSize(200,40),c.label.y=-1,c.label.setText("CHANGE BIKE"),c.label.setShadow(1,1,"rgba(0,0,0,0.8)",5),this.popup.getChildAt(1).addChild(c)),y.default.instance.timer.visible=!1}else{(i=this.game.add.sprite(0,3,a.default.Garage,"bg0000")).anchor.set(.5),i.scale.set(1,1.4),this.popup.getChildAt(1).addChild(i),(l=new r.default(this.game,s,n.Constants.stylePause,null,this,a.default.Garage)).y=-145,l.label.stroke="#000000",l.label.strokeThickness=2;var p=this.game.add.group();this.popup.getChildAt(1).addChild(p),this.setPauseViewCar(p)}l.setFrames("bg0000","bg0000","bg0000","bg0000"),this.popup.getChildAt(1).addChild(l);var g=new r.default(this.game,"",n.Constants.styleCredits1,this.onChooseZone,this,a.default.Garage);g.x=-270,g.y=200,g.setFrames("orange_btn0000","orange_btn0000","orange_btn0000","orange_btn0000"),g.scale.set(.8);var m=this.game.add.sprite(0,-11,a.default.Garage,"exit_btn0000");m.anchor.set(.5),g.label.parent.addChild(m),this.popup.getChildAt(1).addChild(g);var v=new r.default(this.game,"",n.Constants.stylePopBtn2,1===t?this.onPlayNextLevel:this.onResume,this,a.default.Garage);v.x=270,v.y=200,v.setFrames("orange_btn0000","orange_btn0000","orange_btn0000","orange_btn0000"),v.scale.set(.8);var b=this.game.add.sprite(0,-7,a.default.Garage,"next_btn0000");if(b.anchor.set(.5),v.label.parent.addChild(b),this.popup.getChildAt(1).addChild(v),1===t){var x=this.game.add.group();this.popup.getChildAt(1).addChild(x),this.postRace(x),v.visible=!1,g.visible=!1,c&&(c.visible=!1),this._armatureDisplay&&(this._armatureDisplay.visible=!1);var _=this.game,w=this._armatureDisplay;setTimeout(function(){window.famobi_analytics.trackEvent(famobi_analytics.EVENT_LEVELSUCCESS,{levelName:"level"+(h+1)}).then(function(){v.alpha=0,v.visible=!0,g.alpha=0,g.visible=!0,c&&(c.alpha=0,c.visible=!0,_.add.tween(c).to({alpha:1},250,null,!0)),w&&(w.alpha=0,w.visible=!0,_.add.tween(w).to({alpha:1},250,null,!0)),_.add.tween(g).to({alpha:1},250,null,!0),_.add.tween(v).to({alpha:1},250,null,!0)}).catch(function(){})},2e3)}this.resizePopup(1)}},e.prototype.setPopupVisible=function(){this.popup&&(this.popup.visible=!0)},e.prototype.disposePopup=function(){this.popup&&this.popup.destroy(),this.popup=null,u.MaxGameCore.instance.paused=!1,y.default.instance.showTimer()},e.prototype.backgroundPopup=function(){this.popup=this.game.add.sprite(350,250,a.default.Garage,"bg0000"),this.popup.anchor.set(.5);var t=this.game.add.sprite(0,0,a.default.Garage,"bg0000");t.width=this.game.width,t.height=this.game.height,t.inputEnabled=!0,t.anchor.set(.5),this.popup.addChild(t),this.world.addChild(y.default.instance.container),y.default.instance.hideTimer()},e.prototype.createPopup=function(){null!==this.popup&&this.disposePopup(),this.backgroundPopup();var t=this.game.add.sprite(0,0,a.default.Garage,"0popup_bg0000");t.anchor.set(.5),this.popup.addChild(t)},e.prototype.resizePopup=function(t){if(null!==this.popup){var e=this.popup.removeChildAt(0);e.width=this.game.width,e.height=this.game.height,this.popup.x=this.world.bounds.centerX,this.popup.y=this.world.bounds.centerY,this.popup.addChildAt(e,0)}},e.prototype.closePopup=function(){this.disposePopup()},e.prototype.onResume=function(){this.closePopup()},e.prototype.onChooseZone=function(){h.default.getInstance().save(),this.closePopup(),new c.default(this.game,0,o.default.Name)},e.prototype.onGarage=function(){h.default.getInstance().save(),this.closePopup(),new c.default(this.game,0,g.default.Name)},e.prototype.parseStaticGraphic=function(t,e){var i=null;(i=this.game.add.image(t[e].x,t[e].y,a.default.Cars,t[e].g+"0000")).angle=t[e].r,-1!==e.indexOf("base")?i.anchor.set(m.AssetsList.FRAMES_ANCHORX[0],m.AssetsList.FRAMES_ANCHORY[0]):-1!==e.indexOf("suspend")?-1!==e.indexOf("front")?i.anchor.set(.8,-1!==t[e].g.indexOf("1")?.2:.5):i.anchor.set(0,.5):i.anchor.set(.5),this.bike.addChild(i)},e.prototype.setPauseViewCar=function(t){null!==this.bike?(this.bike.destroy(),this.bike=this.game.add.group(t)):this.bike=this.game.add.group(t);var e=d.CarsData.geomObj.bike11,i="Wheel0";this.parseStaticGraphic(e,i),i="Wheel1",this.parseStaticGraphic(e,i),i="suspend_back",this.parseStaticGraphic(e,i),i="base",this.parseStaticGraphic(e,i),i="driver_corpse",this.parseStaticGraphic(e,i),i="driver_hip",this.parseStaticGraphic(e,i),i="driver_shin",this.parseStaticGraphic(e,i),i="driver_arm",this.parseStaticGraphic(e,i),i="driver_forearm",this.parseStaticGraphic(e,i),i="driver_head",this.parseStaticGraphic(e,i),i="suspend_front",this.parseStaticGraphic(e,i),this.bike.x=0,this.bike.y=10},e.prototype.update=function(){if(this.isFirstUpdate)return this.isFirstUpdate=!1,this.timeAcc=0,void(this.prevTimeMS=Date.now());if(!e.isAdsPause)for(t.prototype.update.call(this),this.currTimeMS=Date.now(),this.deltaTime=(this.currTimeMS-this.prevTimeMS)/1e3,this.deltaTime>e.MAX_FRAME_TIME&&(this.deltaTime=e.MAX_FRAME_TIME),this.prevTimeMS=this.currTimeMS,this.timeAcc+=this.deltaTime;this.timeAcc>=e.DESIRED_FRAME_TIME;)this.updateGameController(e.DESIRED_FRAME_TIME),this.timeAcc-=e.DESIRED_FRAME_TIME},e.prototype.resize=function(){t.prototype.resize.call(this);var e=1;this.game.width/this.game.height>=n.Constants.WIDTH/n.Constants.HEIGHT?e=(e=this.game.width/n.Constants.WIDTH)>1?1:e:e=(e=this.game.height/n.Constants.HEIGHT)>1?1:e,y.default.instance.resize(e),this.resizePopup(e)},e.prototype.shutdown=function(){this.closePopup(),u.MaxGameCore.instance.release(),y.default.instance.release(),t.prototype.shutdown.call(this)},e.prototype.render=function(){null!==this.popup&&dragonBones.PhaserFactory.factory.dragonBones.advanceTime(-1),t.prototype.render.call(this)},e.prototype.initData=function(){this.isFirstUpdate=!0},e.prototype.updateGameController=function(t){u.MaxGameCore.instance.update(t),y.default.instance.setTimer()},e.Name="gameplay",e.pause=!1,e.MAX_FRAME_TIME=.1,e.DESIRED_FRAME_TIME=1/30,e.isAdsPause=!1,e.loadedLevel=!1,e.currCar=-1,e}(Phaser.State);e.default=b},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0,i(12),i(11);var n=i(9),o=i(14),a=i(3),r=i(13),h=i(38),l=i(19),c=i(16),u=i(0),d=i(21),p=i(22),f=i(29),y=i(20),g=i(28),m=i(43),v=i(23),b=function(t){function e(){var i=t.call(this)||this;return i.name=e.Name,i.popup=null,i.popup_btn=null,i.google_btn=null,i.apple_btn=null,i._armatureDisplay=null,i}return s(e,t),e.prototype.init=function(){this.game.world.removeAll(),dragonBones.PhaserFactory.init(this.game),c.default.DISPLAY_W=Phaser.Math.max(this.game.width,this.game.height),c.default.DISPLAY_H=Phaser.Math.min(this.game.width,this.game.height)},e.prototype.create=function(){t.prototype.create.call(this),u.Inventory.instance.signalUnlock.removeAll(),u.Inventory.instance.signalUnlock.addOnce(function(){new l.default(this.game,0,p.default.Name)},this),this.background2=this.game.add.sprite(0,0,a.Atlases.Garage,"0bg_garage0000"),this.background=this.game.add.sprite(0,0,a.Atlases.Garage,"0bg_garage0000"),this.background3=this.game.add.sprite(0,0,a.Atlases.Garage,"bg0000"),this.background4=this.game.add.sprite(0,0,a.Atlases.Garage,"bg0000");var e=this.game.cache.getJSON(f.default.DBMenu),i=this.game.cache.getJSON(f.default.DBMenu_Texture),s=this.game.cache.getImage(g.default.DBMenu,!0).base;dragonBones.PhaserFactory.factory.parseDragonBonesData(e),dragonBones.PhaserFactory.factory.parseTextureAtlasData(i,s),this._armatureDisplay=dragonBones.PhaserFactory.factory.buildArmatureDisplay("biker_anim"),this._armatureDisplay.x=0,this._armatureDisplay.y=360,this._armatureDisplay.animation.play("biker menu animation",-1),this.background.addChild(this._armatureDisplay);var n={font:"bold 20px Djvu",fill:"#FFFFFF"};this.bgTop=this.game.add.image(0,0,a.Atlases.Garage,"top_bg0000"),this.bgTop.scale.set(1.5,1),this.playBtn=new r.default(this.game,"Play",a.Constants.stylePlay,this.startGame,this,a.Atlases.Garage),this.playBtn.setFrames("play_btn0000","play_btn0000","play_btn0000","play_btn0000"),this.playBtn.x=500,this.playBtn.y=200,this.playBtn.label.x=130,this.playBtn.label.stroke="#000000",this.playBtn.label.strokeThickness=5;var c=new d.default(this.game,130,2,"Play",a.Constants.stylePlay);c.anchor.set(.5),this.playBtn.label.parent.addChildAt(c,0);var y=this.game.add.image(100,0,a.Atlases.Garage,"black0000");y.alpha=0,y.width=280,y.height=100,y.anchor.set(.5),y.inputEnabled=!0,y.input.useHandCursor=!0,y.events.onInputDown.addOnce(this.startGame,this),this.playBtn.label.parent.addChild(y),c.stroke="#FFFFFF",c.strokeThickness=10,this.background4.addChild(this.playBtn),this.moregames=new r.default(this.game,"Reset",n,this.resetGame,this,a.Atlases.Garage),this.moregames.setFrames("play_btn0000","play_btn0000","play_btn0000","play_btn0000"),this.moregames.x=620,this.moregames.y=400,this.background4.addChild(this.moregames),this.moregames.visible=!1,this.logo=this.game.add.image(200,100,a.Atlases.Garage,"0logo0000"),this.logo.anchor.set(.5),this.garageBtn=new r.default(this.game,"",null,this.onGarage,this,a.Atlases.Garage),this.garageBtn.setFrames("shop_btn0000","shop_btn0000","shop_btn0000","shop_btn0000"),this.garageBtn.x=this.game.width-140,this.garageBtn.y=30,this.world.addChild(this.garageBtn),this.musicBtn=this.game.add.image(this.game.width-40,25,a.Atlases.Garage,"InGameMusicButton0000"),this.musicBtn.inputEnabled=!1,this.musicBtn.events.onInputUp.add(this.toggleMusic,this),this.musicBtn.anchor.set(.5),this.playBtn.visible=!1,this.blackRightBG=this.game.add.sprite(900,a.Constants.HEIGHT/2,a.Atlases.Garage,"0popup_bg0000"),this.blackRightBG.anchor.set(.5),this.blackRightBG.angle=90,this.background3.addChild(this.blackRightBG);var m=this.game.add.sprite(0,-a.Constants.HEIGHT/2,a.Atlases.Garage,"0popup_bg0000");m.anchor.set(.5),this.blackRightBG.addChild(m),(m=this.game.add.sprite(0,0,a.Atlases.Garage,"0popup_bg0000")).anchor.set(.5),this.blackRightBG.addChild(m),this.textVersion=new d.default(this.game,680,470," "+a.Constants.VERSION,a.Constants.styleVersion),this.background3.addChild(this.textVersion),this.brand_logo=new r.default(this.game,"",n,this.onMoreGames,this,"more_games"),this.brand_logo.btn.anchor.set(1,.5),this.brand_logo.scale.set(.3),this.background3.addChild(this.brand_logo),o.default.getInstance(this.game,this.onLoadSave,this),new h.default(this.game,0,null),this.resize()},e.prototype.onMoreGames=function(){v.default.api.moreGamesLink()},e.prototype.onLoadSave=function(){n.default.getInstance(this.game).playMusic(a.Sounds.MenuMusic),this.musicBtn.inputEnabled=!0,this.updateSoundButtons(),this.playBtn.visible=!0},e.prototype.onGoogle=function(){window.open(m.default.getInstance().getUrl(m.default.Google),"_blank")},e.prototype.onApple=function(){window.open(m.default.getInstance().getUrl(m.default.Apple),"_blank")},e.prototype.initGame=function(){null===u.GameData.currentCar&&(u.GameData.currentCar=this.game.cache.getJSON(f.default.Car001),u.CarsData.geomObj=this.game.cache.getJSON(f.default.Objects),this.setCar(u.GameData.currentCar))},e.prototype.startGame=function(){n.default.getInstance().play(a.Sounds.Click),this.initGame(),new l.default(this.game,0,p.default.Name)},e.prototype.onGarage=function(){n.default.getInstance().play(a.Sounds.Click),this.initGame(),new l.default(this.game,0,y.default.Name)},e.prototype.setCar=function(t){u.CarsData.params=new u.CarParams,u.CarsData.params.setData(t),y.default.currCar=y.default.carList.indexOf(u.Inventory.instance.skin),u.CarsData.params.skinId=y.default.carList[y.default.currCar]},e.prototype.resetGame=function(){u.Inventory.instance.reset(),o.default.getInstance().save()},e.unlockGame=function(){u.Inventory.instance.unlockAll(),o.default.getInstance().save()},e.prototype.toggleMusic=function(){o.default.getInstance().music?n.default.getInstance().toggleMusic():o.default.getInstance().sfx?n.default.getInstance().toggleSfx():(n.default.getInstance().toggleSfx(),n.default.getInstance().toggleMusic()),this.updateSoundButtons(),n.default.getInstance().play(a.Sounds.Click)},e.prototype.updateSoundButtons=function(){var t=o.default.getInstance().music?0:1;t+=o.default.getInstance().sfx?0:1,this.musicBtn.loadTexture(a.Atlases.Garage,"InGameMusicButton000"+t)},e.prototype.disposePopup=function(){this.popup.destroy(),this.popup=null,this.popup_btn.destroy(),this.popup_btn=null},e.prototype.backgroundPopup=function(){this.popup=this.game.add.sprite(350,250,a.Atlases.Garage,"bg0000"),this.popup.anchor.set(.5);var t=this.game.add.sprite(0,0,a.Atlases.Garage,"black0000");t.width=this.game.width+500,t.height=this.game.height+500,t.inputEnabled=!0,t.anchor.set(.5),this.popup.addChild(t)},e.prototype.createPopup=function(){null!==this.popup&&this.disposePopup(),this.backgroundPopup();var t=this.game.add.sprite(0,0,a.Atlases.Garage,"0popup_bg0000");t.anchor.set(.5),this.popup.addChild(t)},e.prototype.resizePopup=function(t){if(null!==this.popup){var e=this.popup.removeChildAt(0);e.width=this.game.width+500,e.height=this.game.height+500,this.popup.x=this.world.bounds.centerX,this.popup.y=this.world.bounds.centerY,this.popup.addChildAt(e,0),this.popup_btn.x=this.world.bounds.centerX,this.popup_btn.y=this.world.bounds.centerY+200}},e.prototype.render=function(){dragonBones.PhaserFactory.factory.dragonBones.advanceTime(-1),t.prototype.render.call(this)},e.prototype.resize=function(){var e=1;e=(e=this.game.width/a.Constants.WIDTH)>1?1:e,this.garageBtn.x=this.game.width-120,this.musicBtn.x=this.game.width-35,this.bgTop.x=this.game.width-250,this.background.scale.set(e),this.background.alignIn(this.world.bounds,Phaser.BOTTOM_CENTER),this.logo.scale.set(e),this.background2.scale.set(2.02*Phaser.Math.max(this.game.width/a.Constants.WIDTH,this.game.height/a.Constants.HEIGHT)),this.background2.alignIn(this.world.bounds,Phaser.CENTER),this.background2.visible=!1,this._armatureDisplay.x=-this.background.x-50,this.game.width>820?this.blackRightBG.x=900:this.game.width-110>450?this.blackRightBG.x=this.game.width-110:this.blackRightBG.x=this.game.width,this.playBtn.x=this.game.width-250,this.playBtn.y=200,this.moregames.x=this.game.width-100,this.moregames.y=this.game.height-180,this.playBtn.scale.set(e),this.moregames.scale.set(e),this.textVersion.x=this.game.width-60,this.textVersion.y=this.game.height-20,this.brand_logo.x=this.game.width-60,this.brand_logo.y=this.game.height-180,this.resizePopup(e),t.prototype.resize.call(this)},e.prototype.shutdown=function(){t.prototype.shutdown.call(this),this.background=null,this.background2=null,this.popup=null,this.popup_btn=null,this.playBtn=null,this.moregames=null,this.musicBtn=null,this.bgTop=null,this._armatureDisplay=null},e.Name="menu",e}(Phaser.State);e.default=b},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.DBBike="bikes_texture",t.DBMenu="menu_texture",t.SiteLockCoolMath="coolmath",t.preloadList=[],t.list=[t.DBBike,t.DBMenu],t}();e.default=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.Level001="map1",t.Level002="map2",t.Level003="map3",t.Level004="map4",t.Level005="map5",t.Level006="map6",t.Level007="map7",t.Level008="map8",t.Level009="map9",t.Level010="map10",t.Level011="map11",t.Level012="map12",t.Level013="map13",t.Level014="map14",t.Level015="map15",t.Level016="map16",t.Level017="map17",t.Level018="map18",t.Level019="map19",t.Level020="map20",t.Level021="map21",t.Level022="map22",t.Car001="1",t.Bike="bike",t.DBBike="bikes_skeleton",t.DBBike_Texture="bikes_texture",t.DBMenu="menu_skeleton",t.DBMenu_Texture="menu_texture",t.Objects="objects",t.preloadList=[t.Objects],t.list=[t.Level001,t.Level002,t.Level003,t.Level004,t.Level005,t.Level006,t.Level007,t.Level008,t.Level009,t.Level010,t.Level011,t.Level012,t.Level013,t.Level014,t.Level015,t.Level016,t.Level017,t.Level018,t.Level019,t.Level020,t.Level021,t.Level022,t.Car001,t.Objects,t.DBBike,t.DBBike_Texture,t.DBMenu,t.DBMenu_Texture,t.Bike],t}();e.default=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.space.Space,o=i(41),a=i(15),r=function(t){function e(){var i=t.call(this)||this;return e.space=new n,i}return s(e,t),e.prototype.start=function(){},e.prototype.update=function(t){e.space.step(.5*t),e.space.step(.5*t);for(var i,s=e.space.liveBodies.iterator();s.hasNext();){var n=s.next(),o=n.userData;o.graphic?((i=o.graphic).x=n.position.x,i.y=n.position.y,i.rotation=n.rotation%(2*Math.PI)):o.graphicEx&&((i=o.graphicEx).x=n.position.x,i.y=n.position.y,i.rotation=n.rotation%(2*Math.PI))}},e.prototype.add=function(t){null!==t.body.compound?t.body.compound.space=e.space:t.body.space=e.space},e.prototype.release=function(){for(t.prototype.release.call(this);!e.space.bodies.empty();)a.NapeUtil.disposeBody(e.space.bodies.at(0))},e}(o.GamePhysics);e.NapePhysics=r},function(t,e,i){"use strict";e.__esModule=!0;var s=i(0),n=i(32),o=function(){function t(){this.object=null,this.car=null,this.tweening=!1}return t.prototype.setup=function(t,e,i,s){this.maxScale=.45,this.tweening=!1,this.viewportW=e,this.viewportH=i,this.viewportHalfH=.5*i,this.viewportHalfW=.5*e,this.object=t,this.prevX=t.x,this.prevY=t.y,this.car=s,this.prevScale=t.scale.x,this.prevFrameH=i,n.CameraPathes.instance.tweened=!1,this.shakeX=0,this.shakeY=0},t.prototype.hardFocusOnCar=function(e,i,s){this.update(e+t.CAR_DX/s,i-100,s,!1)},t.prototype.shake=function(){var t=s.GraphicUtil.game.add.tween(this);t.to({shakeX:15,shakeY:15},100,Phaser.Easing.Bounce.InOut,!1,0,3,!0),t.start()},t.prototype.shakeContainer=function(t){void 0===t&&(t=null);var e=s.GraphicUtil.game.add.tween(t),i=t.x,n=t.y;e.to({x:t.x-10,y:t.y-10},15,Phaser.Easing.Bounce.InOut,!1,0,3,!0),e.onComplete.addOnce(function(){t.x=i,t.y=n},this),e.start()},t.prototype.update=function(e,i,s,n){void 0===n&&(n=!1);var o,a,r=1;if(n){this.prevX+=.4*(e-this.prevX),this.prevY+=.4*(i-this.prevY),r=this.prevScale+(s-this.prevScale),o=-this.prevX*r+this.viewportHalfW,a=-this.prevY*r+this.viewportHalfH}else o=-e*(r=s)+this.viewportHalfW,a=-i*r+this.viewportHalfH,this.prevX=e,this.prevY=i;this.prevScale=r,t.x=-o/r,t.y=-a/r,this.car.finished||this.updateObject(o+this.shakeX,a+this.shakeY,r),t.w=this.viewportW/r,t.h=this.viewportH/r,t.scale=r},t.prototype.updateObject=function(t,e,i){this.object.scale.set(i),this.object.x=t,this.object.y=e},t.prototype.focusOnCar=function(e,i,s){var o,a,r=n.CameraPathes.instance.getPathPointXY(e,i),h=!1,l=1,c=this.getFrameHBySpeed(s);if(isNaN(r))l<this.maxScale&&(l=this.maxScale),l=t.SCALE_MULT*this.viewportH/c,o=e+t.CAR_DX/l,a=i-100;else{var u=r-i+200;u>c&&(c=u),(l=t.SCALE_MULT*this.viewportH/c)<this.maxScale&&(c=c*l/this.maxScale,l=this.maxScale,r=i-200+c),a=r-.5*c,o=e+t.CAR_DX/l,h=n.CameraPathes.instance.tweened}h&&(this.tweening=!0),this.update(o,a,l,this.tweening)},t.prototype.focusOnCameraZone=function(t,e){var i=s.CameraZone.current,n=i.x,o=i.y;i.move===s.CameraZone.HOR?n=t<i.minMove?i.minMove:t>i.maxMove?i.maxMove:t:i.move===s.CameraZone.VER&&(o=e<i.minMove?i.minMove:e>i.maxMove?i.maxMove:e),this.tweening=!0,this.update(n,o,i.scale,!0)},t.prototype.focusOnPoint=function(t,e){this.tweening=!0,this.update(t,e,1,!0)},t.prototype.getFrameHBySpeed=function(t){var e=this.viewportH;t>500&&(e+=((t=t>3e3?3e3:t)-500)/2500*this.viewportH);var i=e-this.prevFrameH;return i<-2?e=this.prevFrameH-2:i>8&&(e=this.prevFrameH+8),this.prevFrameH=e,e},t.prototype.release=function(){this.object=null,this.car=null},t.inCamera=function(e,i,s){return e>t.x-s&&e<t.x+t.w+s&&i>t.y-s&&i<t.y+t.h+s},t.CAR_DX=150,t.SCALE_MULT=1,t}();e.RaceCamera=o},function(t,e,i){"use strict";e.__esModule=!0;var s=nape.geom.Vec2,n=function(){function t(){this.tweened=!1,this.pathes=[]}return t.prototype.reset=function(){this.prevPath=null,this.tweened=!1},t.prototype.addPathByPoints=function(t){var e=new o(t);this.pathes.push(e)},t.prototype.getPathPointXY=function(t,e){for(var i,s=NaN,n=this.pathes.length,o=0;o<n;o++){var a=this.pathes[o],r=a.getPoint(t,e);isNaN(r)||(isNaN(s)?(s=r,i=a):r<s&&(s=r,i=a))}return null!==this.prevPath&&this.prevPath!==i&&(this.tweened=!0),this.prevPath=i,s},t.prototype.clearPrevPath=function(){this.tweened=!1,this.prevPath=null},t.prototype.clear=function(){this.clearPrevPath(),this.pathes.splice(0,this.pathes.length)},Object.defineProperty(t,"instance",{get:function(){return null===t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t._instance=null,t}();e.CameraPathes=n;var o=function(){function t(t){this.points=t,this.minX=t[0].x,this.maxX=t[t.length-1].x}return t.prototype.getPoint=function(t,e){if(t<this.minX||t>this.maxX)return NaN;for(var i=this.points.length,n=s.get(0,0),o=1;o<i;o++){var a=this.points[o];if(a.x>=t){var r=this.points[o-1],h=t-r.x;n.x=a.x-r.x,n.y=a.y-r.y;var l=h*Math.tan(n.angle),c=r.y+l;return c<e?NaN:c}}return NaN},t}();e.CameraPath=o},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return Object.defineProperty(t,"map",{get:function(){return t._map},set:function(e){t._map!==e&&t.data.reset(),t._map=e},enumerable:!0,configurable:!0}),t.EDITED=-1,t.MAP_COUNT=22,t._map={},t.prize_coin=100,t}();e.RacesData=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.raceId=0,t.currentLevel=null,t.currentCar=null,t.raceResult=0,t.carId=-1,t}();e.GameData=s},function(t,e,i){"use strict";e.__esModule=!0;var s=Phaser.Keyboard,n=i(3),o=i(13),a=function(){function t(){this.container=null,this.btnUp=null,this.btnDown=null,this.btnLeft=null,this.btnRight=null,this._isbtnUp=!1,this._isbtnDown=!1,this._isbtnLeft=!1,this._isbtnRight=!1}return Object.defineProperty(t.prototype,"isbtnUp",{get:function(){return this.game.device.desktop?this.game.input.keyboard.isDown(s.UP)||this.game.input.keyboard.isDown(s.W):this._isbtnUp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isbtnDown",{get:function(){return this.game.device.desktop?this.game.input.keyboard.isDown(s.DOWN)||this.game.input.keyboard.isDown(s.S):this._isbtnDown},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isbtnLeft",{get:function(){return this.game.device.desktop?this.game.input.keyboard.isDown(s.LEFT)||this.game.input.keyboard.isDown(s.A):this._isbtnLeft},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isbtnRight",{get:function(){return this.game.device.desktop?this.game.input.keyboard.isDown(s.RIGHT)||this.game.input.keyboard.isDown(s.D):this._isbtnRight},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e){this.container=t,this.game=e,this.container.inputEnableChildren=!0,this.game.device.desktop?(this.game.input.keyboard.addKeyCapture(s.RIGHT),this.game.input.keyboard.addKeyCapture(s.LEFT),this.game.input.keyboard.addKeyCapture(s.DOWN),this.game.input.keyboard.addKeyCapture(s.UP)):this.createButtons()},t.prototype.createButtons=function(){var t=this.game.add.image(0,0,n.Atlases.Garage,"arrow_key0000");t.anchor.set(.5),this.btnUp=new o.default(this.game,"",{},null,null,n.Atlases.Garage),this.btnUp.setFrames("btn_body0000","btn_body0000","btn_body0001","btn_body0000"),this.btnUp.x=this.game.width-70,this.btnUp.y=this.game.height-70,this.btnUp.scale.set(1.3),this.btnUp.btn.events.onInputDown.add(this.upTap,this),this.btnUp.btn.events.onInputUp.add(this.upUnTap,this),this.container.addChild(this.btnUp),this.btnUp.label.parent.addChild(t),(t=this.game.add.image(0,0,n.Atlases.Garage,"arrow_key0000")).anchor.set(.5),t.rotation=180*Math.PI/180,this.btnDown=new o.default(this.game,"",{},null,null,n.Atlases.Garage),this.btnDown.setFrames("btn_body0000","btn_body0000","btn_body0001","btn_body0000"),this.btnDown.x=this.game.width-220,this.btnDown.y=this.game.height-70,this.btnDown.scale.set(1.3),this.btnDown.btn.events.onInputDown.add(this.downTap,this),this.btnDown.btn.events.onInputUp.add(this.downUnTap,this),this.container.addChild(this.btnDown),this.btnDown.label.parent.addChild(t),(t=this.game.add.image(0,0,n.Atlases.Garage,"arrow_key20000")).anchor.set(.5),t.scale.set(-1,1),this.btnLeft=new o.default(this.game,"",{},null,null,n.Atlases.Garage),this.btnLeft.setFrames("btn_body0000","btn_body0000","btn_body0001","btn_body0000"),this.btnLeft.x=70,this.btnLeft.y=this.game.height-70,this.btnLeft.scale.set(1.3),this.btnLeft.btn.events.onInputDown.add(this.leftTap,this),this.btnLeft.btn.events.onInputUp.add(this.leftUnTap,this),this.container.addChild(this.btnLeft),this.btnLeft.label.parent.addChild(t),(t=this.game.add.image(0,0,n.Atlases.Garage,"arrow_key20000")).anchor.set(.5),this.btnRight=new o.default(this.game,"",{},null,null,n.Atlases.Garage),this.btnRight.setFrames("btn_body0000","btn_body0000","btn_body0001","btn_body0000"),this.btnRight.x=220,this.btnRight.y=this.game.height-70,this.btnRight.scale.set(1.3),this.btnRight.btn.events.onInputDown.add(this.rightTap,this),this.btnRight.btn.events.onInputUp.add(this.rightUnTap,this),this.container.addChild(this.btnRight),this.btnRight.label.parent.addChild(t)},t.prototype.upTap=function(){this._isbtnUp=!0},t.prototype.downTap=function(){this._isbtnDown=!0},t.prototype.leftTap=function(){this._isbtnLeft=!0},t.prototype.rightTap=function(){this._isbtnRight=!0},t.prototype.upUnTap=function(){this._isbtnUp=!1},t.prototype.downUnTap=function(){this._isbtnDown=!1},t.prototype.leftUnTap=function(){this._isbtnLeft=!1},t.prototype.rightUnTap=function(){this._isbtnRight=!1},t.prototype.resize=function(t){this.container&&(this.container.scale.set(t),this.btnUp.x=this.game.width/t-70,this.btnUp.y=this.game.height/t-70,this.btnDown.x=this.game.width/t-220,this.btnDown.y=this.game.height/t-70,this.btnLeft.x=70,this.btnLeft.y=this.game.height/t-70,this.btnRight.x=220,this.btnRight.y=this.game.height/t-70)},Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t}();e.default=a},function(t,e,i){"use strict";e.__esModule=!0;var s=i(3),n=i(13),o=i(22),a=i(35),r=i(25),h=i(4),l=i(21),c=i(9),u=i(43),d=i(14),p=i(23),f=function(){function t(){this.stars=null,this.signalRestart=null,this.signalPause=null,this.signalToggleMusic=null,this.game=null,this.scl=1,this.container=null,this.bgBtnRight=null,this.timer=null,this.helperText=null,this.continueText=null,this.bgBtnLeft=null,this.time=0,this.helperShow=!1,this.continueShow=!1,this.lFront=null,this.lBack=null,this.flipTexts=null,this.flipBG=null,this.MSG_DELAY=40}return t.prototype.setTimer=function(){var t=Math.ceil(100*h.MaxGameCore.instance.timer),e=t/100>>0,i=(e<10?"0"+e:e)+"."+(t-=100*e);i.length<5&&(i+="0"),this.timer.setText(i)},t.prototype.showFlipMsg=function(t,e){var i="FLIP",n="";n=n+"-"+.5*t+" sec",this.flipTexts.setText(n),this.flipBG.setText(n),t>1&&(i=i+" "+t+"X"),this.lFront.setText(i),this.lBack.setText(i),h.MaxGameCore.instance.timer-=.5*t,this.startTextAnim(this.flipTexts,this.hideFlipTxtAnim,this),c.default.getInstance().play(s.Sounds.FlipSound())},t.prototype.startTextAnim=function(t,e,i){t.scale.set(.1),this.flipBG.stroke="#000000",this.flipBG.strokeThickness=2,t.label.stroke="#FFFFFF",t.label.strokeThickness=5;var s=this.game.add.tween(t.scale);t.alpha=1,s.to({x:1,y:1},350,Phaser.Easing.Back.Out,!0),s.onComplete.addOnce(e,i)},t.prototype.hideFlipTxtAnim=function(){this.game.add.tween(this.flipTexts).to({alpha:0},250,Phaser.Easing.Linear.None,!0,500)},t.prototype.release=function(){this.flipTexts=null,this.flipBG=null,this.bgBtnRight=null,this.bgBtnLeft=null,this.helperText=null,this.continueText=null,this.continueShow=!1,this.helperShow=!1,this.game=null,this.timer=null,this.pauseBtn=null,this.restartBtn=null,this.musicBtn=null,this.stars=null,this.signalToggleMusic.removeAll(),this.signalRestart.removeAll(),this.signalPause.removeAll(),this.signalToggleMusic=null,this.signalRestart=null,this.signalPause=null,this.container.destroy(),this.container=null},t.prototype.showControlsHint=function(){this.helperText.visible=!0,this.continueText.visible=!1,this.helperShow=!0,this.continueShow=!1},t.prototype.showDeathHint=function(){var t=o.default.LevelNum;p.default.analytics.trackEvent(p.default.n_analytics.EVENT_CUSTOM,{event:"EVENT_LEVELFAIL",levelName:"level"+(t+1),reason:"dead"}).then(function(){}).catch(function(){}),h.MaxGameCore.instance.finished||(this.continueText.visible=!0),this.helperText.visible=!1,this.helperShow=!1,this.continueShow=!0,c.default.getInstance().play(s.Sounds.DieSound())},t.prototype.hideControlsHint=function(){this.helperShow=!1,this.continueShow=!1,this.helperText.visible=!1,this.continueText.visible=!1},t.prototype.showTimer=function(){this.timer.visible||h.MaxGameCore.instance.finished||(this.timer.visible=!0,this.helperShow&&(this.helperText.visible=!0),this.continueShow&&(this.continueText.visible=!0),a.default.instance.container.visible=!0)},t.prototype.hideTimer=function(){this.timer.visible&&(this.timer.visible=!1,this.helperText.visible=!1,this.continueText.visible=!1,a.default.instance.container.visible=!1)},t.prototype.init=function(e,i){this.container=e,this.game=i,this.game.device.desktop||(t.MSG_CONTINUE="Tap to continue",t.MSG_HELP="Use arrows to move"),this.scl=Math.max(this.game.width,this.game.height)/s.Constants.WIDTH,this.scl=this.scl>1?1:this.scl,this.signalRestart=new Phaser.Signal,this.signalPause=new Phaser.Signal,this.signalToggleMusic=new Phaser.Signal,this.timer=new n.default(this.game,"00.00",s.Constants.styleTimer,null,null,s.Atlases.Garage),this.timer.setFrames("timer_bg0000","timer_bg0000","timer_bg0000","timer_bg0000"),this.timer.x=this.game.width/2,this.timer.y=25,this.timer.label.x=-2,this.timer.label.anchor.set(0,.6),this.timer.inputEnableChildren=!1,this.helperText=new n.default(this.game,t.MSG_HELP,s.Constants.styleHelp,null,null,s.Atlases.Garage),this.helperText.setFrames("0popup_bg0000","0popup_bg0000","0popup_bg0000","0popup_bg0000"),this.helperText.x=this.game.width/2,this.helperText.y=this.game.height+this.helperText.height/2-90*s.Constants.GAME_SCALE,this.helperText.label.anchor.set(.5,5.5),this.helperText.visible=!1,this.continueText=new n.default(this.game,t.MSG_CONTINUE,s.Constants.styleHelp,null,null,s.Atlases.Garage),this.continueText.setFrames("0popup_bg0000","0popup_bg0000","0popup_bg0000","0popup_bg0000"),this.continueText.x=this.game.width/2,this.continueText.y=this.game.height+this.helperText.height/2-90*s.Constants.GAME_SCALE,this.continueText.label.anchor.set(.5,5.5),this.continueText.visible=!1,this.bgBtnRight=this.game.add.image(this.game.width,0,s.Atlases.Garage,"pause_bg0000"),this.bgBtnRight.scale.set(-1.4,1),this.bgBtnLeft=this.game.add.image(0,0,s.Atlases.Garage,"pause_bg0000"),this.bgBtnLeft.scale.set(1.4,1),this.restartBtn=this.game.add.image(0,0,s.Atlases.Garage,"restart_btn0000"),this.pauseBtn=this.game.add.image(this.game.width-90,0,s.Atlases.Garage,"InGamePauseButton0000"),this.musicBtn=this.game.add.image(this.game.width-58,0,s.Atlases.Garage,"InGameMusicButton0000"),this.stars=this.game.add.text(45,6,"#"+(o.default.LevelNum+1),s.Constants.styleMoney),this.flipTexts=new n.default(i,"",s.Constants.styleTrick,null,null,s.Atlases.Garage),this.flipTexts.setFrames("bg0000","bg0000","bg0000","bg0000"),this.flipTexts.label.setMaxSize(200,45),this.flipTexts.label.y=20,this.flipTexts.alpha=0,this.lBack=new l.default(this.game,0,-20,"FLIP",s.Constants.styleTrick),this.lBack.anchor.set(.5),this.flipTexts.label.parent.addChildAt(this.lBack,0),this.lBack.stroke="#FFFFFF",this.lBack.strokeThickness=5,this.lFront=new l.default(this.game,0,-20,"FLIP",s.Constants.styleTrick),this.lFront.anchor.set(.5),this.flipTexts.label.parent.addChild(this.lFront),this.lFront.stroke="#000000",this.lFront.strokeThickness=2,this.flipBG=new l.default(this.game,0,20,"",s.Constants.styleTrick),this.flipBG.anchor.set(.5),this.flipTexts.label.parent.addChild(this.flipBG),this.restartBtn.inputEnabled=!0,this.restartBtn.events.onInputDown.add(this.onRestart,this),this.pauseBtn.inputEnabled=!0,this.pauseBtn.events.onInputDown.add(this.onPause,this),this.musicBtn.inputEnabled=!0,this.musicBtn.events.onInputDown.add(this.toggleMusic,this),this.updateSoundButtons(),this.container.addChild(this.bgBtnRight),this.container.addChild(this.bgBtnLeft),this.container.addChild(this.pauseBtn),this.container.addChild(this.restartBtn),this.container.addChild(this.musicBtn),this.container.addChild(this.flipTexts),this.container.addChild(this.stars),this.container.addChild(this.timer),this.container.addChild(this.helperText),this.container.addChild(this.continueText),this.game.device.desktop||a.default.instance.container.parent.addChild(a.default.instance.container),this.flipTexts.x=.5*this.game.width/this.scl,this.flipTexts.y=.2*s.Constants.HEIGHT},t.prototype.toggleMusic=function(){this.signalToggleMusic.dispatch()},t.prototype.updateSoundButtons=function(){var t=d.default.getInstance().music?0:1;t+=d.default.getInstance().sfx?0:1,this.musicBtn.loadTexture(s.Atlases.Garage,"InGameMusicButton000"+t)},t.prototype.resize=function(t){this.container.scale.set(t),this.bgBtnRight.x=this.game.width/t,this.musicBtn.x=this.game.width/t-58,this.pauseBtn.x=this.game.width/t-100,this.bgBtnRight.y=0,this.bgBtnLeft.y=0,this.game.state.current===r.default.Name&&this.resizeGameplay(t),this.game.device.desktop||a.default.instance.resize(t)},t.prototype.onMoreGames=function(){window.open(u.default.getInstance().getUrl(u.default.YEP10),"_blank")},t.prototype.resizeGameplay=function(t){this.flipTexts.x=.5*this.game.width},t.prototype.onPause=function(){this.signalPause.dispatch()},t.prototype.onRestart=function(){p.default.analytics.trackEvent(p.default.n_analytics.EVENT_LEVELRESTART,{levelName:"level"+(o.default.LevelNum+1)}).then(function(){}).catch(function(){}),this.signalRestart.dispatch()},Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.MSG_CONTINUE="Press SPACE to continue",t.MSG_HELP="Use arrows to move",t}();e.default=f},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(1),a=i(4),r=i(5),h=i(2),l=function(t){function e(){var e=t.call(this)||this;return e.create(),e}return s(e,t),e.setupPool=function(){for(var t=0;t<11;t++)e.pool.push(new e);e.poolLen=e.pool.length},e.get=function(){for(var t=0;t<e.poolLen;t++){var i=e.pool[t];if(!1===i.active)return i}var s=new e;return e.pool.push(s),e.poolLen=e.pool.length,s},e.prototype.create=function(t){void 0===t&&(t=null),this.active=!1,this.type=o.ObjectTypes.EFFECT,this.graphic=r.GraphicUtil.createMovieClip(null,h.AssetsStorage.instance.getByKey("car_exp_anim"),30,!1);var e=h.AssetsStorage.instance.getByKey("car_exp_anim");this.graphic.animations.getAnimation(e).onComplete.add(this.animComplete,this),this.graphic.completeCallback=this.animComplete,this.graphic.scale.set(2),this.graphic.visible=!1,a.MaxGameCore.instance.add(this)},e.prototype.animComplete=function(t){this.active=!1,this.graphic.visible=!1,null!==this.completeCallback&&(this.completeCallback(),this.completeCallback=null)},e.prototype.activate=function(t,e,i,s,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null),this.active=!0,this.graphic.x=t,this.graphic.y=e,this.graphic.visible=!0,this.maxSizeCallback=i,this.completeCallback=s,this.completeCallbackContext=n;var o=h.AssetsStorage.instance.getByKey("car_exp_anim"),a=this.graphic.animations.getAnimation(o);a.frame=0,a.play(30)},e.prototype.restart=function(){this.active&&(this.graphic.visible=!1,this.active=!1,this.maxSizeCallback=null,this.completeCallback=null,this.completeCallbackContext=null)},e.prototype.update=function(t){void 0===t&&(t=0),this.active&&null!==this.maxSizeCallback&&(this.maxSizeCallback(this.completeCallbackContext),this.maxSizeCallback=null,this.completeCallbackContext=null)},e.prototype.release=function(){e.poolLen>0&&e.pool.splice(0,e.poolLen),this.maxSizeCallback=null,this.completeCallback=null,this.completeCallbackContext=null,t.prototype.release.call(this)},e.pool=new Array,e.poolLen=0,e}(n.GameObject);e.CarExplodeObject=l},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(3),o=function(t){function e(e,i,s){void 0===s&&(s=null);var o=t.call(this,e)||this;o.beginFill(i,1),o.drawRect(0,0,o.game.width,o.game.height),o.endFill(),e.add.group(o,"white",!0).add(o);var a=o.game.add.text(o.game.width/2,o.game.height/2,"LOADING...",n.Constants.styleCredits0);a.anchor.set(.5),o.addChild(a);var r=o.game.add.tween(o);return r.to({alpha:0},100),r.onComplete.add(function(){null!==s&&s()}),r.start(),o}return s(e,t),e}(Phaser.Graphics);e.default=o},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0,i(12),i(11);var n=i(3),o=i(19),a=i(26),r=i(2),h=function(t){function e(){var i=t.call(this)||this;return i.name=e.Name,i.loadComplete=!0,i.bike=null,i.w0=null,i.w1=null,i.wait=null,i.mainParent=null,i}return s(e,t),e.prototype.preload=function(){var e=this;t.prototype.preload.call(this),this.wait=this.game.add.text(this.game.width/2,this.game.height/2,"LOADING...",n.Constants.styleCredits0),this.wait.anchor.set(.5),this.game.sound.muteOnPause=!0,this.game.load.onFileComplete.add(this.fileComplete,this);var i="x"+n.Constants.GAME_SCALE+"/";n.JSONData.list.forEach(function(t){e.game.load.json(t,"assets/levels/"+t+".json")}),n.Images.list.forEach(function(t){e.game.load.image(t,"assets/images/"+i+t+".png")}),n.Atlases.list.forEach(function(t){e.game.load.atlas(t,"assets/atlases/"+i+t+".png","assets/atlases/"+i+t+".json")}),n.Sounds.list.forEach(function(t){e.game.device.iOS?e.game.load.audio(t,["assets/sound/"+t+".m4a"]):e.game.load.audio(t,["assets/sound/"+t+".ogg","assets/sound/"+t+".mp3"])}),this.game.scale.onSizeChange.add(function(){e.game.state.getCurrentState().resize()},this)},e.prototype.init=function(){t.prototype.init.call(this),this.mainParent=this.game.add.group(),this.mainParent.x=this.game.width/2,this.mainParent.y=this.game.height/2-80,this.setPauseViewCar(this.mainParent)},e.prototype.setPauseViewCar=function(t){null!==this.bike?(this.bike.destroy(),this.bike=this.game.add.group(t)):this.bike=this.game.add.group(t);var e=this.game.cache.getJSON(n.JSONData.Objects).bike11,i="Wheel0";this.w0=this.parseStaticGraphic(e,i),i="Wheel1",this.w1=this.parseStaticGraphic(e,i),i="suspend_back",this.parseStaticGraphic(e,i),i="base",this.parseStaticGraphic(e,i),i="driver_corpse",this.parseStaticGraphic(e,i),i="driver_hip",this.parseStaticGraphic(e,i),i="driver_shin",this.parseStaticGraphic(e,i),i="driver_arm",this.parseStaticGraphic(e,i),i="driver_forearm",this.parseStaticGraphic(e,i),i="driver_head",this.parseStaticGraphic(e,i),i="suspend_front",this.parseStaticGraphic(e,i),this.bike.x=0,this.bike.y=10},e.prototype.parseStaticGraphic=function(t,e){var i=null;return(i=this.game.add.image(t[e].x,t[e].y,n.Atlases.Cars,t[e].g+"0000")).angle=t[e].r,-1!==e.indexOf("base")?i.anchor.set(r.AssetsList.FRAMES_ANCHORX[0],r.AssetsList.FRAMES_ANCHORY[0]):-1!==e.indexOf("suspend")?-1!==e.indexOf("front")?i.anchor.set(.8,-1!==t[e].g.indexOf("1")?.2:.5):i.anchor.set(0,.5):i.anchor.set(.5),this.bike.addChild(i),i},e.prototype.create=function(){t.prototype.create.call(this)},e.prototype.update=function(){t.prototype.update.call(this),this.loadComplete&&(this.loadComplete=!1,e.game=this.game,new o.default(this.game,0,a.default.Name))},e.prototype.fileComplete=function(t,e,i,s,n){this.wait.setText("Loading..."+t+"%"),this.w0.angle=720*t/100,this.w1.angle=720*t/100},e.prototype.resize=function(){var e=1;e=(e=this.game.width/n.Constants.WIDTH)>1?1:e,this.mainParent&&(this.mainParent.x=this.game.width/2,this.mainParent.y=this.game.height/2-80),this.wait&&this.wait.position.set(this.game.width/2,this.game.height/2),t.prototype.resize.call(this)},e.prototype.shutdown=function(){t.prototype.shutdown.call(this)},e.Name="preloader",e.game=null,e}(Phaser.State);e.default=h},function(t,e,i){"use strict";e.__esModule=!0;var s=i(11),n=i(0),o=function(){function t(){}return t.setTransform=function(t,e,i,s,n,o,a,r){void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===r&&(r=null),t.x=e,t.y=i,t.rotation=s,n&&(t.pivot.x=n),o&&(t.pivot.y=o),a&&(t.scale.x=a),r&&(t.scale.y=r)},t.release=function(){for(var e in t.mapTexture)if(t.mapTexture.hasOwnProperty(e)){t.mapTexture[e].destroy(!0)}t.mapTexture={}},t.drawBitmapPath=function(e,i,s){var n,o=s.length,a=[],r=0;for(r=0;r<o;r++)a.push(new Phaser.Point(s[r].x,s[r].y));n=t.choosePic(e,a.slice()),i.addChild(n)},t.drawBitmapPath2=function(e,i,s){var o=new Phaser.Image(n.GraphicUtil.game,-200,-200,n.GraphicUtil.currentAtlass,e+"0000"),a=[];t.addPoints(s,o.width,a),t.drawOld(e,i,a)},t.drawBitmapPath2StretchCircle=function(e,i,o,a){var r=new Phaser.Image(n.GraphicUtil.game,-200,-200,n.GraphicUtil.currentAtlass,e+"0000"),h=.5*(o=Math.max(o,r.width)),l=Math.asin(Math.min(h/a,1)),c=Math.ceil(2*Math.PI/l);l=2*Math.PI/c;for(var u=[],d=0;d<c;d++)u.push(new s.Point(a*Math.cos(d*l),a*Math.sin(d*l)));u.push(u[0]),t.drawOld(e,i,u)},t.drawBitmapPath2Stretch=function(e,i,s){t.drawOld(e,i,s)},t.addPoints=function(t,e,i){var n,o,a,r=t.length,h=0,l=0,c=0,u=0,d=0,p=new s.Point;for(h=0;h<r-1;h++)n=t[h],o=t[h+1],l+=Phaser.Point.distance(n,o);if(a=l,null!=t[0]){for(i.push(new s.Point(t[0].x,t[0].y));l>.15;)n=i[i.length-1],o=t[d+1],(c=Phaser.Point.distance(n,o))>e?(c*=u=e/c,Phaser.Point.interpolate(n,o,u,p),i.push(new s.Point(p.x,p.y))):(d++,i.push(new s.Point(t[d].x,t[d].y))),l-=c;return a}},t.choosePic=function(e,i){if(void 0===t.mapTexture[e]){var s=new Phaser.Image(n.GraphicUtil.game,0,0,n.GraphicUtil.currentAtlass,e+"0000"),o=s.generateTexture();s.visible=!1,t.mapTexture[e]=o}return n.GraphicUtil.game.add.rope(0,0,t.mapTexture[e],null,i)},t.drawOld=function(t,e,i){var s,o,a=i.length,r=0,h=null;for(r=0;r<a&&r!==a-1;r++){s=i[r];var l=(o=i[r+1]).x-s.x,c=o.y-s.y,u=Math.atan(c/l);l<0&&(u+=Math.PI),0===r&&u,(h=n.GraphicUtil.game.add.image(s.x,s.y,n.GraphicUtil.currentAtlass,t+"0000")).anchor.set(0,.5),u,h.rotation=u,h.width=Math.sqrt(l*l+c*c),e.addChild(h)}},t.mapTexture={},t}();e.Drawing=o},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.prototype.add=function(t){},t.prototype.release=function(){},t.prototype.update=function(t){},t.prototype.start=function(){},t}();e.GamePhysics=s},function(t,e,i){"use strict";e.__esModule=!0;var s=i(0),n=function(){function t(){}return t.release=function(){for(var e in t.paramsList.splice(0,t.paramsList.length),t.geom)t.geom[e]&&(t.geom[e]=null)},t.EDITED=-1,t.paramsList=[],t.geom={},t.geomObj={},t.cars=new s.RaceCars,t.BASE_PHASE=3,t.MAX_PARTS=3,t.INVURNABLE_TIME=2.5,t.DEAD_TIME=.5,t.FLIP=.5,t.WHEELIE_PART=.1,t.ITEM_MIN_DELAY=0,t.ITEM_DELTA_DELAY=0,t.BOMB_ITEM_DAMAGE=2500,t.BOMB_ITEM_RADIUS=32,t.RC_ITEM_DAMAGE=2500,t.RC_ITEM_RADIUS=32,t.prize_kill=100,t.BOSSES=[3,5,7,9],t.MAX_TORQUE_MULT=3,t}();e.CarsData=n},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){this.brandInstances={},this.brandDomains=[]}return t.getInstance=function(){return null===t.instance&&(t.instance=new t),t.instance},t.prototype.checkDomain=function(t){for(var e=0;e<this.brandDomains.length;e++){var i=this.brandDomains[e];if(-1!==t.indexOf(i))return!0}return!1},t.prototype.getUrlLock=function(){return null!==t.Current?this.brandInstances[t.Current]:""},t.prototype.getUrl=function(t){return this.brandInstances[t]},t.instance=null,t.Kizi="kizi",t.YEP10="yep10",t.Current="",t.Google="google",t.Apple="itunes",t}();e.default=s},function(t,e,i){"use strict";e.__esModule=!0;var s=i(45),n=function(){function t(){}return t.prototype.init=function(t,e){this.prevX=t,this.prevY=e,this.prevDist=0},t.prototype.emit=function(e,i){var n=Math.sqrt((e-this.prevX)*(e-this.prevX)+(i-this.prevY)*(i-this.prevY));if(n<t.MIN_DIST)s.TrailPartObject.get().put(e,i),this.prevX=e,this.prevY=i,this.prevDist=n;else for(var o=Math.atan2(i-this.prevY,e-this.prevX),a=Math.cos(o),r=Math.sin(o);n>t.MIN_DIST;)this.prevX+=t.MIN_DIST*a,this.prevY+=t.MIN_DIST*r,s.TrailPartObject.get().put(this.prevX,this.prevY),n-=t.MIN_DIST},t.MIN_DIST=16,t}();e.TrailParticlesSystem=n},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(4),a=i(1),r=function(t){function e(){var e=t.call(this)||this;return e.create(),e}return s(e,t),e.get=function(){return e.pool.length>0?e.pool.pop():new e},e.prototype.create=function(t){void 0===t&&(t=null),this.type=a.ObjectTypes.LANDSCAPE,this.graphic=new n.TrailPart,this.active=!1,o.MaxGameCore.instance.add(this)},e.prototype.update=function(t){void 0===t&&(t=0),this.active&&(this.graphic.update(t),this.graphic.isPlaying||this.remove())},e.prototype.put=function(t,e){this.graphic.x=t,this.graphic.y=e,this.graphic.visible=!0,this.active=!0,this.graphic.gotoAndPlay(0)},e.prototype.remove=function(){this.active&&(e.pool[e.pool.length]=this),this.active=!1,this.graphic.visible=!1},e.prototype.restart=function(){this.remove()},e.pool=[],e}(n.GameObject);e.TrailPartObject=r},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(5),o=i(2),a=function(t){function e(){var e=t.call(this,n.GraphicUtil.game)||this;e.anim=null;var i=o.AssetsStorage.instance.getByKey("smoke_part"),s=e.game.add.sprite(0,0,n.GraphicUtil.currentAtlass,i+"0000");return s.animations.add(i,Phaser.Animation.generateFrameNames(i,0,28,"",4)),s.anchor.set(.5),e.anim=s.animations.getAnimation(i),e.anim.play(30),e.anim.stop(),e.anim.onComplete.add(e.animationComplete,e),e.addChild(s),e.visible=!1,e}return s(e,t),e.prototype.update2=function(t){void 0===t&&(t=0),this.anim.isPlaying&&(this.x+=this.velX*t,this.y+=this.velY*t,this.velY+=e.GRAVITY_Y*t)},e.prototype.animationComplete=function(){this.visible=!1},e.prototype.emit=function(t,i,s){this.visible=!0,this.x=t,this.y=i,this.velX=e.BASE_VEL*Math.cos(s),this.velY=e.BASE_VEL*Math.sin(s),this.anim.play(30)},e.GRAVITY_Y=-500,e.BASE_VEL=-50,e}(Phaser.Group);e.SmokePartClip=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(2),a=function(t){function e(){var e=t.call(this,n.GraphicUtil.game)||this;e.anim=null;var i=o.AssetsStorage.instance.getByKey("ground_part"),s=e.game.add.sprite(0,0,n.GraphicUtil.currentAtlass,i+"0000");return s.animations.add(i,Phaser.Animation.generateFrameNames(i,0,28,"",4)),s.anchor.set(.5),e.anim=s.animations.getAnimation(i),e.anim.play(30),e.anim.stop(),e.anim.onComplete.add(e.animationComplete,e),e.addChild(s),e.visible=!1,e}return s(e,t),e.prototype.update2=function(t){void 0===t&&(t=0),this.anim.isPlaying&&(this.x+=this.velX*t,this.y+=this.velY*t,this.velY+=e.GRAVITY_Y*t)},e.prototype.animationComplete=function(){this.visible=!1},e.prototype.emit=function(t,e,i,s){this.visible=!0,this.x=t,this.y=e,this.velX=i,this.velY=s,this.anim.play(30)},e.GRAVITY_Y=500,e}(Phaser.Group);e.GroundPartClip=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.geom.Ray,o=nape.geom.Vec2,a=nape.phys.Compound,r=i(0),h=i(4),l=i(9),c=i(3),u=i(25),d=function(t){function e(){var e=t.call(this)||this;return e.LONG_FLY_TIME=.1,e.dampingDelta=.99,e._drive=!0,e.ray=new n(o.weak(),o.weak(0,1)),e.itemId=-1,e.accell=!1,e.smokeTimer=0,e.wheelieTimer=0,e.tilt=0,e.compound=new a,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.space=h.MaxGameCore.instance.getSpace(),this.setParams(t),this.finished=!1,this.boost=new r.BoostEffector(this.frame.body),this.boost.anim=this.frame.graphic.boostAnim,this.restart()},e.prototype.setParams=function(t){var e;this.skinId=t.skinId,0===t.wd?(this.wdWheels=[this.backWheel.body],e=this.backWheel.body.shapes.at(0).radius):1===t.wd?(e=this.frontWheel.body.shapes.at(0).radius,this.wdWheels=[this.frontWheel.body]):(this.wdWheels=[this.backWheel.body,this.frontWheel.body],e=Math.max(this.backWheel.body.shapes.at(0).radius,this.frontWheel.body.shapes.at(0).radius)),this.wheelRadius=e;var i=2*Math.PI*e,s=t.maxSpeed/i;this.maxAngularVel=2*s*Math.PI,this.accelTorque=t.torque,t.maxTorque>t.torque?this.deltaTorque=t.maxTorque-t.torque:this.deltaTorque=0,this.tiltTorque=t.flipTorque,this.frame.maxFlipVel=this.maxTiltSpeed=t.maxFlipSpeed},e.prototype.restart=function(){this.wheelieTimer=0,this.accell=!1,this.safeId=-1,this.finished=!1,this.maxFlyAngle=this.minFlyAngle=this.startFlyAngle=this.rotation=this.frame.body.rotation,this.fallTime=this.flyTime=0,this.frame.body.userData.handler=this,this.backWheel.body.userData.handler=this,this.frontWheel.body.userData.handler=this,this.frame.body.userData.graphic=this.frame.graphic,this.backWheel.body.userData.graphicEx=this.backWheel.graphic,this.frontWheel.body.userData.graphicEx=this.frontWheel.graphic,this._drive=!0,this._deadDelay=0,this.dead=!1,this.itemId=-1,this.setVisible(!0),this.setAlpha(1),this.review(),this.compound.space=this.space},e.prototype.release=function(){this.space=null,this.compound.space=null,this.compound=null,this.frame=null,this.backWheel=null,this.frontWheel=null,this.callbackFinish=null,this.callbackDie=null,this.callbackStunt=null,this.callbackFight=null,this.suspendBack=null,this.suspendBackLocal&&this.suspendBackLocal.dispose(),this.suspendBackLocal=null,this.suspendFront=null,this.boost.dispose(),this.boost=null,t.prototype.release.call(this)},Object.defineProperty(e.prototype,"drive",{get:function(){return this._drive},set:function(t){t&&!this._drive&&(this.frontWheel.startSpin(),this.backWheel.startSpin()),this._drive=t},enumerable:!0,configurable:!0}),e.prototype.addBoost=function(t,e){this.dead||this.boost.add(t,e)},e.prototype.update=function(t){void 0===t&&(t=0),this.dead&&this.driver?(this.x=this.driver.parts[0].body.position.x,this.y=this.driver.parts[0].body.position.y):(this.x=this.frame.body.position.x,this.y=this.frame.body.position.y),this.rotation=this.frame.body.rotation;var i,s=this.speed;if(this.speed=this.frame.body.velocity.length,this.speedV=this.frame.body.velocity.y,this.hasGround=this.frame.hasGround||this.backWheel.hasGround||this.frontWheel.hasGround,this.hasGround?(this.flyTime>this.LONG_FLY_TIME&&(this.processLand(),s>500&&l.default.getInstance().play(c.Sounds.Landing)),this.flyTime=0,this.fallTime=0):(0===this.flyTime&&(this.maxFlyAngle=this.minFlyAngle=this.startFlyAngle=this.rotation),this.rotation>this.maxFlyAngle?this.maxFlyAngle=this.rotation:this.rotation<this.minFlyAngle&&(this.minFlyAngle=this.rotation),this.flyTime+=t,this.speedV>0?this.fallTime+=t:this.fallTime=0),this._drive){var n=this.controller.getDrive();if(this.applyDrive(t,!1,n),this.finished)this.applyTilt(t,0);else{var o=this.controller.getTilt();this.applyTilt(t,o)}if(4!==this.skinId&&(this.controller.accell?this.smokeTimer-=2*t:this.smokeTimer-=t,this.smokeTimer<=0)){this.smokeTimer+=e.SMOKE_TIME,i=this.frame.graphic;var a=this.frame.body.localPointToWorld(this.frame.localSmokePos),h=.1*Math.PI;this.controller.accell?(i.emitSmoke(a.x,a.y,this.rotation-.5*h+Math.random()*h),i.emitSmoke(a.x,a.y,this.rotation-.1*Math.PI+.5*h+Math.random()*h),i.emitSmoke(a.x,a.y,this.rotation+.1*Math.PI+.5*h+Math.random()*h),a.dispose()):(i.emitSmoke(a.x,a.y,this.rotation-.5*h+Math.random()*h),a.dispose())}i=this.frame.graphic,this.updateWheelie(t)}else this._deadDelay>0&&(this._deadDelay-=t,this._deadDelay<=0&&9!==this.skinId&&(this._drive=!0,this._deadDelay=0,this.dead=!1,this.setVisible(!0),this.compound.space=this.space)),this.finished&&(this.frontWheel.body.angularVel*=.8,this.backWheel.body.angularVel*=.8);if(this.suspendBack){var u=this.frame.body.localPointToWorld(this.suspendBackLocal),d=this.backWheel.body.position.sub(u);r.Drawing.setTransform(this.suspendBack.graphic,u.x,u.y,d.angle,NaN,NaN,d.length/this.suspendBackW,1),d.dispose(),u.dispose()}this.suspendFront&&(this.suspendFront.graphic.x=this.frontWheel.body.position.x,this.suspendFront.graphic.y=this.frontWheel.body.position.y,this.suspendFront.graphic.rotation=(this.suspendFrontAngle+this.frame.body.rotation)%(2*Math.PI)),this.driver.head&&(this.driver.head.trail&&this.driver.head.trail.emit(this.driver.head.body.position.x,this.driver.head.body.position.y),this.driver.head.update(t)),this.boost.update(t,this.hasGround)},e.prototype.updateWheelie=function(t){h.MaxGameCore.instance.finished||(this.hasGround?this.frame.hasGround?this.wheelieTimer>0&&this.wheelieComplete():this.backWheel.hasGround&&!this.frontWheel.hasGround||!this.backWheel.hasGround&&this.frontWheel.hasGround?(this.wheelieTimer+=t,this.wheelieTimer>1&&this.callbackWheelie&&this.callbackWheelie(this.wheelieTimer,!1)):this.wheelieTimer>0&&this.wheelieComplete():this.wheelieTimer>0&&this.wheelieComplete())},e.prototype.wheelieComplete=function(){this.wheelieTimer>1&&this.callbackWheelie&&this.callbackWheelie(this.wheelieTimer,!0),this.wheelieTimer=0},e.prototype.setAlpha=function(t){this.frame.graphic.alpha=this.backWheel.graphic.alpha=this.frontWheel.graphic.alpha=t},e.prototype.processLand=function(){if(!h.MaxGameCore.instance.finished){if(!this.dead&&(this.backWheel.hasGround||this.frontWheel.hasGround)){var t=void 0,e=Math.PI,i=(t=this.startFlyAngle-this.minFlyAngle)/(2*Math.PI)>>0;(t-=2*i*Math.PI)>=e&&i++;var s=i;t=this.maxFlyAngle-this.startFlyAngle,(t-=2*(i=t/(2*Math.PI)>>0)*Math.PI)>=e&&i++;var n=i;s>0&&this.callbackStunt&&this.callbackStunt.call(this.callbackContext,s,!0),n>0&&this.callbackStunt&&this.callbackStunt.call(this.callbackContext,n,!1)}this.startFlyAngle=this.maxFlyAngle=this.minFlyAngle=this.rotation}},e.prototype.applyDrive=function(t,e,i){var s=!1,n=!1;this.finished||(1===i?s=!0:-1===i&&(n=!0));var o=this.accelTorque,a=this.maxAngularVel;if(this.deltaTorque>0&&(s||n)){var r=this.speed/this.wheelRadius;if(r<a){var h,l=.5+2.5*r/a;h=(1/(l*l)-1/9)/(4-1/9),o=this.accelTorque+h*this.deltaTorque}}this.frontWheel.brake(n),this.backWheel.brake(n);for(var c=this.wdWheels.length,u=a,d=0;d<c;d++){var p=this.wdWheels[d];this.finished?p.angularVel*=.8:(s?(p.angularVel<0&&(p.angularVel*=.5),p.angularVel<a&&p.applyAngularImpulse(t*o/c)):n?(p.angularVel>0&&(p.angularVel*=.5),p.angularVel>-a&&p.applyAngularImpulse(-t*o/c)):e||(p.angularVel*=this.dampingDelta),Math.abs(p.angularVel)<u&&(u=Math.abs(p.angularVel)))}},e.prototype.applyTilt=function(t,e){this.tilt=e;var i=this.frame.body;i.torque=e*this.tiltTorque;var s=i.angularVel;if(s<0&&s<-this.maxTiltSpeed?i.angularVel=-this.maxTiltSpeed:s>0&&s>this.maxTiltSpeed&&(i.angularVel=this.maxTiltSpeed),this.driver){var n=e;if(0===n)if(this.hasGround)this.controller.accell&&(n=-1);else{var o=this.frame.body.velocity.y;o<-20?n=1:o>20&&(n=-1)}this.driver.move(e,n)}},e.prototype.setReviewPos=function(t,e,i){this.safeId=i,this.frame.body.userData.reviewX=t,this.frame.body.userData.reviewY=e},e.prototype.review=function(){h.MaxGameCore.instance.stopAllSounds(),u.default.loadedLevel&&(h.MaxGameCore.instance.engineStart=l.default.getInstance().play(c.Sounds.Start)),this.wheelieTimer=0,this.backWheel.connect(!1),this.frontWheel.connect(!1),this.driver.connectDriver(!1),this.driver.connect(!1),r.NapeUtil.stopBody(this.frame.body),r.NapeUtil.stopBody(this.backWheel.body),r.NapeUtil.stopBody(this.frontWheel.body),this.driver.stop(),this.frame.review(),this.startFlyAngle=this.maxFlyAngle=this.minFlyAngle=this.rotation=this.frame.body.rotation;var t=o.get(-this.frame.wheelBackDx,this.frame.wheelDy),e=this.frame.body.localPointToWorld(t);this.backWheel.body.position.set(e),e.dispose(),t.setxy(this.frame.wheelFrontDx,this.frame.wheelDy),e=this.frame.body.localPointToWorld(t),this.frontWheel.body.position.set(e),e.dispose(),t.dispose(),this.driver.review(this.frame.body.position),this.backWheel.connect(!0),this.frontWheel.connect(!0),this.driver.connectDriver(!0),this.driver.connect(!0),this.driver.activateMirrorParts(!1),this.dead=!1,this._drive=!0,this.boost.restart()},e.prototype.setVisible=function(t){this.frame.graphic.visible=this.backWheel.graphic.visible=this.frontWheel.graphic.visible=t},e.prototype.processFinish=function(t){this.wheelieComplete(),this._drive=!1,this.finished=!0,this.applyTilt(0,0),h.MaxGameCore.instance.processFinish()},e.SMOKE_TIME=.2,e}(r.GameObject);e.CarObject=d},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(1),a=i(6),r=i(2),h=function(t){function e(e){var i=t.call(this)||this;return i.type=e?o.ObjectTypes.LANDSCAPE:o.ObjectTypes.FRONT,i}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null);var e=t.className,i=parseInt(e.substr(3));(13===i||14===i||15===i||16===i||36===i||42===i||i>=50&&i<=60)&&(this.type=o.ObjectTypes.LANDSCAPE_BACK);var s=e.indexOf("_dup");s>=0&&(e=e.substring(0,s));var h=r.AssetsStorage.instance.getByKey(e);if(h){var l=h+"0000";this.graphic=n.GraphicUtil.game.add.sprite(0,0,n.GraphicUtil.currentAtlass,l),n.Drawing.setTransform(this.graphic,t.params.x,t.params.y,a.default.TO_RAD*t.params.rotation,0,0,t.params.scaleX,t.params.scaleY),0===l.indexOf("Sign")&&"SignPillar0000"!==l&&(this.type=o.ObjectTypes.LANDSCAPE);var c=this.graphic;"Dec120000"===l?(c.animations.add(e,Phaser.Animation.generateFrameNames(e,0,22,"",4)),c.anchor.set(.5,.7),c.animations.getAnimation(e).play(30,!0)):"Dec130000"===l?c.anchor.set(.22142857142857142,.4854771784232365):"Dec140000"===l?c.anchor.set(.7979274611398963,.5563380281690141):"Dec150000"===l?c.anchor.set(.4943820224719101,.023255813953488372):"Dec160000"===l?c.anchor.set(.6333333333333333,.4309623430962343):"Dec290000"===l?c.anchor.set(.453125,.6987951807228916):"Dec300000"===l?c.anchor.set(.6375,1):"Dec310000"===l?c.anchor.set(.5,1):"Dec320000"===l?c.anchor.set(.5,1):"Dec330000"===l?c.anchor.set(.5025641025641026,.5116279069767442):"Dec340000"===l?c.anchor.set(.5,.5):"Dec350000"===l?c.anchor.set(.052,.451):"Dec360000"===l?c.anchor.set(.07142857142857142,.45121951219512196):"Dec370000"===l?c.anchor.set(.7326732673267327,.46619217081850534):"Dec400000"===l?c.anchor.set(.5,.47540983606557374):"Dec410000"===l?c.anchor.set(.37142857142857144,.5):"Dec420000"===l?c.anchor.set(.6470588235294118,.5):"Dec600000"===l?c.anchor.set(0):0===l.indexOf("Dec5")?c.anchor.set(0):c.anchor.set(.5)}},e}(n.GameObject);e.DecorObject=h},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(1),r=i(5),h=i(7),l=i(2),c=function(t){function e(e,i){var s=t.call(this)||this;return s.id=e,s.parentKey=i,s}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=a.ObjectTypes.LANDSCAPE;l.AssetsStorage.instance;var e=this.parentKey+this.id.toString();this.graphic=r.GraphicUtil.createImage(0,0,0,e),this.body=o.NapeUtil.createCircleBody(n.DYNAMIC,h.Filters.NOTHING,!1,4),this.body.userData.graphicEx=this.graphic},e.prototype.restart=function(){this.killTweenLite(),this.body.space=null,this.graphic.visible=!1},e.prototype.release=function(){this.killTweenLite(),t.prototype.release.call(this)},e.prototype.activate=function(t,e,i){this.killTweenLite(),o.NapeUtil.stopBody(this.body),this.tweenLite=r.GraphicUtil.game.add.tween(this),this.tweenLite.to({x:100},5e3),this.tweenLite.start(),this.tweenLite.onComplete.addOnce(this.deactivate,this,0,this),this.body.position=t,this.body.rotation=e,this.body.space=o.NapePhysics.space,this.graphic.visible=!0},e.prototype.killTweenLite=function(){this.tweenLite&&(this.tweenLite.onComplete.removeAll(),this.tweenLite=null)},e.prototype.deactivate=function(t){t.restart()},e}(o.GameObject);e.GlassBlockPart=c},function(t,e,i){"use strict";e.__esModule=!0;var s=nape.geom.GeomPoly,n=nape.geom.GeomPolyList,o=nape.geom.Vec2,a=nape.phys.Body,r=nape.phys.BodyType,h=nape.shape.Polygon,l=i(6),c=i(0),u=function(){function t(){}return t.createGroundBody=function(e){var i=e.params.x,s=e.params.y,n=e.params.vertices,h=n.length,u=NaN,d=NaN,p=null!=e.params.thick?e.params.thick:128,f=e.params.direction*l.default.TO_RAD,y=e.params.directed,g=c.Materials.GROUND,m=new a(r.STATIC,o.weak(i,s));m.cbTypes.add(c.CbTypes.GROUND);var v,b=n[0];v=[b];for(var x,_=1;_<h;_++){b=n[_];var w=v[v.length-1],P=v.length;if(1===P)v[P]=b,x=o.weak(b.x-w.x,b.y-w.y).angle,isNaN(u)&&(u=x+.5*Math.PI);else{var C=o.weak(b.x-w.x,b.y-w.y).angle;if(l.default.normalizeAngle(C-x)<0){if(!y){var T=o.fromPolar(1,x),S=o.fromPolar(1,C);d=T.sub(S,!0).angle,T.dispose(),S.dispose()}t.addGroundShape(m,v,f,y,u,d,g,p),u=d,v=[w,b]}else v[v.length]=b;x=C}}return t.addGroundShape(m,v,f,y,u,x+.5*Math.PI,g,p),0===m.shapes.length?null:(m.align(),m)},t.addGroundShape=function(e,i,n,a,r,l,u,d){var p,f=[],y=i.length;for(p=0;p<y;p++){var g=i[p];if(null==g)return;var m=o.get(g.x,g.y);0===p&&(f[f.length]=a?o.get(m.x+Math.cos(n)*d,m.y+Math.sin(n)*d):o.get(m.x+Math.cos(r)*d,m.y+Math.sin(r)*d)),f[f.length]=m,p===y-1&&(f[f.length]=a?o.get(m.x+Math.cos(n)*d,m.y+Math.sin(n)*d):o.get(m.x+Math.cos(l)*d,m.y+Math.sin(l)*d))}var v,b=s.get(f);if(b.isConvex())v=new h(f,u,c.Filters.GROUND),e.shapes.add(v);else for(b.convexDecomposition(!1,t.geomPolyList);!t.geomPolyList.empty();)(b=t.geomPolyList.pop()).isConvex()&&(v=new h(b,u,c.Filters.GROUND),e.shapes.add(v));for(b.dispose(),y=f.length,p=0;p<y;p++)f[p].dispose();e.userData.isGround=!0},t.geomPolyList=new n,t}();e.PhysicUtil=u},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(1),r=i(7),h=i(6),l=i(5),c=i(10),u=i(8),d=i(4),p=i(2),f=function(t){function e(){var e=t.call(this)||this;return e.activeOnStart=!0,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=a.ObjectTypes.OBJECT,null!==t.params.id&&(this.id=t.params.id),this.safeId=t.params.safeId,this.safeId<=-10&&(this.skipRevive=!0);var e=p.AssetsStorage.instance,i=t.className,s=e.getByKey(i+"_data"),d=t.params,f=d.x,y=d.y,g=t.params.rotation*h.default.TO_RAD;this.activateGraphic=1==d.ag,this.showGraphicOnStart=1==d.sgos;var m,v=!1;if(m=1==d.plr?r.Filters.PLAYER_ONLY:r.Filters.GROUND,null==s){if(0==i.indexOf("Ball")){var b=.5*parseFloat(i.substring(4,i.length-1))*d.scaleX;this.body=o.NapeUtil.createCircleBody(n.DYNAMIC,m,!1,b,f,y,g,c.CbTypes.GROUND,u.Materials.DEFAULT)}else if(0==i.indexOf("SpikeBall")){b=.5*parseFloat(i.substring(9,i.length-1))*d.scaleX;this.body=o.NapeUtil.createCircleBody(n.DYNAMIC,m,!1,b,f,y,g,c.CbTypes.SPIKES,u.Materials.DEFAULT)}v=1==d.btg}else"reg"===s.shape?this.body=o.NapeUtil.createRegularBody(n.DYNAMIC,m,!1,s.w,s.h,8,f,y,g,null,u.Materials.DEFAULT):"rect"===s.shape?this.body=o.NapeUtil.createRectBodyWH(n.DYNAMIC,m,!1,s.w,s.h,f,y,g,null,u.Materials.DEFAULT):"circ"===s.shape&&(this.body=o.NapeUtil.createCircleBody(n.DYNAMIC,m,!1,.5*s.w,f,y,g,null,u.Materials.DEFAULT));i.indexOf("Removed")>=0?(this.graphic=l.GraphicUtil.createImageWithObj(d,"RemovedBlue"),this.graphic.scaleY=s.h/this.graphic.height):this.graphic=l.GraphicUtil.createImageWithObj(d,i),this.type=v?a.ObjectTypes.LANDSCAPE_BACK:a.ObjectTypes.LANDSCAPE,o.NapeUtil.setupStartPos(this.body),this.body.userData.graphicEx=this.graphic,i.indexOf("Barrel")>=0&&this.body.cbTypes.add(c.CbTypes.BARREL),0===i.indexOf("Removed")&&this.body.cbTypes.add(c.CbTypes.WOOD),this.body.userData.isGround=!0,this.body.userData.isPT=!0,!1===t.params.active?this.activeOnStart=!1:this.activeOnStart=!0},e.prototype.restart=function(){o.NapeUtil.stopBody(this.body),o.NapeUtil.resetStartPos(this.body),this.showGraphicOnStart&&(this.isInitial=!0),this.graphic.x=this.body.position.x,this.graphic.y=this.body.position.y,this.graphic.rotation=this.body.rotation,this.activate(this.activeOnStart)},e.prototype.review=function(){this.skipRevive||this.restart()},e.prototype.activate=function(t){var e,i;if(void 0===t&&(t=!0),t){for(this.body.space=d.MaxGameCore.instance.getSpace(),e=this.body.constraints.iterator();e.hasNext();)(i=e.next()).active=!0;this.activateGraphic&&(this.graphic.visible=!0)}else{for(e=this.body.constraints.iterator();e.hasNext();)(i=e.next()).active=!1,i.userData.skipActive=!0;this.body.space=null,this.activateGraphic&&(this.isInitial&&this.showGraphicOnStart?this.graphic.visible=!0:this.graphic.visible=!1)}this.isInitial=!1},e.prototype.isActive=function(){return this.activeOnStart},e.CANDIES=["PlankCandy0","PlankCandy1","PlankCandy2","PlankCandy3"],e.CANDIES_COUNT=4,e}(o.GameObject);e.DynamicBodyObject=f},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(t){this.accell=!1,this.brake=!1,this.car=t}return t.prototype.getBoost=function(){return!1},t.prototype.getDrive=function(){return 0},t.prototype.getTilt=function(){return 0},t.prototype.getUseItem=function(){return!1},t.prototype.dispose=function(){this.car=null},t}();e.CarController=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0,i(55),i(12),i(11);var n,o=i(60),a=i(61),r=i(39),h=i(36);!function(t){var e=function(t){function e(){var e=t.call(this,{enableDebug:!0,width:720,height:480,renderer:Phaser.AUTO,parent:"content",transparent:!0,antialias:!0,preserveDrawingBuffer:!1,physicsConfig:null,seed:"",state:null,forceSetTimeOut:!1})||this;return e.clearBeforeRender=!1,Phaser.Device.whenReady(function(){e.stage.disableVisibilityChange=!0;var t=e.device.desktop?"click":"touchstart";document.getElementById("content").addEventListener(t,function(t){e.gameResumed(t),window.focus()}),document.getElementById("content").addEventListener("SDK_GAME_START",function(t){e.adsResume()}),document.getElementById("content").addEventListener("SDK_GAME_PAUSE",function(t){e.adsPause()})}),e.state.add("game",{create:e.stateCreator.bind(e),preload:e.statePreloader.bind(e)},!0),e}return s(e,t),e.prototype.statePreloader=function(){var t=this;["https://cdn.jsdelivr.net/npm/@orange-games/phaser-cachebuster@2.0/build/phaser-cachebuster.min.js","https://cdn.jsdelivr.net/npm/@orange-games/phaser-super-storage@1.0/build/phaser-super-storage.min.js","assets/box2dweb/dragonBones.min.js"].forEach(function(e){t.load.script(e,e)})},e.prototype.stateCreator=function(){var t=this;this.plugins.add(PhaserSuperStorage.StoragePlugin),this.plugins.add(PhaserCachebuster.CacheBuster),this.storage.forcePromises=!0,this.state.add(a.Boot.Name,a.Boot,!1),this.state.add(r.default.Name,r.default,!1),this.state.add(a.Menu.Name,a.Menu,!1),this.state.add(a.Garage.Name,a.Garage,!1),this.state.add(a.ChooseZone.Name,a.ChooseZone,!1),this.state.add(a.Gameplay.Name,a.Gameplay,!1);var e=function(){t.recursiveUpdateText(t.stage)};o.load({custom:{families:["Aller Display","CfCrackBold","Impact"],urls:["assets/css/AllerDisplay.css","assets/css/CfCrackBold.css","assets/css/impact.css"]},active:e,inactive:e}),!0!==window.famobi_started?document.getElementById("content").addEventListener("start_game",function(e){t.state.start(a.Boot.Name),t.state.remove("game")}):(this.state.start(a.Boot.Name),this.state.remove("game"))},e.prototype.recursiveUpdateText=function(t){var e=this;t instanceof Phaser.Text&&(t.dirty=!0),t.children&&t.children.length>0&&t.children.forEach(function(t){e.recursiveUpdateText(t)})},e.prototype.adsResume=function(){this.sound.mute=!1,a.Gameplay.isAdsPause=!1},e.prototype.adsPause=function(){this.sound.mute=!0,a.Gameplay.isAdsPause=!0,h.default.instance.signalPause&&h.default.instance.signalPause.dispatch()},e}(Phaser.Game);t.Game=e}(n||(n={})),new n.Game},function(t,e,i){(function(e){t.exports=e.p2=i(56)}).call(e,i(27))},function(t,e,i){var s;t.exports=function t(e,i,n){function o(r,h){if(!i[r]){if(!e[r]){var l="function"==typeof s&&s;if(!h&&l)return s(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};e[r][0].call(c.exports,function(t){var i=e[r][1][t];return o(i||t)},c,c.exports,t,e,i,n)}return i[r].exports}for(var a="function"==typeof s&&s,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(t,e,i){function s(){}var n=t("./Scalar");e.exports=s,s.lineInt=function(t,e,i){i=i||0;var s,o,a,r,h,l,c,u=[0,0];return s=t[1][1]-t[0][1],o=t[0][0]-t[1][0],a=s*t[0][0]+o*t[0][1],r=e[1][1]-e[0][1],h=e[0][0]-e[1][0],l=r*e[0][0]+h*e[0][1],c=s*h-r*o,n.eq(c,0,i)||(u[0]=(h*a-o*l)/c,u[1]=(s*l-r*a)/c),u},s.segmentsIntersect=function(t,e,i,s){var n=e[0]-t[0],o=e[1]-t[1],a=s[0]-i[0],r=s[1]-i[1];if(a*o-r*n==0)return!1;var h=(n*(i[1]-t[1])+o*(t[0]-i[0]))/(a*o-r*n),l=(a*(t[1]-i[1])+r*(i[0]-t[0]))/(r*n-a*o);return h>=0&&h<=1&&l>=0&&l<=1}},{"./Scalar":4}],2:[function(t,e,i){function s(){}e.exports=s,s.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},s.left=function(t,e,i){return s.area(t,e,i)>0},s.leftOn=function(t,e,i){return s.area(t,e,i)>=0},s.right=function(t,e,i){return s.area(t,e,i)<0},s.rightOn=function(t,e,i){return s.area(t,e,i)<=0};var n=[],o=[];s.collinear=function(t,e,i,a){if(a){var r=n,h=o;r[0]=e[0]-t[0],r[1]=e[1]-t[1],h[0]=i[0]-e[0],h[1]=i[1]-e[1];var l=r[0]*h[0]+r[1]*h[1],c=Math.sqrt(r[0]*r[0]+r[1]*r[1]),u=Math.sqrt(h[0]*h[0]+h[1]*h[1]);return Math.acos(l/(c*u))<a}return 0==s.area(t,e,i)},s.sqdist=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s}},{}],3:[function(t,e,i){function s(){this.vertices=[]}function n(t,e,i,s,n){n=n||0;var o=e[1]-t[1],a=t[0]-e[0],h=o*t[0]+a*t[1],l=s[1]-i[1],c=i[0]-s[0],u=l*i[0]+c*i[1],d=o*c-l*a;return r.eq(d,0,n)?[0,0]:[(c*h-a*u)/d,(o*u-l*h)/d]}var o=t("./Line"),a=t("./Point"),r=t("./Scalar");e.exports=s,s.prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},s.prototype.first=function(){return this.vertices[0]},s.prototype.last=function(){return this.vertices[this.vertices.length-1]},s.prototype.clear=function(){this.vertices.length=0},s.prototype.append=function(t,e,i){if(void 0===e)throw new Error("From is not given!");if(void 0===i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var s=e;s<i;s++)this.vertices.push(t.vertices[s])},s.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);a.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},s.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},s.prototype.isReflex=function(t){return a.right(this.at(t-1),this.at(t),this.at(t+1))};var h=[],l=[];s.prototype.canSee=function(t,e){var i,s,n=h,r=l;if(a.leftOn(this.at(t+1),this.at(t),this.at(e))&&a.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;s=a.sqdist(this.at(t),this.at(e));for(var c=0;c!==this.vertices.length;++c)if((c+1)%this.vertices.length!==t&&c!==t&&a.leftOn(this.at(t),this.at(e),this.at(c+1))&&a.rightOn(this.at(t),this.at(e),this.at(c))&&(n[0]=this.at(t),n[1]=this.at(e),r[0]=this.at(c),r[1]=this.at(c+1),i=o.lineInt(n,r),a.sqdist(this.at(t),i)<s))return!1;return!0},s.prototype.copy=function(t,e,i){var n=i||new s;if(n.clear(),t<e)for(var o=t;o<=e;o++)n.vertices.push(this.vertices[o]);else{for(var o=0;o<=e;o++)n.vertices.push(this.vertices[o]);for(var o=t;o<this.vertices.length;o++)n.vertices.push(this.vertices[o])}return n},s.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],n=new s,o=Number.MAX_VALUE,a=0;a<this.vertices.length;++a)if(this.isReflex(a))for(var r=0;r<this.vertices.length;++r)if(this.canSee(a,r)){e=this.copy(a,r,n).getCutEdges(),i=this.copy(r,a,n).getCutEdges();for(var h=0;h<i.length;h++)e.push(i[h]);e.length<o&&(t=e,o=e.length,t.push([this.at(a),this.at(r)]))}return t},s.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},s.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var s=t[i],n=0;n<e.length;n++){var o=e[n],a=o.slice(s);if(a){e.splice(n,1),e.push(a[0],a[1]);break}}return e}var s=t,i=this.vertices.indexOf(s[0]),n=this.vertices.indexOf(s[1]);return-1!=i&&-1!=n&&[this.copy(i,n),this.copy(n,i)]},s.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(o.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(var e=1;e<t.length-2;e++)if(o.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},s.prototype.quickDecomp=function(t,e,i,o,r,h){r=r||100,h=h||0,o=o||25,t=void 0!==t?t:[],e=e||[],i=i||[];var l=[0,0],c=[0,0],u=[0,0],d=0,p=0,f=0,y=0,g=0,m=0,v=0,b=new s,x=new s,_=this,w=this.vertices;if(w.length<3)return t;if(++h>r)return t;for(var P=0;P<this.vertices.length;++P)if(_.isReflex(P)){e.push(_.vertices[P]),d=p=Number.MAX_VALUE;for(var C=0;C<this.vertices.length;++C)a.left(_.at(P-1),_.at(P),_.at(C))&&a.rightOn(_.at(P-1),_.at(P),_.at(C-1))&&(u=n(_.at(P-1),_.at(P),_.at(C),_.at(C-1)),a.right(_.at(P+1),_.at(P),u)&&(f=a.sqdist(_.vertices[P],u))<p&&(p=f,c=u,m=C)),a.left(_.at(P+1),_.at(P),_.at(C+1))&&a.rightOn(_.at(P+1),_.at(P),_.at(C))&&(u=n(_.at(P+1),_.at(P),_.at(C),_.at(C+1)),a.left(_.at(P-1),_.at(P),u)&&(f=a.sqdist(_.vertices[P],u))<d&&(d=f,l=u,g=C));if(m==(g+1)%this.vertices.length)u[0]=(c[0]+l[0])/2,u[1]=(c[1]+l[1])/2,i.push(u),P<g?(b.append(_,P,g+1),b.vertices.push(u),x.vertices.push(u),0!=m&&x.append(_,m,_.vertices.length),x.append(_,0,P+1)):(0!=P&&b.append(_,P,_.vertices.length),b.append(_,0,g+1),b.vertices.push(u),x.vertices.push(u),x.append(_,m,P+1));else{if(m>g&&(g+=this.vertices.length),y=Number.MAX_VALUE,g<m)return t;for(var C=m;C<=g;++C)a.leftOn(_.at(P-1),_.at(P),_.at(C))&&a.rightOn(_.at(P+1),_.at(P),_.at(C))&&(f=a.sqdist(_.at(P),_.at(C)))<y&&(y=f,v=C%this.vertices.length);P<v?(b.append(_,P,v+1),0!=v&&x.append(_,v,w.length),x.append(_,0,P+1)):(0!=P&&b.append(_,P,w.length),b.append(_,0,v+1),x.append(_,v,P+1))}return b.vertices.length<x.vertices.length?(b.quickDecomp(t,e,i,o,r,h),x.quickDecomp(t,e,i,o,r,h)):(x.quickDecomp(t,e,i,o,r,h),b.quickDecomp(t,e,i,o,r,h)),t}return t.push(this),t},s.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)a.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){function s(){}e.exports=s,s.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e,i){function s(t){this.lowerBound=n.create(),t&&t.lowerBound&&n.copy(this.lowerBound,t.lowerBound),this.upperBound=n.create(),t&&t.upperBound&&n.copy(this.upperBound,t.upperBound)}var n=t("../math/vec2");t("../utils/Utils"),e.exports=s;var o=n.create();s.prototype.setFromPoints=function(t,e,i,s){var a=this.lowerBound,r=this.upperBound;"number"!=typeof i&&(i=0),0!==i?n.rotate(a,t[0],i):n.copy(a,t[0]),n.copy(r,a);for(var h=Math.cos(i),l=Math.sin(i),c=1;c<t.length;c++){var u=t[c];if(0!==i){var d=u[0],p=u[1];o[0]=h*d-l*p,o[1]=l*d+h*p,u=o}for(var f=0;f<2;f++)u[f]>r[f]&&(r[f]=u[f]),u[f]<a[f]&&(a[f]=u[f])}e&&(n.add(this.lowerBound,this.lowerBound,e),n.add(this.upperBound,this.upperBound,e)),s&&(this.lowerBound[0]-=s,this.lowerBound[1]-=s,this.upperBound[0]+=s,this.upperBound[1]+=s)},s.prototype.copy=function(t){n.copy(this.lowerBound,t.lowerBound),n.copy(this.upperBound,t.upperBound)},s.prototype.extend=function(t){for(var e=2;e--;){var i=t.lowerBound[e];this.lowerBound[e]>i&&(this.lowerBound[e]=i);var s=t.upperBound[e];this.upperBound[e]<s&&(this.upperBound[e]=s)}},s.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,s=t.lowerBound,n=t.upperBound;return(s[0]<=i[0]&&i[0]<=n[0]||e[0]<=n[0]&&n[0]<=i[0])&&(s[1]<=i[1]&&i[1]<=n[1]||e[1]<=n[1]&&n[1]<=i[1])},s.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},s.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],s=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,o=(this.lowerBound[1]-t.from[1])*i,a=(this.upperBound[1]-t.from[1])*i,r=Math.max(Math.max(Math.min(s,n),Math.min(o,a))),h=Math.min(Math.min(Math.max(s,n),Math.max(o,a)));return h<0?-1:r>h?-1:r}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){function s(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=s.AABB}var n=t("../math/vec2"),o=t("../objects/Body");e.exports=s,s.AABB=1,s.BOUNDING_CIRCLE=2,s.prototype.setWorld=function(t){this.world=t},s.prototype.getCollisionPairs=function(t){};var a=n.create();s.boundingRadiusCheck=function(t,e){n.sub(a,t.position,e.position);var i=n.squaredLength(a),s=t.boundingRadius+e.boundingRadius;return i<=s*s},s.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},s.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case s.BOUNDING_CIRCLE:i=s.boundingRadiusCheck(t,e);break;case s.AABB:i=s.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},s.canCollide=function(t,e){var i=o.KINEMATIC,s=o.STATIC;return!(t.type===s&&e.type===s||t.type===i&&e.type===s||t.type===s&&e.type===i||t.type===i&&e.type===i||t.sleepState===o.SLEEPING&&e.sleepState===o.SLEEPING||t.sleepState===o.SLEEPING&&e.type===s||e.sleepState===o.SLEEPING&&t.type===s)},s.NAIVE=1,s.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){function s(){n.call(this,n.NAIVE)}t("../shapes/Circle"),t("../shapes/Plane"),t("../shapes/Shape"),t("../shapes/Particle");var n=t("../collision/Broadphase");t("../math/vec2"),e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var s=0,o=e.length;s!==o;s++)for(var a=e[s],r=0;r<s;r++){var h=e[r];n.canCollide(a,h)&&this.boundingVolumeCheck(a,h)&&i.push(a,h)}return i},s.prototype.aabbQuery=function(t,e,i){i=i||[];for(var s=t.bodies,n=0;n<s.length;n++){var o=s[n];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(e)&&i.push(o)}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){function s(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new c({size:32}),this.frictionEquationPool=new u({size:64}),this.restitution=0,this.stiffness=p.DEFAULT_STIFFNESS,this.relaxation=p.DEFAULT_RELAXATION,this.frictionStiffness=p.DEFAULT_STIFFNESS,this.frictionRelaxation=p.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new d,this.contactSkinSize=.01}function n(t,e){a.set(t.vertices[0],.5*-e.length,-e.radius),a.set(t.vertices[1],.5*e.length,-e.radius),a.set(t.vertices[2],.5*e.length,e.radius),a.set(t.vertices[3],.5*-e.length,e.radius)}function o(t,e,i,s){for(var n=V,o=Y,l=q,c=z,u=t,d=e.vertices,p=null,f=0;f!==d.length+1;f++){var y=d[f%d.length],g=d[(f+1)%d.length];a.rotate(n,y,s),a.rotate(o,g,s),h(n,n,i),h(o,o,i),r(l,n,u),r(c,o,u);var m=a.crossLength(l,c);if(null===p&&(p=m),m*p<=0)return!1;p=m}return!0}var a=t("../math/vec2"),r=a.sub,h=a.add,l=a.dot,c=(t("../utils/Utils"),t("../utils/ContactEquationPool")),u=t("../utils/FrictionEquationPool"),d=t("../utils/TupleDictionary"),p=t("../equations/Equation"),f=(t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("../shapes/Circle")),y=t("../shapes/Convex"),g=t("../shapes/Shape"),m=(t("../objects/Body"),t("../shapes/Box"));e.exports=s;var v=a.fromValues(0,1),b=a.fromValues(0,0),x=a.fromValues(0,0),_=a.fromValues(0,0),w=a.fromValues(0,0),P=a.fromValues(0,0),C=a.fromValues(0,0),T=a.fromValues(0,0),S=a.fromValues(0,0),A=a.fromValues(0,0),E=a.fromValues(0,0),I=a.fromValues(0,0),M=a.fromValues(0,0),O=a.fromValues(0,0),R=a.fromValues(0,0),B=a.fromValues(0,0),L=a.fromValues(0,0),D=a.fromValues(0,0),k=a.fromValues(0,0),F=[],G=a.create(),U=a.create();s.prototype.bodiesOverlap=function(t,e){for(var i=G,s=U,n=0,o=t.shapes.length;n!==o;n++){var a=t.shapes[n];t.toWorldFrame(i,a.position);for(var r=0,h=e.shapes.length;r!==h;r++){var l=e.shapes[r];if(e.toWorldFrame(s,l.position),this[a.type|l.type](t,a,i,a.angle+t.angle,e,l,s,l.angle+e.angle,!0))return!0}}return!1},s.prototype.collidedLastStep=function(t,e){var i=0|t.id,s=0|e.id;return!!this.collidingBodiesLastStep.get(i,s)},s.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],s=i.bodyA.id,n=i.bodyB.id;this.collidingBodiesLastStep.set(s,n,!0)}for(var o=this.contactEquations,a=this.frictionEquations,r=0;r<o.length;r++)this.contactEquationPool.release(o[r]);for(var r=0;r<a.length;r++)this.frictionEquationPool.release(a[r]);this.contactEquations.length=this.frictionEquations.length=0},s.prototype.createContactEquation=function(t,e,i,s){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=s,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},s.prototype.createFrictionEquation=function(t,e,i,s){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=s,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},s.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return a.copy(e.contactPointA,t.contactPointA),a.copy(e.contactPointB,t.contactPointB),a.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},s.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),s=e.bodyA;e.bodyB,a.set(i.contactPointA,0,0),a.set(i.contactPointB,0,0),a.set(i.t,0,0);for(var n=0;n!==t;n++)(e=this.contactEquations[this.contactEquations.length-1-n]).bodyA===s?(a.add(i.t,i.t,e.normalA),a.add(i.contactPointA,i.contactPointA,e.contactPointA),a.add(i.contactPointB,i.contactPointB,e.contactPointB)):(a.sub(i.t,i.t,e.normalA),a.add(i.contactPointA,i.contactPointA,e.contactPointB),a.add(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var o=1/t;return a.scale(i.contactPointA,i.contactPointA,o),a.scale(i.contactPointB,i.contactPointB,o),a.normalize(i.t,i.t),a.rotate90cw(i.t,i.t),i},s.prototype[g.LINE|g.CONVEX]=s.prototype.convexLine=function(t,e,i,s,n,o,a,r,h){return!h&&0},s.prototype[g.LINE|g.BOX]=s.prototype.lineBox=function(t,e,i,s,n,o,a,r,h){return!h&&0};var N=new m({width:1,height:1}),j=a.create();s.prototype[g.CAPSULE|g.CONVEX]=s.prototype[g.CAPSULE|g.BOX]=s.prototype.convexCapsule=function(t,e,i,s,o,r,h,l,c){var u=j;a.set(u,r.length/2,0),a.rotate(u,u,l),a.add(u,u,h);var d=this.circleConvex(o,r,u,l,t,e,i,s,c,r.radius);a.set(u,-r.length/2,0),a.rotate(u,u,l),a.add(u,u,h);var p=this.circleConvex(o,r,u,l,t,e,i,s,c,r.radius);if(c&&(d||p))return!0;var f=N;return n(f,r),this.convexConvex(t,e,i,s,o,f,h,l,c)+d+p},s.prototype[g.CAPSULE|g.LINE]=s.prototype.lineCapsule=function(t,e,i,s,n,o,a,r,h){return!h&&0};var W=a.create(),X=a.create(),H=new m({width:1,height:1});s.prototype[g.CAPSULE|g.CAPSULE]=s.prototype.capsuleCapsule=function(t,e,i,s,o,r,h,l,c){for(var u=W,d=X,p=0,f=0;f<2;f++){a.set(u,(0===f?-1:1)*e.length/2,0),a.rotate(u,u,s),a.add(u,u,i);for(var y=0;y<2;y++){a.set(d,(0===y?-1:1)*r.length/2,0),a.rotate(d,d,l),a.add(d,d,h),this.enableFrictionReduction&&(b=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,u,s,o,r,d,l,c,e.radius,r.radius);if(this.enableFrictionReduction&&(this.enableFriction=b),c&&g)return!0;p+=g}}this.enableFrictionReduction&&(b=this.enableFriction,this.enableFriction=!1);var m=H;n(m,e);var v=this.convexCapsule(t,m,i,s,o,r,h,l,c);if(this.enableFrictionReduction&&(this.enableFriction=b),c&&v)return!0;if(p+=v,this.enableFrictionReduction){var b=this.enableFriction;this.enableFriction=!1}n(m,r);var x=this.convexCapsule(o,m,h,l,t,e,i,s,c);return this.enableFrictionReduction&&(this.enableFriction=b),!(!c||!x)||(p+=x,this.enableFrictionReduction&&p&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(p)),p)},s.prototype[g.LINE|g.LINE]=s.prototype.lineLine=function(t,e,i,s,n,o,a,r,h){return!h&&0},s.prototype[g.PLANE|g.LINE]=s.prototype.planeLine=function(t,e,i,s,n,o,c,u,d){var p=b,f=x,y=_,g=w,m=P,E=C,I=T,M=S,O=A,R=F,B=0;a.set(p,-o.length/2,0),a.set(f,o.length/2,0),a.rotate(y,p,u),a.rotate(g,f,u),h(y,y,c),h(g,g,c),a.copy(p,y),a.copy(f,g),r(m,f,p),a.normalize(E,m),a.rotate90cw(O,E),a.rotate(M,v,s),R[0]=p,R[1]=f;for(var L=0;L<R.length;L++){var D=R[L];r(I,D,i);var k=l(I,M);if(k<0){if(d)return!0;var G=this.createContactEquation(t,n,e,o);B++,a.copy(G.normalA,M),a.normalize(G.normalA,G.normalA),a.scale(I,M,k),r(G.contactPointA,D,I),r(G.contactPointA,G.contactPointA,t.position),r(G.contactPointB,D,c),h(G.contactPointB,G.contactPointB,c),r(G.contactPointB,G.contactPointB,n.position),this.contactEquations.push(G),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G))}}return!d&&(this.enableFrictionReduction||B&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(B)),B)},s.prototype[g.PARTICLE|g.CAPSULE]=s.prototype.particleCapsule=function(t,e,i,s,n,o,a,r,h){return this.circleLine(t,e,i,s,n,o,a,r,h,o.radius,0)},s.prototype[g.CIRCLE|g.LINE]=s.prototype.circleLine=function(t,e,i,s,n,o,c,u,d,p,f){var p=p||0,f=void 0!==f?f:e.radius,y=b,g=x,m=_,v=w,B=P,L=C,D=T,k=S,G=A,U=E,N=I,j=M,W=O,X=R,H=F;a.set(k,-o.length/2,0),a.set(G,o.length/2,0),a.rotate(U,k,u),a.rotate(N,G,u),h(U,U,c),h(N,N,c),a.copy(k,U),a.copy(G,N),r(L,G,k),a.normalize(D,L),a.rotate90cw(B,D),r(j,i,k);var V=l(j,B);r(v,k,c),r(W,i,c);var Y=f+p;if(Math.abs(V)<Y){a.scale(y,B,V),r(m,i,y),a.scale(g,B,l(B,W)),a.normalize(g,g),a.scale(g,g,p),h(m,m,g);var q=l(D,m),z=l(D,k),K=l(D,G);if(q>z&&q<K){if(d)return!0;var J=this.createContactEquation(t,n,e,o);return a.scale(J.normalA,y,-1),a.normalize(J.normalA,J.normalA),a.scale(J.contactPointA,J.normalA,f),h(J.contactPointA,J.contactPointA,i),r(J.contactPointA,J.contactPointA,t.position),r(J.contactPointB,m,c),h(J.contactPointB,J.contactPointB,c),r(J.contactPointB,J.contactPointB,n.position),this.contactEquations.push(J),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(J)),1}}H[0]=k,H[1]=G;for(var Z=0;Z<H.length;Z++){var Q=H[Z];if(r(j,Q,i),a.squaredLength(j)<Math.pow(Y,2)){if(d)return!0;var J=this.createContactEquation(t,n,e,o);return a.copy(J.normalA,j),a.normalize(J.normalA,J.normalA),a.scale(J.contactPointA,J.normalA,f),h(J.contactPointA,J.contactPointA,i),r(J.contactPointA,J.contactPointA,t.position),r(J.contactPointB,Q,c),a.scale(X,J.normalA,-p),h(J.contactPointB,J.contactPointB,X),h(J.contactPointB,J.contactPointB,c),r(J.contactPointB,J.contactPointB,n.position),this.contactEquations.push(J),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(J)),1}}return 0},s.prototype[g.CIRCLE|g.CAPSULE]=s.prototype.circleCapsule=function(t,e,i,s,n,o,a,r,h){return this.circleLine(t,e,i,s,n,o,a,r,h,o.radius)},s.prototype[g.CIRCLE|g.CONVEX]=s.prototype[g.CIRCLE|g.BOX]=s.prototype.circleConvex=function(t,e,i,s,n,l,c,u,d,p){for(var p="number"==typeof p?p:e.radius,f=b,y=x,g=_,m=w,v=P,C=E,T=I,S=O,A=R,M=B,D=L,k=!1,F=Number.MAX_VALUE,G=l.vertices,U=0;U!==G.length+1;U++){var N=G[U%G.length],j=G[(U+1)%G.length];if(a.rotate(f,N,u),a.rotate(y,j,u),h(f,f,c),h(y,y,c),r(g,y,f),a.normalize(m,g),a.rotate90cw(v,m),a.scale(A,v,-e.radius),h(A,A,i),o(A,l,c,u)){a.sub(M,f,A);var W=Math.abs(a.dot(M,v));W<F&&(a.copy(D,A),F=W,a.scale(S,v,W),a.add(S,S,A),k=!0)}}if(k){if(d)return!0;var X=this.createContactEquation(t,n,e,l);return a.sub(X.normalA,D,i),a.normalize(X.normalA,X.normalA),a.scale(X.contactPointA,X.normalA,p),h(X.contactPointA,X.contactPointA,i),r(X.contactPointA,X.contactPointA,t.position),r(X.contactPointB,S,c),h(X.contactPointB,X.contactPointB,c),r(X.contactPointB,X.contactPointB,n.position),this.contactEquations.push(X),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(X)),1}if(p>0)for(var U=0;U<G.length;U++){var H=G[U];if(a.rotate(T,H,u),h(T,T,c),r(C,T,i),a.squaredLength(C)<Math.pow(p,2)){if(d)return!0;var X=this.createContactEquation(t,n,e,l);return a.copy(X.normalA,C),a.normalize(X.normalA,X.normalA),a.scale(X.contactPointA,X.normalA,p),h(X.contactPointA,X.contactPointA,i),r(X.contactPointA,X.contactPointA,t.position),r(X.contactPointB,T,c),h(X.contactPointB,X.contactPointB,c),r(X.contactPointB,X.contactPointB,n.position),this.contactEquations.push(X),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(X)),1}}return 0};var V=a.create(),Y=a.create(),q=a.create(),z=a.create();s.prototype[g.PARTICLE|g.CONVEX]=s.prototype[g.PARTICLE|g.BOX]=s.prototype.particleConvex=function(t,e,i,s,n,c,u,d,p){var f=b,y=x,g=_,m=w,v=P,S=C,A=T,I=E,M=O,R=D,B=k,L=Number.MAX_VALUE,F=!1,G=c.vertices;if(!o(i,c,u,d))return 0;if(p)return!0;for(var U=0;U!==G.length+1;U++){var N=G[U%G.length],j=G[(U+1)%G.length];a.rotate(f,N,d),a.rotate(y,j,d),h(f,f,u),h(y,y,u),r(g,y,f),a.normalize(m,g),a.rotate90cw(v,m),r(I,i,f),l(I,v),r(S,f,u),r(A,i,u),a.sub(R,f,i);var W=Math.abs(a.dot(R,v));W<L&&(L=W,a.scale(M,v,W),a.add(M,M,i),a.copy(B,v),F=!0)}if(F){var X=this.createContactEquation(t,n,e,c);return a.scale(X.normalA,B,-1),a.normalize(X.normalA,X.normalA),a.set(X.contactPointA,0,0),h(X.contactPointA,X.contactPointA,i),r(X.contactPointA,X.contactPointA,t.position),r(X.contactPointB,M,u),h(X.contactPointB,X.contactPointB,u),r(X.contactPointB,X.contactPointB,n.position),this.contactEquations.push(X),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(X)),1}return 0},s.prototype[g.CIRCLE]=s.prototype.circleCircle=function(t,e,i,s,n,o,l,c,u,d,p){var f=b,d=d||e.radius,p=p||o.radius;r(f,i,l);var y=d+p;if(a.squaredLength(f)>Math.pow(y,2))return 0;if(u)return!0;var g=this.createContactEquation(t,n,e,o);return r(g.normalA,l,i),a.normalize(g.normalA,g.normalA),a.scale(g.contactPointA,g.normalA,d),a.scale(g.contactPointB,g.normalA,-p),h(g.contactPointA,g.contactPointA,i),r(g.contactPointA,g.contactPointA,t.position),h(g.contactPointB,g.contactPointB,l),r(g.contactPointB,g.contactPointB,n.position),this.contactEquations.push(g),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(g)),1},s.prototype[g.PLANE|g.CONVEX]=s.prototype[g.PLANE|g.BOX]=s.prototype.planeConvex=function(t,e,i,s,n,o,c,u,d){var p=b,f=x,y=_,g=0;a.rotate(f,v,s);for(var m=0;m!==o.vertices.length;m++){var w=o.vertices[m];if(a.rotate(p,w,u),h(p,p,c),r(y,p,i),l(y,f)<=0){if(d)return!0;g++;var P=this.createContactEquation(t,n,e,o);r(y,p,i),a.copy(P.normalA,f);var C=l(y,P.normalA);a.scale(y,P.normalA,C),r(P.contactPointB,p,n.position),r(P.contactPointA,p,y),r(P.contactPointA,P.contactPointA,t.position),this.contactEquations.push(P),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P))}}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},s.prototype[g.PARTICLE|g.PLANE]=s.prototype.particlePlane=function(t,e,i,s,n,o,h,c,u){var d=b,p=x;c=c||0,r(d,i,h),a.rotate(p,v,c);var f=l(d,p);if(f>0)return 0;if(u)return!0;var y=this.createContactEquation(n,t,o,e);return a.copy(y.normalA,p),a.scale(d,y.normalA,f),r(y.contactPointA,i,d),r(y.contactPointA,y.contactPointA,n.position),r(y.contactPointB,i,t.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},s.prototype[g.CIRCLE|g.PARTICLE]=s.prototype.circleParticle=function(t,e,i,s,n,o,l,c,u){var d=b;if(r(d,l,i),a.squaredLength(d)>Math.pow(e.radius,2))return 0;if(u)return!0;var p=this.createContactEquation(t,n,e,o);return a.copy(p.normalA,d),a.normalize(p.normalA,p.normalA),a.scale(p.contactPointA,p.normalA,e.radius),h(p.contactPointA,p.contactPointA,i),r(p.contactPointA,p.contactPointA,t.position),r(p.contactPointB,l,n.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1};var K=new f({radius:1}),J=a.create(),Z=a.create();a.create(),s.prototype[g.PLANE|g.CAPSULE]=s.prototype.planeCapsule=function(t,e,i,s,n,o,r,l,c){var u,d=J,p=Z,f=K;a.set(d,-o.length/2,0),a.rotate(d,d,l),h(d,d,r),a.set(p,o.length/2,0),a.rotate(p,p,l),h(p,p,r),f.radius=o.radius,this.enableFrictionReduction&&(u=this.enableFriction,this.enableFriction=!1);var y=this.circlePlane(n,f,d,0,t,e,i,s,c),g=this.circlePlane(n,f,p,0,t,e,i,s,c);if(this.enableFrictionReduction&&(this.enableFriction=u),c)return y||g;var m=y+g;return this.enableFrictionReduction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},s.prototype[g.CIRCLE|g.PLANE]=s.prototype.circlePlane=function(t,e,i,s,n,o,c,u,d){var p=t,f=e,y=i,g=n,m=c,w=u;w=w||0;var P=b,C=x,T=_;r(P,y,m),a.rotate(C,v,w);var S=l(C,P);if(S>f.radius)return 0;if(d)return!0;var A=this.createContactEquation(g,p,o,e);return a.copy(A.normalA,C),a.scale(A.contactPointB,A.normalA,-f.radius),h(A.contactPointB,A.contactPointB,y),r(A.contactPointB,A.contactPointB,p.position),a.scale(T,A.normalA,S),r(A.contactPointA,P,T),h(A.contactPointA,A.contactPointA,m),r(A.contactPointA,A.contactPointA,g.position),this.contactEquations.push(A),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A)),1},s.prototype[g.CONVEX]=s.prototype[g.CONVEX|g.BOX]=s.prototype[g.BOX]=s.prototype.convexConvex=function(t,e,i,n,o,c,u,d,p,f){var y=b,g=x,m=_,v=w,C=P,E=T,I=S,M=A,O=0,f="number"==typeof f?f:0;if(!s.findSeparatingAxis(e,i,n,c,u,d,y))return 0;r(I,u,i),l(y,I)>0&&a.scale(y,y,-1);var R=s.getClosestEdge(e,n,y,!0),B=s.getClosestEdge(c,d,y);if(-1===R||-1===B)return 0;for(var L=0;L<2;L++){var D,k=R,F=B,G=e,U=c,N=i,j=u,W=n,X=d,H=t,V=o;0===L&&(D=k,k=F,F=D,D=G,G=U,U=D,D=N,N=j,j=D,D=W,W=X,X=D,D=H,H=V,V=D);for(var Y=F;Y<F+2;Y++){var q=U.vertices[(Y+U.vertices.length)%U.vertices.length];a.rotate(g,q,X),h(g,g,j);for(var z=0,K=k-1;K<k+2;K++){var J=G.vertices[(K+G.vertices.length)%G.vertices.length],Z=G.vertices[(K+1+G.vertices.length)%G.vertices.length];a.rotate(m,J,W),a.rotate(v,Z,W),h(m,m,N),h(v,v,N),r(C,v,m),a.rotate90cw(M,C),a.normalize(M,M),r(I,g,m);var Q=l(M,I);(K===k&&Q<=f||K!==k&&Q<=0)&&z++}if(z>=3){if(p)return!0;var $=this.createContactEquation(H,V,G,U);O++;var J=G.vertices[k%G.vertices.length],Z=G.vertices[(k+1)%G.vertices.length];a.rotate(m,J,W),a.rotate(v,Z,W),h(m,m,N),h(v,v,N),r(C,v,m),a.rotate90cw($.normalA,C),a.normalize($.normalA,$.normalA),r(I,g,m);var Q=l($.normalA,I);a.scale(E,$.normalA,Q),r($.contactPointA,g,N),r($.contactPointA,$.contactPointA,E),h($.contactPointA,$.contactPointA,N),r($.contactPointA,$.contactPointA,H.position),r($.contactPointB,g,j),h($.contactPointB,$.contactPointB,j),r($.contactPointB,$.contactPointB,V.position),this.contactEquations.push($),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact($))}}}return this.enableFrictionReduction&&this.enableFriction&&O&&this.frictionEquations.push(this.createFrictionFromAverage(O)),O};var Q=a.fromValues(0,0);s.projectConvexOntoAxis=function(t,e,i,s,n){var o,r,h=null,c=null,u=Q;a.rotate(u,s,-i);for(var d=0;d<t.vertices.length;d++)o=t.vertices[d],r=l(o,u),(null===h||r>h)&&(h=r),(null===c||r<c)&&(c=r);if(c>h){var p=c;c=h,h=p}var f=l(e,s);a.set(n,c+f,h+f)};var $=a.fromValues(0,0),tt=a.fromValues(0,0),et=a.fromValues(0,0),it=a.fromValues(0,0),st=a.fromValues(0,0),nt=a.fromValues(0,0);s.findSeparatingAxis=function(t,e,i,n,o,h,l){var c=null,u=!1,d=!1,p=$,f=tt,y=et,g=it,v=st,b=nt;if(t instanceof m&&n instanceof m)for(var x=0;2!==x;x++){var _=t,w=i;1===x&&(_=n,w=h);for(var P=0;2!==P;P++){0===P?a.set(g,0,1):1===P&&a.set(g,1,0),0!==w&&a.rotate(g,g,w),s.projectConvexOntoAxis(t,e,i,g,v),s.projectConvexOntoAxis(n,o,h,g,b);var C=v,T=b;v[0]>b[0]&&(T=v,C=b);var S=T[0]-C[1];u=S<=0,(null===c||S>c)&&(a.copy(l,g),c=S,d=u)}}else for(var x=0;2!==x;x++){var _=t,w=i;1===x&&(_=n,w=h);for(var P=0;P!==_.vertices.length;P++){a.rotate(f,_.vertices[P],w),a.rotate(y,_.vertices[(P+1)%_.vertices.length],w),r(p,y,f),a.rotate90cw(g,p),a.normalize(g,g),s.projectConvexOntoAxis(t,e,i,g,v),s.projectConvexOntoAxis(n,o,h,g,b);var C=v,T=b;v[0]>b[0]&&(T=v,C=b);var S=T[0]-C[1];u=S<=0,(null===c||S>c)&&(a.copy(l,g),c=S,d=u)}}return d};var ot=a.fromValues(0,0),at=a.fromValues(0,0),rt=a.fromValues(0,0);s.getClosestEdge=function(t,e,i,s){var n=ot,o=at,h=rt;a.rotate(n,i,-e),s&&a.scale(n,n,-1);for(var c=-1,u=t.vertices.length,d=-1,p=0;p!==u;p++){r(o,t.vertices[(p+1)%u],t.vertices[p%u]),a.rotate90cw(h,o),a.normalize(h,h);var f=l(h,n);(-1===c||f>d)&&(c=p%u,d=f)}return c};var ht=a.create(),lt=a.create(),ct=a.create(),ut=a.create(),dt=a.create(),pt=a.create(),ft=a.create();s.prototype[g.CIRCLE|g.HEIGHTFIELD]=s.prototype.circleHeightfield=function(t,e,i,s,n,o,l,c,u,d){var p=o.heights,d=d||e.radius,f=o.elementWidth,y=lt,g=ht,m=dt,v=ft,b=pt,x=ct,_=ut,w=Math.floor((i[0]-d-l[0])/f),P=Math.ceil((i[0]+d-l[0])/f);w<0&&(w=0),P>=p.length&&(P=p.length-1);for(var C=p[w],T=p[P],S=w;S<P;S++)p[S]<T&&(T=p[S]),p[S]>C&&(C=p[S]);if(i[1]-d>C)return!u&&0;for(var A=!1,S=w;S<P;S++){a.set(x,S*f,p[S]),a.set(_,(S+1)*f,p[S+1]),a.add(x,x,l),a.add(_,_,l),a.sub(b,_,x),a.rotate(b,b,Math.PI/2),a.normalize(b,b),a.scale(g,b,-d),a.add(g,g,i),a.sub(y,g,x);var E=a.dot(y,b);if(g[0]>=x[0]&&g[0]<_[0]&&E<=0){if(u)return!0;A=!0,a.scale(y,b,-E),a.add(m,g,y),a.copy(v,b);var I=this.createContactEquation(n,t,o,e);a.copy(I.normalA,v),a.scale(I.contactPointB,I.normalA,-d),h(I.contactPointB,I.contactPointB,i),r(I.contactPointB,I.contactPointB,t.position),a.copy(I.contactPointA,m),a.sub(I.contactPointA,I.contactPointA,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}}if(A=!1,d>0)for(var S=w;S<=P;S++)if(a.set(x,S*f,p[S]),a.add(x,x,l),a.sub(y,i,x),a.squaredLength(y)<Math.pow(d,2)){if(u)return!0;A=!0;var I=this.createContactEquation(n,t,o,e);a.copy(I.normalA,y),a.normalize(I.normalA,I.normalA),a.scale(I.contactPointB,I.normalA,-d),h(I.contactPointB,I.contactPointB,i),r(I.contactPointB,I.contactPointB,t.position),r(I.contactPointA,x,l),h(I.contactPointA,I.contactPointA,l),r(I.contactPointA,I.contactPointA,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}return A?1:0};var yt=a.create(),gt=a.create(),mt=a.create(),vt=new y({vertices:[a.create(),a.create(),a.create(),a.create()]});s.prototype[g.BOX|g.HEIGHTFIELD]=s.prototype[g.CONVEX|g.HEIGHTFIELD]=s.prototype.convexHeightfield=function(t,e,i,s,n,o,r,h,l){var c=o.heights,u=o.elementWidth,d=yt,p=gt,f=mt,y=vt,g=Math.floor((t.aabb.lowerBound[0]-r[0])/u),m=Math.ceil((t.aabb.upperBound[0]-r[0])/u);g<0&&(g=0),m>=c.length&&(m=c.length-1);for(var v=c[g],b=c[m],x=g;x<m;x++)c[x]<b&&(b=c[x]),c[x]>v&&(v=c[x]);if(t.aabb.lowerBound[1]>v)return!l&&0;for(var _=0,x=g;x<m;x++)a.set(d,x*u,c[x]),a.set(p,(x+1)*u,c[x+1]),a.add(d,d,r),a.add(p,p,r),a.set(f,.5*(p[0]+d[0]),.5*(p[1]+d[1]-100)),a.sub(y.vertices[0],p,f),a.sub(y.vertices[1],d,f),a.copy(y.vertices[2],y.vertices[1]),a.copy(y.vertices[3],y.vertices[0]),y.vertices[2][1]-=100,y.vertices[3][1]-=100,_+=this.convexConvex(t,e,i,s,n,y,f,0,l);return _}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){function s(t){t=t||{},this.from=t.from?o.fromValues(t.from[0],t.from[1]):o.create(),this.to=t.to?o.fromValues(t.to[0],t.to[1]):o.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:s.ANY,this.callback=t.callback||function(t){},this.direction=o.create(),this.length=1,this.update()}function n(t,e,i){o.sub(r,i,t);var s=o.dot(r,e);return o.scale(h,e,s),o.add(h,h,t),o.squaredDistance(i,h)}e.exports=s;var o=t("../math/vec2");t("../collision/RaycastResult"),t("../shapes/Shape"),t("../collision/AABB"),s.prototype.constructor=s,s.CLOSEST=1,s.ANY=2,s.ALL=4,s.prototype.update=function(){var t=this.direction;o.sub(t,this.to,this.from),this.length=o.length(t),o.normalize(t,t)},s.prototype.intersectBodies=function(t,e){for(var i=0,s=e.length;!t.shouldStop(this)&&i<s;i++){var n=e[i],o=n.getAABB();(o.overlapsRay(this)>=0||o.containsPoint(this.from))&&this.intersectBody(t,n)}};var a=o.create();s.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var s=a,n=0,r=e.shapes.length;n<r;n++){var h=e.shapes[n];if((!i||h.collisionResponse)&&0!=(this.collisionGroup&h.collisionMask)&&0!=(h.collisionGroup&this.collisionMask)){o.rotate(s,h.position,e.angle),o.add(s,s,e.position);var l=h.angle+e.angle;if(this.intersectShape(t,h,l,s,e),t.shouldStop(this))break}}},s.prototype.intersectShape=function(t,e,i,s,o){n(this.from,this.direction,s)>e.boundingRadius*e.boundingRadius||(this._currentBody=o,this._currentShape=e,e.raycast(t,this,s,i),this._currentBody=this._currentShape=null)},s.prototype.getAABB=function(t){var e=this.to,i=this.from;o.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),o.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))},o.create(),s.prototype.reportIntersection=function(t,e,i,n){this.from,this.to;var a=this._currentShape,r=this._currentBody;if(!(this.skipBackfaces&&o.dot(i,this.direction)>0))switch(this.mode){case s.ALL:t.set(i,a,r,e,n),this.callback(t);break;case s.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,a,r,e,n);break;case s.ANY:t.set(i,a,r,e,n)}};var r=o.create(),h=o.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){function s(){this.normal=n.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var n=t("../math/vec2"),o=t("../collision/Ray");e.exports=s,s.prototype.reset=function(){n.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},s.prototype.getHitDistance=function(t){return n.distance(t.from,t.to)*this.fraction},s.prototype.hasHit=function(){return-1!==this.fraction},s.prototype.getHitPoint=function(t,e){n.lerp(t,e.from,e.to,this.fraction)},s.prototype.stop=function(){this.isStopped=!0},s.prototype.shouldStop=function(t){return this.isStopped||-1!==this.fraction&&t.mode===o.ANY},s.prototype.set=function(t,e,i,s,o){n.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=s,this.faceIndex=o}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){function s(){o.call(this,o.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);-1!==i&&t.axisList.splice(i,1)}}var n=t("../utils/Utils"),o=t("../collision/Broadphase");e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.setWorld=function(t){this.axisList.length=0,n.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},s.sortAxisList=function(t,e){e|=0;for(var i=1,s=t.length;i<s;i++){for(var n=t[i],o=i-1;o>=0&&!(t[o].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);o--)t[o+1]=t[o];t[o+1]=n}return t},s.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;s.sortAxisList(t,e)},s.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,s=this.axisIndex;i.length=0;for(var n=e.length;n--;){var a=e[n];a.aabbNeedsUpdate&&a.updateAABB()}this.sortList();for(var r=0,h=0|e.length;r!==h;r++)for(var l=e[r],c=r+1;c<h;c++){var u=e[c],d=u.aabb.lowerBound[s]<=l.aabb.upperBound[s];if(!d)break;o.canCollide(l,u)&&this.boundingVolumeCheck(l,u)&&i.push(l,u)}return i},s.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();var s=this.axisIndex,n="x";1===s&&(n="y"),2===s&&(n="z");for(var o=this.axisList,a=(e.lowerBound[n],e.upperBound[n],0);a<o.length;a++){var r=o[a];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&i.push(r)}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){function s(t,e,i,s){this.type=i,s=n.defaults(s,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=s.collideConnected,s.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}e.exports=s;var n=t("../utils/Utils");s.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},s.DISTANCE=1,s.GEAR=2,s.LOCK=3,s.PRISMATIC=4,s.REVOLUTE=5,s.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var s=e[i];s.stiffness=t,s.needsUpdate=!0}},s.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var s=e[i];s.relaxation=t,s.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(t,e,i){function s(t,e,i){i=r.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]}),n.call(this,t,e,n.DISTANCE,i),this.localAnchorA=a.fromValues(i.localAnchorA[0],i.localAnchorA[1]),this.localAnchorB=a.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var s,h=this.localAnchorA,l=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var c=a.create(),u=a.create(),d=a.create();a.rotate(c,h,t.angle),a.rotate(u,l,e.angle),a.add(d,e.position,u),a.sub(d,d,c),a.sub(d,d,t.position),this.distance=a.length(d)}s=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce;var p=new o(t,e,-s,s);this.equations=[p],this.maxForce=s;var d=a.create(),f=a.create(),y=a.create(),g=this;p.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,s=e.position;return a.rotate(f,h,t.angle),a.rotate(y,l,e.angle),a.add(d,s,y),a.sub(d,d,f),a.sub(d,d,i),a.length(d)-g.distance},this.setMaxForce(s),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var n=t("./Constraint"),o=t("../equations/Equation"),a=t("../math/vec2"),r=t("../utils/Utils");e.exports=s,s.prototype=new n,s.prototype.constructor=s;var h=a.create(),l=a.create(),c=a.create();s.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,s=(this.distance,e.position),n=i.position,o=this.equations[0],r=t.G;a.rotate(l,this.localAnchorA,e.angle),a.rotate(c,this.localAnchorB,i.angle),a.add(h,n,c),a.sub(h,h,l),a.sub(h,h,s),this.position=a.length(h);var u=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(o.maxForce=0,o.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(o.maxForce=this.maxForce,o.minForce=0,this.distance=this.lowerLimit,u=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||u){o.enabled=!0,a.normalize(h,h);var d=a.crossLength(l,h),p=a.crossLength(c,h);r[0]=-h[0],r[1]=-h[1],r[2]=-d,r[3]=h[0],r[4]=h[1],r[5]=p}else o.enabled=!1},s.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},s.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){function s(t,e,i){i=i||{},n.call(this,t,e,n.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle,i.angle=this.angle,i.ratio=this.ratio,this.equations=[new o(t,e,i)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var n=t("./Constraint"),o=(t("../equations/Equation"),t("../equations/AngleLockEquation"));t("../math/vec2"),e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},s.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},s.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){function s(t,e,i){i=i||{},n.call(this,t,e,n.LOCK,i);var s=void 0===i.maxForce?Number.MAX_VALUE:i.maxForce,r=(i.localAngleB,new a(t,e,-s,s)),h=new a(t,e,-s,s),l=new a(t,e,-s,s),c=o.create(),u=o.create(),d=this;r.computeGq=function(){return o.rotate(c,d.localOffsetB,t.angle),o.sub(u,e.position,t.position),o.sub(u,u,c),u[0]},h.computeGq=function(){return o.rotate(c,d.localOffsetB,t.angle),o.sub(u,e.position,t.position),o.sub(u,u,c),u[1]};var p=o.create(),f=o.create();l.computeGq=function(){return o.rotate(p,d.localOffsetB,e.angle-d.localAngleB),o.scale(p,p,-1),o.sub(u,t.position,e.position),o.add(u,u,p),o.rotate(f,p,-Math.PI/2),o.normalize(f,f),o.dot(u,f)},this.localOffsetB=o.create(),i.localOffsetB?o.copy(this.localOffsetB,i.localOffsetB):(o.sub(this.localOffsetB,e.position,t.position),o.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(r,h,l),this.setMaxForce(s)}var n=t("./Constraint"),o=t("../math/vec2"),a=t("../equations/Equation");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},s.prototype.getMaxForce=function(){return this.equations[0].maxForce};var r=o.create(),h=o.create(),l=o.create(),c=o.fromValues(1,0),u=o.fromValues(0,1);s.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],s=this.bodyA,n=this.bodyB;o.rotate(r,this.localOffsetB,s.angle),o.rotate(h,this.localOffsetB,n.angle-this.localAngleB),o.scale(h,h,-1),o.rotate(l,h,Math.PI/2),o.normalize(l,l),t.G[0]=-1,t.G[1]=0,t.G[2]=-o.crossLength(r,c),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-o.crossLength(r,u),e.G[4]=1,i.G[0]=-l[0],i.G[1]=-l[1],i.G[3]=l[0],i.G[4]=l[1],i.G[5]=o.crossLength(h,l)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){function s(t,e,i){i=i||{},n.call(this,t,e,n.PRISMATIC,i);var s=r.fromValues(0,0),l=r.fromValues(1,0),c=r.fromValues(0,0);i.localAnchorA&&r.copy(s,i.localAnchorA),i.localAxisA&&r.copy(l,i.localAxisA),i.localAnchorB&&r.copy(c,i.localAnchorB),this.localAnchorA=s,this.localAnchorB=c,this.localAxisA=l;var u=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE,d=new a(t,e,-u,u),p=new r.create,f=new r.create,y=new r.create,g=new r.create;if(d.computeGq=function(){return r.dot(y,g)},d.updateJacobian=function(){var i=this.G,n=t.position,o=e.position;r.rotate(p,s,t.angle),r.rotate(f,c,e.angle),r.add(y,o,f),r.sub(y,y,n),r.sub(y,y,p),r.rotate(g,l,t.angle+Math.PI/2),i[0]=-g[0],i[1]=-g[1],i[2]=-r.crossLength(p,g)+r.crossLength(g,y),i[3]=g[0],i[4]=g[1],i[5]=r.crossLength(f,g)},this.equations.push(d),!i.disableRotationalLock){var m=new h(t,e,-u,u);this.equations.push(m)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==i.lowerLimit,this.upperLimitEnabled=void 0!==i.upperLimit,this.lowerLimit=void 0!==i.lowerLimit?i.lowerLimit:0,this.upperLimit=void 0!==i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new o(t,e),this.lowerLimitEquation=new o(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=u,this.motorEquation=new a(t,e),this.motorEnabled=!1,this.motorSpeed=0;var v=this,b=this.motorEquation;b.computeGW,b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=e.velocity,n=i.velocity,o=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,s,o,n,a)+v.motorSpeed}}var n=t("./Constraint"),o=t("../equations/ContactEquation"),a=t("../equations/Equation"),r=t("../math/vec2"),h=t("../equations/RotationalLockEquation");e.exports=s,s.prototype=new n,s.prototype.constructor=s;var l=r.create(),c=r.create(),u=r.create(),d=r.create(),p=r.create(),f=r.create();s.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,s=this.lowerLimit,n=this.upperLimitEquation,o=this.lowerLimitEquation,a=this.bodyA,h=this.bodyB,y=this.localAxisA,g=this.localAnchorA,m=this.localAnchorB;e.updateJacobian(),r.rotate(l,y,a.angle),r.rotate(d,g,a.angle),r.add(c,d,a.position),r.rotate(p,m,h.angle),r.add(u,p,h.position);var v=this.position=r.dot(u,l)-r.dot(c,l);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=l[0],b[1]=l[1],b[2]=r.crossLength(l,p),b[3]=-l[0],b[4]=-l[1],b[5]=-r.crossLength(l,d)}if(this.upperLimitEnabled&&v>i)r.scale(n.normalA,l,-1),r.sub(n.contactPointA,c,a.position),r.sub(n.contactPointB,u,h.position),r.scale(f,l,i),r.add(n.contactPointA,n.contactPointA,f),-1===t.indexOf(n)&&t.push(n);else{var x=t.indexOf(n);-1!==x&&t.splice(x,1)}if(this.lowerLimitEnabled&&v<s)r.scale(o.normalA,l,1),r.sub(o.contactPointA,c,a.position),r.sub(o.contactPointB,u,h.position),r.scale(f,l,s),r.sub(o.contactPointB,o.contactPointB,f),-1===t.indexOf(o)&&t.push(o);else{var x=t.indexOf(o);-1!==x&&t.splice(x,1)}},s.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},s.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},s.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){function s(t,e,i){i=i||{},n.call(this,t,e,n.REVOLUTE,i);var s=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE;this.pivotA=h.create(),this.pivotB=h.create(),i.worldPivot?(h.sub(this.pivotA,i.worldPivot,t.position),h.sub(this.pivotB,i.worldPivot,e.position),h.rotate(this.pivotA,this.pivotA,-t.angle),h.rotate(this.pivotB,this.pivotB,-e.angle)):(h.copy(this.pivotA,i.localPivotA),h.copy(this.pivotB,i.localPivotB));var f=this.equations=[new o(t,e,-s,s),new o(t,e,-s,s)],y=f[0],g=f[1],m=this;y.computeGq=function(){return h.rotate(l,m.pivotA,t.angle),h.rotate(c,m.pivotB,e.angle),h.add(p,e.position,c),h.sub(p,p,t.position),h.sub(p,p,l),h.dot(p,u)},g.computeGq=function(){return h.rotate(l,m.pivotA,t.angle),h.rotate(c,m.pivotB,e.angle),h.add(p,e.position,c),h.sub(p,p,t.position),h.sub(p,p,l),h.dot(p,d)},g.minForce=y.minForce=-s,g.maxForce=y.maxForce=s,this.motorEquation=new a(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new r(t,e),this.lowerLimitEquation=new r(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var n=t("./Constraint"),o=t("../equations/Equation"),a=t("../equations/RotationalVelocityEquation"),r=t("../equations/RotationalLockEquation"),h=t("../math/vec2");e.exports=s;var l=h.create(),c=h.create(),u=h.fromValues(1,0),d=h.fromValues(0,1),p=h.create();s.prototype=new n,s.prototype.constructor=s,s.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,s=this.pivotB,n=this.equations,o=(n[0],n[1],n[0]),a=n[1],r=this.upperLimit,p=this.lowerLimit,f=this.upperLimitEquation,y=this.lowerLimitEquation,g=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&g>r)f.angle=r,-1===n.indexOf(f)&&n.push(f);else{var m=n.indexOf(f);-1!==m&&n.splice(m,1)}if(this.lowerLimitEnabled&&g<p)y.angle=p,-1===n.indexOf(y)&&n.push(y);else{var m=n.indexOf(y);-1!==m&&n.splice(m,1)}h.rotate(l,i,t.angle),h.rotate(c,s,e.angle),o.G[0]=-1,o.G[1]=0,o.G[2]=-h.crossLength(l,u),o.G[3]=1,o.G[4]=0,o.G[5]=h.crossLength(c,u),a.G[0]=0,a.G[1]=-1,a.G[2]=-h.crossLength(l,d),a.G[3]=0,a.G[4]=1,a.G[5]=h.crossLength(c,d)},s.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},s.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},s.prototype.motorIsEnabled=function(){return!!this.motorEnabled},s.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},s.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){function s(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio="number"==typeof i.ratio?i.ratio:1,this.setRatio(this.ratio)}var n=t("./Equation");t("../math/vec2"),e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},s.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},s.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){function s(t,e){n.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=o.create(),this.penetrationVec=o.create(),this.contactPointB=o.create(),this.normalA=o.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var n=t("./Equation"),o=t("../math/vec2");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeB=function(t,e,i){var s,n,a=this.bodyA,r=this.bodyB,h=this.contactPointA,l=this.contactPointB,c=a.position,u=r.position,d=this.penetrationVec,p=this.normalA,f=this.G,y=o.crossLength(h,p),g=o.crossLength(l,p);return f[0]=-p[0],f[1]=-p[1],f[2]=-y,f[3]=p[0],f[4]=p[1],f[5]=g,o.add(d,u,l),o.sub(d,d,c),o.sub(d,d,h),this.firstImpact&&0!==this.restitution?(n=0,s=1/e*(1+this.restitution)*this.computeGW()):(n=o.dot(p,d)+this.offset,s=this.computeGW()),-n*t-s*e-i*this.computeGiMf()}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){function s(t,e,i,n){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===n?Number.MAX_VALUE:n,this.bodyA=t,this.bodyB=e,this.stiffness=s.DEFAULT_STIFFNESS,this.relaxation=s.DEFAULT_RELAXATION,this.G=new o.ARRAY_TYPE(6);for(var a=0;a<6;a++)this.G[a]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}e.exports=s;var n=t("../math/vec2"),o=t("../utils/Utils");t("../objects/Body"),s.prototype.constructor=s,s.DEFAULT_STIFFNESS=1e6,s.DEFAULT_RELAXATION=4,s.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},s.prototype.gmult=function(t,e,i,s,n){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*s[0]+t[4]*s[1]+t[5]*n},s.prototype.computeB=function(t,e,i){var s=this.computeGW();return-this.computeGq()*t-s*e-this.computeGiMf()*i};var a=n.create(),r=n.create();s.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=(e.position,i.position,e.angle),n=i.angle;return this.gmult(t,a,s,r,n)+this.offset},s.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=e.velocity,n=i.velocity,o=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,s,o,n,a)+this.relativeVelocity},s.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,s=e.vlambda,n=i.vlambda,o=e.wlambda,a=i.wlambda;return this.gmult(t,s,o,n,a)};var h=n.create(),l=n.create();s.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,s=t.angularForce,o=e.force,a=e.angularForce,r=t.invMassSolve,c=e.invMassSolve,u=t.invInertiaSolve,d=e.invInertiaSolve,p=this.G;return n.scale(h,i,r),n.multiply(h,t.massMultiplier,h),n.scale(l,o,c),n.multiply(l,e.massMultiplier,l),this.gmult(p,h,s*u,l,a*d)},s.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,s=e.invMassSolve,n=t.invInertiaSolve,o=e.invInertiaSolve,a=this.G;return a[0]*a[0]*i*t.massMultiplier[0]+a[1]*a[1]*i*t.massMultiplier[1]+a[2]*a[2]*n+a[3]*a[3]*s*e.massMultiplier[0]+a[4]*a[4]*s*e.massMultiplier[1]+a[5]*a[5]*o};var c=n.create(),u=n.create(),d=n.create();n.create(),n.create(),n.create(),s.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,s=c,o=u,a=d,r=e.invMassSolve,h=i.invMassSolve,l=e.invInertiaSolve,p=i.invInertiaSolve,f=this.G;o[0]=f[0],o[1]=f[1],a[0]=f[3],a[1]=f[4],n.scale(s,o,r*t),n.multiply(s,s,e.massMultiplier),n.add(e.vlambda,e.vlambda,s),e.wlambda+=l*f[2]*t,n.scale(s,a,h*t),n.multiply(s,s,i.massMultiplier),n.add(i.vlambda,i.vlambda,s),i.wlambda+=p*f[5]*t},s.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){function s(t,e,i){o.call(this,t,e,-i,i),this.contactPointA=n.create(),this.contactPointB=n.create(),this.t=n.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var n=t("../math/vec2"),o=t("./Equation");t("../utils/Utils"),e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},s.prototype.getSlipForce=function(){return this.maxForce},s.prototype.computeB=function(t,e,i){this.bodyA,this.bodyB;var s=this.contactPointA,o=this.contactPointB,a=this.t,r=this.G;return r[0]=-a[0],r[1]=-a[1],r[2]=-n.crossLength(s,a),r[3]=a[0],r[4]=a[1],r[5]=n.crossLength(o,a),-this.computeGW()*e-i*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){function s(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var s=this.G;s[2]=1,s[5]=-1}var n=t("./Equation"),o=t("../math/vec2");e.exports=s,s.prototype=new n,s.prototype.constructor=s;var a=o.create(),r=o.create(),h=o.fromValues(1,0),l=o.fromValues(0,1);s.prototype.computeGq=function(){return o.rotate(a,h,this.bodyA.angle+this.angle),o.rotate(r,l,this.bodyB.angle),o.dot(a,r)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){function s(t,e){n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var n=t("./Equation");t("../math/vec2"),e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeB=function(t,e,i){var s=this.G;s[2]=-1,s[5]=this.ratio;var n=this.computeGiMf();return-this.computeGW()*e-i*n}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){var s=function(){};e.exports=s,s.prototype={constructor:s,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var s=this._listeners;return void 0===s[t]&&(s[t]=[]),-1===s[t].indexOf(e)&&s[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&-1!==i[t].indexOf(e))return!0}else if(void 0!==i[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var i=this._listeners,s=i[t].indexOf(e);return-1!==s&&i[t].splice(s,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;for(var s=0,n=i.length;s<n;s++){var o=i[s];o.call(o.context,t)}}return this}}},{}],27:[function(t,e,i){function s(t,e,i){if(i=i||{},!(t instanceof n&&e instanceof n))throw new Error("First two arguments must be Material instances.");this.id=s.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==i.friction?Number(i.friction):.3,this.restitution=void 0!==i.restitution?Number(i.restitution):0,this.stiffness=void 0!==i.stiffness?Number(i.stiffness):o.DEFAULT_STIFFNESS,this.relaxation=void 0!==i.relaxation?Number(i.relaxation):o.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==i.frictionStiffness?Number(i.frictionStiffness):o.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==i.frictionRelaxation?Number(i.frictionRelaxation):o.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==i.surfaceVelocity?Number(i.surfaceVelocity):0,this.contactSkinSize=.005}var n=t("./Material"),o=t("../equations/Equation");e.exports=s,s.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){function s(t){this.id=t||s.idCounter++}e.exports=s,s.idCounter=0},{}],29:[function(t,e,i){var s={GetArea:function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,s=0;s<e;s+=2)i+=(t[s+2]-t[s])*(t[s+1]+t[s+3]);return.5*-(i+=(t[0]-t[e])*(t[e+1]+t[1]))},Triangulate:function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],n=[],o=0;o<e;o++)n.push(o);for(var o=0,a=e;a>3;){var r=n[(o+0)%a],h=n[(o+1)%a],l=n[(o+2)%a],c=t[2*r],u=t[2*r+1],d=t[2*h],p=t[2*h+1],f=t[2*l],y=t[2*l+1],g=!1;if(s._convex(c,u,d,p,f,y)){g=!0;for(var m=0;m<a;m++){var v=n[m];if(v!=r&&v!=h&&v!=l&&s._PointInTriangle(t[2*v],t[2*v+1],c,u,d,p,f,y)){g=!1;break}}}if(g)i.push(r,h,l),n.splice((o+1)%a,1),a--,o=0;else if(o++>3*a)break}return i.push(n[0],n[1],n[2]),i},_PointInTriangle:function(t,e,i,s,n,o,a,r){var h=a-i,l=r-s,c=n-i,u=o-s,d=t-i,p=e-s,f=h*h+l*l,y=h*c+l*u,g=h*d+l*p,m=c*c+u*u,v=c*d+u*p,b=1/(f*m-y*y),x=(m*g-y*v)*b,_=(f*v-y*g)*b;return x>=0&&_>=0&&x+_<1},_convex:function(t,e,i,s,n,o){return(e-s)*(n-i)+(i-t)*(o-s)>=0}};e.exports=s},{}],30:[function(t,e,i){var s=e.exports={},n=t("../utils/Utils");s.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},s.crossVZ=function(t,e,i){return s.rotate(t,e,-Math.PI/2),s.scale(t,t,i),t},s.crossZV=function(t,e,i){return s.rotate(t,i,Math.PI/2),s.scale(t,t,e),t},s.rotate=function(t,e,i){if(0!==i){var s=Math.cos(i),n=Math.sin(i),o=e[0],a=e[1];t[0]=s*o-n*a,t[1]=n*o+s*a}else t[0]=e[0],t[1]=e[1]},s.rotate90cw=function(t,e){var i=e[0],s=e[1];t[0]=s,t[1]=-i},s.toLocalFrame=function(t,e,i,n){s.copy(t,e),s.sub(t,t,i),s.rotate(t,t,-n)},s.toGlobalFrame=function(t,e,i,n){s.copy(t,e),s.rotate(t,t,n),s.add(t,t,i)},s.vectorToLocalFrame=function(t,e,i){s.rotate(t,e,-i)},s.vectorToGlobalFrame=function(t,e,i){s.rotate(t,e,i)},s.centroid=function(t,e,i,n){return s.add(t,e,i),s.add(t,t,n),s.scale(t,t,1/3),t},s.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},s.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},s.fromValues=function(t,e){var i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},s.set=function(t,e,i){return t[0]=e,t[1]=i,t},s.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},s.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},s.sub=s.subtract,s.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},s.mul=s.multiply,s.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},s.div=s.divide,s.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},s.distance=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)},s.dist=s.distance,s.squaredDistance=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s},s.sqrDist=s.squaredDistance,s.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},s.len=s.length,s.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},s.sqrLen=s.squaredLength,s.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},s.normalize=function(t,e){var i=e[0],s=e[1],n=i*i+s*s;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},s.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},s.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},s.lerp=function(t,e,i,s){var n=e[0],o=e[1];return t[0]=n+s*(i[0]-n),t[1]=o+s*(i[1]-o),t},s.reflect=function(t,e,i){var s=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*s,t[1]=e[1]-2*i[1]*s},s.getLineSegmentsIntersection=function(t,e,i,n,o){var a=s.getLineSegmentsIntersectionFraction(e,i,n,o);return!(a<0||(t[0]=e[0]+a*(i[0]-e[0]),t[1]=e[1]+a*(i[1]-e[1]),0))},s.getLineSegmentsIntersectionFraction=function(t,e,i,s){var n,o,a=e[0]-t[0],r=e[1]-t[1],h=s[0]-i[0],l=s[1]-i[1];return n=(-r*(t[0]-i[0])+a*(t[1]-i[1]))/(-h*r+a*l),o=(h*(t[1]-i[1])-l*(t[0]-i[0]))/(-h*r+a*l),n>=0&&n<=1&&o>=0&&o<=1?o:-1}},{"../utils/Utils":57}],31:[function(t,e,i){function s(t){t=t||{},c.call(this),this.id=t.id||++s._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=n.create(),this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.interpolatedPosition=n.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=n.fromValues(0,0),this.previousAngle=0,this.velocity=n.fromValues(0,0),t.velocity&&n.copy(this.velocity,t.velocity),this.vlambda=n.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=n.create(),t.force&&n.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=s.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=s.DYNAMIC:this.type=s.STATIC,this.boundingRadius=0,this.aabb=new l,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=s.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var n=t("../math/vec2"),o=t("poly-decomp"),a=t("../shapes/Convex"),r=t("../collision/RaycastResult"),h=t("../collision/Ray"),l=t("../collision/AABB"),c=t("../events/EventEmitter");e.exports=s,s.prototype=new c,s.prototype.constructor=s,s._idCounter=0,s.prototype.updateSolveMassProperties=function(){this.sleepState===s.SLEEPING||this.type===s.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},s.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},s.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},s.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var u=new l,d=n.create();s.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=d,s=this.angle,o=0;o!==e;o++){var a=t[o],r=a.angle+s;n.rotate(i,a.position,s),n.add(i,i,this.position),a.computeAABB(u,i,r),0===o?this.aabb.copy(u):this.aabb.extend(u)}this.aabbNeedsUpdate=!1},s.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,s=0;s!==e;s++){var o=t[s],a=n.length(o.position),r=o.boundingRadius;a+r>i&&(i=a+r)}this.boundingRadius=i},s.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?n.copy(t.position,e):n.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},s.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return-1!==e&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},s.prototype.updateMassProperties=function(){if(this.type===s.STATIC||this.type===s.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=this.mass/e,o=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var a=0;a<e;a++){var r=t[a],h=n.squaredLength(r.position);o+=r.computeMomentOfInertia(i)+i*h}this.inertia=o,this.invInertia=o>0?1/o:0}this.invMass=1/this.mass,n.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},n.create(),s.prototype.applyForce=function(t,e){if(n.add(this.force,this.force,t),e){var i=n.crossLength(e,t);this.angularForce+=i}};var p=n.create(),f=n.create(),y=n.create();s.prototype.applyForceLocal=function(t,e){e=e||y;var i=p,s=f;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(s,e),this.applyForce(i,s)};var g=n.create();s.prototype.applyImpulse=function(t,e){if(this.type===s.DYNAMIC){var i=g;if(n.scale(i,t,this.invMass),n.multiply(i,this.massMultiplier,i),n.add(this.velocity,i,this.velocity),e){var o=n.crossLength(e,t);o*=this.invInertia,this.angularVelocity+=o}}};var m=n.create(),v=n.create(),b=n.create();s.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=m,s=v;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(s,e),this.applyImpulse(i,s)},s.prototype.toLocalFrame=function(t,e){n.toLocalFrame(t,e,this.position,this.angle)},s.prototype.toWorldFrame=function(t,e){n.toGlobalFrame(t,e,this.position,this.angle)},s.prototype.vectorToLocalFrame=function(t,e){n.vectorToLocalFrame(t,e,this.angle)},s.prototype.vectorToWorldFrame=function(t,e){n.vectorToGlobalFrame(t,e,this.angle)},s.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);var s,r=new o.Polygon;if(r.vertices=t,r.makeCCW(),"number"==typeof e.removeCollinearPoints&&r.removeCollinearPoints(e.removeCollinearPoints),void 0===e.skipSimpleCheck&&!r.isSimple())return!1;this.concavePath=r.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var h=[0,0];n.copy(h,this.concavePath[i]),this.concavePath[i]=h}s=e.optimalDecomp?r.decomp():r.quickDecomp();for(var l=n.create(),i=0;i!==s.length;i++){for(var c=new a({vertices:s[i].vertices}),u=0;u!==c.vertices.length;u++){var h=c.vertices[u];n.sub(h,h,c.centerOfMass)}n.scale(l,c.centerOfMass,1),c.updateTriangles(),c.updateCenterOfMass(),c.updateBoundingRadius(),this.addShape(c,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0},n.fromValues(0,0);var x=n.fromValues(0,0),_=n.fromValues(0,0),w=n.fromValues(0,0);s.prototype.adjustCenterOfMass=function(){var t=x,e=_,i=w,s=0;n.set(e,0,0);for(var o=0;o!==this.shapes.length;o++){var a=this.shapes[o];n.scale(t,a.position,a.area),n.add(e,e,t),s+=a.area}n.scale(i,e,1/s);for(var o=0;o!==this.shapes.length;o++){var a=this.shapes[o];n.sub(a.position,a.position,i)}n.add(this.position,this.position,i);for(var o=0;this.concavePath&&o<this.concavePath.length;o++)n.sub(this.concavePath[o],this.concavePath[o],i);this.updateMassProperties(),this.updateBoundingRadius()},s.prototype.setZeroForce=function(){n.set(this.force,0,0),this.angularForce=0},s.prototype.resetConstraintVelocity=function(){var t=this.vlambda;n.set(t,0,0),this.wlambda=0},s.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;n.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},s.prototype.applyDamping=function(t){if(this.type===s.DYNAMIC){var e=this.velocity;n.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},s.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=s.AWAKE,this.idleTime=0,t!==s.AWAKE&&this.emit(s.wakeUpEvent)},s.prototype.sleep=function(){this.sleepState=s.SLEEPING,this.angularVelocity=0,this.angularForce=0,n.set(this.velocity,0,0),n.set(this.force,0,0),this.emit(s.sleepEvent)},s.prototype.sleepTick=function(t,e,i){this.allowSleep&&this.type!==s.SLEEPING&&(this.wantsToSleep=!1,this.sleepState,n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)>=Math.pow(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=s.AWAKE):(this.idleTime+=i,this.sleepState=s.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep()))},s.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var P=n.create(),C=n.create();s.prototype.integrate=function(t){var e=this.invMass,i=this.force,s=this.position,o=this.velocity;n.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),n.scale(P,i,t*e),n.multiply(P,this.massMultiplier,P),n.add(o,P,o),this.integrateToTimeOfImpact(t)||(n.scale(C,o,t),n.add(s,s,C),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var T=new r,S=new h({mode:h.ALL}),A=n.create(),E=n.create(),I=n.create(),M=n.create();s.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||n.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;n.normalize(A,this.velocity),n.scale(E,this.velocity,t),n.add(E,E,this.position),n.sub(I,E,this.position);var e,i=this.angularVelocity*t,s=n.length(I),o=1,a=this;if(T.reset(),S.callback=function(t){t.body!==a&&(e=t.body,t.getHitPoint(E,S),n.sub(I,E,a.position),o=n.length(I)/s,t.stop())},n.copy(S.from,this.position),n.copy(S.to,E),S.update(),this.world.raycast(T,S),!e)return!1;var r=this.angle;n.copy(M,this.position);for(var h=0,l=0,c=0,u=o;u>=l&&h<this.ccdIterations;)h++,c=(u-l)/2,n.scale(C,I,o),n.add(this.position,M,C),this.angle=r+i*o,this.updateAABB(),this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e)?l=c:u=c;return o=c,n.copy(this.position,M),this.angle=r,n.scale(C,I,o),n.add(this.position,this.position,C),this.fixedRotation||(this.angle+=i*o),!0},s.prototype.getVelocityAtPoint=function(t,e){return n.crossVZ(t,e,this.angularVelocity),n.subtract(t,this.velocity,t),t},s.sleepyEvent={type:"sleepy"},s.sleepEvent={type:"sleep"},s.wakeUpEvent={type:"wakeup"},s.DYNAMIC=1,s.STATIC=2,s.KINEMATIC=4,s.AWAKE=0,s.SLEEPY=1,s.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){function s(t,e,i){i=i||{},o.call(this,t,e,i),this.localAnchorA=n.fromValues(0,0),this.localAnchorB=n.fromValues(0,0),i.localAnchorA&&n.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&n.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var s=n.create(),a=n.create();this.getWorldAnchorA(s),this.getWorldAnchorB(a);var r=n.distance(s,a);this.restLength="number"==typeof i.restLength?i.restLength:r}var n=t("../math/vec2"),o=t("./Spring");t("../utils/Utils"),e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},s.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},s.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},s.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var a=n.create(),r=n.create(),h=n.create(),l=n.create(),c=n.create(),u=n.create(),d=n.create(),p=n.create(),f=n.create();s.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,s=this.bodyA,o=this.bodyB,y=a,g=r,m=h,v=l,b=f,x=c,_=u,w=d,P=p;this.getWorldAnchorA(x),this.getWorldAnchorB(_),n.sub(w,x,s.position),n.sub(P,_,o.position),n.sub(y,_,x);var C=n.len(y);n.normalize(g,y),n.sub(m,o.velocity,s.velocity),n.crossZV(b,o.angularVelocity,P),n.add(m,m,b),n.crossZV(b,s.angularVelocity,w),n.sub(m,m,b),n.scale(v,g,-t*(C-i)-e*n.dot(m,g)),n.sub(s.force,s.force,v),n.add(o.force,o.force,v);var T=n.crossLength(w,v),S=n.crossLength(P,v);s.angularForce-=T,o.angularForce+=S}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){function s(t,e,i){i=i||{},n.call(this,t,e,i),this.restAngle="number"==typeof i.restAngle?i.restAngle:e.angle-t.angle}t("../math/vec2");var n=t("./Spring");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,s=this.bodyA,n=this.bodyB,o=n.angle-s.angle,a=n.angularVelocity-s.angularVelocity,r=-t*(o-i)-e*a*0;s.angularForce-=r,n.angularForce+=r}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){function s(t,e,i){i=n.defaults(i,{stiffness:100,damping:1}),this.stiffness=i.stiffness,this.damping=i.damping,this.bodyA=t,this.bodyB=e}t("../math/vec2");var n=t("../utils/Utils");e.exports=s,s.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){function s(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new h({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function n(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new r(t.chassisBody,t.groundBody),this.sideEquation=new r(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=o.fromValues(0,1),e.localForwardVector&&o.copy(this.localForwardVector,e.localForwardVector),this.localPosition=o.fromValues(0,0),e.localPosition&&o.copy(this.localPosition,e.localPosition),a.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var o=t("../math/vec2"),a=(t("../utils/Utils"),t("../constraints/Constraint")),r=t("../equations/FrictionEquation"),h=t("../objects/Body");e.exports=s,s.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},s.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},s.prototype.addWheel=function(t){var e=new n(this,t);return this.wheels.push(e),e},s.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},n.prototype=new a,n.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},n.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var l=o.create(),c=o.create();n.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(c,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(l,c),o.dot(l,c)};var u=o.create();n.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),o.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),o.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),o.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),o.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),o.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),o.normalize(u,this.forwardEquation.t),o.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){var s=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(s,"Rectangle",{get:function(){return this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){function s(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]}),t=t||{};var e=this.width=t.width||1,i=this.height=t.height||1,s=[n.fromValues(-e/2,-i/2),n.fromValues(e/2,-i/2),n.fromValues(e/2,i/2),n.fromValues(-e/2,i/2)],r=[n.fromValues(1,0),n.fromValues(0,1)];t.vertices=s,t.axes=r,t.type=o.BOX,a.call(this,t)}var n=t("../math/vec2"),o=t("./Shape"),a=t("./Convex");e.exports=s,s.prototype=new a,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12},s.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},n.create(),n.create(),n.create(),n.create(),s.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)},s.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){function s(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]}),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=n.CAPSULE,n.call(this,t)}var n=t("./Shape"),o=t("../math/vec2");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,s=2*e;return t*(s*s+i*i)/12},s.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},s.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var a=o.create();s.prototype.computeAABB=function(t,e,i){var s=this.radius;o.set(a,this.length/2,0),0!==i&&o.rotate(a,a,i),o.set(t.upperBound,Math.max(a[0]+s,-a[0]+s),Math.max(a[1]+s,-a[1]+s)),o.set(t.lowerBound,Math.min(a[0]-s,-a[0]-s),Math.min(a[1]-s,-a[1]-s)),o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e)};var r=o.create(),h=o.create(),l=o.create(),c=o.create(),u=o.fromValues(0,1);s.prototype.raycast=function(t,e,i,s){for(var n=e.from,a=e.to,d=(e.direction,r),p=h,f=l,y=c,g=this.length/2,m=0;m<2;m++){var v=this.radius*(2*m-1);o.set(f,-g,v),o.set(y,g,v),o.toGlobalFrame(f,f,i,s),o.toGlobalFrame(y,y,i,s);var b=o.getLineSegmentsIntersectionFraction(n,a,f,y);if(b>=0&&(o.rotate(p,u,s),o.scale(p,p,2*m-1),e.reportIntersection(t,b,p,-1),t.shouldStop(e)))return}for(var x=Math.pow(this.radius,2)+Math.pow(g,2),m=0;m<2;m++){o.set(f,g*(2*m-1),0),o.toGlobalFrame(f,f,i,s);var _=Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2),w=2*((a[0]-n[0])*(n[0]-f[0])+(a[1]-n[1])*(n[1]-f[1])),P=Math.pow(n[0]-f[0],2)+Math.pow(n[1]-f[1],2)-Math.pow(this.radius,2),b=Math.pow(w,2)-4*_*P;if(!(b<0))if(0===b){if(o.lerp(d,n,a,b),o.squaredDistance(d,i)>x&&(o.sub(p,d,f),o.normalize(p,p),e.reportIntersection(t,b,p,-1),t.shouldStop(e)))return}else{var C=Math.sqrt(b),T=1/(2*_),S=(-w-C)*T,A=(-w+C)*T;if(S>=0&&S<=1&&(o.lerp(d,n,a,S),o.squaredDistance(d,i)>x&&(o.sub(p,d,f),o.normalize(p,p),e.reportIntersection(t,S,p,-1),t.shouldStop(e))))return;if(A>=0&&A<=1&&(o.lerp(d,n,a,A),o.squaredDistance(d,i)>x&&(o.sub(p,d,f),o.normalize(p,p),e.reportIntersection(t,A,p,-1),t.shouldStop(e))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){function s(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]}),t=t||{},this.radius=t.radius||1,t.type=n.CIRCLE,n.call(this,t)}var n=t("./Shape"),o=t("../math/vec2");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},s.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},s.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},s.prototype.computeAABB=function(t,e,i){var s=this.radius;o.set(t.upperBound,s,s),o.set(t.lowerBound,-s,-s),e&&(o.add(t.lowerBound,t.lowerBound,e),o.add(t.upperBound,t.upperBound,e))};var a=o.create(),r=o.create();s.prototype.raycast=function(t,e,i,s){var n=e.from,h=e.to,l=this.radius,c=Math.pow(h[0]-n[0],2)+Math.pow(h[1]-n[1],2),u=2*((h[0]-n[0])*(n[0]-i[0])+(h[1]-n[1])*(n[1]-i[1])),d=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)-Math.pow(l,2),p=Math.pow(u,2)-4*c*d,f=a,y=r;if(!(p<0))if(0===p)o.lerp(f,n,h,p),o.sub(y,f,i),o.normalize(y,y),e.reportIntersection(t,p,y,-1);else{var g=Math.sqrt(p),m=1/(2*c),v=(-u-g)*m,b=(-u+g)*m;if(v>=0&&v<=1&&(o.lerp(f,n,h,v),o.sub(y,f,i),o.normalize(y,y),e.reportIntersection(t,v,y,-1),t.shouldStop(e)))return;b>=0&&b<=1&&(o.lerp(f,n,h,b),o.sub(y,f,i),o.normalize(y,y),e.reportIntersection(t,b,y,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){function s(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]}),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++){var s=o.create();o.copy(s,e[i]),this.vertices.push(s)}if(this.axes=[],t.axes)for(var i=0;i<t.axes.length;i++){var a=o.create();o.copy(a,t.axes[i]),this.axes.push(a)}else for(var i=0;i<this.vertices.length;i++){var r=this.vertices[i],h=this.vertices[(i+1)%this.vertices.length],l=o.create();o.sub(l,h,r),o.rotate90cw(l,l),o.normalize(l,l),this.axes.push(l)}if(this.centerOfMass=o.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=n.CONVEX,n.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var n=t("./Shape"),o=t("../math/vec2"),a=t("../math/polyk");t("poly-decomp"),e.exports=s,s.prototype=new n,s.prototype.constructor=s;var r=o.create(),h=o.create();s.prototype.projectOntoLocalAxis=function(t,e){for(var i,s,n=null,a=null,t=r,h=0;h<this.vertices.length;h++)i=this.vertices[h],s=o.dot(i,t),(null===n||s>n)&&(n=s),(null===a||s<a)&&(a=s);if(a>n){var l=a;a=n,n=l}o.set(e,a,n)},s.prototype.projectOntoWorldAxis=function(t,e,i,s){var n=h;this.projectOntoLocalAxis(t,s),0!==i?o.rotate(n,t,i):n=t;var a=o.dot(e,n);o.set(s,s[0]+a,s[1]+a)},s.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var s=a.Triangulate(t),e=0;e<s.length;e+=3){var n=s[e],o=s[e+1],r=s[e+2];this.triangles.push([n,o,r])}};var l=o.create(),c=o.create(),u=o.create(),d=o.create(),p=o.create();o.create(),o.create(),o.create(),o.create(),s.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,n=l,a=u,r=d,h=p,f=c;o.set(i,0,0);for(var y=0,g=0;g!==t.length;g++){var m=t[g],a=e[m[0]],r=e[m[1]],h=e[m[2]];o.centroid(n,a,r,h);var v=s.triangleArea(a,r,h);y+=v,o.scale(f,n,v),o.add(i,i,f)}o.scale(i,i,1/y)},s.prototype.computeMomentOfInertia=function(t){for(var e=0,i=0,s=this.vertices.length,n=s-1,a=0;a<s;n=a,a++){var r=this.vertices[n],h=this.vertices[a],l=Math.abs(o.crossLength(r,h));e+=l*(o.dot(h,h)+o.dot(h,r)+o.dot(r,r)),i+=l}return t/6*(e/i)},s.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var s=o.squaredLength(t[i]);s>e&&(e=s)}this.boundingRadius=Math.sqrt(e)},s.triangleArea=function(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))},s.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var n=t[i],o=e[n[0]],a=e[n[1]],r=e[n[2]],h=s.triangleArea(o,a,r);this.area+=h}},s.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var f=o.create(),y=o.create(),g=o.create();s.prototype.raycast=function(t,e,i,s){var n=f,a=y,r=g,h=this.vertices;o.toLocalFrame(n,e.from,i,s),o.toLocalFrame(a,e.to,i,s);for(var l=h.length,c=0;c<l&&!t.shouldStop(e);c++){var u=h[c],d=h[(c+1)%l],p=o.getLineSegmentsIntersectionFraction(n,a,u,d);p>=0&&(o.sub(r,d,u),o.rotate(r,r,-Math.PI/2+s),o.normalize(r,r),e.reportIntersection(t,p,r,c))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){function s(t){if(Array.isArray(arguments[0])&&(t={heights:arguments[0]},"object"==typeof arguments[1]))for(var e in arguments[1])t[e]=arguments[1][e];t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=n.HEIGHTFIELD,n.call(this,t)}var n=t("./Shape"),o=t("../math/vec2");t("../utils/Utils"),e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],s=0;s!==t.length;s++){var n=t[s];n>e&&(e=n),n<i&&(i=n)}this.maxValue=e,this.minValue=i},s.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},s.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},s.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var a=[o.create(),o.create(),o.create(),o.create()];s.prototype.computeAABB=function(t,e,i){o.set(a[0],0,this.maxValue),o.set(a[1],this.elementWidth*this.heights.length,this.maxValue),o.set(a[2],this.elementWidth*this.heights.length,this.minValue),o.set(a[3],0,this.minValue),t.setFromPoints(a,e,i)},s.prototype.getLineSegment=function(t,e,i){var s=this.heights,n=this.elementWidth;o.set(t,i*n,s[i]),o.set(e,(i+1)*n,s[i+1])},s.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},s.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))},o.create();var r=o.create(),h=o.create(),l=o.create(),c=o.create(),u=o.create();o.fromValues(0,1),s.prototype.raycast=function(t,e,i,s){var n=e.from,a=e.to,d=(e.direction,r),p=h,f=l,y=c,g=u;o.toLocalFrame(y,n,i,s),o.toLocalFrame(g,a,i,s);var m=this.getClampedSegmentIndex(y),v=this.getClampedSegmentIndex(g);if(m>v){var b=m;m=v,v=b}for(var x=0;x<this.heights.length-1;x++){this.getLineSegment(p,f,x);var _=o.getLineSegmentsIntersectionFraction(y,g,p,f);if(_>=0&&(o.sub(d,f,p),o.rotate(d,d,s+Math.PI/2),o.normalize(d,d),e.reportIntersection(t,_,d,-1),t.shouldStop(e)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){function s(t){"number"==typeof arguments[0]&&(t={length:arguments[0]}),t=t||{},this.length=t.length||1,t.type=n.LINE,n.call(this,t)}var n=t("./Shape"),o=t("../math/vec2");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},s.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[o.create(),o.create()];s.prototype.computeAABB=function(t,e,i){var s=this.length/2;o.set(a[0],-s,0),o.set(a[1],s,0),t.setFromPoints(a,e,i,0)},o.create();var r=o.create(),h=o.create(),l=o.create(),c=o.fromValues(0,1);s.prototype.raycast=function(t,e,i,s){var n=e.from,a=e.to,u=h,d=l,p=this.length/2;o.set(u,-p,0),o.set(d,p,0),o.toGlobalFrame(u,u,i,s),o.toGlobalFrame(d,d,i,s);var f=o.getLineSegmentsIntersectionFraction(u,d,n,a);if(f>=0){var y=r;o.rotate(y,c,s),e.reportIntersection(t,f,y,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){function s(t){(t=t||{}).type=n.PARTICLE,n.call(this,t)}var n=t("./Shape"),o=t("../math/vec2");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(t){return 0},s.prototype.updateBoundingRadius=function(){this.boundingRadius=0},s.prototype.computeAABB=function(t,e,i){o.copy(t.lowerBound,e),o.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){function s(t){(t=t||{}).type=n.PLANE,n.call(this,t)}var n=t("./Shape"),o=t("../math/vec2");t("../utils/Utils"),e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.computeMomentOfInertia=function(t){return 0},s.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},s.prototype.computeAABB=function(t,e,i){var s=i%(2*Math.PI),n=o.set,a=Number.MAX_VALUE,r=t.lowerBound,h=t.upperBound;0===s?(n(r,-a,-a),n(h,a,0)):s===Math.PI/2?(n(r,0,-a),n(h,a,a)):s===Math.PI?(n(r,-a,0),n(h,a,a)):s===3*Math.PI/2?(n(r,-a,-a),n(h,0,a)):(n(r,-a,-a),n(h,a,a)),o.add(r,r,e),o.add(h,h,e)},s.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var a=o.create(),r=(o.create(),o.create(),o.create()),h=o.create();s.prototype.raycast=function(t,e,i,s){var n=e.from,l=e.to,c=e.direction,u=a,d=r,p=h;o.set(d,0,1),o.rotate(d,d,s),o.sub(p,n,i);var f=o.dot(p,d);if(o.sub(p,l,i),!(f*o.dot(p,d)>0||o.squaredDistance(n,l)<f*f)){var y=o.dot(d,c);o.sub(u,n,i);var g=-o.dot(d,u)/y/e.length;e.reportIntersection(t,g,d,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){function s(t){t=t||{},this.body=null,this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=s.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}e.exports=s;var n=t("../math/vec2");s.idCounter=0,s.CIRCLE=1,s.PARTICLE=2,s.PLANE=4,s.CONVEX=8,s.LINE=16,s.BOX=32,Object.defineProperty(s,"RECTANGLE",{get:function(){return s.BOX}}),s.CAPSULE=64,s.HEIGHTFIELD=128,s.prototype.computeMomentOfInertia=function(t){},s.prototype.updateBoundingRadius=function(){},s.prototype.updateArea=function(){},s.prototype.computeAABB=function(t,e,i){},s.prototype.raycast=function(t,e,i,s){}},{"../math/vec2":30}],46:[function(t,e,i){function s(t){o.call(this,t,o.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new a.ARRAY_TYPE(this.arrayStep),this.Bs=new a.ARRAY_TYPE(this.arrayStep),this.invCs=new a.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=0,this.usedIterations=0}var n=t("../math/vec2"),o=t("./Solver"),a=t("../utils/Utils"),r=t("../equations/FrictionEquation");e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.solve=function(t,e){this.sortEquations();var i,o,h=0,l=this.iterations,c=this.frictionIterations,u=this.equations,d=u.length,p=Math.pow(this.tolerance*d,2),f=e.bodies,y=e.bodies.length,g=(n.add,n.set,this.useZeroRHS),m=this.lambda;if(this.usedIterations=0,d)for(var v=0;v!==y;v++){var b=f[v];b.updateSolveMassProperties()}m.length<d&&(m=this.lambda=new a.ARRAY_TYPE(d+this.arrayStep),this.Bs=new a.ARRAY_TYPE(d+this.arrayStep),this.invCs=new a.ARRAY_TYPE(d+this.arrayStep)),function(t){for(var e=t.length;e--;)t[e]=0}(m);for(var x=this.invCs,_=this.Bs,m=this.lambda,v=0;v!==u.length;v++){var w=u[v];(w.timeStep!==t||w.needsUpdate)&&(w.timeStep=t,w.update()),_[v]=w.computeB(w.a,w.b,t),x[v]=w.computeInvC(w.epsilon)}if(0!==d){for(v=0;v!==y;v++){var b=f[v];b.resetConstraintVelocity()}if(c){for(h=0;h!==c;h++){for(i=0,o=0;o!==d;o++){w=u[o];var P=s.iterateEquation(o,w,w.epsilon,_,x,m,g,t,h);i+=Math.abs(P)}if(this.usedIterations++,i*i<=p)break}for(s.updateMultipliers(u,m,1/t),o=0;o!==d;o++){var C=u[o];if(C instanceof r){for(var T=0,S=0;S!==C.contactEquations.length;S++)T+=C.contactEquations[S].multiplier;T*=C.frictionCoefficient/C.contactEquations.length,C.maxForce=T,C.minForce=-T}}}for(h=0;h!==l;h++){for(i=0,o=0;o!==d;o++){w=u[o];var P=s.iterateEquation(o,w,w.epsilon,_,x,m,g,t,h);i+=Math.abs(P)}if(this.usedIterations++,i*i<=p)break}for(v=0;v!==y;v++)f[v].addConstraintVelocity();s.updateMultipliers(u,m,1/t)}},s.updateMultipliers=function(t,e,i){for(var s=t.length;s--;)t[s].multiplier=e[s]*i},s.iterateEquation=function(t,e,i,s,n,o,a,r,h){var l=s[t],c=n[t],u=o[t],d=e.computeGWlambda(),p=e.maxForce,f=e.minForce;a&&(l=0);var y=c*(l-d-i*u),g=u+y;return g<f*r?y=f*r-u:g>p*r&&(y=p*r-u),o[t]+=y,e.addToWlambda(y),y}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){function s(t,e){t=t||{},n.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}t("../utils/Utils");var n=t("../events/EventEmitter");e.exports=s,s.prototype=new n,s.prototype.constructor=s,s.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};s.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),o.bodies.length=0,e.getBodies(o.bodies),o.bodies.length&&this.solve(t,o))},s.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},s.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},s.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var s=t[e];s.enabled&&this.equations.push(s)}},s.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);-1!==e&&this.equations.splice(e,1)},s.prototype.removeAllEquations=function(){this.equations.length=0},s.GS=1,s.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){function s(){o.apply(this,arguments)}var n=t("../equations/ContactEquation"),o=t("./Pool");e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.create=function(){return new n},s.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){function s(){o.apply(this,arguments)}var n=t("../equations/FrictionEquation"),o=t("./Pool");e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.create=function(){return new n},s.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){function s(){o.apply(this,arguments)}var n=t("../world/IslandNode"),o=t("./Pool");e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.create=function(){return new n},s.prototype.destroy=function(t){return t.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){function s(){o.apply(this,arguments)}var n=t("../world/Island"),o=t("./Pool");e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.create=function(){return new n},s.prototype.destroy=function(t){return t.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){function s(){this.overlappingShapesLastState=new n,this.overlappingShapesCurrentState=new n,this.recordPool=new o({size:16}),this.tmpDict=new n,this.tmpArray1=[]}var n=t("./TupleDictionary"),o=(t("./OverlapKeeperRecord"),t("./OverlapKeeperRecordPool"));t("./Utils"),e.exports=s,s.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var s=t.keys[i],n=t.getByKey(s);e.getByKey(s),n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},s.prototype.setOverlapping=function(t,e,i,s){this.overlappingShapesLastState;var n=this.overlappingShapesCurrentState;if(!n.get(e.id,s.id)){var o=this.recordPool.get();o.set(t,e,i,s),n.set(e.id,s.id,o)}},s.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},s.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},s.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,s=i.keys.length;s--;){var n=i.keys[s],o=i.data[n];if(o.bodyA===t&&o.bodyB===e||o.bodyA===e&&o.bodyB===t)return!0}return!1},s.prototype.getDiff=function(t,e,i){var i=i||[],s=t,n=e;i.length=0;for(var o=n.keys.length;o--;){var a=n.keys[o],r=n.data[a];if(!r)throw new Error("Key "+a+" had no data!");s.data[a]||i.push(r)}return i},s.prototype.isNewOverlap=function(t,e){var i=0|t.id,s=0|e.id,n=this.overlappingShapesLastState,o=this.overlappingShapesCurrentState;return!n.get(i,s)&&!!o.get(i,s)},s.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},s.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},s.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,s=t.length;s--;){var n=t[s];i.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(s=i.keys.length;s--;){var n=i.getByKey(i.keys[s]);n&&e.push(n.bodyA,n.bodyB)}return i.reset(),e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){function s(t,e,i,s){this.shapeA=e,this.shapeB=s,this.bodyA=t,this.bodyB=i}e.exports=s,s.prototype.set=function(t,e,i,n){s.call(this,t,e,i,n)}},{}],54:[function(t,e,i){function s(){o.apply(this,arguments)}var n=t("./OverlapKeeperRecord"),o=t("./Pool");e.exports=s,s.prototype=new o,s.prototype.constructor=s,s.prototype.create=function(){return new n},s.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){function s(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}e.exports=s,s.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},s.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},s.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},{}],56:[function(t,e,i){function s(){this.data={},this.keys=[]}var n=t("./Utils");e.exports=s,s.prototype.getKey=function(t,e){return(0|(t|=0))==(0|(e|=0))?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},s.prototype.getByKey=function(t){return t|=0,this.data[t]},s.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},s.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var s=this.getKey(t,e);return this.data[s]||this.keys.push(s),this.data[s]=i,s},s.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},s.prototype.copy=function(t){this.reset(),n.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){function s(){}e.exports=s,s.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,s=e.length;i!==s;++i)t.push(e[i])},s.splice=function(t,e,i){i=i||1;for(var s=e,n=t.length-i;s<n;s++)t[s]=t[s+i];t.length=n},"undefined"!=typeof P2_ARRAY_TYPE?s.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?s.ARRAY_TYPE=Float32Array:s.ARRAY_TYPE=Array,s.extend=function(t,e){for(var i in e)t[i]=e[i]},s.defaults=function(t,e){for(var i in t=t||{},e)i in t||(t[i]=e[i]);return t}},{}],58:[function(t,e,i){function s(){this.equations=[],this.bodies=[]}var n=t("../objects/Body");e.exports=s,s.prototype.reset=function(){this.equations.length=this.bodies.length=0};var o=[];s.prototype.getBodies=function(t){var e=t||[],i=this.equations;o.length=0;for(var s=0;s!==i.length;s++){var n=i[s];-1===o.indexOf(n.bodyA.id)&&(e.push(n.bodyA),o.push(n.bodyA.id)),-1===o.indexOf(n.bodyB.id)&&(e.push(n.bodyB),o.push(n.bodyB.id))}return e},s.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===n.DYNAMIC&&!e.wantsToSleep)return!1}return!0},s.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++)this.bodies[t].sleep();return!0}},{"../objects/Body":31}],59:[function(t,e,i){function s(t){this.nodePool=new n({size:16}),this.islandPool=new o({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}t("../math/vec2"),t("./Island"),t("./IslandNode");var n=t("./../utils/IslandNodePool"),o=t("./../utils/IslandPool"),a=t("../objects/Body");e.exports=s,s.getUnvisitedNode=function(t){for(var e=t.length,i=0;i!==e;i++){var s=t[i];if(!s.visited&&s.body.type===a.DYNAMIC)return s}return!1},s.prototype.visit=function(t,e,i){e.push(t.body);for(var s=t.equations.length,n=0;n!==s;n++){var o=t.equations[n];-1===i.indexOf(o)&&i.push(o)}},s.prototype.bfs=function(t,e,i){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,i);n.length;)for(var o,r=n.pop();o=s.getUnvisitedNode(r.neighbors);)o.visited=!0,this.visit(o,e,i),o.body.type===a.DYNAMIC&&n.push(o)},s.prototype.split=function(t){for(var e=t.bodies,i=this.nodes,n=this.equations;i.length;)this.nodePool.release(i.pop());for(var o=0;o!==e.length;o++){var a=this.nodePool.get();a.body=e[o],i.push(a)}for(var r=0;r!==n.length;r++){var h=n[r],o=e.indexOf(h.bodyA),l=e.indexOf(h.bodyB),c=i[o],u=i[l];c.neighbors.push(u),u.neighbors.push(c),c.equations.push(h),u.equations.push(h)}for(var d=this.islands,o=0;o<d.length;o++)this.islandPool.release(d[o]);d.length=0;for(var p;p=s.getUnvisitedNode(i);){var f=this.islandPool.get();this.bfs(p,f.bodies,f.equations),d.push(f)}return d}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){function s(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}e.exports=s,s.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(t,e,i){function s(t){u.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new n,this.narrowphase=new m(this),this.islandManager=new x,this.gravity=o.fromValues(0,-9.78),t.gravity&&o.copy(this.gravity,t.gravity),this.frictionGravity=o.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new g,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new p,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=s.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new b}var n=t("../solver/GSSolver"),o=(t("../solver/Solver"),t("../collision/Ray"),t("../math/vec2")),a=t("../shapes/Circle"),r=t("../shapes/Convex"),h=(t("../shapes/Line"),t("../shapes/Plane")),l=t("../shapes/Capsule"),c=t("../shapes/Particle"),u=t("../events/EventEmitter"),d=t("../objects/Body"),p=(t("../shapes/Shape"),t("../objects/LinearSpring"),t("../material/Material")),f=t("../material/ContactMaterial"),y=(t("../constraints/DistanceConstraint"),t("../constraints/Constraint"),t("../constraints/LockConstraint"),t("../constraints/RevoluteConstraint"),t("../constraints/PrismaticConstraint"),t("../constraints/GearConstraint"),t("../../package.json"),t("../collision/Broadphase"),t("../collision/AABB")),g=t("../collision/SAPBroadphase"),m=t("../collision/Narrowphase"),v=t("../utils/Utils"),b=t("../utils/OverlapKeeper"),x=t("./IslandManager");t("../objects/RotationalSpring"),e.exports=s,s.prototype=new Object(u.prototype),s.prototype.constructor=s,s.NO_SLEEPING=1,s.BODY_SLEEPING=2,s.ISLAND_SLEEPING=4,s.prototype.addConstraint=function(t){this.constraints.push(t)},s.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},s.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);-1!==e&&v.splice(this.contactMaterials,e,1)},s.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,s=0,n=i.length;s!==n;s++){var o=i[s];if(o.materialA.id===t.id&&o.materialB.id===e.id||o.materialA.id===e.id&&o.materialB.id===t.id)return o}return!1},s.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&v.splice(this.constraints,e,1)},o.create(),o.create(),o.create(),o.create(),o.create(),o.create();var _=o.create(),w=o.fromValues(0,0),P=o.fromValues(0,0);o.fromValues(0,0),o.fromValues(0,0),s.prototype.step=function(t,e,i){if(i=i||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var s=0;this.accumulator>=t&&s<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,s++;for(var n=this.accumulator%t/t,a=0;a!==this.bodies.length;a++){var r=this.bodies[a];o.lerp(r.interpolatedPosition,r.previousPosition,r.position,n),r.interpolatedAngle=r.previousAngle+n*(r.angle-r.previousAngle)}}};var C=[];s.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,n=this.bodies,a=this.gravity,r=this.solver,h=this.bodies.length,l=this.broadphase,c=this.narrowphase,u=this.constraints,p=_,f=(o.scale,o.add),y=(o.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var g=o.length(this.gravity);0===g&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=g)}if(this.applyGravity)for(var m=0;m!==h;m++){var b=n[m],x=b.force;b.type===d.DYNAMIC&&b.sleepState!==d.SLEEPING&&(o.scale(p,a,b.mass*b.gravityScale),f(x,x,p))}if(this.applySpringForces)for(var m=0;m!==e;m++){var w=i[m];w.applyForce()}if(this.applyDamping)for(var m=0;m!==h;m++){var b=n[m];b.type===d.DYNAMIC&&b.applyDamping(t)}for(var P=l.getCollisionPairs(this),T=this.disabledBodyCollisionPairs,m=T.length-2;m>=0;m-=2)for(var S=P.length-2;S>=0;S-=2)(T[m]===P[S]&&T[m+1]===P[S+1]||T[m+1]===P[S]&&T[m]===P[S+1])&&P.splice(S,2);var A=u.length;for(m=0;m!==A;m++){var E=u[m];if(!E.collideConnected)for(var S=P.length-2;S>=0;S-=2)(E.bodyA===P[S]&&E.bodyB===P[S+1]||E.bodyB===P[S]&&E.bodyA===P[S+1])&&P.splice(S,2)}this.postBroadphaseEvent.pairs=P,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,c.reset(this);for(var m=0,I=P.length;m!==I;m+=2)for(var M=P[m],O=P[m+1],R=0,B=M.shapes.length;R!==B;R++)for(var L=M.shapes[R],D=L.position,k=L.angle,F=0,G=O.shapes.length;F!==G;F++){var U=O.shapes[F],N=U.position,j=U.angle,W=this.defaultContactMaterial;if(L.material&&U.material){var X=this.getContactMaterial(L.material,U.material);X&&(W=X)}this.runNarrowphase(c,M,L,D,k,O,U,N,j,W,this.frictionGravity)}for(var m=0;m!==h;m++){var H=n[m];H._wakeUpAfterNarrowphase&&(H.wakeUp(),H._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(C);for(var V=this.endContactEvent,F=C.length;F--;){var Y=C[F];V.shapeA=Y.shapeA,V.shapeB=Y.shapeB,V.bodyA=Y.bodyA,V.bodyB=Y.bodyB,this.emit(V)}C.length=0}var q=this.preSolveEvent;q.contactEquations=c.contactEquations,q.frictionEquations=c.frictionEquations,this.emit(q),q.contactEquations=q.frictionEquations=null;var A=u.length;for(m=0;m!==A;m++)u[m].update();if(c.contactEquations.length||c.frictionEquations.length||A)if(this.islandSplit){for(y.equations.length=0,v.appendArray(y.equations,c.contactEquations),v.appendArray(y.equations,c.frictionEquations),m=0;m!==A;m++)v.appendArray(y.equations,u[m].equations);y.split(this);for(var m=0;m!==y.islands.length;m++){var z=y.islands[m];z.equations.length&&r.solveIsland(t,z)}}else{for(r.addEquations(c.contactEquations),r.addEquations(c.frictionEquations),m=0;m!==A;m++)r.addEquations(u[m].equations);this.solveConstraints&&r.solve(t,this),r.removeAllEquations()}for(var m=0;m!==h;m++){var H=n[m];H.integrate(t)}for(var m=0;m!==h;m++)n[m].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var K=this.impactEvent,m=0;m!==c.contactEquations.length;m++){var J=c.contactEquations[m];J.firstImpact&&(K.bodyA=J.bodyA,K.bodyB=J.bodyB,K.shapeA=J.shapeA,K.shapeB=J.shapeB,K.contactEquation=J,this.emit(K))}if(this.sleepMode===s.BODY_SLEEPING)for(m=0;m!==h;m++)n[m].sleepTick(this.time,!1,t);else if(this.sleepMode===s.ISLAND_SLEEPING&&this.islandSplit){for(m=0;m!==h;m++)n[m].sleepTick(this.time,!0,t);for(var m=0;m<this.islandManager.islands.length;m++){var z=this.islandManager.islands[m];z.wantsToSleep()&&z.sleep()}}this.stepping=!1;for(var Z=this.bodiesToBeRemoved,m=0;m!==Z.length;m++)this.removeBody(Z[m]);Z.length=0,this.emit(this.postStepEvent)},s.prototype.runNarrowphase=function(t,e,i,s,n,a,r,h,l,c,u){if(0!=(i.collisionGroup&r.collisionMask)&&0!=(r.collisionGroup&i.collisionMask)){o.rotate(w,s,e.angle),o.rotate(P,h,a.angle),o.add(w,w,e.position),o.add(P,P,a.position);var p,f=n+e.angle,y=l+a.angle;t.enableFriction=c.friction>0,t.frictionCoefficient=c.friction,p=e.type===d.STATIC||e.type===d.KINEMATIC?a.mass:a.type===d.STATIC||a.type===d.KINEMATIC?e.mass:e.mass*a.mass/(e.mass+a.mass),t.slipForce=c.friction*u*p,t.restitution=c.restitution,t.surfaceVelocity=c.surfaceVelocity,t.frictionStiffness=c.frictionStiffness,t.frictionRelaxation=c.frictionRelaxation,t.stiffness=c.stiffness,t.relaxation=c.relaxation,t.contactSkinSize=c.contactSkinSize,t.enabledEquations=e.collisionResponse&&a.collisionResponse&&i.collisionResponse&&r.collisionResponse;var g=t[i.type|r.type],m=0;if(g){var v=i.sensor||r.sensor,b=t.frictionEquations.length;m=i.type<r.type?g.call(t,e,i,w,f,a,r,P,y,v):g.call(t,a,r,P,y,e,i,w,f,v);var x=t.frictionEquations.length-b;if(m){if(e.allowSleep&&e.type===d.DYNAMIC&&e.sleepState===d.SLEEPING&&a.sleepState===d.AWAKE&&a.type!==d.STATIC&&o.squaredLength(a.velocity)+Math.pow(a.angularVelocity,2)>=2*Math.pow(a.sleepSpeedLimit,2)&&(e._wakeUpAfterNarrowphase=!0),a.allowSleep&&a.type===d.DYNAMIC&&a.sleepState===d.SLEEPING&&e.sleepState===d.AWAKE&&e.type!==d.STATIC&&o.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2)>=2*Math.pow(e.sleepSpeedLimit,2)&&(a._wakeUpAfterNarrowphase=!0),this.overlapKeeper.setOverlapping(e,i,a,r),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,r)){var _=this.beginContactEvent;if(_.shapeA=i,_.shapeB=r,_.bodyA=e,_.bodyB=a,_.contactEquations.length=0,"number"==typeof m)for(var C=t.contactEquations.length-m;C<t.contactEquations.length;C++)_.contactEquations.push(t.contactEquations[C]);this.emit(_)}if("number"==typeof m&&x>1)for(var C=t.frictionEquations.length-x;C<t.frictionEquations.length;C++){var T=t.frictionEquations[C];T.setSlipForce(T.getSlipForce()/x)}}}}},s.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},s.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);-1!==e&&v.splice(this.springs,e,1)},s.prototype.addBody=function(t){if(-1===this.bodies.indexOf(t)){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},s.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);-1!==e&&(v.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},s.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var s=e[i];if(s.id===t)return s}return!1},s.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},s.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,s=0;s<i.length;s+=2)if(i[s]===t&&i[s+1]===e||i[s+1]===t&&i[s]===e)return void i.splice(s,2)},s.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var i=this.bodies,e=i.length-1;e>=0;e--)this.removeBody(i[e]);for(var n=this.springs,e=n.length-1;e>=0;e--)this.removeSpring(n[e]);for(var o=this.contactMaterials,e=o.length-1;e>=0;e--)this.removeContactMaterial(o[e]);s.apply(this)};var T=o.create(),S=(o.fromValues(0,0),o.fromValues(0,0));s.prototype.hitTest=function(t,e,i){i=i||0;var s=new d({position:t}),n=new c,u=t,p=T,f=S;s.addShape(n);for(var y=this.narrowphase,g=[],m=0,v=e.length;m!==v;m++)for(var b=e[m],x=0,_=b.shapes.length;x!==_;x++){var w=b.shapes[x];o.rotate(p,w.position,b.angle),o.add(p,p,b.position);var P=w.angle+b.angle;(w instanceof a&&y.circleParticle(b,w,p,P,s,n,u,0,!0)||w instanceof r&&y.particleConvex(s,n,u,0,b,w,p,P,!0)||w instanceof h&&y.particlePlane(s,n,u,0,b,w,p,P,!0)||w instanceof l&&y.particleCapsule(s,n,u,0,b,w,p,P,!0)||w instanceof c&&o.squaredLength(o.sub(f,p,t))<i*i)&&g.push(b)}return g},s.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,i=0;i!==e.length;i++)for(var s=e[i],n=0;n!==s.equations.length;n++){var o=s.equations[n];o.stiffness=t,o.needsUpdate=!0}for(var a=this.contactMaterials,i=0;i!==a.length;i++){var s=a[i];s.stiffness=s.frictionStiffness=t}var s=this.defaultContactMaterial;s.stiffness=s.frictionStiffness=t},s.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var i=this.constraints[e],s=0;s!==i.equations.length;s++){var n=i.equations[s];n.relaxation=t,n.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];i.relaxation=i.frictionRelaxation=t}var i=this.defaultContactMaterial;i.relaxation=i.frictionRelaxation=t};var A=new y,E=[];s.prototype.raycast=function(t,e){return e.getAABB(A),this.broadphase.aabbQuery(this,A,E),e.intersectBodies(t,E),E.length=0,t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)},function(t,e,i){(function(){var i=i||{};return i.game=null,i.WEBGL_RENDERER=0,i.CANVAS_RENDERER=1,i.VERSION="v2.2.9",i._UID=0,"undefined"!=typeof Float32Array?(i.Float32Array=Float32Array,i.Uint16Array=Uint16Array,i.Uint32Array=Uint32Array,i.ArrayBuffer=ArrayBuffer):(i.Float32Array=Array,i.Uint16Array=Array),i.PI_2=2*Math.PI,i.RAD_TO_DEG=180/Math.PI,i.DEG_TO_RAD=Math.PI/180,i.RETINA_PREFIX="@2x",i.DisplayObject=function(){this.position=new i.Point(0,0),this.scale=new i.Point(1,1),this.pivot=new i.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new i.Matrix,this.worldPosition=new i.Point(0,0),this.worldScale=new i.Point(1,1),this.worldRotation=0,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new i.Rectangle(0,0,0,0),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},i.DisplayObject.prototype.constructor=i.DisplayObject,i.DisplayObject.prototype={destroy:function(){if(this.children){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.worldTransform=null,this.filterArea=null,this.renderable=!1,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite()},updateTransform:function(t){if(!t&&!this.parent&&!this.game)return this;var e=this.parent;t?e=t:this.parent||(e=this.game.world);var s,n,o,a,r,h,l=e.worldTransform,c=this.worldTransform;return this.rotation%i.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),s=this._cr*this.scale.x,n=this._sr*this.scale.x,o=-this._sr*this.scale.y,a=this._cr*this.scale.y,r=this.position.x,h=this.position.y,(this.pivot.x||this.pivot.y)&&(r-=this.pivot.x*s+this.pivot.y*o,h-=this.pivot.x*n+this.pivot.y*a),c.a=s*l.a+n*l.c,c.b=s*l.b+n*l.d,c.c=o*l.a+a*l.c,c.d=o*l.b+a*l.d,c.tx=r*l.a+h*l.c+l.tx,c.ty=r*l.b+h*l.d+l.ty):(s=this.scale.x,a=this.scale.y,r=this.position.x-this.pivot.x*s,h=this.position.y-this.pivot.y*a,c.a=s*l.a,c.b=s*l.b,c.c=a*l.c,c.d=a*l.d,c.tx=r*l.a+h*l.c+l.tx,c.ty=r*l.b+h*l.d+l.ty),this.worldAlpha=this.alpha*e.worldAlpha,this.worldPosition.set(c.tx,c.ty),this.worldScale.set(this.scale.x*Math.sqrt(c.a*c.a+c.c*c.c),this.scale.y*Math.sqrt(c.b*c.b+c.d*c.d)),this.worldRotation=Math.atan2(-c.c,c.d),this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,c,l),this},preUpdate:function(){},generateTexture:function(t,e,s){var n=this.getLocalBounds(),o=new i.RenderTexture(0|n.width,0|n.height,s,e,t);return i.DisplayObject._tempMatrix.tx=-n.x,i.DisplayObject._tempMatrix.ty=-n.y,o.render(this,i.DisplayObject._tempMatrix),o},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(t){return this.updateTransform(),this.worldTransform.apply(t)},toLocal:function(t,e){return e&&(t=e.toGlobal(t)),this.updateTransform(),this.worldTransform.applyInverse(t)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?i.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):i.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(t.width=Math.max(1,Math.ceil(t.width)),t.height=Math.max(1,Math.ceil(t.height)),this.updateTransform(),this._cachedSprite)this._cachedSprite.texture.resize(t.width,t.height);else{var e=new i.RenderTexture(t.width,t.height);this._cachedSprite=new i.Sprite(e),this._cachedSprite.worldTransform=this.worldTransform}var s=this._filters;this._filters=null,this._cachedSprite.filters=s,i.DisplayObject._tempMatrix.tx=-t.x,i.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,i.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._filters=s,this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}},i.DisplayObject.prototype.displayObjectUpdateTransform=i.DisplayObject.prototype.updateTransform,Object.defineProperties(i.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(this.visible){var t=this.parent;if(!t)return this.visible;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}return!1}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,t&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(t){if(Array.isArray(t)){for(var e=[],s=0;s<t.length;s++)for(var n=t[s].passes,o=0;o<n.length;o++)e.push(n[o]);this._filterBlock={target:this,filterPasses:e}}this._filters=t,this.blendMode&&this.blendMode===i.blendModes.MULTIPLY&&(this.blendMode=i.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}}),i.DisplayObjectContainer=function(){i.DisplayObject.call(this),this.children=[],this.ignoreChildInput=!1},i.DisplayObjectContainer.prototype=Object.create(i.DisplayObject.prototype),i.DisplayObjectContainer.prototype.constructor=i.DisplayObjectContainer,i.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},i.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},i.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),s=this.getChildIndex(e);if(i<0||s<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[s]=t}},i.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},i.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},i.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},i.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},i.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(e.parent=void 0,this.children.splice(t,1)),e},i.DisplayObjectContainer.prototype.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.children.length);var i=e-t;if(i>0&&i<=e){for(var s=this.children.splice(begin,i),n=0;n<s.length;n++)s[n].parent=void 0;return s}if(0===i&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},i.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},i.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=i.DisplayObjectContainer.prototype.updateTransform,i.DisplayObjectContainer.prototype.getBounds=function(t){var e,s=t&&t instanceof i.DisplayObject,n=!0;if(s?n=t instanceof i.DisplayObjectContainer&&t.contains(this):t=this,s){var o=t.worldTransform;for(t.worldTransform=i.identityMatrix,e=0;e<t.children.length;e++)t.children[e].updateTransform()}var a,r,h,l=1/0,c=1/0,u=-1/0,d=-1/0,p=!1;for(e=0;e<this.children.length;e++)this.children[e].visible&&(p=!0,l=l<(a=this.children[e].getBounds()).x?l:a.x,c=c<a.y?c:a.y,u=u>(r=a.width+a.x)?u:r,d=d>(h=a.height+a.y)?d:h);var f=this._bounds;if(!p){var y=(f=new i.Rectangle).x,g=f.width+f.x,m=f.y,v=f.height+f.y,b=this.worldTransform,x=b.a,_=b.b,w=b.c,P=b.d,C=b.tx,T=b.ty,S=x*g+w*v+C,A=P*v+_*g+T,E=x*y+w*v+C,I=P*v+_*y+T,M=x*y+w*m+C,O=P*m+_*y+T,R=x*g+w*m+C,B=P*m+_*g+T;l=R<(l=M<(l=E<(l=S)?E:l)?M:l)?R:l,c=B<(c=O<(c=I<(c=A)?I:c)?O:c)?B:c,u=R>(u=M>(u=E>(u=S)?E:u)?M:u)?R:u,d=B>(d=O>(d=I>(d=A)?I:d)?O:d)?B:d}if(f.x=l,f.y=c,f.width=u-l,f.height=d-c,s)for(t.worldTransform=o,e=0;e<t.children.length;e++)t.children[e].updateTransform();if(!n){var L=t.getBounds();f.x-=L.x,f.y-=L.y}return f},i.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},i.DisplayObjectContainer.prototype.contains=function(t){return!!t&&(t===this||this.contains(t.parent))},i.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);var e;if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t)}},i.DisplayObjectContainer.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0;e<this.children.length;e++)this.children[e]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},Object.defineProperty(i.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(t){var e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}}),Object.defineProperty(i.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(t){var e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}),i.Sprite=function(t){i.DisplayObjectContainer.call(this),this.anchor=new i.Point,this.texture=t||i.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=i.blendModes.NORMAL,this.shader=null,this.exists=!0,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},i.Sprite.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Sprite.prototype.constructor=i.Sprite,Object.defineProperty(i.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(i.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),i.Sprite.prototype.setTexture=function(t,e){void 0!==e&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=t,this.texture.valid=!0,this.cachedTint=-1},i.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},i.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,s=e*(1-this.anchor.x),n=e*-this.anchor.x,o=i*(1-this.anchor.y),a=i*-this.anchor.y,r=t||this.worldTransform,h=r.a,l=r.b,c=r.c,u=r.d,d=r.tx,p=r.ty,f=-1/0,y=-1/0,g=1/0,m=1/0;if(0===l&&0===c){if(h<0){h*=-1;var v=s;s=-n,n=-v}if(u<0){u*=-1;v=o;o=-a,a=-v}g=h*n+d,f=h*s+d,m=u*a+p,y=u*o+p}else{var b=h*n+c*a+d,x=u*a+l*n+p,_=h*s+c*a+d,w=u*a+l*s+p,P=h*s+c*o+d,C=u*o+l*s+p,T=h*n+c*o+d,S=u*o+l*n+p;g=T<(g=P<(g=_<(g=b<g?b:g)?_:g)?P:g)?T:g,m=S<(m=C<(m=w<(m=x<m?x:m)?w:m)?C:m)?S:m,f=T>(f=P>(f=_>(f=b>f?b:f)?_:f)?P:f)?T:f,y=S>(y=C>(y=w>(y=x>y?x:y)?w:y)?C:y)?S:y}var A=this._bounds;return A.x=g,A.width=f-g,A.y=m,A.height=y-m,this._currentBounds=A,A},i.Sprite.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=i.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var s=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return s},i.Sprite.prototype._renderWebGL=function(t,e){if(this.visible&&!(this.alpha<=0)&&this.renderable){var i=this.worldTransform;if(e&&(i=e),this._mask||this._filters){var s=t.spriteBatch;this._filters&&(s.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(s.stop(),t.maskManager.pushMask(this.mask,t),s.start()),s.render(this);for(var n=0;n<this.children.length;n++)this.children[n]._renderWebGL(t);s.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),s.start()}else{t.spriteBatch.render(this);for(n=0;n<this.children.length;n++)this.children[n]._renderWebGL(t,i)}}},i.Sprite.prototype._renderCanvas=function(t,e){if(!(!this.visible||0===this.alpha||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0)){var s=this.worldTransform;if(e&&(s=e),this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=i.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var n=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===i.scaleModes.LINEAR);var o=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,a=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,r=s.tx*t.resolution+t.shakeX,h=s.ty*t.resolution+t.shakeY;t.roundPixels?(t.context.setTransform(s.a,s.b,s.c,s.d,0|r,0|h),o|=0,a|=0):t.context.setTransform(s.a,s.b,s.c,s.d,r,h);var l=this.texture.crop.width,c=this.texture.crop.height;if(o/=n,a/=n,16777215!==this.tint)(this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=i.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),t.context.drawImage(this.tintedTexture,0,0,l,c,o,a,l/n,c/n);else{var u=this.texture.crop.x,d=this.texture.crop.y;t.context.drawImage(this.texture.baseTexture.source,u,d,l,c,o,a,l/n,c/n)}}for(var p=0;p<this.children.length;p++)this.children[p]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},i.SpriteBatch=function(t){i.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},i.SpriteBatch.prototype=Object.create(i.DisplayObjectContainer.prototype),i.SpriteBatch.prototype.constructor=i.SpriteBatch,i.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new i.WebGLFastSpriteBatch(t),this.ready=!0},i.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},i.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),this.fastSpriteBatch.gl!==t.gl&&this.fastSpriteBatch.setContext(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},i.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var e=t.context;e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=this.worldTransform,s=!0,n=0;n<this.children.length;n++){var o=this.children[n];if(o.visible){var a=o.texture,r=a.frame;if(e.globalAlpha=this.worldAlpha*o.alpha,o.rotation%(2*Math.PI)==0)s&&(e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),s=!1),e.drawImage(a.baseTexture.source,r.x,r.y,r.width,r.height,o.anchor.x*(-r.width*o.scale.x)+o.position.x+.5+t.shakeX|0,o.anchor.y*(-r.height*o.scale.y)+o.position.y+.5+t.shakeY|0,r.width*o.scale.x,r.height*o.scale.y);else{s||(s=!0),o.displayObjectUpdateTransform();var h=o.worldTransform,l=h.tx*t.resolution+t.shakeX,c=h.ty*t.resolution+t.shakeY;t.roundPixels?e.setTransform(h.a,h.b,h.c,h.d,0|l,0|c):e.setTransform(h.a,h.b,h.c,h.d,l,c),e.drawImage(a.baseTexture.source,r.x,r.y,r.width,r.height,o.anchor.x*-r.width+.5|0,o.anchor.y*-r.height+.5|0,r.width,r.height)}}}}},i.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},i.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},i.canUseNewCanvasBlendModes=function(){if(void 0===document)return!1;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",s=new Image;s.src=t+"AP804Oa6"+e;var n=new Image;n.src=t+"/wCKxvRF"+e;var o=i.CanvasPool.create(this,6,1).getContext("2d");if(o.globalCompositeOperation="multiply",o.drawImage(s,0,0),o.drawImage(n,2,0),!o.getImageData(2,0,1,1))return!1;var a=o.getImageData(2,0,1,1).data;return i.CanvasPool.remove(this),255===a[0]&&0===a[1]&&0===a[2]},i.getNextPowerOfTwo=function(t){if(t>0&&0==(t&t-1))return t;for(var e=1;e<t;)e<<=1;return e},i.isPowerOfTwo=function(t,e){return t>0&&0==(t&t-1)&&e>0&&0==(e&e-1)},i.CanvasPool={create:function(t,e,s){var n,o=i.CanvasPool.getFirst();if(-1===o){var a={parent:t,canvas:document.createElement("canvas")};i.CanvasPool.pool.push(a),n=a.canvas}else i.CanvasPool.pool[o].parent=t,n=i.CanvasPool.pool[o].canvas;return void 0!==e&&(n.width=e,n.height=s),n},getFirst:function(){for(var t=i.CanvasPool.pool,e=0;e<t.length;e++)if(!t[e].parent)return e;return-1},remove:function(t){for(var e=i.CanvasPool.pool,s=0;s<e.length;s++)e[s].parent===t&&(e[s].parent=null,e[s].canvas.width=1,e[s].canvas.height=1)},removeByCanvas:function(t){for(var e=i.CanvasPool.pool,s=0;s<e.length;s++)e[s].canvas===t&&(e[s].parent=null,e[s].canvas.width=1,e[s].canvas.height=1)},getTotal:function(){for(var t=i.CanvasPool.pool,e=0,s=0;s<t.length;s++)t[s].parent&&e++;return e},getFree:function(){for(var t=i.CanvasPool.pool,e=0,s=0;s<t.length;s++)t[s].parent||e++;return e}},i.CanvasPool.pool=[],i.initDefaultShaders=function(){},i.CompileVertexShader=function(t,e){return i._CompileShader(t,e,t.VERTEX_SHADER)},i.CompileFragmentShader=function(t,e){return i._CompileShader(t,e,t.FRAGMENT_SHADER)},i._CompileShader=function(t,e,i){var s=e;Array.isArray(e)&&(s=e.join("\n"));var n=t.createShader(i);return t.shaderSource(n,s),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(window.console.log(t.getShaderInfoLog(n)),null)},i.compileProgram=function(t,e,s){var n=i.CompileFragmentShader(t,s),o=i.CompileVertexShader(t,e),a=t.createProgram();return t.attachShader(a,o),t.attachShader(a,n),t.linkProgram(a),t.getProgramParameter(a,t.LINK_STATUS)||(window.console.log(t.getProgramInfoLog(a)),window.console.log("Could not initialise shaders")),a},i.PixiShader=function(t){this._UID=i._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},i.PixiShader.prototype.constructor=i.PixiShader,i.PixiShader.prototype.init=function(){var t=this.gl,e=i.compileProgram(t,this.vertexSrc||i.PixiShader.defaultVertexSrc,this.fragmentSrc);for(var s in t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.uniforms)this.uniforms[s].uniformLocation=t.getUniformLocation(e,s);this.initUniforms(),this.program=e},i.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){var s=(t=this.uniforms[i]).type;"sampler2D"===s?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===s||"mat3"===s||"mat4"===s?(t.glMatrix=!0,t.glValueLength=1,"mat2"===s?t.glFunc=e.uniformMatrix2fv:"mat3"===s?t.glFunc=e.uniformMatrix3fv:"mat4"===s&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+s],t.glValueLength="2f"===s||"2i"===s?2:"3f"===s||"3i"===s?3:"4f"===s||"4i"===s?4:1)}},i.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,s=i.magFilter?i.magFilter:e.LINEAR,n=i.minFilter?i.minFilter:e.LINEAR,o=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,a=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,r=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(o=e.REPEAT,a=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var h=i.width?i.width:512,l=i.height?i.height:2,c=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,r,h,l,c,r,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,r,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},i.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var s in this.uniforms)1===(t=this.uniforms[s]).glValueLength?!0===t.glMatrix?t.glFunc.call(e,t.uniformLocation,t.transpose,t.value):t.glFunc.call(e,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(e.activeTexture(e["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[e.id]?i.instances[e.id].updateTexture(t.value.baseTexture):e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),e.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},i.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},i.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],i.PixiFastShader=function(t){this._UID=i._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},i.PixiFastShader.prototype.constructor=i.PixiFastShader,i.PixiFastShader.prototype.init=function(){var t=this.gl,e=i.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.uMatrix=t.getUniformLocation(e,"uMatrix"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(e,"aPositionCoord"),this.aScale=t.getAttribLocation(e,"aScale"),this.aRotation=t.getAttribLocation(e,"aRotation"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=e},i.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},i.StripShader=function(t){this._UID=i._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},i.StripShader.prototype.constructor=i.StripShader,i.StripShader.prototype.init=function(){var t=this.gl,e=i.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},i.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},i.PrimitiveShader=function(t){this._UID=i._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},i.PrimitiveShader.prototype.constructor=i.PrimitiveShader,i.PrimitiveShader.prototype.init=function(){var t=this.gl,e=i.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(e,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},i.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},i.ComplexPrimitiveShader=function(t){this._UID=i._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},i.ComplexPrimitiveShader.prototype.constructor=i.ComplexPrimitiveShader,i.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,e=i.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.tintColor=t.getUniformLocation(e,"tint"),this.color=t.getUniformLocation(e,"color"),this.flipY=t.getUniformLocation(e,"flipY"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(e,"translationMatrix"),this.alpha=t.getUniformLocation(e,"alpha"),this.program=e},i.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},i.glContexts=[],i.instances=[],i.WebGLRenderer=function(t){this.game=t,i.defaultRenderer||(i.defaultRenderer=this),this.type=i.WEBGL_RENDERER,this.resolution=t.resolution,this.transparent=t.transparent,this.autoResize=!1,this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.clearBeforeRender=t.clearBeforeRender,this.width=t.width,this.height=t.height,this.view=t.canvas,this._contextOptions={alpha:this.transparent,antialias:t.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new i.Point,this.offset=new i.Point,this.shaderManager=new i.WebGLShaderManager,this.spriteBatch=new i.WebGLSpriteBatch,this.maskManager=new i.WebGLMaskManager,this.filterManager=new i.WebGLFilterManager,this.stencilManager=new i.WebGLStencilManager,this.blendModeManager=new i.WebGLBlendModeManager,this.renderSession={},this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},i.WebGLRenderer.prototype.constructor=i.WebGLRenderer,i.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=i.WebGLRenderer.glContextId++,i.glContexts[this.glContextId]=t,i.instances[this.glContextId]=this,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},i.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){var e=this.gl;e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.game.clearBeforeRender&&(e.clearColor(t._bgColor.r,t._bgColor.g,t._bgColor.b,t._bgColor.a),e.clear(e.COLOR_BUFFER_BIT)),this.offset.x=this.game.camera._shake.x,this.offset.y=this.game.camera._shake.y,this.renderDisplayObject(t,this.projection)}},i.WebGLRenderer.prototype.renderDisplayObject=function(t,e,s,n){this.renderSession.blendModeManager.setBlendMode(i.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=s?-1:1,this.renderSession.projection=e,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,s),t._renderWebGL(this.renderSession,n),this.spriteBatch.end()},i.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},i.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded)return!1;var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture()),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===i.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t.mipmap&&i.isPowerOfTwo(t.width,t.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===i.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===i.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t._dirty[e.id]=!1,!0},i.WebGLRenderer.prototype.destroy=function(){i.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,i.CanvasPool.remove(this),i.instances[this.glContextId]=null,i.WebGLRenderer.glContextId--},i.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;if(!i.blendModesWebGL){var e=[],s=i.blendModes;e[s.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],e[s.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e[s.SCREEN]=[t.SRC_ALPHA,t.ONE],e[s.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[s.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],i.blendModesWebGL=e}},i.WebGLRenderer.glContextId=0,i.WebGLBlendModeManager=function(){this.currentBlendMode=99999},i.WebGLBlendModeManager.prototype.constructor=i.WebGLBlendModeManager,i.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},i.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var e=i.blendModesWebGL[this.currentBlendMode];return e&&this.gl.blendFunc(e[0],e[1]),!0},i.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},i.WebGLMaskManager=function(){},i.WebGLMaskManager.prototype.constructor=i.WebGLMaskManager,i.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},i.WebGLMaskManager.prototype.pushMask=function(t,e){var s=e.gl;t.dirty&&i.WebGLGraphics.updateGraphics(t,s),void 0!==t._webGL[s.id]&&void 0!==t._webGL[s.id].data&&0!==t._webGL[s.id].data.length&&e.stencilManager.pushStencil(t,t._webGL[s.id].data[0],e)},i.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;void 0!==t._webGL[i.id]&&void 0!==t._webGL[i.id].data&&0!==t._webGL[i.id].data.length&&e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},i.WebGLMaskManager.prototype.destroy=function(){this.gl=null},i.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},i.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},i.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var s=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(s.enable(s.STENCIL_TEST),s.clear(s.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var n=this.count;s.colorMask(!1,!1,!1,!1),s.stencilFunc(s.ALWAYS,0,255),s.stencilOp(s.KEEP,s.KEEP,s.INVERT),1===e.mode?(s.drawElements(s.TRIANGLE_FAN,e.indices.length-4,s.UNSIGNED_SHORT,0),this.reverse?(s.stencilFunc(s.EQUAL,255-n,255),s.stencilOp(s.KEEP,s.KEEP,s.DECR)):(s.stencilFunc(s.EQUAL,n,255),s.stencilOp(s.KEEP,s.KEEP,s.INCR)),s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?s.stencilFunc(s.EQUAL,255-(n+1),255):s.stencilFunc(s.EQUAL,n+1,255),this.reverse=!this.reverse):(this.reverse?(s.stencilFunc(s.EQUAL,n,255),s.stencilOp(s.KEEP,s.KEEP,s.INCR)):(s.stencilFunc(s.EQUAL,255-n,255),s.stencilOp(s.KEEP,s.KEEP,s.DECR)),s.drawElements(s.TRIANGLE_STRIP,e.indices.length,s.UNSIGNED_SHORT,0),this.reverse?s.stencilFunc(s.EQUAL,n+1,255):s.stencilFunc(s.EQUAL,255-(n+1),255)),s.colorMask(!0,!0,!0,!0),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),this.count++},i.WebGLStencilManager.prototype.bindGraphics=function(t,e,s){this._currentGraphics=t;var n,o=this.gl,a=s.projection,r=s.offset;1===e.mode?(n=s.shaderManager.complexPrimitiveShader,s.shaderManager.setShader(n),o.uniform1f(n.flipY,s.flipY),o.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),o.uniform2f(n.projectionVector,a.x,-a.y),o.uniform2f(n.offsetVector,-r.x,-r.y),o.uniform3fv(n.tintColor,i.hex2rgb(t.tint)),o.uniform3fv(n.color,e.color),o.uniform1f(n.alpha,t.worldAlpha*e.alpha),o.bindBuffer(o.ARRAY_BUFFER,e.buffer),o.vertexAttribPointer(n.aVertexPosition,2,o.FLOAT,!1,8,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.indexBuffer)):(n=s.shaderManager.primitiveShader,s.shaderManager.setShader(n),o.uniformMatrix3fv(n.translationMatrix,!1,t.worldTransform.toArray(!0)),o.uniform1f(n.flipY,s.flipY),o.uniform2f(n.projectionVector,a.x,-a.y),o.uniform2f(n.offsetVector,-r.x,-r.y),o.uniform3fv(n.tintColor,i.hex2rgb(t.tint)),o.uniform1f(n.alpha,t.worldAlpha),o.bindBuffer(o.ARRAY_BUFFER,e.buffer),o.vertexAttribPointer(n.aVertexPosition,2,o.FLOAT,!1,24,0),o.vertexAttribPointer(n.colorAttribute,4,o.FLOAT,!1,24,8),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.indexBuffer))},i.WebGLStencilManager.prototype.popStencil=function(t,e,i){var s=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)s.disable(s.STENCIL_TEST);else{var n=this.count;this.bindGraphics(t,e,i),s.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(s.stencilFunc(s.EQUAL,255-(n+1),255),s.stencilOp(s.KEEP,s.KEEP,s.INCR)):(s.stencilFunc(s.EQUAL,n+1,255),s.stencilOp(s.KEEP,s.KEEP,s.DECR)),s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,2*(e.indices.length-4)),s.stencilFunc(s.ALWAYS,0,255),s.stencilOp(s.KEEP,s.KEEP,s.INVERT),s.drawElements(s.TRIANGLE_FAN,e.indices.length-4,s.UNSIGNED_SHORT,0),this.reverse?s.stencilFunc(s.EQUAL,n,255):s.stencilFunc(s.EQUAL,255-n,255)):(this.reverse?(s.stencilFunc(s.EQUAL,n+1,255),s.stencilOp(s.KEEP,s.KEEP,s.DECR)):(s.stencilFunc(s.EQUAL,255-(n+1),255),s.stencilOp(s.KEEP,s.KEEP,s.INCR)),s.drawElements(s.TRIANGLE_STRIP,e.indices.length,s.UNSIGNED_SHORT,0),this.reverse?s.stencilFunc(s.EQUAL,n,255):s.stencilFunc(s.EQUAL,255-n,255)),s.colorMask(!0,!0,!0,!0),s.stencilOp(s.KEEP,s.KEEP,s.KEEP)}},i.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},i.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},i.WebGLShaderManager.prototype.constructor=i.WebGLShaderManager,i.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new i.PrimitiveShader(t),this.complexPrimitiveShader=new i.ComplexPrimitiveShader(t),this.defaultShader=new i.PixiShader(t),this.fastShader=new i.PixiFastShader(t),this.stripShader=new i.StripShader(t),this.setShader(this.defaultShader)},i.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var s=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?s.enableVertexAttribArray(e):s.disableVertexAttribArray(e))},i.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},i.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},i.WebGLSpriteBatch=function(){this.vertSize=5,this.size=2e3;var t=4*this.size*4*this.vertSize,e=6*this.size;this.vertices=new i.ArrayBuffer(t),this.positions=new i.Float32Array(this.vertices),this.colors=new i.Uint32Array(this.vertices),this.indices=new i.Uint16Array(e),this.lastIndexCount=0;for(var s=0,n=0;s<e;s+=6,n+=4)this.indices[s+0]=n+0,this.indices[s+1]=n+1,this.indices[s+2]=n+2,this.indices[s+3]=n+0,this.indices[s+4]=n+2,this.indices[s+5]=n+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new i.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},i.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var e=new i.PixiShader(t);e.fragmentSrc=this.defaultShader.fragmentSrc,e.uniforms={},e.init(),this.defaultShader.shaders[t.id]=e},i.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},i.WebGLSpriteBatch.prototype.end=function(){this.flush()},i.WebGLSpriteBatch.prototype.render=function(t,e){var i=t.texture,s=t.worldTransform;e&&(s=e),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture);var n=i._uvs;if(n){var o,a,r,h,l=t.anchor.x,c=t.anchor.y;if(i.trim){var u=i.trim;o=(a=u.x-l*u.width)+i.crop.width,r=(h=u.y-c*u.height)+i.crop.height}else o=i.frame.width*(1-l),a=i.frame.width*-l,r=i.frame.height*(1-c),h=i.frame.height*-c;var d=4*this.currentBatchSize*this.vertSize,p=i.baseTexture.resolution,f=s.a/p,y=s.b/p,g=s.c/p,m=s.d/p,v=s.tx,b=s.ty,x=this.colors,_=this.positions;this.renderSession.roundPixels?(_[d]=f*a+g*h+v|0,_[d+1]=m*h+y*a+b|0,_[d+5]=f*o+g*h+v|0,_[d+6]=m*h+y*o+b|0,_[d+10]=f*o+g*r+v|0,_[d+11]=m*r+y*o+b|0,_[d+15]=f*a+g*r+v|0,_[d+16]=m*r+y*a+b|0):(_[d]=f*a+g*h+v,_[d+1]=m*h+y*a+b,_[d+5]=f*o+g*h+v,_[d+6]=m*h+y*o+b,_[d+10]=f*o+g*r+v,_[d+11]=m*r+y*o+b,_[d+15]=f*a+g*r+v,_[d+16]=m*r+y*a+b),_[d+2]=n.x0,_[d+3]=n.y0,_[d+7]=n.x1,_[d+8]=n.y1,_[d+12]=n.x2,_[d+13]=n.y2,_[d+17]=n.x3,_[d+18]=n.y3;var w=t.tint;x[d+4]=x[d+9]=x[d+14]=x[d+19]=(w>>16)+(65280&w)+((255&w)<<16)+(255*t.worldAlpha<<24),this.sprites[this.currentBatchSize++]=t}},i.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture),t._uvs||(t._uvs=new i.TextureUvs);var s=t._uvs,n=e.baseTexture.width,o=e.baseTexture.height;t.tilePosition.x%=n*t.tileScaleOffset.x,t.tilePosition.y%=o*t.tileScaleOffset.y;var a=t.tilePosition.x/(n*t.tileScaleOffset.x),r=t.tilePosition.y/(o*t.tileScaleOffset.y),h=t.width/n/(t.tileScale.x*t.tileScaleOffset.x),l=t.height/o/(t.tileScale.y*t.tileScaleOffset.y);s.x0=0-a,s.y0=0-r,s.x1=1*h-a,s.y1=0-r,s.x2=1*h-a,s.y2=1*l-r,s.x3=0-a,s.y3=1*l-r;var c=t.tint,u=(c>>16)+(65280&c)+((255&c)<<16)+(255*t.worldAlpha<<24),d=this.positions,p=this.colors,f=t.width,y=t.height,g=t.anchor.x,m=t.anchor.y,v=f*(1-g),b=f*-g,x=y*(1-m),_=y*-m,w=4*this.currentBatchSize*this.vertSize,P=e.baseTexture.resolution,C=t.worldTransform,T=C.a/P,S=C.b/P,A=C.c/P,E=C.d/P,I=C.tx,M=C.ty;d[w++]=T*b+A*_+I,d[w++]=E*_+S*b+M,d[w++]=s.x0,d[w++]=s.y0,p[w++]=u,d[w++]=T*v+A*_+I,d[w++]=E*_+S*v+M,d[w++]=s.x1,d[w++]=s.y1,p[w++]=u,d[w++]=T*v+A*x+I,d[w++]=E*x+S*v+M,d[w++]=s.x2,d[w++]=s.y2,p[w++]=u,d[w++]=T*b+A*x+I,d[w++]=E*x+S*b+M,d[w++]=s.x3,d[w++]=s.y3,p[w++]=u,this.sprites[this.currentBatchSize++]=t},i.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,e=this.gl;if(this.dirty){this.dirty=!1,e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[e.id];var s=4*this.vertSize;e.vertexAttribPointer(t.aVertexPosition,2,e.FLOAT,!1,s,0),e.vertexAttribPointer(t.aTextureCoord,2,e.FLOAT,!1,s,8),e.vertexAttribPointer(t.colorAttribute,4,e.UNSIGNED_BYTE,!0,s,16)}if(this.currentBatchSize>.5*this.size)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var n=this.positions.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,n)}for(var o,a,r,h,l=0,c=0,u=null,d=this.renderSession.blendModeManager.currentBlendMode,p=null,f=!1,y=!1,g=0,m=this.currentBatchSize;g<m;g++){o=(h=this.sprites[g]).tilingTexture?h.tilingTexture.baseTexture:h.texture.baseTexture,f=d!==(a=h.blendMode),y=p!==(r=h.shader||this.defaultShader);var v=o.skipRender;if(v&&h.children.length>0&&(v=!1),(u!==o&&!v||f||y)&&(this.renderBatch(u,l,c),c=g,l=0,u=o,f&&(d=a,this.renderSession.blendModeManager.setBlendMode(d)),y)){(t=(p=r).shaders[e.id])||((t=new i.PixiShader(e)).fragmentSrc=p.fragmentSrc,t.uniforms=p.uniforms,t.init(),p.shaders[e.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var b=this.renderSession.projection;e.uniform2f(t.projectionVector,b.x,b.y);var x=this.renderSession.offset;e.uniform2f(t.offsetVector,x.x,x.y)}l++}this.renderBatch(u,l,c),this.currentBatchSize=0}},i.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var s=this.gl;if(t._dirty[s.id]){if(!this.renderSession.renderer.updateTexture(t))return}else s.bindTexture(s.TEXTURE_2D,t._glTextures[s.id]);s.drawElements(s.TRIANGLES,6*e,s.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},i.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},i.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},i.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},i.WebGLFastSpriteBatch=function(t){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var e=4*this.size*this.vertSize,s=6*this.maxSize;this.vertices=new i.Float32Array(e),this.indices=new i.Uint16Array(s),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var n=0,o=0;n<s;n+=6,o+=4)this.indices[n+0]=o+0,this.indices[n+1]=o+1,this.indices[n+2]=o+2,this.indices[n+3]=o+0,this.indices[n+4]=o+2,this.indices[n+5]=o+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},i.WebGLFastSpriteBatch.prototype.constructor=i.WebGLFastSpriteBatch,i.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},i.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},i.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},i.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var s=0,n=e.length;s<n;s++)this.renderSprite(e[s]);this.flush()}},i.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||t.texture.baseTexture.skipRender||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,i,s,n,o,a,r=this.vertices;if(e=t.texture._uvs,t.texture.frame.width,t.texture.frame.height,t.texture.trim){var h=t.texture.trim;i=(s=h.x-t.anchor.x*h.width)+t.texture.crop.width,n=(o=h.y-t.anchor.y*h.height)+t.texture.crop.height}else i=t.texture.frame.width*(1-t.anchor.x),s=t.texture.frame.width*-t.anchor.x,n=t.texture.frame.height*(1-t.anchor.y),o=t.texture.frame.height*-t.anchor.y;a=4*this.currentBatchSize*this.vertSize,r[a++]=s,r[a++]=o,r[a++]=t.position.x,r[a++]=t.position.y,r[a++]=t.scale.x,r[a++]=t.scale.y,r[a++]=t.rotation,r[a++]=e.x0,r[a++]=e.y1,r[a++]=t.alpha,r[a++]=i,r[a++]=o,r[a++]=t.position.x,r[a++]=t.position.y,r[a++]=t.scale.x,r[a++]=t.scale.y,r[a++]=t.rotation,r[a++]=e.x1,r[a++]=e.y1,r[a++]=t.alpha,r[a++]=i,r[a++]=n,r[a++]=t.position.x,r[a++]=t.position.y,r[a++]=t.scale.x,r[a++]=t.scale.y,r[a++]=t.rotation,r[a++]=e.x2,r[a++]=e.y2,r[a++]=t.alpha,r[a++]=s,r[a++]=n,r[a++]=t.position.x,r[a++]=t.position.y,r[a++]=t.scale.x,r[a++]=t.scale.y,r[a++]=t.rotation,r[a++]=e.x3,r[a++]=e.y3,r[a++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},i.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},i.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},i.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)},i.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},i.WebGLFilterManager.prototype.constructor=i.WebGLFilterManager,i.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},i.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},i.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl,s=this.renderSession.projection,n=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new i.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(t);var o=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var a=this.texturePool.pop();a?a.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):a=new i.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),e.bindTexture(e.TEXTURE_2D,a.texture);var r=t._filterArea,h=o.padding;r.x-=h,r.y-=h,r.width+=2*h,r.height+=2*h,r.x<0&&(r.x=0),r.width>this.width&&(r.width=this.width),r.y<0&&(r.y=0),r.height>this.height&&(r.height=this.height),e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.viewport(0,0,r.width*this.renderSession.resolution,r.height*this.renderSession.resolution),s.x=r.width/2,s.y=-r.height/2,n.x=-r.x,n.y=-r.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=a},i.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),s=e._filterArea,n=e._glFilterTexture,o=this.renderSession.projection,a=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,s.width*this.renderSession.resolution,s.height*this.renderSession.resolution),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=s.height,this.vertexArray[2]=s.width,this.vertexArray[3]=s.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=s.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=s.width/this.width,this.uvArray[5]=s.height/this.height,this.uvArray[6]=s.width/this.width,this.uvArray[7]=s.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var r=n,h=this.texturePool.pop();h||(h=new i.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)),h.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var l=0;l<e.filterPasses.length-1;l++){var c=e.filterPasses[l];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.applyFilterPass(c,s,s.width,s.height);var u=r;r=h,h=u}t.enable(t.BLEND),n=r,this.texturePool.push(h)}var d=e.filterPasses[e.filterPasses.length-1];this.offsetX-=s.x,this.offsetY-=s.y;var p=this.width,f=this.height,y=0,g=0,m=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var v=this.filterStack[this.filterStack.length-1];p=(s=v._filterArea).width,f=s.height,y=s.x,g=s.y,m=v._glFilterTexture.frameBuffer}o.x=p/2,o.y=-f/2,a.x=y,a.y=g;var b=(s=e._filterArea).x-y,x=s.y-g;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=b,this.vertexArray[1]=x+s.height,this.vertexArray[2]=b+s.width,this.vertexArray[3]=x+s.height,this.vertexArray[4]=b,this.vertexArray[5]=x,this.vertexArray[6]=b+s.width,this.vertexArray[7]=x,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=s.width/this.width,this.uvArray[5]=s.height/this.height,this.uvArray[6]=s.width/this.width,this.uvArray[7]=s.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,p*this.renderSession.resolution,f*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,m),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(d,s,p,f),this.texturePool.push(n),e._glFilterTexture=null},i.WebGLFilterManager.prototype.applyFilterPass=function(t,e,s,n){var o=this.gl,a=t.shaders[o.id];a||((a=new i.PixiShader(o)).fragmentSrc=t.fragmentSrc,a.uniforms=t.uniforms,a.init(),t.shaders[o.id]=a),this.renderSession.shaderManager.setShader(a),o.uniform2f(a.projectionVector,s/2,-n/2),o.uniform2f(a.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),a.syncUniforms(),o.bindBuffer(o.ARRAY_BUFFER,this.vertexBuffer),o.vertexAttribPointer(a.aVertexPosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.uvBuffer),o.vertexAttribPointer(a.aTextureCoord,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.colorBuffer),o.vertexAttribPointer(a.colorAttribute,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0),this.renderSession.drawCount++},i.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new i.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new i.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new i.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},i.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},i.FilterTexture=function(t,e,s,n){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),n=n||i.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n===i.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n===i.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(e,s)},i.FilterTexture.prototype.constructor=i.FilterTexture,i.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},i.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},i.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},i.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=i.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},i.CanvasBuffer.prototype.constructor=i.CanvasBuffer,i.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},i.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},i.CanvasBuffer.prototype.destroy=function(){i.CanvasPool.remove(this)},i.CanvasMaskManager=function(){},i.CanvasMaskManager.prototype.constructor=i.CanvasMaskManager,i.CanvasMaskManager.prototype.pushMask=function(t,e){var s=e.context;s.save();var n=t.alpha,o=t.worldTransform,a=e.resolution;s.setTransform(o.a*a,o.b*a,o.c*a,o.d*a,o.tx*a,o.ty*a),i.CanvasGraphics.renderGraphicsMask(t,s),s.clip(),t.worldAlpha=n},i.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},i.CanvasTinter=function(){},i.CanvasTinter.getTintedTexture=function(t,e){var s=t.tintedTexture||i.CanvasPool.create(this);return i.CanvasTinter.tintMethod(t.texture,e,s),s},i.CanvasTinter.tintWithMultiply=function(t,e,i){var s=i.getContext("2d"),n=t.crop;i.width===n.width&&i.height===n.height||(i.width=n.width,i.height=n.height),s.clearRect(0,0,n.width,n.height),s.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),s.fillRect(0,0,n.width,n.height),s.globalCompositeOperation="multiply",s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height),s.globalCompositeOperation="destination-atop",s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},i.CanvasTinter.tintWithPerPixel=function(t,e,s){var n=s.getContext("2d"),o=t.crop;s.width=o.width,s.height=o.height,n.globalCompositeOperation="copy",n.drawImage(t.baseTexture.source,o.x,o.y,o.width,o.height,0,0,o.width,o.height);for(var a=i.hex2rgb(e),r=a[0],h=a[1],l=a[2],c=n.getImageData(0,0,o.width,o.height),u=c.data,d=0;d<u.length;d+=4)if(u[d+0]*=r,u[d+1]*=h,u[d+2]*=l,!i.CanvasTinter.canHandleAlpha){var p=u[d+3];u[d+0]/=255/p,u[d+1]/=255/p,u[d+2]/=255/p}n.putImageData(c,0,0)},i.CanvasTinter.checkInverseAlpha=function(){var t=new i.CanvasBuffer(2,1);t.context.fillStyle="rgba(10, 20, 30, 0.5)",t.context.fillRect(0,0,1,1);var e=t.context.getImageData(0,0,1,1);if(null===e)return!1;t.context.putImageData(e,1,0);var s=t.context.getImageData(1,0,1,1);return s.data[0]===e.data[0]&&s.data[1]===e.data[1]&&s.data[2]===e.data[2]&&s.data[3]===e.data[3]},i.CanvasTinter.canHandleAlpha=i.CanvasTinter.checkInverseAlpha(),i.CanvasTinter.canUseMultiply=i.canUseNewCanvasBlendModes(),i.CanvasTinter.tintMethod=i.CanvasTinter.canUseMultiply?i.CanvasTinter.tintWithMultiply:i.CanvasTinter.tintWithPerPixel,i.CanvasRenderer=function(t){this.game=t,i.defaultRenderer||(i.defaultRenderer=this),this.type=i.CANVAS_RENDERER,this.resolution=t.resolution,this.clearBeforeRender=t.clearBeforeRender,this.transparent=t.transparent,this.autoResize=!1,this.width=t.width*this.resolution,this.height=t.height*this.resolution,this.view=t.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.count=0,this.maskManager=new i.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:!1},this.mapBlendModes(),this.resize(this.width,this.height)},i.CanvasRenderer.prototype.constructor=i.CanvasRenderer,i.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.renderSession.shakeX=this.game.camera._shake.x,this.renderSession.shakeY=this.game.camera._shake.y,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):t._bgColor&&(this.context.fillStyle=t._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t)},i.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},i.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===i.scaleModes.LINEAR)},i.CanvasRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession,i)},i.CanvasRenderer.prototype.mapBlendModes=function(){if(!i.blendModesCanvas){var t=[],e=i.blendModes,s=i.canUseNewCanvasBlendModes();t[e.NORMAL]="source-over",t[e.ADD]="lighter",t[e.MULTIPLY]=s?"multiply":"source-over",t[e.SCREEN]=s?"screen":"source-over",t[e.OVERLAY]=s?"overlay":"source-over",t[e.DARKEN]=s?"darken":"source-over",t[e.LIGHTEN]=s?"lighten":"source-over",t[e.COLOR_DODGE]=s?"color-dodge":"source-over",t[e.COLOR_BURN]=s?"color-burn":"source-over",t[e.HARD_LIGHT]=s?"hard-light":"source-over",t[e.SOFT_LIGHT]=s?"soft-light":"source-over",t[e.DIFFERENCE]=s?"difference":"source-over",t[e.EXCLUSION]=s?"exclusion":"source-over",t[e.HUE]=s?"hue":"source-over",t[e.SATURATION]=s?"saturation":"source-over",t[e.COLOR]=s?"color":"source-over",t[e.LUMINOSITY]=s?"luminosity":"source-over",i.blendModesCanvas=t}},i.BaseTexture=function(t,e){this.resolution=1,this.width=100,this.height=100,this.scaleMode=e||i.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this._dirty=[!0,!0,!0,!0],t&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},i.BaseTexture.prototype.constructor=i.BaseTexture,i.BaseTexture.prototype.forceLoaded=function(t,e){this.hasLoaded=!0,this.width=t,this.height=e,this.dirty()},i.BaseTexture.prototype.destroy=function(){this.source&&i.CanvasPool.removeByCanvas(this.source),this.source=null,this.unloadFromGPU()},i.BaseTexture.prototype.updateSourceImage=function(t){},i.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},i.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var e=this._glTextures[t],s=i.glContexts[t];s&&e&&s.deleteTexture(e)}this._glTextures.length=0,this.dirty()},i.BaseTexture.fromCanvas=function(t,e){return 0===t.width&&(t.width=1),0===t.height&&(t.height=1),new i.BaseTexture(t,e)},i.TextureSilentFail=!1,i.Texture=function(t,e,s,n){this.noFrame=!1,e||(this.noFrame=!0,e=new i.Rectangle(0,0,1,1)),t instanceof i.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.trim=n,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=s||new i.Rectangle(0,0,1,1),t.hasLoaded&&(this.noFrame&&(e=new i.Rectangle(0,0,t.width,t.height)),this.setFrame(e))},i.Texture.prototype.constructor=i.Texture,i.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new i.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame)},i.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},i.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs();else{if(!i.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1}},i.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new i.TextureUvs);var t=this.crop,e=this.baseTexture.width,s=this.baseTexture.height;this._uvs.x0=t.x/e,this._uvs.y0=t.y/s,this._uvs.x1=(t.x+t.width)/e,this._uvs.y1=t.y/s,this._uvs.x2=(t.x+t.width)/e,this._uvs.y2=(t.y+t.height)/s,this._uvs.x3=t.x/e,this._uvs.y3=(t.y+t.height)/s},i.Texture.fromCanvas=function(t,e){var s=i.BaseTexture.fromCanvas(t,e);return new i.Texture(s)},i.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},i.RenderTexture=function(t,e,s,n,o){if(this.width=t||100,this.height=e||100,this.resolution=o||1,this.frame=new i.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new i.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new i.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=n||i.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,i.Texture.call(this,this.baseTexture,new i.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution)),this.renderer=s||i.defaultRenderer,this.renderer.type===i.WEBGL_RENDERER){var a=this.renderer.gl;this.baseTexture._dirty[a.id]=!1,this.textureBuffer=new i.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new i.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new i.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this.tempMatrix=new Phaser.Matrix,this._updateUvs()},i.RenderTexture.prototype=Object.create(i.Texture.prototype),i.RenderTexture.prototype.constructor=i.RenderTexture,i.RenderTexture.prototype.resize=function(t,e,s){t===this.width&&e===this.height||(this.valid=t>0&&e>0,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,s&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===i.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},i.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===i.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},i.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid&&0!==t.alpha){var s=t.worldTransform;s.identity(),s.translate(0,2*this.projection.y),e&&s.append(e),s.scale(1,-1);for(var n=0;n<t.children.length;n++)t.children[n].updateTransform();var o=this.renderer.gl;o.viewport(0,0,this.width*this.resolution,this.height*this.resolution),o.bindFramebuffer(o.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer,e),this.renderer.spriteBatch.dirty=!0}},i.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid&&0!==t.alpha){var s=t.worldTransform;s.identity(),e&&s.append(e);for(var n=0;n<t.children.length;n++)t.children[n].updateTransform();i&&this.textureBuffer.clear();var o=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,this.textureBuffer.context,e),this.renderer.resolution=o}},i.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},i.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},i.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===i.WEBGL_RENDERER){var t=this.renderer.gl,e=this.textureBuffer.width,s=this.textureBuffer.height,n=new Uint8Array(4*e*s);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,e,s,t.RGBA,t.UNSIGNED_BYTE,n),t.bindFramebuffer(t.FRAMEBUFFER,null);var o=new i.CanvasBuffer(e,s),a=o.context.getImageData(0,0,e,s);return a.data.set(n),o.context.putImageData(a,0,0),o.canvas}return this.textureBuffer.canvas},i.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},i.AbstractFilter.prototype.constructor=i.AbstractFilter,i.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++)this.shaders[t].dirty=!0},i.Strip=function(t){i.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new i.Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new i.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new i.Float32Array([1,1,1,1]),this.indices=new i.Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=i.blendModes.NORMAL,this.canvasPadding=0,this.drawMode=i.Strip.DrawModes.TRIANGLE_STRIP},i.Strip.prototype=Object.create(i.DisplayObjectContainer.prototype),i.Strip.prototype.constructor=i.Strip,i.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},i.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},i.Strip.prototype._renderStrip=function(t){var e=t.gl,s=t.projection,n=t.offset,o=t.shaderManager.stripShader,a=this.drawMode===i.Strip.DrawModes.TRIANGLE_STRIP?e.TRIANGLE_STRIP:e.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode),e.uniformMatrix3fv(o.translationMatrix,!1,this.worldTransform.toArray(!0)),e.uniform2f(o.projectionVector,s.x,-s.y),e.uniform2f(o.offsetVector,-n.x,-n.y),e.uniform1f(o.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW),e.vertexAttribPointer(o.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.vertexAttribPointer(o.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)):(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices),e.vertexAttribPointer(o.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.vertexAttribPointer(o.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),e.drawElements(a,this.indices.length,e.UNSIGNED_SHORT,0)},i.Strip.prototype._renderCanvas=function(t){var e=t.context,s=this.worldTransform,n=s.tx*t.resolution+t.shakeX,o=s.ty*t.resolution+t.shakeY;t.roundPixels?e.setTransform(s.a,s.b,s.c,s.d,0|n,0|o):e.setTransform(s.a,s.b,s.c,s.d,n,o),this.drawMode===i.Strip.DrawModes.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(e):this._renderCanvasTriangles(e)},i.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices,i=this.uvs,s=e.length/2;this.count++;for(var n=0;n<s-2;n++){var o=2*n;this._renderCanvasDrawTriangle(t,e,i,o,o+2,o+4)}},i.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices,i=this.uvs,s=this.indices,n=s.length;this.count++;for(var o=0;o<n;o+=3){var a=2*s[o],r=2*s[o+1],h=2*s[o+2];this._renderCanvasDrawTriangle(t,e,i,a,r,h)}},i.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,s,n,o){var a=this.texture.baseTexture.source,r=this.texture.width,h=this.texture.height,l=e[s],c=e[n],u=e[o],d=e[s+1],p=e[n+1],f=e[o+1],y=i[s]*r,g=i[n]*r,m=i[o]*r,v=i[s+1]*h,b=i[n+1]*h,x=i[o+1]*h;if(this.canvasPadding>0){var _=this.canvasPadding/this.worldTransform.a,w=this.canvasPadding/this.worldTransform.d,P=(l+c+u)/3,C=(d+p+f)/3,T=l-P,S=d-C,A=Math.sqrt(T*T+S*S);l=P+T/A*(A+_),d=C+S/A*(A+w),S=p-C,c=P+(T=c-P)/(A=Math.sqrt(T*T+S*S))*(A+_),p=C+S/A*(A+w),S=f-C,u=P+(T=u-P)/(A=Math.sqrt(T*T+S*S))*(A+_),f=C+S/A*(A+w)}t.save(),t.beginPath(),t.moveTo(l,d),t.lineTo(c,p),t.lineTo(u,f),t.closePath(),t.clip();var E=y*b+v*m+g*x-b*m-v*g-y*x,I=l*b+v*u+c*x-b*u-v*c-l*x,M=y*c+l*m+g*u-c*m-l*g-y*u,O=y*b*u+v*c*m+l*g*x-l*b*m-v*g*u-y*c*x,R=d*b+v*f+p*x-b*f-v*p-d*x,B=y*p+d*m+g*f-p*m-d*g-y*f,L=y*b*f+v*p*m+d*g*x-d*b*m-v*g*f-y*p*x;t.transform(I/E,R/E,M/E,B/E,O/E,L/E),t.drawImage(a,0,0),t.restore()},i.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.vertices,s=i.length/2;this.count++,e.beginPath();for(var n=1;n<s-2;n++){var o=2*n,a=i[o],r=i[o+2],h=i[o+4],l=i[o+1],c=i[o+3],u=i[o+5];e.moveTo(a,l),e.lineTo(r,c),e.lineTo(h,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},i.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},i.Strip.prototype.getBounds=function(t){for(var e=t||this.worldTransform,s=e.a,n=e.b,o=e.c,a=e.d,r=e.tx,h=e.ty,l=-1/0,c=-1/0,u=1/0,d=1/0,p=this.vertices,f=0,y=p.length;f<y;f+=2){var g=p[f],m=p[f+1],v=s*g+o*m+r,b=a*m+n*g+h;u=v<u?v:u,d=b<d?b:d,l=v>l?v:l,c=b>c?b:c}if(u===-1/0||c===1/0)return i.EmptyRectangle;var x=this._bounds;return x.x=u,x.width=l-u,x.y=d,x.height=c-d,this._currentBounds=x,x},i.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1},i.Rope=function(t,e){i.Strip.call(this,t),this.points=e,this.vertices=new i.Float32Array(4*e.length),this.uvs=new i.Float32Array(4*e.length),this.colors=new i.Float32Array(2*e.length),this.indices=new i.Uint16Array(2*e.length),this.refresh()},i.Rope.prototype=Object.create(i.Strip.prototype),i.Rope.prototype.constructor=i.Rope,i.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=(t[0],this.indices),s=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,s[0]=1,s[1]=1,i[0]=0,i[1]=1;for(var n,o,a,r=t.length,h=1;h<r;h++)n=t[h],a=h/(r-1),e[o=4*h]=a,e[o+1]=0,e[o+2]=a,e[o+3]=1,s[o=2*h]=1,s[o+1]=1,i[o=2*h]=o,i[o+1]=o+1,n}},i.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e,s=t[0],n={x:0,y:0};this.count-=.2;for(var o,a,r,h,l=this.vertices,c=t.length,u=0;u<c;u++)o=t[u],a=4*u,e=u<t.length-1?t[u+1]:o,n.y=-(e.x-s.x),n.x=e.y-s.y,10*(1-u/(c-1))>1&&1,r=Math.sqrt(n.x*n.x+n.y*n.y),h=this.texture.height/2,n.x/=r,n.y/=r,n.x*=h,n.y*=h,l[a]=o.x+n.x,l[a+1]=o.y+n.y,l[a+2]=o.x-n.x,l[a+3]=o.y-n.y,s=o;i.DisplayObjectContainer.prototype.updateTransform.call(this)}},i.Rope.prototype.setTexture=function(t){this.texture=t},i.TilingSprite=function(t,e,s){i.Sprite.call(this,t),this._width=e||128,this._height=s||128,this.tileScale=new i.Point(1,1),this.tileScaleOffset=new i.Point(1,1),this.tilePosition=new i.Point,this.renderable=!0,this.tint=16777215,this.textureDebug=!1,this.blendMode=i.blendModes.NORMAL,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0},i.TilingSprite.prototype=Object.create(i.Sprite.prototype),i.TilingSprite.prototype.constructor=i.TilingSprite,i.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},i.TilingSprite.prototype._renderWebGL=function(t){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this.refreshTexture){if(this.generateTilingTexture(!0,t),!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(t.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}t.spriteBatch.renderTilingSprite(this);for(var e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},i.TilingSprite.prototype._renderCanvas=function(t){if(this.visible&&this.renderable&&0!==this.alpha){var e=t.context;this._mask&&t.maskManager.pushMask(this._mask,t),e.globalAlpha=this.worldAlpha;var s=this.worldTransform,n=t.resolution,o=s.tx*n+t.shakeX,a=s.ty*n+t.shakeY;if(e.setTransform(s.a*n,s.b*n,s.c*n,s.d*n,o,a),this.refreshTexture){if(this.generateTilingTexture(!1,t),!this.tilingTexture)return;this.tilePattern=e.createPattern(this.tilingTexture.baseTexture.source,"repeat")}var r=t.currentBlendMode;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=i.blendModesCanvas[t.currentBlendMode]);var h=this.tilePosition,l=this.tileScale;h.x%=this.tilingTexture.baseTexture.width,h.y%=this.tilingTexture.baseTexture.height,e.scale(l.x,l.y),e.translate(h.x+this.anchor.x*-this._width,h.y+this.anchor.y*-this._height),e.fillStyle=this.tilePattern;o=-h.x,a=-h.y;var c=this._width/l.x,u=this._height/l.y;t.roundPixels&&(o|=0,a|=0,c|=0,u|=0),e.fillRect(o,a,c,u),e.scale(1/l.x,1/l.y),e.translate(-h.x+this.anchor.x*this._width,-h.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t);for(var d=0;d<this.children.length;d++)this.children[d]._renderCanvas(t);r!==this.blendMode&&(t.currentBlendMode=r,e.globalCompositeOperation=i.blendModesCanvas[r])}},i.TilingSprite.prototype.onTextureUpdate=function(){},i.TilingSprite.prototype.generateTilingTexture=function(t,e){if(this.texture.baseTexture.hasLoaded){var s=this.texture,n=s.frame,o=this._frame.sourceSizeW||this._frame.width,a=this._frame.sourceSizeH||this._frame.height,r=0,h=0;this._frame.trimmed&&(r=this._frame.spriteSourceSizeX,h=this._frame.spriteSourceSizeY),t&&(o=i.getNextPowerOfTwo(o),a=i.getNextPowerOfTwo(a)),this.canvasBuffer?(this.canvasBuffer.resize(o,a),this.tilingTexture.baseTexture.width=o,this.tilingTexture.baseTexture.height=a,this.tilingTexture.needsUpdate=!0):(this.canvasBuffer=new i.CanvasBuffer(o,a),this.tilingTexture=i.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0,this.tilingTexture.needsUpdate=!0),this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,o,a));var l=s.crop.width,c=s.crop.height;l===o&&c===a||(l=o,c=a),this.canvasBuffer.context.drawImage(s.baseTexture.source,s.crop.x,s.crop.y,s.crop.width,s.crop.height,r,h,l,c),this.tileScaleOffset.x=n.width/o,this.tileScaleOffset.y=n.height/a,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},i.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),s=t*-this.anchor.x,n=e*(1-this.anchor.y),o=e*-this.anchor.y,a=this.worldTransform,r=a.a,h=a.b,l=a.c,c=a.d,u=a.tx,d=a.ty,p=r*s+l*o+u,f=c*o+h*s+d,y=r*i+l*o+u,g=c*o+h*i+d,m=r*i+l*n+u,v=c*n+h*i+d,b=r*s+l*n+u,x=c*n+h*s+d,_=-1/0,w=-1/0,P=1/0,C=1/0;P=b<(P=m<(P=y<(P=p<P?p:P)?y:P)?m:P)?b:P,C=x<(C=v<(C=g<(C=f<C?f:C)?g:C)?v:C)?x:C,_=b>(_=m>(_=y>(_=p>_?p:_)?y:_)?m:_)?b:_,w=x>(w=v>(w=g>(w=f>w?f:w)?g:w)?v:w)?x:w;var T=this._bounds;return T.x=P,T.width=_-P,T.y=C,T.height=w-C,this._currentBounds=T,T},i.TilingSprite.prototype.destroy=function(){i.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},Object.defineProperty(i.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(i.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),void 0!==t&&t.exports&&(e=t.exports=i),e.PIXI=i,i}).call(this)},function(t,e,i){(function(i){(function(){function s(t,e){this._scaleFactor=t,this._deltaMode=e,this.originalEvent=null}var n=n||{VERSION:"2.6.4",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};if(Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Function.prototype.bind||(Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){function i(){var o=n.concat(t.call(arguments));s.apply(this instanceof i?this:e,o)}var s=this,n=t.call(arguments,1);if("function"!=typeof s)throw new TypeError;return i.prototype=function t(e){if(e&&(t.prototype=e),!(this instanceof t))return new t}(s.prototype),i}}()),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var s=arguments.length>=2?arguments[1]:void 0,n=0;n<i;n++)n in e&&t.call(s,e[n],n,e)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var o=function(t){var e=new Array;window[t]=function(t){if("number"==typeof t){Array.call(this,t),this.length=t;for(var e=0;e<this.length;e++)this[e]=0}else{Array.call(this,t.length),this.length=t.length;for(e=0;e<this.length;e++)this[e]=t[e]}},window[t].prototype=e,window[t].constructor=window[t]};o("Uint32Array"),o("Int16Array")}for(var a in window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),/firefox/i.test(navigator.userAgent)&&(window.oldGetComputedStyle=window.getComputedStyle,window.getComputedStyle=function(t,e){var i=window.oldGetComputedStyle(t,e);return null===i?{getPropertyValue:function(){}}:i}),n.Utils={reverseString:function(t){return t.split("").reverse().join("")},getProperty:function(t,e){for(var i=e.split("."),s=i.pop(),n=i.length,o=1,a=i[0];o<n&&(t=t[a]);)a=i[o],o++;return t?t[s]:null},setProperty:function(t,e,i){for(var s=e.split("."),n=s.pop(),o=s.length,a=1,r=s[0];a<o&&(t=t[r]);)r=s[a],a++;return t&&(t[n]=i),t},chanceRoll:function(t){return void 0===t&&(t=50),t>0&&100*Math.random()<=t},randomChoice:function(t,e){return Math.random()<.5?t:e},parseDimension:function(t,e){var i=0,s=0;return"string"==typeof t?"%"===t.substr(-1)?(i=parseInt(t,10)/100,s=0===e?window.innerWidth*i:window.innerHeight*i):s=parseInt(t,10):s=t,s},pad:function(t,e,i,s){if(void 0===e)e=0;if(void 0===i)i=" ";if(void 0===s)s=3;var n=0;if(e+1>=(t=t.toString()).length)switch(s){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var o=Math.ceil((n=e-t.length)/2);t=new Array(n-o+1).join(i)+t+new Array(o+1).join(i);break;default:t+=new Array(e+1-t.length).join(i)}return t},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var t,e,i,s,o,a,r=arguments[0]||{},h=1,l=arguments.length,c=!1;for("boolean"==typeof r&&(c=r,r=arguments[1]||{},h=2),l===h&&(r=this,--h);h<l;h++)if(null!=(t=arguments[h]))for(e in t)i=r[e],r!==(s=t[e])&&(c&&s&&(n.Utils.isPlainObject(s)||(o=Array.isArray(s)))?(o?(o=!1,a=i&&Array.isArray(i)?i:[]):a=i&&n.Utils.isPlainObject(i)?i:{},r[e]=n.Utils.extend(c,a,s)):void 0!==s&&(r[e]=s));return r},mixinPrototype:function(t,e,i){void 0===i&&(i=!1);for(var s=Object.keys(e),n=0;n<s.length;n++){var o=s[n],a=e[o];!i&&o in t||(!a||"function"!=typeof a.get&&"function"!=typeof a.set?t[o]=a:"function"==typeof a.clone?t[o]=a.clone():Object.defineProperty(t,o,a))}},mixin:function(t,e){if(!t||"object"!=typeof t)return e;for(var i in t){var s=t[i];if(!s.childNodes&&!s.cloneNode){var o=typeof t[i];t[i]&&"object"===o?typeof e[i]===o?e[i]=n.Utils.mixin(t[i],e[i]):e[i]=n.Utils.mixin(t[i],new s.constructor):e[i]=t[i]}}return e}},n.Circle=function(t,e,i){t=t||0,e=e||0,i=i||0,this.x=t,this.y=e,this._diameter=i,this._radius=0,i>0&&(this._radius=.5*i),this.type=n.CIRCLE},n.Circle.prototype={circumference:function(){return Math.PI*this._radius*2},random:function(t){void 0===t&&(t=new n.Point);var e=2*Math.PI*Math.random(),i=Math.random()+Math.random(),s=i>1?2-i:i,o=s*Math.cos(e),a=s*Math.sin(e);return t.x=this.x+o*this.radius,t.y=this.y+a*this.radius,t},getBounds:function(){return new n.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){return this.x=t,this.y=e,this._diameter=i,this._radius=.5*i,this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.diameter=this._diameter,t},distance:function(t,e){var i=n.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(i):i},clone:function(t){return null==t?t=new n.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,e){return n.Circle.contains(this,t,e)},circumferencePoint:function(t,e,i){return n.Circle.circumferencePoint(this,t,e,i)},offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},n.Circle.prototype.constructor=n.Circle,Object.defineProperty(n.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){t>0&&(this._diameter=t,this._radius=.5*t)}}),Object.defineProperty(n.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){t>0&&(this._radius=t,this._diameter=2*t)}}),Object.defineProperty(n.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){t>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-t}}),Object.defineProperty(n.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){t<this.x?(this._radius=0,this._diameter=0):this.radius=t-this.x}}),Object.defineProperty(n.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){t>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-t}}),Object.defineProperty(n.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){t<this.y?(this._radius=0,this._diameter=0):this.radius=t-this.y}}),Object.defineProperty(n.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(n.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(t){!0===t&&this.setTo(0,0,0)}}),n.Circle.contains=function(t,e,i){return t.radius>0&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom&&(t.x-e)*(t.x-e)+(t.y-i)*(t.y-i)<=t.radius*t.radius},n.Circle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.diameter===e.diameter},n.Circle.intersects=function(t,e){return n.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius},n.Circle.circumferencePoint=function(t,e,i,s){return void 0===i&&(i=!1),void 0===s&&(s=new n.Point),!0===i&&(e=n.Math.degToRad(e)),s.x=t.x+t.radius*Math.cos(e),s.y=t.y+t.radius*Math.sin(e),s},n.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);if(i>e.halfWidth+t.radius)return!1;var s=Math.abs(t.y-e.y-e.halfHeight);if(s>e.halfHeight+t.radius)return!1;if(i<=e.halfWidth||s<=e.halfHeight)return!0;var n=i-e.halfWidth,o=s-e.halfHeight;return n*n+o*o<=t.radius*t.radius},PIXI.Circle=n.Circle,n.Ellipse=function(t,e,i,s){t=t||0,e=e||0,i=i||0,s=s||0,this.x=t,this.y=e,this.width=i,this.height=s,this.type=n.ELLIPSE},n.Ellipse.prototype={setTo:function(t,e,i,s){return this.x=t,this.y=e,this.width=i,this.height=s,this},getBounds:function(){return new n.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},clone:function(t){return null==t?t=new n.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,e){return n.Ellipse.contains(this,t,e)},random:function(t){void 0===t&&(t=new n.Point);var e=Math.random()*Math.PI*2,i=Math.random();return t.x=Math.sqrt(i)*Math.cos(e),t.y=Math.sqrt(i)*Math.sin(e),t.x=this.x+t.x*this.width/2,t.y=this.y+t.y*this.height/2,t},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},n.Ellipse.prototype.constructor=n.Ellipse,Object.defineProperty(n.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}}),Object.defineProperty(n.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(n.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}}),Object.defineProperty(n.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(n.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),n.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0)return!1;var s=(e-t.x)/t.width-.5,n=(i-t.y)/t.height-.5;return(s*=s)+(n*=n)<.25},PIXI.Ellipse=n.Ellipse,n.Line=function(t,e,i,s){t=t||0,e=e||0,i=i||0,s=s||0,this.start=new n.Point(t,e),this.end=new n.Point(i,s),this.type=n.LINE},n.Line.prototype={setTo:function(t,e,i,s){return this.start.setTo(t,e),this.end.setTo(i,s),this},fromSprite:function(t,e,i){return void 0===i&&(i=!1),i?this.setTo(t.center.x,t.center.y,e.center.x,e.center.y):this.setTo(t.x,t.y,e.x,e.y)},fromAngle:function(t,e,i,s){return this.start.setTo(t,e),this.end.setTo(t+Math.cos(i)*s,e+Math.sin(i)*s),this},rotate:function(t,e){var i=(this.start.x+this.end.x)/2,s=(this.start.y+this.end.y)/2;return this.start.rotate(i,s,t,e),this.end.rotate(i,s,t,e),this},rotateAround:function(t,e,i,s){return this.start.rotate(t,e,i,s),this.end.rotate(t,e,i,s),this},intersects:function(t,e,i){return n.Line.intersectsPoints(this.start,this.end,t.start,t.end,e,i)},reflect:function(t){return n.Line.reflect(this,t)},midPoint:function(t){return void 0===t&&(t=new n.Point),t.x=(this.start.x+this.end.x)/2,t.y=(this.start.y+this.end.y)/2,t},centerOn:function(t,e){var i=t-(this.start.x+this.end.x)/2,s=e-(this.start.y+this.end.y)/2;this.start.add(i,s),this.end.add(i,s)},pointOnLine:function(t,e){return(t-this.start.x)*(this.end.y-this.start.y)==(this.end.x-this.start.x)*(e-this.start.y)},pointOnSegment:function(t,e){var i=Math.min(this.start.x,this.end.x),s=Math.max(this.start.x,this.end.x),n=Math.min(this.start.y,this.end.y),o=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e)&&t>=i&&t<=s&&e>=n&&e<=o},random:function(t){void 0===t&&(t=new n.Point);var e=Math.random();return t.x=this.start.x+e*(this.end.x-this.start.x),t.y=this.start.y+e*(this.end.y-this.start.y),t},coordinatesOnLine:function(t,e){void 0===t&&(t=1),void 0===e&&(e=[]);var i=Math.round(this.start.x),s=Math.round(this.start.y),n=Math.round(this.end.x),o=Math.round(this.end.y),a=Math.abs(n-i),r=Math.abs(o-s),h=i<n?1:-1,l=s<o?1:-1,c=a-r;e.push([i,s]);for(var u=1;i!==n||s!==o;){var d=c<<1;d>-r&&(c-=r,i+=h),d<a&&(c+=a,s+=l),u%t==0&&e.push([i,s]),u++}return e},clone:function(t){return null==t?t=new n.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}},Object.defineProperty(n.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(n.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(n.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(n.Line.prototype,"perpSlope",{get:function(){return-(this.end.x-this.start.x)/(this.end.y-this.start.y)}}),Object.defineProperty(n.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(n.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(n.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(n.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(n.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(n.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(n.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(n.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),Object.defineProperty(n.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}}),Object.defineProperty(n.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}}),Object.defineProperty(n.Line.prototype,"normalAngle",{get:function(){return n.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}}),n.Line.intersectsPoints=function(t,e,i,s,o,a){void 0===o&&(o=!0),void 0===a&&(a=new n.Point);var r=e.y-t.y,h=s.y-i.y,l=t.x-e.x,c=i.x-s.x,u=e.x*t.y-t.x*e.y,d=s.x*i.y-i.x*s.y,p=r*c-h*l;if(0===p)return null;if(a.x=(l*d-c*u)/p,a.y=(h*u-r*d)/p,o){var f=(s.y-i.y)*(e.x-t.x)-(s.x-i.x)*(e.y-t.y),y=((s.x-i.x)*(t.y-i.y)-(s.y-i.y)*(t.x-i.x))/f,g=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/f;return y>=0&&y<=1&&g>=0&&g<=1?a:null}return a},n.Line.intersects=function(t,e,i,s){return n.Line.intersectsPoints(t.start,t.end,e.start,e.end,i,s)},n.Line.intersectsRectangle=function(t,e){if(!n.Rectangle.intersects(t,e))return!1;var i=t.start.x,s=t.start.y,o=t.end.x,a=t.end.y,r=e.x,h=e.y,l=e.right,c=e.bottom,u=0;if(i>=r&&i<=l&&s>=h&&s<=c||o>=r&&o<=l&&a>=h&&a<=c)return!0;if(i<r&&o>=r){if((u=s+(a-s)*(r-i)/(o-i))>h&&u<=c)return!0}else if(i>l&&o<=l&&(u=s+(a-s)*(l-i)/(o-i))>=h&&u<=c)return!0;if(s<h&&a>=h){if((u=i+(o-i)*(h-s)/(a-s))>=r&&u<=l)return!0}else if(s>c&&a<=c&&(u=i+(o-i)*(c-s)/(a-s))>=r&&u<=l)return!0;return!1},n.Line.reflect=function(t,e){return 2*e.normalAngle-3.141592653589793-t.angle},n.Matrix=function(t,e,i,s,o,a){null!=t||(t=1),null!=e||(e=0),null!=i||(i=0),null!=s||(s=1),null!=o||(o=0),null!=a||(a=0),this.a=t,this.b=e,this.c=i,this.d=s,this.tx=o,this.ty=a,this.type=n.MATRIX},n.Matrix.prototype={fromArray:function(t){return this.setTo(t[0],t[1],t[3],t[4],t[2],t[5])},setTo:function(t,e,i,s,n,o){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=o,this},clone:function(t){return null==t?t=new n.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty),t},copyTo:function(t){return t.copyFrom(this),t},copyFrom:function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},toArray:function(t,e){return void 0===e&&(e=new PIXI.Float32Array(9)),t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},apply:function(t,e){return void 0===e&&(e=new n.Point),e.x=this.a*t.x+this.c*t.y+this.tx,e.y=this.b*t.x+this.d*t.y+this.ty,e},applyInverse:function(t,e){void 0===e&&(e=new n.Point);var i=1/(this.a*this.d+this.c*-this.b),s=t.x,o=t.y;return e.x=this.d*i*s+-this.c*i*o+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*o+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e},translate:function(t,e){return this.tx+=t,this.ty+=e,this},scale:function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.c,o=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},append:function(t){var e=this.a,i=this.b,s=this.c,n=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*n,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*n,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*n+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},n.identityMatrix=new n.Matrix,PIXI.Matrix=n.Matrix,PIXI.identityMatrix=n.identityMatrix,n.Point=function(t,e){t=t||0,e=e||0,this.x=t,this.y=e,this.type=n.POINT},n.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},set:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},add:function(t,e){return this.x+=t,this.y+=e,this},subtract:function(t,e){return this.x-=t,this.y-=e,this},multiply:function(t,e){return this.x*=t,this.y*=e,this},divide:function(t,e){return this.x/=t,this.y/=e,this},clampX:function(t,e){return this.x=n.Math.clamp(this.x,t,e),this},clampY:function(t,e){return this.y=n.Math.clamp(this.y,t,e),this},clamp:function(t,e){return this.x=n.Math.clamp(this.x,t,e),this.y=n.Math.clamp(this.y,t,e),this},clone:function(t){return null==t?t=new n.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(t){return t.x=this.x,t.y=this.y,t},distance:function(t,e){return n.Point.distance(this,t,e)},equals:function(t){return t.x===this.x&&t.y===this.y},angle:function(t,e){return void 0===e&&(e=!1),e?n.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x)):Math.atan2(t.y-this.y,t.x-this.x)},rotate:function(t,e,i,s,o){return n.Point.rotate(this,t,e,i,s,o)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){if(!this.isZero()){var t=this.getMagnitude();this.x/=t,this.y/=t}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},n.Point.prototype.constructor=n.Point,n.Point.add=function(t,e,i){return void 0===i&&(i=new n.Point),i.x=t.x+e.x,i.y=t.y+e.y,i},n.Point.subtract=function(t,e,i){return void 0===i&&(i=new n.Point),i.x=t.x-e.x,i.y=t.y-e.y,i},n.Point.multiply=function(t,e,i){return void 0===i&&(i=new n.Point),i.x=t.x*e.x,i.y=t.y*e.y,i},n.Point.divide=function(t,e,i){return void 0===i&&(i=new n.Point),i.x=t.x/e.x,i.y=t.y/e.y,i},n.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y},n.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},n.Point.negative=function(t,e){return void 0===e&&(e=new n.Point),e.setTo(-t.x,-t.y)},n.Point.multiplyAdd=function(t,e,i,s){return void 0===s&&(s=new n.Point),s.setTo(t.x+e.x*i,t.y+e.y*i)},n.Point.interpolate=function(t,e,i,s){return void 0===s&&(s=new n.Point),s.setTo(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)},n.Point.perp=function(t,e){return void 0===e&&(e=new n.Point),e.setTo(-t.y,t.x)},n.Point.rperp=function(t,e){return void 0===e&&(e=new n.Point),e.setTo(t.y,-t.x)},n.Point.distance=function(t,e,i){var s=n.Math.distance(t.x,t.y,e.x,e.y);return i?Math.round(s):s},n.Point.project=function(t,e,i){void 0===i&&(i=new n.Point);var s=t.dot(e)/e.getMagnitudeSq();return 0!==s&&i.setTo(s*e.x,s*e.y),i},n.Point.projectUnit=function(t,e,i){void 0===i&&(i=new n.Point);var s=t.dot(e);return 0!==s&&i.setTo(s*e.x,s*e.y),i},n.Point.normalRightHand=function(t,e){return void 0===e&&(e=new n.Point),e.setTo(-1*t.y,t.x)},n.Point.normalize=function(t,e){void 0===e&&(e=new n.Point);var i=t.getMagnitude();return 0!==i&&e.setTo(t.x/i,t.y/i),e},n.Point.rotate=function(t,e,i,s,o,a){if(o&&(s=n.Math.degToRad(s)),void 0===a){t.subtract(e,i);var r=Math.sin(s),h=Math.cos(s),l=h*t.x-r*t.y,c=r*t.x+h*t.y;t.x=l+e,t.y=c+i}else{var u=s+Math.atan2(t.y-i,t.x-e);t.x=e+a*Math.cos(u),t.y=i+a*Math.sin(u)}return t},n.Point.centroid=function(t,e){if(void 0===e&&(e=new n.Point),"[object Array]"!==Object.prototype.toString.call(t))throw new Error("Phaser.Point. Parameter 'points' must be an array");var i=t.length;if(i<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===i)return e.copyFrom(t[0]),e;for(var s=0;s<i;s++)n.Point.add(e,t[s],e);return e.divide(i,i),e},n.Point.parse=function(t,e,i){e=e||"x",i=i||"y";var s=new n.Point;return t[e]&&(s.x=parseInt(t[e],10)),t[i]&&(s.y=parseInt(t[i],10)),s},PIXI.Point=n.Point,n.Polygon=function(){this.area=0,this._points=[],arguments.length>0&&this.setTo.apply(this,arguments),this.closed=!0,this.flattened=!1,this.type=n.POLYGON},n.Polygon.prototype={toNumberArray:function(t){void 0===t&&(t=[]);for(var e=0;e<this._points.length;e++)"number"==typeof this._points[e]?(t.push(this._points[e]),t.push(this._points[e+1]),e++):(t.push(this._points[e].x),t.push(this._points[e].y));return t},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(t){var e=this._points.slice();return null==t?t=new n.Polygon(e):t.setTo(e),t},contains:function(t,e){var i=!1;if(this.flattened)for(var s=-2,n=this._points.length-2;(s+=2)<this._points.length;n=s){var o=this._points[s],a=this._points[s+1],r=this._points[n],h=this._points[n+1];(a<=e&&e<h||h<=e&&e<a)&&t<(r-o)*(e-a)/(h-a)+o&&(i=!i)}else for(s=-1,n=this._points.length-1;++s<this._points.length;n=s){o=this._points[s].x,a=this._points[s].y,r=this._points[n].x,h=this._points[n].y;(a<=e&&e<h||h<=e&&e<a)&&t<(r-o)*(e-a)/(h-a)+o&&(i=!i)}return i},setTo:function(t){if(this.area=0,this._points=[],arguments.length>0){Array.isArray(t)||(t=Array.prototype.slice.call(arguments));for(var e=Number.MAX_VALUE,i=0,s=t.length;i<s;i++){if("number"==typeof t[i]){var n=new PIXI.Point(t[i],t[i+1]);i++}else if(Array.isArray(t[i]))n=new PIXI.Point(t[i][0],t[i][1]);else n=new PIXI.Point(t[i].x,t[i].y);this._points.push(n),n.y<e&&(e=n.y)}this.calculateArea(e)}return this},calculateArea:function(t){for(var e,i,s,n,o=0,a=this._points.length;o<a;o++)e=this._points[o],i=o===a-1?this._points[0]:this._points[o+1],s=(e.y-t+(i.y-t))/2,n=e.x-i.x,this.area+=s*n;return this.area}},n.Polygon.prototype.constructor=n.Polygon,Object.defineProperty(n.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){null!=t?this.setTo(t):this.setTo()}}),PIXI.Polygon=n.Polygon,n.Rectangle=function(t,e,i,s){t=t||0,e=e||0,i=i||0,s=s||0,this.x=t,this.y=e,this.width=i,this.height=s,this.type=n.RECTANGLE},n.Rectangle.prototype={offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,s){return this.x=t,this.y=e,this.width=i,this.height=s,this},scale:function(t,e){return void 0===e&&(e=t),this.width*=t,this.height*=e,this},centerOn:function(t,e){return this.centerX=t,this.centerY=e,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},inflate:function(t,e){return n.Rectangle.inflate(this,t,e)},size:function(t){return n.Rectangle.size(this,t)},resize:function(t,e){return this.width=t,this.height=e,this},clone:function(t){return n.Rectangle.clone(this,t)},contains:function(t,e){return n.Rectangle.contains(this,t,e)},containsRect:function(t){return n.Rectangle.containsRect(t,this)},equals:function(t){return n.Rectangle.equals(this,t)},intersection:function(t,e){return n.Rectangle.intersection(this,t,e)},intersects:function(t){return n.Rectangle.intersects(this,t)},intersectsRaw:function(t,e,i,s,o){return n.Rectangle.intersectsRaw(this,t,e,i,s,o)},union:function(t,e){return n.Rectangle.union(this,t,e)},random:function(t){return void 0===t&&(t=new n.Point),t.x=this.randomX,t.y=this.randomY,t},getPoint:function(t,e){switch(void 0===e&&(e=new n.Point),t){default:case n.TOP_LEFT:return e.set(this.x,this.y);case n.TOP_CENTER:return e.set(this.centerX,this.y);case n.TOP_RIGHT:return e.set(this.right,this.y);case n.LEFT_CENTER:return e.set(this.x,this.centerY);case n.CENTER:return e.set(this.centerX,this.centerY);case n.RIGHT_CENTER:return e.set(this.right,this.centerY);case n.BOTTOM_LEFT:return e.set(this.x,this.bottom);case n.BOTTOM_CENTER:return e.set(this.centerX,this.bottom);case n.BOTTOM_RIGHT:return e.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(n.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(n.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(n.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<=this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(n.Rectangle.prototype,"bottomLeft",{get:function(){return new n.Point(this.x,this.bottom)},set:function(t){this.x=t.x,this.bottom=t.y}}),Object.defineProperty(n.Rectangle.prototype,"bottomRight",{get:function(){return new n.Point(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y}}),Object.defineProperty(n.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){t>=this.right?this.width=0:this.width=this.right-t,this.x=t}}),Object.defineProperty(n.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<=this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(n.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(n.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(n.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}}),Object.defineProperty(n.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}}),Object.defineProperty(n.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(n.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(n.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){t>=this.bottom?(this.height=0,this.y=t):this.height=this.bottom-t}}),Object.defineProperty(n.Rectangle.prototype,"topLeft",{get:function(){return new n.Point(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}}),Object.defineProperty(n.Rectangle.prototype,"topRight",{get:function(){return new n.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x,this.y=t.y}}),Object.defineProperty(n.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){!0===t&&this.setTo(0,0,0,0)}}),n.Rectangle.prototype.constructor=n.Rectangle,n.Rectangle.inflate=function(t,e,i){return t.x-=e,t.width+=2*e,t.y-=i,t.height+=2*i,t},n.Rectangle.inflatePoint=function(t,e){return n.Rectangle.inflate(t,e.x,e.y)},n.Rectangle.size=function(t,e){return null==e?e=new n.Point(t.width,t.height):e.setTo(t.width,t.height),e},n.Rectangle.clone=function(t,e){return null==e?e=new n.Rectangle(t.x,t.y,t.width,t.height):e.setTo(t.x,t.y,t.width,t.height),e},n.Rectangle.contains=function(t,e,i){return!(t.width<=0||t.height<=0)&&e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom},n.Rectangle.containsRaw=function(t,e,i,s,n,o){return n>=t&&n<t+i&&o>=e&&o<e+s},n.Rectangle.containsPoint=function(t,e){return n.Rectangle.contains(t,e.x,e.y)},n.Rectangle.containsRect=function(t,e){return!(t.volume>e.volume)&&t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom},n.Rectangle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},n.Rectangle.sameDimensions=function(t,e){return t.width===e.width&&t.height===e.height},n.Rectangle.intersection=function(t,e,i){return void 0===i&&(i=new n.Rectangle),n.Rectangle.intersects(t,e)&&(i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.width=Math.min(t.right,e.right)-i.x,i.height=Math.min(t.bottom,e.bottom)-i.y),i},n.Rectangle.intersects=function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0||t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)},n.Rectangle.intersectsRaw=function(t,e,i,s,n,o){return void 0===o&&(o=0),!(e>t.right+o||i<t.left-o||s>t.bottom+o||n<t.top-o)},n.Rectangle.union=function(t,e,i){return void 0===i&&(i=new n.Rectangle),i.setTo(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.right,e.right)-Math.min(t.left,e.left),Math.max(t.bottom,e.bottom)-Math.min(t.top,e.top))},n.Rectangle.aabb=function(t,e){void 0===e&&(e=new n.Rectangle);var i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return t.forEach(function(t){t.x>i&&(i=t.x),t.x<s&&(s=t.x),t.y>o&&(o=t.y),t.y<a&&(a=t.y)}),e.setTo(s,a,i-s,o-a),e},PIXI.Rectangle=n.Rectangle,PIXI.EmptyRectangle=new n.Rectangle(0,0,0,0),n.RoundedRectangle=function(t,e,i,s,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===o&&(o=20),this.x=t,this.y=e,this.width=i,this.height=s,this.radius=o||20,this.type=n.ROUNDEDRECTANGLE},n.RoundedRectangle.prototype={clone:function(){return new n.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var s=this.y;if(e>=s&&e<=s+this.height)return!0}return!1}},n.RoundedRectangle.prototype.constructor=n.RoundedRectangle,PIXI.RoundedRectangle=n.RoundedRectangle,n.Camera=function(t,e,i,s,o,a){this.game=t,this.world=t.world,this.id=0,this.view=new n.Rectangle(i,s,o,a),this.bounds=new n.Rectangle(i,s,o,a),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this.lerp=new n.Point(1,1),this.onShakeComplete=new n.Signal,this.onFlashComplete=new n.Signal,this.onFadeComplete=new n.Signal,this.fx=null,this._targetPosition=new n.Point,this._edge=0,this._position=new n.Point,this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0},this._fxDuration=0,this._fxType=0},n.Camera.FOLLOW_LOCKON=0,n.Camera.FOLLOW_PLATFORMER=1,n.Camera.FOLLOW_TOPDOWN=2,n.Camera.FOLLOW_TOPDOWN_TIGHT=3,n.Camera.SHAKE_BOTH=4,n.Camera.SHAKE_HORIZONTAL=5,n.Camera.SHAKE_VERTICAL=6,n.Camera.ENABLE_FX=!0,n.Camera.prototype={boot:function(){this.displayObject=this.game.world,this.scale=this.game.world.scale,this.game.camera=this,n.Graphics&&n.Camera.ENABLE_FX&&(this.fx=new n.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(t,e,i,s){var o;switch(void 0===e&&(e=n.Camera.FOLLOW_LOCKON),void 0===i&&(i=1),void 0===s&&(s=1),this.target=t,this.lerp.set(i,s),e){case n.Camera.FOLLOW_PLATFORMER:var a=this.width/8,r=this.height/3;this.deadzone=new n.Rectangle((this.width-a)/2,(this.height-r)/2-.25*r,a,r);break;case n.Camera.FOLLOW_TOPDOWN:o=Math.max(this.width,this.height)/4,this.deadzone=new n.Rectangle((this.width-o)/2,(this.height-o)/2,o,o);break;case n.Camera.FOLLOW_TOPDOWN_TIGHT:o=Math.max(this.width,this.height)/8,this.deadzone=new n.Rectangle((this.width-o)/2,(this.height-o)/2,o,o);break;case n.Camera.FOLLOW_LOCKON:default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},shake:function(t,e,i,s,o){return void 0===t&&(t=.05),void 0===e&&(e=500),void 0===i&&(i=!0),void 0===s&&(s=n.Camera.SHAKE_BOTH),void 0===o&&(o=!0),!(!i&&this._shake.duration>0||(this._shake.intensity=t,this._shake.duration=e,this._shake.shakeBounds=o,this._shake.x=0,this._shake.y=0,this._shake.horizontal=s===n.Camera.SHAKE_BOTH||s===n.Camera.SHAKE_HORIZONTAL,this._shake.vertical=s===n.Camera.SHAKE_BOTH||s===n.Camera.SHAKE_VERTICAL,0))},flash:function(t,e,i){return void 0===t&&(t=16777215),void 0===e&&(e=500),void 0===i&&(i=!1),!(!this.fx||!i&&this._fxDuration>0||(this.fx.clear(),this.fx.beginFill(t),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=e,this._fxType=0,0))},fade:function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=500),void 0===i&&(i=!1),!(!this.fx||!i&&this._fxDuration>0||(this.fx.clear(),this.fx.beginFill(t),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=0,this._fxDuration=e,this._fxType=1,0))},update:function(){this._fxDuration>0&&this.updateFX(),this._shake.duration>0&&this.updateShake(),this.bounds&&this.checkBounds(),this.roundPx&&(this.view.floor(),this._shake.x=Math.floor(this._shake.x),this._shake.y=Math.floor(this._shake.y)),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateFX:function(){0===this._fxType?(this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha<=0&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,this.fx.alpha>=1&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS,this._shake.duration<=0?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x,this._targetPosition.y=this.view.y+this.target.worldPosition.y,this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1;var t=this.view.x+this._shake.x,e=this.view.right+this._shake.x,i=this.view.y+this._shake.y,s=this.view.bottom+this._shake.y;t<=this.bounds.x*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0)),e>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0)),i<=this.bounds.top*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0)),s>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||(this._shake.y=0))},setPosition:function(t,e){this.view.x=t,this.view.y=e,this.bounds&&this.checkBounds()},setSize:function(t,e){this.view.width=t,this.view.height=e},reset:function(){this.target=null,this.view.x=0,this.view.y=0,this._shake.duration=0,this.resetFX()},resetFX:function(){this.fx.clear(),this.fx.alpha=0,this._fxDuration=0}},n.Camera.prototype.constructor=n.Camera,Object.defineProperty(n.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(t){void 0!==t.x&&(this.view.x=t.x),void 0!==t.y&&(this.view.y=t.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(n.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}}),Object.defineProperty(n.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}}),Object.defineProperty(n.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(t){this._shake.intensity=t}}),n.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.state=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},n.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},n.State.prototype.constructor=n.State,n.StateManager=function(t,e){this.game=t,this.states={},this._pendingState=null,null!=e&&(this._pendingState=e),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onStateChange=new n.Signal,this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},n.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(t,e,i){var s;return void 0===i&&(i=!1),e instanceof n.State?s=e:"object"==typeof e?(s=e).game=this.game:"function"==typeof e&&(s=new e(this.game)),this.states[t]=s,i&&(this.game.isBooted?this.start(t):this._pendingState=t),s},remove:function(t){this.current===t&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[t]},start:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.checkState(t)&&(this._pendingState=t,this._clearWorld=e,this._clearCache=i,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this._pendingState=this.current,this._clearWorld=t,this._clearCache=e,arguments.length>2&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var t=this.current;if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,t),this.current!==this._pendingState)return;this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(t){return!!this.states[t]&&!!(this.states[t].preload||this.states[t].create||this.states[t].update||this.states[t].render)},link:function(t){this.states[t].game=this.game,this.states[t].add=this.game.add,this.states[t].make=this.game.make,this.states[t].camera=this.game.camera,this.states[t].cache=this.game.cache,this.states[t].input=this.game.input,this.states[t].load=this.game.load,this.states[t].math=this.game.math,this.states[t].sound=this.game.sound,this.states[t].scale=this.game.scale,this.states[t].state=this,this.states[t].stage=this.game.stage,this.states[t].time=this.game.time,this.states[t].tweens=this.game.tweens,this.states[t].world=this.game.world,this.states[t].particles=this.game.particles,this.states[t].rnd=this.game.rnd,this.states[t].physics=this.game.physics,this.states[t].key=t},unlink:function(t){this.states[t]&&(this.states[t].game=null,this.states[t].add=null,this.states[t].make=null,this.states[t].camera=null,this.states[t].cache=null,this.states[t].input=null,this.states[t].load=null,this.states[t].math=null,this.states[t].sound=null,this.states[t].scale=null,this.states[t].state=null,this.states[t].stage=null,this.states[t].time=null,this.states[t].tweens=null,this.states[t].world=null,this.states[t].particles=null,this.states[t].rnd=null,this.states[t].physics=null)},setCurrentState:function(t){this.callbackContext=this.states[t],this.link(t),this.onInitCallback=this.states[t].init||this.dummy,this.onPreloadCallback=this.states[t].preload||null,this.onLoadRenderCallback=this.states[t].loadRender||null,this.onLoadUpdateCallback=this.states[t].loadUpdate||null,this.onCreateCallback=this.states[t].create||null,this.onUpdateCallback=this.states[t].update||null,this.onPreRenderCallback=this.states[t].preRender||null,this.onRenderCallback=this.states[t].render||null,this.onResizeCallback=this.states[t].resize||null,this.onPausedCallback=this.states[t].paused||null,this.onResumedCallback=this.states[t].resumed||null,this.onPauseUpdateCallback=this.states[t].pauseUpdate||null,this.onShutDownCallback=this.states[t].shutdown||this.dummy,""!==this.current&&this.game.physics.reset(),this.current=t,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),t===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game),!1===this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(t){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,t)},resize:function(t,e){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,t,e)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===n.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0,this._clearCache=!0,this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},n.StateManager.prototype.constructor=n.StateManager,Object.defineProperty(n.StateManager.prototype,"created",{get:function(){return this._created}}),n.Signal=function(){},n.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,e,i,s,o){var a,r=this._indexOfListener(t,i);if(-1!==r){if((a=this._bindings[r]).isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else a=new n.SignalBinding(this,t,e,i,s,o),this._addBinding(a);return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(t){this._bindings||(this._bindings=[]);var e=this._bindings.length;do{e--}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings)return-1;void 0===e&&(e=null);for(var i,s=this._bindings.length;s--;)if((i=this._bindings[s])._listener===t&&i.context===e)return s;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){this.validateListener(t,"add");var s=[];if(arguments.length>3)for(var n=3;n<arguments.length;n++)s.push(arguments[n]);return this._registerListener(t,!1,e,i,s)},addOnce:function(t,e,i){this.validateListener(t,"addOnce");var s=[];if(arguments.length>3)for(var n=3;n<arguments.length;n++)s.push(arguments[n]);return this._registerListener(t,!0,e,i,s)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},removeAll:function(t){if(void 0===t&&(t=null),this._bindings){for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&this._bindings){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(e))}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(n.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}}),n.Signal.prototype.constructor=n.Signal,n.SignalBinding=function(t,e,i,s,n,o){this._listener=e,i&&(this._isOnce=!0),null!=s&&(this.context=s),this._signal=t,n&&(this._priority=n),o&&o.length&&(this._args=o)},n.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,this._args&&(i=i.concat(this._args)),e=this._listener.apply(this.context,i),this.callCount++,this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},n.SignalBinding.prototype.constructor=n.SignalBinding,n.Filter=function(t,e,i){this.game=t,this.type=n.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new n.Point;var s=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[s.getFullYear(),s.getMonth(),s.getDate(),60*s.getHours()*60+60*s.getMinutes()+s.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},e)for(var o in e)this.uniforms[o]=e[o];this.fragmentSrc=i||""},n.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t,this.uniforms.resolution.value.y=e},update:function(t){if(void 0!==t){var e=t.x/this.game.width,i=1-t.y/this.game.height;e===this.prevPoint.x&&i===this.prevPoint.y||(this.uniforms.mouse.value.x=e.toFixed(2),this.uniforms.mouse.value.y=i.toFixed(2),this.prevPoint.set(e,i))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(t,e,i,s,n,o){void 0===n&&(n=0),void 0===o&&(o=0),null!=i?this.width=i:i=this.width,null!=s?this.height=s:s=this.height;var a=this.game.add.image(t,e,"__default");return a.width=i,a.height=s,a.anchor.set(n,o),a.filters=[this],a},destroy:function(){this.game=null}},n.Filter.prototype.constructor=n.Filter,Object.defineProperty(n.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}}),Object.defineProperty(n.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}}),n.Plugin=function(t,e){void 0===e&&(e=null),this.game=t,this.parent=e,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},n.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},n.Plugin.prototype.constructor=n.Plugin,n.PluginManager=function(t){this.game=t,this.plugins=[],this._len=0,this._i=0},n.PluginManager.prototype={add:function(t){var e=Array.prototype.slice.call(arguments,1),i=!1;return"function"==typeof t?t=new t(this.game,this):(t.game=this.game,t.parent=this),"function"==typeof t.preUpdate&&(t.hasPreUpdate=!0,i=!0),"function"==typeof t.update&&(t.hasUpdate=!0,i=!0),"function"==typeof t.postUpdate&&(t.hasPostUpdate=!0,i=!0),"function"==typeof t.render&&(t.hasRender=!0,i=!0),"function"==typeof t.postRender&&(t.hasPostRender=!0,i=!0),i?((t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate)&&(t.active=!0),(t.hasRender||t.hasPostRender)&&(t.visible=!0),this._len=this.plugins.push(t),"function"==typeof t.init&&t.init.apply(t,e),t):null},remove:function(t,e){for(void 0===e&&(e=!0),this._i=this._len;this._i--;)if(this.plugins[this._i]===t)return e&&t.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},n.PluginManager.prototype.constructor=n.PluginManager,n.Stage=function(t){this.game=t,PIXI.DisplayObjectContainer.call(this),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.worldTransform=new PIXI.Matrix,this.stage=this,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"},this.game.transparent||(this._bgColor.a=1),t.config&&this.parseConfig(t.config)},n.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),n.Stage.prototype.constructor=n.Stage,n.Stage.prototype.parseConfig=function(t){t.disableVisibilityChange&&(this.disableVisibilityChange=t.disableVisibilityChange),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor)},n.Stage.prototype.boot=function(){n.DOM.getOffset(this.game.canvas,this.offset),n.Canvas.setUserSelect(this.game.canvas,"none"),n.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},n.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var t=0;t<this.children.length;t++)this.children[t].preUpdate()},n.Stage.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},n.Stage.prototype.postUpdate=function(){this.game.camera.update(),this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var t=0;t<this.children.length;t++)this.children[t].postUpdate();this.updateTransform()},n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},n.Stage.prototype.checkVisibility=function(){void 0!==document.hidden?this._hiddenVar="visibilitychange":void 0!==document.webkitHidden?this._hiddenVar="webkitvisibilitychange":void 0!==document.mozHidden?this._hiddenVar="mozvisibilitychange":void 0!==document.msHidden?this._hiddenVar="msvisibilitychange":this._hiddenVar=null;var t=this;this._onChange=function(e){return t.visibilityChange(e)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){n.Stage.prototype.visibilityChange.call(t,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){n.Stage.prototype.visibilityChange.call(t,{type:"resume"})}))},n.Stage.prototype.visibilityChange=function(t){"pagehide"!==t.type&&"blur"!==t.type&&"pageshow"!==t.type&&"focus"!==t.type?this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===t.type?this.game.gamePaused(t):this.game.gameResumed(t)):"pagehide"===t.type||"blur"===t.type?this.game.focusLoss(t):"pageshow"!==t.type&&"focus"!==t.type||this.game.focusGain(t)},n.Stage.prototype.setBackgroundColor=function(t){this.game.transparent||(n.Color.valueToColor(t,this._bgColor),n.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)},n.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null},Object.defineProperty(n.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(t){this.setBackgroundColor(t)}}),Object.defineProperty(n.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(t){PIXI.scaleModes.DEFAULT=t?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),n.Group=function(t,e,i,s,o,a){void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=n.Physics.ARCADE),this.game=t,void 0===e&&(e=t.world),this.name=i||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),s?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):e&&(e.addChild(this),this.z=e.children.length),this.type=n.GROUP,this.physicsType=n.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.pendingDestroy=!1,this.classType=n.Sprite,this.cursor=null,this.inputEnableChildren=!1,this.onChildInputDown=new n.Signal,this.onChildInputUp=new n.Signal,this.onChildInputOver=new n.Signal,this.onChildInputOut=new n.Signal,this.enableBody=o,this.enableBodyDebug=!1,this.physicsBodyType=a,this.physicsSortDirection=null,this.onDestroy=new n.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new n.Point,this.hash=[],this._sortProperty="z"},n.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),n.Group.prototype.constructor=n.Group,n.Group.RETURN_NONE=0,n.Group.RETURN_TOTAL=1,n.Group.RETURN_CHILD=2,n.Group.RETURN_ALL=3,n.Group.SORT_ASCENDING=-1,n.Group.SORT_DESCENDING=1,n.Group.prototype.add=function(t,e,i){return void 0===e&&(e=!1),t.parent===this?t:(t.body&&t.parent&&t.parent.hash&&t.parent.removeFromHash(t),void 0===i?(t.z=this.children.length,this.addChild(t)):(this.addChildAt(t,i),this.updateZ()),this.enableBody&&t.hasOwnProperty("body")&&null===t.body?this.game.physics.enable(t,this.physicsBodyType):t.body&&this.addToHash(t),!this.inputEnableChildren||t.input&&!t.inputEnabled||(t.inputEnabled=!0),!e&&t.events&&t.events.onAddedToGroup$dispatch(t,this),null===this.cursor&&(this.cursor=t),t)},n.Group.prototype.addAt=function(t,e,i){this.add(t,i,e)},n.Group.prototype.addToHash=function(t){return t.parent===this&&-1===this.hash.indexOf(t)&&(this.hash.push(t),!0)},n.Group.prototype.removeFromHash=function(t){if(t){var e=this.hash.indexOf(t);if(-1!==e)return this.hash.splice(e,1),!0}return!1},n.Group.prototype.addMultiple=function(t,e){if(t instanceof n.Group)t.moveAll(this,e);else if(Array.isArray(t))for(var i=0;i<t.length;i++)this.add(t[i],e);return t},n.Group.prototype.getAt=function(t){return t<0||t>=this.children.length?-1:this.getChildAt(t)},n.Group.prototype.create=function(t,e,i,s,n,o){void 0===n&&(n=!0);var a=new this.classType(this.game,t,e,i,s);return a.exists=n,a.visible=n,a.alive=n,this.add(a,!1,o)},n.Group.prototype.createMultiple=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=!1),Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]);var n=this,o=[];return e.forEach(function(e){i.forEach(function(i){for(var a=0;a<t;a++)o.push(n.create(0,0,e,i,s))})}),o},n.Group.prototype.updateZ=function(){for(var t=this.children.length;t--;)this.children[t].z=t},n.Group.prototype.align=function(t,e,i,s,o,a){if(void 0===o&&(o=n.TOP_LEFT),void 0===a&&(a=0),0===this.children.length||a>this.children.length||-1===t&&-1===e)return!1;for(var r=new n.Rectangle(0,0,i,s),h=t*i,l=e*s,c=a;c<this.children.length;c++){var u=this.children[c];if(u.alignIn)if(u.alignIn(r,o),-1===t)r.y+=s,r.y===l&&(r.x+=i,r.y=0);else if(-1===e)r.x+=i,r.x===h&&(r.x=0,r.y+=s);else if(r.x+=i,r.x===h&&(r.x=0,r.y+=s,r.y===l))return!0}return!0},n.Group.prototype.resetCursor=function(t){if(void 0===t&&(t=0),t>this.children.length-1&&(t=0),this.cursor)return this.cursorIndex=t,this.cursor=this.children[this.cursorIndex],this.cursor},n.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},n.Group.prototype.previous=function(){if(this.cursor)return 0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor},n.Group.prototype.swap=function(t,e){this.swapChildren(t,e),this.updateZ()},n.Group.prototype.bringToTop=function(t){return t.parent===this&&this.getIndex(t)<this.children.length&&(this.remove(t,!1,!0),this.add(t,!0)),t},n.Group.prototype.sendToBack=function(t){return t.parent===this&&this.getIndex(t)>0&&(this.remove(t,!1,!0),this.addAt(t,0,!0)),t},n.Group.prototype.moveUp=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length-1){var e=this.getIndex(t),i=this.getAt(e+1);i&&this.swap(t,i)}return t},n.Group.prototype.moveDown=function(t){if(t.parent===this&&this.getIndex(t)>0){var e=this.getIndex(t),i=this.getAt(e-1);i&&this.swap(t,i)}return t},n.Group.prototype.xy=function(t,e,i){if(t<0||t>this.children.length)return-1;this.getChildAt(t).x=e,this.getChildAt(t).y=i},n.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},n.Group.prototype.getIndex=function(t){return this.children.indexOf(t)},n.Group.prototype.getByName=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].name===t)return this.children[e];return null},n.Group.prototype.replace=function(t,e){var i=this.getIndex(t);if(-1!==i)return e.parent&&(e.parent instanceof n.Group?e.parent.remove(e):e.parent.removeChild(e)),this.remove(t),this.addAt(e,i),t},n.Group.prototype.hasProperty=function(t,e){var i=e.length;return 1===i&&e[0]in t||2===i&&e[0]in t&&e[1]in t[e[0]]||3===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]||4===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]},n.Group.prototype.setProperty=function(t,e,i,s,n){if(void 0===n&&(n=!1),s=s||0,!this.hasProperty(t,e)&&(!n||s>0))return!1;var o=e.length;return 1===o?0===s?t[e[0]]=i:1===s?t[e[0]]+=i:2===s?t[e[0]]-=i:3===s?t[e[0]]*=i:4===s&&(t[e[0]]/=i):2===o?0===s?t[e[0]][e[1]]=i:1===s?t[e[0]][e[1]]+=i:2===s?t[e[0]][e[1]]-=i:3===s?t[e[0]][e[1]]*=i:4===s&&(t[e[0]][e[1]]/=i):3===o?0===s?t[e[0]][e[1]][e[2]]=i:1===s?t[e[0]][e[1]][e[2]]+=i:2===s?t[e[0]][e[1]][e[2]]-=i:3===s?t[e[0]][e[1]][e[2]]*=i:4===s&&(t[e[0]][e[1]][e[2]]/=i):4===o&&(0===s?t[e[0]][e[1]][e[2]][e[3]]=i:1===s?t[e[0]][e[1]][e[2]][e[3]]+=i:2===s?t[e[0]][e[1]][e[2]][e[3]]-=i:3===s?t[e[0]][e[1]][e[2]][e[3]]*=i:4===s&&(t[e[0]][e[1]][e[2]][e[3]]/=i)),!0},n.Group.prototype.checkProperty=function(t,e,i,s){return void 0===s&&(s=!1),!(!n.Utils.getProperty(t,e)&&s)&&n.Utils.getProperty(t,e)===i},n.Group.prototype.set=function(t,e,i,s,n,o,a){if(void 0===a&&(a=!1),e=e.split("."),void 0===s&&(s=!1),void 0===n&&(n=!1),(!1===s||s&&t.alive)&&(!1===n||n&&t.visible))return this.setProperty(t,e,i,o,a)},n.Group.prototype.setAll=function(t,e,i,s,n,o){void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),t=t.split("."),n=n||0;for(var a=0;a<this.children.length;a++)(!i||i&&this.children[a].alive)&&(!s||s&&this.children[a].visible)&&this.setProperty(this.children[a],t,e,n,o)},n.Group.prototype.setAllChildren=function(t,e,i,s,o,a){void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),o=o||0;for(var r=0;r<this.children.length;r++)(!i||i&&this.children[r].alive)&&(!s||s&&this.children[r].visible)&&(this.children[r]instanceof n.Group?this.children[r].setAllChildren(t,e,i,s,o,a):this.setProperty(this.children[r],t.split("."),e,o,a))},n.Group.prototype.checkAll=function(t,e,i,s,n){void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===n&&(n=!1);for(var o=0;o<this.children.length;o++)if((!i||i&&this.children[o].alive)&&(!s||s&&this.children[o].visible)&&!this.checkProperty(this.children[o],t,e,n))return!1;return!0},n.Group.prototype.addAll=function(t,e,i,s){this.setAll(t,e,i,s,1)},n.Group.prototype.subAll=function(t,e,i,s){this.setAll(t,e,i,s,2)},n.Group.prototype.multiplyAll=function(t,e,i,s){this.setAll(t,e,i,s,3)},n.Group.prototype.divideAll=function(t,e,i,s){this.setAll(t,e,i,s,4)},n.Group.prototype.callAllExists=function(t,e){var i;if(arguments.length>2){i=[];for(var s=2;s<arguments.length;s++)i.push(arguments[s])}for(s=0;s<this.children.length;s++)this.children[s].exists===e&&this.children[s][t]&&this.children[s][t].apply(this.children[s],i)},n.Group.prototype.callbackFromArray=function(t,e,i){if(1===i){if(t[e[0]])return t[e[0]]}else if(2===i){if(t[e[0]][e[1]])return t[e[0]][e[1]]}else if(3===i){if(t[e[0]][e[1]][e[2]])return t[e[0]][e[1]][e[2]]}else if(4===i){if(t[e[0]][e[1]][e[2]][e[3]])return t[e[0]][e[1]][e[2]][e[3]]}else if(t[e])return t[e];return!1},n.Group.prototype.callAll=function(t,e){if(void 0!==t){var i,s=(t=t.split(".")).length;if(null==e||""===e)e=null;else if("string"==typeof e)var n=(e=e.split(".")).length;if(arguments.length>2){i=[];for(var o=2;o<arguments.length;o++)i.push(arguments[o])}var a=null,r=null;for(o=0;o<this.children.length;o++)a=this.callbackFromArray(this.children[o],t,s),e&&a?(r=this.callbackFromArray(this.children[o],e,n),a&&a.apply(r,i)):a&&a.apply(this.children[o],i)}},n.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var t=0;t<this.children.length;t++)this.children[t].preUpdate();return!0},n.Group.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},n.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},n.Group.prototype.filter=function(t,e){for(var i=-1,s=this.children.length,o=[];++i<s;){var a=this.children[i];(!e||e&&a.exists)&&t(a,i,this.children)&&o.push(a)}return new n.ArraySet(o)},n.Group.prototype.forEach=function(t,e,i){if(void 0===i&&(i=!1),arguments.length<=3)for(var s=0;s<this.children.length;s++)(!i||i&&this.children[s].exists)&&t.call(e,this.children[s]);else{var n=[null];for(s=3;s<arguments.length;s++)n.push(arguments[s]);for(s=0;s<this.children.length;s++)(!i||i&&this.children[s].exists)&&(n[0]=this.children[s],t.apply(e,n))}},n.Group.prototype.forEachExists=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++)i.push(arguments[s])}this.iterate("exists",!0,n.Group.RETURN_TOTAL,t,e,i)},n.Group.prototype.forEachAlive=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++)i.push(arguments[s])}this.iterate("alive",!0,n.Group.RETURN_TOTAL,t,e,i)},n.Group.prototype.forEachDead=function(t,e){var i;if(arguments.length>2){i=[null];for(var s=2;s<arguments.length;s++)i.push(arguments[s])}this.iterate("alive",!1,n.Group.RETURN_TOTAL,t,e,i)},n.Group.prototype.sort=function(t,e){this.children.length<2||(void 0===t&&(t="z"),void 0===e&&(e=n.Group.SORT_ASCENDING),this._sortProperty=t,e===n.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},n.Group.prototype.customSort=function(t,e){this.children.length<2||(this.children.sort(t.bind(e)),this.updateZ())},n.Group.prototype.ascendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?-1:t[this._sortProperty]>e[this._sortProperty]?1:t.z<e.z?-1:1},n.Group.prototype.descendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?1:t[this._sortProperty]>e[this._sortProperty]?-1:0},n.Group.prototype.iterate=function(t,e,i,s,o,a){if(0===this.children.length){if(i===n.Group.RETURN_TOTAL)return 0;if(i===n.Group.RETURN_ALL)return[]}var r=0;if(i===n.Group.RETURN_ALL)var h=[];for(var l=0;l<this.children.length;l++)if(this.children[l][t]===e){if(r++,s&&(a?(a[0]=this.children[l],s.apply(o,a)):s.call(o,this.children[l])),i===n.Group.RETURN_CHILD)return this.children[l];i===n.Group.RETURN_ALL&&h.push(this.children[l])}return i===n.Group.RETURN_TOTAL?r:i===n.Group.RETURN_ALL?h:null},n.Group.prototype.getFirstExists=function(t,e,i,s,o,a){void 0===e&&(e=!1),"boolean"!=typeof t&&(t=!0);var r=this.iterate("exists",t,n.Group.RETURN_CHILD);return null===r&&e?this.create(i,s,o,a):this.resetChild(r,i,s,o,a)},n.Group.prototype.getFirstAlive=function(t,e,i,s,o){void 0===t&&(t=!1);var a=this.iterate("alive",!0,n.Group.RETURN_CHILD);return null===a&&t?this.create(e,i,s,o):this.resetChild(a,e,i,s,o)},n.Group.prototype.getFirstDead=function(t,e,i,s,o){void 0===t&&(t=!1);var a=this.iterate("alive",!1,n.Group.RETURN_CHILD);return null===a&&t?this.create(e,i,s,o):this.resetChild(a,e,i,s,o)},n.Group.prototype.resetChild=function(t,e,i,s,n){return null===t?null:(void 0===e&&(e=null),void 0===i&&(i=null),null!==e&&null!==i&&t.reset(e,i),void 0!==s&&t.loadTexture(s,n),t)},n.Group.prototype.getTop=function(){if(this.children.length>0)return this.children[this.children.length-1]},n.Group.prototype.getBottom=function(){if(this.children.length>0)return this.children[0]},n.Group.prototype.getClosestTo=function(t,e,i){for(var s=Number.MAX_VALUE,o=0,a=null,r=0;r<this.children.length;r++){var h=this.children[r];h.exists&&(o=Math.abs(n.Point.distance(t,h)))<s&&(!e||e.call(i,h,o))&&(s=o,a=h)}return a},n.Group.prototype.getFurthestFrom=function(t,e,i){for(var s=0,o=0,a=null,r=0;r<this.children.length;r++){var h=this.children[r];h.exists&&(o=Math.abs(n.Point.distance(t,h)))>s&&(!e||e.call(i,h,o))&&(s=o,a=h)}return a},n.Group.prototype.countLiving=function(){return this.iterate("alive",!0,n.Group.RETURN_TOTAL)},n.Group.prototype.countDead=function(){return this.iterate("alive",!1,n.Group.RETURN_TOTAL)},n.Group.prototype.getRandom=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.children.length),0===e?null:n.ArrayUtils.getRandomItem(this.children,t,e)},n.Group.prototype.getRandomExists=function(t,e){var i=this.getAll("exists",!0,t,e);return this.game.rnd.pick(i)},n.Group.prototype.getAll=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=this.children.length);for(var n=[],o=i;o<s;o++){var a=this.children[o];t&&a[t]===e&&n.push(a)}return n},n.Group.prototype.remove=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!1),0===this.children.length||-1===this.children.indexOf(t))return!1;i||!t.events||t.destroyPhase||t.events.onRemovedFromGroup$dispatch(t,this);var s=this.removeChild(t);return this.removeFromHash(t),this.updateZ(),this.cursor===t&&this.next(),e&&s&&s.destroy(!0),!0},n.Group.prototype.moveAll=function(t,e){if(void 0===e&&(e=!1),this.children.length>0&&t instanceof n.Group){do{t.add(this.children[0],e)}while(this.children.length>0);this.hash=[],this.cursor=null}return t},n.Group.prototype.removeAll=function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),0!==this.children.length){do{!e&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var s=this.removeChild(this.children[0]);this.removeFromHash(s),t&&s&&s.destroy(!0,i)}while(this.children.length>0);this.hash=[],this.cursor=null}},n.Group.prototype.removeBetween=function(t,e,i,s){if(void 0===e&&(e=this.children.length-1),void 0===i&&(i=!1),void 0===s&&(s=!1),0!==this.children.length){if(t>e||t<0||e>this.children.length)return!1;for(var n=e;n>=t;){!s&&this.children[n].events&&this.children[n].events.onRemovedFromGroup$dispatch(this.children[n],this);var o=this.removeChild(this.children[n]);this.removeFromHash(o),i&&o&&o.destroy(!0),this.cursor===this.children[n]&&(this.cursor=null),n--}this.updateZ()}},n.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||(void 0===t&&(t=!0),void 0===e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,this.pendingDestroy=!1,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(n.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,n.Group.RETURN_TOTAL)}}),Object.defineProperty(n.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(n.Group.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}}),Object.defineProperty(n.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.halfWidth}}),Object.defineProperty(n.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.halfHeight}}),Object.defineProperty(n.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i}}),Object.defineProperty(n.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(t){var e=this.getBounds(this.parent),i=this.x-e.x;this.x=t+i-e.width}}),Object.defineProperty(n.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i}}),Object.defineProperty(n.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(t){var e=this.getBounds(this.parent),i=this.y-e.y;this.y=t+i-e.height}}),n.World=function(t){n.Group.call(this,t,null,"__world",!1),this.bounds=new n.Rectangle(0,0,t.width,t.height),this.camera=null,this._definedSize=!1,this._width=t.width,this._height=t.height,this.game.state.onStateChange.add(this.stateChange,this)},n.World.prototype=Object.create(n.Group.prototype),n.World.prototype.constructor=n.World,n.World.prototype.boot=function(){this.camera=new n.Camera(this.game,0,0,0,this.game.width,this.game.height),this.game.stage.addChild(this),this.camera.boot()},n.World.prototype.stateChange=function(){this.x=0,this.y=0,this.camera.reset()},n.World.prototype.setBounds=function(t,e,i,s){this._definedSize=!0,this._width=i,this._height=s,this.bounds.setTo(t,e,i,s),this.x=t,this.y=e,this.camera.bounds&&this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(s,this.game.height)),this.game.physics.setBoundsToWorld()},n.World.prototype.resize=function(t,e){this._definedSize&&(t<this._width&&(t=this._width),e<this._height&&(e=this._height)),this.bounds.width=t,this.bounds.height=e,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},n.World.prototype.shutdown=function(){this.destroy(!0,!0)},n.World.prototype.wrap=function(t,e,i,s,n){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===s&&(s=!0),void 0===n&&(n=!0),i?(t.getBounds(),s&&(t.x+t._currentBounds.width<this.bounds.x?t.x=this.bounds.right:t.x>this.bounds.right&&(t.x=this.bounds.left)),n&&(t.y+t._currentBounds.height<this.bounds.top?t.y=this.bounds.bottom:t.y>this.bounds.bottom&&(t.y=this.bounds.top))):(s&&t.x+e<this.bounds.x?t.x=this.bounds.right+e:s&&t.x-e>this.bounds.right&&(t.x=this.bounds.left-e),n&&t.y+e<this.bounds.top?t.y=this.bounds.bottom+e:n&&t.y-e>this.bounds.bottom&&(t.y=this.bounds.top-e))},Object.defineProperty(n.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){t<this.game.width&&(t=this.game.width),this.bounds.width=t,this._width=t,this._definedSize=!0}}),Object.defineProperty(n.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){t<this.game.height&&(t=this.game.height),this.bounds.height=t,this._height=t,this._definedSize=!0}}),Object.defineProperty(n.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}}),Object.defineProperty(n.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}}),Object.defineProperty(n.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(n.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}}),n.Game=function(t,e,i,s,o,a,r,h){return this.id=n.GAMES.push(this)-1,this.config=null,this.physicsConfig=h,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=n.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=n.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new n.Signal,this.forceSingleUpdate=!0,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},void 0!==t&&(this._width=t),void 0!==e&&(this._height=e),void 0!==i&&(this.renderType=i),void 0!==s&&(this.parent=s),void 0!==a&&(this.transparent=a),void 0!==r&&(this.antialias=r),this.rnd=new n.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new n.StateManager(this,o)),this.device.whenReady(this.boot,this),this},n.Game.prototype={parseConfig:function(t){this.config=t,void 0===t.enableDebug&&(this.config.enableDebug=!0),t.width&&(this._width=t.width),t.height&&(this._height=t.height),t.renderer&&(this.renderType=t.renderer),t.parent&&(this.parent=t.parent),void 0!==t.transparent&&(this.transparent=t.transparent),void 0!==t.antialias&&(this.antialias=t.antialias),t.resolution&&(this.resolution=t.resolution),void 0!==t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer),t.physicsConfig&&(this.physicsConfig=t.physicsConfig);var e=[(Date.now()*Math.random()).toString()];t.seed&&(e=t.seed),this.rnd=new n.RandomDataGenerator(e);var i=null;t.state&&(i=t.state),this.state=new n.StateManager(this,i)},boot:function(){this.isBooted||(this.onPause=new n.Signal,this.onResume=new n.Signal,this.onBlur=new n.Signal,this.onFocus=new n.Signal,this.isBooted=!0,PIXI.game=this,this.math=n.Math,this.scale=new n.ScaleManager(this,this._width,this._height),this.stage=new n.Stage(this),this.setUpRenderer(),this.world=new n.World(this),this.add=new n.GameObjectFactory(this),this.make=new n.GameObjectCreator(this),this.cache=new n.Cache(this),this.load=new n.Loader(this),this.time=new n.Time(this),this.tweens=new n.TweenManager(this),this.input=new n.Input(this),this.sound=new n.SoundManager(this),this.physics=new n.Physics(this,this.physicsConfig),this.particles=new n.Particles(this),this.create=new n.Create(this),this.plugins=new n.PluginManager(this),this.net=new n.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new n.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=!0,this.config&&this.config.forceSetTimeOut?this.raf=new n.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new n.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.raf.start())},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var t=n.VERSION,e="Canvas",i="HTML Audio",s=1;if(this.renderType===n.WEBGL?(e="WebGL",s++):this.renderType===n.HEADLESS&&(e="Headless"),this.device.webAudio&&(i="WebAudio",s++),this.device.chrome)for(var o=["%c %c %c @orange-games/phaser v"+t+" | Pixi.js | "+e+" | "+i+"  %c %c %c http://phaser.io %c♥%c♥%c♥","background: #F47820","background: #ED873F","color: #ffffff; background: #DD6612;","background: #ED873F","background: #F47820","background: #ffffff"],a=0;a<3;a++)a<s?o.push("color: #ff2424; background: #fff"):o.push("color: #959595; background: #fff");else window.console}},setUpRenderer:function(){if(this.config.canvas?this.canvas=this.config.canvas:this.canvas=n.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.renderType===n.HEADLESS||this.renderType===n.CANVAS||this.renderType===n.AUTO&&!this.device.webGL){if(!this.device.canvas)throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.");this.renderType=n.CANVAS,this.renderer=new PIXI.CanvasRenderer(this),this.context=this.renderer.context}else this.renderType=n.WEBGL,this.renderer=new PIXI.WebGLRenderer(this),this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1);this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===n.CANVAS),this.renderType!==n.HEADLESS&&(this.stage.smoothed=this.antialias,n.Canvas.addToDOM(this.canvas,this.parent,!1),n.Canvas.setTouchAction(this.canvas))},contextLost:function(t){t.preventDefault(),this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext(),this.cache.clearGLTextures(),this.renderer.contextLost=!1},update:function(t){if(this.time.update(t),this._kickstart)return this.updateLogic(this.time.desiredFpsMult),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=!1);if(this._spiraling>1&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.updateRender(this.time.slowMotion*this.time.desiredFps);else{var e=1e3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(3*e,this.time.elapsed),0);var i=0;for(this.updatesThisFrame=Math.floor(this._deltaTime/e),this.forceSingleUpdate&&(this.updatesThisFrame=Math.min(1,this.updatesThisFrame));this._deltaTime>=e&&(this._deltaTime-=e,this.currentUpdateID=i,this.updateLogic(this.time.desiredFpsMult),i++,!this.forceSingleUpdate||1!==i);)this.time.refresh();i>this._lastCount?this._spiraling++:i<this._lastCount&&(this._spiraling=0),this._lastCount=i,this.updateRender(this._deltaTime/e)}},updateLogic:function(t){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(),this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(t),this.plugins.preUpdate(t),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.stage.updateTransform()},updateRender:function(t){this.lockRender||(this.state.preRender(t),this.renderType!==n.HEADLESS&&(this.renderer.render(this.stage),this.plugins.render(t),this.state.render(t)),this.plugins.postRender(t))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.plugins.destroy(),this.state=null,this.sound=null,this.scale=null,this.stage=null,this.input=null,this.physics=null,this.plugins=null,this.cache=null,this.load=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),n.Canvas.removeFromDOM(this.canvas),PIXI.defaultRenderer=null,n.GAMES[this.id]=null},gamePaused:function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(t){this.onBlur.dispatch(t),this.stage.disableVisibilityChange||this.gamePaused(t)},focusGain:function(t){this.onFocus.dispatch(t),this.stage.disableVisibilityChange||this.gameResumed(t)}},n.Game.prototype.constructor=n.Game,Object.defineProperty(n.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){!0===t?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),n.Input=function(t){this.game=t,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.customCandidateHandler=null,this.customCandidateHandlerContext=null,this.pollRate=0,this.enabled=!0,this.multiInputOverride=n.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new n.ArraySet,this._localPoint=new n.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},n.Input.MOUSE_OVERRIDES_TOUCH=0,n.Input.TOUCH_OVERRIDES_MOUSE=1,n.Input.MOUSE_TOUCH_COMBINE=2,n.Input.MAX_POINTERS=10,n.Input.prototype={boot:function(){this.mousePointer=new n.Pointer(this.game,0,n.PointerMode.CURSOR),this.addPointer(),this.addPointer(),this.mouse=new n.Mouse(this.game),this.touch=new n.Touch(this.game),this.mspointer=new n.MSPointer(this.game),n.Keyboard&&(this.keyboard=new n.Keyboard(this.game)),n.Gamepad&&(this.gamepad=new n.Gamepad(this.game)),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.scale=new n.Point(1,1),this.speed=new n.Point,this.position=new n.Point,this._oldPosition=new n.Point,this.circle=new n.Circle(0,0,44),this.activePointer=this.mousePointer,this.hitCanvas=PIXI.CanvasPool.create(this,1,1),this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var t=this;this._onClickTrampoline=function(e){t.onClickTrampoline(e)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],PIXI.CanvasPool.remove(this),this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(t,e){this.customCandidateHandler=t,this.customCandidateHandlerContext=e},addMoveCallback:function(t,e){this.moveCallbacks.push({callback:t,context:e})},deleteMoveCallback:function(t,e){for(var i=this.moveCallbacks.length;i--;)if(this.moveCallbacks[i].callback===t&&this.moveCallbacks[i].context===e)return void this.moveCallbacks.splice(i,1)},addPointer:function(){if(this.pointers.length>=n.Input.MAX_POINTERS)return null;var t=this.pointers.length+1,e=new n.Pointer(this.game,t,n.PointerMode.TOUCH);return this.pointers.push(e),this["pointer"+t]=e,e},update:function(){if(this.keyboard&&this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate)this._pollCounter++;else{this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var t=0;t<this.pointers.length;t++)this.pointers[t].update();this._pollCounter=0}},reset:function(t){if(this.game.isBooted&&!this.resetLocked){void 0===t&&(t=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(t),this.gamepad&&this.gamepad.reset();for(var e=0;e<this.pointers.length;e++)this.pointers[e].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit"),t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(t,e){this._oldPosition.setTo(t,e),this.speed.setTo(0,0)},startPointer:function(t){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(t);if(!this.pointer2.active)return this.pointer2.start(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(!i.active)return i.start(t)}return null},updatePointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.move(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.move(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.move(t)}return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier)return this.pointer1.stop(t);if(this.pointer2.active&&this.pointer2.identifier===t.identifier)return this.pointer2.stop(t);for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier)return i.stop(t)}return null},countActivePointers:function(t){void 0===t&&(t=this.pointers.length);for(var e=t,i=0;i<this.pointers.length&&e>0;i++)this.pointers[i].active&&e--;return t-e},getPointer:function(t){void 0===t&&(t=!1);for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active===t)return i}return null},getPointerFromIdentifier:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.identifier===t)return i}return null},getPointerFromId:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.pointerId===t)return i}return null},getLocalPosition:function(t,e,i){void 0===i&&(i=new n.Point);var s=t.worldTransform,o=1/(s.a*s.d+s.c*-s.b);return i.setTo(s.d*o*e.x+-s.c*o*e.y+(s.ty*s.c-s.tx*s.d)*o,s.a*o*e.y+-s.b*o*e.x+(-s.ty*s.a+s.tx*s.b)*o)},hitTest:function(t,e,i){if(!t.worldVisible)return!1;if(this.getLocalPosition(t,e,this._localPoint),i.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y);if(t instanceof n.TileSprite){var s=t.width,o=t.height,a=-s*t.anchor.x;if(this._localPoint.x>=a&&this._localPoint.x<a+s){var r=-o*t.anchor.y;if(this._localPoint.y>=r&&this._localPoint.y<r+o)return!0}}else if(t instanceof PIXI.Sprite){s=t.texture.frame.width,o=t.texture.frame.height,a=-s*t.anchor.x;if(this._localPoint.x>=a&&this._localPoint.x<a+s){r=-o*t.anchor.y;if(this._localPoint.y>=r&&this._localPoint.y<r+o)return!0}}else if(t instanceof n.Graphics)for(var h=0;h<t.graphicsData.length;h++){var l=t.graphicsData[h];if(l.fill&&l.shape&&l.shape.contains(this._localPoint.x,this._localPoint.y))return!0}for(h=0;h<t.children.length;h++)if(this.hitTest(t.children[h],e,i))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},n.Input.prototype.constructor=n.Input,Object.defineProperty(n.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}}),Object.defineProperty(n.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}}),Object.defineProperty(n.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(n.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(n.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(n.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(n.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),n.Mouse=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new n.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},n.Mouse.NO_BUTTON=-1,n.Mouse.LEFT_BUTTON=0,n.Mouse.MIDDLE_BUTTON=1,n.Mouse.RIGHT_BUTTON=2,n.Mouse.BACK_BUTTON=3,n.Mouse.FORWARD_BUTTON=4,n.Mouse.WHEEL_UP=1,n.Mouse.WHEEL_DOWN=-1,n.Mouse.prototype={start:function(){if((!this.game.device.android||!1!==this.game.device.chrome)&&null===this._onMouseDown){var t=this;this._onMouseDown=function(e){return t.onMouseDown(e)},this._onMouseMove=function(e){return t.onMouseMove(e)},this._onMouseUp=function(e){return t.onMouseUp(e)},this._onMouseUpGlobal=function(e){return t.onMouseUpGlobal(e)},this._onMouseOutGlobal=function(e){return t.onMouseOutGlobal(e)},this._onMouseOut=function(e){return t.onMouseOut(e)},this._onMouseOver=function(e){return t.onMouseOver(e)},this._onMouseWheel=function(e){return t.onMouseWheel(e)};var e=this.game.canvas;e.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("mousemove",this._onMouseMove,!0),e.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),e.addEventListener("mouseover",this._onMouseOver,!0),e.addEventListener("mouseout",this._onMouseOut,!0));var i=this.game.device.wheelEvent;i&&(e.addEventListener(i,this._onMouseWheel,!0),"mousewheel"===i?this._wheelEvent=new s(-.025,1):"DOMMouseScroll"===i&&(this._wheelEvent=new s(1,1)))}},onMouseDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.start(t))},onMouseMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.move(t))},onMouseUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseUpGlobal:function(t){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),t.identifier=0,this.input.mousePointer.stop(t))},onMouseOutGlobal:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(t),this.input.mousePointer.leftButton.stop(t),this.input.mousePointer.rightButton.stop(t))},onMouseOut:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&this.stopOnGameOut&&(t.identifier=0,this.input.mousePointer.stop(t))},onMouseOver:function(t){this.event=t,this.capture&&t.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,t)},onMouseWheel:function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t)),this.event=t,this.capture&&t.preventDefault(),this.wheelDelta=n.Math.clamp(-t.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,t)},requestPointerLock:function(){if(this.game.device.pointerLock){var t=this.game.canvas;t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock();var e=this;this._pointerLockChange=function(t){return e.pointerLockChange(t)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(t){var e=this.game.canvas;document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(this.locked=!0,this.pointerLock.dispatch(!0,t)):(this.locked=!1,this.pointerLock.dispatch(!1,t))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var t=this.game.canvas;t.removeEventListener("mousedown",this._onMouseDown,!0),t.removeEventListener("mousemove",this._onMouseMove,!0),t.removeEventListener("mouseup",this._onMouseUp,!0),t.removeEventListener("mouseover",this._onMouseOver,!0),t.removeEventListener("mouseout",this._onMouseOut,!0);var e=this.game.device.wheelEvent;e&&t.removeEventListener(e,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),window.removeEventListener("mouseout",this._onMouseOutGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},n.Mouse.prototype.constructor=n.Mouse,s.prototype={},s.prototype.constructor=s,s.prototype.bindEvent=function(t){if(!s._stubsGenerated&&t){var e=function(t){return function(){var e=this.originalEvent[t];return"function"!=typeof e?e:e.bind(this.originalEvent)}};for(var i in t)i in s.prototype||Object.defineProperty(s.prototype,i,{get:e(i)});s._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(s.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),n.MSPointer=function(t){this.game=t,this.input=t.input,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null,this._onMSPointerUpGlobal=null,this._onMSPointerOut=null,this._onMSPointerOver=null},n.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var t=this;if(this.game.device.mspointer){this._onMSPointerDown=function(e){return t.onPointerDown(e)},this._onMSPointerMove=function(e){return t.onPointerMove(e)},this._onMSPointerUp=function(e){return t.onPointerUp(e)},this._onMSPointerUpGlobal=function(e){return t.onPointerUpGlobal(e)},this._onMSPointerOut=function(e){return t.onPointerOut(e)},this._onMSPointerOver=function(e){return t.onPointerOver(e)};var e=this.game.canvas;e.addEventListener("MSPointerDown",this._onMSPointerDown,!1),e.addEventListener("MSPointerMove",this._onMSPointerMove,!1),e.addEventListener("MSPointerUp",this._onMSPointerUp,!1),e.addEventListener("pointerdown",this._onMSPointerDown,!1),e.addEventListener("pointermove",this._onMSPointerMove,!1),e.addEventListener("pointerup",this._onMSPointerUp,!1),e.style["-ms-content-zooming"]="none",e.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),e.addEventListener("MSPointerOver",this._onMSPointerOver,!0),e.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),e.addEventListener("pointerover",this._onMSPointerOver,!0),e.addEventListener("pointerout",this._onMSPointerOut,!0))}}},onPointerDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.start(t):this.input.startPointer(t))},onPointerMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.move(t):this.input.updatePointer(t))},onPointerUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,t),this.input.enabled&&this.enabled&&(t.identifier=t.pointerId,"mouse"===t.pointerType||4===t.pointerType?this.input.mousePointer.stop(t):this.input.stopPointer(t))},onPointerUpGlobal:function(t){if("mouse"!==t.pointerType&&4!==t.pointerType||this.input.mousePointer.withinGame){var e=this.input.getPointerFromIdentifier(t.identifier);e&&e.withinGame&&this.onPointerUp(t)}else this.onPointerUp(t)},onPointerOut:function(t){if(this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType)this.input.mousePointer.withinGame=!1;else{var e=this.input.getPointerFromIdentifier(t.identifier);e&&(e.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,t),this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(t.identifier=0,e?e.stop(t):this.input.mousePointer.stop(t))},onPointerOver:function(t){if(this.event=t,this.capture&&t.preventDefault(),"mouse"===t.pointerType||4===t.pointerType)this.input.mousePointer.withinGame=!0;else{var e=this.input.getPointerFromIdentifier(t.identifier);e&&(e.withinGame=!0)}this.input.mouse.mouseOverCallback&&this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,t)},stop:function(){var t=this.game.canvas;t.removeEventListener("MSPointerDown",this._onMSPointerDown,!1),t.removeEventListener("MSPointerMove",this._onMSPointerMove,!1),t.removeEventListener("MSPointerUp",this._onMSPointerUp,!1),t.removeEventListener("pointerdown",this._onMSPointerDown,!1),t.removeEventListener("pointermove",this._onMSPointerMove,!1),t.removeEventListener("pointerup",this._onMSPointerUp,!1),window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.removeEventListener("MSPointerOver",this._onMSPointerOver,!0),t.removeEventListener("MSPointerOut",this._onMSPointerOut,!0),window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.removeEventListener("pointerover",this._onMSPointerOver,!0),t.removeEventListener("pointerout",this._onMSPointerOut,!0)}},n.MSPointer.prototype.constructor=n.MSPointer,n.DeviceButton=function(t,e){this.parent=t,this.game=t.game,this.event=null,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.value=0,this.buttonCode=e,this.onDown=new n.Signal,this.onUp=new n.Signal,this.onFloat=new n.Signal},n.DeviceButton.prototype={start:function(t,e){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onDown.dispatch(this,e))},stop:function(t,e){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=t,this.value=e,t&&(this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey),this.onUp.dispatch(this,e))},padFloat:function(t){this.value=t,this.onFloat.dispatch(this,t)},justPressed:function(t){return t=t||250,this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||250,this.isUp&&this.timeUp+t>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.parent=null,this.game=null}},n.DeviceButton.prototype.constructor=n.DeviceButton,Object.defineProperty(n.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),n.Pointer=function(t,e,i){this.game=t,this.id=e,this.type=n.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.pointerMode=i||n.PointerMode.CURSOR|n.PointerMode.CONTACT,this.target=null,this.button=null,this.leftButton=new n.DeviceButton(this,n.Pointer.LEFT_BUTTON),this.middleButton=new n.DeviceButton(this,n.Pointer.MIDDLE_BUTTON),this.rightButton=new n.DeviceButton(this,n.Pointer.RIGHT_BUTTON),this.backButton=new n.DeviceButton(this,n.Pointer.BACK_BUTTON),this.forwardButton=new n.DeviceButton(this,n.Pointer.FORWARD_BUTTON),this.eraserButton=new n.DeviceButton(this,n.Pointer.ERASER_BUTTON),this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=0===e,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.interactiveCandidates=[],this.active=!1,this.dirty=!1,this.position=new n.Point,this.positionDown=new n.Point,this.positionUp=new n.Point,this.circle=new n.Circle(0,0,44),this._clickTrampolines=null,this._trampolineTargetObject=null},n.Pointer.NO_BUTTON=0,n.Pointer.LEFT_BUTTON=1,n.Pointer.RIGHT_BUTTON=2,n.Pointer.MIDDLE_BUTTON=4,n.Pointer.BACK_BUTTON=8,n.Pointer.FORWARD_BUTTON=16,n.Pointer.ERASER_BUTTON=32,n.Pointer.prototype={resetButtons:function(){this.isDown=!1,this.isUp=!0,this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(t,e){n.Pointer.LEFT_BUTTON&t&&this.leftButton.start(e),n.Pointer.RIGHT_BUTTON&t&&this.rightButton.start(e),n.Pointer.MIDDLE_BUTTON&t&&this.middleButton.start(e),n.Pointer.BACK_BUTTON&t&&this.backButton.start(e),n.Pointer.FORWARD_BUTTON&t&&this.forwardButton.start(e),n.Pointer.ERASER_BUTTON&t&&this.eraserButton.start(e)},processButtonsUp:function(t,e){t===n.Mouse.LEFT_BUTTON&&this.leftButton.stop(e),t===n.Mouse.RIGHT_BUTTON&&this.rightButton.stop(e),t===n.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(e),t===n.Mouse.BACK_BUTTON&&this.backButton.stop(e),t===n.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(e),5===t&&this.eraserButton.stop(e)},updateButtons:function(t){this.button=t.button;var e="down"===t.type.toLowerCase().substr(-4);void 0!==t.buttons?e?this.processButtonsDown(t.buttons,t):this.processButtonsUp(t.button,t):e?this.leftButton.start(t):(this.leftButton.stop(t),this.rightButton.stop(t)),1===t.buttons&&t.ctrlKey&&this.leftButton.isDown&&(this.leftButton.stop(t),this.rightButton.start(t)),this.isUp=!0,this.isDown=!1,(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(t){var e=this.game.input;return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,this.isMouse?this.updateButtons(t):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(e.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.x=this.x,e.y=this.y,e.position.setTo(this.x,this.y),e.onDown.dispatch(this,t),e.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){var t=this.game.input;this.active&&(this.dirty&&(t.interactiveItems.total>0&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=t.holdRate&&((t.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&0===t.totalActivePointers)&&t.onHold.dispatch(this),this._holdSent=!0),t.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+t.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>t.recordLimit&&this._history.shift()))},move:function(t,e){var i=this.game.input;if(!i.pollLocked){if(void 0===e&&(e=!1),void 0!==t.button&&(this.button=t.button),e&&this.isMouse&&this.updateButtons(t),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&i.mouse.locked&&!e&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*i.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*i.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(i.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&0===i.totalActivePointers)&&(i.activePointer=this,i.x=this.x,i.y=this.y,i.position.setTo(i.x,i.y),i.circle.x=i.x,i.circle.y=i.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var s=i.moveCallbacks.length;s--;)i.moveCallbacks[s].callback.call(i.moveCallbacks[s].context,this,this.x,this.y,e);return null!==this.targetObject&&!0===this.targetObject.isDragged?!1===this.targetObject.update(this)&&(this.targetObject=null):i.interactiveItems.total>0&&this.processInteractiveObjects(e),this}},processInteractiveObjects:function(t){var e=0,i=-1,s=null,n=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];n;)n.checked=!1,n.validForInput(i,e,!1)&&(n.checked=!0,(t&&n.checkPointerDown(this,!0)||!t&&n.checkPointerOver(this,!0))&&(e=n.sprite.renderOrderID,i=n.priorityID,s=n,this.interactiveCandidates.push(n))),n=this.game.input.interactiveItems.next;for(n=this.game.input.interactiveItems.first;n;)!n.checked&&n.validForInput(i,e,!0)&&(t&&n.checkPointerDown(this,!1)||!t&&n.checkPointerOver(this,!1))&&(e=n.sprite.renderOrderID,i=n.priorityID,s=n,this.interactiveCandidates.push(n)),n=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(s=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,s)),this.swapTarget(s,!1),null!==this.targetObject},swapTarget:function(t,e){void 0===e&&(e=!1),null===t?this.targetObject&&(this.targetObject._pointerOutHandler(this,e),this.targetObject=null):null===this.targetObject?(this.targetObject=t,t._pointerOverHandler(this,e)):this.targetObject===t?!1===t.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,e),this.targetObject=t,this.targetObject._pointerOverHandler(this,e))},leave:function(t){this.withinGame=!1,this.move(t,!1)},stop:function(t){var e=this.game.input;return this._stateReset&&this.withinGame?void t.preventDefault():(this.timeUp=this.game.time.time,(e.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&(e.onUp.dispatch(this,t),this.duration>=0&&this.duration<=e.tapRate&&(this.timeUp-this.previousTapTime<e.doubleTapRate?e.onTap.dispatch(this,!0):e.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.isMouse?this.updateButtons(t):(this.isDown=!1,this.isUp=!0),this.id>0&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(t.pageX,t.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===this.isMouse&&e.currentPointers--,e.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this)},justPressed:function(t){return t=t||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){return t=t||this.game.input.justReleasedRate,this.isUp&&this.timeUp+t>this.game.time.time},addClickTrampoline:function(t,e,i,s){if(this.isDown){for(var n=this._clickTrampolines=this._clickTrampolines||[],o=0;o<n.length;o++)if(n[o].name===t){n.splice(o,1);break}n.push({name:t,targetObject:this.targetObject,callback:e,callbackContext:i,callbackArgs:s})}},processClickTrampolines:function(){var t=this._clickTrampolines;if(t){for(var e=0;e<t.length;e++){var i=t[e];i.targetObject===this._trampolineTargetObject&&i.callback.apply(i.callbackContext,i.callbackArgs)}this._clickTrampolines=null,this._trampolineTargetObject=null}},reset:function(){!1===this.isMouse&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.resetButtons(),this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},n.Pointer.prototype.constructor=n.Pointer,Object.defineProperty(n.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(n.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(n.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),n.PointerMode={CURSOR:1,CONTACT:2},n.Touch=function(t){this.game=t,this.enabled=!0,this.touchLockCallbacks=[],this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},n.Touch.prototype={start:function(){if(null===this._onTouchStart){var t=this;this.game.device.touch&&(this._onTouchStart=function(e){return t.onTouchStart(e)},this._onTouchMove=function(e){return t.onTouchMove(e)},this._onTouchEnd=function(e){return t.onTouchEnd(e)},this._onTouchEnter=function(e){return t.onTouchEnter(e)},this._onTouchLeave=function(e){return t.onTouchLeave(e)},this._onTouchCancel=function(e){return t.onTouchCancel(e)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},addTouchLockCallback:function(t,e,i){void 0===i&&(i=!1),this.touchLockCallbacks.push({callback:t,context:e,onEnd:i})},removeTouchLockCallback:function(t,e){for(var i=this.touchLockCallbacks.length;i--;)if(this.touchLockCallbacks[i].callback===t&&this.touchLockCallbacks[i].context===e)return this.touchLockCallbacks.splice(i,1),!0;return!1},onTouchStart:function(t){for(var e=this.touchLockCallbacks.length;e--;){var i=this.touchLockCallbacks[e];!i.onEnd&&i.callback.call(i.context,this,t)&&this.touchLockCallbacks.splice(e,1)}if(this.event=t,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(e=0;e<t.changedTouches.length;e++)this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){if(this.event=t,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled){this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.game.input.enabled&&this.enabled&&this.preventDefault&&t.preventDefault()},onTouchLeave:function(t){this.event=t,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault()},onTouchMove:function(t){this.event=t,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.updatePointer(t.changedTouches[e])},onTouchEnd:function(t){for(var e=this.touchLockCallbacks.length;e--;){var i=this.touchLockCallbacks[e];i.onEnd&&i.callback.call(i.context,this,t)&&this.touchLockCallbacks.splice(e,1)}this.event=t,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},n.Touch.prototype.constructor=n.Touch,n.InputHandler=function(t){this.sprite=t,this.game=t.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.scaleLayer=!1,this.dragOffset=new n.Point,this.dragFromCenter=!1,this.dragStopBlocksInputUp=!1,this.dragStartPoint=new n.Point,this.dragDistanceThreshold=0,this.dragTimeThreshold=0,this.downPoint=new n.Point,this.snapPoint=new n.Point,this._dragPoint=new n.Point,this._dragPhase=!1,this._pendingDrag=!1,this._dragTimePass=!1,this._dragDistancePass=!1,this._wasEnabled=!1,this._tempPoint=new n.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},n.InputHandler.prototype={start:function(t,e){if(t=t||0,void 0===e&&(e=!1),!1===this.enabled){this.game.input.interactiveItems.add(this),this.useHandCursor=e,this.priorityID=t;for(var i=0;i<10;i++)this._pointerData[i]={id:i,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new n.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var t=0;t<10;t++)this._pointerData[t]={id:t,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(t,e,i){return void 0===i&&(i=!0),!(!this.enabled||0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput||!i&&(this.pixelPerfectClick||this.pixelPerfectOver)||!(this.priorityID>t||this.priorityID===t&&this.sprite.renderOrderID>e))},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){return t=t||0,this._pointerData[t].x},pointerY:function(t){return t=t||0,this._pointerData[t].y},pointerDown:function(t){return t=t||0,this._pointerData[t].isDown},pointerUp:function(t){return t=t||0,this._pointerData[t].isUp},pointerTimeDown:function(t){return t=t||0,this._pointerData[t].timeDown},pointerTimeUp:function(t){return t=t||0,this._pointerData[t].timeUp},pointerOver:function(t){if(!this.enabled)return!1;if(void 0===t){for(var e=0;e<10;e++)if(this._pointerData[e].isOver)return!0;return!1}return this._pointerData[t].isOver},pointerOut:function(t){if(!this.enabled)return!1;if(void 0!==t)return this._pointerData[t].isOut;for(var e=0;e<10;e++)if(this._pointerData[e].isOut)return!0},pointerTimeOver:function(t){return t=t||0,this._pointerData[t].timeOver},pointerTimeOut:function(t){return t=t||0,this._pointerData[t].timeOut},pointerDragged:function(t){return t=t||0,this._pointerData[t].isDragged},checkPointerDown:function(t,e){return!!(t.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectClick)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPointerOver:function(t,e){return!!(this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,t,this._tempPoint)&&(void 0===e&&(e=!1),!(!e&&this.pixelPerfectOver)||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(null===t&&null===e){this.game.input.getLocalPosition(this.sprite,i,this._tempPoint);t=this._tempPoint.x,e=this._tempPoint.y}if(0!==this.sprite.anchor.x&&(t-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(e-=-this.sprite.texture.frame.height*this.sprite.anchor.y),t+=this.sprite.texture.frame.x,e+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(t-=this.sprite.texture.trim.x,e-=this.sprite.texture.trim.y,t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom))return this._dx=t,this._dy=e,!1;if(this._dx=t,this._dy=e,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1),this.game.input.hitContext.getImageData(0,0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(t){if(null!==this.sprite&&void 0!==this.sprite.parent)return this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=n.Math.distance(t.x,t.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(t),!0):this.draggable&&this._draggedPointerID===t.id?this.updateDrag(t,!1):this._pointerData[t.id].isOver?this.checkPointerOver(t)?(this._pointerData[t.id].x=t.x-this.sprite.x,this._pointerData[t.id].y=t.y-this.sprite.y,!0):(this._pointerOutHandler(t),!1):void 0:(this._pointerOutHandler(t),!1)},_pointerOverHandler:function(t,e){if(null!==this.sprite){var i=this._pointerData[t.id];if(!1===i.isOver||t.dirty){var s=!1===i.isOver;i.isOver=!0,i.isOut=!1,i.timeOver=this.game.time.time,i.x=t.x-this.sprite.x,i.y=t.y-this.sprite.y,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),!e&&s&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,t),this.sprite.parent&&this.sprite.parent.type===n.GROUP&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,t)}}},_pointerOutHandler:function(t,e){if(null!==this.sprite){var i=this._pointerData[t.id];i.isOver=!1,i.isOut=!0,i.timeOut=this.game.time.time,this.useHandCursor&&!1===i.isDragged&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),!e&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.type===n.GROUP&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,t))}},_touchedHandler:function(t){if(null!==this.sprite){var e=this._pointerData[t.id];if(!e.isDown&&e.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,t))return;if(e.isDown=!0,e.isUp=!1,e.timeDown=this.game.time.time,this.downPoint.set(t.x,t.y),t.dirty=!0,this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,t),this.sprite&&this.sprite.parent&&this.sprite.parent.type===n.GROUP&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,t),null===this.sprite))return;this.draggable&&!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(t):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,this.dragTimeThreshold>0?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,t)):this._dragTimePass=!0)),this.bringToTop&&this.sprite.bringToTop()}}},dragTimeElapsed:function(t){this._dragTimePass=!0,this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(t)},_releasedHandler:function(t){if(null!==this.sprite){var e=this._pointerData[t.id];if(e.isDown&&t.isUp){e.isDown=!1,e.isUp=!0,e.timeUp=this.game.time.time,e.downDuration=e.timeUp-e.timeDown;var i=this.checkPointerOver(t);this.sprite&&this.sprite.events&&(this.dragStopBlocksInputUp&&(!this.dragStopBlocksInputUp||this.draggable&&this.isDragged&&this._draggedPointerID===t.id)||this.sprite.events.onInputUp$dispatch(this.sprite,t,i),this.sprite&&this.sprite.parent&&this.sprite.parent.type===n.GROUP&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,t,i),i&&(i=this.checkPointerOver(t))),e.isOver=i,!i&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),t.dirty=!0,this._pendingDrag=!1,this.draggable&&this.isDragged&&this._draggedPointerID===t.id&&this.stopDrag(t)}}},updateDrag:function(t,e){if(void 0===e&&(e=!1),t.isUp)return this.stopDrag(t),!1;var i=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x,s=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera)this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=i),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=s),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y));else{var n=this.game.camera.x-this._pointerData[t.id].camX,o=this.game.camera.y-this._pointerData[t.id].camY;this.allowHorizontalDrag&&(this.sprite.x=i+n),this.allowVerticalDrag&&(this.sprite.y=s+o),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))}return this.sprite.events.onDragUpdate.dispatch(this.sprite,t,i,s,this.snapPoint,e),!0},justOver:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOut&&this.game.time.time-this._pointerData[t].timeOut<e},justPressed:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isUp&&this.game.time.time-this._pointerData[t].timeUp<e},overDuration:function(t){return t=t||0,this._pointerData[t].isOver?this.game.time.time-this._pointerData[t].timeOver:-1},downDuration:function(t){return t=t||0,this._pointerData[t].isDown?this.game.time.time-this._pointerData[t].timeDown:-1},enableDrag:function(t,e,i,s,o,a){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===s&&(s=255),void 0===o&&(o=null),void 0===a&&(a=null),this._dragPoint=new n.Point,this.draggable=!0,this.bringToTop=e,this.dragOffset=new n.Point,this.dragFromCenter=t,this.pixelPerfectClick=i,this.pixelPerfectAlpha=s,o&&(this.boundsRect=o),a&&(this.boundsSprite=a)},disableDrag:function(){if(this._pointerData)for(var t=0;t<10;t++)this._pointerData[t].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1,this._pendingDrag=!1},startDrag:function(t){var e=this.sprite.x,i=this.sprite.y;if(this.isDragged=!0,this._draggedPointerID=t.id,this._pointerData[t.id].camX=this.game.camera.x,this._pointerData[t.id].camY=this.game.camera.y,this._pointerData[t.id].isDragged=!0,this.sprite.fixedToCamera){if(this.dragFromCenter){var s=this.sprite.getBounds();this.sprite.cameraOffset.x=this.globalToLocalX(t.x)+(this.sprite.cameraOffset.x-s.centerX),this.sprite.cameraOffset.y=this.globalToLocalY(t.y)+(this.sprite.cameraOffset.y-s.centerY)}this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)}else{if(this.dragFromCenter){s=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(t.x)+(this.sprite.x-s.centerX),this.sprite.y=this.globalToLocalY(t.y)+(this.sprite.y-s.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(t.x),this.sprite.y-this.globalToLocalY(t.y))}this.updateDrag(t,!0),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(e,i),this.sprite.events.onDragStart$dispatch(this.sprite,t,e,i),this._pendingDrag=!1},globalToLocalX:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.x,t*=this.game.scale.grid.scaleFluidInversed.x),t},globalToLocalY:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.y,t*=this.game.scale.grid.scaleFluidInversed.y),t},stopDrag:function(t){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[t.id].isDragged=!1,this._dragPhase=!1,this._pendingDrag=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,t),!1===this.checkPointerOver(t)&&this._pointerOutHandler(t)},setDragLock:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0),this.allowHorizontalDrag=t,this.allowVerticalDrag=e},enableSnap:function(t,e,i,s,n,o){void 0===i&&(i=!0),void 0===s&&(s=!1),void 0===n&&(n=0),void 0===o&&(o=0),this.snapX=t,this.snapY=e,this.snapOffsetX=n,this.snapOffsetY=o,this.snapOnDrag=i,this.snapOnRelease=s},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},n.InputHandler.prototype.constructor=n.InputHandler,n.Gamepad=function(t){this.game=t,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this)]},n.Gamepad.prototype={addCallbacks:function(t,e){void 0!==e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},start:function(){if(!this._active){this._active=!0;var t=this;this._onGamepadConnected=function(e){return t.onGamepadConnected(e)},this._onGamepadDisconnected=function(e){return t.onGamepadDisconnected(e)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(t){var e=t.gamepad;this._rawPads.push(e),this._gamepads[e.index].connect(e)},onGamepadDisconnected:function(t){var e=t.gamepad;for(var i in this._rawPads)this._rawPads[i].index===e.index&&this._rawPads.splice(i,1);this._gamepads[e.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(this._active){if(navigator.getGamepads)var t=navigator.getGamepads();else if(navigator.webkitGetGamepads)t=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)t=navigator.webkitGamepads();if(t){this._rawPads=[];for(var e=!1,i=0;i<t.length&&(typeof t[i]!==this._prevRawGamepadTypes[i]&&(e=!0,this._prevRawGamepadTypes[i]=typeof t[i]),t[i]&&this._rawPads.push(t[i]),3!==i);i++);for(var s=0;s<this._gamepads.length;s++)this._gamepads[s]._rawPad=this._rawPads[s];if(e){for(var n,o={rawIndices:{},padIndices:{}},a=0;a<this._gamepads.length;a++)if((n=this._gamepads[a]).connected)for(var r=0;r<this._rawPads.length;r++)this._rawPads[r].index===n.index&&(o.rawIndices[n.index]=!0,o.padIndices[a]=!0);for(var h=0;h<this._gamepads.length;h++)if(n=this._gamepads[h],!o.padIndices[h]){this._rawPads.length<1&&n.disconnect();for(var l=0;l<this._rawPads.length&&!o.padIndices[h];l++){var c=this._rawPads[l];if(c){if(o.rawIndices[c.index]){n.disconnect();continue}n.connect(c),o.rawIndices[c.index]=!0,o.padIndices[h]=!0}else n.disconnect()}}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].deadZone=t},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].reset()},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justPressed(t,e))return!0;return!1},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(!0===this._gamepads[i].justReleased(t,e))return!0;return!1},isDown:function(t){for(var e=0;e<this._gamepads.length;e++)if(!0===this._gamepads[e].isDown(t))return!0;return!1},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].destroy()}},n.Gamepad.prototype.constructor=n.Gamepad,Object.defineProperty(n.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(n.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(n.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(n.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(n.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(n.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(n.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),n.Gamepad.BUTTON_0=0,n.Gamepad.BUTTON_1=1,n.Gamepad.BUTTON_2=2,n.Gamepad.BUTTON_3=3,n.Gamepad.BUTTON_4=4,n.Gamepad.BUTTON_5=5,n.Gamepad.BUTTON_6=6,n.Gamepad.BUTTON_7=7,n.Gamepad.BUTTON_8=8,n.Gamepad.BUTTON_9=9,n.Gamepad.BUTTON_10=10,n.Gamepad.BUTTON_11=11,n.Gamepad.BUTTON_12=12,n.Gamepad.BUTTON_13=13,n.Gamepad.BUTTON_14=14,n.Gamepad.BUTTON_15=15,n.Gamepad.AXIS_0=0,n.Gamepad.AXIS_1=1,n.Gamepad.AXIS_2=2,n.Gamepad.AXIS_3=3,n.Gamepad.AXIS_4=4,n.Gamepad.AXIS_5=5,n.Gamepad.AXIS_6=6,n.Gamepad.AXIS_7=7,n.Gamepad.AXIS_8=8,n.Gamepad.AXIS_9=9,n.Gamepad.XBOX360_A=0,n.Gamepad.XBOX360_B=1,n.Gamepad.XBOX360_X=2,n.Gamepad.XBOX360_Y=3,n.Gamepad.XBOX360_LEFT_BUMPER=4,n.Gamepad.XBOX360_RIGHT_BUMPER=5,n.Gamepad.XBOX360_LEFT_TRIGGER=6,n.Gamepad.XBOX360_RIGHT_TRIGGER=7,n.Gamepad.XBOX360_BACK=8,n.Gamepad.XBOX360_START=9,n.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,n.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,n.Gamepad.XBOX360_DPAD_LEFT=14,n.Gamepad.XBOX360_DPAD_RIGHT=15,n.Gamepad.XBOX360_DPAD_UP=12,n.Gamepad.XBOX360_DPAD_DOWN=13,n.Gamepad.XBOX360_STICK_LEFT_X=0,n.Gamepad.XBOX360_STICK_LEFT_Y=1,n.Gamepad.XBOX360_STICK_RIGHT_X=2,n.Gamepad.XBOX360_STICK_RIGHT_Y=3,n.Gamepad.PS3XC_X=0,n.Gamepad.PS3XC_CIRCLE=1,n.Gamepad.PS3XC_SQUARE=2,n.Gamepad.PS3XC_TRIANGLE=3,n.Gamepad.PS3XC_L1=4,n.Gamepad.PS3XC_R1=5,n.Gamepad.PS3XC_L2=6,n.Gamepad.PS3XC_R2=7,n.Gamepad.PS3XC_SELECT=8,n.Gamepad.PS3XC_START=9,n.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,n.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,n.Gamepad.PS3XC_DPAD_UP=12,n.Gamepad.PS3XC_DPAD_DOWN=13,n.Gamepad.PS3XC_DPAD_LEFT=14,n.Gamepad.PS3XC_DPAD_RIGHT=15,n.Gamepad.PS3XC_STICK_LEFT_X=0,n.Gamepad.PS3XC_STICK_LEFT_Y=1,n.Gamepad.PS3XC_STICK_RIGHT_X=2,n.Gamepad.PS3XC_STICK_RIGHT_Y=3,n.SinglePad=function(t,e){this.game=t,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=e,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},n.SinglePad.prototype={addCallbacks:function(t,e){void 0!==e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback,this.callbackContext=t)},getButton:function(t){return this._buttons[t]?this._buttons[t]:null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];e!==this._buttons[t].value&&(1===e?this.processButtonDown(t,e):0===e?this.processButtonUp(t,e):this.processButtonFloat(t,e))}for(var i=0;i<this._axesLen;i++){var s=this._rawPad.axes[i];s>0&&s>this.deadZone||s<0&&s<-this.deadZone?this.processAxisChange(i,s):this.processAxisChange(i,0)}this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var e=!this.connected;this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length;for(var i=0;i<this._axesLen;i++)this._axes[i]=t.axes[i];for(var s in t.buttons)s=parseInt(s,10),this._buttons[s]=new n.DeviceButton(this,s);e&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),e&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,e=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var i=0;i<this._buttonsLen;i++)this._buttons[i].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e),t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var t=0;t<this._buttonsLen;t++)this._buttons[t].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(t,e){this._axes[t]!==e&&(this._axes[t]=e,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,t,e))},processButtonDown:function(t,e){this._buttons[t]&&this._buttons[t].start(null,e),this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t,e)},processButtonUp:function(t,e){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].stop(null,e)},processButtonFloat:function(t,e){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].padFloat(e)},axis:function(t){return!!this._axes[t]&&this._axes[t]},isDown:function(t){return!!this._buttons[t]&&this._buttons[t].isDown},isUp:function(t){return!!this._buttons[t]&&this._buttons[t].isUp},justReleased:function(t,e){if(this._buttons[t])return this._buttons[t].justReleased(e)},justPressed:function(t,e){if(this._buttons[t])return this._buttons[t].justPressed(e)},buttonValue:function(t){return this._buttons[t]?this._buttons[t].value:null},reset:function(){for(var t=0;t<this._axes.length;t++)this._axes[t]=0}},n.SinglePad.prototype.constructor=n.SinglePad,n.Key=function(t,e){this.game=t,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=e,this.onDown=new n.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new n.Signal,this._justDown=!1,this._justUp=!1},n.Key.prototype={update:function(){this._enabled&&this.isDown&&(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(t){this._enabled&&(this.event=t,this.isDown||(this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(t){this._enabled&&(this.event=t,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(t){void 0===t&&(t=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this._enabled=!0,this._justDown=!1,this._justUp=!1,t&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(t){return void 0===t&&(t=50),this.isDown&&this.duration<t},upDuration:function(t){return void 0===t&&(t=50),!this.isDown&&this.game.time.time-this.timeUp<t}},Object.defineProperty(n.Key.prototype,"justDown",{get:function(){var t=this._justDown;return this._justDown=!1,t}}),Object.defineProperty(n.Key.prototype,"justUp",{get:function(){var t=this._justUp;return this._justUp=!1,t}}),Object.defineProperty(n.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(t){(t=!!t)!==this._enabled&&(t||this.reset(!1),this._enabled=t)}}),n.Key.prototype.constructor=n.Key,n.Keyboard=function(t){this.game=t,this.enabled=!0,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},n.Keyboard.prototype={addCallbacks:function(t,e,i,s){this.callbackContext=t,null!=e&&(this.onDownCallback=e),null!=i&&(this.onUpCallback=i),null!=s&&(this.onPressCallback=s)},addKey:function(t){return this._keys[t]||(this._keys[t]=new n.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},addKeys:function(t){var e={};for(var i in t)e[i]=this.addKey(t[i]);return e},removeKey:function(t){this._keys[t]&&(this._keys[t]=null,this.removeKeyCapture(t))},createCursorKeys:function(){return this.addKeys({up:n.KeyCode.UP,down:n.KeyCode.DOWN,left:n.KeyCode.LEFT,right:n.KeyCode.RIGHT})},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var t=this;this._onKeyDown=function(e){return t.processKeyDown(e)},this._onKeyUp=function(e){return t.processKeyUp(e)},this._onKeyPress=function(e){return t.processKeyPress(e)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){if(this.event=t,this.game.input.enabled&&this.enabled){var e=t.keyCode;this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new n.Key(this.game,e)),this._keys[e].processKeyDown(t),this._k=e,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t)}},processKeyPress:function(t){this.pressEvent=t,this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)},processKeyUp:function(t){if(this.event=t,this.game.input.enabled&&this.enabled){var e=t.keyCode;this._capture[e]&&t.preventDefault(),this._keys[e]||(this._keys[e]=new n.Key(this.game,e)),this._keys[e].processKeyUp(t),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t)}},reset:function(t){void 0===t&&(t=!0),this.event=null;for(var e=this._keys.length;e--;)this._keys[e]&&this._keys[e].reset(t)},downDuration:function(t,e){return this._keys[t]?this._keys[t].downDuration(e):null},upDuration:function(t,e){return this._keys[t]?this._keys[t].upDuration(e):null},isDown:function(t){return this._keys[t]?this._keys[t].isDown:null}},Object.defineProperty(n.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(n.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),n.Keyboard.prototype.constructor=n.Keyboard,n.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},n.KeyCode)n.KeyCode.hasOwnProperty(a)&&!a.match(/[a-z]/)&&(n.Keyboard[a]=n.KeyCode[a]);for(var r in n.Component=function(){},n.Component.Angle=function(){},n.Component.Angle.prototype={angle:{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}}},n.Component.Animation=function(){},n.Component.Animation.prototype={play:function(t,e,i,s){if(this.animations)return this.animations.play(t,e,i,s)}},n.Component.AutoCull=function(){},n.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},n.Component.Bounds=function(){},n.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+.5*this.width},set:function(t){this.x=t+this.offsetX-.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+.5*this.height},set:function(t){this.y=t+this.offsetY-.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(t){this.x=t+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(t){this.x=t-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(t){this.y=t+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(t){this.y=t-this.height+this.offsetY}},alignIn:function(t,e,i,s){switch(void 0===i&&(i=0),void 0===s&&(s=0),e){default:case n.TOP_LEFT:this.left=t.left-i,this.top=t.top-s;break;case n.TOP_CENTER:this.centerX=t.centerX+i,this.top=t.top-s;break;case n.TOP_RIGHT:this.right=t.right+i,this.top=t.top-s;break;case n.LEFT_CENTER:this.left=t.left-i,this.centerY=t.centerY+s;break;case n.CENTER:this.centerX=t.centerX+i,this.centerY=t.centerY+s;break;case n.RIGHT_CENTER:this.right=t.right+i,this.centerY=t.centerY+s;break;case n.BOTTOM_LEFT:this.left=t.left-i,this.bottom=t.bottom+s;break;case n.BOTTOM_CENTER:this.centerX=t.centerX+i,this.bottom=t.bottom+s;break;case n.BOTTOM_RIGHT:this.right=t.right+i,this.bottom=t.bottom+s}return this},alignTo:function(t,e,i,s){switch(void 0===i&&(i=0),void 0===s&&(s=0),e){default:case n.TOP_LEFT:this.left=t.left-i,this.bottom=t.top-s;break;case n.TOP_CENTER:this.centerX=t.centerX+i,this.bottom=t.top-s;break;case n.TOP_RIGHT:this.right=t.right+i,this.bottom=t.top-s;break;case n.LEFT_TOP:this.right=t.left-i,this.top=t.top-s;break;case n.LEFT_CENTER:this.right=t.left-i,this.centerY=t.centerY+s;break;case n.LEFT_BOTTOM:this.right=t.left-i,this.bottom=t.bottom+s;break;case n.RIGHT_TOP:this.left=t.right+i,this.top=t.top-s;break;case n.RIGHT_CENTER:this.left=t.right+i,this.centerY=t.centerY+s;break;case n.RIGHT_BOTTOM:this.left=t.right+i,this.bottom=t.bottom+s;break;case n.BOTTOM_LEFT:this.left=t.left-i,this.top=t.bottom+s;break;case n.BOTTOM_CENTER:this.centerX=t.centerX+i,this.top=t.bottom+s;break;case n.BOTTOM_RIGHT:this.right=t.right+i,this.top=t.bottom+s}return this}},n.Group.prototype.alignIn=n.Component.Bounds.prototype.alignIn,n.Group.prototype.alignTo=n.Component.Bounds.prototype.alignTo,n.Component.BringToTop=function(){},n.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},n.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},n.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},n.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},n.Component.Core=function(){},n.Component.Core.install=function(t){n.Utils.mixinPrototype(this,n.Component.Core.prototype),this.components={};for(var e=0;e<t.length;e++){var i=t[e],s=!1;"Destroy"===i&&(s=!0),n.Utils.mixinPrototype(this,n.Component[i].prototype,s),this.components[i]=!0}},n.Component.Core.init=function(t,e,i,s,o){this.game=t,this.key=s,this.data={},this.position.set(e,i),this.world=new n.Point(e,i),this.previousPosition=new n.Point(e,i),this.events=new n.Events(this),this._bounds=new n.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new n.AnimationManager(this)),this.components.LoadTexture&&null!==s&&this.loadTexture(s,o),this.components.FixedToCamera&&(this.cameraOffset=new n.Point(e,i))},n.Component.Core.preUpdate=function(){if(!this.pendingDestroy){if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate();for(var t=0;t<this.children.length;t++)this.children[t].preUpdate();return!0}this.destroy()},n.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(t){t?(this._exists=!0,this.body&&this.body.type===n.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===n.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},update:function(){},postUpdate:function(){this.customRender&&this.key.render(),this.components.PhysicsBody&&n.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&n.Component.FixedToCamera.postUpdate.call(this);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()}},n.Component.Crop=function(){},n.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,e){void 0===e&&(e=!1),t?(e&&null!==this.cropRect?this.cropRect.setTo(t.x,t.y,t.width,t.height):e&&null===this.cropRect?this.cropRect=new n.Rectangle(t.x,t.y,t.width,t.height):this.cropRect=t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){var t=this.texture.crop.x,e=this.texture.crop.y,i=this.texture.crop.width,s=this.texture.crop.height;this._crop=n.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var o=Math.max(this._frame.x,this._crop.x),a=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-o,h=Math.min(this._frame.bottom,this._crop.bottom)-a;this.texture.crop.x=o,this.texture.crop.y=a,this.texture.crop.width=r,this.texture.crop.height=h,this.texture.frame.width=Math.min(r,this.cropRect.width),this.texture.frame.height=Math.min(h,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs(),16777215===this.tint||t===o&&e===a&&i===r&&s===h||(this.texture.requiresReTint=!0)}}},n.Component.Delta=function(){},n.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},n.Component.Destroy=function(){},n.Component.Destroy.prototype={destroyPhase:!1,destroy:function(t,e){if(null!==this.game&&!this.destroyPhase){void 0===t&&(t=!0),void 0===e&&(e=!1),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy(),this.game.tweens.removeFrom(this);var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this._crop&&(this._crop=null,this.cropRect=null),this._frame&&(this._frame=null),n.Video&&this.key instanceof n.Video&&this.key.onChangeSource.remove(this.resizeFrame,this),n.BitmapText&&this._glyphs&&(this._glyphs=[]),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.data={},this.renderable=!1,this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),e&&this.texture.destroy(!0),this.destroyPhase=!1,this.pendingDestroy=!1}}},n.Events=function(t){this.parent=t},n.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onRemovedFromWorld&&this._onRemovedFromWorld.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragUpdate&&this._onDragUpdate.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},n.Events.prototype.constructor=n.Events,n.Events.prototype)n.Events.prototype.hasOwnProperty(r)&&0===r.indexOf("on")&&null===n.Events.prototype[r]&&function(t,e){"use strict";Object.defineProperty(n.Events.prototype,t,{get:function(){return this[e]||(this[e]=new n.Signal)}}),n.Events.prototype[t+"$dispatch"]=function(){return this[e]?this[e].dispatch.apply(this[e],arguments):null}}(r,"_"+r);n.Component.FixedToCamera=function(){},n.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},n.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(t){t?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new n.Point},n.Component.Health=function(){},n.Component.Health.prototype={health:1,maxHealth:100,damage:function(t){return this.alive&&(this.health-=t,this.health<=0&&this.kill()),this},setHealth:function(t){return this.health=t,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(t){return this.alive&&(this.health+=t,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}},n.Component.InCamera=function(){},n.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},n.Component.InputEnabled=function(){},n.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},n.Component.InWorld=function(){},n.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0},n.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},n.Component.LifeSpan=function(){},n.Component.LifeSpan.preUpdate=function(){return!(this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0)&&(this.kill(),1))},n.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(t){return void 0===t&&(t=100),this.alive=!0,this.exists=!0,this.visible=!0,"function"==typeof this.setHealth&&this.setHealth(t),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},n.Component.LoadTexture=function(){},n.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(t,e,i){t===n.PENDING_ATLAS?(t=e,e=0):e=e||0,(i||void 0===i)&&this.animations&&this.animations.stop(),this.key=t,this.customRender=!1;var s=this.game.cache,o=!0,a=!this.texture.baseTexture.scaleMode;if(n.RenderTexture&&t instanceof n.RenderTexture)this.key=t.key,this.setTexture(t);else if(n.BitmapData&&t instanceof n.BitmapData)this.customRender=!0,this.setTexture(t.texture),o=s.hasFrameData(t.key,n.Cache.BITMAPDATA)?!this.animations.loadFrameData(s.getFrameData(t.key,n.Cache.BITMAPDATA),e):!this.animations.loadFrameData(t.frameData,0);else if(n.Video&&t instanceof n.Video){this.customRender=!0;var r=t.texture.valid;this.setTexture(t.texture),this.setFrame(t.texture.frame.clone()),t.onChangeSource.add(this.resizeFrame,this),this.texture.valid=r}else if(n.Tilemap&&t instanceof n.TilemapLayer)this.setTexture(PIXI.Texture.fromCanvas(t.canvas));else if(t instanceof PIXI.Texture)this.setTexture(t);else{var h=s.getImage(t,!0);this.key=h.key,this.setTexture(new PIXI.Texture(h.base)),this.texture.baseTexture.skipRender="__default"===t,o=!this.animations.loadFrameData(h.frameData,e)}o&&(this._frame=n.Rectangle.clone(this.texture.frame)),a||(this.texture.baseTexture.scaleMode=1)},setFrame:function(t){this._frame=t,this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),this.cropRect&&this.updateCrop(),this.texture.requiresReTint=!0,this.texture._updateUvs(),this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(t,e,i){this.texture.frame.resize(e,i),this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}},frameName:{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}},n.Component.Overlap=function(){},n.Component.Overlap.prototype={overlap:function(t){return n.Rectangle.intersects(this.getBounds(),t.getBounds())}},n.Component.PhysicsBody=function(){},n.Component.PhysicsBody.preUpdate=function(){return this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,!(!this._exists||!this.parent.exists)||(this.renderOrderID=-1,!1))},n.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},n.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(t){this.position.x=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},n.Component.Reset=function(){},n.Component.Reset.prototype.reset=function(t,e,i){return void 0===i&&(i=1),this.world.set(t,e),this.position.set(t,e),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=i),this.components.PhysicsBody&&this.body&&this.body.reset(t,e,!1,!1),this},n.Component.ScaleMinMax=function(){},n.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(t){this.scaleMin&&(t.a<this.scaleMin.x&&(t.a=this.scaleMin.x),t.d<this.scaleMin.y&&(t.d=this.scaleMin.y)),this.scaleMax&&(t.a>this.scaleMax.x&&(t.a=this.scaleMax.x),t.d>this.scaleMax.y&&(t.d=this.scaleMax.y))},setScaleMinMax:function(t,e,i,s){void 0===e?e=i=s=t:void 0===i&&(i=s=e,e=t),null===t?this.scaleMin=null:this.scaleMin?this.scaleMin.set(t,e):this.scaleMin=new n.Point(t,e),null===i?this.scaleMax=null:this.scaleMax?this.scaleMax.set(i,s):this.scaleMax=new n.Point(i,s),null===this.scaleMin?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}},n.Component.Smoothed=function(){},n.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){t?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}},n.GameObjectFactory=function(t){this.game=t,this.world=this.game.world},n.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},weapon:function(t,e,i,s){var o=this.game.plugins.add(n.Weapon);return o.createBullets(t,e,i,s),o},image:function(t,e,i,s,o){return void 0===o&&(o=this.world),o.add(new n.Image(this.game,t,e,i,s))},sprite:function(t,e,i,s,n){return void 0===n&&(n=this.world),n.create(t,e,i,s)},creature:function(t,e,i,s,o){void 0===o&&(o=this.world);var a=new n.Creature(this.game,t,e,i,s);return o.add(a),a},tween:function(t){return this.game.tweens.create(t)},group:function(t,e,i,s,o){return new n.Group(this.game,t,e,i,s,o)},physicsGroup:function(t,e,i,s){return new n.Group(this.game,e,i,s,!0,t)},spriteBatch:function(t,e,i){return void 0===t&&(t=null),void 0===e&&(e="group"),void 0===i&&(i=!1),new n.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},sound:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,e,i,s,o,a,r){return void 0===r&&(r=this.world),r.add(new n.TileSprite(this.game,t,e,i,s,o,a))},rope:function(t,e,i,s,o,a){return void 0===a&&(a=this.world),a.add(new n.Rope(this.game,t,e,i,s,o))},text:function(t,e,i,s,o){return void 0===o&&(o=this.world),o.add(new n.Text(this.game,t,e,i,s))},button:function(t,e,i,s,o,a,r,h,l,c){return void 0===c&&(c=this.world),c.add(new n.Button(this.game,t,e,i,s,o,a,r,h,l))},graphics:function(t,e,i){return void 0===i&&(i=this.world),i.add(new n.Graphics(this.game,t,e))},emitter:function(t,e,i){return this.game.particles.add(new n.Particles.Arcade.Emitter(this.game,t,e,i))},retroFont:function(t,e,i,s,o,a,r,h,l){return new n.RetroFont(this.game,t,e,i,s,o,a,r,h,l)},bitmapText:function(t,e,i,s,o,a){return void 0===a&&(a=this.world),a.add(new n.BitmapText(this.game,t,e,i,s,o))},tilemap:function(t,e,i,s,o){return new n.Tilemap(this.game,t,e,i,s,o)},renderTexture:function(t,e,i,s){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===s&&(s=!1);var o=new n.RenderTexture(this.game,t,e,i);return s&&this.game.cache.addRenderTexture(i,o),o},video:function(t,e){return new n.Video(this.game,t,e)},bitmapData:function(t,e,i,s){void 0===s&&(s=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());var o=new n.BitmapData(this.game,i,t,e);return s&&this.game.cache.addBitmapData(i,o),o},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new n.Filter[t](this.game)).init.apply(t,e),t},plugin:function(t){return this.game.plugins.add(t)}},n.GameObjectFactory.prototype.constructor=n.GameObjectFactory,n.GameObjectCreator=function(t){this.game=t,this.world=this.game.world},n.GameObjectCreator.prototype={image:function(t,e,i,s){return new n.Image(this.game,t,e,i,s)},sprite:function(t,e,i,s){return new n.Sprite(this.game,t,e,i,s)},tween:function(t){return new n.Tween(t,this.game,this.game.tweens)},group:function(t,e,i,s,o){return new n.Group(this.game,t,e,i,s,o)},spriteBatch:function(t,e,i){return void 0===e&&(e="group"),void 0===i&&(i=!1),new n.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,s){return this.game.sound.add(t,e,i,s)},tileSprite:function(t,e,i,s,o,a){return new n.TileSprite(this.game,t,e,i,s,o,a)},rope:function(t,e,i,s,o){return new n.Rope(this.game,t,e,i,s,o)},text:function(t,e,i,s){return new n.Text(this.game,t,e,i,s)},button:function(t,e,i,s,o,a,r,h,l){return new n.Button(this.game,t,e,i,s,o,a,r,h,l)},graphics:function(t,e){return new n.Graphics(this.game,t,e)},emitter:function(t,e,i){return new n.Particles.Arcade.Emitter(this.game,t,e,i)},retroFont:function(t,e,i,s,o,a,r,h,l){return new n.RetroFont(this.game,t,e,i,s,o,a,r,h,l)},bitmapText:function(t,e,i,s,o,a){return new n.BitmapText(this.game,t,e,i,s,o,a)},tilemap:function(t,e,i,s,o){return new n.Tilemap(this.game,t,e,i,s,o)},renderTexture:function(t,e,i,s){void 0!==i&&""!==i||(i=this.game.rnd.uuid()),void 0===s&&(s=!1);var o=new n.RenderTexture(this.game,t,e,i);return s&&this.game.cache.addRenderTexture(i,o),o},bitmapData:function(t,e,i,s){void 0===s&&(s=!1),void 0!==i&&""!==i||(i=this.game.rnd.uuid());var o=new n.BitmapData(this.game,i,t,e);return s&&this.game.cache.addBitmapData(i,o),o},filter:function(t){var e=Array.prototype.slice.call(arguments,1);return(t=new n.Filter[t](this.game)).init.apply(t,e),t}},n.GameObjectCreator.prototype.constructor=n.GameObjectCreator,n.Sprite=function(t,e,i,s,o){e=e||0,i=i||0,s=s||null,o=o||null,this.type=n.SPRITE,this.physicsType=n.SPRITE,PIXI.Sprite.call(this,n.Cache.DEFAULT),n.Component.Core.init.call(this,t,e,i,s,o)},n.Sprite.prototype=Object.create(PIXI.Sprite.prototype),n.Sprite.prototype.constructor=n.Sprite,n.Component.Core.install.call(n.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),n.Sprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.Sprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.Sprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Sprite.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Sprite.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},n.Image=function(t,e,i,s,o){e=e||0,i=i||0,s=s||null,o=o||null,this.type=n.IMAGE,PIXI.Sprite.call(this,n.Cache.DEFAULT),n.Component.Core.init.call(this,t,e,i,s,o)},n.Image.prototype=Object.create(PIXI.Sprite.prototype),n.Image.prototype.constructor=n.Image,n.Component.Core.install.call(n.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]),n.Image.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Image.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Image.prototype.preUpdate=function(){return!!this.preUpdateInWorld()&&this.preUpdateCore()},n.Button=function(t,e,i,s,o,a,r,h,l,c){e=e||0,i=i||0,s=s||null,o=o||null,a=a||this,n.Image.call(this,t,e,i,s,h),this.type=n.BUTTON,this.physicsType=n.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new n.Signal,this.onInputOut=new n.Signal,this.onInputDown=new n.Signal,this.onInputUp=new n.Signal,this.onOverMouseOnly=!0,this.justReleasedPreventsOver=n.PointerMode.TOUCH,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.input.useHandCursor=!0,this.setFrames(r,h,l,c),null!==o&&this.onInputUp.add(o,a),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this),this.events.onRemovedFromWorld.add(this.removedFromWorld,this)},n.Button.prototype=Object.create(n.Image.prototype),n.Button.prototype.constructor=n.Button;n.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},n.Button.prototype.removedFromWorld=function(){this.inputEnabled=!1},n.Button.prototype.setStateFrame=function(t,e,i){var s="_on"+t+"Frame";null!==e?(this[s]=e,i&&this.changeStateFrame(t)):this[s]=null},n.Button.prototype.changeStateFrame=function(t){if(this.freezeFrames)return!1;var e=this["_on"+t+"Frame"];return"string"==typeof e?(this.frameName=e,!0):"number"==typeof e&&(this.frame=e,!0)},n.Button.prototype.setFrames=function(t,e,i,s){this.setStateFrame("Over",t,this.input.pointerOver()),this.setStateFrame("Out",e,!this.input.pointerOver()),this.setStateFrame("Down",i,this.input.pointerDown()),this.setStateFrame("Up",s,this.input.pointerUp())},n.Button.prototype.setStateSound=function(t,e,i){var s="on"+t+"Sound",o="on"+t+"SoundMarker";e instanceof n.Sound||e instanceof n.AudioSprite?(this[s]=e,this[o]="string"==typeof i?i:""):(this[s]=null,this[o]="")},n.Button.prototype.playStateSound=function(t){var e=this["on"+t+"Sound"];if(e){var i=this["on"+t+"SoundMarker"];return e.play(i),!0}return!1},n.Button.prototype.setSounds=function(t,e,i,s,n,o,a,r){this.setStateSound("Over",t,e),this.setStateSound("Out",n,o),this.setStateSound("Down",i,s),this.setStateSound("Up",a,r)},n.Button.prototype.setOverSound=function(t,e){this.setStateSound("Over",t,e)},n.Button.prototype.setOutSound=function(t,e){this.setStateSound("Out",t,e)},n.Button.prototype.setDownSound=function(t,e){this.setStateSound("Down",t,e)},n.Button.prototype.setUpSound=function(t,e){this.setStateSound("Up",t,e)},n.Button.prototype.onInputOverHandler=function(t,e){e.justReleased()&&(this.justReleasedPreventsOver&e.pointerMode)===e.pointerMode||(this.changeStateFrame("Over"),this.onOverMouseOnly&&!e.isMouse||(this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,e)))},n.Button.prototype.onInputOutHandler=function(t,e){this.changeStateFrame("Out"),this.playStateSound("Out"),this.onInputOut&&this.onInputOut.dispatch(this,e)},n.Button.prototype.onInputDownHandler=function(t,e){this.changeStateFrame("Down"),this.playStateSound("Down"),this.onInputDown&&this.onInputDown.dispatch(this,e)},n.Button.prototype.onInputUpHandler=function(t,e,i){if(this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,e,i),!this.freezeFrames)if(!0===this.forceOut||(this.forceOut&e.pointerMode)===e.pointerMode)this.changeStateFrame("Out");else{this.changeStateFrame("Up")||(i?this.changeStateFrame("Over"):this.changeStateFrame("Out"))}},n.SpriteBatch=function(t,e,i,s){null!=e||(e=t.world),PIXI.SpriteBatch.call(this),n.Group.call(this,t,e,i,s),this.type=n.SPRITEBATCH},n.SpriteBatch.prototype=n.Utils.extend(!0,n.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,n.Group.prototype),n.SpriteBatch.prototype.constructor=n.SpriteBatch,n.BitmapData=function(t,e,i,s,o){void 0!==i&&0!==i||(i=256),void 0!==s&&0!==s||(s=256),void 0===o&&(o=!1),this.game=t,this.key=e,this.width=i,this.height=s,this.canvas=n.Canvas.create(this,i,s,null,o),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.smoothProperty=t.renderType===n.CANVAS?t.renderer.renderSession.smoothProperty:n.Canvas.getSmoothingPrefix(this.context),this.imageData=this.context.getImageData(0,0,i,s),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.frameData=new n.FrameData,this.textureFrame=this.frameData.addFrame(new n.Frame(0,0,0,i,s,"bitmapData")),this.texture.frame=this.textureFrame,this.type=n.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new n.Point,this._size=new n.Point,this._scale=new n.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new n.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new n.Circle,this._swapCanvas=void 0},n.BitmapData.prototype={move:function(t,e,i){return 0!==t&&this.moveH(t,i),0!==e&&this.moveV(e,i),this},moveH:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var i=this._swapCanvas.getContext("2d"),s=this.height,n=this.canvas;if(i.clearRect(0,0,this.width,this.height),t<0){t=Math.abs(t);var o=this.width-t;e&&i.drawImage(n,0,0,t,s,o,0,t,s),i.drawImage(n,t,0,o,s,0,0,o,s)}else{o=this.width-t;e&&i.drawImage(n,o,0,t,s,0,0,t,s),i.drawImage(n,0,0,o,s,t,0,o,s)}return this.clear(),this.copy(this._swapCanvas)},moveV:function(t,e){void 0===e&&(e=!0),void 0===this._swapCanvas&&(this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height));var i=this._swapCanvas.getContext("2d"),s=this.width,n=this.canvas;if(i.clearRect(0,0,this.width,this.height),t<0){t=Math.abs(t);var o=this.height-t;e&&i.drawImage(n,0,0,s,t,0,o,s,t),i.drawImage(n,0,t,s,o,0,0,s,o)}else{o=this.height-t;e&&i.drawImage(n,0,o,s,t,0,0,s,t),i.drawImage(n,0,0,s,o,0,t,s,o)}return this.clear(),this.copy(this._swapCanvas)},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},load:function(t){if("string"==typeof t&&(t=this.game.cache.getImage(t)),t)return this.resize(t.width,t.height),this.cls(),this.draw(t),this.update(),this},clear:function(t,e,i,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.width),void 0===s&&(s=this.height),this.context.clearRect(t,e,i,s),this.dirty=!0,this},fill:function(t,e,i,s){return void 0===s&&(s=1),this.context.fillStyle="rgba("+t+","+e+","+i+","+s+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(t){var e=new Image;e.src=this.canvas.toDataURL("image/png");var i=this.game.cache.addImage(t,"",e);return new PIXI.Texture(i.base)},resize:function(t,e){return t===this.width&&e===this.height||(this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,void 0!==this._swapCanvas&&(this._swapCanvas.width=t,this._swapCanvas.height=e),this.baseTexture.width=t,this.baseTexture.height=e,this.textureFrame.width=t,this.textureFrame.height=e,this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.update(),this.dirty=!0),this},update:function(t,e,i,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=Math.max(1,this.width)),void 0===s&&(s=Math.max(1,this.height)),this.imageData=this.context.getImageData(t,e,i,s),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,e,i,s,o,a){void 0===i&&(i=0),void 0===s&&(s=0),void 0===o&&(o=this.width),void 0===a&&(a=this.height);for(var r=i+o,h=s+a,l=n.Color.createColor(),c={r:0,g:0,b:0,a:0},u=!1,d=s;d<h;d++)for(var p=i;p<r;p++)n.Color.unpackPixel(this.getPixel32(p,d),l),!1!==(c=t.call(e,l,p,d))&&null!=c&&(this.setPixel32(p,d,c.r,c.g,c.b,c.a,!1),u=!0);return u&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(t,e,i,s,n,o){void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=this.width),void 0===o&&(o=this.height);for(var a=i+n,r=s+o,h=0,l=0,c=!1,u=s;u<r;u++)for(var d=i;d<a;d++)h=this.getPixel32(d,u),(l=t.call(e,h,d,u))!==h&&(this.pixels[u*this.width+d]=l,c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,e,i,s,o,a,r,h,l){var c=0,u=0,d=this.width,p=this.height,f=n.Color.packPixel(t,e,i,s);void 0!==l&&l instanceof n.Rectangle&&(c=l.x,u=l.y,d=l.width,p=l.height);for(var y=0;y<p;y++)for(var g=0;g<d;g++)this.getPixel32(c+g,u+y)===f&&this.setPixel32(c+g,u+y,o,a,r,h,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,e,i,s){var o=t||0===t,a=e||0===e,r=i||0===i;if(o||a||r){void 0===s&&(s=new n.Rectangle(0,0,this.width,this.height));for(var h=n.Color.createColor(),l=s.y;l<s.bottom;l++)for(var c=s.x;c<s.right;c++)n.Color.unpackPixel(this.getPixel32(c,l),h,!0),o&&(h.h=t),a&&(h.s=e),r&&(h.l=i),n.Color.HSLtoRGB(h.h,h.s,h.l,h),this.setPixel32(c,l,h.r,h.g,h.b,h.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,e,i,s){if(null!=t||(t=!1),null!=e||(e=!1),null!=i||(i=!1),t||e||i){void 0===s&&(s=new n.Rectangle(0,0,this.width,this.height));for(var o=n.Color.createColor(),a=s.y;a<s.bottom;a++)for(var r=s.x;r<s.right;r++)n.Color.unpackPixel(this.getPixel32(r,a),o,!0),t&&(o.h=this.game.math.wrap(o.h+t,0,1)),e&&(o.s=this.game.math.clamp(o.s+e,0,1)),i&&(o.l=this.game.math.clamp(o.l+i,0,1)),n.Color.HSLtoRGB(o.h,o.s,o.l,o),this.setPixel32(r,a,o.r,o.g,o.b,o.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,e,i,s,o,a,r){return void 0===r&&(r=!0),t>=0&&t<=this.width&&e>=0&&e<=this.height&&(n.Device.LITTLE_ENDIAN?this.pixels[e*this.width+t]=a<<24|o<<16|s<<8|i:this.pixels[e*this.width+t]=i<<24|s<<16|o<<8|a,r&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(t,e,i,s,n,o){return this.setPixel32(t,e,i,s,n,255,o)},getPixel:function(t,e,i){i||(i=n.Color.createColor());var s=~~(t+e*this.width);return s*=4,i.r=this.data[s],i.g=this.data[++s],i.b=this.data[++s],i.a=this.data[++s],i},getPixel32:function(t,e){if(t>=0&&t<=this.width&&e>=0&&e<=this.height)return this.pixels[e*this.width+t]},getPixelRGB:function(t,e,i,s,o){return n.Color.unpackPixel(this.getPixel32(t,e),i,s,o)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){void 0===t&&(t=0);var e=n.Color.createColor(),i=0,s=0,o=1,a=!1;1===t?(o=-1,s=this.height):3===t&&(o=-1,i=this.width);do{n.Color.unpackPixel(this.getPixel32(i,s),e),0===t||1===t?++i===this.width&&(i=0,((s+=o)>=this.height||s<=0)&&(a=!0)):2!==t&&3!==t||++s===this.height&&(s=0,((i+=o)>=this.width||i<=0)&&(a=!0))}while(0===e.a&&!a);return e.x=i,e.y=s,e},getBounds:function(t){return void 0===t&&(t=new n.Rectangle),t.x=this.getFirstPixel(2).x,t.x===this.width?t.setTo(0,0,0,0):(t.y=this.getFirstPixel(0).y,t.width=this.getFirstPixel(3).x-t.x+1,t.height=this.getFirstPixel(1).y-t.y+1,t)},addToWorld:function(t,e,i,s,n,o){n=n||1,o=o||1;var a=this.game.add.image(t,e,this);return a.anchor.set(i,s),a.scale.set(n,o),a},copy:function(t,e,i,s,o,a,r,h,l,c,u,d,p,f,y,g,m){if(null!=t||(t=this),(t instanceof n.RenderTexture||t instanceof PIXI.RenderTexture)&&(t=t.getCanvas()),this._image=t,t instanceof n.Sprite||t instanceof n.Image||t instanceof n.Text||t instanceof PIXI.Sprite)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,t.texture instanceof n.RenderTexture||t.texture instanceof PIXI.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source,null!=a||(a=t.x),null!=r||(r=t.y),t.texture.trim&&(a+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,r+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof n.BitmapData)this._image=t.canvas;else if("string"==typeof t){if(null===(t=this.game.cache.getImage(t)))return;this._image=t}this._size.set(this._image.width,this._image.height)}if(null!=e||(e=0),null!=i||(i=0),s&&(this._size.x=s),o&&(this._size.y=o),null!=a||(a=e),null!=r||(r=i),null!=h||(h=this._size.x),null!=l||(l=this._size.y),"number"==typeof c&&(this._rotate=c),"number"==typeof u&&(this._anchor.x=u),"number"==typeof d&&(this._anchor.y=d),"number"==typeof p&&(this._scale.x=p),"number"==typeof f&&(this._scale.y=f),"number"==typeof y&&(this._alpha.current=y),void 0===g&&(g=null),void 0===m&&(m=!1),!(this._alpha.current<=0||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y)){var v=this.context;return this._alpha.prev=v.globalAlpha,v.save(),v.globalAlpha=this._alpha.current,g&&(this.op=g),m&&(a|=0,r|=0),v.translate(a,r),v.scale(this._scale.x,this._scale.y),v.rotate(this._rotate),v.drawImage(this._image,this._pos.x+e,this._pos.y+i,this._size.x,this._size.y,-h*this._anchor.x,-l*this._anchor.y,h,l),v.restore(),v.globalAlpha=this._alpha.prev,this.dirty=!0,this}},copyTransform:function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=!1),!t.hasOwnProperty("worldTransform")||!t.worldVisible||0===t.worldAlpha)return this;var s=t.worldTransform;if(this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),0===s.a||0===s.d||0===this._size.x||0===this._size.y)return this;t.texture instanceof n.RenderTexture||t.texture instanceof PIXI.RenderTexture?this._image=t.texture.getCanvas():this._image=t.texture.baseTexture.source;var o=s.tx,a=s.ty;t.texture.trim&&(o+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,a+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture,this._pos.set(0)),i&&(o|=0,a|=0);var r=this.context;return this._alpha.prev=r.globalAlpha,r.save(),r.globalAlpha=this._alpha.current,e&&(this.op=e),r[this.smoothProperty]=t.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,r.setTransform(s.a,s.b,s.c,s.d,o,a),r.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*t.anchor.x,-this._size.y*t.anchor.y,this._size.x,this._size.y),r.restore(),r.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(t,e,i,s,n,o,a){return this.copy(t,e.x,e.y,e.width,e.height,i,s,e.width,e.height,0,0,0,1,1,n,o,a)},draw:function(t,e,i,s,n,o,a){return this.copy(t,null,null,null,null,e,i,s,n,null,null,null,null,null,null,o,a)},drawGroup:function(t,e,i){return t.total>0&&t.forEachExists(this.drawGroupProxy,this,e,i),this},drawGroupProxy:function(t,e,i){if(t.hasOwnProperty("texture")&&this.copyTransform(t,e,i),t.type===n.GROUP&&t.exists)this.drawGroup(t,e,i);else if(t.hasOwnProperty("children")&&t.children.length>0)for(var s=0;s<t.children.length;s++)t.children[s].exists&&this.copyTransform(t.children[s],e,i)},drawFull:function(t,e,i){if(!1===t.worldVisible||0===t.worldAlpha||t.hasOwnProperty("exists")&&!1===t.exists)return this;if(t.type!==n.GROUP&&t.type!==n.EMITTER&&t.type!==n.BITMAPTEXT)if(t.type===n.GRAPHICS){var s=t.getBounds();this.ctx.save(),this.ctx.translate(s.x,s.y),PIXI.CanvasGraphics.renderGraphics(t,this.ctx),this.ctx.restore()}else this.copy(t,null,null,null,null,t.worldPosition.x,t.worldPosition.y,null,null,t.worldRotation,null,null,t.worldScale.x,t.worldScale.y,t.worldAlpha,e,i);if(t.children)for(var o=0;o<t.children.length;o++)this.drawFull(t.children[o],e,i);return this},shadow:function(t,e,i,s){var n=this.context;return null==t?n.shadowColor="rgba(0,0,0,0)":(n.shadowColor=t,n.shadowBlur=e||5,n.shadowOffsetX=i||10,n.shadowOffsetY=s||10),this},alphaMask:function(t,e,i,s){return null==s?this.draw(e).blendSourceAtop():this.draw(e,s.x,s.y,s.width,s.height).blendSourceAtop(),null==i?this.draw(t).blendReset():this.draw(t,i.x,i.y,i.width,i.height).blendReset(),this},extract:function(t,e,i,s,n,o,a,r,h){return void 0===n&&(n=255),void 0===o&&(o=!1),void 0===a&&(a=e),void 0===r&&(r=i),void 0===h&&(h=s),o&&t.resize(this.width,this.height),this.processPixelRGB(function(o,l,c){return o.r===e&&o.g===i&&o.b===s&&t.setPixel32(l,c,a,r,h,n,!1),!1},this),t.context.putImageData(t.imageData,0,0),t.dirty=!0,t},rect:function(t,e,i,s,n){return void 0!==n&&(this.context.fillStyle=n),this.context.fillRect(t,e,i,s),this},text:function(t,e,i,s,n,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s="14px Courier"),void 0===n&&(n="rgb(255,255,255)"),void 0===o&&(o=!0);var a=this.context,r=a.font;return a.font=s,o&&(a.fillStyle="rgb(0,0,0)",a.fillText(t,e+1,i+1)),a.fillStyle=n,a.fillText(t,e,i),a.font=r,this},circle:function(t,e,i,s){var n=this.context;return void 0!==s&&(n.fillStyle=s),n.beginPath(),n.arc(t,e,i,0,2*Math.PI,!1),n.closePath(),n.fill(),this},line:function(t,e,i,s,n,o){void 0===n&&(n="#fff"),void 0===o&&(o=1);var a=this.context;return a.beginPath(),a.moveTo(t,e),a.lineTo(i,s),a.lineWidth=o,a.strokeStyle=n,a.stroke(),a.closePath(),this},textureLine:function(t,e,i){if(void 0===i&&(i="repeat-x"),"string"!=typeof e||(e=this.game.cache.getImage(e))){var s=t.length;"no-repeat"===i&&s>e.width&&(s=e.width);var o=this.context;return o.fillStyle=o.createPattern(e,i),this._circle=new n.Circle(t.start.x,t.start.y,e.height),this._circle.circumferencePoint(t.angle-1.5707963267948966,!1,this._pos),o.save(),o.translate(this._pos.x,this._pos.y),o.rotate(t.angle),o.fillRect(0,0,s,e.height),o.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy(),this.texture.destroy(!0),PIXI.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this}},Object.defineProperty(n.BitmapData.prototype,"smoothed",{get:function(){n.Canvas.getSmoothingEnabled(this.context)},set:function(t){n.Canvas.setSmoothingEnabled(this.context,t)}}),Object.defineProperty(n.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}}),n.BitmapData.getTransform=function(t,e,i,s,n,o){return"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof i&&(i=1),"number"!=typeof s&&(s=1),"number"!=typeof n&&(n=0),"number"!=typeof o&&(o=0),{sx:i,sy:s,scaleX:i,scaleY:s,skewX:n,skewY:o,translateX:t,translateY:e,tx:t,ty:e}},n.BitmapData.prototype.constructor=n.BitmapData,PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new PIXI.Rectangle(0,0,1,1),this.dirty=!0,this._boundsDirty=!1,this.webGLDirty=!1,this.cachedSpriteDirty=!1},PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Graphics.prototype.constructor=PIXI.Graphics,PIXI.Graphics.prototype.lineStyle=function(t,e,i){return this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0===i?1:i,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},PIXI.Graphics.prototype.moveTo=function(t,e){return this.drawShape(new PIXI.Polygon([t,e])),this},PIXI.Graphics.prototype.lineTo=function(t,e){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(t,e),this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.quadraticCurveTo=function(t,e,i,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var n,o,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var r=a[a.length-2],h=a[a.length-1],l=0,c=1;c<=20;++c)n=r+(t-r)*(l=c/20),o=h+(e-h)*l,a.push(n+(t+(i-t)*l-n)*l,o+(e+(s-e)*l-o)*l);return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.bezierCurveTo=function(t,e,i,s,n,o){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var a,r,h,l,c,u=this.currentPath.shape.points,d=u[u.length-2],p=u[u.length-1],f=0,y=1;y<=20;++y)h=(r=(a=1-(f=y/20))*a)*a,c=(l=f*f)*f,u.push(h*d+3*r*f*t+3*a*l*i+c*n,h*p+3*r*f*e+3*a*l*s+c*o);return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.arcTo=function(t,e,i,s,n){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(t,e):this.moveTo(t,e);var o=this.currentPath.shape.points,a=o[o.length-2],r=o[o.length-1]-e,h=a-t,l=s-e,c=i-t,u=Math.abs(r*c-h*l);if(u<1e-8||0===n)o[o.length-2]===t&&o[o.length-1]===e||o.push(t,e);else{var d=r*r+h*h,p=l*l+c*c,f=r*l+h*c,y=n*Math.sqrt(d)/u,g=n*Math.sqrt(p)/u,m=y*f/d,v=g*f/p,b=y*c+g*h,x=y*l+g*r,_=h*(g+m),w=r*(g+m),P=c*(y+v),C=l*(y+v),T=Math.atan2(w-x,_-b),S=Math.atan2(C-x,P-b);this.arc(b+t,x+e,n,T,S,h*l>c*r)}return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.arc=function(t,e,i,s,n,o,a){if(s===n)return this;void 0===o&&(o=!1),void 0===a&&(a=40),!o&&n<=s?n+=2*Math.PI:o&&s<=n&&(s+=2*Math.PI);var r=o?-1*(s-n):n-s,h=Math.ceil(Math.abs(r)/(2*Math.PI))*a;if(0===r)return this;var l=t+Math.cos(s)*i,c=e+Math.sin(s)*i;o&&this.filling?this.moveTo(t,e):this.moveTo(l,c);for(var u=this.currentPath.shape.points,d=r/(2*h),p=2*d,f=Math.cos(d),y=Math.sin(d),g=h-1,m=g%1/g,v=0;v<=g;v++){var b=d+s+p*(v+m*v),x=Math.cos(b),_=-Math.sin(b);u.push((f*x+y*_)*i+t,(f*-_+y*x)*i+e)}return this.dirty=!0,this._boundsDirty=!0,this},PIXI.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},PIXI.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},PIXI.Graphics.prototype.drawRect=function(t,e,i,s){return this.drawShape(new PIXI.Rectangle(t,e,i,s)),this},PIXI.Graphics.prototype.drawRoundedRect=function(t,e,i,s,n){return this.drawShape(new PIXI.RoundedRectangle(t,e,i,s,n)),this},PIXI.Graphics.prototype.drawCircle=function(t,e,i){return this.drawShape(new PIXI.Circle(t,e,i)),this},PIXI.Graphics.prototype.drawEllipse=function(t,e,i,s){return this.drawShape(new PIXI.Ellipse(t,e,i,s)),this},PIXI.Graphics.prototype.drawPolygon=function(t){(t instanceof n.Polygon||t instanceof PIXI.Polygon)&&(t=t.points);var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i)e[i]=arguments[i]}return this.drawShape(new n.Polygon(e)),this},PIXI.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},PIXI.Graphics.prototype.generateTexture=function(t,e,i){void 0===t&&(t=1),void 0===e&&(e=PIXI.scaleModes.DEFAULT),void 0===i&&(i=0);var s=this.getBounds();s.width+=i,s.height+=i;var n=new PIXI.CanvasBuffer(s.width*t,s.height*t),o=PIXI.Texture.fromCanvas(n.canvas,e);return o.baseTexture.resolution=t,n.context.scale(t,t),n.context.translate(-s.x,-s.y),PIXI.CanvasGraphics.renderGraphics(this,n.context),o},PIXI.Graphics.prototype._renderWebGL=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=PIXI.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},PIXI.Graphics.prototype._renderCanvas=function(t){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);var e=t.context,i=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var s=t.resolution,n=i.tx*t.resolution+t.shakeX,o=i.ty*t.resolution+t.shakeY;e.setTransform(i.a*s,i.b*s,i.c*s,i.d*s,n,o),PIXI.CanvasGraphics.renderGraphics(this,e);for(var a=0;a<this.children.length;a++)this.children[a]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},PIXI.Graphics.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable)return PIXI.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._localBounds,i=e.x,s=e.width+e.x,n=e.y,o=e.height+e.y,a=t||this.worldTransform,r=a.a,h=a.b,l=a.c,c=a.d,u=a.tx,d=a.ty,p=r*s+l*o+u,f=c*o+h*s+d,y=r*i+l*o+u,g=c*o+h*i+d,m=r*i+l*n+u,v=c*n+h*i+d,b=r*s+l*n+u,x=c*n+h*s+d,_=p,w=f,P=p,C=f;P=b<(P=m<(P=y<P?y:P)?m:P)?b:P,C=x<(C=v<(C=g<C?g:C)?v:C)?x:C,_=b>(_=m>(_=y>_?y:_)?m:_)?b:_,w=x>(w=v>(w=g>w?g:w)?v:w)?x:w,this._bounds.x=P,this._bounds.width=_-P,this._bounds.y=C,this._bounds.height=w-C,this._currentBounds=this._bounds}return this._currentBounds},PIXI.Graphics.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var i=this.getBounds();for(this.worldTransform=t,e=0;e<this.children.length;e++)this.children[e].updateTransform();return i},PIXI.Graphics.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);for(var e=this.graphicsData,i=0;i<e.length;i++){var s=e[i];if(s.fill&&s.shape&&s.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1},PIXI.Graphics.prototype.updateLocalBounds=function(){var t=1/0,e=-1/0,i=1/0,s=-1/0;if(this.graphicsData.length)for(var o,a,r,h,l,c,u=0;u<this.graphicsData.length;u++){var d=this.graphicsData[u],p=d.type,f=d.lineWidth;if(o=d.shape,p===PIXI.Graphics.RECT||p===PIXI.Graphics.RREC)r=o.x-f/2,h=o.y-f/2,t=r<t?r:t,e=r+(l=o.width+f)>e?r+l:e,i=h<i?h:i,s=h+(c=o.height+f)>s?h+c:s;else if(p===PIXI.Graphics.CIRC)r=o.x,h=o.y,t=r-(l=o.radius+f/2)<t?r-l:t,e=r+l>e?r+l:e,i=h-(c=o.radius+f/2)<i?h-c:i,s=h+c>s?h+c:s;else if(p===PIXI.Graphics.ELIP)r=o.x,h=o.y,t=r-(l=o.width+f/2)<t?r-l:t,e=r+l>e?r+l:e,i=h-(c=o.height+f/2)<i?h-c:i,s=h+c>s?h+c:s;else{a=o.points;for(var y=0;y<a.length;y++)a[y]instanceof n.Point?(r=a[y].x,h=a[y].y):(r=a[y],h=a[y+1],y<a.length-1&&y++),t=r-f<t?r-f:t,e=r+f>e?r+f:e,i=h-f<i?h-f:i,s=h+f>s?h+f:s}}else t=0,e=0,i=0,s=0;var g=this.boundsPadding;this._localBounds.x=t-g,this._localBounds.width=e-t+2*g,this._localBounds.y=i-g,this._localBounds.height=s-i+2*g},PIXI.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(t.width,t.height);else{var e=new PIXI.CanvasBuffer(t.width,t.height),i=PIXI.Texture.fromCanvas(e.canvas);this._cachedSprite=new PIXI.Sprite(i),this._cachedSprite.buffer=e,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-t.x/t.width,this._cachedSprite.anchor.y=-t.y/t.height,this._cachedSprite.buffer.context.translate(-t.x,-t.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},PIXI.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null,t instanceof n.Polygon&&(t=t.clone()).flatten();var e=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(e),e.type===PIXI.Graphics.POLY&&(e.shape.closed=this.filling,this.currentPath=e),this.dirty=!0,this._boundsDirty=!0,e},Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite(),this.dirty=!0,this.webGLDirty=!0}}),PIXI.GraphicsData=function(t,e,i,s,n,o,a){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this._lineTint=e,this.fillColor=s,this.fillAlpha=n,this._fillTint=s,this.fill=o,this.shape=a,this.type=a.type},PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData,PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},PIXI.EarCut={},PIXI.EarCut.Triangulate=function(t,e,i){i=i||2;var s,n,o,a,r,h,l,c=e&&e.length,u=c?e[0]*i:t.length,d=PIXI.EarCut.linkedList(t,0,u,i,!0),p=[];if(!d)return p;if(c&&(d=PIXI.EarCut.eliminateHoles(t,e,d,i)),t.length>80*i){s=o=t[0],n=a=t[1];for(var f=i;f<u;f+=i)(r=t[f])<s&&(s=r),(h=t[f+1])<n&&(n=h),r>o&&(o=r),h>a&&(a=h);l=Math.max(o-s,a-n)}return PIXI.EarCut.earcutLinked(d,p,i,s,n,l),p},PIXI.EarCut.linkedList=function(t,e,i,s,n){var o,a,r,h=0;for(o=e,a=i-s;o<i;o+=s)h+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;if(n===h>0)for(o=e;o<i;o+=s)r=PIXI.EarCut.insertNode(o,t[o],t[o+1],r);else for(o=i-s;o>=e;o-=s)r=PIXI.EarCut.insertNode(o,t[o],t[o+1],r);return r},PIXI.EarCut.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!PIXI.EarCut.equals(s,s.next)&&0!==PIXI.EarCut.area(s.prev,s,s.next))s=s.next;else{if(PIXI.EarCut.removeNode(s),(s=e=s.prev)===s.next)return null;i=!0}}while(i||s!==e);return e},PIXI.EarCut.earcutLinked=function(t,e,i,s,n,o,a){if(t){!a&&o&&PIXI.EarCut.indexCurve(t,s,n,o);for(var r,h,l=t;t.prev!==t.next;)if(r=t.prev,h=t.next,o?PIXI.EarCut.isEarHashed(t,s,n,o):PIXI.EarCut.isEar(t))e.push(r.i/i),e.push(t.i/i),e.push(h.i/i),PIXI.EarCut.removeNode(t),t=h.next,l=h.next;else if((t=h)===l){a?1===a?(t=PIXI.EarCut.cureLocalIntersections(t,e,i),PIXI.EarCut.earcutLinked(t,e,i,s,n,o,2)):2===a&&PIXI.EarCut.splitEarcut(t,e,i,s,n,o):PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(t),e,i,s,n,o,1);break}}},PIXI.EarCut.isEar=function(t){var e=t.prev,i=t,s=t.next;if(PIXI.EarCut.area(e,i,s)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(PIXI.EarCut.pointInTriangle(e.x,e.y,i.x,i.y,s.x,s.y,n.x,n.y)&&PIXI.EarCut.area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0},PIXI.EarCut.isEarHashed=function(t,e,i,s){var n=t.prev,o=t,a=t.next;if(PIXI.EarCut.area(n,o,a)>=0)return!1;for(var r=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,h=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,l=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,u=PIXI.EarCut.zOrder(r,h,e,i,s),d=PIXI.EarCut.zOrder(l,c,e,i,s),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&PIXI.EarCut.pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&PIXI.EarCut.area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&PIXI.EarCut.pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,p.x,p.y)&&PIXI.EarCut.area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0},PIXI.EarCut.cureLocalIntersections=function(t,e,i){var s=t;do{var n=s.prev,o=s.next.next;PIXI.EarCut.intersects(n,s,s.next,o)&&PIXI.EarCut.locallyInside(n,o)&&PIXI.EarCut.locallyInside(o,n)&&(e.push(n.i/i),e.push(s.i/i),e.push(o.i/i),PIXI.EarCut.removeNode(s),PIXI.EarCut.removeNode(s.next),s=t=o),s=s.next}while(s!==t);return s},PIXI.EarCut.splitEarcut=function(t,e,i,s,n,o){var a=t;do{for(var r=a.next.next;r!==a.prev;){if(a.i!==r.i&&PIXI.EarCut.isValidDiagonal(a,r)){var h=PIXI.EarCut.splitPolygon(a,r);return a=PIXI.EarCut.filterPoints(a,a.next),h=PIXI.EarCut.filterPoints(h,h.next),PIXI.EarCut.earcutLinked(a,e,i,s,n,o),void PIXI.EarCut.earcutLinked(h,e,i,s,n,o)}r=r.next}a=a.next}while(a!==t)},PIXI.EarCut.eliminateHoles=function(t,e,i,s){var n,o,a,r,h,l=[];for(n=0,o=e.length;n<o;n++)a=e[n]*s,r=n<o-1?e[n+1]*s:t.length,(h=PIXI.EarCut.linkedList(t,a,r,s,!1))===h.next&&(h.steiner=!0),l.push(PIXI.EarCut.getLeftmost(h));for(l.sort(compareX),n=0;n<l.length;n++)PIXI.EarCut.eliminateHole(l[n],i),i=PIXI.EarCut.filterPoints(i,i.next);return i},PIXI.EarCut.compareX=function(t,e){return t.x-e.x},PIXI.EarCut.eliminateHole=function(t,e){if(e=PIXI.EarCut.findHoleBridge(t,e)){var i=PIXI.EarCut.splitPolygon(e,t);PIXI.EarCut.filterPoints(i,i.next)}},PIXI.EarCut.findHoleBridge=function(t,e){var i,s=e,n=t.x,o=t.y,a=-1/0;do{if(o<=s.y&&o>=s.next.y){var r=s.x+(o-s.y)*(s.next.x-s.x)/(s.next.y-s.y);r<=n&&r>a&&(a=r,i=s.x<s.next.x?s:s.next)}s=s.next}while(s!==e);if(!i)return null;if(t.x===i.x)return i.prev;var h,l=i,c=1/0;for(s=i.next;s!==l;)n>=s.x&&s.x>=i.x&&PIXI.EarCut.pointInTriangle(o<i.y?n:a,o,i.x,i.y,o<i.y?a:n,o,s.x,s.y)&&((h=Math.abs(o-s.y)/(n-s.x))<c||h===c&&s.x>i.x)&&PIXI.EarCut.locallyInside(s,t)&&(i=s,c=h),s=s.next;return i},PIXI.EarCut.indexCurve=function(t,e,i,s){var n=t;do{null===n.z&&(n.z=PIXI.EarCut.zOrder(n.x,n.y,e,i,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,PIXI.EarCut.sortLinked(n)},PIXI.EarCut.sortLinked=function(t){var e,i,s,n,o,a,r,h,l=1;do{for(i=t,t=null,o=null,a=0;i;){for(a++,s=i,r=0,e=0;e<l&&(r++,s=s.nextZ);e++);for(h=l;r>0||h>0&&s;)0===r?(n=s,s=s.nextZ,h--):0!==h&&s?i.z<=s.z?(n=i,i=i.nextZ,r--):(n=s,s=s.nextZ,h--):(n=i,i=i.nextZ,r--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=s}o.nextZ=null,l*=2}while(a>1);return t},PIXI.EarCut.zOrder=function(t,e,i,s,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1},PIXI.EarCut.getLeftmost=function(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i},PIXI.EarCut.pointInTriangle=function(t,e,i,s,n,o,a,r){return(n-a)*(e-r)-(t-a)*(o-r)>=0&&(t-a)*(s-r)-(i-a)*(e-r)>=0&&(i-a)*(o-r)-(n-a)*(s-r)>=0},PIXI.EarCut.isValidDiagonal=function(t,e){return PIXI.EarCut.equals(t,e)||t.next.i!==e.i&&t.prev.i!==e.i&&!PIXI.EarCut.intersectsPolygon(t,e)&&PIXI.EarCut.locallyInside(t,e)&&PIXI.EarCut.locallyInside(e,t)&&PIXI.EarCut.middleInside(t,e)},PIXI.EarCut.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},PIXI.EarCut.equals=function(t,e){return t.x===e.x&&t.y===e.y},PIXI.EarCut.intersects=function(t,e,i,s){return PIXI.EarCut.area(t,e,i)>0!=PIXI.EarCut.area(t,e,s)>0&&PIXI.EarCut.area(i,s,t)>0!=PIXI.EarCut.area(i,s,e)>0},PIXI.EarCut.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&PIXI.EarCut.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},PIXI.EarCut.locallyInside=function(t,e){return PIXI.EarCut.area(t.prev,t,t.next)<0?PIXI.EarCut.area(t,e,t.next)>=0&&PIXI.EarCut.area(t,t.prev,e)>=0:PIXI.EarCut.area(t,e,t.prev)<0||PIXI.EarCut.area(t,t.next,e)<0},PIXI.EarCut.middleInside=function(t,e){var i=t,s=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s},PIXI.EarCut.splitPolygon=function(t,e){var i=new PIXI.EarCut.Node(t.i,t.x,t.y),s=new PIXI.EarCut.Node(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,s.next=i,i.prev=s,o.next=s,s.prev=o,s},PIXI.EarCut.insertNode=function(t,e,i,s){var n=new PIXI.EarCut.Node(t,e,i);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n},PIXI.EarCut.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},PIXI.EarCut.Node=function(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(t,e){var i,s=e.gl,n=e.projection,o=e.offset,a=e.shaderManager.primitiveShader;t.dirty&&PIXI.WebGLGraphics.updateGraphics(t,s);for(var r=t._webGL[s.id],h=0;h<r.data.length;h++)1===r.data[h].mode?(i=r.data[h],e.stencilManager.pushStencil(t,i,e),s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,2*(i.indices.length-4)),e.stencilManager.popStencil(t,i,e)):(i=r.data[h],e.shaderManager.setShader(a),a=e.shaderManager.primitiveShader,s.uniformMatrix3fv(a.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform1f(a.flipY,1),s.uniform2f(a.projectionVector,n.x,-n.y),s.uniform2f(a.offsetVector,-o.x,-o.y),s.uniform3fv(a.tintColor,PIXI.hex2rgb(t.tint)),s.uniform1f(a.alpha,t.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,i.buffer),s.vertexAttribPointer(a.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(a.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,i.indexBuffer),s.drawElements(s.TRIANGLE_STRIP,i.indices.length,s.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(t,e){var i,s,n=t._webGL[e.id];if(n||(n=t._webGL[e.id]={lastIndex:0,data:[],gl:e}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,i=0;i<n.data.length;i++){var o=n.data[i];o.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(o)}n.data=[],n.lastIndex=0}for(i=n.lastIndex;i<t.graphicsData.length;i++){var a=t.graphicsData[i];if(a.type===PIXI.Graphics.POLY){if(a.points=a.shape.points.slice(),a.shape.closed&&(a.points[0]===a.points[a.points.length-2]&&a.points[1]===a.points[a.points.length-1]||a.points.push(a.points[0],a.points[1])),a.fill&&a.points.length>=PIXI.WebGLGraphics.stencilBufferLimit)if(a.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit){s=PIXI.WebGLGraphics.switchMode(n,0),PIXI.WebGLGraphics.buildPoly(a,s)||(s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(a,s))}else s=PIXI.WebGLGraphics.switchMode(n,1),PIXI.WebGLGraphics.buildComplexPoly(a,s);a.lineWidth>0&&(s=PIXI.WebGLGraphics.switchMode(n,0),PIXI.WebGLGraphics.buildLine(a,s))}else s=PIXI.WebGLGraphics.switchMode(n,0),a.type===PIXI.Graphics.RECT?PIXI.WebGLGraphics.buildRectangle(a,s):a.type===PIXI.Graphics.CIRC||a.type===PIXI.Graphics.ELIP?PIXI.WebGLGraphics.buildCircle(a,s):a.type===PIXI.Graphics.RREC&&PIXI.WebGLGraphics.buildRoundedRectangle(a,s);n.lastIndex++}for(i=0;i<n.data.length;i++)(s=n.data[i]).dirty&&s.upload()},PIXI.WebGLGraphics.switchMode=function(t,e){var i;return t.data.length?(i=t.data[t.data.length-1]).mode===e&&1!==e||((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)):((i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl)).mode=e,t.data.push(i)),i.dirty=!0,i},PIXI.WebGLGraphics.buildRectangle=function(t,e){var i=t.shape,s=i.x,n=i.y,o=i.width,a=i.height;if(t.fill){var r=PIXI.hex2rgb(t.fillColor),h=t.fillAlpha,l=r[0]*h,c=r[1]*h,u=r[2]*h,d=e.points,p=e.indices,f=d.length/6;d.push(s,n),d.push(l,c,u,h),d.push(s+o,n),d.push(l,c,u,h),d.push(s,n+a),d.push(l,c,u,h),d.push(s+o,n+a),d.push(l,c,u,h),p.push(f,f,f+1,f+2,f+3,f+3)}if(t.lineWidth){var y=t.points;t.points=[s,n,s+o,n,s+o,n+a,s,n+a,s,n],PIXI.WebGLGraphics.buildLine(t,e),t.points=y}},PIXI.WebGLGraphics.buildRoundedRectangle=function(t,e){var i=t.shape,s=i.x,n=i.y,o=i.width,a=i.height,r=i.radius,h=[];if(h.push(s,n+r),h=(h=(h=(h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s,n+a-r,s,n+a,s+r,n+a))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+o-r,n+a,s+o,n+a,s+o,n+a-r))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+o,n+r,s+o,n,s+o-r,n))).concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+r,n,s,n,s,n+r)),t.fill){var l=PIXI.hex2rgb(t.fillColor),c=t.fillAlpha,u=l[0]*c,d=l[1]*c,p=l[2]*c,f=e.points,y=e.indices,g=f.length/6,m=PIXI.EarCut.Triangulate(h,null,2),v=0;for(v=0;v<m.length;v+=3)y.push(m[v]+g),y.push(m[v]+g),y.push(m[v+1]+g),y.push(m[v+2]+g),y.push(m[v+2]+g);for(v=0;v<h.length;v++)f.push(h[v],h[++v],u,d,p,c)}if(t.lineWidth){var b=t.points;t.points=h,PIXI.WebGLGraphics.buildLine(t,e),t.points=b}},PIXI.WebGLGraphics.quadraticBezierCurve=function(t,e,i,s,n,o){function a(t,e,i){return t+(e-t)*i}for(var r,h,l,c,u,d,p=[],f=0,y=0;y<=20;y++)r=a(t,i,f=y/20),h=a(e,s,f),l=a(i,n,f),c=a(s,o,f),u=a(r,l,f),d=a(h,c,f),p.push(u,d);return p},PIXI.WebGLGraphics.buildCircle=function(t,e){var i,s,n=t.shape,o=n.x,a=n.y;t.type===PIXI.Graphics.CIRC?(i=n.radius,s=n.radius):(i=n.width,s=n.height);var r=2*Math.PI/40,h=0;if(t.fill){var l=PIXI.hex2rgb(t.fillColor),c=t.fillAlpha,u=l[0]*c,d=l[1]*c,p=l[2]*c,f=e.points,y=e.indices,g=f.length/6;for(y.push(g),h=0;h<41;h++)f.push(o,a,u,d,p,c),f.push(o+Math.sin(r*h)*i,a+Math.cos(r*h)*s,u,d,p,c),y.push(g++,g++);y.push(g-1)}if(t.lineWidth){var m=t.points;for(t.points=[],h=0;h<41;h++)t.points.push(o+Math.sin(r*h)*i,a+Math.cos(r*h)*s);PIXI.WebGLGraphics.buildLine(t,e),t.points=m}},PIXI.WebGLGraphics.buildLine=function(t,e){var i=0,s=t.points;if(0!==s.length){if(t.lineWidth%2)for(i=0;i<s.length;i++)s[i]+=.5;var n=new PIXI.Point(s[0],s[1]),o=new PIXI.Point(s[s.length-2],s[s.length-1]);if(n.x===o.x&&n.y===o.y){(s=s.slice()).pop(),s.pop();var a=(o=new PIXI.Point(s[s.length-2],s[s.length-1])).x+.5*(n.x-o.x),r=o.y+.5*(n.y-o.y);s.unshift(a,r),s.push(a,r)}var h,l,c,u,d,p,f,y,g,m,v,b,x,_,w,P,C,T,S,A,E,I,M=e.points,O=e.indices,R=s.length/2,B=s.length,L=M.length/6,D=t.lineWidth/2,k=PIXI.hex2rgb(t.lineColor),F=t.lineAlpha,G=k[0]*F,U=k[1]*F,N=k[2]*F;for(c=s[0],u=s[1],d=s[2],g=-(u-(p=s[3])),m=c-d,g/=I=Math.sqrt(g*g+m*m),m/=I,g*=D,m*=D,M.push(c-g,u-m,G,U,N,F),M.push(c+g,u+m,G,U,N,F),i=1;i<R-1;i++)c=s[2*(i-1)],u=s[2*(i-1)+1],d=s[2*i],p=s[2*i+1],f=s[2*(i+1)],y=s[2*(i+1)+1],g=-(u-p),m=c-d,g/=I=Math.sqrt(g*g+m*m),m/=I,g*=D,m*=D,v=-(p-y),b=d-f,v/=I=Math.sqrt(v*v+b*b),b/=I,C=(-g+c)*(-m+p)-(-g+d)*(-m+u),A=(-(v*=D)+f)*(-(b*=D)+p)-(-v+d)*(-b+y),E=(w=-m+u-(-m+p))*(S=-v+d-(-v+f))-(T=-b+y-(-b+p))*(P=-g+d-(-g+c)),Math.abs(E)<.1?(E+=10.1,M.push(d-g,p-m,G,U,N,F),M.push(d+g,p+m,G,U,N,F)):((h=(P*A-S*C)/E)-d)*(h-d)+((l=(T*C-w*A)/E)-p)+(l-p)>19600?(x=g-v,_=m-b,x/=I=Math.sqrt(x*x+_*_),_/=I,x*=D,_*=D,M.push(d-x,p-_),M.push(G,U,N,F),M.push(d+x,p+_),M.push(G,U,N,F),M.push(d-x,p-_),M.push(G,U,N,F),B++):(M.push(h,l),M.push(G,U,N,F),M.push(d-(h-d),p-(l-p)),M.push(G,U,N,F));for(c=s[2*(R-2)],u=s[2*(R-2)+1],d=s[2*(R-1)],g=-(u-(p=s[2*(R-1)+1])),m=c-d,g/=I=Math.sqrt(g*g+m*m),m/=I,g*=D,m*=D,M.push(d-g,p-m),M.push(G,U,N,F),M.push(d+g,p+m),M.push(G,U,N,F),O.push(L),i=0;i<B;i++)O.push(L++);O.push(L-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(t,e){var i=t.points.slice();if(!(i.length<6)){var s=e.indices;e.points=i,e.alpha=t.fillAlpha,e.color=PIXI.hex2rgb(t.fillColor);for(var n,o,a=1/0,r=-1/0,h=1/0,l=-1/0,c=0;c<i.length;c+=2)a=(n=i[c])<a?n:a,r=n>r?n:r,h=(o=i[c+1])<h?o:h,l=o>l?o:l;i.push(a,h,r,h,r,l,a,l);var u=i.length/2;for(c=0;c<u;c++)s.push(c)}},PIXI.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(!(i.length<6)){var s=e.points,n=e.indices,o=i.length/2,a=PIXI.hex2rgb(t.fillColor),r=t.fillAlpha,h=a[0]*r,l=a[1]*r,c=a[2]*r,u=PIXI.EarCut.Triangulate(i,null,2);if(!u)return!1;var d=s.length/6,p=0;for(p=0;p<u.length;p+=3)n.push(u[p]+d),n.push(u[p]+d),n.push(u[p+1]+d),n.push(u[p+2]+d),n.push(u[p+2]+d);for(p=0;p<o;p++)s.push(i[2*p],i[2*p+1],h,l,c,r);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new PIXI.Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new PIXI.Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(t,e){var i=t.worldAlpha;t.dirty&&(this.updateGraphicsTint(t),t.dirty=!1);for(var s=0;s<t.graphicsData.length;s++){var n=t.graphicsData[s],o=n.shape,a=n._fillTint,r=n._lineTint;if(e.lineWidth=n.lineWidth,n.type===PIXI.Graphics.POLY){e.beginPath();var h=o.points;e.moveTo(h[0],h[1]);for(var l=1;l<h.length/2;l++)e.lineTo(h[2*l],h[2*l+1]);o.closed&&e.lineTo(h[0],h[1]),h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&e.closePath(),n.fill&&(e.globalAlpha=n.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),n.lineWidth&&(e.globalAlpha=n.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|r).toString(16)).substr(-6),e.stroke())}else if(n.type===PIXI.Graphics.RECT)(n.fillColor||0===n.fillColor)&&(e.globalAlpha=n.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fillRect(o.x,o.y,o.width,o.height)),n.lineWidth&&(e.globalAlpha=n.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|r).toString(16)).substr(-6),e.strokeRect(o.x,o.y,o.width,o.height));else if(n.type===PIXI.Graphics.CIRC)e.beginPath(),e.arc(o.x,o.y,o.radius,0,2*Math.PI),e.closePath(),n.fill&&(e.globalAlpha=n.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),n.lineWidth&&(e.globalAlpha=n.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|r).toString(16)).substr(-6),e.stroke());else if(n.type===PIXI.Graphics.ELIP){var c=2*o.width,u=2*o.height,d=o.x-c/2,p=o.y-u/2;e.beginPath();var f=.5522848,y=c/2*f,g=u/2*f,m=d+c,v=p+u,b=d+c/2,x=p+u/2;e.moveTo(d,x),e.bezierCurveTo(d,x-g,b-y,p,b,p),e.bezierCurveTo(b+y,p,m,x-g,m,x),e.bezierCurveTo(m,x+g,b+y,v,b,v),e.bezierCurveTo(b-y,v,d,x+g,d,x),e.closePath(),n.fill&&(e.globalAlpha=n.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),n.lineWidth&&(e.globalAlpha=n.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|r).toString(16)).substr(-6),e.stroke())}else if(n.type===PIXI.Graphics.RREC){var _=o.x,w=o.y,P=o.width,C=o.height,T=o.radius,S=Math.min(P,C)/2|0;T=T>S?S:T,e.beginPath(),e.moveTo(_,w+T),e.lineTo(_,w+C-T),e.quadraticCurveTo(_,w+C,_+T,w+C),e.lineTo(_+P-T,w+C),e.quadraticCurveTo(_+P,w+C,_+P,w+C-T),e.lineTo(_+P,w+T),e.quadraticCurveTo(_+P,w,_+P-T,w),e.lineTo(_+T,w),e.quadraticCurveTo(_,w,_,w+T),e.closePath(),(n.fillColor||0===n.fillColor)&&(e.globalAlpha=n.fillAlpha*i,e.fillStyle="#"+("00000"+(0|a).toString(16)).substr(-6),e.fill()),n.lineWidth&&(e.globalAlpha=n.lineAlpha*i,e.strokeStyle="#"+("00000"+(0|r).toString(16)).substr(-6),e.stroke())}}},PIXI.CanvasGraphics.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(0!==i){e.beginPath();for(var s=0;s<i;s++){var n=t.graphicsData[s],o=n.shape;if(n.type===PIXI.Graphics.POLY){var a=o.points;e.moveTo(a[0],a[1]);for(var r=1;r<a.length/2;r++)e.lineTo(a[2*r],a[2*r+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(n.type===PIXI.Graphics.RECT)e.rect(o.x,o.y,o.width,o.height),e.closePath();else if(n.type===PIXI.Graphics.CIRC)e.arc(o.x,o.y,o.radius,0,2*Math.PI),e.closePath();else if(n.type===PIXI.Graphics.ELIP){var h=2*o.width,l=2*o.height,c=o.x-h/2,u=o.y-l/2,d=.5522848,p=h/2*d,f=l/2*d,y=c+h,g=u+l,m=c+h/2,v=u+l/2;e.moveTo(c,v),e.bezierCurveTo(c,v-f,m-p,u,m,u),e.bezierCurveTo(m+p,u,y,v-f,y,v),e.bezierCurveTo(y,v+f,m+p,g,m,g),e.bezierCurveTo(m-p,g,c,v+f,c,v),e.closePath()}else if(n.type===PIXI.Graphics.RREC){var b=o.x,x=o.y,_=o.width,w=o.height,P=o.radius,C=Math.min(_,w)/2|0;P=P>C?C:P,e.moveTo(b,x+P),e.lineTo(b,x+w-P),e.quadraticCurveTo(b,x+w,b+P,x+w),e.lineTo(b+_-P,x+w),e.quadraticCurveTo(b+_,x+w,b+_,x+w-P),e.lineTo(b+_,x+P),e.quadraticCurveTo(b+_,x,b+_-P,x),e.lineTo(b+P,x),e.quadraticCurveTo(b,x,b,x+P),e.closePath()}}}},PIXI.CanvasGraphics.updateGraphicsTint=function(t){if(16777215!==t.tint)for(var e=(t.tint>>16&255)/255,i=(t.tint>>8&255)/255,s=(255&t.tint)/255,n=0;n<t.graphicsData.length;n++){var o=t.graphicsData[n],a=0|o.fillColor,r=0|o.lineColor;o._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(255&a)/255*s*255,o._lineTint=((r>>16&255)/255*e*255<<16)+((r>>8&255)/255*i*255<<8)+(255&r)/255*s*255}},n.Graphics=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.type=n.GRAPHICS,this.physicsType=n.SPRITE,this.anchor=new n.Point,PIXI.Graphics.call(this),n.Component.Core.init.call(this,t,e,i,"",null)},n.Graphics.prototype=Object.create(PIXI.Graphics.prototype),n.Graphics.prototype.constructor=n.Graphics,n.Component.Core.install.call(n.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),n.Graphics.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.Graphics.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.Graphics.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Graphics.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Graphics.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},n.Graphics.prototype.postUpdate=function(){n.Component.PhysicsBody.postUpdate.call(this),n.Component.FixedToCamera.postUpdate.call(this),this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1);for(var t=0;t<this.children.length;t++)this.children[t].postUpdate()},n.Graphics.prototype.destroy=function(t){this.clear(),n.Component.Destroy.prototype.destroy.call(this,t)},n.Graphics.prototype.drawTriangle=function(t,e){void 0===e&&(e=!1);var i=new n.Polygon(t);if(e){var s=new n.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),o=new n.Point(t[1].x-t[0].x,t[1].y-t[0].y),a=new n.Point(t[1].x-t[2].x,t[1].y-t[2].y).cross(o);s.dot(a)>0&&this.drawPolygon(i)}else this.drawPolygon(i)},n.Graphics.prototype.drawTriangles=function(t,e,i){void 0===i&&(i=!1);var s,o=new n.Point,a=new n.Point,r=new n.Point,h=[];if(e)if(t[0]instanceof n.Point)for(s=0;s<e.length/3;s++)h.push(t[e[3*s]]),h.push(t[e[3*s+1]]),h.push(t[e[3*s+2]]),3===h.length&&(this.drawTriangle(h,i),h=[]);else for(s=0;s<e.length;s++)o.x=t[2*e[s]],o.y=t[2*e[s]+1],h.push(o.copyTo({})),3===h.length&&(this.drawTriangle(h,i),h=[]);else if(t[0]instanceof n.Point)for(s=0;s<t.length/3;s++)this.drawTriangle([t[3*s],t[3*s+1],t[3*s+2]],i);else for(s=0;s<t.length/6;s++)o.x=t[6*s+0],o.y=t[6*s+1],a.x=t[6*s+2],a.y=t[6*s+3],r.x=t[6*s+4],r.y=t[6*s+5],this.drawTriangle([o,a,r],i)},n.RenderTexture=function(t,e,i,s,o,a){void 0===s&&(s=""),void 0===o&&(o=n.scaleModes.DEFAULT),void 0===a&&(a=1),this.game=t,this.key=s,this.type=n.RENDERTEXTURE,this._tempMatrix=new PIXI.Matrix,PIXI.RenderTexture.call(this,e,i,this.game.renderer,o,a),this.render=n.RenderTexture.prototype.render},n.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),n.RenderTexture.prototype.constructor=n.RenderTexture,n.RenderTexture.prototype.renderXY=function(t,e,i,s){t.updateTransform(),this._tempMatrix.copyFrom(t.worldTransform),this._tempMatrix.tx=e,this._tempMatrix.ty=i,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,s):this.renderCanvas(t,this._tempMatrix,s)},n.RenderTexture.prototype.renderRawXY=function(t,e,i,s){this._tempMatrix.identity().translate(e,i),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,s):this.renderCanvas(t,this._tempMatrix,s)},n.RenderTexture.prototype.render=function(t,e,i){null==e?this._tempMatrix.copyFrom(t.worldTransform):this._tempMatrix.copyFrom(e),this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this._tempMatrix,i):this.renderCanvas(t,this._tempMatrix,i)},n.Text=function(t,e,i,s,o){e=e||0,i=i||0,s=null==s?"":s.toString(),o=n.Utils.extend({},o),this.type=n.TEXT,this.physicsType=n.SPRITE,this.padding=new n.Point,this.textBounds=null,this.canvas=PIXI.CanvasPool.create(this),this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this._res=t.renderer.resolution,this._text=s,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this._width=0,this._height=0,n.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas)),this.setStyle(o),""!==s&&this.updateText()},n.Text.prototype=Object.create(n.Sprite.prototype),n.Text.prototype.constructor=n.Text,n.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},n.Text.prototype.update=function(){},n.Text.prototype.destroy=function(t){this.texture.destroy(!0),n.Component.Destroy.prototype.destroy.call(this,t)},n.Text.prototype.setShadow=function(t,e,i,s,n,o){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="rgba(0, 0, 0, 1)"),void 0===s&&(s=0),void 0===n&&(n=!0),void 0===o&&(o=!0),this.style.shadowOffsetX=t,this.style.shadowOffsetY=e,this.style.shadowColor=i,this.style.shadowBlur=s,this.style.shadowStroke=n,this.style.shadowFill=o,this.dirty=!0,this},n.Text.prototype.setStyle=function(t,e){void 0===e&&(e=!1),(t=t||{}).font=t.font||"bold 20pt Arial",t.backgroundColor=t.backgroundColor||null,t.fill=t.fill||"black",t.align=t.align||"left",t.boundsAlignH=t.boundsAlignH||"left",t.boundsAlignV=t.boundsAlignV||"top",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.maxLines=t.maxLines||0,t.shadowOffsetX=t.shadowOffsetX||0,t.shadowOffsetY=t.shadowOffsetY||0,t.shadowColor=t.shadowColor||"rgba(0,0,0,0)",t.shadowBlur=t.shadowBlur||0,t.tabs=t.tabs||0;var i=this.fontToComponents(t.font);return t.fontStyle&&(i.fontStyle=t.fontStyle),t.fontVariant&&(i.fontVariant=t.fontVariant),t.fontWeight&&(i.fontWeight=t.fontWeight),t.fontSize&&("number"==typeof t.fontSize&&(t.fontSize=t.fontSize+"px"),i.fontSize=t.fontSize),this._fontComponents=i,t.font=this.componentsToFont(this._fontComponents),this.style=t,this.dirty=!0,e&&this.updateText(),this},n.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.runWordWrap(this.text));var e=t.split(/(?:\r\n|\r|\n)/),i=this.style.tabs,s=[],n=0,o=this.determineFontProperties(this.style.font),a=e.length;this.style.maxLines>0&&this.style.maxLines<e.length&&(a=this.style.maxLines),this._charCount=0;for(var r=0;r<a;r++){if(0===i){var h=this.style.strokeThickness+this.padding.x;this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(e[r]):h+=this.context.measureText(e[r]).width,this.style.wordWrap&&(h-=this.context.measureText(" ").width)}else{var l=e[r].split(/(?:\t)/);h=this.padding.x+this.style.strokeThickness;if(Array.isArray(i))for(var c=0,u=0;u<l.length;u++){var d;d=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(l[u]):Math.ceil(this.context.measureText(l[u]).width),u>0&&(c+=i[u-1]),h=c+d}else for(u=0;u<l.length;u++){this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(l[u]):h+=Math.ceil(this.context.measureText(l[u]).width),h+=this.game.math.snapToCeil(h,i)-h}}s[r]=Math.ceil(h),n=Math.max(n,s[r])}this.canvas.width=n*this._res;var p,f,y=o.fontSize+this.style.strokeThickness+this.padding.y,g=y*a,m=this._lineSpacing;for(m<0&&Math.abs(m)>y&&(m=-y),0!==m&&(g+=m>0?m*e.length:m*(e.length-1)),this.canvas.height=g*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0,r=0;r<a;r++)p=this.style.strokeThickness/2,f=this.style.strokeThickness/2+r*y+o.ascent,r>0&&(f+=m*r),"right"===this.style.align?p+=n-s[r]:"center"===this.style.align&&(p+=(n-s[r])/2),this.autoRound&&(p=Math.round(p),f=Math.round(f)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(e[r],p,f):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===i?this.context.strokeText(e[r],p,f):this.renderTabLine(e[r],p,f,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===i?this.context.fillText(e[r],p,f):this.renderTabLine(e[r],p,f,!0)));this.updateTexture(),this.dirty=!1},n.Text.prototype.renderTabLine=function(t,e,i,s){var n=t.split(/(?:\t)/),o=this.style.tabs,a=0;if(Array.isArray(o))for(var r=0,h=0;h<n.length;h++)h>0&&(r+=o[h-1]),a=e+r,s?this.context.fillText(n[h],a,i):this.context.strokeText(n[h],a,i);else for(h=0;h<n.length;h++){var l=Math.ceil(this.context.measureText(n[h]).width);a=this.game.math.snapToCeil(e,o),s?this.context.fillText(n[h],a,i):this.context.strokeText(n[h],a,i),e=a+l}},n.Text.prototype.updateShadow=function(t){t?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},n.Text.prototype.measureLine=function(t){for(var e=0,i=0;i<t.length;i++){var s=t[i];if(this.fontWeights.length>0||this.fontStyles.length>0){var n=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(n.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(n.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(n)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill)),e+=this.context.measureText(s).width,this._charCount++}return Math.ceil(e)},n.Text.prototype.updateLine=function(t,e,i){for(var s=0;s<t.length;s++){var n=t[s];if(this.fontWeights.length>0||this.fontStyles.length>0){var o=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(o.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(o.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(o)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(n,e,i)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(n,e,i)),e+=this.context.measureText(n).width,this._charCount++}},n.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},n.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},n.Text.prototype.addColor=function(t,e){return this.colors[e]=t,this.dirty=!0,this},n.Text.prototype.addStrokeColor=function(t,e){return this.strokeColors[e]=t,this.dirty=!0,this},n.Text.prototype.addFontStyle=function(t,e){return this.fontStyles[e]=t,this.dirty=!0,this},n.Text.prototype.addFontWeight=function(t,e){return this.fontWeights[e]=t,this.dirty=!0,this},n.Text.prototype.precalculateWordWrap=function(t){return this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font,this.runWordWrap(t).split(/(?:\r\n|\r|\n)/)},n.Text.prototype.runWordWrap=function(t){return this.useAdvancedWrap?this.advancedWordWrap(t):this.basicWordWrap(t)},n.Text.prototype.advancedWordWrap=function(t){for(var e=this.context,i=this.style.wordWrapWidth,s="",n=t.replace(/ +/gi," ").split(/\r?\n/gi),o=n.length,a=0;a<o;a++){var r=n[a],h="";if(r=r.replace(/^ *|\s*$/gi,""),e.measureText(r).width<i)s+=r+"\n";else{for(var l=i,c=r.split(" "),u=0;u<c.length;u++){var d=c[u],p=d+" ",f=e.measureText(p).width;if(f>l){if(0===u){for(var y=p;y.length&&(y=y.slice(0,-1),!((f=e.measureText(y).width)<=l)););if(!y.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var g=d.substr(y.length);c[u]=g,h+=y}var m=c[u].length?u:u+1,v=c.slice(m).join(" ").replace(/[ \n]*$/gi,"");n[a+1]=v+" "+(n[a+1]||""),o=n.length;break}h+=p,l-=f}s+=h.replace(/[ \n]*$/gi,"")+"\n"}}return s.replace(/[\s|\n]*$/gi,"")},n.Text.prototype.basicWordWrap=function(t){for(var e="",i=t.split("\n"),s=0;s<i.length;s++){for(var n=this.style.wordWrapWidth,o=i[s].split(" "),a=0;a<o.length;a++){var r=this.context.measureText(o[a]).width,h=r+this.context.measureText(" ").width;h>n?(a>0&&(e+="\n"),e+=o[a]+" ",n=this.style.wordWrapWidth-r):(n-=h,e+=o[a]+" ")}s<i.length-1&&(e+="\n")}return e},n.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);this.style.font!==e&&(this.style.font=e,this.dirty=!0,this.parent&&this.updateTransform())},n.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();return/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)||/['",]/.exec(i)||(i="'"+i+"'"),{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}return{font:t}},n.Text.prototype.componentsToFont=function(t){var e,i=[];return(e=t.fontStyle)&&"normal"!==e&&i.push(e),(e=t.fontVariant)&&"normal"!==e&&i.push(e),(e=t.fontWeight)&&"normal"!==e&&i.push(e),(e=t.fontSize)&&"medium"!==e&&i.push(e),(e=t.fontFamily)&&i.push(e),i.length||i.push(t.font),i.join(" ")},n.Text.prototype.setText=function(t,e){return void 0===e&&(e=!1),this.text=t.toString()||"",e?this.updateText():this.dirty=!0,this},n.Text.prototype.parseList=function(t){if(!Array.isArray(t))return this;for(var e="",i=0;i<t.length;i++)Array.isArray(t[i])?(e+=t[i].join("\t"),i<t.length-1&&(e+="\n")):(e+=t[i],i<t.length-1&&(e+="\t"));return this.text=e,this.dirty=!0,this},n.Text.prototype.setTextBounds=function(t,e,i,s){return void 0===t?this.textBounds=null:(this.textBounds?this.textBounds.setTo(t,e,i,s):this.textBounds=new n.Rectangle(t,e,i,s),this.style.wordWrapWidth>i&&(this.style.wordWrapWidth=i)),this.updateTexture(),this},n.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture,e=this.texture.crop,i=this.texture.frame,s=this.canvas.width,n=this.canvas.height;if(t.width=s,t.height=n,e.width=s,e.height=n,i.width=s,i.height=n,this.texture.width=s,this.texture.height=n,this._width=s,this._height=n,this.textBounds){var o=this.textBounds.x,a=this.textBounds.y;"right"===this.style.boundsAlignH?o+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(o+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?a+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(a+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-o,this.pivot.y=-a}this.renderable=0!==s&&0!==n,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},n.Text.prototype._renderWebGL=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,t)},n.Text.prototype._renderCanvas=function(t){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,t)},n.Text.prototype.determineFontProperties=function(t){var e=n.Text.fontPropertiesCache[t];if(!e){e={};var i=n.Text.fontPropertiesCanvas,s=n.Text.fontPropertiesContext;s.font=t;var o=Math.ceil(s.measureText("|MÉq").width),a=Math.ceil(s.measureText("|MÉq").width),r=2*a;if(a=1.4*a|0,i.width=o,i.height=r,s.fillStyle="#f00",s.fillRect(0,0,o,r),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText("|MÉq",0,a),!s.getImageData(0,0,o,r))return e.ascent=a,e.descent=a+6,e.fontSize=e.ascent+e.descent,n.Text.fontPropertiesCache[t]=e,e;var h,l,c=s.getImageData(0,0,o,r).data,u=c.length,d=4*o,p=0,f=!1;for(h=0;h<a;h++){for(l=0;l<d;l+=4)if(255!==c[p+l]){f=!0;break}if(f)break;p+=d}for(e.ascent=a-h,p=u-d,f=!1,h=r;h>a;h--){for(l=0;l<d;l+=4)if(255!==c[p+l]){f=!0;break}if(f)break;p-=d}e.descent=h-a,e.descent+=6,e.fontSize=e.ascent+e.descent,n.Text.fontPropertiesCache[t]=e}return e},n.Text.prototype.getBounds=function(t){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,t)},Object.defineProperty(n.Text.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(n.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial",this._fontComponents=this.fontToComponents(t),this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=(t=t||"Arial").trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),this._fontComponents.fontFamily=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;return t&&/(?:^0$|px$)/.exec(t)?parseInt(t,10):t},set:function(t){"number"==typeof(t=t||"0")&&(t+="px"),this._fontComponents.fontSize=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontWeight=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontStyle=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal",this._fontComponents.fontVariant=t,this.updateFont(this._fontComponents)}}),Object.defineProperty(n.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){t!==this.style.fill&&(this.style.fill=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){t!==this.style.align&&(this.style.align=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){t!==this._res&&(this._res=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){t!==this.style.tabs&&(this.style.tabs=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){t!==this.style.boundsAlignH&&(this.style.boundsAlignH=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){t!==this.style.boundsAlignV&&(this.style.boundsAlignV=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){t!==this.style.stroke&&(this.style.stroke=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){t!==this.style.strokeThickness&&(this.style.strokeThickness=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){t!==this.style.wordWrap&&(this.style.wordWrap=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){t!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){t!==this._lineSpacing&&(this._lineSpacing=parseFloat(t),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(n.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){t!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){t!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){t!==this.style.shadowColor&&(this.style.shadowColor=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){t!==this.style.shadowBlur&&(this.style.shadowBlur=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){t!==this.style.shadowStroke&&(this.style.shadowStroke=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){t!==this.style.shadowFill&&(this.style.shadowFill=t,this.dirty=!0)}}),Object.defineProperty(n.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(n.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),n.Text.fontPropertiesCache={},n.Text.fontPropertiesCanvas=document.createElement("canvas"),n.Text.fontPropertiesContext=n.Text.fontPropertiesCanvas.getContext("2d"),n.BitmapText=function(t,e,i,s,o,a,r){e=e||0,i=i||0,s=s||"",o=o||"",a=a||32,r=r||"left",PIXI.DisplayObjectContainer.call(this),this.type=n.BITMAPTEXT,this.physicsType=n.SPRITE,this.textWidth=0,this.textHeight=0,this.anchor=new n.Point,this._prevAnchor=new n.Point,this._glyphs=[],this._maxWidth=0,this._text=o.toString()||"",this._data=t.cache.getBitmapFont(s),this._font=s,this._fontSize=a,this._align=r,this._tint=16777215,this.updateText(),this.dirty=!1,n.Component.Core.init.call(this,t,e,i,"",null)},n.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),n.BitmapText.prototype.constructor=n.BitmapText,n.Component.Core.install.call(n.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),n.BitmapText.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.BitmapText.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.BitmapText.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.BitmapText.prototype.preUpdateCore=n.Component.Core.preUpdate,n.BitmapText.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},n.BitmapText.prototype.postUpdate=function(){n.Component.PhysicsBody.postUpdate.call(this),n.Component.FixedToCamera.postUpdate.call(this),this.body&&this.body.type===n.Physics.ARCADE&&(this.textWidth===this.body.sourceWidth&&this.textHeight===this.body.sourceHeight||this.body.setSize(this.textWidth,this.textHeight))},n.BitmapText.prototype.setText=function(t){this.text=t},n.BitmapText.prototype.scanLine=function(t,e,i){for(var s=0,n=0,o=-1,a=0,r=null,h=this._maxWidth>0?this._maxWidth:null,l=[],c=0;c<i.length;c++){var u=c===i.length-1;if(/(?:\r\n|\r|\n)/.test(i.charAt(c)))return{width:n,text:i.substr(0,c),end:u,chars:l};var d,p=i.charCodeAt(c),f=t.chars[p];void 0===f&&(p=32,f=t.chars[p]);var y=r&&f.kerning[r]?f.kerning[r]:0;if(/(\s)/.test(i.charAt(c))&&(o=c,a=n),d=(y+f.texture.width+f.xOffset)*e,h&&n+d>=h&&o>-1)return{width:a||n,text:i.substr(0,c-(c-o)),end:u,chars:l};n+=(f.xAdvance+y)*e,l.push(s+(f.xOffset+y)*e),s+=(f.xAdvance+y)*e,r=p}return{width:n,text:i,end:u,chars:l}},n.BitmapText.prototype.cleanText=function(t,e){void 0===e&&(e="");var i=this._data.font;if(!i)return"";for(var s=t.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),n=0;n<s.length;n++){for(var o="",a=s[n],r=0;r<a.length;r++)o=i.chars[a.charCodeAt(r)]?o.concat(a[r]):o.concat(e);s[n]=o}return s.join("\n")},n.BitmapText.prototype.updateText=function(){var t=this._data.font;if(t){var e=this.text,i=this._fontSize/t.size,s=[],n=0;this.textWidth=0;do{(c=this.scanLine(t,i,e)).y=n,s.push(c),c.width>this.textWidth&&(this.textWidth=c.width),n+=t.lineHeight*i,e=e.substr(c.text.length+1)}while(!1===c.end);this.textHeight=n;for(var o=0,a=0,r=this.textWidth*this.anchor.x,h=this.textHeight*this.anchor.y,l=0;l<s.length;l++){var c=s[l];"right"===this._align?a=this.textWidth-c.width:"center"===this._align&&(a=(this.textWidth-c.width)/2);for(var u=0;u<c.text.length;u++){var d=c.text.charCodeAt(u),p=t.chars[d];void 0===p&&(d=32,p=t.chars[d]);var f=this._glyphs[o];f?f.texture=p.texture:((f=new PIXI.Sprite(p.texture)).name=c.text[u],this._glyphs.push(f)),f.position.x=c.chars[u]+a-r,f.position.y=c.y+p.yOffset*i-h,f.scale.set(i),f.tint=this.tint,f.texture.requiresReTint=!0,f.parent||this.addChild(f),o++}}for(l=o;l<this._glyphs.length;l++)this.removeChild(this._glyphs[l])}},n.BitmapText.prototype.purgeGlyphs=function(){for(var t=this._glyphs.length,e=[],i=0;i<this._glyphs.length;i++)this._glyphs[i].parent!==this?this._glyphs[i].destroy():e.push(this._glyphs[i]);return this._glyphs=[],this._glyphs=e,this.updateText(),t-e.length},n.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor)),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(n.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){t===this._align||"left"!==t&&"center"!==t&&"right"!==t||(this._align=t,this.updateText())}}),Object.defineProperty(n.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this.updateText())}}),Object.defineProperty(n.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){t!==this._font&&(this._font=t.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(n.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){(t=parseInt(t,10))!==this._fontSize&&t>0&&(this._fontSize=t,this.updateText())}}),Object.defineProperty(n.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||"",this.updateText())}}),Object.defineProperty(n.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){t!==this._maxWidth&&(this._maxWidth=t,this.updateText())}}),Object.defineProperty(n.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(t){this._data.base.scaleMode=t?0:1}}),n.RetroFont=function(t,e,i,s,o,a,r,h,l,c){if(!t.cache.checkImageKey(e))return!1;null!=a||(a=t.cache.getImage(e).width/i),this.characterWidth=i,this.characterHeight=s,this.characterSpacingX=r||0,this.characterSpacingY=h||0,this.characterPerRow=a,this.offsetX=l||0,this.offsetY=c||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=t.cache.getImage(e),this._text="",this.grabData=[],this.frameData=new n.FrameData;for(var u=this.offsetX,d=this.offsetY,p=0,f=0;f<o.length;f++){var y=this.frameData.addFrame(new n.Frame(f,u,d,this.characterWidth,this.characterHeight));this.grabData[o.charCodeAt(f)]=y.index,++p===this.characterPerRow?(p=0,u=this.offsetX,d+=this.characterHeight+this.characterSpacingY):u+=this.characterWidth+this.characterSpacingX}t.cache.updateFrameData(e,this.frameData),this.stamp=new n.Image(t,0,0,e,0),n.RenderTexture.call(this,t,100,100,"",n.scaleModes.NEAREST),this.type=n.RETROFONT},n.RetroFont.prototype=Object.create(n.RenderTexture.prototype),n.RetroFont.prototype.constructor=n.RetroFont,n.RetroFont.ALIGN_LEFT="left",n.RetroFont.ALIGN_RIGHT="right",n.RetroFont.ALIGN_CENTER="center",n.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",n.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",n.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",n.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",n.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",n.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",n.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",n.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",n.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",n.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",n.RetroFont.prototype.setFixedWidth=function(t,e){void 0===e&&(e="left"),this.fixedWidth=t,this.align=e},n.RetroFont.prototype.setText=function(t,e,i,s,n,o){this.multiLine=e||!1,this.customSpacingX=i||0,this.customSpacingY=s||0,this.align=n||"left",this.autoUpperCase=!o,t.length>0&&(this.text=t)},n.RetroFont.prototype.buildRetroFontText=function(){var t=0,e=0;if(this.clear(),this.multiLine){var i=this._text.split("\n");this.fixedWidth>0?this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var s=0;s<i.length;s++)t=0,this.align===n.RetroFont.ALIGN_RIGHT?t=this.width-i[s].length*(this.characterWidth+this.customSpacingX):this.align===n.RetroFont.ALIGN_CENTER&&(t=this.width/2-i[s].length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(i[s],t,e,this.customSpacingX),e+=this.characterHeight+this.customSpacingY}else this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),t=0,this.align===n.RetroFont.ALIGN_RIGHT?t=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===n.RetroFont.ALIGN_CENTER&&(t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2),t<0&&(t=0),this.pasteLine(this._text,t,0,this.customSpacingX);this.requiresReTint=!0},n.RetroFont.prototype.pasteLine=function(t,e,i,s){for(var n=0;n<t.length;n++)if(" "===t.charAt(n))e+=this.characterWidth+s;else if(this.grabData[t.charCodeAt(n)]>=0&&(this.stamp.frame=this.grabData[t.charCodeAt(n)],this.renderXY(this.stamp,e,i,!1),(e+=this.characterWidth+s)>this.width))break},n.RetroFont.prototype.getLongestLine=function(){var t=0;if(this._text.length>0)for(var e=this._text.split("\n"),i=0;i<e.length;i++)e[i].length>t&&(t=e[i].length);return t},n.RetroFont.prototype.removeUnsupportedCharacters=function(t){for(var e="",i=0;i<this._text.length;i++){var s=this._text[i],n=s.charCodeAt(0);(this.grabData[n]>=0||!t&&"\n"===s)&&(e=e.concat(s))}return e},n.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX!==t||this.offsetY!==e){for(var i=t-this.offsetX,s=e-this.offsetY,n=this.game.cache.getFrameData(this.stamp.key).getFrames(),o=n.length;o--;)n[o].x+=i,n[o].y+=s;this.buildRetroFontText()}},Object.defineProperty(n.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){var e;(e=this.autoUpperCase?t.toUpperCase():t)!==this._text&&(this._text=e,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(n.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t,this.buildRetroFontText()}}),n.Rope=function(t,e,i,s,o,a){this.points=[],this.points=a,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,e=e||0,i=i||0,s=s||null,o=o||null,this.type=n.ROPE,PIXI.Rope.call(this,n.Cache.DEFAULT,this.points),n.Component.Core.init.call(this,t,e,i,s,o)},n.Rope.prototype=Object.create(PIXI.Rope.prototype),n.Rope.prototype.constructor=n.Rope,n.Component.Core.install.call(n.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),n.Rope.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.Rope.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.Rope.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.Rope.prototype.preUpdateCore=n.Component.Core.preUpdate,n.Rope.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},n.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},n.Rope.prototype.reset=function(t,e){return n.Component.Reset.prototype.reset.call(this,t,e),this},Object.defineProperty(n.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){t&&"function"==typeof t?(this._hasUpdateAnimation=!0,this._updateAnimation=t):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(n.Rope.prototype,"segments",{get:function(){for(var t,e,i,s,o,a,r,h,l=[],c=0;c<this.points.length;c++)t=4*c,e=this.vertices[t]*this.scale.x,i=this.vertices[t+1]*this.scale.y,s=this.vertices[t+4]*this.scale.x,o=this.vertices[t+3]*this.scale.y,a=n.Math.difference(e,s),r=n.Math.difference(i,o),e+=this.world.x,i+=this.world.y,h=new n.Rectangle(e,i,a,r),l.push(h);return l}}),n.TileSprite=function(t,e,i,s,o,a,r){e=e||0,i=i||0,s=s||256,o=o||256,a=a||null,r=r||null,this.type=n.TILESPRITE,this.physicsType=n.SPRITE,this._scroll=new n.Point;var h=t.cache.getImage("__default",!0);PIXI.TilingSprite.call(this,new PIXI.Texture(h.base),s,o),n.Component.Core.init.call(this,t,e,i,a,r)},n.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),n.TileSprite.prototype.constructor=n.TileSprite,n.Component.Core.install.call(n.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),n.TileSprite.prototype.preUpdatePhysics=n.Component.PhysicsBody.preUpdate,n.TileSprite.prototype.preUpdateLifeSpan=n.Component.LifeSpan.preUpdate,n.TileSprite.prototype.preUpdateInWorld=n.Component.InWorld.preUpdate,n.TileSprite.prototype.preUpdateCore=n.Component.Core.preUpdate,n.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},n.TileSprite.prototype.autoScroll=function(t,e){this._scroll.set(t,e)},n.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},n.TileSprite.prototype.destroy=function(t){n.Component.Destroy.prototype.destroy.call(this,t),PIXI.TilingSprite.prototype.destroy.call(this)},n.TileSprite.prototype.reset=function(t,e){return n.Component.Reset.prototype.reset.call(this,t,e),this.tilePosition.x=0,this.tilePosition.y=0,this},n.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.iOSVersion=0,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.edge=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.safariVersion=0,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.dolby=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},n.Device=new n.Device,n.Device.onInitialized=new n.Signal,n.Device.whenReady=function(t,e,i){var s=this._readyCheck;if(this.deviceReadyAt||!s)t.call(e,this);else if(s._monitor||i)s._queue=s._queue||[],s._queue.push([t,e]);else{s._monitor=s.bind(this),s._queue=s._queue||[],s._queue.push([t,e]);var n=void 0!==window.cordova,o=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(s._monitor,0):n&&!o?document.addEventListener("deviceready",s._monitor,!1):(document.addEventListener("DOMContentLoaded",s._monitor,!1),window.addEventListener("load",s._monitor,!1))}},n.Device._readyCheck=function(){var t=this._readyCheck;if(document.body){if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",t._monitor),document.removeEventListener("DOMContentLoaded",t._monitor),window.removeEventListener("load",t._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var e;e=t._queue.shift();){var i=e[0],s=e[1];i.call(s,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}}else window.setTimeout(t._monitor,20)},n.Device._initialize=function(){var t=this;(function(){var e=navigator.userAgent;/Playstation Vita/.test(e)?t.vita=!0:/Kindle/.test(e)||/\bKF[A-Z][A-Z]+/.test(e)||/Silk.*Mobile Safari/.test(e)?t.kindle=!0:/Android/.test(e)?t.android=!0:/CrOS/.test(e)?t.chromeOS=!0:/iP[ao]d|iPhone/i.test(e)?(t.iOS=!0,navigator.appVersion.match(/OS (\d+)/),t.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(e)?t.linux=!0:/Mac OS/.test(e)?t.macOS=!0:/Windows/.test(e)&&(t.windows=!0),(/Windows Phone/i.test(e)||/IEMobile/i.test(e))&&(t.android=!1,t.iOS=!1,t.macOS=!1,t.windows=!0,t.windowsPhone=!0);var i=/Silk/.test(e);(t.windows||t.macOS||t.linux&&!i||t.chromeOS)&&(t.desktop=!0),(t.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e))&&(t.desktop=!1)})(),function(){var e=navigator.userAgent;if(/Arora/.test(e)?t.arora=!0:/Edge\/\d+/.test(e)?t.edge=!0:/Chrome\/(\d+)/.test(e)&&!t.windowsPhone?(t.chrome=!0,t.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(e)?t.epiphany=!0:/Firefox\D+(\d+)/.test(e)?(t.firefox=!0,t.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(e)&&t.iOS?t.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(e)?(t.ie=!0,t.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(e)?t.midori=!0:/Opera/.test(e)?t.opera=!0:/Safari\/(\d+)/.test(e)&&!t.windowsPhone?(t.safari=!0,/Version\/(\d+)\./.test(e)&&(t.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)&&(t.ie=!0,t.trident=!0,t.tridentVersion=parseInt(RegExp.$1,10),t.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(e)&&(t.silk=!0),navigator.standalone&&(t.webApp=!0),void 0!==window.cordova&&(t.cordova=!0),void 0!==i&&(t.node=!0),t.node&&"object"==typeof i.versions&&(t.nodeWebkit=!!i.versions["node-webkit"],t.electron=!!i.versions.electron),navigator.isCocoonJS&&(t.cocoonJS=!0),t.cocoonJS)try{t.cocoonJSApp="undefined"!=typeof CocoonJS}catch(e){t.cocoonJSApp=!1}void 0!==window.ejecta&&(t.ejecta=!0),/Crosswalk/.test(e)&&(t.crosswalk=!0)}(),function(){t.audioData=!!window.Audio,t.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var e=document.createElement("audio");try{if(e.canPlayType&&(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(t.ogg=!0),(e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||e.canPlayType("audio/opus;").replace(/^no$/,""))&&(t.opus=!0),e.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(t.mp3=!0),e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(t.wav=!0),(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,""))&&(t.m4a=!0),e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(t.webm=!0),""!==e.canPlayType('audio/mp4;codecs="ec-3"')))if(t.edge)t.dolby=!0;else if(t.safari&&t.safariVersion>=9&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var i=parseInt(RegExp.$1,10),s=parseInt(RegExp.$2,10);(10===i&&s>=11||i>10)&&(t.dolby=!0)}}catch(e){}}(),function(){var e=document.createElement("video");try{e.canPlayType&&(e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(t.oggVideo=!0),e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.h264Video=!0,t.mp4Video=!0),e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(t.webmVideo=!0),e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(t.vp9Video=!0),e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(t.hlsVideo=!0))}catch(e){}}(),function(){var e,i=document.createElement("p"),s={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var n in document.body.insertBefore(i,null),s)void 0!==i.style[n]&&(i.style[n]="translate3d(1px,1px,1px)",e=window.getComputedStyle(i).getPropertyValue(s[n]));document.body.removeChild(i),t.css3D=void 0!==e&&e.length>0&&"none"!==e}(),function(){var e,i,s;t.pixelRatio=window.devicePixelRatio||1,t.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone"),t.iPhone4=2===t.pixelRatio&&t.iPhone,t.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad"),"undefined"!=typeof Int8Array?t.typedArray=!0:t.typedArray=!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(t.littleEndian=(e=new ArrayBuffer(4),i=new Uint8Array(e),s=new Uint32Array(e),i[0]=161,i[1]=178,i[2]=195,i[3]=212,3569595041===s[0]||2712847316!==s[0]&&null),t.LITTLE_ENDIAN=t.littleEndian),t.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==t.littleEndian&&function(){if(void 0===Uint8ClampedArray)return!1;var t=PIXI.CanvasPool.create(this,1,1).getContext("2d");if(!t)return!1;var e=t.createImageData(1,1);return PIXI.CanvasPool.remove(this),e.data instanceof Uint8ClampedArray}(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(t.vibration=!0)}(),function(){t.canvas=!!window.CanvasRenderingContext2D||t.cocoonJS;try{t.localStorage=!!localStorage.getItem}catch(e){t.localStorage=!1}t.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),t.fileSystem=!!window.requestFileSystem;var e={stencil:!0};t.webGL=function(){try{var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e))}catch(t){return!1}}(),t.webGL=!!t.webGL,t.worker=!!window.Worker,t.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,t.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,t.getUserMedia=t.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,t.firefox&&t.firefoxVersion<21&&(t.getUserMedia=!1),!t.iOS&&(t.ie||t.firefox||t.chrome)&&(t.canvasBitBltShift=!0),(t.safari||t.mobileSafari)&&(t.canvasBitBltShift=!1)}(),function(){for(var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],i=document.createElement("div"),s=0;s<e.length;s++)if(i[e[s]]){t.fullscreen=!0,t.requestFullscreen=e[s];break}var n=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(t.fullscreen)for(s=0;s<n.length;s++)if(document[n[s]]){t.cancelFullscreen=n[s];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(t.fullscreenKeyboard=!0)}(),("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)&&(t.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(t.mspointer=!0),t.cocoonJS||("onwheel"in window||t.ie&&"WheelEvent"in window?t.wheelEvent="wheel":"onmousewheel"in window?t.wheelEvent="mousewheel":t.firefox&&"MouseScrollEvent"in window&&(t.wheelEvent="DOMMouseScroll"))},n.Device.canPlayAudio=function(t){return!!("mp3"===t&&this.mp3||"ogg"===t&&(this.ogg||this.opus)||"m4a"===t&&this.m4a||"opus"===t&&this.opus||"wav"===t&&this.wav||"webm"===t&&this.webm||"mp4"===t&&this.dolby)},n.Device.canPlayVideo=function(t){return!!("webm"===t&&(this.webmVideo||this.vp9Video)||"mp4"===t&&(this.mp4Video||this.h264Video)||("ogg"===t||"ogv"===t)&&this.oggVideo||"mpeg"===t&&this.hlsVideo)},n.Device.isConsoleOpen=function(){return!(!window.console||!window.console.firebug)||!(!window.console||(console.clear,!console.profiles))&&console.profiles.length>0},n.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537},n.Canvas={create:function(t,e,i,s,n){e=e||256,i=i||256;var o=n?document.createElement("canvas"):PIXI.CanvasPool.create(t,e,i);return"string"==typeof s&&""!==s&&(o.id=s),o.width=e,o.height=i,o.style.display="block",o},setBackgroundColor:function(t,e){return e=e||"rgb(0,0,0)",t.style.backgroundColor=e,t},setTouchAction:function(t,e){return e=e||"none",t.style.msTouchAction=e,t.style["ms-touch-action"]=e,t.style["touch-action"]=e,t},setUserSelect:function(t,e){return e=e||"none",t.style["-webkit-touch-callout"]=e,t.style["-webkit-user-select"]=e,t.style["-khtml-user-select"]=e,t.style["-moz-user-select"]=e,t.style["-ms-user-select"]=e,t.style["user-select"]=e,t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",t},addToDOM:function(t,e,i){var s;return void 0===i&&(i=!0),e&&("string"==typeof e?s=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(s=e)),s||(s=document.body),i&&s.style&&(s.style.overflow="hidden"),s.appendChild(t),t},removeFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)},setTransform:function(t,e,i,s,n,o,a){return t.setTransform(s,o,a,n,e,i),t},setSmoothingEnabled:function(t,e){var i=n.Canvas.getSmoothingPrefix(t);return i&&(t[i]=e),t},getSmoothingPrefix:function(t){var e=["i","webkitI","msI","mozI","oI"];for(var i in e){var s=e[i]+"mageSmoothingEnabled";if(s in t)return s}return null},getSmoothingEnabled:function(t){var e=n.Canvas.getSmoothingPrefix(t);if(e)return t[e]},setImageRenderingCrisp:function(t){for(var e=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"],i=0;i<e.length;i++)t.style["image-rendering"]=e[i];return t.style.msInterpolationMode="nearest-neighbor",t},setImageRenderingBicubic:function(t){return t.style["image-rendering"]="auto",t.style.msInterpolationMode="bicubic",t}},n.RequestAnimationFrame=function(t,e){void 0===e&&(e=!1),this.game=t,this.isRunning=!1,this.forceSetTimeOut=e;for(var i=["ms","moz","webkit","o"],s=0;s<i.length&&!window.requestAnimationFrame;s++)window.requestAnimationFrame=window[i[s]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[s]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},n.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var t=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return t.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(e){return t.updateRAF(e)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(t){this.isRunning&&(this.game.update(Math.floor(t)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}},n.RequestAnimationFrame.prototype.constructor=n.RequestAnimationFrame,n.Math={PI2:2*Math.PI,between:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},fuzzyEqual:function(t,e,i){return void 0===i&&(i=1e-4),Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){return void 0===i&&(i=1e-4),t<e+i},fuzzyGreaterThan:function(t,e,i){return void 0===i&&(i=1e-4),t>e-i},fuzzyCeil:function(t,e){return void 0===e&&(e=1e-4),Math.ceil(t-e)},fuzzyFloor:function(t,e){return void 0===e&&(e=1e-4),Math.floor(t+e)},average:function(){for(var t=0,e=arguments.length,i=0;i<e;i++)t+=+arguments[i];return t/e},shear:function(t){return t%1},snapTo:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.round(t/e)))},snapToFloor:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.floor(t/e)))},snapToCeil:function(t,e,i){return void 0===i&&(i=0),0===e?t:(t-=i,i+(t=e*Math.ceil(t/e)))},roundTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var s=Math.pow(i,-e);return Math.round(t*s)/s},floorTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var s=Math.pow(i,-e);return Math.floor(t*s)/s},ceilTo:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var s=Math.pow(i,-e);return Math.ceil(t*s)/s},rotateToAngle:function(t,e,i){return void 0===i&&(i=.05),t===e?t:(Math.abs(e-t)<=i||Math.abs(e-t)>=n.Math.PI2-i?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=n.Math.PI2:e-=n.Math.PI2),e>t?t+=i:e<t&&(t-=i)),t)},getShortestAngle:function(t,e){var i=e-t;return 0===i?0:i-360*Math.floor((i- -180)/360)},angleBetween:function(t,e,i,s){return Math.atan2(s-e,i-t)},angleBetweenY:function(t,e,i,s){return Math.atan2(i-t,s-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,!0)},normalizeAngle:function(t){return(t%=2*Math.PI)>=0?t:t+2*Math.PI},maxAdd:function(t,e,i){return Math.min(t+e,i)},minSub:function(t,e,i){return Math.max(t-e,i)},wrap:function(t,e,i){var s=i-e;if(s<=0)return 0;var n=(t-e)%s;return n<0&&(n+=s),n+e},wrapValue:function(t,e,i){return((t=Math.abs(t))+(e=Math.abs(e)))%(i=Math.abs(i))},isOdd:function(t){return!!(1&t)},isEven:function(t){return!(1&t)},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])var t=arguments[0];else t=arguments;for(var e=1,i=0,s=t.length;e<s;e++)t[e]<t[i]&&(i=e);return t[i]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])var t=arguments[0];else t=arguments;for(var e=1,i=0,s=t.length;e<s;e++)t[e]>t[i]&&(i=e);return t[i]},minProperty:function(t){if(2===arguments.length&&"object"==typeof arguments[1])var e=arguments[1];else e=arguments.slice(1);for(var i=1,s=0,n=e.length;i<n;i++)e[i][t]<e[s][t]&&(s=i);return e[s][t]},maxProperty:function(t){if(2===arguments.length&&"object"==typeof arguments[1])var e=arguments[1];else e=arguments.slice(1);for(var i=1,s=0,n=e.length;i<n;i++)e[i][t]>e[s][t]&&(s=i);return e[s][t]},wrapAngle:function(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)},linearInterpolation:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s);return e<0?this.linear(t[0],t[1],s):e>1?this.linear(t[i],t[i-1],i-s):this.linear(t[n],t[n+1>i?i:n+1],s-n)},bezierInterpolation:function(t,e){for(var i=0,s=t.length-1,n=0;n<=s;n++)i+=Math.pow(1-e,s-n)*Math.pow(e,n)*t[n]*this.bernstein(s,n);return i},catmullRomInterpolation:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s);return t[0]===t[i]?(e<0&&(n=Math.floor(s=i*(1+e))),this.catmullRom(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],s-n)):e<0?t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):this.catmullRom(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],s-n)},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(0===t)return 1;for(var e=t;--t;)e*=t;return e},catmullRom:function(t,e,i,s,n){var o=.5*(i-t),a=.5*(s-e),r=n*n;return(2*e-2*i+o+a)*(n*r)+(-3*e+3*i-2*o-a)*r+o*n+e},difference:function(t,e){return Math.abs(t-e)},roundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},sinCosGenerator:function(t,e,i,s){void 0===e&&(e=1),void 0===i&&(i=1),void 0===s&&(s=1);for(var n=e,o=i,a=s*Math.PI/t,r=[],h=[],l=0;l<t;l++)n+=(o-=n*a)*a,r[l]=o,h[l]=n;return{sin:h,cos:r,length:t}},distance:function(t,e,i,s){var n=t-i,o=e-s;return Math.sqrt(n*n+o*o)},distanceSq:function(t,e,i,s){var n=t-i,o=e-s;return n*n+o*o},distancePow:function(t,e,i,s,n){return void 0===n&&(n=2),Math.sqrt(Math.pow(i-t,n)+Math.pow(s-e,n))},clamp:function(t,e,i){return t<e?e:i<t?i:t},clampBottom:function(t,e){return t<e?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,s,n){return s+(t-e)*(n-s)/(i-e)},smoothstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*(3-2*t)},smootherstep:function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*t*(t*(6*t-15)+10)},sign:function(t){return t<0?-1:t>0?1:0},percent:function(t,e,i){return void 0===i&&(i=0),t>e||i>e?1:t<i||i>t?0:(t-i)/e}};var h=Math.PI/180,l=180/Math.PI;return n.Math.degToRad=function(t){return t*h},n.Math.radToDeg=function(t){return t*l},n.RandomDataGenerator=function(t){void 0===t&&(t=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,"string"==typeof t?this.state(t):this.sow(t)},n.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|t,this.s0=this.s1,this.s1=this.s2,this.s2=t-this.c,this.s2},sow:function(t){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,t)for(var e=0;e<t.length&&null!=t[e];e++){var i=t[e];this.s0-=this.hash(i),this.s0+=~~(this.s0<0),this.s1-=this.hash(i),this.s1+=~~(this.s1<0),this.s2-=this.hash(i),this.s2+=~~(this.s2<0)}},hash:function(t){var e,i,s;for(s=4022871197,t=t.toString(),i=0;i<t.length;i++)e=.02519603282416938*(s+=t.charCodeAt(i)),e-=s=e>>>0,s=(e*=s)>>>0,s+=4294967296*(e-=s);return 2.3283064365386963e-10*(s>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){var t="",e="";for(e=t="";t++<36;e+=~t%5|3*t&4?(15^t?8^this.frac()*(20^t?16:4):4).toString(16):"-");return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1)+.5)]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(t){return"string"==typeof t&&t.match(/^!rnd/)&&(t=t.split(","),this.c=parseFloat(t[1]),this.s0=parseFloat(t[2]),this.s1=parseFloat(t[3]),this.s2=parseFloat(t[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}},n.RandomDataGenerator.prototype.constructor=n.RandomDataGenerator,n.QuadTree=function(t,e,i,s,n,o,a){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(t,e,i,s,n,o,a)},n.QuadTree.prototype={reset:function(t,e,i,s,n,o,a){this.maxObjects=n||10,this.maxLevels=o||4,this.level=a||0,this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:s,subWidth:Math.floor(i/2),subHeight:Math.floor(s/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(s/2)},this.objects.length=0,this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,!0)},populateHandler:function(t){t.body&&t.exists&&this.insert(t.body)},split:function(){this.nodes[0]=new n.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new n.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new n.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new n.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e,i=0;if(null==this.nodes[0]||-1===(e=this.getIndex(t))){if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i++}else this.nodes[e].insert(t)},getIndex:function(t){var e=-1;return t.x<this.bounds.right&&t.right<this.bounds.right?t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=1:t.y>this.bounds.bottom&&(e=2):t.x>this.bounds.right&&(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=0:t.y>this.bounds.bottom&&(e=3)),e},retrieve:function(t){if(t instanceof n.Rectangle)var e=this.objects,i=this.getIndex(t);else{if(!t.body)return this._empty;e=this.objects,i=this.getIndex(t.body)}return this.nodes[0]&&(-1!==i?e=e.concat(this.nodes[i].retrieve(t)):e=(e=(e=(e=e.concat(this.nodes[0].retrieve(t))).concat(this.nodes[1].retrieve(t))).concat(this.nodes[2].retrieve(t))).concat(this.nodes[3].retrieve(t))),e},clear:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}},n.QuadTree.prototype.constructor=n.QuadTree,n.Net=function(t){this.game=t},n.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(t){return-1!==window.location.hostname.indexOf(t)},updateQueryString:function(t,e,i,s){void 0===i&&(i=!1),void 0!==s&&""!==s||(s=window.location.href);var n="",o=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi");if(o.test(s))n=null!=e?s.replace(o,"$1"+t+"="+e+"$2$3"):s.replace(o,"$1$3").replace(/(&|\?)$/,"");else if(null!=e){var a=-1!==s.indexOf("?")?"&":"?",r=s.split("#");s=r[0]+a+t+"="+e,r[1]&&(s+="#"+r[1]),n=s}else n=s;if(!i)return n;window.location.href=n},getQueryString:function(t){void 0===t&&(t="");var e={},i=location.search.substring(1).split("&");for(var s in i){var n=i[s].split("=");if(n.length>1){if(t&&t===this.decodeURI(n[0]))return this.decodeURI(n[1]);e[this.decodeURI(n[0])]=this.decodeURI(n[1])}}return e},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}},n.Net.prototype.constructor=n.Net,n.TweenManager=function(t){this.game=t,this.frameBased=!1,this._tweens=[],this._add=[],this.easeMap={Power0:n.Easing.Power0,Power1:n.Easing.Power1,Power2:n.Easing.Power2,Power3:n.Easing.Power3,Power4:n.Easing.Power4,Linear:n.Easing.Linear.None,Quad:n.Easing.Quadratic.Out,Cubic:n.Easing.Cubic.Out,Quart:n.Easing.Quartic.Out,Quint:n.Easing.Quintic.Out,Sine:n.Easing.Sinusoidal.Out,Expo:n.Easing.Exponential.Out,Circ:n.Easing.Circular.Out,Elastic:n.Easing.Elastic.Out,Back:n.Easing.Back.Out,Bounce:n.Easing.Bounce.Out,"Quad.easeIn":n.Easing.Quadratic.In,"Cubic.easeIn":n.Easing.Cubic.In,"Quart.easeIn":n.Easing.Quartic.In,"Quint.easeIn":n.Easing.Quintic.In,"Sine.easeIn":n.Easing.Sinusoidal.In,"Expo.easeIn":n.Easing.Exponential.In,"Circ.easeIn":n.Easing.Circular.In,"Elastic.easeIn":n.Easing.Elastic.In,"Back.easeIn":n.Easing.Back.In,"Bounce.easeIn":n.Easing.Bounce.In,"Quad.easeOut":n.Easing.Quadratic.Out,"Cubic.easeOut":n.Easing.Cubic.Out,"Quart.easeOut":n.Easing.Quartic.Out,"Quint.easeOut":n.Easing.Quintic.Out,"Sine.easeOut":n.Easing.Sinusoidal.Out,"Expo.easeOut":n.Easing.Exponential.Out,"Circ.easeOut":n.Easing.Circular.Out,"Elastic.easeOut":n.Easing.Elastic.Out,"Back.easeOut":n.Easing.Back.Out,"Bounce.easeOut":n.Easing.Bounce.Out,"Quad.easeInOut":n.Easing.Quadratic.InOut,"Cubic.easeInOut":n.Easing.Cubic.InOut,"Quart.easeInOut":n.Easing.Quartic.InOut,"Quint.easeInOut":n.Easing.Quintic.InOut,"Sine.easeInOut":n.Easing.Sinusoidal.InOut,"Expo.easeInOut":n.Easing.Exponential.InOut,"Circ.easeInOut":n.Easing.Circular.InOut,"Elastic.easeInOut":n.Easing.Elastic.InOut,"Back.easeInOut":n.Easing.Back.InOut,"Bounce.easeInOut":n.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},n.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var t=0;t<this._tweens.length;t++)this._tweens[t].pendingDelete=!0;this._add=[]},removeFrom:function(t,e){if(void 0===e&&(e=!0),Array.isArray(t))for(i=0,s=t.length;i<s;i++)this.removeFrom(t[i]);else if(t.type===n.GROUP&&e)for(var i=0,s=t.children.length;i<s;i++)this.removeFrom(t.children[i]);else{for(i=0,s=this._tweens.length;i<s;i++)t===this._tweens[i].target&&this.remove(this._tweens[i]);for(i=0,s=this._add.length;i<s;i++)t===this._add[i].target&&this.remove(this._add[i])}},add:function(t){t._manager=this,this._add.push(t)},create:function(t){return new n.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);-1!==e?this._tweens[e].pendingDelete=!0:-1!==(e=this._add.indexOf(t))&&(this._add[e].pendingDelete=!0)},update:function(){var t=this._add.length,e=this._tweens.length;if(0===e&&0===t)return!1;for(var i=0;i<e;)this._tweens[i].update(this.game.time.time)?i++:(this._tweens.splice(i,1),e--);return t>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(t){return this._tweens.some(function(e){return e.target===t})},_pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t]._pause()},_resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t]._resume()},pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t].pause()},resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t].resume(!0)}},n.TweenManager.prototype.constructor=n.TweenManager,n.Tween=function(t,e,i){this.game=e,this.target=t,this.manager=i,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new n.Signal,this.onLoop=new n.Signal,this.onRepeat=new n.Signal,this.onChildComplete=new n.Signal,this.onComplete=new n.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this.frameBased=i.frameBased,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1,this._hasStarted=!1},n.Tween.prototype={to:function(t,e,i,s,o,a,r){return(void 0===e||e<=0)&&(e=1e3),null!=i||(i=n.Easing.Default),void 0===s&&(s=!1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning?this:(this.timeline.push(new n.TweenData(this).to(t,e,i,o,a,r)),s&&this.start(),this)},from:function(t,e,i,s,o,a,r){return void 0===e&&(e=1e3),null!=i||(i=n.Easing.Default),void 0===s&&(s=!1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=!1),"string"==typeof i&&this.manager.easeMap[i]&&(i=this.manager.easeMap[i]),this.isRunning?this:(this.timeline.push(new n.TweenData(this).from(t,e,i,o,a,r)),s&&this.start(),this)},start:function(t){if(void 0===t&&(t=0),null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(var e=0;e<this.timeline.length;e++)for(var i in this.timeline[e].vEnd)this.properties[i]=this.target[i]||0,Array.isArray(this.properties[i])||(this.properties[i]*=1);for(e=0;e<this.timeline.length;e++)this.timeline[e].loadValues();return this.manager.add(this),this.isRunning=!0,(t<0||t>this.timeline.length-1)&&(t=0),this.current=t,this.timeline[this.current].start(),this},stop:function(t){return void 0===t&&(t=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,t&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(t,e,i){if(0===this.timeline.length)return this;if(void 0===i&&(i=0),-1===i)for(var s=0;s<this.timeline.length;s++)this.timeline[s][t]=e;else this.timeline[i][t]=e;return this},delay:function(t,e){return this.updateTweenData("delay",t,e)},repeat:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("repeatCounter",t,i),this.updateTweenData("repeatDelay",e,i)},repeatDelay:function(t,e){return this.updateTweenData("repeatDelay",t,e)},yoyo:function(t,e,i){return void 0===e&&(e=0),this.updateTweenData("yoyo",t,i),this.updateTweenData("yoyoDelay",e,i)},yoyoDelay:function(t,e){return this.updateTweenData("yoyoDelay",t,e)},easing:function(t,e){return"string"==typeof t&&this.manager.easeMap[t]&&(t=this.manager.easeMap[t]),this.updateTweenData("easingFunction",t,e)},interpolation:function(t,e,i){return void 0===e&&(e=n.Math),this.updateTweenData("interpolationFunction",t,i),this.updateTweenData("interpolationContext",e,i)},repeatAll:function(t){return void 0===t&&(t=0),this.repeatCounter=t,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1].chainedTween=arguments[t]:this.chainedTween=arguments[t];return this},loop:function(t){return void 0===t&&(t=!0),this.repeatCounter=t?-1:0,this},onUpdateCallback:function(t,e){return this._onUpdateCallback=t,this._onUpdateCallbackContext=e,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var t=0;t<this.timeline.length;t++)this.timeline[t].isRunning||(this.timeline[t].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(t){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;var e=this.timeline[this.current].update(t);if(e===n.TweenData.PENDING)return!0;if(e===n.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(e===n.TweenData.LOOPED)return-1===this.timeline[this.current].repeatCounter?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0;if(e===n.TweenData.COMPLETE){var i=!1;return this.reverse?--this.current<0&&(this.current=this.timeline.length-1,i=!0):++this.current===this.timeline.length&&(this.current=0,i=!0),i?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):this.repeatCounter>0?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(t,e){if(null===this.game||null===this.target)return null;void 0===t&&(t=60),void 0===e&&(e=[]);for(var i=0;i<this.timeline.length;i++)for(var s in this.timeline[i].vEnd)this.properties[s]=this.target[s]||0,Array.isArray(this.properties[s])||(this.properties[s]*=1);for(i=0;i<this.timeline.length;i++)this.timeline[i].loadValues();for(i=0;i<this.timeline.length;i++)e=e.concat(this.timeline[i].generateData(t));return e}},Object.defineProperty(n.Tween.prototype,"totalDuration",{get:function(){for(var t=0,e=0;e<this.timeline.length;e++)t+=this.timeline[e].duration;return t}}),n.Tween.prototype.constructor=n.Tween,n.TweenData=function(t){this.parent=t,this.game=t.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.repeatTotal=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=n.Easing.Default,this.interpolationFunction=n.Math.linearInterpolation,this.interpolationContext=n.Math,this.isRunning=!1,this.isFrom=!1},n.TweenData.PENDING=0,n.TweenData.RUNNING=1,n.TweenData.LOOPED=2,n.TweenData.COMPLETE=3,n.TweenData.prototype={to:function(t,e,i,s,n,o){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=s,this.repeatTotal=n,this.yoyo=o,this.isFrom=!1,this},from:function(t,e,i,s,n,o){return this.vEnd=t,this.duration=e,this.easingFunction=i,this.delay=s,this.repeatTotal=n,this.yoyo=o,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.parent.reverse?this.dt=this.duration:this.dt=0,this.delay>0?this.isRunning=!1:this.isRunning=!0,this.isFrom)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t],this.parent.target[t]=this.vStart[t];return this.value=0,this.yoyoCounter=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var t in this.parent.properties){if(this.vStart[t]=this.parent.properties[t],Array.isArray(this.vEnd[t])){if(0===this.vEnd[t].length)continue;0===this.percent&&(this.vEnd[t]=[this.vStart[t]].concat(this.vEnd[t]))}void 0!==this.vEnd[t]?("string"==typeof this.vEnd[t]&&(this.vEnd[t]=this.vStart[t]+parseFloat(this.vEnd[t],10)),this.parent.properties[t]=this.vEnd[t]):this.vEnd[t]=this.vStart[t],this.vStartCache[t]=this.vStart[t],this.vEndCache[t]=this.vEnd[t]}return this},update:function(t){if(this.isRunning){if(t<this.startTime)return n.TweenData.RUNNING}else{if(!(t>=this.startTime))return n.TweenData.PENDING;this.isRunning=!0}var e=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;for(var i in this.parent.reverse?(this.dt-=e*this.parent.timeScale,this.dt=Math.max(this.dt,0)):(this.dt+=e*this.parent.timeScale,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent),this.vEnd){var s=this.vStart[i],o=this.vEnd[i];Array.isArray(o)?this.parent.target[i]=this.interpolationFunction.call(this.interpolationContext,o,this.value):this.parent.target[i]=s+(o-s)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():n.TweenData.RUNNING},generateData:function(t){this.parent.reverse?this.dt=this.duration:this.dt=0;var e=[],i=!1,s=1/t*1e3;do{this.parent.reverse?(this.dt-=s,this.dt=Math.max(this.dt,0)):(this.dt+=s,this.dt=Math.min(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var n={};for(var o in this.vEnd){var a=this.vStart[o],r=this.vEnd[o];Array.isArray(r)?n[o]=this.interpolationFunction(r,this.value):n[o]=a+(r-a)*this.value}e.push(n),(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(i=!0)}while(!i);if(this.yoyo){var h=e.slice();h.reverse(),e=e.concat(h)}return e},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter){for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];return this.inReverse=!1,n.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return n.TweenData.COMPLETE;if(this.inReverse)for(var t in this.vStartCache)this.vStart[t]=this.vEndCache[t],this.vEnd[t]=this.vStartCache[t];else{for(var t in this.vStartCache)this.vStart[t]=this.vStartCache[t],this.vEnd[t]=this.vEndCache[t];this.repeatCounter>0&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.parent.reverse?this.dt=this.duration:this.dt=0,n.TweenData.LOOPED}},n.TweenData.prototype.constructor=n.TweenData,n.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},Out:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},InOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},Out:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*n.Easing.Bounce.In(2*t):.5*n.Easing.Bounce.Out(2*t-1)+.5}}},n.Easing.Default=n.Easing.Linear.None,n.Easing.Power0=n.Easing.Linear.None,n.Easing.Power1=n.Easing.Quadratic.Out,n.Easing.Power2=n.Easing.Cubic.Out,n.Easing.Power3=n.Easing.Quartic.Out,n.Easing.Power4=n.Easing.Quintic.Out,n.Time=function(t){this.game=t,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=1/60,this.physicsElapsedMS=1/60*1e3,this.desiredFpsMult=1/60,this._desiredFps=60,this.suggestedFps=this.desiredFps,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new n.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},n.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start(),this.timeExpected=this.time},add:function(t){return this._timers.push(t),t},create:function(t){void 0===t&&(t=!0);var e=new n.Timer(this.game,t);return this._timers.push(e),e},removeAll:function(){for(var t=0;t<this._timers.length;t++)this._timers[t].destroy();this._timers=[],this.events.removeAll()},refresh:function(){var t=this.time;this.time=Date.now(),this.elapsedMS=this.time-t},update:function(t){var e=this.time;this.time=Date.now(),this.elapsedMS=this.time-e,this.prevTime=this.now,this.now=t,this.elapsed=this.now-this.prevTime,this.game.raf._isSetTimeOut&&(this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-t))),this.timeExpected=t+this.timeToCall),this.advancedTiming&&this.updateAdvancedTiming(),this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){for(var t=0,e=this._timers.length;t<e;)this._timers[t].update(this.time)?t++:(this._timers.splice(t,1),e--)},updateAdvancedTiming:function(){this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*Math.floor(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.msMin=Math.min(this.msMin,this.elapsed),this.msMax=Math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=Math.min(this.fpsMin,this.fps),this.fpsMax=Math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();for(var t=this._timers.length;t--;)this._timers[t]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var t=this._timers.length;t--;)this._timers[t]._resume()},totalElapsedSeconds:function(){return.001*(this.time-this._started)},elapsedSince:function(t){return this.time-t},elapsedSecondsSince:function(t){return.001*(this.time-t)},reset:function(){this._started=this.time,this.removeAll()}},Object.defineProperty(n.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(t){this._desiredFps=t,this.physicsElapsed=1/t,this.physicsElapsedMS=1e3*this.physicsElapsed,this.desiredFpsMult=1/t}}),n.Time.prototype.constructor=n.Time,n.Timer=function(t,e){void 0===e&&(e=!0),this.game=t,this.running=!1,this.autoDestroy=e,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new n.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},n.Timer.MINUTE=6e4,n.Timer.SECOND=1e3,n.Timer.HALF=500,n.Timer.QUARTER=250,n.Timer.prototype={create:function(t,e,i,s,o,a){var r=t=Math.round(t);0===this._now?r+=this.game.time.time:r+=this._now;var h=new n.TimerEvent(this,t,r,i,e,s,o,a);return this.events.push(h),this.order(),this.expired=!1,h},add:function(t,e,i){return this.create(t,!1,0,e,i,Array.prototype.slice.call(arguments,3))},repeat:function(t,e,i,s){return this.create(t,!1,e,i,s,Array.prototype.slice.call(arguments,4))},loop:function(t,e,i){return this.create(t,!0,0,e,i,Array.prototype.slice.call(arguments,3))},start:function(t){if(!this.running){this._started=this.game.time.time+(t||0),this.running=!0;for(var e=0;e<this.events.length;e++)this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=!1,void 0===t&&(t=!0),t&&(this.events.length=0)},remove:function(t){for(var e=0;e<this.events.length;e++)if(this.events[e]===t)return this.events[e].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(t,e){return t.tick<e.tick?-1:t.tick>e.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(t){if(this.paused)return!0;if(this.elapsed=t-this._now,this._now=t,this.elapsed>this.timeCap&&this.adjustEvents(t-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),!0===this.events[this._i].loop?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return!this.expired||!this.autoDestroy},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(t){for(var e=0;e<this.events.length;e++)if(!this.events[e].pendingDelete){var i=this.events[e].tick-t;i<0&&(i=0),this.events[e].tick=this._now+i}var s=this.nextTick-t;this.nextTick=s<0?this._now:this._now+s},resume:function(){if(this.paused){var t=this.game.time.time;this._pauseTotal+=t-this._now,this._now=t,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(n.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(n.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(n.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(n.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(n.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),n.Timer.prototype.constructor=n.Timer,n.TimerEvent=function(t,e,i,s,n,o,a,r){this.timer=t,this.delay=e,this.tick=i,this.repeatCount=s-1,this.loop=n,this.callback=o,this.callbackContext=a,this.args=r,this.pendingDelete=!1},n.TimerEvent.prototype.constructor=n.TimerEvent,n.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},n.AnimationManager.prototype={loadFrameData:function(t,e){if(void 0===t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return null==e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},add:function(t,e,i,s,o){return e=e||[],i=i||60,void 0===s&&(s=!1),void 0===o&&(o=!(!e||"number"!=typeof e[0])),this._outputFrames=[],this._frameData.getFrameIndexes(e,o,this._outputFrames),this._anims[t]=new n.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,s),this.currentAnim=this._anims[t],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[t]},validateFrames:function(t,e){void 0===e&&(e=!0);for(var i=0;i<t.length;i++)if(!0===e){if(t[i]>this._frameData.total)return!1}else if(!1===this._frameData.checkFrameName(t[i]))return!1;return!0},play:function(t,e,i,s){if(this._anims[t])return this.currentAnim===this._anims[t]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(e,i,s)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[t],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(e,i,s))},stop:function(t,e){void 0===e&&(e=!1),!this.currentAnim||"string"==typeof t&&t!==this.currentAnim.name||this.currentAnim.stop(e)},update:function(){return!(this.updateIfVisible&&!this.sprite.visible||!this.currentAnim||!this.currentAnim.update()||(this.currentFrame=this.currentAnim.currentFrame,0))},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.currentFrame=this.currentAnim.currentFrame)},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){},destroy:function(){var t=null;for(var t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},n.AnimationManager.prototype.constructor=n.AnimationManager,Object.defineProperty(n.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(n.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(n.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),Object.defineProperty(n.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(n.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(t){"number"==typeof t&&this._frameData&&null!==this._frameData.getFrame(t)&&(this.currentFrame=this._frameData.getFrame(t),this.currentFrame&&this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(n.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(t){"string"==typeof t&&this._frameData&&null!==this._frameData.getFrameByName(t)&&(this.currentFrame=this._frameData.getFrameByName(t),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame)))}}),n.Animation=function(t,e,i,s,o,a,r){void 0===r&&(r=!1),this.game=t,this._parent=e,this._frameData=s,this.name=i,this._frames=[],this._frames=this._frames.concat(o),this.delay=1e3/a,this.loop=r,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new n.Signal,this.onUpdate=null,this.onComplete=new n.Signal,this.onLoop=new n.Signal,this.isReversed=!1,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},n.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),void 0!==i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=this.isReversed?this._frames.length-1:0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(t,e){var i;if(void 0===e&&(e=!1),"string"==typeof t)for(var s=0;s<this._frames.length;s++)this._frameData.getFrame(this._frames[s]).name===t&&(i=s);else if("number"==typeof t)if(e)i=t;else for(s=0;s<this._frames.length;s++)this._frames[s]===t&&(i=s);i&&(this._frameIndex=i-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1?this.loop?(this._frameIndex=Math.abs(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0))},updateCurrentFrame:function(t,e){if(void 0===e&&(e=!1),!this._frameData)return!1;var i=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(e||!e&&i!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),!this.onUpdate||!t||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)},next:function(t){void 0===t&&(t=1);var e=this._frameIndex+t;e>=this._frames.length&&(this.loop?e%=this._frames.length:e=this._frames.length-1),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},previous:function(t){void 0===t&&(t=1);var e=this._frameIndex-t;e<0&&(this.loop?e=this._frames.length+e:e++),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},n.Animation.prototype.constructor=n.Animation,Object.defineProperty(n.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t,t?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(n.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(t){this.isReversed=t}}),Object.defineProperty(n.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(n.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]),null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(n.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(t){t>0&&(this.delay=1e3/t)}}),Object.defineProperty(n.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new n.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),n.Animation.generateFrameNames=function(t,e,i,s,o){void 0===s&&(s="");var a=[],r="";if(e<i)for(var h=e;h<=i;h++)r=t+(r="number"==typeof o?n.Utils.pad(h.toString(),o,"0",1):h.toString())+s,a.push(r);else for(h=e;h>=i;h--)r=t+(r="number"==typeof o?n.Utils.pad(h.toString(),o,"0",1):h.toString())+s,a.push(r);return a},n.Frame=function(t,e,i,s,o,a){this.index=t,this.x=e,this.y=i,this.width=s,this.height=o,this.name=a,this.centerX=Math.floor(s/2),this.centerY=Math.floor(o/2),this.distance=n.Math.distance(0,0,s,o),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=s,this.sourceSizeH=o,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},n.Frame.prototype={resize:function(t,e){this.width=t,this.height=e,this.centerX=Math.floor(t/2),this.centerY=Math.floor(e/2),this.distance=n.Math.distance(0,0,t,e),this.sourceSizeW=t,this.sourceSizeH=e,this.right=this.x+t,this.bottom=this.y+e},setTrim:function(t,e,i,s,n,o,a){this.trimmed=t,t&&(this.sourceSizeW=e,this.sourceSizeH=i,this.centerX=Math.floor(e/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=s,this.spriteSourceSizeY=n,this.spriteSourceSizeW=o,this.spriteSourceSizeH=a)},clone:function(){var t=new n.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var e in this)this.hasOwnProperty(e)&&(t[e]=this[e]);return t},getRect:function(t){return void 0===t?t=new n.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}},n.Frame.prototype.constructor=n.Frame,n.FrameData=function(){this._frames=[],this._frameNames=[]},n.FrameData.prototype={addFrame:function(t){return t.index=this._frames.length,this._frames.push(t),""!==t.name&&(this._frameNames[t.name]=t.index),t},getFrame:function(t){return t>=this._frames.length&&(t=0),this._frames[t]},getFrameByName:function(t){return"number"==typeof this._frameNames[t]?this._frames[this._frameNames[t]]:null},checkFrameName:function(t){return null!=this._frameNames[t]},clone:function(){for(var t=new n.FrameData,e=0;e<this._frames.length;e++)t._frames.push(this._frames[e].clone());for(var i in this._frameNames)this._frameNames.hasOwnProperty(i)&&t._frameNames.push(this._frameNames[i]);return t},getFrameRange:function(t,e,i){void 0===i&&(i=[]);for(var s=t;s<=e;s++)i.push(this._frames[s]);return i},getFrames:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var s=0;s<this._frames.length;s++)i.push(this._frames[s]);else for(s=0;s<t.length;s++)e?i.push(this.getFrame(t[s])):i.push(this.getFrameByName(t[s]));return i},getFrameIndexes:function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=[]),void 0===t||0===t.length)for(var s=0;s<this._frames.length;s++)i.push(this._frames[s].index);else for(s=0;s<t.length;s++)e&&this._frames[t[s]]?i.push(this._frames[t[s]].index):this.getFrameByName(t[s])&&i.push(this.getFrameByName(t[s]).index);return i},destroy:function(){this._frames=null,this._frameNames=null}},n.FrameData.prototype.constructor=n.FrameData,Object.defineProperty(n.FrameData.prototype,"total",{get:function(){return this._frames.length}}),n.AnimationParser={spriteSheet:function(t,e,i,s,o,a,r){var h=e;if("string"==typeof e&&(h=t.cache.getImage(e)),null===h)return null;var l=h.width,c=h.height;i<=0&&(i=Math.floor(-l/Math.min(-1,i))),s<=0&&(s=Math.floor(-c/Math.min(-1,s)));var u=Math.floor((l-a)/(i+r))*Math.floor((c-a)/(s+r));if(-1!==o&&(u=o),0===l||0===c||l<i||c<s||0===u)return null;for(var d=new n.FrameData,p=a,f=a,y=0;y<u;y++)d.addFrame(new n.Frame(y,p,f,i,s,"")),(p+=i+r)+i>l&&(p=a,f+=s+r);return d},JSONData:function(t,e){if(e.frames){for(var i,s=new n.FrameData,o=e.frames,a=0;a<o.length;a++)i=s.addFrame(new n.Frame(a,o[a].frame.x,o[a].frame.y,o[a].frame.w,o[a].frame.h,o[a].filename)),o[a].trimmed&&i.setTrim(o[a].trimmed,o[a].sourceSize.w,o[a].sourceSize.h,o[a].spriteSourceSize.x,o[a].spriteSourceSize.y,o[a].spriteSourceSize.w,o[a].spriteSourceSize.h);return s}},JSONDataPyxel:function(t,e){if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(t){e[t]}),1===e.layers.length){for(var i=new n.FrameData,s=e.tileheight,o=e.tilewidth,a=e.layers[0].tiles,r=0;r<a.length;r++)i.addFrame(new n.Frame(r,a[r].x,a[r].y,o,s,"frame_"+r)).setTrim(!1);return i}},JSONDataHash:function(t,e){if(e.frames){var i,s=new n.FrameData,o=e.frames,a=0;for(var r in o)i=s.addFrame(new n.Frame(a,o[r].frame.x,o[r].frame.y,o[r].frame.w,o[r].frame.h,r)),o[r].trimmed&&i.setTrim(o[r].trimmed,o[r].sourceSize.w,o[r].sourceSize.h,o[r].spriteSourceSize.x,o[r].spriteSourceSize.y,o[r].spriteSourceSize.w,o[r].spriteSourceSize.h),a++;return s}},XMLData:function(t,e){if(e.getElementsByTagName("TextureAtlas")){for(var i,s,o,a,r,h,l,c,u,d,p,f=new n.FrameData,y=e.getElementsByTagName("SubTexture"),g=0;g<y.length;g++)s=(o=y[g].attributes).name.value,a=parseInt(o.x.value,10),r=parseInt(o.y.value,10),h=parseInt(o.width.value,10),l=parseInt(o.height.value,10),c=null,u=null,o.frameX&&(c=Math.abs(parseInt(o.frameX.value,10)),u=Math.abs(parseInt(o.frameY.value,10)),d=parseInt(o.frameWidth.value,10),p=parseInt(o.frameHeight.value,10)),i=f.addFrame(new n.Frame(g,a,r,h,l,s)),null===c&&null===u||i.setTrim(!0,h,l,c,u,d,p);return f}}},n.Cache=function(t){this.game=t,this.autoResolveURL=!1,this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.onSoundUnlock=new n.Signal,this._cacheMap=[],this._cacheMap[n.Cache.CANVAS]=this._cache.canvas,this._cacheMap[n.Cache.IMAGE]=this._cache.image,this._cacheMap[n.Cache.TEXTURE]=this._cache.texture,this._cacheMap[n.Cache.SOUND]=this._cache.sound,this._cacheMap[n.Cache.TEXT]=this._cache.text,this._cacheMap[n.Cache.PHYSICS]=this._cache.physics,this._cacheMap[n.Cache.TILEMAP]=this._cache.tilemap,this._cacheMap[n.Cache.BINARY]=this._cache.binary,this._cacheMap[n.Cache.BITMAPDATA]=this._cache.bitmapData,this._cacheMap[n.Cache.BITMAPFONT]=this._cache.bitmapFont,this._cacheMap[n.Cache.JSON]=this._cache.json,this._cacheMap[n.Cache.XML]=this._cache.xml,this._cacheMap[n.Cache.VIDEO]=this._cache.video,this._cacheMap[n.Cache.SHADER]=this._cache.shader,this._cacheMap[n.Cache.RENDER_TEXTURE]=this._cache.renderTexture,this.addDefaultImage(),this.addMissingImage()},n.Cache.CANVAS=1,n.Cache.IMAGE=2,n.Cache.TEXTURE=3,n.Cache.SOUND=4,n.Cache.TEXT=5,n.Cache.PHYSICS=6,n.Cache.TILEMAP=7,n.Cache.BINARY=8,n.Cache.BITMAPDATA=9,n.Cache.BITMAPFONT=10,n.Cache.JSON=11,n.Cache.XML=12,n.Cache.VIDEO=13,n.Cache.SHADER=14,n.Cache.RENDER_TEXTURE=15,n.Cache.DEFAULT=null,n.Cache.MISSING=null,n.Cache.prototype={addCanvas:function(t,e,i){void 0===i&&(i=e.getContext("2d")),this._cache.canvas[t]={canvas:e,context:i}},addImage:function(t,e,i){this.checkImageKey(t)&&this.removeImage(t);var s={key:t,url:e,data:i,base:new PIXI.BaseTexture(i),frame:new n.Frame(0,0,0,i.width,i.height,t),frameData:new n.FrameData};return s.frameData.addFrame(new n.Frame(0,0,0,i.width,i.height,e)),this._cache.image[t]=s,this._resolveURL(e,s),"__default"===t?n.Cache.DEFAULT=new PIXI.Texture(s.base):"__missing"===t&&(n.Cache.MISSING=new PIXI.Texture(s.base)),s},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";var e=this.addImage("__default",null,t);e.base.skipRender=!0,n.Cache.DEFAULT=new PIXI.Texture(e.base)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";var e=this.addImage("__missing",null,t);n.Cache.MISSING=new PIXI.Texture(e.base)},addSound:function(t,e,i,s,n){void 0===s&&(s=!0,n=!1),void 0===n&&(s=!1,n=!0);var o=!1;n&&(o=!0),this._cache.sound[t]={url:e,data:i,isDecoding:!1,decoded:o,webAudio:s,audioTag:n,locked:this.game.sound.touchLocked},this._resolveURL(e,this._cache.sound[t])},addText:function(t,e,i){this._cache.text[t]={url:e,data:i},this._resolveURL(e,this._cache.text[t])},addPhysicsData:function(t,e,i,s){this._cache.physics[t]={url:e,data:i,format:s},this._resolveURL(e,this._cache.physics[t])},addTilemap:function(t,e,i,s){this._cache.tilemap[t]={url:e,data:i,format:s},this._resolveURL(e,this._cache.tilemap[t])},addBinary:function(t,e){this._cache.binary[t]=e},addBitmapData:function(t,e,i){return e.key=t,void 0===i&&(i=new n.FrameData).addFrame(e.textureFrame),this._cache.bitmapData[t]={data:e,frameData:i},e},addBitmapFont:function(t,e,i,s,o,a,r){var h={url:e,data:i,font:null,base:new PIXI.BaseTexture(i)};void 0===a&&(a=0),void 0===r&&(r=0),h.font="json"===o?n.LoaderParser.jsonBitmapFont(s,h.base,a,r):n.LoaderParser.xmlBitmapFont(s,h.base,a,r),this._cache.bitmapFont[t]=h,this._resolveURL(e,h)},addJSON:function(t,e,i){this._cache.json[t]={url:e,data:i},this._resolveURL(e,this._cache.json[t])},addXML:function(t,e,i){this._cache.xml[t]={url:e,data:i},this._resolveURL(e,this._cache.xml[t])},addVideo:function(t,e,i,s){this._cache.video[t]={url:e,data:i,isBlob:s,locked:!0},this._resolveURL(e,this._cache.video[t])},addShader:function(t,e,i){this._cache.shader[t]={url:e,data:i},this._resolveURL(e,this._cache.shader[t])},addRenderTexture:function(t,e){this._cache.renderTexture[t]={texture:e,frame:new n.Frame(0,0,0,e.width,e.height,"","")}},addSpriteSheet:function(t,e,i,s,o,a,r,h){void 0===a&&(a=-1),void 0===r&&(r=0),void 0===h&&(h=0);var l={key:t,url:e,data:i,frameWidth:s,frameHeight:o,margin:r,spacing:h,base:new PIXI.BaseTexture(i),frameData:n.AnimationParser.spriteSheet(this.game,i,s,o,a,r,h)};this._cache.image[t]=l,this._resolveURL(e,l)},addTextureAtlas:function(t,e,i,s,o){var a={key:t,url:e,data:i,base:new PIXI.BaseTexture(i)};o===n.Loader.TEXTURE_ATLAS_XML_STARLING?a.frameData=n.AnimationParser.XMLData(this.game,s,t):o===n.Loader.TEXTURE_ATLAS_JSON_PYXEL?a.frameData=n.AnimationParser.JSONDataPyxel(this.game,s,t):Array.isArray(s.frames)?a.frameData=n.AnimationParser.JSONData(this.game,s,t):a.frameData=n.AnimationParser.JSONDataHash(this.game,s,t),this._cache.image[t]=a,this._resolveURL(e,a)},reloadSound:function(t){var e=this,i=this.getSound(t);i&&(i.data.src=i.url,i.data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},!1),i.data.load())},reloadSoundComplete:function(t){var e=this.getSound(t);e&&(e.locked=!1,this.onSoundUnlock.dispatch(t))},updateSound:function(t,e,i){var s=this.getSound(t);s&&(s[e]=i)},decodedSound:function(t,e){var i=this.getSound(t);i.data=e,i.decoded=!0,i.isDecoding=!1},isSoundDecoded:function(t){var e=this.getItem(t,n.Cache.SOUND,"isSoundDecoded");if(e)return e.decoded},isSoundReady:function(t){var e=this.getItem(t,n.Cache.SOUND,"isSoundDecoded");if(e)return e.decoded&&!this.game.sound.touchLocked},checkKey:function(t,e){return!!this._cacheMap[t][e]},checkURL:function(t){return!!this._urlMap[this._resolveURL(t)]},checkCanvasKey:function(t){return this.checkKey(n.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(n.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(n.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(n.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(n.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(n.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(n.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(n.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(n.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(n.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(n.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(n.Cache.XML,t)},checkVideoKey:function(t){return this.checkKey(n.Cache.VIDEO,t)},checkShaderKey:function(t){return this.checkKey(n.Cache.SHADER,t)},checkRenderTextureKey:function(t){return this.checkKey(n.Cache.RENDER_TEXTURE,t)},getItem:function(t,e,i,s){return this.checkKey(e,t)?void 0===s?this._cacheMap[e][t]:this._cacheMap[e][t][s]:null},getCanvas:function(t){return this.getItem(t,n.Cache.CANVAS,"getCanvas","canvas")},getImage:function(t,e){null!=t||(t="__default"),void 0===e&&(e=!1);var i=this.getItem(t,n.Cache.IMAGE,"getImage");return null===i&&(i=this.getItem("__missing",n.Cache.IMAGE,"getImage")),e?i:i.data},getTextureFrame:function(t){return this.getItem(t,n.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(t){return this.getItem(t,n.Cache.SOUND,"getSound")},getSoundData:function(t){return this.getItem(t,n.Cache.SOUND,"getSoundData","data")},getText:function(t){return this.getItem(t,n.Cache.TEXT,"getText","data")},getPhysicsData:function(t,e,i){var s=this.getItem(t,n.Cache.PHYSICS,"getPhysicsData","data");if(null===s||null==e)return s;if(s[e]){var o=s[e];if(!o||!i)return o;for(var a in o)if((a=o[a]).fixtureKey===i)return a}return null},getTilemapData:function(t){return this.getItem(t,n.Cache.TILEMAP,"getTilemapData")},getBinary:function(t){return this.getItem(t,n.Cache.BINARY,"getBinary")},getBitmapData:function(t){return this.getItem(t,n.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(t){return this.getItem(t,n.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(t,e){var i=this.getItem(t,n.Cache.JSON,"getJSON","data");return i?e?n.Utils.extend(!0,Array.isArray(i)?[]:{},i):i:null},getXML:function(t){return this.getItem(t,n.Cache.XML,"getXML","data")},getVideo:function(t){return this.getItem(t,n.Cache.VIDEO,"getVideo")},getShader:function(t){return this.getItem(t,n.Cache.SHADER,"getShader","data")},getRenderTexture:function(t){return this.getItem(t,n.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(t,e){return void 0===e&&(e=n.Cache.IMAGE),this.getItem(t,e,"getBaseTexture","base")},getFrame:function(t,e){return void 0===e&&(e=n.Cache.IMAGE),this.getItem(t,e,"getFrame","frame")},getFrameCount:function(t,e){var i=this.getFrameData(t,e);return i?i.total:0},getFrameData:function(t,e){return void 0===e&&(e=n.Cache.IMAGE),this.getItem(t,e,"getFrameData","frameData")},hasFrameData:function(t,e){return void 0===e&&(e=n.Cache.IMAGE),null!==this.getItem(t,e,"","frameData")},updateFrameData:function(t,e,i){void 0===i&&(i=n.Cache.IMAGE),this._cacheMap[i][t]&&(this._cacheMap[i][t].frameData=e)},getFrameByIndex:function(t,e,i){var s=this.getFrameData(t,i);return s?s.getFrame(e):null},getFrameByName:function(t,e,i){var s=this.getFrameData(t,i);return s?s.getFrameByName(e):null},getURL:function(t){return(t=this._resolveURL(t))?this._urlMap[t]:null},getKeys:function(t){void 0===t&&(t=n.Cache.IMAGE);var e=[];if(this._cacheMap[t])for(var i in this._cacheMap[t])"__default"!==i&&"__missing"!==i&&e.push(i);return e},removeCanvas:function(t){delete this._cache.canvas[t]},removeImage:function(t,e){void 0===e&&(e=!0);var i=this.getImage(t,!0);e&&i.base&&i.base.destroy(),delete this._cache.image[t]},removeSound:function(t){delete this._cache.sound[t]},removeText:function(t){delete this._cache.text[t]},removePhysics:function(t){delete this._cache.physics[t]},removeTilemap:function(t){delete this._cache.tilemap[t]},removeBinary:function(t){delete this._cache.binary[t]},removeBitmapData:function(t){delete this._cache.bitmapData[t]},removeBitmapFont:function(t){delete this._cache.bitmapFont[t]},removeJSON:function(t){delete this._cache.json[t]},removeXML:function(t){delete this._cache.xml[t]},removeVideo:function(t){delete this._cache.video[t]},removeShader:function(t){delete this._cache.shader[t]},removeRenderTexture:function(t){delete this._cache.renderTexture[t]},removeSpriteSheet:function(t){delete this._cache.spriteSheet[t]},removeTextureAtlas:function(t){delete this._cache.atlas[t]},clearGLTextures:function(){for(var t in this._cache.image)this._cache.image[t].base._glTextures=[]},_resolveURL:function(t,e){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+t,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",e&&(this._urlMap[this._urlTemp]=e),this._urlTemp):null},destroy:function(){for(var t=0;t<this._cacheMap.length;t++){var e=this._cacheMap[t];for(var i in e)"__default"!==i&&"__missing"!==i&&(e[i].destroy&&e[i].destroy(),delete e[i])}this._urlMap=null,this._urlResolver=null,this._urlTemp=null}},n.Cache.prototype.constructor=n.Cache,n.Loader=function(t){this.game=t,this.cache=t.cache,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.path="",this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"},this.onLoadStart=new n.Signal,this.onLoadComplete=new n.Signal,this.onPackComplete=new n.Signal,this.onFileStart=new n.Signal,this.onFileComplete=new n.Signal,this.onFileError=new n.Signal,this.useXDomainRequest=!1,this._warnedAboutXDomainRequest=!1,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},n.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,n.Loader.TEXTURE_ATLAS_JSON_HASH=1,n.Loader.TEXTURE_ATLAS_XML_STARLING=2,n.Loader.PHYSICS_LIME_CORONA_JSON=3,n.Loader.PHYSICS_PHASER_JSON=4,n.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,n.Loader.prototype={setPreloadSprite:function(t,e){e=e||0,this.preloadSprite={sprite:t,direction:e,width:t.width,height:t.height,rect:null},this.preloadSprite.rect=0===e?new n.Rectangle(0,0,1,t.height):new n.Rectangle(0,0,t.width,1),t.crop(this.preloadSprite.rect),t.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(t,e){return this.getAssetIndex(t,e)>-1},getAssetIndex:function(t,e){for(var i=-1,s=0;s<this._fileList.length;s++){var n=this._fileList[s];if(n.type===t&&n.key===e&&(i=s,!n.loaded&&!n.loading))break}return i},getAsset:function(t,e){var i=this.getAssetIndex(t,e);return i>-1&&{index:i,file:this._fileList[i]}},reset:function(t,e){void 0===e&&(e=!1),this.resetLocked||(t&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,e&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(t,e,i,s,n,o){if(void 0===n&&(n=!1),void 0===e||""===e)return this;if(null==i){if(!o)return this;i=e+o}var a={type:t,key:e,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(s)for(var r in s)a[r]=s[r];var h=this.getAssetIndex(t,e);if(n&&h>-1){var l=this._fileList[h];l.loading||l.loaded?(this._fileList.push(a),this._totalFileCount++):this._fileList[h]=a}else-1===h&&(this._fileList.push(a),this._totalFileCount++);return this},replaceInFileList:function(t,e,i,s){return this.addToFileList(t,e,i,s,!0)},pack:function(t,e,i,s){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null),!e&&!i)return this;var n={type:"packfile",key:t,url:e,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:s};i&&("string"==typeof i&&(i=JSON.parse(i)),n.data=i||{},n.loaded=!0);for(var o=0;o<this._fileList.length+1;o++){var a=this._fileList[o];if(!a||!a.loaded&&!a.loading&&"packfile"!==a.type){this._fileList.splice(o,0,n),this._totalPackCount++;break}}return this},image:function(t,e,i){return this.addToFileList("image",t,e,void 0,i,".png")},images:function(t,e){if(Array.isArray(e))for(var i=0;i<t.length;i++)this.image(t[i],e[i]);else for(i=0;i<t.length;i++)this.image(t[i]);return this},text:function(t,e,i){return this.addToFileList("text",t,e,void 0,i,".txt")},json:function(t,e,i){return this.addToFileList("json",t,e,void 0,i,".json")},shader:function(t,e,i){return this.addToFileList("shader",t,e,void 0,i,".frag")},xml:function(t,e,i){return this.addToFileList("xml",t,e,void 0,i,".xml")},script:function(t,e,i,s){return void 0===i&&(i=!1),!1!==i&&void 0===s&&(s=this),this.addToFileList("script",t,e,{syncPoint:!0,callback:i,callbackContext:s},!1,".js")},binary:function(t,e,i,s){return void 0===i&&(i=!1),!1!==i&&void 0===s&&(s=i),this.addToFileList("binary",t,e,{callback:i,callbackContext:s},!1,".bin")},spritesheet:function(t,e,i,s,n,o,a){return void 0===n&&(n=-1),void 0===o&&(o=0),void 0===a&&(a=0),this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:s,frameMax:n,margin:o,spacing:a},!1,".png")},audio:function(t,e,i){return this.game.sound.noAudio?this:(void 0===i&&(i=!0),"string"==typeof e&&(e=[e]),this.addToFileList("audio",t,e,{buffer:null,autoDecode:i}))},audioSprite:function(t,e,i,s,n){return this.game.sound.noAudio?this:(void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!0),this.audio(t,e,n),i?this.json(t+"-audioatlas",i):s&&("string"==typeof s&&(s=JSON.parse(s)),this.cache.addJSON(t+"-audioatlas","",s)),this)},audiosprite:function(t,e,i,s,n){return this.audioSprite(t,e,i,s,n)},video:function(t,e,i,s){return void 0===i&&(i=this.game.device.firefox?"loadeddata":"canplaythrough"),void 0===s&&(s=!1),"string"==typeof e&&(e=[e]),this.addToFileList("video",t,e,{buffer:null,asBlob:s,loadEvent:i})},tilemap:function(t,e,i,s){if(void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=n.Tilemap.CSV),e||i||(e=s===n.Tilemap.CSV?t+".csv":t+".json"),i){switch(s){case n.Tilemap.CSV:break;case n.Tilemap.TILED_JSON:"string"==typeof i&&(i=JSON.parse(i))}this.cache.addTilemap(t,null,i,s)}else this.addToFileList("tilemap",t,e,{format:s});return this},physics:function(t,e,i,s){return void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=n.Physics.LIME_CORONA_JSON),e||i||(e=t+".json"),i?("string"==typeof i&&(i=JSON.parse(i)),this.cache.addPhysicsData(t,null,i,s)):this.addToFileList("physics",t,e,{format:s}),this},bitmapFont:function(t,e,i,s,n,o){if(null!=e||(e=t+".png"),void 0===i&&(i=null),void 0===s&&(s=null),null===i&&null===s&&(i=t+".xml"),void 0===n&&(n=0),void 0===o&&(o=0),i)this.addToFileList("bitmapfont",t,e,{atlasURL:i,xSpacing:n,ySpacing:o});else if("string"==typeof s){var a,r;try{a=JSON.parse(s)}catch(t){r=this.parseXml(s)}if(!r&&!a)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",t,e,{atlasURL:null,atlasData:a||r,atlasType:a?"json":"xml",xSpacing:n,ySpacing:o})}return this},atlasJSONArray:function(t,e,i,s){return this.atlas(t,e,i,s,n.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,e,i,s){return this.atlas(t,e,i,s,n.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,e,i,s){return void 0===i&&(i=null),void 0===s&&(s=null),i||s||(i=t+".xml"),this.atlas(t,e,i,s,n.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,e,i,s,o){if(null!=e||(e=t+".png"),void 0===i&&(i=null),void 0===s&&(s=null),void 0===o&&(o=n.Loader.TEXTURE_ATLAS_JSON_ARRAY),i||s||(i=o===n.Loader.TEXTURE_ATLAS_XML_STARLING?t+".xml":t+".json"),i)this.addToFileList("textureatlas",t,e,{atlasURL:i,format:o});else{switch(o){case n.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof s&&(s=JSON.parse(s));break;case n.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof s){var a=this.parseXml(s);if(!a)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");s=a}}this.addToFileList("textureatlas",t,e,{atlasURL:null,atlasData:s,format:o})}return this},withSyncPoint:function(t,e){this._withSyncPointDepth++;try{t.call(e||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(t,e){var i=this.getAsset(t,e);return i&&(i.file.syncPoint=!0),this},removeFile:function(t,e){var i=this.getAsset(t,e);i&&(i.loaded||i.loading||this._fileList.splice(i.index,1))},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(this.isLoading){for(var t=0;t<this._flightQueue.length;t++){((s=this._flightQueue[t]).loaded||s.error)&&(this._flightQueue.splice(t,1),t--,s.loading=!1,s.requestUrl=null,s.requestObject=null,s.error&&this.onFileError.dispatch(s.key,s),"packfile"!==s.type?(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,s.key,!s.error,this._loadedFileCount,this._totalFileCount)):"packfile"===s.type&&s.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(s.key,!s.error,this._loadedPackCount,this._totalPackCount)))}var e=!1,i=this.enableParallel?n.Math.clamp(this.maxParallelDownloads,1,12):1;for(t=this._processingHead;t<this._fileList.length;t++){var s;if("packfile"===(s=this._fileList[t]).type&&!s.error&&s.loaded&&t===this._processingHead&&(this.processPack(s),this._loadedPackCount++,this.onPackComplete.dispatch(s.key,!s.error,this._loadedPackCount,this._totalPackCount)),s.loaded||s.error?t===this._processingHead&&(this._processingHead=t+1):!s.loading&&this._flightQueue.length<i&&("packfile"!==s.type||s.data?e||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(s),s.loading=!0,this.onFileStart.dispatch(this.progress,s.key,s.url),this.loadFile(s)):(this._flightQueue.push(s),s.loading=!0,this.loadFile(s))),!s.loaded&&s.syncPoint&&(e=!0),this._flightQueue.length>=i||e&&this._loadedPackCount===this._totalPackCount)break}if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){var o=this;setTimeout(function(){o.finishedLoading(!0)},2e3)}}else this.finishedLoading(!0)},finishedLoading:function(t){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,t||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.onLoadComplete.dispatch(),this.game.state.loadComplete(),this.reset())},asyncComplete:function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,e&&(t.errorMessage=e),this.processLoadQueue()},processPack:function(t){var e=t.data[t.key];if(e)for(var i=0;i<e.length;i++){var s=e[i];switch(s.type){case"image":this.image(s.key,s.url,s.overwrite);break;case"text":this.text(s.key,s.url,s.overwrite);break;case"json":this.json(s.key,s.url,s.overwrite);break;case"xml":this.xml(s.key,s.url,s.overwrite);break;case"script":this.script(s.key,s.url,s.callback,t.callbackContext||this);break;case"binary":this.binary(s.key,s.url,s.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(s.key,s.url,s.frameWidth,s.frameHeight,s.frameMax,s.margin,s.spacing);break;case"video":this.video(s.key,s.urls);break;case"audio":this.audio(s.key,s.urls,s.autoDecode);break;case"audiosprite":this.audiosprite(s.key,s.urls,s.jsonURL,s.jsonData,s.autoDecode);break;case"tilemap":this.tilemap(s.key,s.url,s.data,n.Tilemap[s.format]);break;case"physics":this.physics(s.key,s.url,s.data,n.Loader[s.format]);break;case"bitmapFont":this.bitmapFont(s.key,s.textureURL,s.atlasURL,s.atlasData,s.xSpacing,s.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlasXML":this.atlasXML(s.key,s.textureURL,s.atlasURL,s.atlasData);break;case"atlas":this.atlas(s.key,s.textureURL,s.atlasURL,s.atlasData,n.Loader[s.format]);break;case"shader":this.shader(s.key,s.url,s.overwrite)}}},transformUrl:function(t,e){return!!t&&(t.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?t:this.baseURL+e.path+t)},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url),t.url?this.game.sound.usingWebAudio?this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(t):this.fileError(t,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":t.url=this.getVideoURL(t.url),t.url?t.asBlob?this.xhrLoad(t,this.transformUrl(t.url,t),"blob",this.fileComplete):this.loadVideoTag(t):this.fileError(t,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":t.format===n.Tilemap.TILED_JSON?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete):t.format===n.Tilemap.CSV?this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete):this.asyncComplete(t,"invalid Tilemap format: "+t.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}},loadImageTag:function(t){var e=this;t.data=new Image,t.data.name=t.key,this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.onload=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileComplete(t))},t.data.onerror=function(){t.data.onload&&(t.data.onload=null,t.data.onerror=null,e.fileError(t))},t.data.src=this.transformUrl(t.url,t),t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,this.fileComplete(t))},loadVideoTag:function(t){var e=this;t.data=document.createElement("video"),t.data.name=t.key,t.data.controls=!1,t.data.autoplay=!1;var i=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!0,n.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener(t.loadEvent,i,!1),t.data.onerror=null,t.data.canplay=!1,e.fileError(t)},t.data.addEventListener(t.loadEvent,i,!1),t.data.src=this.transformUrl(t.url,t),t.data.load()},loadAudioTag:function(t){var e=this;if(this.game.sound.touchLocked)t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),this.fileComplete(t);else{t.data=new Audio,t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.onerror=null,e.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.onerror=null,e.fileError(t)},t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",i,!1),t.data.load()}},xhrLoad:function(t,e,i,s,n){if(this.useXDomainRequest&&window.XDomainRequest)this.xhrLoadWithXDR(t,e,i,s,n);else{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=i,!1!==this.headers.requestedWith&&o.setRequestHeader("X-Requested-With",this.headers.requestedWith),this.headers[t.type]&&o.setRequestHeader("Accept",this.headers[t.type]),n=n||this.fileError;var a=this;o.onload=function(){try{return 4===o.readyState&&o.status>=400&&o.status<=599?n.call(a,t,o):s.call(a,t,o)}catch(e){a.hasLoaded?window.console:a.asyncComplete(t,e.message||"Exception")}},o.onerror=function(){try{return n.call(a,t,o)}catch(e){a.hasLoaded?window.console:a.asyncComplete(t,e.message||"Exception")}},t.requestObject=o,t.requestUrl=e,o.send()}},xhrLoadWithXDR:function(t,e,i,s,n){this._warnedAboutXDomainRequest||this.game.device.ie&&!(this.game.device.ieVersion>=10)||(this._warnedAboutXDomainRequest=!0);var o=new window.XDomainRequest;o.open("GET",e,!0),o.responseType=i,o.timeout=3e3,n=n||this.fileError;var a=this;o.onerror=function(){try{return n.call(a,t,o)}catch(e){a.asyncComplete(t,e.message||"Exception")}},o.ontimeout=function(){try{return n.call(a,t,o)}catch(e){a.asyncComplete(t,e.message||"Exception")}},o.onprogress=function(){},o.onload=function(){try{return 4===o.readyState&&o.status>=400&&o.status<=599?n.call(a,t,o):s.call(a,t,o)}catch(e){a.asyncComplete(t,e.message||"Exception")}},t.requestObject=o,t.requestUrl=e,setTimeout(function(){o.send()},0)},getVideoURL:function(t){for(var e=0;e<t.length;e++){var i,s=t[e];if(s.uri){if(i=s.type,s=s.uri,this.game.device.canPlayVideo(i))return s}else{if(0===s.indexOf("blob:")||0===s.indexOf("data:"))return s;if(s.indexOf("?")>=0&&(s=s.substr(0,s.indexOf("?"))),i=s.substr((Math.max(0,s.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayVideo(i))return t[e]}}return null},getAudioURL:function(t){if(this.game.sound.noAudio)return null;for(var e=0;e<t.length;e++){var i,s=t[e];if(s.uri){if(i=s.type,s=s.uri,this.game.device.canPlayAudio(i))return s}else{if(0===s.indexOf("blob:")||0===s.indexOf("data:"))return s;if(s.indexOf("?")>=0&&(s=s.substr(0,s.indexOf("?"))),i=s.substr((Math.max(0,s.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayAudio(i))return t[e]}}return null},fileError:function(t,e,i){var s="error loading asset from URL "+(t.requestUrl||this.transformUrl(t.url,t));!i&&e&&(i=e.status),i&&(s=s+" ("+i+")"),this.asyncComplete(t,s)},fileComplete:function(t,e){var i=!0;switch(t.type){case"packfile":var s=JSON.parse(e.responseText);t.data=s||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(null==t.atlasURL)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(i=!1,t.format===n.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format===n.Loader.TEXTURE_ATLAS_JSON_HASH||t.format===n.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else{if(t.format!==n.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}break;case"bitmapfont":t.atlasURL?(i=!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}i?(t.atlasType="json",this.jsonLoadComplete(t,e)):(t.atlasType="xml",this.xmlLoadComplete(t,e))})):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=e.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=e.responseText,this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText,this.cache.addShader(t.key,t.url,t.data);break;case"physics":s=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,s,t.format);break;case"script":t.data=document.createElement("script"),t.data.language="javascript",t.data.type="text/javascript",t.data.defer=!1,t.data.text=e.responseText,document.head.appendChild(t.data),t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,e.responseText));break;case"binary":t.callback?t.data=t.callback.call(t.callbackContext,t.key,e.response):t.data=e.response,this.cache.addBinary(t.key,t.data)}i&&this.asyncComplete(t)},jsonLoadComplete:function(t,e){var i=JSON.parse(e.responseText);"tilemap"===t.type?this.cache.addTilemap(t.key,t.url,i,t.format):"bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,i,t.atlasType,t.xSpacing,t.ySpacing):"json"===t.type?this.cache.addJSON(t.key,t.url,i):this.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format),this.asyncComplete(t)},csvLoadComplete:function(t,e){var i=e.responseText;this.cache.addTilemap(t.key,t.url,i,t.format),this.asyncComplete(t)},xmlLoadComplete:function(t,e){var i=e.responseText,s=this.parseXml(i);if(s)"bitmapfont"===t.type?this.cache.addBitmapFont(t.key,t.url,t.data,s,t.atlasType,t.xSpacing,t.ySpacing):"textureatlas"===t.type?this.cache.addTextureAtlas(t.key,t.url,t.data,s,t.format):"xml"===t.type&&this.cache.addXML(t.key,t.url,s),this.asyncComplete(t);else{e.responseType||e.contentType;this.asyncComplete(t,"invalid XML")}},parseXml:function(t){var e;try{if(window.DOMParser)e=(new DOMParser).parseFromString(t,"text/xml");else(e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)}catch(t){e=null}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(n.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return n.Math.clamp(t||0,0,100)}}),Object.defineProperty(n.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}}),n.Loader.prototype.constructor=n.Loader,n.LoaderParser={bitmapFont:function(t,e,i,s){return this.xmlBitmapFont(t,e,i,s)},xmlBitmapFont:function(t,e,i,s){var n={},o=t.getElementsByTagName("info")[0],a=t.getElementsByTagName("common")[0];n.font=o.getAttribute("face"),n.size=parseInt(o.getAttribute("size"),10),n.lineHeight=parseInt(a.getAttribute("lineHeight"),10)+s,n.chars={};for(var r=t.getElementsByTagName("char"),h=0;h<r.length;h++){var l=parseInt(r[h].getAttribute("id"),10);n.chars[l]={x:parseInt(r[h].getAttribute("x"),10),y:parseInt(r[h].getAttribute("y"),10),width:parseInt(r[h].getAttribute("width"),10),height:parseInt(r[h].getAttribute("height"),10),xOffset:parseInt(r[h].getAttribute("xoffset"),10),yOffset:parseInt(r[h].getAttribute("yoffset"),10),xAdvance:parseInt(r[h].getAttribute("xadvance"),10)+i,kerning:{}}}var c=t.getElementsByTagName("kerning");for(h=0;h<c.length;h++){var u=parseInt(c[h].getAttribute("first"),10),d=parseInt(c[h].getAttribute("second"),10),p=parseInt(c[h].getAttribute("amount"),10);n.chars[d].kerning[u]=p}return this.finalizeBitmapFont(e,n)},jsonBitmapFont:function(t,e,i,s){var n={font:t.font.info._face,size:parseInt(t.font.info._size,10),lineHeight:parseInt(t.font.common._lineHeight,10)+s,chars:{}};return t.font.chars.char.forEach(function(t){var e=parseInt(t._id,10);n.chars[e]={x:parseInt(t._x,10),y:parseInt(t._y,10),width:parseInt(t._width,10),height:parseInt(t._height,10),xOffset:parseInt(t._xoffset,10),yOffset:parseInt(t._yoffset,10),xAdvance:parseInt(t._xadvance,10)+i,kerning:{}}}),t.font.kernings&&t.font.kernings.kerning&&t.font.kernings.kerning.forEach(function(t){n.chars[t._second].kerning[t._first]=parseInt(t._amount,10)}),this.finalizeBitmapFont(e,n)},finalizeBitmapFont:function(t,e){return Object.keys(e.chars).forEach(function(i){var s=e.chars[i];s.texture=new PIXI.Texture(t,new n.Rectangle(s.x,s.y,s.width,s.height))}),e}},n.AudioSprite=function(t,e){for(var i in this.game=t,this.key=e,this.config=this.game.cache.getJSON(e+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={},this.config.spritemap){var s=this.config.spritemap[i],n=this.game.add.sound(this.key);n.addMarker(i,s.start,s.end-s.start,null,s.loop),this.sounds[i]=n}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},n.AudioSprite.prototype={play:function(t,e){return void 0===e&&(e=1),this.sounds[t].play(t,null,e)},stop:function(t){if(t)this.sounds[t].stop();else for(var e in this.sounds)this.sounds[e].stop()},get:function(t){return this.sounds[t]}},n.AudioSprite.prototype.constructor=n.AudioSprite,n.Sound=function(t,e,i,s,o){void 0===i&&(i=1),void 0===s&&(s=!1),void 0===o&&(o=t.sound.connectToMaster),this.game=t,this.name=e,this.key=e,this.loop=s,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,void 0===this.context.createGain?this.gainNode=this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=i*this.game.sound.volume,o&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(e)&&this.game.cache.isSoundReady(e)?(this._sound=this.game.cache.getSoundData(e),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new n.Signal,this.onPlay=new n.Signal,this.onPause=new n.Signal,this.onResume=new n.Signal,this.onLoop=new n.Signal,this.onStop=new n.Signal,this.onMute=new n.Signal,this.onMarkerComplete=new n.Signal,this.onFadeComplete=new n.Signal,this._volume=i,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempPause=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},n.Sound.prototype={soundHasUnlocked:function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(t,e,i,s,n){null!=i||(i=1),null!=s||(s=1),void 0===n&&(n=!1),this.markers[t]={name:t,start:e,stop:e+i,volume:s,duration:i,durationMS:1e3*i,loop:n}},removeMarker:function(t){delete this.markers[t]},onEndedHandler:function(){this._sound.onended=null,this.isPlaying=!1,this.currentTime=this.durationMS,this.stop()},update:function(){this.game.cache.checkSoundKey(this.key)?(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=this.game.time.time),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))):this.destroy()},loopFull:function(t){return this.play(null,0,t,!0)},play:function(t,e,i,s,n){if(void 0!==t&&!1!==t&&null!==t||(t=""),void 0===n&&(n=!0),this.isPlaying&&!this.allowMultiple&&!n&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||n)){if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1}if(""===t&&Object.keys(this.markers).length>0)return this;if(""!==t){if(!this.markers[t])return this;this.currentMarker=t,this.position=this.markers[t].start,this.volume=this.markers[t].volume,this.loop=this.markers[t].loop,this.duration=this.markers[t].duration,this.durationMS=this.markers[t].durationMS,void 0!==i&&(this.volume=i),void 0!==s&&(this.loop=s),this._tempMarker=t,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else e=e||0,void 0===i&&(i=this._volume),void 0===s&&(s=this.loop),this.position=Math.max(0,e),this.volume=i,this.loop=s,this.duration=0,this.durationMS=0,this._tempMarker=t,this._tempPosition=e,this._tempVolume=i,this._tempLoop=s;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._sound=this.context.createBufferSource(),this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),this._sound.buffer=this._buffer,this.loop&&""===t&&(this._sound.loop=!0),this.loop||""!==t||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),void 0===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===t?this._sound.start(0,0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted||this.game.sound.mute?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(t,e,i,s){t=t||"",e=e||0,i=i||1,void 0===s&&(s=!1),this.play(t,e,i,s,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=Math.max(0,this.position+this.pausedPosition/1e3);this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var e=this.duration-this.pausedPosition/1e3;void 0===this._sound.start?this._sound.noteGrainOn(0,t,e):this.loop&&this.game.device.chrome?42===this.game.device.chromeVersion?this._sound.start(0):this._sound.start(0,t):this._sound.start(0,t,e)}else this._sound.currentTime=this._tempPause,this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio){if(void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var t=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,t)}},fadeIn:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=this.currentMarker),this.paused||(this.play(i,0,0,e),this.fadeTo(t,1))},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,e){this.isPlaying&&!this.paused&&e!==this.volume&&(void 0===t&&(t=1e3),void 0!==e&&(this.fadeTween=this.game.add.tween(this).to({volume:e},t,n.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this)))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},updateGlobalVolume:function(t){this.usingAudioTag&&this._sound&&(this._sound.volume=t*this._volume)},destroy:function(t){void 0===t&&(t=!0),this.stop(),t?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},n.Sound.prototype.constructor=n.Sound,Object.defineProperty(n.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(n.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(n.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){(t=t||!1)!==this._muted&&(t?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}}),Object.defineProperty(n.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){this.game.device.firefox&&this.usingAudioTag&&(t=this.game.math.clamp(t,0,1)),this._muted?this._muteVolume=t:(this._tempVolume=t,this._volume=t,this.usingWebAudio?this.gainNode.gain.value=t:this.usingAudioTag&&this._sound&&(this._sound.volume=t))}}),n.SoundManager=function(t){this.game=t,this.onSoundDecode=new n.Signal,this.onVolumeChange=new n.Signal,this.onMute=new n.Signal,this.onUnMute=new n.Signal,this.context=null,this.usingWebAudio=!1,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32,this.muteOnPause=!0,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new n.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null},n.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&!1===this.game.device.webAudio&&(this.channels=1),window.PhaserGlobal){if(!0===window.PhaserGlobal.disableAudio)return this.noAudio=!0,void(this.touchLocked=!1);if(!0===window.PhaserGlobal.disableWebAudio)return this.usingAudioTag=!0,void(this.touchLocked=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1}if(null===this.context){if(void 0===window.Audio)return void(this.noAudio=!0);this.usingAudioTag=!0}else this.usingWebAudio=!0,void 0===this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination);this.noAudio||!this.game.device.cocoonJS&&(this.game.device.android||this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)&&this.setTouchLock()},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableAudio||(this.game.device.iOSVersion>8||this.game.device.chromeVersion>=55?this.game.input.touch.addTouchLockCallback(this.unlock,this,!0):this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0)},unlock:function(){if(this.noAudio||!this.touchLocked||null!==this._unlockSource)return!0;if(this.usingAudioTag)this.touchLocked=!1,this._unlockSource=null;else if(this.usingWebAudio){var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0),"suspended"===this._unlockSource.context.state&&this._unlockSource.context.resume()}return!0},stopAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].stop()},pauseAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].pause()},resumeAll:function(){if(!this.noAudio)for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].resume()},decode:function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i&&!1===this.game.cache.isSoundDecoded(t)){this.game.cache.updateSound(t,"isDecoding",!0);var s=this;try{this.context.decodeAudioData(i,function(i){i&&(s.game.cache.decodedSound(t,i),s.onSoundDecode.dispatch(t,e))})}catch(t){}}},setDecodedCallback:function(t,e,i){"string"==typeof t&&(t=[t]),this._watchList.reset();for(var s=0;s<t.length;s++)t[s]instanceof n.Sound?this.game.cache.isSoundDecoded(t[s].key)||this._watchList.add(t[s].key):this.game.cache.isSoundDecoded(t[s])||this._watchList.add(t[s]);0===this._watchList.total?(this._watching=!1,e.call(i)):(this._watching=!0,this._watchCallback=e,this._watchContext=i)},update:function(){if(!this.noAudio){!this.touchLocked||null===this._unlockSource||this._unlockSource.playbackState!==this._unlockSource.PLAYING_STATE&&this._unlockSource.playbackState!==this._unlockSource.FINISHED_STATE||(this.touchLocked=!1,this._unlockSource=null);for(var t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(var e=this._watchList.first;e;)this.game.cache.isSoundDecoded(e)&&this._watchList.remove(e),e=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(t,e,i,s){void 0===e&&(e=1),void 0===i&&(i=!1),void 0===s&&(s=this.connectToMaster);var o=new n.Sound(this.game,t,e,i,s);return this._sounds.push(o),o},addSprite:function(t){return new n.AudioSprite(this.game,t)},remove:function(t){for(var e=this._sounds.length;e--;)if(this._sounds[e]===t)return this._sounds[e].destroy(!1),this._sounds.splice(e,1),!0;return!1},removeByKey:function(t){for(var e=this._sounds.length,i=0;e--;)this._sounds[e].key===t&&(this._sounds[e].destroy(!1),this._sounds.splice(e,1),i++);return i},play:function(t,e,i){if(!this.noAudio){var s=this.add(t,e,i);return s.play(),s}},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].destroy();this._sounds=[],this.onSoundDecode.dispose(),this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())}},n.SoundManager.prototype.constructor=n.SoundManager,Object.defineProperty(n.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){if(t=t||!1){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(n.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0?t=0:t>1&&(t=1),this._volume!==t){if(this._volume=t,this.usingWebAudio)this.masterGain.gain.value=t;else for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&this._sounds[e].updateGlobalVolume(t);this.onVolumeChange.dispatch(t)}}}),n.ScaleManager=function(t,e,i){this.game=t,this.dom=n.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new n.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.onOrientationChange=new n.Signal,this.enterIncorrectOrientation=new n.Signal,this.leaveIncorrectOrientation=new n.Signal,this.hasPhaserSetFullScreen=!1,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new n.Signal,this.onFullScreenChange=new n.Signal,this.onFullScreenError=new n.Signal,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new n.Point(1,1),this.scaleFactorInversed=new n.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new n.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=n.ScaleManager.NO_SCALE,this._fullScreenScaleMode=n.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new n.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new n.Signal,this.onResize=null,this.onResizeContext=null,this._pendingScaleMode=null,this._fullScreenRestore=null,this._gameSize=new n.Rectangle,this._userScaleFactor=new n.Point(1,1),this._userScaleTrim=new n.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new n.Rectangle,this._tempBounds=new n.Rectangle,this._lastReportedCanvasSize=new n.Rectangle,this._lastReportedGameSize=new n.Rectangle,this._booted=!1,t.config&&this.parseConfig(t.config),this.setupScale(e,i)},n.ScaleManager.EXACT_FIT=0,n.ScaleManager.NO_SCALE=1,n.ScaleManager.SHOW_ALL=2,n.ScaleManager.RESIZE=3,n.ScaleManager.USER_SCALE=4,n.ScaleManager.prototype={boot:function(){var t=this.compatibility;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?t.scrollTo=new n.Point(0,1):t.scrollTo=new n.Point(0,0)),this.game.device.desktop?(t.orientationFallback="screen",t.clickTrampoline="when-not-mouse"):(t.orientationFallback="",t.clickTrampoline="");var e=this;this._orientationChange=function(t){return e.orientationChange(t)},this._windowResize=function(t){return e.windowResize(t)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(t){return e.fullScreenChange(t)},this._fullScreenError=function(t){return e.fullScreenError(t)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),n.FlexGrid&&(this.grid=new n.FlexGrid(this,this.width,this.height)),this._booted=!0,null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(t){void 0!==t.scaleMode&&(this._booted?this.scaleMode=t.scaleMode:this._pendingScaleMode=t.scaleMode),void 0!==t.fullScreenScaleMode&&(this.fullScreenScaleMode=t.fullScreenScaleMode),t.fullScreenTarget&&(this.fullScreenTarget=t.fullScreenTarget)},setupScale:function(t,e){var i,s=new n.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?i=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(i=this.game.parent)),i?(this.parentNode=i,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds),s.width=this._parentBounds.width,s.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,s.width=this.dom.visualBounds.width,s.height=this.dom.visualBounds.height,this.offset.set(0,0));var o=0,a=0;"number"==typeof t?o=t:(this.parentScaleFactor.x=parseInt(t,10)/100,o=s.width*this.parentScaleFactor.x),"number"==typeof e?a=e:(this.parentScaleFactor.y=parseInt(e,10)/100,a=s.height*this.parentScaleFactor.y),o=Math.floor(o),a=Math.floor(a),this._gameSize.setTo(0,0,o,a),this.updateDimensions(o,a,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(t,e){this._gameSize.setTo(0,0,t,e),this.currentScaleMode!==n.ScaleManager.RESIZE&&this.updateDimensions(t,e,!0),this.queueUpdate(!0)},setUserScale:function(t,e,i,s){this._userScaleFactor.setTo(t,e),this._userScaleTrim.setTo(0|i,0|s),this.queueUpdate(!0)},setResizeCallback:function(t,e){this.onResize=t,this.onResizeContext=e},signalSizeChange:function(){if(!n.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!n.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var t=this.width,e=this.height;this._lastReportedCanvasSize.setTo(0,0,t,e),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid&&this.grid.onResize(t,e),this.onSizeChange.dispatch(this,t,e),this.currentScaleMode===n.ScaleManager.RESIZE&&(this.game.state.resize(t,e),this.game.load.resize(t,e))}},setMinMax:function(t,e,i,s){this.minWidth=t,this.minHeight=e,void 0!==i&&(this.maxWidth=i),void 0!==s&&(this.maxHeight=s)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var t=this._updateThrottle;this._updateThrottleReset=t>=400?0:100,this.dom.getOffset(this.game.canvas,this.offset);var e=this._parentBounds.width,i=this._parentBounds.height,s=this.getParentBounds(this._parentBounds),o=s.width!==e||s.height!==i,a=this.updateOrientationState();(o||a)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,s),this.updateLayout(),this.signalSizeChange());var r=2*this._updateThrottle;this._updateThrottle<t&&(r=Math.min(t,this._updateThrottleReset)),this._updateThrottle=n.Math.clamp(r,25,this.trackParentInterval),this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x,this.height=e*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(t,e){void 0===e&&(e=!1),this.forceLandscape=t,this.forcePortrait=e,this.queueUpdate(!0)},classifyOrientation:function(t){return"portrait-primary"===t||"portrait-secondary"===t?"portrait":"landscape-primary"===t||"landscape-secondary"===t?"landscape":null},updateOrientationState:function(){var t=this.screenOrientation,e=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var i=t!==this.screenOrientation,s=e!==this.incorrectOrientation;return s&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(i||s)&&this.onOrientationChange.dispatch(this,t,e),i||s},orientationChange:function(t){this.event=t,this.queueUpdate(!0)},windowResize:function(t){this.event=t,this.queueUpdate(!0)},scrollTop:function(){var t=this.compatibility.scrollTo;t&&window.scrollTo(t.x,t.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var t=this.currentScaleMode;if(t!==n.ScaleManager.RESIZE){if(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():t===n.ScaleManager.EXACT_FIT?this.setExactFit():t===n.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():t===n.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):t===n.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),!this.compatibility.canExpandParent&&(t===n.ScaleManager.SHOW_ALL||t===n.ScaleManager.USER_SCALE)){var e=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,e.width),this.height=Math.min(this.height,e.height)}this.width=0|this.width,this.height=0|this.height,this.reflowCanvas()}else this.reflowGame()},getParentBounds:function(t){var e=t||new n.Rectangle,i=this.boundingParent,s=this.dom.visualBounds,o=this.dom.layoutBounds;if(i){var a=i.getBoundingClientRect(),r=i.offsetParent?i.offsetParent.getBoundingClientRect():i.getBoundingClientRect();e.setTo(a.left-r.left,a.top-r.top,a.width,a.height);var h=this.windowConstraints;if(h.right){var l="layout"===h.right?o:s;e.right=Math.min(e.right,l.width)}if(h.bottom){l="layout"===h.bottom?o:s;e.bottom=Math.min(e.bottom,l.height)}}else e.setTo(0,0,s.width,s.height);return e.setTo(Math.round(e.x),Math.round(e.y),Math.round(e.width),Math.round(e.height)),e},alignCanvas:function(t,e){var i=this.getParentBounds(this._tempBounds),s=this.game.canvas,n=this.margin;if(t){n.left=n.right=0;var o=s.getBoundingClientRect();if(this.width<i.width&&!this.incorrectOrientation){var a=o.left-i.x,r=i.width/2-this.width/2,h=(r=Math.max(r,0))-a;n.left=Math.round(h)}s.style.marginLeft=n.left+"px",0!==n.left&&(n.right=-(i.width-o.width-n.left),s.style.marginRight=n.right+"px")}if(e){n.top=n.bottom=0;o=s.getBoundingClientRect();if(this.height<i.height&&!this.incorrectOrientation){a=o.top-i.y,r=i.height/2-this.height/2,h=(r=Math.max(r,0))-a;n.top=Math.round(h)}s.style.marginTop=n.top+"px",0!==n.top&&(n.bottom=-(i.height-o.height-n.top),s.style.marginBottom=n.bottom+"px")}n.x=n.left,n.y=n.top},reflowGame:function(){this.resetCanvas("","");var t=this.getParentBounds(this._tempBounds);this.updateDimensions(t.width,t.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=n.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=n.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(t,e){void 0===t&&(t=this.width+"px"),void 0===e&&(e=this.height+"px");var i=this.game.canvas;this.compatibility.noMargins||(i.style.marginLeft="",i.style.marginTop="",i.style.marginRight="",i.style.marginBottom=""),i.style.width=t,i.style.height=e},queueUpdate:function(t){t&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(t){t&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(t){var e,i=this.getParentBounds(this._tempBounds),s=i.width,n=i.height;e=t?Math.max(n/this.game.height,s/this.game.width):Math.min(n/this.game.height,s/this.game.width),this.width=Math.round(this.game.width*e),this.height=Math.round(this.game.height*e)},setExactFit:function(){var t=this.getParentBounds(this._tempBounds);this.width=t.width,this.height=t.height,this.isFullScreen||(this.maxWidth&&(this.width=Math.min(this.width,this.maxWidth)),this.maxHeight&&(this.height=Math.min(this.height,this.maxHeight)))},createFullScreenTarget:function(){var t=document.createElement("div");return t.style.margin="0",t.style.padding="0",t.style.background="#000",t},startFullScreen:function(t,e){if(this.isFullScreen)return!1;if(this.compatibility.supportsFullScreen){if("when-not-mouse"===this.compatibility.clickTrampoline){var i=this.game.input;if(i.activePointer&&i.activePointer!==i.mousePointer&&(e||!1!==e))return void i.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,!1])}void 0!==t&&this.game.renderType===n.CANVAS&&(this.game.stage.smoothed=t);var s=this.fullScreenTarget;s||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),s=this._createdFullScreenTarget);var o={targetElement:s};if(this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,o),this._createdFullScreenTarget){var a=this.game.canvas;a.parentNode.insertBefore(s,a),s.appendChild(a)}return this.game.device.fullscreenKeyboard?s[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):s[this.game.device.requestFullscreen](),!0}var r=this;setTimeout(function(){r.fullScreenError()},10)},stopFullScreen:function(){return!(!this.isFullScreen||!this.compatibility.supportsFullScreen||(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),0))},cleanupCreatedTarget:function(){var t=this._createdFullScreenTarget;if(t&&t.parentNode){var e=t.parentNode;e.insertBefore(this.game.canvas,t),e.removeChild(t)}this._createdFullScreenTarget=null},prepScreenMode:function(t){var e=!!this._createdFullScreenTarget,i=this._createdFullScreenTarget||this.fullScreenTarget;t?(e||this.fullScreenScaleMode===n.ScaleManager.EXACT_FIT)&&i!==this.game.canvas&&(this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height},i.style.width="100%",i.style.height="100%"):(this._fullScreenRestore&&(i.style.width=this._fullScreenRestore.targetWidth,i.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(t){this.event=t,this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0)),this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(t){this.event=t,this.cleanupCreatedTarget(),this.onFullScreenError.dispatch(this)},scaleSprite:function(t,e,i,s){if(void 0===e&&(e=this.width),void 0===i&&(i=this.height),void 0===s&&(s=!1),!t||!t.scale)return t;if(t.scale.x=1,t.scale.y=1,t.width<=0||t.height<=0||e<=0||i<=0)return t;var n=e,o=t.height*e/t.width,a=t.width*i/t.height,r=i,h=a>e;return(h=h?s:!s)?(t.width=Math.floor(n),t.height=Math.floor(o)):(t.width=Math.floor(a),t.height=Math.floor(r)),t},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},n.ScaleManager.prototype.constructor=n.ScaleManager,Object.defineProperty(n.ScaleManager.prototype,"boundingParent",{get:function(){return this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget?null:this.game.canvas&&this.game.canvas.parentNode||null}}),Object.defineProperty(n.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){return t!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=t),this._scaleMode}}),Object.defineProperty(n.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(t){return t!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=t,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=t),this._fullScreenScaleMode}}),Object.defineProperty(n.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(n.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(t){t!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=t,this.queueUpdate(!0))}}),Object.defineProperty(n.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(t){t!==this._pageAlignVertically&&(this._pageAlignVertically=t,this.queueUpdate(!0))}}),Object.defineProperty(n.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(n.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(n.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(n.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(n.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),n.Utils.Debug=function(t){this.game=t,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},n.Utils.Debug.prototype={boot:function(){this.game.renderType===n.CANVAS?this.context=this.game.context:(this.bmd=new n.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d"))},resize:function(t,e,i){this.bmd.resize(e,i),this.canvas.width=e,this.canvas.height=i},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(t,e,i,s){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),i=i||"rgb(255,255,255)",void 0===s&&(s=0),this.currentX=t,this.currentY=e,this.currentColor=i,this.columnWidth=s,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=i,this.context.fillStyle=i,this.context.font=this.font,this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var t=this.currentX,e=0;e<arguments.length;e++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[e],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[e],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(t,e,i,s){this.start(e,i,s),this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback),this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding),this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying),this.line("Time: "+t.currentTime),this.line("Volume: "+t.volume+" Muted: "+t.mute),this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag),""!==t.currentMarker&&(this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")"),this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop),this.line("Position: "+t.position)),this.stop()},cameraInfo:function(t,e,i,s){this.start(e,i,s),this.line("Camera ("+t.width+" x "+t.height+")"),this.line("X: "+t.x+" Y: "+t.y),t.bounds&&this.line("Bounds x: "+t.bounds.x+" Y: "+t.bounds.y+" w: "+t.bounds.width+" h: "+t.bounds.height),this.line("View x: "+t.view.x+" Y: "+t.view.y+" w: "+t.view.width+" h: "+t.view.height),this.line("Total in view: "+t.totalInView),this.stop()},timer:function(t,e,i,s){this.start(e,i,s),this.line("Timer (running: "+t.running+" expired: "+t.expired+")"),this.line("Next Tick: "+t.next+" Duration: "+t.duration),this.line("Paused: "+t.paused+" Length: "+t.length),this.stop()},pointer:function(t,e,i,s,n){null!=t&&(void 0===e&&(e=!1),i=i||"rgba(0,255,0,0.5)",s=s||"rgba(255,0,0,0.5)",!0===e&&!0===t.isUp||(this.start(t.x,t.y-100,n),this.context.beginPath(),this.context.arc(t.x,t.y,t.circle.radius,0,2*Math.PI),t.active?this.context.fillStyle=i:this.context.fillStyle=s,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(t.positionDown.x,t.positionDown.y),this.context.lineTo(t.position.x,t.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+t.id+" Active: "+t.active),this.line("World X: "+t.worldX+" World Y: "+t.worldY),this.line("Screen X: "+t.x+" Screen Y: "+t.y+" In: "+t.withinGame),this.line("Duration: "+t.duration+" ms"),this.line("is Down: "+t.isDown+" is Up: "+t.isUp),this.stop()))},spriteInputInfo:function(t,e,i,s){this.start(e,i,s),this.line("Sprite Input: ("+t.width+" x "+t.height+")"),this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1)),this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0)),this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0)),this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut()),this.stop()},key:function(t,e,i,s){this.start(e,i,s,150),this.line("Key:",t.keyCode,"isDown:",t.isDown),this.line("justDown:",t.justDown,"justUp:",t.justUp),this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0)),this.stop()},inputInfo:function(t,e,i){this.start(t,e,i),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(t,e,i){var s=t.getBounds();s.x+=this.game.camera.x,s.y+=this.game.camera.y,this.rectangle(s,e,i)},ropeSegments:function(t,e,i){var s=this;t.segments.forEach(function(t){s.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,s){this.start(e,i,s),this.line("Sprite:  ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y),this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1)),this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1)),this.line("visible: "+t.visible+" in camera: "+t.inCamera),this.line("bounds x: "+t._bounds.x.toFixed(1)+" y: "+t._bounds.y.toFixed(1)+" w: "+t._bounds.width.toFixed(1)+" h: "+t._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(t,e,i,s){this.start(e,i,s,100),t.name&&this.line(t.name),this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2)),this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2)),this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2)),this.stop()},lineInfo:function(t,e,i,s){this.start(e,i,s,80),this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2)),this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2)),this.line("length:",t.length.toFixed(2),"angle:",t.angle),this.stop()},pixel:function(t,e,i,s){s=s||2,this.start(),this.context.fillStyle=i,this.context.fillRect(t,e,s,s),this.stop()},geom:function(t,e,i,s){void 0===i&&(i=!0),void 0===s&&(s=0),e=e||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=e,this.context.strokeStyle=e,t instanceof n.Rectangle||1===s?i?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):t instanceof n.Circle||2===s?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,2*Math.PI,!1),this.context.closePath(),i?this.context.fill():this.context.stroke()):t instanceof n.Point||3===s?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):(t instanceof n.Line||4===s)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(t,e,i){void 0===i&&(i=!0),e=e||"rgba(0, 255, 0, 0.4)",this.start(),i?(this.context.fillStyle=e,this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)):(this.context.strokeStyle=e,this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)),this.stop()},text:function(t,e,i,s,n){s=s||"rgb(255,255,255)",n=n||"16px Courier",this.start(),this.context.font=n,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(t,e+1,i+1)),this.context.fillStyle=s,this.context.fillText(t,e,i),this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)",this.start();var i=t.bounds;if(0===t.nodes.length){this.context.strokeStyle=e,this.context.strokeRect(i.x,i.y,i.width,i.height),this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var s=0;s<t.objects.length;s++)this.context.strokeRect(t.objects[s].x,t.objects[s].y,t.objects[s].width,t.objects[s].height)}else for(s=0;s<t.nodes.length;s++)this.quadTree(t.nodes[s]);this.stop()},body:function(t,e,i){t.body&&(this.start(),t.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.render(this.context,t.body,e,i):t.body.type===n.Physics.NINJA?n.Physics.Ninja.Body.render(this.context,t.body,e,i):t.body.type===n.Physics.BOX2D&&n.Physics.Box2D.renderBody(this.context,t.body,e),this.stop())},bodyInfo:function(t,e,i,s){t.body&&(this.start(e,i,s,210),t.body.type===n.Physics.ARCADE?n.Physics.Arcade.Body.renderBodyInfo(this,t.body):t.body.type===n.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,t.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(t,e){this.start(),n.Physics.Box2D.renderBody(this.context,t,e),this.stop()},displayList:function(t){if(void 0===t&&(t=this.game.world),t.hasOwnProperty("renderOrderID"),t.children&&t.children.length>0)for(var e=0;e<t.children.length;e++)this.game.debug.displayList(t.children[e])},destroy:function(){PIXI.CanvasPool.remove(this)}},n.Utils.Debug.prototype.constructor=n.Utils.Debug,n.DOM={getOffset:function(t,e){e=e||new n.Point;var i=t.getBoundingClientRect(),s=n.DOM.scrollY,o=n.DOM.scrollX,a=document.documentElement.clientTop,r=document.documentElement.clientLeft;return e.x=i.left+o-r,e.y=i.top+s-a,e},getBounds:function(t,e){return void 0===e&&(e=0),!(!(t=t&&!t.nodeType?t[0]:t)||1!==t.nodeType)&&this.calibrate(t.getBoundingClientRect(),e)},calibrate:function(t,e){e=+e||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};return i.width=(i.right=t.right+e)-(i.left=t.left-e),i.height=(i.bottom=t.bottom+e)-(i.top=t.top-e),i},getAspectRatio:function(t){var e=(t=null==t?this.visualBounds:1===t.nodeType?this.getBounds(t):t).width,i=t.height;return"function"==typeof e&&(e=e.call(t)),"function"==typeof i&&(i=i.call(t)),e/i},inLayoutViewport:function(t,e){var i=this.getBounds(t,e);return!!i&&i.bottom>=0&&i.right>=0&&i.top<=this.layoutBounds.width&&i.left<=this.layoutBounds.height},getScreenOrientation:function(t){var e=window.screen,i=e.orientation||e.mozOrientation||e.msOrientation;if(i&&"string"==typeof i.type)return i.type;if("string"==typeof i)return i;var s="portrait-primary",n="landscape-primary";if("screen"===t)return e.height>e.width?s:n;if("viewport"===t)return this.visualBounds.height>this.visualBounds.width?s:n;if("window.orientation"===t&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?s:n;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return s;if(window.matchMedia("(orientation: landscape)").matches)return n}return this.visualBounds.height>this.visualBounds.width?s:n},visualBounds:new n.Rectangle,layoutBounds:new n.Rectangle,documentBounds:new n.Rectangle},n.Device.whenReady(function(t){var e=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},i=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};if(Object.defineProperty(n.DOM,"scrollX",{get:e}),Object.defineProperty(n.DOM,"scrollY",{get:i}),Object.defineProperty(n.DOM.visualBounds,"x",{get:e}),Object.defineProperty(n.DOM.visualBounds,"y",{get:i}),Object.defineProperty(n.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(n.DOM.layoutBounds,"y",{value:0}),t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight){var s=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)},o=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(n.DOM.visualBounds,"width",{get:s}),Object.defineProperty(n.DOM.visualBounds,"height",{get:o}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:s}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:o})}else Object.defineProperty(n.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(n.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(n.DOM.layoutBounds,"width",{get:function(){var t=document.documentElement.clientWidth,e=window.innerWidth;return t<e?e:t}}),Object.defineProperty(n.DOM.layoutBounds,"height",{get:function(){var t=document.documentElement.clientHeight,e=window.innerHeight;return t<e?e:t}});Object.defineProperty(n.DOM.documentBounds,"x",{value:0}),Object.defineProperty(n.DOM.documentBounds,"y",{value:0}),Object.defineProperty(n.DOM.documentBounds,"width",{get:function(){var t=document.documentElement;return Math.max(t.clientWidth,t.offsetWidth,t.scrollWidth)}}),Object.defineProperty(n.DOM.documentBounds,"height",{get:function(){var t=document.documentElement;return Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight)}})},null,!0),n.ArraySet=function(t){this.position=0,this.list=t||[]},n.ArraySet.prototype={add:function(t){return this.exists(t)||this.list.push(t),t},getIndex:function(t){return this.list.indexOf(t)},getByKey:function(t,e){for(var i=this.list.length;i--;)if(this.list[i][t]===e)return this.list[i];return null},exists:function(t){return this.list.indexOf(t)>-1},reset:function(){this.list.length=0},remove:function(t){var e=this.list.indexOf(t);if(e>-1)return this.list.splice(e,1),t},setAll:function(t,e){for(var i=this.list.length;i--;)this.list[i]&&(this.list[i][t]=e)},callAll:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=this.list.length;i--;)this.list[i]&&this.list[i][t]&&this.list[i][t].apply(this.list[i],e)},removeAll:function(t){void 0===t&&(t=!1);for(var e=this.list.length;e--;)if(this.list[e]){var i=this.remove(this.list[e]);t&&i.destroy()}this.position=0,this.list=[]}},Object.defineProperty(n.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(n.ArraySet.prototype,"first",{get:function(){return this.position=0,this.list.length>0?this.list[0]:null}}),Object.defineProperty(n.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),n.ArraySet.prototype.constructor=n.ArraySet,n.ArrayUtils={getRandomItem:function(t,e,i){if(null===t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);var s=e+Math.floor(Math.random()*i);return void 0===t[s]?null:t[s]},removeRandomItem:function(t,e,i){if(null==t)return null;void 0===e&&(e=0),void 0===i&&(i=t.length);var s=e+Math.floor(Math.random()*i);if(s<t.length){var n=t.splice(s,1);return void 0===n[0]?null:n[0]}return null},shuffle:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),s=t[e];t[e]=t[i],t[i]=s}return t},transposeMatrix:function(t){for(var e=t.length,i=t[0].length,s=new Array(i),n=0;n<i;n++){s[n]=new Array(e);for(var o=e-1;o>-1;o--)s[n][o]=t[o][n]}return s},rotateMatrix:function(t,e){if("string"!=typeof e&&(e=(e%360+360)%360),90===e||-270===e||"rotateLeft"===e)t=(t=n.ArrayUtils.transposeMatrix(t)).reverse();else if(-90===e||270===e||"rotateRight"===e)t=t.reverse(),t=n.ArrayUtils.transposeMatrix(t);else if(180===Math.abs(e)||"rotate180"===e){for(var i=0;i<t.length;i++)t[i].reverse();t=t.reverse()}return t},findClosest:function(t,e){if(!e.length)return NaN;if(1===e.length||t<e[0])return e[0];for(var i=1;e[i]<t;)i++;var s=e[i-1],n=i<e.length?e[i]:Number.POSITIVE_INFINITY;return n-t<=t-s?n:s},rotateRight:function(t){var e=t.pop();return t.unshift(e),e},rotateLeft:function(t){var e=t.shift();return t.push(e),e},rotate:function(t){var e=t.shift();return t.push(e),e},numberArray:function(t,e){for(var i=[],s=t;s<=e;s++)i.push(s);return i},numberArrayStep:function(t,e,i){null!=t||(t=0),null!=e||(e=t,t=0),void 0===i&&(i=1);for(var s=[],o=Math.max(n.Math.roundAwayFromZero((e-t)/(i||1)),0),a=0;a<o;a++)s.push(t),t+=i;return s}},n.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},n.LinkedList.prototype={add:function(t){return 0===this.total&&null===this.first&&null===this.last?(this.first=t,this.last=t,this.next=t,t.prev=this,this.total++,t):(this.last.next=t,t.prev=this.last,this.last=t,this.total++,t)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(t){if(1===this.total)return this.reset(),void(t.next=t.prev=null);t===this.first?this.first=this.first.next:t===this.last&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=t.prev=null,null===this.first&&(this.last=null),this.total--},callAll:function(t){if(this.first&&this.last){var e=this.first;do{e&&e[t]&&e[t].call(e),e=e.next}while(e!==this.last.next)}}},n.LinkedList.prototype.constructor=n.LinkedList,n.Create=function(t){this.game=t,this.bmd=null,this.canvas=null,this.ctx=null,this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},n.Create.PALETTE_ARNE=0,n.Create.PALETTE_JMP=1,n.Create.PALETTE_CGA=2,n.Create.PALETTE_C64=3,n.Create.PALETTE_JAPANESE_MACHINE=4,n.Create.prototype={texture:function(t,e,i,s,n){void 0===i&&(i=8),void 0===s&&(s=i),void 0===n&&(n=0);var o=e[0].length*i,a=e.length*s;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(o,a),this.bmd.clear();for(var r=0;r<e.length;r++)for(var h=e[r],l=0;l<h.length;l++){var c=h[l];"."!==c&&" "!==c&&(this.ctx.fillStyle=this.palettes[n][c],this.ctx.fillRect(l*i,r*s,i,s))}return this.bmd.generateTexture(t)},grid:function(t,e,i,s,n,o){null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(e,i),this.ctx.fillStyle=o;for(var a=0;a<i;a+=n)this.ctx.fillRect(0,a,e,1);for(var r=0;r<e;r+=s)this.ctx.fillRect(r,0,1,i);return this.bmd.generateTexture(t)}},n.Create.prototype.constructor=n.Create,n.FlexGrid=function(t,e,i){this.game=t.game,this.manager=t,this.width=e,this.height=i,this.boundsCustom=new n.Rectangle(0,0,e,i),this.boundsFluid=new n.Rectangle(0,0,e,i),this.boundsFull=new n.Rectangle(0,0,e,i),this.boundsNone=new n.Rectangle(0,0,e,i),this.positionCustom=new n.Point(0,0),this.positionFluid=new n.Point(0,0),this.positionFull=new n.Point(0,0),this.positionNone=new n.Point(0,0),this.scaleCustom=new n.Point(1,1),this.scaleFluid=new n.Point(1,1),this.scaleFluidInversed=new n.Point(1,1),this.scaleFull=new n.Point(1,1),this.scaleNone=new n.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=e/i,this.ratioV=i/e,this.multiplier=0,this.layers=[]},n.FlexGrid.prototype={setSize:function(t,e){this.width=t,this.height=e,this.ratioH=t/e,this.ratioV=e/t,this.scaleNone=new n.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(t,e,i,s){void 0===s&&(s=!0),this.customWidth=t,this.customHeight=e,this.boundsCustom.width=t,this.boundsCustom.height=e;var o=new n.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return s&&this.game.world.add(o),this.layers.push(o),void 0!==i&&null!==typeof i&&o.addMultiple(i),o},createFluidLayer:function(t,e){void 0===e&&(e=!0);var i=new n.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return e&&this.game.world.add(i),this.layers.push(i),void 0!==t&&null!==typeof t&&i.addMultiple(t),i},createFullLayer:function(t){var e=new n.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(e),this.layers.push(e),void 0!==t&&e.addMultiple(t),e},createFixedLayer:function(t){var e=new n.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(e),this.layers.push(e),void 0!==t&&e.addMultiple(t),e},reset:function(){for(var t=this.layers.length;t--;)this.layers[t].persist||(this.layers[t].position=null,this.layers[t].scale=null,this.layers.slice(t,1))},onResize:function(t,e){this.ratioH=t/e,this.ratioV=e/t,this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(t){this.manager.scaleSprite(t),t.x=this.manager.bounds.centerX,t.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},n.FlexGrid.prototype.constructor=n.FlexGrid,n.FlexLayer=function(t,e,i,s){n.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1),this.manager=t.manager,this.grid=t,this.persist=!1,this.position=e,this.bounds=i,this.scale=s,this.topLeft=i.topLeft,this.topMiddle=new n.Point(i.halfWidth,0),this.topRight=i.topRight,this.bottomLeft=i.bottomLeft,this.bottomMiddle=new n.Point(i.halfWidth,i.bottom),this.bottomRight=i.bottomRight},n.FlexLayer.prototype=Object.create(n.Group.prototype),n.FlexLayer.prototype.constructor=n.FlexLayer,n.FlexLayer.prototype.resize=function(){},n.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},n.Color={packPixel:function(t,e,i,s){return n.Device.LITTLE_ENDIAN?(s<<24|i<<16|e<<8|t)>>>0:(t<<24|e<<16|i<<8|s)>>>0},unpackPixel:function(t,e,i,s){return null!=e||(e=n.Color.createColor()),null!=i||(i=!1),null!=s||(s=!1),n.Device.LITTLE_ENDIAN?(e.a=(4278190080&t)>>>24,e.b=(16711680&t)>>>16,e.g=(65280&t)>>>8,e.r=255&t):(e.r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t),e.color=t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")",i&&n.Color.RGBtoHSL(e.r,e.g,e.b,e),s&&n.Color.RGBtoHSV(e.r,e.g,e.b,e),e},fromRGBA:function(t,e){return e||(e=n.Color.createColor()),e.r=(4278190080&t)>>>24,e.g=(16711680&t)>>>16,e.b=(65280&t)>>>8,e.a=255&t,e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",e},toRGBA:function(t,e,i,s){return t<<24|e<<16|i<<8|s},toABGR:function(t,e,i,s){return(s<<24|i<<16|e<<8|t)>>>0},RGBtoHSL:function(t,e,i,s){s||(s=n.Color.createColor(t,e,i,1)),t/=255,e/=255,i/=255;var o=Math.min(t,e,i),a=Math.max(t,e,i);if(s.h=0,s.s=0,s.l=(a+o)/2,a!==o){var r=a-o;s.s=s.l>.5?r/(2-a-o):r/(a+o),a===t?s.h=(e-i)/r+(e<i?6:0):a===e?s.h=(i-t)/r+2:a===i&&(s.h=(t-e)/r+4),s.h/=6}return s},HSLtoRGB:function(t,e,i,s){if(s?(s.r=i,s.g=i,s.b=i):s=n.Color.createColor(i,i,i),0!==e){var o=i<.5?i*(1+e):i+e-i*e,a=2*i-o;s.r=n.Color.hueToColor(a,o,t+1/3),s.g=n.Color.hueToColor(a,o,t),s.b=n.Color.hueToColor(a,o,t-1/3)}return s.r=Math.floor(255*s.r|0),s.g=Math.floor(255*s.g|0),s.b=Math.floor(255*s.b|0),n.Color.updateColor(s),s},RGBtoHSV:function(t,e,i,s){s||(s=n.Color.createColor(t,e,i,255)),t/=255,e/=255,i/=255;var o=Math.min(t,e,i),a=Math.max(t,e,i),r=a-o;return s.h=0,s.s=0===a?0:r/a,s.v=a,a!==o&&(a===t?s.h=(e-i)/r+(e<i?6:0):a===e?s.h=(i-t)/r+2:a===i&&(s.h=(t-e)/r+4),s.h/=6),s},HSVtoRGB:function(t,e,i,s){void 0===s&&(s=n.Color.createColor(0,0,0,1,t,e,0,i));var o,a,r,h=Math.floor(6*t),l=6*t-h,c=i*(1-e),u=i*(1-l*e),d=i*(1-(1-l)*e);switch(h%6){case 0:o=i,a=d,r=c;break;case 1:o=u,a=i,r=c;break;case 2:o=c,a=i,r=d;break;case 3:o=c,a=u,r=i;break;case 4:o=d,a=c,r=i;break;case 5:o=i,a=c,r=u}return s.r=Math.floor(255*o),s.g=Math.floor(255*a),s.b=Math.floor(255*r),n.Color.updateColor(s),s},hueToColor:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},createColor:function(t,e,i,s,o,a,r,h){var l={r:t||0,g:e||0,b:i||0,a:s||1,h:o||0,s:a||0,l:r||0,v:h||0,color:0,color32:0,rgba:""};return n.Color.updateColor(l)},updateColor:function(t){return t.rgba="rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+t.a.toString()+")",t.color=n.Color.getColor(t.r,t.g,t.b),t.color32=n.Color.getColor32(255*t.a,t.r,t.g,t.b),t},getColor32:function(t,e,i,s){return t<<24|e<<16|i<<8|s},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,e,i,s,o){return void 0===s&&(s=255),void 0===o&&(o="#"),"#"===o?"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1):"0x"+n.Color.componentToHex(s)+n.Color.componentToHex(t)+n.Color.componentToHex(e)+n.Color.componentToHex(i)},hexToRGB:function(t){var e=n.Color.hexToColor(t);if(e)return n.Color.getColor32(e.a,e.r,e.g,e.b)},hexToColor:function(t,e){t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});var i=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i){var s=parseInt(i[1],16),o=parseInt(i[2],16),a=parseInt(i[3],16);e?(e.r=s,e.g=o,e.b=a):e=n.Color.createColor(s,o,a)}return e},webToColor:function(t,e){e||(e=n.Color.createColor());var i=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);return i&&(e.r=parseInt(i[1],10),e.g=parseInt(i[2],10),e.b=parseInt(i[3],10),e.a=void 0!==i[4]?parseFloat(i[4]):1,n.Color.updateColor(e)),e},valueToColor:function(t,e){if(e||(e=n.Color.createColor()),"string"==typeof t)return 0===t.indexOf("rgb")?n.Color.webToColor(t,e):(e.a=1,n.Color.hexToColor(t,e));if("number"==typeof t){var i=n.Color.getRGB(t);return e.r=i.r,e.g=i.g,e.b=i.b,e.a=i.a/255,e}return e},componentToHex:function(t){var e=t.toString(16);return 1===e.length?"0"+e:e},HSVColorWheel:function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);for(var i=[],s=0;s<=359;s++)i.push(n.Color.HSVtoRGB(s/359,t,e));return i},HSLColorWheel:function(t,e){void 0===t&&(t=.5),void 0===e&&(e=.5);for(var i=[],s=0;s<=359;s++)i.push(n.Color.HSLtoRGB(s/359,t,e));return i},interpolateColor:function(t,e,i,s,o){void 0===o&&(o=255);var a=n.Color.getRGB(t),r=n.Color.getRGB(e),h=(r.red-a.red)*s/i+a.red,l=(r.green-a.green)*s/i+a.green,c=(r.blue-a.blue)*s/i+a.blue;return n.Color.getColor32(o,h,l,c)},interpolateColorWithRGB:function(t,e,i,s,o,a){var r=n.Color.getRGB(t),h=(e-r.red)*a/o+r.red,l=(i-r.green)*a/o+r.green,c=(s-r.blue)*a/o+r.blue;return n.Color.getColor(h,l,c)},interpolateRGB:function(t,e,i,s,o,a,r,h){var l=(s-t)*h/r+t,c=(o-e)*h/r+e,u=(a-i)*h/r+i;return n.Color.getColor(l,c,u)},getRandomColor:function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=255),void 0===i&&(i=255),e>255||t>e)return n.Color.getColor(255,255,255);var s=t+Math.round(Math.random()*(e-t)),o=t+Math.round(Math.random()*(e-t)),a=t+Math.round(Math.random()*(e-t));return n.Color.getColor32(i,s,o,a)},getRGB:function(t){return t>16777215?{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:255&t,a:t>>>24,r:t>>16&255,g:t>>8&255,b:255&t}:{alpha:255,red:t>>16&255,green:t>>8&255,blue:255&t,a:255,r:t>>16&255,g:t>>8&255,b:255&t}},getWebRGB:function(t){if("object"==typeof t)return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";var e=n.Color.getRGB(t);return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")"},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t},blendNormal:function(t){return t},blendLighten:function(t,e){return e>t?e:t},blendDarken:function(t,e){return e>t?t:e},blendMultiply:function(t,e){return t*e/255},blendAverage:function(t,e){return(t+e)/2},blendAdd:function(t,e){return Math.min(255,t+e)},blendSubtract:function(t,e){return Math.max(0,t+e-255)},blendDifference:function(t,e){return Math.abs(t-e)},blendNegation:function(t,e){return 255-Math.abs(255-t-e)},blendScreen:function(t,e){return 255-((255-t)*(255-e)>>8)},blendExclusion:function(t,e){return t+e-2*t*e/255},blendOverlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},blendSoftLight:function(t,e){return e<128?2*(64+(t>>1))*(e/255):255-2*(255-(64+(t>>1)))*(255-e)/255},blendHardLight:function(t,e){return n.Color.blendOverlay(e,t)},blendColorDodge:function(t,e){return 255===e?e:Math.min(255,(t<<8)/(255-e))},blendColorBurn:function(t,e){return 0===e?e:Math.max(0,255-(255-t<<8)/e)},blendLinearDodge:function(t,e){return n.Color.blendAdd(t,e)},blendLinearBurn:function(t,e){return n.Color.blendSubtract(t,e)},blendLinearLight:function(t,e){return e<128?n.Color.blendLinearBurn(t,2*e):n.Color.blendLinearDodge(t,2*(e-128))},blendVividLight:function(t,e){return e<128?n.Color.blendColorBurn(t,2*e):n.Color.blendColorDodge(t,2*(e-128))},blendPinLight:function(t,e){return e<128?n.Color.blendDarken(t,2*e):n.Color.blendLighten(t,2*(e-128))},blendHardMix:function(t,e){return n.Color.blendVividLight(t,e)<128?0:255},blendReflect:function(t,e){return 255===e?e:Math.min(255,t*t/(255-e))},blendGlow:function(t,e){return n.Color.blendReflect(e,t)},blendPhoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}},n.Physics=function(t,e){e=e||{},this.game=t,this.config=e,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.matter=null,this.parseConfig()},n.Physics.ARCADE=0,n.Physics.P2JS=1,n.Physics.NINJA=2,n.Physics.BOX2D=3,n.Physics.CHIPMUNK=4,n.Physics.MATTERJS=5,n.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&!0!==this.config.arcade||!n.Physics.hasOwnProperty("Arcade")||(this.arcade=new n.Physics.Arcade(this.game)),this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&n.Physics.hasOwnProperty("Ninja")&&(this.ninja=new n.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&!0===this.config.p2&&n.Physics.hasOwnProperty("P2")&&(this.p2=new n.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&n.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new n.Physics.BOX2D(this.game,this.config)),this.config.hasOwnProperty("matter")&&!0===this.config.matter&&n.Physics.hasOwnProperty("Matter")&&(this.matter=new n.Physics.Matter(this.game,this.config))},startSystem:function(t){t===n.Physics.ARCADE?this.arcade=new n.Physics.Arcade(this.game):t===n.Physics.P2JS?null===this.p2?this.p2=new n.Physics.P2(this.game,this.config):this.p2.reset():t===n.Physics.NINJA?this.ninja=new n.Physics.Ninja(this.game):t===n.Physics.BOX2D?null===this.box2d?this.box2d=new n.Physics.Box2D(this.game,this.config):this.box2d.reset():t===n.Physics.MATTERJS&&(null===this.matter?this.matter=new n.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(t,e,i){void 0===e&&(e=n.Physics.ARCADE),void 0===i&&(i=!1),e===n.Physics.ARCADE?this.arcade.enable(t):e===n.Physics.P2JS&&this.p2?this.p2.enable(t,i):e===n.Physics.NINJA&&this.ninja?this.ninja.enableAABB(t):e===n.Physics.BOX2D&&this.box2d?this.box2d.enable(t):e===n.Physics.MATTERJS&&this.matter&&this.matter.enable(t)},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate(),this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update(),this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld(),this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear(),this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset(),this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.matter&&this.matter.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null,this.matter=null}},n.Physics.prototype.constructor=n.Physics,n.Physics.Arcade=function(t){this.game=t,this.gravity=new n.Point,this.bounds=new n.Rectangle(0,0,t.world.width,t.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=n.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new n.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},n.Physics.Arcade.prototype.constructor=n.Physics.Arcade,n.Physics.Arcade.SORT_NONE=0,n.Physics.Arcade.LEFT_RIGHT=1,n.Physics.Arcade.RIGHT_LEFT=2,n.Physics.Arcade.TOP_BOTTOM=3,n.Physics.Arcade.BOTTOM_TOP=4,n.Physics.Arcade.prototype={setBounds:function(t,e,i,s){this.bounds.setTo(t,e,i,s)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(t,e){void 0===e&&(e=!0);var i=1;if(Array.isArray(t))for(i=t.length;i--;)t[i]instanceof n.Group?this.enable(t[i].children,e):(this.enableBody(t[i]),e&&t[i].hasOwnProperty("children")&&t[i].children.length>0&&this.enable(t[i],!0));else t instanceof n.Group?this.enable(t.children,e):(this.enableBody(t),e&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new n.Physics.Arcade.Body(t),t.parent&&t.parent instanceof n.Group&&t.parent.addToHash(t))},updateMotion:function(t){var e=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e,t.rotation+=t.angularVelocity*this.game.time.physicsElapsed,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},computeVelocity:function(t,e,i,s,n,o){return void 0===o&&(o=1e4),1===t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed:2===t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed),s?i+=s*this.game.time.physicsElapsed:n&&(i-(n*=this.game.time.physicsElapsed)>0?i-=n:i+n<0?i+=n:i=0),i>o?i=o:i<-o&&(i=-o),i},overlap:function(t,e,i,s,n){if(i=i||null,s=s||null,n=n||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var o=0;o<e.length;o++)this.collideHandler(t,e[o],i,s,n,!0);else if(Array.isArray(t)&&!Array.isArray(e))for(o=0;o<t.length;o++)this.collideHandler(t[o],e,i,s,n,!0);else if(Array.isArray(t)&&Array.isArray(e))for(o=0;o<t.length;o++)for(var a=0;a<e.length;a++)this.collideHandler(t[o],e[a],i,s,n,!0);else this.collideHandler(t,e,i,s,n,!0);return this._total>0},collide:function(t,e,i,s,n){if(i=i||null,s=s||null,n=n||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var o=0;o<e.length;o++)this.collideHandler(t,e[o],i,s,n,!1);else if(Array.isArray(t)&&!Array.isArray(e))for(o=0;o<t.length;o++)this.collideHandler(t[o],e,i,s,n,!1);else if(Array.isArray(t)&&Array.isArray(e))for(o=0;o<t.length;o++)for(var a=0;a<e.length;a++)this.collideHandler(t[o],e[a],i,s,n,!1);else this.collideHandler(t,e,i,s,n,!1);return this._total>0},sortLeftRight:function(t,e){return t.body&&e.body?t.body.x-e.body.x:0},sortRightLeft:function(t,e){return t.body&&e.body?e.body.x-t.body.x:0},sortTopBottom:function(t,e){return t.body&&e.body?t.body.y-e.body.y:0},sortBottomTop:function(t,e){return t.body&&e.body?e.body.y-t.body.y:0},sort:function(t,e){null!==t.physicsSortDirection?e=t.physicsSortDirection:void 0===e&&(e=this.sortDirection),e===n.Physics.Arcade.LEFT_RIGHT?t.hash.sort(this.sortLeftRight):e===n.Physics.Arcade.RIGHT_LEFT?t.hash.sort(this.sortRightLeft):e===n.Physics.Arcade.TOP_BOTTOM?t.hash.sort(this.sortTopBottom):e===n.Physics.Arcade.BOTTOM_TOP&&t.hash.sort(this.sortBottomTop)},collideHandler:function(t,e,i,s,o,a){if(void 0===e&&t.physicsType===n.GROUP)return this.sort(t),void this.collideGroupVsSelf(t,i,s,o,a);t&&e&&t.exists&&e.exists&&(this.sortDirection!==n.Physics.Arcade.SORT_NONE&&(t.physicsType===n.GROUP&&this.sort(t),e.physicsType===n.GROUP&&this.sort(e)),t.physicsType===n.SPRITE?e.physicsType===n.SPRITE?this.collideSpriteVsSprite(t,e,i,s,o,a):e.physicsType===n.GROUP?this.collideSpriteVsGroup(t,e,i,s,o,a):e.physicsType===n.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,e,i,s,o,a):t.physicsType===n.GROUP?e.physicsType===n.SPRITE?this.collideSpriteVsGroup(e,t,i,s,o,a):e.physicsType===n.GROUP?this.collideGroupVsGroup(t,e,i,s,o,a):e.physicsType===n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,e,i,s,o,a):t.physicsType===n.TILEMAPLAYER&&(e.physicsType===n.SPRITE?this.collideSpriteVsTilemapLayer(e,t,i,s,o,a):e.physicsType===n.GROUP&&this.collideGroupVsTilemapLayer(e,t,i,s,o,a)))},collideSpriteVsSprite:function(t,e,i,s,n,o){return!(!t.body||!e.body||(this.separate(t.body,e.body,s,n,o)&&(i&&i.call(n,t,e),this._total++),0))},collideSpriteVsGroup:function(t,e,i,s,o,a){if(0!==e.length&&t.body)if(this.skipQuadTree||t.body.skipQuadTree)for(var r={},h=0;h<e.hash.length;h++){var l=e.hash[h];if(l&&l.exists&&l.body){if(r=l.body.getBounds(r),this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(t.body.right<r.x)break;if(r.right<t.body.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(t.body.x>r.right)break;if(r.x>t.body.right)continue}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<r.y)break;if(r.bottom<t.body.y)continue}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP){if(t.body.y>r.bottom)break;if(r.y>t.body.bottom)continue}this.collideSpriteVsSprite(t,l,i,s,o,a)}}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(e);var c=this.quadTree.retrieve(t);for(h=0;h<c.length;h++)this.separate(t.body,c[h],s,o,a)&&(i&&i.call(o,t,c[h].sprite),this._total++)}},collideGroupVsSelf:function(t,e,i,s,o){if(0!==t.length)for(var a=0;a<t.hash.length;a++){var r={},h=t.hash[a];if(h&&h.exists&&h.body){r=h.body.getBounds(r);for(var l=a+1;l<t.hash.length;l++){var c={},u=t.hash[l];if(u&&u.exists&&u.body){if(c=u.body.getBounds(c),this.sortDirection===n.Physics.Arcade.LEFT_RIGHT){if(r.right<c.x)break;if(c.right<r.x)continue}else if(this.sortDirection===n.Physics.Arcade.RIGHT_LEFT){if(r.x>c.right)continue;if(c.x>r.right)break}else if(this.sortDirection===n.Physics.Arcade.TOP_BOTTOM){if(r.bottom<c.y)continue;if(c.bottom<r.y)break}else if(this.sortDirection===n.Physics.Arcade.BOTTOM_TOP){if(r.y>c.bottom)continue;if(c.y>h.body.bottom)break}this.collideSpriteVsSprite(h,u,e,i,s,o)}}}}},collideGroupVsGroup:function(t,e,i,s,o,a){if(0!==t.length&&0!==e.length)for(var r=0;r<t.children.length;r++)t.children[r].exists&&(t.children[r].physicsType===n.GROUP?this.collideGroupVsGroup(t.children[r],e,i,s,o,a):this.collideSpriteVsGroup(t.children[r],e,i,s,o,a))},separate:function(t,e,i,s,n){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e))return!1;if(i&&!1===i.call(s,t.sprite,e.sprite))return!1;if(t.isCircle&&e.isCircle)return this.separateCircle(t,e,n);if(t.isCircle!==e.isCircle){var o=t.isCircle?e:t,a=t.isCircle?t:e,r={x:o.x,y:o.y,right:o.right,bottom:o.bottom},h={x:a.x+a.radius,y:a.y+a.radius};if((h.y<r.y||h.y>r.bottom)&&(h.x<r.x||h.x>r.right))return this.separateCircle(t,e,n)}var l=!1,c=!1;this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?(l=this.separateX(t,e,n),this.intersects(t,e)&&(c=this.separateY(t,e,n))):(c=this.separateY(t,e,n),this.intersects(t,e)&&(l=this.separateX(t,e,n)));var u=l||c;return u&&(n?(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)):(t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite))),u},intersects:function(t,e){return t!==e&&(t.isCircle?e.isCircle?n.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.radius+e.radius:this.circleBodyIntersects(t,e):e.isCircle?this.circleBodyIntersects(e,t):!(t.right<=e.position.x||t.bottom<=e.position.y||t.position.x>=e.right||t.position.y>=e.bottom))},circleBodyIntersects:function(t,e){var i=n.Math.clamp(t.center.x,e.left,e.right),s=n.Math.clamp(t.center.y,e.top,e.bottom);return(t.center.x-i)*(t.center.x-i)+(t.center.y-s)*(t.center.y-s)<=t.radius*t.radius},separateCircle:function(t,e,i){this.getOverlapX(t,e),this.getOverlapY(t,e);var s=e.center.x-t.center.x,o=e.center.y-t.center.y,a=Math.atan2(o,s),r=0;if(t.isCircle!==e.isCircle){var h={x:e.isCircle?t.position.x:e.position.x,y:e.isCircle?t.position.y:e.position.y,right:e.isCircle?t.right:e.right,bottom:e.isCircle?t.bottom:e.bottom},l={x:t.isCircle?t.position.x+t.radius:e.position.x+e.radius,y:t.isCircle?t.position.y+t.radius:e.position.y+e.radius,radius:t.isCircle?t.radius:e.radius};l.y<h.y?l.x<h.x?r=n.Math.distance(l.x,l.y,h.x,h.y)-l.radius:l.x>h.right&&(r=n.Math.distance(l.x,l.y,h.right,h.y)-l.radius):l.y>h.bottom&&(l.x<h.x?r=n.Math.distance(l.x,l.y,h.x,h.bottom)-l.radius:l.x>h.right&&(r=n.Math.distance(l.x,l.y,h.right,h.bottom)-l.radius)),r*=-1}else r=t.radius+e.radius-n.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y);if(i||0===r||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==r&&(t.onOverlap&&t.onOverlap.dispatch(t.sprite,e.sprite),e.onOverlap&&e.onOverlap.dispatch(e.sprite,t.sprite)),0!==r;var c=t.velocity.x*Math.cos(a)+t.velocity.y*Math.sin(a),u=t.velocity.x*Math.sin(a)-t.velocity.y*Math.cos(a),d=e.velocity.x*Math.cos(a)+e.velocity.y*Math.sin(a),p=e.velocity.x*Math.sin(a)-e.velocity.y*Math.cos(a),f=((t.mass-e.mass)*c+2*e.mass*d)/(t.mass+e.mass),y=(2*t.mass*c+(e.mass-t.mass)*d)/(t.mass+e.mass);return t.immovable||(t.velocity.x=(f*Math.cos(a)-u*Math.sin(a))*t.bounce.x,t.velocity.y=(u*Math.cos(a)+f*Math.sin(a))*t.bounce.y),e.immovable||(e.velocity.x=(y*Math.cos(a)-p*Math.sin(a))*e.bounce.x,e.velocity.y=(p*Math.cos(a)+y*Math.sin(a))*e.bounce.y),Math.abs(a)<Math.PI/2?t.velocity.x>0&&!t.immovable&&e.velocity.x>t.velocity.x?t.velocity.x*=-1:e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x?e.velocity.x*=-1:t.velocity.y>0&&!t.immovable&&e.velocity.y>t.velocity.y?t.velocity.y*=-1:e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y&&(e.velocity.y*=-1):Math.abs(a)>Math.PI/2&&(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x?t.velocity.x*=-1:e.velocity.x>0&&!e.immovable&&t.velocity.x>e.velocity.x?e.velocity.x*=-1:t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y?t.velocity.y*=-1:e.velocity.y>0&&!e.immovable&&t.velocity.x>e.velocity.y&&(e.velocity.y*=-1)),t.immovable||(t.x+=t.velocity.x*this.game.time.physicsElapsed-r*Math.cos(a),t.y+=t.velocity.y*this.game.time.physicsElapsed-r*Math.sin(a)),e.immovable||(e.x+=e.velocity.x*this.game.time.physicsElapsed+r*Math.cos(a),e.y+=e.velocity.y*this.game.time.physicsElapsed+r*Math.sin(a)),t.onCollide&&t.onCollide.dispatch(t.sprite,e.sprite),e.onCollide&&e.onCollide.dispatch(e.sprite,t.sprite),!0},getOverlapX:function(t,e,i){var s=0,n=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;return 0===t.deltaX()&&0===e.deltaX()?(t.embedded=!0,e.embedded=!0):t.deltaX()>e.deltaX()?(s=t.right-e.x)>n&&!i||!1===t.checkCollision.right||!1===e.checkCollision.left?s=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0):t.deltaX()<e.deltaX()&&(-(s=t.x-e.width-e.x)>n&&!i||!1===t.checkCollision.left||!1===e.checkCollision.right?s=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=s,e.overlapX=s,s},getOverlapY:function(t,e,i){var s=0,n=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;return 0===t.deltaY()&&0===e.deltaY()?(t.embedded=!0,e.embedded=!0):t.deltaY()>e.deltaY()?(s=t.bottom-e.y)>n&&!i||!1===t.checkCollision.down||!1===e.checkCollision.up?s=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0):t.deltaY()<e.deltaY()&&(-(s=t.y-e.bottom)>n&&!i||!1===t.checkCollision.up||!1===e.checkCollision.down?s=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=s,e.overlapY=s,s},separateX:function(t,e,i){var s=this.getOverlapX(t,e,i);if(i||0===s||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==s||t.embedded&&e.embedded;var n=t.velocity.x,o=e.velocity.x;if(t.immovable||e.immovable)t.immovable?(e.x+=s,e.velocity.x=n-o*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y)):(t.x-=s,t.velocity.x=o-n*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y));else{s*=.5,t.x-=s,e.x+=s;var a=Math.sqrt(o*o*e.mass/t.mass)*(o>0?1:-1),r=Math.sqrt(n*n*t.mass/e.mass)*(n>0?1:-1),h=.5*(a+r);a-=h,r-=h,t.velocity.x=h+a*t.bounce.x,e.velocity.x=h+r*e.bounce.x}return!0},separateY:function(t,e,i){var s=this.getOverlapY(t,e,i);if(i||0===s||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY)return 0!==s||t.embedded&&e.embedded;var n=t.velocity.y,o=e.velocity.y;if(t.immovable||e.immovable)t.immovable?(e.y+=s,e.velocity.y=n-o*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x)):(t.y-=s,t.velocity.y=o-n*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x));else{s*=.5,t.y-=s,e.y+=s;var a=Math.sqrt(o*o*e.mass/t.mass)*(o>0?1:-1),r=Math.sqrt(n*n*t.mass/e.mass)*(n>0?1:-1),h=.5*(a+r);a-=h,r-=h,t.velocity.y=h+a*t.bounce.y,e.velocity.y=h+r*e.bounce.y}return!0},getObjectsUnderPointer:function(t,e,i,s){if(0!==e.length&&t.exists)return this.getObjectsAtLocation(t.x,t.y,e,i,s,t)},getObjectsAtLocation:function(t,e,i,s,o,a){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i);for(var r=new n.Rectangle(t,e,1,1),h=[],l=this.quadTree.retrieve(r),c=0;c<l.length;c++)l[c].hitTest(t,e)&&(s&&s.call(o,a,l[c].sprite),h.push(l[c].sprite));return h},moveToObject:function(t,e,i,s){void 0===i&&(i=60),void 0===s&&(s=0);var n=Math.atan2(e.y-t.y,e.x-t.x);return s>0&&(i=this.distanceBetween(t,e)/(s/1e3)),t.body.velocity.x=Math.cos(n)*i,t.body.velocity.y=Math.sin(n)*i,n},moveToPointer:function(t,e,i,s){void 0===e&&(e=60),i=i||this.game.input.activePointer,void 0===s&&(s=0);var n=this.angleToPointer(t,i);return s>0&&(e=this.distanceToPointer(t,i)/(s/1e3)),t.body.velocity.x=Math.cos(n)*e,t.body.velocity.y=Math.sin(n)*e,n},moveToXY:function(t,e,i,s,n){void 0===s&&(s=60),void 0===n&&(n=0);var o=Math.atan2(i-t.y,e-t.x);return n>0&&(s=this.distanceToXY(t,e,i)/(n/1e3)),t.body.velocity.x=Math.cos(o)*s,t.body.velocity.y=Math.sin(o)*s,o},velocityFromAngle:function(t,e,i){return void 0===e&&(e=60),(i=i||new n.Point).setTo(Math.cos(this.game.math.degToRad(t))*e,Math.sin(this.game.math.degToRad(t))*e)},velocityFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new n.Point).setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerationFromRotation:function(t,e,i){return void 0===e&&(e=60),(i=i||new n.Point).setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerateToObject:function(t,e,i,s,n){void 0===i&&(i=60),void 0===s&&(s=1e3),void 0===n&&(n=1e3);var o=this.angleBetween(t,e);return t.body.acceleration.setTo(Math.cos(o)*i,Math.sin(o)*i),t.body.maxVelocity.setTo(s,n),o},accelerateToPointer:function(t,e,i,s,n){void 0===i&&(i=60),void 0===e&&(e=this.game.input.activePointer),void 0===s&&(s=1e3),void 0===n&&(n=1e3);var o=this.angleToPointer(t,e);return t.body.acceleration.setTo(Math.cos(o)*i,Math.sin(o)*i),t.body.maxVelocity.setTo(s,n),o},accelerateToXY:function(t,e,i,s,n,o){void 0===s&&(s=60),void 0===n&&(n=1e3),void 0===o&&(o=1e3);var a=this.angleToXY(t,e,i);return t.body.acceleration.setTo(Math.cos(a)*s,Math.sin(a)*s),t.body.maxVelocity.setTo(n,o),a},distanceBetween:function(t,e,i){void 0===i&&(i=!1);var s=i?t.world.x-e.world.x:t.x-e.x,n=i?t.world.y-e.world.y:t.y-e.y;return Math.sqrt(s*s+n*n)},distanceToXY:function(t,e,i,s){void 0===s&&(s=!1);var n=s?t.world.x-e:t.x-e,o=s?t.world.y-i:t.y-i;return Math.sqrt(n*n+o*o)},distanceToPointer:function(t,e,i){void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1);var s=i?t.world.x-e.worldX:t.x-e.worldX,n=i?t.world.y-e.worldY:t.y-e.worldY;return Math.sqrt(s*s+n*n)},angleBetween:function(t,e,i){return void 0===i&&(i=!1),i?Math.atan2(e.world.y-t.world.y,e.world.x-t.world.x):Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenCenters:function(t,e){var i=e.centerX-t.centerX,s=e.centerY-t.centerY;return Math.atan2(s,i)},angleToXY:function(t,e,i,s){return void 0===s&&(s=!1),s?Math.atan2(i-t.world.y,e-t.world.x):Math.atan2(i-t.y,e-t.x)},angleToPointer:function(t,e,i){return void 0===e&&(e=this.game.input.activePointer),void 0===i&&(i=!1),i?Math.atan2(e.worldY-t.world.y,e.worldX-t.world.x):Math.atan2(e.worldY-t.y,e.worldX-t.x)},worldAngleToPointer:function(t,e){return this.angleToPointer(t,e,!0)}},n.Physics.Arcade.Body=function(t){this.sprite=t,this.game=t.game,this.type=n.Physics.ARCADE,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new n.Point,this.position=new n.Point(t.x,t.y),this.prev=new n.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=t.angle,this.preRotation=t.angle,this.width=t.width,this.height=t.height,this.sourceWidth=t.width,this.sourceHeight=t.height,t.texture&&(this.sourceWidth=t.texture.frame.width,this.sourceHeight=t.texture.frame.height),this.halfWidth=Math.abs(t.width/2),this.halfHeight=Math.abs(t.height/2),this.center=new n.Point(t.x+this.halfWidth,t.y+this.halfHeight),this.velocity=new n.Point,this.newVelocity=new n.Point,this.deltaMax=new n.Point,this.acceleration=new n.Point,this.drag=new n.Point,this.allowGravity=!0,this.gravity=new n.Point,this.bounce=new n.Point,this.worldBounce=null,this.onWorldBounds=null,this.onCollide=null,this.onOverlap=null,this.maxVelocity=new n.Point(1e4,1e4),this.friction=new n.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=n.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new n.Point,this.dirty=!1,this.skipQuadTree=!1,this.syncBounds=!1,this.isMoving=!1,this.stopVelocityOnCollide=!0,this.moveTimer=0,this.moveDistance=0,this.moveDuration=0,this.moveTarget=null,this.moveEnd=null,this.onMoveComplete=new n.Signal,this.movementCallback=null,this.movementCallbackContext=null,this._reset=!0,this._sx=t.scale.x,this._sy=t.scale.y,this._dx=0,this._dy=0},n.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var t=this.sprite.getBounds();t.ceilAll(),t.width===this.width&&t.height===this.height||(this.width=t.width,this.height=t.height,this._reset=!0)}else{var e=Math.abs(this.sprite.scale.x),i=Math.abs(this.sprite.scale.y);e===this._sx&&i===this._sy||(this.width=this.sourceWidth*e,this.height=this.sourceHeight*i,this._sx=e,this._sy=i,this._reset=!0)}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight))},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var t=0,e=0!==this.overlapX||0!==this.overlapY;if(this.moveDuration>0?(this.moveTimer+=this.game.time.elapsedMS,t=this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),t=this.moveTarget.length/this.moveDistance),this.movementCallback)var i=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,t);return!(e||t>=1||void 0!==i&&!0!==i)||(this.stopMovement(t>=1||this.stopVelocityOnCollide&&e),!1)},stopMovement:function(t){this.isMoving&&(this.isMoving=!1,t&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,this.deltaX()<0?this.facing=n.LEFT:this.deltaX()>0&&(this.facing=n.RIGHT),this.deltaY()<0?this.facing=n.UP:this.deltaY()>0&&(this.facing=n.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var t=this.position,e=this.game.physics.arcade.bounds,i=this.game.physics.arcade.checkCollision,s=this.worldBounce?-this.worldBounce.x:-this.bounce.x,n=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var o={x:this.center.x-this.radius,y:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius};o.x<e.x&&i.left?(t.x=e.x-this.halfWidth+this.radius,this.velocity.x*=s,this.blocked.left=!0):o.right>e.right&&i.right&&(t.x=e.right-this.halfWidth-this.radius,this.velocity.x*=s,this.blocked.right=!0),o.y<e.y&&i.up?(t.y=e.y-this.halfHeight+this.radius,this.velocity.y*=n,this.blocked.up=!0):o.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.halfHeight-this.radius,this.velocity.y*=n,this.blocked.down=!0)}else t.x<e.x&&i.left?(t.x=e.x,this.velocity.x*=s,this.blocked.left=!0):this.right>e.right&&i.right&&(t.x=e.right-this.width,this.velocity.x*=s,this.blocked.right=!0),t.y<e.y&&i.up?(t.y=e.y,this.velocity.y*=n,this.blocked.up=!0):this.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.height,this.velocity.y*=n,this.blocked.down=!0);return this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right},moveFrom:function(t,e,i){return void 0===e&&(e=this.speed),0!==e&&(void 0===i?(s=this.angle,i=this.game.math.radToDeg(s)):s=this.game.math.degToRad(i),this.moveTimer=0,this.moveDuration=t,0===i||180===i?this.velocity.set(Math.cos(s)*e,0):90===i||270===i?this.velocity.set(0,Math.sin(s)*e):this.velocity.set(Math.cos(s)*e,Math.sin(s)*e),this.isMoving=!0,!0);var s},moveTo:function(t,e,i){var s,o=e/(t/1e3);return 0!==o&&(void 0===i?(s=this.angle,i=this.game.math.radToDeg(s)):s=this.game.math.degToRad(i),e=Math.abs(e),this.moveDuration=0,this.moveDistance=e,null===this.moveTarget&&(this.moveTarget=new n.Line,this.moveEnd=new n.Point),this.moveTarget.fromAngle(this.x,this.y,s,e),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,this.y,this.x,this.y),0===i||180===i?this.velocity.set(Math.cos(s)*o,0):90===i||270===i?this.velocity.set(0,Math.sin(s)*o):this.velocity.set(Math.cos(s)*o,Math.sin(s)*o),this.isMoving=!0,!0)},setSize:function(t,e,i,s){void 0===i&&(i=this.offset.x),void 0===s&&(s=this.offset.y),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(i,s),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.isCircle=!1,this.radius=0},setCircle:function(t,e,i){void 0===e&&(e=this.offset.x),void 0===i&&(i=this.offset.y),t>0?(this.isCircle=!0,this.radius=t,this.sourceWidth=2*t,this.sourceHeight=2*t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(e,i),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)):this.isCircle=!1},reset:function(t,e){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},getBounds:function(t){return this.isCircle?(t.x=this.center.x-this.radius,t.y=this.center.y-this.radius,t.right=this.center.x+this.radius,t.bottom=this.center.y+this.radius):(t.x=this.x,t.y=this.y,t.right=this.right,t.bottom=this.bottom),t},hitTest:function(t,e){return this.isCircle?n.Circle.contains(this,t,e):n.Rectangle.contains(this,t,e)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof n.Group&&this.sprite.parent.removeFromHash(this.sprite),this.sprite.body=null,this.sprite=null}},Object.defineProperty(n.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(n.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),n.Physics.Arcade.Body.render=function(t,e,i,s){void 0===s&&(s=!0),i=i||"rgba(0,255,0,0.4)",t.fillStyle=i,t.strokeStyle=i,e.isCircle?(t.beginPath(),t.arc(e.center.x-e.game.camera.x,e.center.y-e.game.camera.y,e.radius,0,2*Math.PI),s?t.fill():t.stroke()):s?t.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height):t.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)},n.Physics.Arcade.Body.renderBodyInfo=function(t,e){t.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height),t.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2)),t.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2)),t.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2)),t.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down),t.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)},n.Physics.Arcade.Body.prototype.constructor=n.Physics.Arcade.Body,n.Physics.Arcade.TilemapCollision=function(){},n.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(t,e,i,s,n,o){if(t.body){var a=e.getTiles(t.body.position.x-t.body.tilePadding.x,t.body.position.y-t.body.tilePadding.y,t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,!1,!1);if(0!==a.length)for(var r=0;r<a.length;r++)s?s.call(n,t,a[r])&&this.separateTile(r,t.body,a[r],e,o)&&(this._total++,i&&i.call(n,t,a[r])):this.separateTile(r,t.body,a[r],e,o)&&(this._total++,i&&i.call(n,t,a[r]))}},collideGroupVsTilemapLayer:function(t,e,i,s,n,o){if(0!==t.length)for(var a=0;a<t.children.length;a++)t.children[a].exists&&this.collideSpriteVsTilemapLayer(t.children[a],e,i,s,n,o)},separateTile:function(t,e,i,s,n){if(!e.enable)return!1;var o=s.fixedToCamera?0:s.position.x,a=s.fixedToCamera?0:s.position.y;if(!i.intersects(e.position.x-o,e.position.y-a,e.right-o,e.bottom-a))return!1;if(n)return!0;if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,e.sprite,i))return!1;if(void 0!==i.layer.callbacks&&i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,e.sprite,i))return!1;if(!(i.faceLeft||i.faceRight||i.faceTop||i.faceBottom))return!1;var r=0,h=0,l=0,c=1;if(e.deltaAbsX()>e.deltaAbsY()?l=-1:e.deltaAbsX()<e.deltaAbsY()&&(c=-1),0!==e.deltaX()&&0!==e.deltaY()&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(l=Math.min(Math.abs(e.position.x-o-i.right),Math.abs(e.right-o-i.left)),c=Math.min(Math.abs(e.position.y-a-i.bottom),Math.abs(e.bottom-a-i.top))),l<c){if((i.faceLeft||i.faceRight)&&0!==(r=this.tileCheckX(e,i,s))&&!i.intersects(e.position.x-o,e.position.y-a,e.right-o,e.bottom-a))return!0;(i.faceTop||i.faceBottom)&&(h=this.tileCheckY(e,i,s))}else{if((i.faceTop||i.faceBottom)&&0!==(h=this.tileCheckY(e,i,s))&&!i.intersects(e.position.x-o,e.position.y-a,e.right-o,e.bottom-a))return!0;(i.faceLeft||i.faceRight)&&(r=this.tileCheckX(e,i,s))}return 0!==r||0!==h},tileCheckX:function(t,e,i){var s=0,n=i.fixedToCamera?0:i.position.x;return t.deltaX()<0&&!t.blocked.left&&e.collideRight&&t.checkCollision.left?e.faceRight&&t.x-n<e.right&&(s=t.x-n-e.right)<-this.TILE_BIAS&&(s=0):t.deltaX()>0&&!t.blocked.right&&e.collideLeft&&t.checkCollision.right&&e.faceLeft&&t.right-n>e.left&&(s=t.right-n-e.left)>this.TILE_BIAS&&(s=0),0!==s&&(t.customSeparateX?t.overlapX=s:this.processTileSeparationX(t,s)),s},tileCheckY:function(t,e,i){var s=0,n=i.fixedToCamera?0:i.position.y;return t.deltaY()<0&&!t.blocked.up&&e.collideDown&&t.checkCollision.up?e.faceBottom&&t.y-n<e.bottom&&(s=t.y-n-e.bottom)<-this.TILE_BIAS&&(s=0):t.deltaY()>0&&!t.blocked.down&&e.collideUp&&t.checkCollision.down&&e.faceTop&&t.bottom-n>e.top&&(s=t.bottom-n-e.top)>this.TILE_BIAS&&(s=0),0!==s&&(t.customSeparateY?t.overlapY=s:this.processTileSeparationY(t,s)),s},processTileSeparationX:function(t,e){e<0?t.blocked.left=!0:e>0&&(t.blocked.right=!0),t.position.x-=e,0===t.bounce.x?t.velocity.x=0:t.velocity.x=-t.velocity.x*t.bounce.x},processTileSeparationY:function(t,e){e<0?t.blocked.up=!0:e>0&&(t.blocked.down=!0),t.position.y-=e,0===t.bounce.y?t.velocity.y=0:t.velocity.y=-t.velocity.y*t.bounce.y}},n.Utils.mixinPrototype(n.Physics.Arcade.prototype,n.Physics.Arcade.TilemapCollision.prototype),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,n.Physics.P2=function(t,e){this.game=t,void 0===e?e={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(e.hasOwnProperty("gravity")||(e.gravity=[0,0]),e.hasOwnProperty("broadphase")||(e.broadphase=new p2.SAPBroadphase)),this.config=e,this.world=new p2.World(this.config),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new n.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new n.Signal,this.onBodyRemoved=new n.Signal,this.onSpringAdded=new n.Signal,this.onSpringRemoved=new n.Signal,this.onConstraintAdded=new n.Signal,this.onConstraintRemoved=new n.Signal,this.onContactMaterialAdded=new n.Signal,this.onContactMaterialRemoved=new n.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new n.Signal,this.onEndContact=new n.Signal,e.hasOwnProperty("mpx")&&e.hasOwnProperty("pxm")&&e.hasOwnProperty("mpxi")&&e.hasOwnProperty("pxmi")&&(this.mpx=e.mpx,this.mpxi=e.mpxi,this.pxm=e.pxm,this.pxmi=e.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new n.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new n.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new n.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this._boundsLeft=!0,this._boundsRight=!0,this._boundsTop=!0,this._boundsBottom=!0,this._boundsOwnGroup=!1,this.setBoundsToWorld(!0,!0,!0,!0,!1)},n.Physics.P2.prototype={removeBodyNextStep:function(t){this._toRemove.push(t)},preUpdate:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0},enable:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!0);var s=1;if(Array.isArray(t))for(s=t.length;s--;)t[s]instanceof n.Group?this.enable(t[s].children,e,i):(this.enableBody(t[s],e),i&&t[s].hasOwnProperty("children")&&t[s].children.length>0&&this.enable(t[s],e,!0));else t instanceof n.Group?this.enable(t.children,e,i):(this.enableBody(t,e),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,e,!0))},enableBody:function(t,e){t.hasOwnProperty("body")&&null===t.body&&(t.body=new n.Physics.P2.Body(this.game,t,t.x,t.y,1),t.body.debug=e,void 0!==t.anchor&&t.anchor.set(.5))},setImpactEvents:function(t){t?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(t,e){this.postBroadphaseCallback=t,this.callbackContext=e,null!==t?this.world.on("postBroadphase",this.postBroadphaseHandler,this):this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(t){if(this.postBroadphaseCallback&&0!==t.pairs.length)for(var e=t.pairs.length-2;e>=0;e-=2)t.pairs[e].parent&&t.pairs[e+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,t.pairs[e].parent,t.pairs[e+1].parent)&&t.pairs.splice(e,2)},impactHandler:function(t){if(t.bodyA.parent&&t.bodyB.parent){var e=t.bodyA.parent,i=t.bodyB.parent;e._bodyCallbacks[t.bodyB.id]&&e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,i,t.shapeA,t.shapeB),i._bodyCallbacks[t.bodyA.id]&&i._bodyCallbacks[t.bodyA.id].call(i._bodyCallbackContext[t.bodyA.id],i,e,t.shapeB,t.shapeA),e._groupCallbacks[t.shapeB.collisionGroup]&&e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,i,t.shapeA,t.shapeB),i._groupCallbacks[t.shapeA.collisionGroup]&&i._groupCallbacks[t.shapeA.collisionGroup].call(i._groupCallbackContext[t.shapeA.collisionGroup],i,e,t.shapeB,t.shapeA)}},beginContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onBeginContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyA.parent&&t.bodyA.parent.onBeginContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB,t.contactEquations),t.bodyB.parent&&t.bodyB.parent.onBeginContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA,t.contactEquations))},endContactHandler:function(t){t.bodyA&&t.bodyB&&(this.onEndContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB),t.bodyA.parent&&t.bodyA.parent.onEndContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB),t.bodyB.parent&&t.bodyB.parent.onEndContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA))},setBoundsToWorld:function(t,e,i,s,n){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,e,i,s,n)},setWorldMaterial:function(t,e,i,s,n){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===n&&(n=!0),e&&this.walls.left&&(this.walls.left.shapes[0].material=t),i&&this.walls.right&&(this.walls.right.shapes[0].material=t),s&&this.walls.top&&(this.walls.top.shapes[0].material=t),n&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=t)},updateBoundsCollisionGroup:function(t){void 0===t&&(t=!0);var e=t?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=e),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=e),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=e),this._boundsOwnGroup=t},setBounds:function(t,e,i,s,n,o,a,r,h){void 0===n&&(n=this._boundsLeft),void 0===o&&(o=this._boundsRight),void 0===a&&(a=this._boundsTop),void 0===r&&(r=this._boundsBottom),void 0===h&&(h=this._boundsOwnGroup),this.setupWall(n,"left",t,e,1.5707963267948966,h),this.setupWall(o,"right",t+i,e,-1.5707963267948966,h),this.setupWall(a,"top",t,e,-3.141592653589793,h),this.setupWall(r,"bottom",t,e+s,0,h),this._boundsLeft=n,this._boundsRight=o,this._boundsTop=a,this._boundsBottom=r,this._boundsOwnGroup=h},setupWall:function(t,e,i,s,n,o){t?(this.walls[e]?this.walls[e].position=[this.pxmi(i),this.pxmi(s)]:(this.walls[e]=new p2.Body({mass:0,position:[this.pxmi(i),this.pxmi(s)],angle:n}),this.walls[e].addShape(new p2.Plane),this.world.addBody(this.walls[e])),o&&(this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[e]&&(this.world.removeBody(this.walls[e]),this.walls[e]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.nothingCollisionGroup=new n.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new n.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new n.Physics.P2.CollisionGroup(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var t=this.world.constraints,e=t.length-1;e>=0;e--)this.world.removeConstraint(t[e]);var i=this.world.bodies;for(e=i.length-1;e>=0;e--)this.world.removeBody(i[e]);var s=this.world.springs;for(e=s.length-1;e>=0;e--)this.world.removeSpring(s[e]);var n=this.world.contactMaterials;for(e=n.length-1;e>=0;e--)this.world.removeContactMaterial(n[e]);this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear(),this.game=null},addBody:function(t){return!t.data.world&&(this.world.addBody(t.data),this.onBodyAdded.dispatch(t),!0)},removeBody:function(t){return t.data.world===this.world&&(this.world.removeBody(t.data),this.onBodyRemoved.dispatch(t)),t},addSpring:function(t){return t instanceof n.Physics.P2.Spring||t instanceof n.Physics.P2.RotationalSpring?this.world.addSpring(t.data):this.world.addSpring(t),this.onSpringAdded.dispatch(t),t},removeSpring:function(t){return t instanceof n.Physics.P2.Spring||t instanceof n.Physics.P2.RotationalSpring?this.world.removeSpring(t.data):this.world.removeSpring(t),this.onSpringRemoved.dispatch(t),t},createDistanceConstraint:function(t,e,i,s,o,a){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new n.Physics.P2.DistanceConstraint(this,t,e,i,s,o,a))},createGearConstraint:function(t,e,i,s){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new n.Physics.P2.GearConstraint(this,t,e,i,s))},createRevoluteConstraint:function(t,e,i,s,o,a){if(t=this.getBody(t),i=this.getBody(i),t&&i)return this.addConstraint(new n.Physics.P2.RevoluteConstraint(this,t,e,i,s,o,a))},createLockConstraint:function(t,e,i,s,o){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new n.Physics.P2.LockConstraint(this,t,e,i,s,o))},createPrismaticConstraint:function(t,e,i,s,o,a,r){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addConstraint(new n.Physics.P2.PrismaticConstraint(this,t,e,i,s,o,a,r))},addConstraint:function(t){return this.world.addConstraint(t),this.onConstraintAdded.dispatch(t),t},removeConstraint:function(t){return this.world.removeConstraint(t),this.onConstraintRemoved.dispatch(t),t},addContactMaterial:function(t){return this.world.addContactMaterial(t),this.onContactMaterialAdded.dispatch(t),t},removeContactMaterial:function(t){return this.world.removeContactMaterial(t),this.onContactMaterialRemoved.dispatch(t),t},getContactMaterial:function(t,e){return this.world.getContactMaterial(t,e)},setMaterial:function(t,e){for(var i=e.length;i--;)e[i].setMaterial(t)},createMaterial:function(t,e){t=t||"";var i=new n.Physics.P2.Material(t);return this.materials.push(i),void 0!==e&&e.setMaterial(i),i},createContactMaterial:function(t,e,i){void 0===t&&(t=this.createMaterial()),void 0===e&&(e=this.createMaterial());var s=new n.Physics.P2.ContactMaterial(t,e,i);return this.addContactMaterial(s)},getBodies:function(){for(var t=[],e=this.world.bodies.length;e--;)t.push(this.world.bodies[e].parent);return t},getBody:function(t){return t instanceof p2.Body?t:t instanceof n.Physics.P2.Body?t.data:t.body&&t.body.type===n.Physics.P2JS?t.body.data:null},getSprings:function(){for(var t=[],e=this.world.springs.length;e--;)t.push(this.world.springs[e].parent);return t},getConstraints:function(){for(var t=[],e=this.world.constraints.length;e--;)t.push(this.world.constraints[e]);return t},hitTest:function(t,e,i,s){void 0===e&&(e=this.world.bodies),void 0===i&&(i=5),void 0===s&&(s=!1);for(var o=[this.pxmi(t.x),this.pxmi(t.y)],a=[],r=e.length;r--;)e[r]instanceof n.Physics.P2.Body&&(!s||e[r].data.type!==p2.Body.STATIC)?a.push(e[r].data):e[r]instanceof p2.Body&&e[r].parent&&(!s||e[r].type!==p2.Body.STATIC)?a.push(e[r]):e[r]instanceof n.Sprite&&e[r].hasOwnProperty("body")&&(!s||e[r].body.data.type!==p2.Body.STATIC)&&a.push(e[r].body.data);return this.world.hitTest(o,a,i)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var e=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e),this._collisionGroupID++;var i=new n.Physics.P2.CollisionGroup(e);return this.collisionGroups.push(i),t&&this.setCollisionGroup(t,i),i},setCollisionGroup:function(t,e){if(t instanceof n.Group)for(var i=0;i<t.total;i++)t.children[i].body&&t.children[i].body.type===n.Physics.P2JS&&t.children[i].body.setCollisionGroup(e);else t.body.setCollisionGroup(e)},createSpring:function(t,e,i,s,o,a,r,h,l){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addSpring(new n.Physics.P2.Spring(this,t,e,i,s,o,a,r,h,l))},createRotationalSpring:function(t,e,i,s,o){if(t=this.getBody(t),e=this.getBody(e),t&&e)return this.addSpring(new n.Physics.P2.RotationalSpring(this,t,e,i,s,o))},createBody:function(t,e,i,s,o,a){void 0===s&&(s=!1);var r=new n.Physics.P2.Body(this.game,null,t,e,i);return!(a&&!r.addPolygon(o,a))&&(s&&this.world.addBody(r.data),r)},createParticle:function(t,e,i,s,o,a){void 0===s&&(s=!1);var r=new n.Physics.P2.Body(this.game,null,t,e,i);return!(a&&!r.addPolygon(o,a))&&(s&&this.world.addBody(r.data),r)},convertCollisionObjects:function(t,e,i){void 0===i&&(i=!0);for(var s=[],n=0,o=t.collision[e].length;n<o;n++){var a=t.collision[e][n],r=this.createBody(a.x,a.y,0,i,{},a.polyline);r&&s.push(r)}return s},clearTilemapLayerBodies:function(t,e){e=t.getLayer(e);for(var i=t.layers[e].bodies.length;i--;)t.layers[e].bodies[i].destroy();t.layers[e].bodies.length=0},convertTilemap:function(t,e,i,s){e=t.getLayer(e),void 0===i&&(i=!0),void 0===s&&(s=!0),this.clearTilemapLayerBodies(t,e);for(var n=0,o=0,a=0,r=0,h=t.layers[e].height;r<h;r++){n=0;for(var l=0,c=t.layers[e].width;l<c;l++){var u=t.layers[e].data[r][l];if(u&&u.index>-1&&u.collides)if(s){var d=t.getTileRight(e,l,r);if(0===n&&(o=u.x*u.width,a=u.y*u.height,n=u.width),d&&d.collides)n+=u.width;else(p=this.createBody(o,a,0,!1)).addRectangle(n,u.height,n/2,u.height/2,0),i&&this.addBody(p),t.layers[e].bodies.push(p),n=0}else{var p;(p=this.createBody(u.x*u.width,u.y*u.height,0,!1)).addRectangle(u.width,u.height,u.width/2,u.height/2,0),i&&this.addBody(p),t.layers[e].bodies.push(p)}}}return t.layers[e].bodies},mpx:function(t){return 20*t},pxm:function(t){return.05*t},mpxi:function(t){return-20*t},pxmi:function(t){return-.05*t}},Object.defineProperty(n.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}}),Object.defineProperty(n.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}}),Object.defineProperty(n.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}}),Object.defineProperty(n.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}}),Object.defineProperty(n.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}}),Object.defineProperty(n.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}}),Object.defineProperty(n.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}}),Object.defineProperty(n.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(n.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}}),Object.defineProperty(n.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}}),Object.defineProperty(n.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),n.Physics.P2.FixtureList=function(t){Array.isArray(t)||(t=[t]),this.rawList=t,this.init(),this.parse(this.rawList)},n.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(t,e){this.getFixtures(e).forEach(function(e){e.collisionGroup=t})},setMask:function(t,e){this.getFixtures(e).forEach(function(e){e.collisionMask=t})},setSensor:function(t,e){this.getFixtures(e).forEach(function(e){e.sensor=t})},setMaterial:function(t,e){this.getFixtures(e).forEach(function(e){e.material=t})},getFixtures:function(t){var e=[];if(t){t instanceof Array||(t=[t]);var i=this;return t.forEach(function(t){i.namedFixtures[t]&&e.push(i.namedFixtures[t])}),this.flatten(e)}return this.allFixtures},getFixtureByKey:function(t){return this.namedFixtures[t]},getGroup:function(t){return this.groupedFixtures[t]},parse:function(){var t,e,i,s;for(t in s=[],i=this.rawList)e=i[t],isNaN(t-0)?this.namedFixtures[t]=this.flatten(e):(this.groupedFixtures[t]=this.groupedFixtures[t]||[],this.groupedFixtures[t]=this.groupedFixtures[t].concat(e)),s.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(t){var e,i;return e=[],i=arguments.callee,t.forEach(function(t){return Array.prototype.push.apply(e,Array.isArray(t)?i(t):[t])}),e}},n.Physics.P2.PointProxy=function(t,e){this.world=t,this.destination=e},n.Physics.P2.PointProxy.prototype.constructor=n.Physics.P2.PointProxy,Object.defineProperty(n.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(t){this.destination[0]=this.world.pxm(t)}}),Object.defineProperty(n.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(t){this.destination[1]=this.world.pxm(t)}}),Object.defineProperty(n.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=t}}),Object.defineProperty(n.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=t}}),n.Physics.P2.InversePointProxy=function(t,e){this.world=t,this.destination=e},n.Physics.P2.InversePointProxy.prototype.constructor=n.Physics.P2.InversePointProxy,Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}}),Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}}),Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}}),Object.defineProperty(n.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=-t}}),n.Physics.P2.Body=function(t,e,i,s,o){e=e||null,i=i||0,s=s||0,void 0===o&&(o=1),this.game=t,this.world=t.physics.p2,this.sprite=e,this.type=n.Physics.P2JS,this.offset=new n.Point,this.data=new p2.Body({position:[this.world.pxmi(i),this.world.pxmi(s)],mass:o}),this.data.parent=this,this.velocity=new n.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new n.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new n.Point,this.onBeginContact=new n.Signal,this.onEndContact=new n.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this.dirty=!1,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this._reset=!1,e&&(this.setRectangleFromSprite(e),e.exists&&this.game.physics.p2.addBody(this))},n.Physics.P2.Body.prototype={createBodyCallback:function(t,e,i){var s=-1;t.id?s=t.id:t.body&&(s=t.body.id),s>-1&&(null===e?(delete this._bodyCallbacks[s],delete this._bodyCallbackContext[s]):(this._bodyCallbacks[s]=e,this._bodyCallbackContext[s]=i))},createGroupCallback:function(t,e,i){null===e?(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]):(this._groupCallbacks[t.mask]=e,this._groupCallbackContext[t.mask]=i)},getCollisionMask:function(){var t=0;this._collideWorldBounds&&(t=this.game.physics.p2.boundsCollisionGroup.mask);for(var e=0;e<this.collidesWith.length;e++)t|=this.collidesWith[e].mask;return t},updateCollisionMask:function(t){var e=this.getCollisionMask();if(void 0===t)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionMask=e;else t.collisionMask=e},setCollisionGroup:function(t,e){var i=this.getCollisionMask();if(void 0===e)for(var s=this.data.shapes.length-1;s>=0;s--)this.data.shapes[s].collisionGroup=t.mask,this.data.shapes[s].collisionMask=i;else e.collisionGroup=t.mask,e.collisionMask=i},clearCollision:function(t,e,i){if(void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i)for(var s=this.data.shapes.length-1;s>=0;s--)t&&(this.data.shapes[s].collisionGroup=null),e&&(this.data.shapes[s].collisionMask=null);else t&&(i.collisionGroup=null),e&&(i.collisionMask=null);t&&(this.collidesWith.length=0)},removeCollisionGroup:function(t,e,i){var s;if(void 0===e&&(e=!0),Array.isArray(t))for(var n=0;n<t.length;n++)(s=this.collidesWith.indexOf(t[n]))>-1&&(this.collidesWith.splice(s,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));else(s=this.collidesWith.indexOf(t))>-1&&(this.collidesWith.splice(s,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));var o=this.getCollisionMask();if(void 0===i)for(n=this.data.shapes.length-1;n>=0;n--)this.data.shapes[n].collisionMask=o;else i.collisionMask=o},collides:function(t,e,i,s){if(Array.isArray(t))for(var n=0;n<t.length;n++)-1===this.collidesWith.indexOf(t[n])&&(this.collidesWith.push(t[n]),e&&this.createGroupCallback(t[n],e,i));else-1===this.collidesWith.indexOf(t)&&(this.collidesWith.push(t),e&&this.createGroupCallback(t,e,i));var o=this.getCollisionMask();if(void 0===s)for(n=this.data.shapes.length-1;n>=0;n--)this.data.shapes[n].collisionMask=o;else s.collisionMask=o},adjustCenterOfMass:function(){this.data.adjustCenterOfMass(),this.shapeChanged()},getVelocityAtPoint:function(t,e){return this.data.getVelocityAtPoint(t,e)},applyDamping:function(t){this.data.applyDamping(t)},applyImpulse:function(t,e,i){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyImpulseLocal:function(t,e,i){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyForce:function(t,e,i){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(t,e){return this.data.toLocalFrame(t,e)},toWorldFrame:function(t,e){return this.data.toWorldFrame(t,e)},rotateLeft:function(t){this.data.angularVelocity=this.world.pxm(-t)},rotateRight:function(t){this.data.angularVelocity=this.world.pxm(t)},moveForward:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(i),this.data.velocity[1]=e*Math.sin(i)},moveBackward:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.velocity[0]=-e*Math.cos(i),this.data.velocity[1]=-e*Math.sin(i)},thrust:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.force[0]+=e*Math.cos(i),this.data.force[1]+=e*Math.sin(i)},thrustLeft:function(t){var e=this.world.pxmi(-t),i=this.data.angle;this.data.force[0]+=e*Math.cos(i),this.data.force[1]+=e*Math.sin(i)},thrustRight:function(t){var e=this.world.pxmi(-t),i=this.data.angle;this.data.force[0]-=e*Math.cos(i),this.data.force[1]-=e*Math.sin(i)},reverse:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.force[0]-=e*Math.cos(i),this.data.force[1]-=e*Math.sin(i)},moveLeft:function(t){this.data.velocity[0]=this.world.pxmi(-t)},moveRight:function(t){this.data.velocity[0]=this.world.pxmi(t)},moveUp:function(t){this.data.velocity[1]=this.world.pxmi(-t)},moveDown:function(t){this.data.velocity[1]=this.world.pxmi(t)},preUpdate:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation||(this.sprite.rotation=this.data.angle),this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1},reset:function(t,e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),i&&this.setZeroDamping(),s&&(this.mass=1),this.x=t,this.y=e},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var t=0;t<this.game.physics.p2._toRemove.length;t++)this.game.physics.p2._toRemove[t]===this&&this.game.physics.p2._toRemove.splice(t,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var t=this.data.shapes.length;t--;)this.data.removeShape(this.data.shapes[t]);this.shapeChanged()},addShape:function(t,e,i,s){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(i)],s),this.shapeChanged(),t},addCircle:function(t,e,i,s){var n=new p2.Circle({radius:this.world.pxm(t)});return this.addShape(n,e,i,s)},addRectangle:function(t,e,i,s,n){var o=new p2.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(o,i,s,n)},addPlane:function(t,e,i){var s=new p2.Plane;return this.addShape(s,t,e,i)},addParticle:function(t,e,i){var s=new p2.Particle;return this.addShape(s,t,e,i)},addLine:function(t,e,i,s){var n=new p2.Line({length:this.world.pxm(t)});return this.addShape(n,e,i,s)},addCapsule:function(t,e,i,s,n){var o=new p2.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(o,i,s,n)},addPolygon:function(t,e){t=t||{},Array.isArray(e)||(e=Array.prototype.slice.call(arguments,1));var i=[];if(1===e.length&&Array.isArray(e[0]))i=e[0].slice(0);else if(Array.isArray(e[0]))i=e.slice();else if("number"==typeof e[0])for(var s=0,n=e.length;s<n;s+=2)i.push([e[s],e[s+1]]);var o=i.length-1;i[o][0]===i[0][0]&&i[o][1]===i[0][1]&&i.pop();for(var a=0;a<i.length;a++)i[a][0]=this.world.pxmi(i[a][0]),i[a][1]=this.world.pxmi(i[a][1]);var r=this.data.fromPolygon(i,t);return this.shapeChanged(),r},removeShape:function(t){var e=this.data.removeShape(t);return this.shapeChanged(),e},setCircle:function(t,e,i,s){return this.clearShapes(),this.addCircle(t,e,i,s)},setRectangle:function(t,e,i,s,n){return void 0===t&&(t=16),void 0===e&&(e=16),this.clearShapes(),this.addRectangle(t,e,i,s,n)},setRectangleFromSprite:function(t){return void 0===t&&(t=this.sprite),this.clearShapes(),this.addRectangle(t.width,t.height,0,0,t.rotation)},setMaterial:function(t,e){if(void 0===e)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].material=t;else e.material=t},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(t,e){for(var i=this.game.cache.getPhysicsData(t,e),s=[],n=0;n<i.length;n++){var o=i[n],a=this.addFixture(o);s[o.filter.group]=s[o.filter.group]||[],s[o.filter.group]=s[o.filter.group].concat(a),o.fixtureKey&&(s[o.fixtureKey]=a)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),s},addFixture:function(t){var e=[];if(t.circle){(l=new p2.Circle({radius:this.world.pxm(t.circle.radius)})).collisionGroup=t.filter.categoryBits,l.collisionMask=t.filter.maskBits,l.sensor=t.isSensor;var i=p2.vec2.create();i[0]=this.world.pxmi(t.circle.position[0]-this.sprite.width/2),i[1]=this.world.pxmi(t.circle.position[1]-this.sprite.height/2),this.data.addShape(l,i),e.push(l)}else for(var s=t.polygons,n=p2.vec2.create(),o=0;o<s.length;o++){for(var a=s[o],r=[],h=0;h<a.length;h+=2)r.push([this.world.pxmi(a[h]),this.world.pxmi(a[h+1])]);for(var l=new p2.Convex({vertices:r}),c=0;c!==l.vertices.length;c++){var u=l.vertices[c];p2.vec2.sub(u,u,l.centerOfMass)}p2.vec2.scale(n,l.centerOfMass,1),n[0]-=this.world.pxmi(this.sprite.width/2),n[1]-=this.world.pxmi(this.sprite.height/2),l.updateTriangles(),l.updateCenterOfMass(),l.updateBoundingRadius(),l.collisionGroup=t.filter.categoryBits,l.collisionMask=t.filter.maskBits,l.sensor=t.isSensor,this.data.addShape(l,n),e.push(l)}return e},loadPolygon:function(t,e){if(null===t)var i=e;else i=this.game.cache.getPhysicsData(t,e);for(var s=p2.vec2.create(),n=0;n<i.length;n++){for(var o=[],a=0;a<i[n].shape.length;a+=2)o.push([this.world.pxmi(i[n].shape[a]),this.world.pxmi(i[n].shape[a+1])]);for(var r=new p2.Convex({vertices:o}),h=0;h!==r.vertices.length;h++){var l=r.vertices[h];p2.vec2.sub(l,l,r.centerOfMass)}p2.vec2.scale(s,r.centerOfMass,1),s[0]-=this.world.pxmi(this.sprite.width/2),s[1]-=this.world.pxmi(this.sprite.height/2),r.updateTriangles(),r.updateCenterOfMass(),r.updateBoundingRadius(),this.data.addShape(r,s)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},n.Physics.P2.Body.prototype.constructor=n.Physics.P2.Body,n.Physics.P2.Body.DYNAMIC=1,n.Physics.P2.Body.STATIC=2,n.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(n.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===n.Physics.P2.Body.STATIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.STATIC?(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0):t||this.data.type!==n.Physics.P2.Body.STATIC||(this.data.type=n.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===n.Physics.P2.Body.DYNAMIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.DYNAMIC?(this.data.type=n.Physics.P2.Body.DYNAMIC,this.mass=1):t||this.data.type!==n.Physics.P2.Body.DYNAMIC||(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===n.Physics.P2.Body.KINEMATIC},set:function(t){t&&this.data.type!==n.Physics.P2.Body.KINEMATIC?(this.data.type=n.Physics.P2.Body.KINEMATIC,this.mass=4):t||this.data.type!==n.Physics.P2.Body.KINEMATIC||(this.data.type=n.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(t){t!==this.data.allowSleep&&(this.data.allowSleep=t)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=n.Math.degToRad(n.Math.wrapAngle(t))}}),Object.defineProperty(n.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}}),Object.defineProperty(n.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(t){this.data.angularForce=t}}),Object.defineProperty(n.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}}),Object.defineProperty(n.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(t){this.data.damping=t}}),Object.defineProperty(n.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(t){t!==this.data.fixedRotation&&(this.data.fixedRotation=t)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}}),Object.defineProperty(n.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(t){t!==this.data.mass&&(this.data.mass=t,this.data.updateMassProperties())}}),Object.defineProperty(n.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(t){t!==this.data.type&&(this.data.type=t)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(t){this.data.angle=t}}),Object.defineProperty(n.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}}),Object.defineProperty(n.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(n.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?this.debugBody=new n.Physics.P2.BodyDebug(this.game,this.data):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(n.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(t){t&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!t&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),n.Physics.P2.BodyDebug=function(t,e,i){n.Group.call(this,t);var s={pixelsPerLengthUnit:t.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=n.Utils.extend(s,i),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=e,this.canvas=new n.Graphics(t),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw(),this.updateSpriteTransform()},n.Physics.P2.BodyDebug.prototype=Object.create(n.Group.prototype),n.Physics.P2.BodyDebug.prototype.constructor=n.Physics.P2.BodyDebug,n.Utils.extend(n.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var t,e,i,s,n,o,a,r,h,l,c,u,d,p,f;if(r=this.body,(l=this.canvas).clear(),i=parseInt(this.randomPastelHex(),16),o=16711680,a=this.lineWidth,r instanceof p2.Body&&r.shapes.length){var y=r.shapes.length;for(s=0;s!==y;){if(h=(e=r.shapes[s]).position||0,t=e.angle||0,e instanceof p2.Circle)this.drawCircle(l,h[0]*this.ppu,h[1]*this.ppu,t,e.radius*this.ppu,i,a);else if(e instanceof p2.Capsule)this.drawCapsule(l,h[0]*this.ppu,h[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,o,i,a);else if(e instanceof p2.Plane)this.drawPlane(l,h[0]*this.ppu,-h[1]*this.ppu,i,o,5*a,10*a,10*a,100*this.ppu,t);else if(e instanceof p2.Line)this.drawLine(l,e.length*this.ppu,o,a);else if(e instanceof p2.Box)this.drawRectangle(l,h[0]*this.ppu,h[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,o,i,a);else if(e instanceof p2.Convex){for(u=[],d=p2.vec2.create(),n=p=0,f=e.vertices.length;0<=f?p<f:p>f;n=0<=f?++p:--p)c=e.vertices[n],p2.vec2.rotate(d,c,t),u.push([(d[0]+h[0])*this.ppu,-(d[1]+h[1])*this.ppu]);this.drawConvex(l,u,e.triangles,o,i,a,this.settings.debugPolygons,[h[0]*this.ppu,-h[1]*this.ppu])}s++}}},drawRectangle:function(t,e,i,s,n,o,a,r,h){void 0===h&&(h=1),void 0===a&&(a=0),t.lineStyle(h,a,1),t.beginFill(r),t.drawRect(e-n/2,i-o/2,n,o)},drawCircle:function(t,e,i,s,n,o,a){void 0===a&&(a=1),void 0===o&&(o=16777215),t.lineStyle(a,0,1),t.beginFill(o,1),t.drawCircle(e,i,2*-n),t.endFill(),t.moveTo(e,i),t.lineTo(e+n*Math.cos(-s),i+n*Math.sin(-s))},drawLine:function(t,e,i,s){void 0===s&&(s=1),void 0===i&&(i=0),t.lineStyle(5*s,i,1),t.moveTo(-e/2,0),t.lineTo(e/2,0)},drawConvex:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,y,g,m,v;if(void 0===o&&(o=1),void 0===s&&(s=0),a){for(h=[16711680,65280,255],l=0;l!==e.length+1;)u=e[l%e.length],d=e[(l+1)%e.length],f=u[0],m=u[1],y=d[0],v=d[1],t.lineStyle(o,h[l%h.length],1),t.moveTo(f,-m),t.lineTo(y,-v),t.drawCircle(f,-m,2*o),l++;return t.lineStyle(o,0,1),t.drawCircle(r[0],r[1],2*o)}for(t.lineStyle(o,s,1),t.beginFill(n),l=0;l!==e.length;)p=(c=e[l])[0],g=c[1],0===l?t.moveTo(p,-g):t.lineTo(p,-g),l++;if(t.endFill(),e.length>2)return t.moveTo(e[e.length-1][0],-e[e.length-1][1]),t.lineTo(e[0][0],-e[0][1])},drawPath:function(t,e,i,s,n){var o,a,r,h,l,c,u,d,p,f,y;for(void 0===n&&(n=1),void 0===i&&(i=0),t.lineStyle(n,i,1),"number"==typeof s&&t.beginFill(s),a=null,r=null,o=0;o<e.length;)f=(p=e[o])[0],y=p[1],f===a&&y===r||(0===o?t.moveTo(f,y):(h=a,l=r,c=f,u=y,d=e[(o+1)%e.length][0],0!=(c-h)*(e[(o+1)%e.length][1]-l)-(d-h)*(u-l)&&t.lineTo(f,y)),a=f,r=y),o++;"number"==typeof s&&t.endFill(),e.length>2&&"number"==typeof s&&(t.moveTo(e[e.length-1][0],e[e.length-1][1]),t.lineTo(e[0][0],e[0][1]))},drawPlane:function(t,e,i,s,n,o,a,r,h,l){var c,u;void 0===o&&(o=1),void 0===s&&(s=16777215),t.lineStyle(o,n,11),t.beginFill(s),t.moveTo(e,-i),c=e+Math.cos(l)*this.game.width,u=i+Math.sin(l)*this.game.height,t.lineTo(c,-u),t.moveTo(e,-i),c=e+Math.cos(l)*-this.game.width,u=i+Math.sin(l)*-this.game.height,t.lineTo(c,-u)},drawCapsule:function(t,e,i,s,n,o,a,r,h){void 0===h&&(h=1),void 0===a&&(a=0),t.lineStyle(h,a,1);var l=Math.cos(s),c=Math.sin(s);t.beginFill(r,1),t.drawCircle(-n/2*l+e,-n/2*c+i,2*-o),t.drawCircle(n/2*l+e,n/2*c+i,2*-o),t.endFill(),t.lineStyle(h,a,0),t.beginFill(r,1),t.moveTo(-n/2*l+o*c+e,-n/2*c+o*l+i),t.lineTo(n/2*l+o*c+e,n/2*c+o*l+i),t.lineTo(n/2*l-o*c+e,n/2*c-o*l+i),t.lineTo(-n/2*l-o*c+e,-n/2*c-o*l+i),t.endFill(),t.lineStyle(h,a,1),t.moveTo(-n/2*l+o*c+e,-n/2*c+o*l+i),t.lineTo(n/2*l+o*c+e,n/2*c+o*l+i),t.moveTo(-n/2*l-o*c+e,-n/2*c-o*l+i),t.lineTo(n/2*l-o*c+e,n/2*c-o*l+i)},randomPastelHex:function(){var t,e,i,s;return i=[255,255,255],s=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),s=Math.floor((s+3*i[0])/4),e=Math.floor((e+3*i[1])/4),t=Math.floor((t+3*i[2])/4),this.rgbToHex(s,e,t)},rgbToHex:function(t,e,i){return this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},componentToHex:function(t){var e;return 2===(e=t.toString(16)).length?e:e+"0"}}),n.Physics.P2.Spring=function(t,e,i,s,n,o,a,r,h,l){this.game=t.game,this.world=t,void 0===s&&(s=1),void 0===n&&(n=100),void 0===o&&(o=1);var c={restLength:s=t.pxm(s),stiffness:n,damping:o};null!=a&&(c.worldAnchorA=[t.pxm(a[0]),t.pxm(a[1])]),null!=r&&(c.worldAnchorB=[t.pxm(r[0]),t.pxm(r[1])]),null!=h&&(c.localAnchorA=[t.pxm(h[0]),t.pxm(h[1])]),null!=l&&(c.localAnchorB=[t.pxm(l[0]),t.pxm(l[1])]),this.data=new p2.LinearSpring(e,i,c),this.data.parent=this},n.Physics.P2.Spring.prototype.constructor=n.Physics.P2.Spring,n.Physics.P2.RotationalSpring=function(t,e,i,s,n,o){this.game=t.game,this.world=t,void 0===s&&(s=null),void 0===n&&(n=100),void 0===o&&(o=1),s&&(s=t.pxm(s));var a={restAngle:s,stiffness:n,damping:o};this.data=new p2.RotationalSpring(e,i,a),this.data.parent=this},n.Physics.P2.Spring.prototype.constructor=n.Physics.P2.Spring,n.Physics.P2.Material=function(t){this.name=t,p2.Material.call(this)},n.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),n.Physics.P2.Material.prototype.constructor=n.Physics.P2.Material,n.Physics.P2.ContactMaterial=function(t,e,i){p2.ContactMaterial.call(this,t,e,i)},n.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),n.Physics.P2.ContactMaterial.prototype.constructor=n.Physics.P2.ContactMaterial,n.Physics.P2.CollisionGroup=function(t){this.mask=t},n.Physics.P2.DistanceConstraint=function(t,e,i,s,n,o,a){void 0===s&&(s=100),void 0===n&&(n=[0,0]),void 0===o&&(o=[0,0]),void 0===a&&(a=Number.MAX_VALUE),this.game=t.game,this.world=t;var r={distance:s=t.pxm(s),localAnchorA:n=[t.pxmi(n[0]),t.pxmi(n[1])],localAnchorB:o=[t.pxmi(o[0]),t.pxmi(o[1])],maxForce:a};p2.DistanceConstraint.call(this,e,i,r)},n.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),n.Physics.P2.DistanceConstraint.prototype.constructor=n.Physics.P2.DistanceConstraint,n.Physics.P2.GearConstraint=function(t,e,i,s,n){void 0===s&&(s=0),void 0===n&&(n=1),this.game=t.game,this.world=t;var o={angle:s,ratio:n};p2.GearConstraint.call(this,e,i,o)},n.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),n.Physics.P2.GearConstraint.prototype.constructor=n.Physics.P2.GearConstraint,n.Physics.P2.LockConstraint=function(t,e,i,s,n,o){void 0===s&&(s=[0,0]),void 0===n&&(n=0),void 0===o&&(o=Number.MAX_VALUE),this.game=t.game,this.world=t;var a={localOffsetB:s=[t.pxm(s[0]),t.pxm(s[1])],localAngleB:n,maxForce:o};p2.LockConstraint.call(this,e,i,a)},n.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),n.Physics.P2.LockConstraint.prototype.constructor=n.Physics.P2.LockConstraint,n.Physics.P2.PrismaticConstraint=function(t,e,i,s,n,o,a,r){void 0===s&&(s=!0),void 0===n&&(n=[0,0]),void 0===o&&(o=[0,0]),void 0===a&&(a=[0,0]),void 0===r&&(r=Number.MAX_VALUE),this.game=t.game,this.world=t;var h={localAnchorA:n=[t.pxmi(n[0]),t.pxmi(n[1])],localAnchorB:o=[t.pxmi(o[0]),t.pxmi(o[1])],localAxisA:a,maxForce:r,disableRotationalLock:!s};p2.PrismaticConstraint.call(this,e,i,h)},n.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),n.Physics.P2.PrismaticConstraint.prototype.constructor=n.Physics.P2.PrismaticConstraint,n.Physics.P2.RevoluteConstraint=function(t,e,i,s,n,o,a){void 0===o&&(o=Number.MAX_VALUE),void 0===a&&(a=null),this.game=t.game,this.world=t,i=[t.pxmi(i[0]),t.pxmi(i[1])],n=[t.pxmi(n[0]),t.pxmi(n[1])],a&&(a=[t.pxmi(a[0]),t.pxmi(a[1])]);var r={worldPivot:a,localPivotA:i,localPivotB:n,maxForce:o};p2.RevoluteConstraint.call(this,e,s,r)},n.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),n.Physics.P2.RevoluteConstraint.prototype.constructor=n.Physics.P2.RevoluteConstraint,n.ImageCollection=function(t,e,i,s,n,o,a){(void 0===i||i<=0)&&(i=32),(void 0===s||s<=0)&&(s=32),void 0===n&&(n=0),void 0===o&&(o=0),this.name=t,this.firstgid=0|e,this.imageWidth=0|i,this.imageHeight=0|s,this.imageMargin=0|n,this.imageSpacing=0|o,this.properties=a||{},this.images=[],this.total=0},n.ImageCollection.prototype={containsImageIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},addImage:function(t,e){this.images.push({gid:t,image:e}),this.total++}},n.ImageCollection.prototype.constructor=n.ImageCollection,n.Tile=function(t,e,i,s,n,o){this.layer=t,this.index=e,this.x=i,this.y=s,this.rotation=0,this.flipped=!1,this.worldX=i*n,this.worldY=s*o,this.width=n,this.height=o,this.centerX=Math.abs(n/2),this.centerY=Math.abs(o/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},n.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,s){return!(i<=this.worldX||s<=this.worldY||t>=this.worldX+this.width||e>=this.worldY+this.height)},setCollisionCallback:function(t,e){this.collisionCallback=t,this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(t,e,i,s){this.collideLeft=t,this.collideRight=e,this.collideUp=i,this.collideDown=s,this.faceLeft=t,this.faceRight=e,this.faceTop=i,this.faceBottom=s},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(t,e){return t&&e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:!!e&&(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)},copy:function(t){this.index=t.index,this.alpha=t.alpha,this.properties=t.properties,this.collideUp=t.collideUp,this.collideDown=t.collideDown,this.collideLeft=t.collideLeft,this.collideRight=t.collideRight,this.collisionCallback=t.collisionCallback,this.collisionCallbackContext=t.collisionCallbackContext}},n.Tile.prototype.constructor=n.Tile,Object.defineProperty(n.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(n.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(n.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(n.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(n.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(n.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),n.Tilemap=function(t,e,i,s,o,a){this.game=t,this.key=e;var r=n.TilemapParser.parse(this.game,e,i,s,o,a);null!==r&&(this.width=r.width,this.height=r.height,this.tileWidth=r.tileWidth,this.tileHeight=r.tileHeight,this.orientation=r.orientation,this.format=r.format,this.version=r.version,this.properties=r.properties,this.widthInPixels=r.widthInPixels,this.heightInPixels=r.heightInPixels,this.layers=r.layers,this.tilesets=r.tilesets,this.imagecollections=r.imagecollections,this.tiles=r.tiles,this.objects=r.objects,this.collideIndexes=[],this.collision=r.collision,this.images=r.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},n.Tilemap.CSV=0,n.Tilemap.TILED_JSON=1,n.Tilemap.NORTH=0,n.Tilemap.EAST=1,n.Tilemap.SOUTH=2,n.Tilemap.WEST=3,n.Tilemap.prototype={create:function(t,e,i,s,n,o){return void 0===o&&(o=this.game.world),this.width=e,this.height=i,this.setTileSize(s,n),this.layers.length=0,this.createBlankLayer(t,e,i,s,n,o)},setTileSize:function(t,e){this.tileWidth=t,this.tileHeight=e,this.widthInPixels=this.width*t,this.heightInPixels=this.height*e},addTilesetImage:function(t,e,i,s,o,a,r){if(void 0===t)return null;void 0===i&&(i=this.tileWidth),void 0===s&&(s=this.tileHeight),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r=0),0===i&&(i=32),0===s&&(s=32);var h=null;if(null!=e||(e=t),e instanceof n.BitmapData)h=e.canvas;else{if(!this.game.cache.checkImageKey(e))return null;h=this.game.cache.getImage(e)}var l=this.getTilesetIndex(t);if(null===l&&this.format===n.Tilemap.TILED_JSON)return null;if(this.tilesets[l])return this.tilesets[l].setImage(h),this.tilesets[l];var c=new n.Tileset(t,r,i,s,o,a,{});c.setImage(h),this.tilesets.push(c);for(var u=this.tilesets.length-1,d=o,p=o,f=0,y=0,g=0,m=r;m<r+c.total&&(this.tiles[m]=[d,p,u],d+=i+a,++f!==c.total)&&(++y!==c.columns||(d=o,p+=s+a,y=0,++g!==c.rows));m++);return c},createFromObjects:function(t,e,i,s,o,a,r,h,l){if(void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===r&&(r=this.game.world),void 0===h&&(h=n.Sprite),void 0===l&&(l=!0),this.objects[t])for(var c=0;c<this.objects[t].length;c++){var u=!1,d=this.objects[t][c];if(void 0!==d.gid&&"number"==typeof e&&d.gid===e?u=!0:void 0!==d.id&&"number"==typeof e&&d.id===e?u=!0:void 0!==d.name&&"string"==typeof e&&d.name===e&&(u=!0),u){var p=new h(this.game,parseFloat(d.x,10),parseFloat(d.y,10),i,s);for(var f in p.name=d.name,p.visible=d.visible,p.autoCull=a,p.exists=o,d.width&&(p.width=d.width),d.height&&(p.height=d.height),d.rotation&&(p.angle=d.rotation),l&&(p.y-=p.height),r.add(p),d.properties)r.set(p,f,d.properties[f],!1,!1,0,!0)}}},createFromTiles:function(t,e,i,s,o,a){"number"==typeof t&&(t=[t]),null==e?e=[]:"number"==typeof e&&(e=[e]),s=this.getLayer(s),void 0===o&&(o=this.game.world),void 0===a&&(a={}),void 0===a.customClass&&(a.customClass=n.Sprite),void 0===a.adjustY&&(a.adjustY=!0);var r=this.layers[s].width,h=this.layers[s].height;if(this.copy(0,0,r,h,s),this._results.length<2)return 0;for(var l,c=0,u=1,d=this._results.length;u<d;u++)if(-1!==t.indexOf(this._results[u].index)){for(var p in l=new a.customClass(this.game,this._results[u].worldX,this._results[u].worldY,i),a)l[p]=a[p];o.add(l),c++}if(1===e.length)for(u=0;u<t.length;u++)this.replace(t[u],e[0],0,0,r,h,s);else if(e.length>1)for(u=0;u<t.length;u++)this.replace(t[u],e[u],0,0,r,h,s);return c},createLayer:function(t,e,i,s){void 0===e&&(e=this.game.width),void 0===i&&(i=this.game.height),void 0===s&&(s=this.game.world);var o=t;if("string"==typeof t&&(o=this.getLayerIndex(t)),!(null===o||o>this.layers.length)){void 0===e||e<=0?e=Math.min(this.game.width,this.layers[o].widthInPixels):e>this.game.width&&(e=this.game.width),void 0===i||i<=0?i=Math.min(this.game.height,this.layers[o].heightInPixels):i>this.game.height&&(i=this.game.height),this.enableDebug;var a=s.add(new n.TilemapLayer(this.game,this,o,e,i));return this.enableDebug,a}},createBlankLayer:function(t,e,i,s,o,a){if(void 0===a&&(a=this.game.world),null===this.getLayerIndex(t)){for(var r,h={name:t,x:0,y:0,width:e,height:i,widthInPixels:e*s,heightInPixels:i*o,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},l=[],c=0;c<i;c++){r=[];for(var u=0;u<e;u++)r.push(new n.Tile(h,-1,u,c,s,o));l.push(r)}h.data=l,this.layers.push(h),this.currentLayer=this.layers.length-1;var d=h.widthInPixels,p=h.heightInPixels;return d>this.game.width&&(d=this.game.width),p>this.game.height&&(p=this.game.height),(l=new n.TilemapLayer(this.game,this,this.layers.length-1,d,p)).name=t,a.add(l)}},getIndex:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name===e)return i;return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},setTileIndexCallback:function(t,e,i,s){if(s=this.getLayer(s),"number"==typeof t)this.layers[s].callbacks[t]={callback:e,callbackContext:i};else for(var n=0,o=t.length;n<o;n++)this.layers[s].callbacks[t[n]]={callback:e,callbackContext:i}},setTileLocationCallback:function(t,e,i,s,n,o,a){if(a=this.getLayer(a),this.copy(t,e,i,s,a),!(this._results.length<2))for(var r=1;r<this._results.length;r++)this._results[r].setCollisionCallback(n,o)},setCollision:function(t,e,i,s){if(void 0===e&&(e=!0),void 0===s&&(s=!0),i=this.getLayer(i),"number"==typeof t)return this.setCollisionByIndex(t,e,i,!0);if(Array.isArray(t)){for(var n=0;n<t.length;n++)this.setCollisionByIndex(t[n],e,i,!1);s&&this.calculateFaces(i)}},setCollisionBetween:function(t,e,i,s,n){if(void 0===i&&(i=!0),void 0===n&&(n=!0),s=this.getLayer(s),!(t>e)){for(var o=t;o<=e;o++)this.setCollisionByIndex(o,i,s,!1);n&&this.calculateFaces(s)}},setCollisionByExclusion:function(t,e,i,s){void 0===e&&(e=!0),void 0===s&&(s=!0),i=this.getLayer(i);for(var n=0,o=this.tiles.length;n<o;n++)-1===t.indexOf(n)&&this.setCollisionByIndex(n,e,i,!1);s&&this.calculateFaces(i)},setCollisionByIndex:function(t,e,i,s){if(void 0===e&&(e=!0),void 0===i&&(i=this.currentLayer),void 0===s&&(s=!0),e)this.collideIndexes.push(t);else{var n=this.collideIndexes.indexOf(t);n>-1&&this.collideIndexes.splice(n,1)}for(var o=0;o<this.layers[i].height;o++)for(var a=0;a<this.layers[i].width;a++){var r=this.layers[i].data[o][a];r&&r.index===t&&(e?r.setCollision(!0,!0,!0,!0):r.resetCollision(),r.faceTop=e,r.faceBottom=e,r.faceLeft=e,r.faceRight=e)}return s&&this.calculateFaces(i),i},getLayer:function(t){return void 0===t?t=this.currentLayer:"string"==typeof t?t=this.getLayerIndex(t):t instanceof n.TilemapLayer&&(t=t.index),t},setPreventRecalculate:function(t){if(!0===t&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate={}),!1===t&&!0===this.preventingRecalculate){for(var e in this.preventingRecalculate=!1,this.needToRecalculate)this.calculateFaces(e);this.needToRecalculate=!1}},calculateFaces:function(t){if(this.preventingRecalculate)this.needToRecalculate[t]=!0;else for(var e=null,i=null,s=null,n=null,o=0,a=this.layers[t].height;o<a;o++)for(var r=0,h=this.layers[t].width;r<h;r++){var l=this.layers[t].data[o][r];l&&(e=this.getTileAbove(t,r,o),i=this.getTileBelow(t,r,o),s=this.getTileLeft(t,r,o),n=this.getTileRight(t,r,o),l.collides&&(l.faceTop=!0,l.faceBottom=!0,l.faceLeft=!0,l.faceRight=!0),e&&e.collides&&(l.faceTop=!1),i&&i.collides&&(l.faceBottom=!1),s&&s.collides&&(l.faceLeft=!1),n&&n.collides&&(l.faceRight=!1))}},getTileAbove:function(t,e,i){return i>0?this.layers[t].data[i-1][e]:null},getTileBelow:function(t,e,i){return i<this.layers[t].height-1?this.layers[t].data[i+1][e]:null},getTileLeft:function(t,e,i){return e>0?this.layers[t].data[i][e-1]:null},getTileRight:function(t,e,i){return e<this.layers[t].width-1?this.layers[t].data[i][e+1]:null},setLayer:function(t){t=this.getLayer(t),this.layers[t]&&(this.currentLayer=t)},hasTile:function(t,e,i){return i=this.getLayer(i),void 0!==this.layers[i].data[e]&&void 0!==this.layers[i].data[e][t]&&this.layers[i].data[e][t].index>-1},removeTile:function(t,e,i){if(i=this.getLayer(i),t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height&&this.hasTile(t,e,i)){var s=this.layers[i].data[e][t];return this.layers[i].data[e][t]=new n.Tile(this.layers[i],-1,t,e,this.tileWidth,this.tileHeight),this.layers[i].dirty=!0,this.calculateFaces(i),s}},removeTileWorldXY:function(t,e,i,s,n){return n=this.getLayer(n),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,s)/s,this.removeTile(t,e,n)},putTile:function(t,e,i,s){return null===t?this.removeTile(e,i,s):(s=this.getLayer(s),e>=0&&e<this.layers[s].width&&i>=0&&i<this.layers[s].height?(t instanceof n.Tile?(o=t.index,this.hasTile(e,i,s)?this.layers[s].data[i][e].copy(t):this.layers[s].data[i][e]=new n.Tile(s,o,e,i,t.width,t.height)):(o=t,this.hasTile(e,i,s)?this.layers[s].data[i][e].index=o:this.layers[s].data[i][e]=new n.Tile(this.layers[s],o,e,i,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(o)>-1?this.layers[s].data[i][e].setCollision(!0,!0,!0,!0):this.layers[s].data[i][e].resetCollision(),this.layers[s].dirty=!0,this.calculateFaces(s),this.layers[s].data[i][e]):null);var o},putTileWorldXY:function(t,e,i,s,n,o){return o=this.getLayer(o),e=this.game.math.snapToFloor(e,s)/s,i=this.game.math.snapToFloor(i,n)/n,this.putTile(t,e,i,o)},searchTileIndex:function(t,e,i,s){void 0===e&&(e=0),void 0===i&&(i=!1),s=this.getLayer(s);var n=0;if(i){for(var o=this.layers[s].height-1;o>=0;o--)for(var a=this.layers[s].width-1;a>=0;a--)if(this.layers[s].data[o][a].index===t){if(n===e)return this.layers[s].data[o][a];n++}}else for(o=0;o<this.layers[s].height;o++)for(a=0;a<this.layers[s].width;a++)if(this.layers[s].data[o][a].index===t){if(n===e)return this.layers[s].data[o][a];n++}return null},getTile:function(t,e,i,s){return void 0===s&&(s=!1),i=this.getLayer(i),t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height?-1===this.layers[i].data[e][t].index?s?this.layers[i].data[e][t]:null:this.layers[i].data[e][t]:null},getTileWorldXY:function(t,e,i,s,n,o){return void 0===i&&(i=this.tileWidth),void 0===s&&(s=this.tileHeight),n=this.getLayer(n),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,s)/s,this.getTile(t,e,n,o)},copy:function(t,e,i,s,n){if(n=this.getLayer(n),this.layers[n]){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.layers[n].width),void 0===s&&(s=this.layers[n].height),t<0&&(t=0),e<0&&(e=0),i>this.layers[n].width&&(i=this.layers[n].width),s>this.layers[n].height&&(s=this.layers[n].height),this._results.length=0,this._results.push({x:t,y:e,width:i,height:s,layer:n});for(var o=e;o<e+s;o++)for(var a=t;a<t+i;a++)this._results.push(this.layers[n].data[o][a]);return this._results}this._results.length=0},paste:function(t,e,i,s){if(void 0===t&&(t=0),void 0===e&&(e=0),s=this.getLayer(s),i&&!(i.length<2)){for(var n=t-i[1].x,o=e-i[1].y,a=1;a<i.length;a++)this.layers[s].data[o+i[a].y][n+i[a].x].copy(i[a]);this.layers[s].dirty=!0,this.calculateFaces(s)}},swap:function(t,e,i,s,n,o,a){a=this.getLayer(a),this.copy(i,s,n,o,a),this._results.length<2||(this._tempA=t,this._tempB=e,this._results.forEach(this.swapHandler,this),this.paste(i,s,this._results,a))},swapHandler:function(t){t.index===this._tempA?t.index=this._tempB:t.index===this._tempB&&(t.index=this._tempA)},forEach:function(t,e,i,s,n,o,a){a=this.getLayer(a),this.copy(i,s,n,o,a),this._results.length<2||(this._results.forEach(t,e),this.paste(i,s,this._results,a))},replace:function(t,e,i,s,n,o,a){if(a=this.getLayer(a),this.copy(i,s,n,o,a),!(this._results.length<2)){for(var r=1;r<this._results.length;r++)this._results[r].index===t&&(this._results[r].index=e);this.paste(i,s,this._results,a)}},random:function(t,e,i,s,n){if(n=this.getLayer(n),this.copy(t,e,i,s,n),!(this._results.length<2)){for(var o=[],a=1;a<this._results.length;a++)if(this._results[a].index){var r=this._results[a].index;-1===o.indexOf(r)&&o.push(r)}for(var h=1;h<this._results.length;h++)this._results[h].index=this.game.rnd.pick(o);this.paste(t,e,this._results,n)}},shuffle:function(t,e,i,s,o){if(o=this.getLayer(o),this.copy(t,e,i,s,o),!(this._results.length<2)){for(var a=[],r=1;r<this._results.length;r++)this._results[r].index&&a.push(this._results[r].index);n.ArrayUtils.shuffle(a);for(var h=1;h<this._results.length;h++)this._results[h].index=a[h-1];this.paste(t,e,this._results,o)}},fill:function(t,e,i,s,n,o){if(o=this.getLayer(o),this.copy(e,i,s,n,o),!(this._results.length<2)){for(var a=1;a<this._results.length;a++)this._results[a].index=t;this.paste(e,i,this._results,o)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var t="",e=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(var s=0;s<this.layers[this.currentLayer].width;s++)t+="%c  ",this.layers[this.currentLayer].data[i][s]>1?this.debugMap[this.layers[this.currentLayer].data[i][s]]?e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][s]]):e.push("background: #ffffff"):e.push("background: rgb(0, 0, 0)");t+="\n"}e[0]=t},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},n.Tilemap.prototype.constructor=n.Tilemap,Object.defineProperty(n.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){t!==this.currentLayer&&this.setLayer(t)}}),n.TilemapLayer=function(t,e,i,s,o){s|=0,o|=0,n.Sprite.call(this,t,0,0),this.map=e,this.index=i,this.layer=e.layers[i],this.canvas=PIXI.CanvasPool.create(this,s,o),this.context=this.canvas.getContext("2d"),this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas))),this.type=n.TILEMAPLAYER,this.physicsType=n.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!1,overdrawRatio:.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:e.tileWidth,tileHeight:e.tileHeight,cw:e.tileWidth,ch:e.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this._results=[],t.device.canvasBitBltShift||(this.renderSettings.copyCanvas=n.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},n.TilemapLayer.prototype=Object.create(n.Sprite.prototype),n.TilemapLayer.prototype.constructor=n.TilemapLayer,n.TilemapLayer.prototype.preUpdateCore=n.Component.Core.preUpdate,n.TilemapLayer.sharedCopyCanvas=null,n.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=PIXI.CanvasPool.create(this,2,2)),this.sharedCopyCanvas},n.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},n.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y},n.TilemapLayer.prototype._renderCanvas=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderCanvas.call(this,t)},n.TilemapLayer.prototype._renderWebGL=function(t){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x,this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderWebGL.call(this,t)},n.TilemapLayer.prototype.destroy=function(){PIXI.CanvasPool.remove(this),n.Component.Destroy.prototype.destroy.call(this)},n.TilemapLayer.prototype.resize=function(t,e){this.canvas.width=t,this.canvas.height=e,this.texture.frame.resize(t,e),this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.texture.baseTexture.width=t,this.texture.baseTexture.height=e,this.texture.baseTexture.dirty(),this.texture.requiresUpdate=!0,this.texture._updateUvs(),this.dirty=!0},n.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},n.TilemapLayer.prototype._fixX=function(t){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?t:0===this.scrollFactorX&&0!==this.position.x?t-this.position.x:this._scrollX+(t-this._scrollX/this.scrollFactorX)},n.TilemapLayer.prototype._unfixX=function(t){return 1===this.scrollFactorX?t:this._scrollX/this.scrollFactorX+(t-this._scrollX)},n.TilemapLayer.prototype._fixY=function(t){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?t:0===this.scrollFactorY&&0!==this.position.y?t-this.position.y:this._scrollY+(t-this._scrollY/this.scrollFactorY)},n.TilemapLayer.prototype._unfixY=function(t){return 1===this.scrollFactorY?t:this._scrollY/this.scrollFactorY+(t-this._scrollY)},n.TilemapLayer.prototype.getTileX=function(t){return Math.floor(this._fixX(t)/this._mc.tileWidth)},n.TilemapLayer.prototype.getTileY=function(t){return Math.floor(this._fixY(t)/this._mc.tileHeight)},n.TilemapLayer.prototype.getTileXY=function(t,e,i){return i.x=this.getTileX(t),i.y=this.getTileY(e),i},n.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,s){e||(e=this.rayStepRate),void 0===i&&(i=!1),void 0===s&&(s=!1);var n=this.getTiles(t.x,t.y,t.width,t.height,i,s);if(0===n.length)return[];for(var o=t.coordinatesOnLine(e),a=[],r=0;r<n.length;r++)for(var h=0;h<o.length;h++){var l=n[r],c=o[h];if(l.containsPoint(c[0],c[1])){a.push(l);break}}return a},n.TilemapLayer.prototype.getTiles=function(t,e,i,s,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var a=!(n||o);t=this._fixX(t),e=this._fixY(e);for(var r=Math.floor(t/(this._mc.cw*this.scale.x)),h=Math.floor(e/(this._mc.ch*this.scale.y)),l=Math.ceil((t+i)/(this._mc.cw*this.scale.x))-r,c=Math.ceil((e+s)/(this._mc.ch*this.scale.y))-h;this._results.length;)this._results.pop();for(var u=h;u<h+c;u++)for(var d=r;d<r+l;d++){var p=this.layer.data[u];p&&p[d]&&(a||p[d].isInteresting(n,o))&&this._results.push(p[d])}return this._results.slice()},n.TilemapLayer.prototype.resolveTileset=function(t){var e=this._mc.tilesets;if(t<2e3)for(;e.length<t;)e.push(void 0);var i=this.map.tiles[t]&&this.map.tiles[t][2];if(null!==i){var s=this.map.tilesets[i];if(s&&s.containsTileIndex(t))return e[t]=s}return e[t]=null},n.TilemapLayer.prototype.resetTilesetCache=function(){for(var t=this._mc.tilesets;t.length;)t.pop()},n.TilemapLayer.prototype.setScale=function(t,e){t=t||1,e=e||t;for(var i=0;i<this.layer.data.length;i++)for(var s=this.layer.data[i],n=0;n<s.length;n++){var o=s[n];o.width=this.map.tileWidth*t,o.height=this.map.tileHeight*e,o.worldX=o.x*o.width,o.worldY=o.y*o.height}this.scale.setTo(t,e)},n.TilemapLayer.prototype.shiftCanvas=function(t,e,i){var s=t.canvas,n=s.width-Math.abs(e),o=s.height-Math.abs(i),a=0,r=0,h=e,l=i;e<0&&(a=-e,h=0),i<0&&(r=-i,l=0);var c=this.renderSettings.copyCanvas;if(c){(c.width<n||c.height<o)&&(c.width=n,c.height=o);var u=c.getContext("2d");u.clearRect(0,0,n,o),u.drawImage(s,a,r,n,o,0,0,n,o),t.clearRect(h,l,n,o),t.drawImage(c,0,0,n,o,h,l,n,o)}else t.save(),t.globalCompositeOperation="copy",t.drawImage(s,a,r,n,o,h,l,n,o),t.restore()},n.TilemapLayer.prototype.renderRegion=function(t,e,i,s,n,o){var a=this.context,r=this.layer.width,h=this.layer.height,l=this._mc.tileWidth,c=this._mc.tileHeight,u=this._mc.tilesets,d=NaN;this._wrap||(i<=n&&(i=Math.max(0,i),n=Math.min(r-1,n)),s<=o&&(s=Math.max(0,s),o=Math.min(h-1,o)));var p,f,y,g,m,v,b=i*l-t,x=(i+(1<<20)*r)%r;for(g=(s+(1<<20)*h)%h,v=o-s,f=s*c-e;v>=0;g++,v--,f+=c){g>=h&&(g-=h);var _=this.layer.data[g];for(y=x,m=n-i,p=b;m>=0;y++,m--,p+=l){y>=r&&(y-=r);var w=_[y];if(w&&!(w.index<0)){var P=w.index,C=u[P];void 0===C&&(C=this.resolveTileset(P)),w.alpha===d||this.debug||(a.globalAlpha=w.alpha,d=w.alpha),C?w.rotation||w.flipped?(a.save(),a.translate(p+w.centerX,f+w.centerY),a.rotate(w.rotation),w.flipped&&a.scale(-1,1),C.draw(a,-w.centerX,-w.centerY,P),a.restore()):C.draw(a,p,f,P):this.debugSettings.missingImageFill&&(a.fillStyle=this.debugSettings.missingImageFill,a.fillRect(p,f,l,c)),w.debug&&this.debugSettings.debuggedTileOverfill&&(a.fillStyle=this.debugSettings.debuggedTileOverfill,a.fillRect(p,f,l,c))}}}},n.TilemapLayer.prototype.renderDeltaScroll=function(t,e){var i=this._mc.scrollX,s=this._mc.scrollY,n=this.canvas.width,o=this.canvas.height,a=this._mc.tileWidth,r=this._mc.tileHeight,h=0,l=-a,c=0,u=-r;if(t<0?(h=n+t,l=n-1):t>0&&(l=t),e<0?(c=o+e,u=o-1):e>0&&(u=e),this.shiftCanvas(this.context,t,e),h=Math.floor((h+i)/a),l=Math.floor((l+i)/a),c=Math.floor((c+s)/r),u=Math.floor((u+s)/r),h<=l){this.context.clearRect(h*a-i,0,(l-h+1)*a,o);var d=Math.floor((0+s)/r),p=Math.floor((o-1+s)/r);this.renderRegion(i,s,h,d,l,p)}if(c<=u){this.context.clearRect(0,c*r-s,n,(u-c+1)*r);var f=Math.floor((0+i)/a),y=Math.floor((n-1+i)/a);this.renderRegion(i,s,f,c,y,u)}},n.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX,e=this._mc.scrollY,i=this.canvas.width,s=this.canvas.height,n=this._mc.tileWidth,o=this._mc.tileHeight,a=Math.floor(t/n),r=Math.floor((i-1+t)/n),h=Math.floor(e/o),l=Math.floor((s-1+e)/o);this.context.clearRect(0,0,i,s),this.renderRegion(t,e,a,h,r,l)},n.TilemapLayer.prototype.render=function(){var t=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,t=!0);var e=this.canvas.width,i=this.canvas.height,s=0|this._scrollX,n=0|this._scrollY,o=this._mc,a=o.scrollX-s,r=o.scrollY-n;if(t||0!==a||0!==r||o.renderWidth!==e||o.renderHeight!==i)return this.context.save(),o.scrollX=s,o.scrollY=n,o.renderWidth===e&&o.renderHeight===i||(o.renderWidth=e,o.renderHeight=i),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(t=!0)),!t&&this.renderSettings.enableScrollDelta&&Math.abs(a)+Math.abs(r)<Math.min(e,i)?this.renderDeltaScroll(a,r):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}},n.TilemapLayer.prototype.renderDebug=function(){var t,e,i,s,n,o,a=this._mc.scrollX,r=this._mc.scrollY,h=this.context,l=this.canvas.width,c=this.canvas.height,u=this.layer.width,d=this.layer.height,p=this._mc.tileWidth,f=this._mc.tileHeight,y=Math.floor(a/p),g=Math.floor((l-1+a)/p),m=Math.floor(r/f),v=Math.floor((c-1+r)/f),b=y*p-a,x=m*f-r,_=(y+(1<<20)*u)%u,w=(m+(1<<20)*d)%d;for(h.strokeStyle=this.debugSettings.facingEdgeStroke,s=w,o=v-m,e=x;o>=0;s++,o--,e+=f){s>=d&&(s-=d);var P=this.layer.data[s];for(i=_,n=g-y,t=b;n>=0;i++,n--,t+=p){i>=u&&(i-=u);var C=P[i];!C||C.index<0||!C.collides||(this.debugSettings.collidingTileOverfill&&(h.fillStyle=this.debugSettings.collidingTileOverfill,h.fillRect(t,e,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(h.beginPath(),C.faceTop&&(h.moveTo(t,e),h.lineTo(t+this._mc.cw,e)),C.faceBottom&&(h.moveTo(t,e+this._mc.ch),h.lineTo(t+this._mc.cw,e+this._mc.ch)),C.faceLeft&&(h.moveTo(t,e),h.lineTo(t,e+this._mc.ch)),C.faceRight&&(h.moveTo(t+this._mc.cw,e),h.lineTo(t+this._mc.cw,e+this._mc.ch)),h.closePath(),h.stroke()))}}},Object.defineProperty(n.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(t){this._wrap=t,this.dirty=!0}}),Object.defineProperty(n.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(t){this._scrollX=t}}),Object.defineProperty(n.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(t){this._scrollY=t}}),Object.defineProperty(n.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=0|t,this.dirty=!0}}),Object.defineProperty(n.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=0|t,this.dirty=!0}}),n.TilemapParser={INSERT_NULL:!1,parse:function(t,e,i,s,o,a){if(void 0===i&&(i=32),void 0===s&&(s=32),void 0===o&&(o=10),void 0===a&&(a=10),void 0===e)return this.getEmptyData();if(null===e)return this.getEmptyData(i,s,o,a);var r=t.cache.getTilemapData(e);if(r){if(r.format===n.Tilemap.CSV)return this.parseCSV(e,r.data,i,s);if(!r.format||r.format===n.Tilemap.TILED_JSON)return this.parseTiledJSON(r.data)}},parseCSV:function(t,e,i,s){for(var o=this.getEmptyData(),a=[],r=(e=e.trim()).split("\n"),h=r.length,l=0,c=0;c<r.length;c++){a[c]=[];for(var u=r[c].split(","),d=0;d<u.length;d++)a[c][d]=new n.Tile(o.layers[0],parseInt(u[d],10),d,c,i,s);0===l&&(l=u.length)}return o.format=n.Tilemap.CSV,o.name=t,o.width=l,o.height=h,o.tileWidth=i,o.tileHeight=s,o.widthInPixels=l*i,o.heightInPixels=h*s,o.layers[0].width=l,o.layers[0].height=h,o.layers[0].widthInPixels=o.widthInPixels,o.layers[0].heightInPixels=o.heightInPixels,o.layers[0].data=a,o},getEmptyData:function(t,e,i,s){return{width:null!=i?i:0,height:null!=s?s:0,tileWidth:null!=t?t:0,tileHeight:null!=e?e:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(t){function e(t,e){var i={};for(var s in e){var n=e[s];void 0!==t[n]&&(i[n]=t[n])}return i}if("orthogonal"!==t.orientation)return null;for(var i={width:t.width,height:t.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,orientation:t.orientation,format:n.Tilemap.TILED_JSON,version:t.version,properties:t.properties,widthInPixels:t.width*t.tilewidth,heightInPixels:t.height*t.tileheight},s=[],o=0;o<t.layers.length;o++)if("tilelayer"===t.layers[o].type){var a=t.layers[o];if(!a.compression&&a.encoding&&"base64"===a.encoding){for(var r=window.atob(a.data),h=r.length,l=new Array(h),c=0;c<h;c+=4)l[c/4]=(r.charCodeAt(c)|r.charCodeAt(c+1)<<8|r.charCodeAt(c+2)<<16|r.charCodeAt(c+3)<<24)>>>0;a.data=l,delete a.encoding}else if(a.compression)continue;var u={name:a.name,x:a.x,y:a.y,width:a.width,height:a.height,widthInPixels:a.width*t.tilewidth,heightInPixels:a.height*t.tileheight,alpha:a.opacity,visible:a.visible,properties:{},indexes:[],callbacks:[],bodies:[]};a.properties&&(u.properties=a.properties);var d,p,f,y=0,g=[],m=[],v=0;for(h=a.data.length;v<h;v++){if(d=0,p=!1,f=0,(E=a.data[v])>536870912)switch(E>2147483648&&(E-=2147483648,f+=4),E>1073741824&&(E-=1073741824,f+=2),E>536870912&&(E-=536870912,f+=1),f){case 5:d=Math.PI/2;break;case 6:d=Math.PI;break;case 3:d=3*Math.PI/2;break;case 4:d=0,p=!0;break;case 7:d=Math.PI/2,p=!0;break;case 2:d=Math.PI,p=!0;break;case 1:d=3*Math.PI/2,p=!0}if(E>0)(U=new n.Tile(u,E,y,m.length,t.tilewidth,t.tileheight)).rotation=d,U.flipped=p,0!==f&&(U.flippedVal=f),g.push(U);else n.TilemapParser.INSERT_NULL?g.push(null):g.push(new n.Tile(u,-1,y,m.length,t.tilewidth,t.tileheight));++y===a.width&&(m.push(g),y=0,g=[])}u.data=m,s.push(u)}i.layers=s;var b=[];for(o=0;o<t.layers.length;o++)if("imagelayer"===t.layers[o].type){var x=t.layers[o],_={name:x.name,image:x.image,x:x.x,y:x.y,alpha:x.opacity,visible:x.visible,properties:{}};x.properties&&(_.properties=x.properties),b.push(_)}i.images=b;var w=[],P=[],C=null;for(o=0;o<t.tilesets.length;o++){if((j=t.tilesets[o]).image){var T=new n.Tileset(j.name,j.firstgid,j.tilewidth,j.tileheight,j.margin,j.spacing,j.properties);j.tileproperties&&(T.tileProperties=j.tileproperties),T.updateTileData(j.imagewidth,j.imageheight),w.push(T)}else{var S=new n.ImageCollection(j.name,j.firstgid,j.tilewidth,j.tileheight,j.margin,j.spacing,j.properties);for(var A in j.tiles){_=j.tiles[A].image;var E=j.firstgid+parseInt(A,10);S.addImage(E,_)}P.push(S)}C&&(C.lastgid=j.firstgid-1),C=j}i.tilesets=w,i.imagecollections=P;var I={},M={};for(o=0;o<t.layers.length;o++)if("objectgroup"===t.layers[o].type){var O=t.layers[o];I[O.name]=[],M[O.name]=[];var R=0;for(h=O.objects.length;R<h;R++)if(O.objects[R].gid){var B={gid:O.objects[R].gid,name:O.objects[R].name,type:O.objects[R].hasOwnProperty("type")?O.objects[R].type:"",x:O.objects[R].x,y:O.objects[R].y,visible:O.objects[R].visible,properties:O.objects[R].properties};O.objects[R].rotation&&(B.rotation=O.objects[R].rotation),I[O.name].push(B)}else if(O.objects[R].polyline){B={name:O.objects[R].name,type:O.objects[R].type,x:O.objects[R].x,y:O.objects[R].y,width:O.objects[R].width,height:O.objects[R].height,visible:O.objects[R].visible,properties:O.objects[R].properties};O.objects[R].rotation&&(B.rotation=O.objects[R].rotation),B.polyline=[];for(var L=0;L<O.objects[R].polyline.length;L++)B.polyline.push([O.objects[R].polyline[L].x,O.objects[R].polyline[L].y]);M[O.name].push(B),I[O.name].push(B)}else if(O.objects[R].polygon){(B=e(O.objects[R],["name","type","x","y","visible","rotation","properties"])).polygon=[];for(L=0;L<O.objects[R].polygon.length;L++)B.polygon.push([O.objects[R].polygon[L].x,O.objects[R].polygon[L].y]);I[O.name].push(B)}else if(O.objects[R].ellipse){B=e(O.objects[R],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);I[O.name].push(B)}else{(B=e(O.objects[R],["name","type","x","y","width","height","visible","rotation","properties"])).rectangle=!0,I[O.name].push(B)}}i.objects=I,i.collision=M,i.tiles=[];for(o=0;o<i.tilesets.length;o++){y=(j=i.tilesets[o]).tileMargin;var D=j.tileMargin,k=0,F=0,G=0;for(v=j.firstgid;v<j.firstgid+j.total&&(i.tiles[v]=[y,D,o],y+=j.tileWidth+j.tileSpacing,++k!==j.total)&&(++F!==j.columns||(y=j.tileMargin,D+=j.tileHeight+j.tileSpacing,F=0,++G!==j.rows));v++);}var U,N,j;for(o=0;o<i.layers.length;o++){u=i.layers[o],j=null;for(c=0;c<u.data.length;c++){g=u.data[c];for(var W=0;W<g.length;W++)null===(U=g[W])||U.index<0||(N=i.tiles[U.index][2],(j=i.tilesets[N]).tileProperties&&j.tileProperties[U.index-j.firstgid]&&(U.properties=n.Utils.mixin(j.tileProperties[U.index-j.firstgid],U.properties)))}}return i}},n.Tileset=function(t,e,i,s,n,o,a){(void 0===i||i<=0)&&(i=32),(void 0===s||s<=0)&&(s=32),void 0===n&&(n=0),void 0===o&&(o=0),this.name=t,this.firstgid=0|e,this.tileWidth=0|i,this.tileHeight=0|s,this.tileMargin=0|n,this.tileSpacing=0|o,this.properties=a||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},n.Tileset.prototype={draw:function(t,e,i,s){var n=s-this.firstgid<<1;n>=0&&n+1<this.drawCoords.length&&t.drawImage(this.image,this.drawCoords[n],this.drawCoords[n+1],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},setImage:function(t){this.image=t,this.updateTileData(t.width,t.height)},setSpacing:function(t,e){this.tileMargin=0|t,this.tileSpacing=0|e,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(t,e){var i=(e-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),s=(t-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);i=Math.floor(i),s=Math.floor(s),this.rows&&this.rows!==i||this.columns&&this.columns,this.rows=i,this.columns=s,this.total=i*s,this.drawCoords.length=0;for(var n=this.tileMargin,o=this.tileMargin,a=0;a<this.rows;a++){for(var r=0;r<this.columns;r++)this.drawCoords.push(n),this.drawCoords.push(o),n+=this.tileWidth+this.tileSpacing;n=this.tileMargin,o+=this.tileHeight+this.tileSpacing}}},n.Tileset.prototype.constructor=n.Tileset,n.Particle=function(t,e,i,s,o){n.Sprite.call(this,t,e,i,s,o),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},n.Particle.prototype=Object.create(n.Sprite.prototype),n.Particle.prototype.constructor=n.Particle,n.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},n.Particle.prototype.onEmit=function(){},n.Particle.prototype.setAlphaData=function(t){this.alphaData=t,this._a=t.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},n.Particle.prototype.setScaleData=function(t){this.scaleData=t,this._s=t.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},n.Particle.prototype.reset=function(t,e,i){return n.Component.Reset.prototype.reset.call(this,t,e,i),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},n.Particles=function(t){this.game=t,this.emitters={},this.ID=0},n.Particles.prototype={add:function(t){return this.emitters[t.name]=t,t},remove:function(t){delete this.emitters[t.name]},update:function(){for(var t in this.emitters)this.emitters[t].exists&&this.emitters[t].update()}},n.Particles.prototype.constructor=n.Particles,n.Particles.Arcade={},n.Particles.Arcade.Emitter=function(t,e,i,s){this.maxParticles=s||50,n.Group.call(this,t),this.name="emitter"+this.game.particles.ID++,this.type=n.EMITTER,this.physicsType=n.GROUP,this.area=new n.Rectangle(e,i,1,1),this.minParticleSpeed=new n.Point(-100,-100),this.maxParticleSpeed=new n.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=n.Particle,this.particleDrag=new n.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new n.Point,this.on=!1,this.particleAnchor=new n.Point(.5,.5),this.blendMode=n.blendModes.NORMAL,this.emitX=e,this.emitY=i,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new n.Point(1,1),this._maxParticleScale=new n.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},n.Particles.Arcade.Emitter.prototype=Object.create(n.Group.prototype),n.Particles.Arcade.Emitter.prototype.constructor=n.Particles.Arcade.Emitter,n.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0!==this._flowTotal)if(this._flowQuantity>0){for(var t=0;t<this._flowQuantity;t++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));else this.emitParticle()&&(this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1));for(t=this.children.length;t--;)this.children[t].exists&&this.children[t].update()},n.Particles.Arcade.Emitter.prototype.makeParticles=function(t,e,i,s,n){void 0===e&&(e=0),void 0===i&&(i=this.maxParticles),void 0===s&&(s=!1),void 0===n&&(n=!1);var o,a=0,r=t,h=e;for(this._frames=e,i>this.maxParticles&&(this.maxParticles=i);a<i;)Array.isArray(t)&&(r=this.game.rnd.pick(t)),Array.isArray(e)&&(h=this.game.rnd.pick(e)),o=new this.particleClass(this.game,0,0,r,h),this.game.physics.arcade.enable(o,!1),s?(o.body.checkCollision.any=!0,o.body.checkCollision.none=!1):o.body.checkCollision.none=!0,o.body.collideWorldBounds=n,o.body.skipQuadTree=!0,o.exists=!1,o.visible=!1,o.anchor.copyFrom(this.particleAnchor),this.add(o),a++;return this},n.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},n.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},n.Particles.Arcade.Emitter.prototype.explode=function(t,e){return this._flowTotal=0,this.start(!0,t,0,e,!1),this},n.Particles.Arcade.Emitter.prototype.flow=function(t,e,i,s,n){return void 0!==i&&0!==i||(i=1),void 0===s&&(s=-1),void 0===n&&(n=!0),i>this.maxParticles&&(i=this.maxParticles),this._counter=0,this._flowQuantity=i,this._flowTotal=s,n?(this.start(!0,t,e,i),this._counter+=i,this.on=!0,this._timer=this.game.time.time+e*this.game.time.slowMotion):this.start(!1,t,e,i),this},n.Particles.Arcade.Emitter.prototype.start=function(t,e,i,s,n){if(void 0===t&&(t=!0),void 0===e&&(e=0),null!=i||(i=250),void 0===s&&(s=0),void 0===n&&(n=!1),s>this.maxParticles&&(s=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=e,this.frequency=i,t||n)for(var o=0;o<s;o++)this.emitParticle();else this.on=!0,this._quantity=s,this._counter=0,this._timer=this.game.time.time+i*this.game.time.slowMotion;return this},n.Particles.Arcade.Emitter.prototype.emitParticle=function(t,e,i,s){void 0===t&&(t=null),void 0===e&&(e=null);var n=this.getFirstExists(!1);if(null===n)return!1;var o=this.game.rnd;void 0!==i&&void 0!==s?n.loadTexture(i,s):void 0!==i&&n.loadTexture(i);var a=this.emitX,r=this.emitY;null!==t?a=t:this.width>1&&(a=o.between(this.left,this.right)),null!==e?r=e:this.height>1&&(r=o.between(this.top,this.bottom)),n.reset(a,r),n.angle=0,n.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(n):this.particleSendToBack&&this.sendToBack(n),this.autoScale?n.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?n.scale.set(o.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x===this._maxParticleScale.x&&this._minParticleScale.y===this._maxParticleScale.y||n.scale.set(o.realInRange(this._minParticleScale.x,this._maxParticleScale.x),o.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),void 0===s&&(Array.isArray(this._frames)?n.frame=this.game.rnd.pick(this._frames):n.frame=this._frames),this.autoAlpha?n.setAlphaData(this.alphaData):n.alpha=o.realInRange(this.minParticleAlpha,this.maxParticleAlpha),n.blendMode=this.blendMode;var h=n.body;return h.updateBounds(),h.bounce.copyFrom(this.bounce),h.drag.copyFrom(this.particleDrag),h.velocity.x=o.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),h.velocity.y=o.between(this.minParticleSpeed.y,this.maxParticleSpeed.y),h.angularVelocity=o.between(this.minRotation,this.maxRotation),h.gravity.y=this.gravity,h.angularDrag=this.angularDrag,n.onEmit(),!0},n.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),n.Group.prototype.destroy.call(this,!0,!1)},n.Particles.Arcade.Emitter.prototype.setSize=function(t,e){return this.area.width=t,this.area.height=e,this},n.Particles.Arcade.Emitter.prototype.setXSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.x=t,this.maxParticleSpeed.x=e,this},n.Particles.Arcade.Emitter.prototype.setYSpeed=function(t,e){return t=t||0,e=e||0,this.minParticleSpeed.y=t,this.maxParticleSpeed.y=e,this},n.Particles.Arcade.Emitter.prototype.setRotation=function(t,e){return t=t||0,e=e||0,this.minRotation=t,this.maxRotation=e,this},n.Particles.Arcade.Emitter.prototype.setAlpha=function(t,e,i,s,o){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=0),void 0===s&&(s=n.Easing.Linear.None),void 0===o&&(o=!1),this.minParticleAlpha=t,this.maxParticleAlpha=e,this.autoAlpha=!1,i>0&&t!==e){var a={v:t},r=this.game.make.tween(a).to({v:e},i,s);r.yoyo(o),this.alphaData=r.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}return this},n.Particles.Arcade.Emitter.prototype.setScale=function(t,e,i,s,o,a,r){if(void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===s&&(s=1),void 0===o&&(o=0),void 0===a&&(a=n.Easing.Linear.None),void 0===r&&(r=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,i),this._maxParticleScale.set(e,s),this.autoScale=!1,o>0&&(t!==e||i!==s)){var h={x:t,y:i},l=this.game.make.tween(h).to({x:e,y:s},o,a);l.yoyo(r),this.scaleData=l.generateData(60),this.scaleData.reverse(),this.autoScale=!0}return this},n.Particles.Arcade.Emitter.prototype.at=function(t){return t.center?(this.emitX=t.center.x,this.emitY=t.center.y):(this.emitX=t.world.x+t.anchor.x*t.width,this.emitY=t.world.y+t.anchor.y*t.height),this},Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(t){this.area.width=t}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(t){this.area.height=t}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(t){this.emitX=t}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(t){this.emitY=t}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),n.Weapon=function(t,e){n.Plugin.call(this,t,e),this.bullets=null,this.autoExpandBulletsGroup=!1,this.autofire=!1,this.shots=0,this.fireLimit=0,this.fireRate=100,this.fireRateVariance=0,this.fireFrom=new n.Rectangle(0,0,1,1),this.fireAngle=n.ANGLE_UP,this.bulletInheritSpriteSpeed=!1,this.bulletAnimation="",this.bulletFrameRandom=!1,this.bulletFrameCycle=!1,this.bulletWorldWrap=!1,this.bulletWorldWrapPadding=0,this.bulletAngleOffset=0,this.bulletAngleVariance=0,this.bulletSpeed=200,this.bulletSpeedVariance=0,this.bulletLifespan=0,this.bulletKillDistance=0,this.bulletGravity=new n.Point(0,0),this.bulletRotateToVelocity=!1,this.bulletKey="",this.bulletFrame="",this._bulletClass=n.Bullet,this._bulletCollideWorldBounds=!1,this._bulletKillType=n.Weapon.KILL_WORLD_BOUNDS,this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0},this.bounds=new n.Rectangle,this.bulletBounds=t.world.bounds,this.bulletFrames=[],this.bulletFrameIndex=0,this.anims={},this.onFire=new n.Signal,this.onKill=new n.Signal,this.onFireLimit=new n.Signal,this.trackedSprite=null,this.trackedPointer=null,this.trackRotation=!1,this.trackOffset=new n.Point,this._nextFire=0,this._rotatedPoint=new n.Point},n.Weapon.prototype=Object.create(n.Plugin.prototype),n.Weapon.prototype.constructor=n.Weapon,n.Weapon.KILL_NEVER=0,n.Weapon.KILL_LIFESPAN=1,n.Weapon.KILL_DISTANCE=2,n.Weapon.KILL_WEAPON_BOUNDS=3,n.Weapon.KILL_CAMERA_BOUNDS=4,n.Weapon.KILL_WORLD_BOUNDS=5,n.Weapon.KILL_STATIC_BOUNDS=6,n.Weapon.prototype.createBullets=function(t,e,i,s){return void 0===t&&(t=1),void 0===s&&(s=this.game.world),this.bullets||(this.bullets=this.game.add.physicsGroup(n.Physics.ARCADE,s),this.bullets.classType=this._bulletClass),0!==t&&(-1===t&&(this.autoExpandBulletsGroup=!0,t=1),this.bullets.createMultiple(t,e,i),this.bullets.setAll("data.bulletManager",this),this.bulletKey=e,this.bulletFrame=i),this},n.Weapon.prototype.forEach=function(t,e){return this.bullets.forEachExists(t,e,arguments),this},n.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this},n.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this},n.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",!0),this},n.Weapon.prototype.resetShots=function(t){return this.shots=0,void 0!==t&&(this.fireLimit=t),this},n.Weapon.prototype.destroy=function(){this.parent.remove(this,!1),this.bullets.destroy(),this.game=null,this.parent=null,this.active=!1,this.visible=!1},n.Weapon.prototype.update=function(){this._bulletKillType===n.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)),this.autofire&&this.fire()},n.Weapon.prototype.trackSprite=function(t,e,i,s){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=!1),this.trackedPointer=null,this.trackedSprite=t,this.trackRotation=s,this.trackOffset.set(e,i),this},n.Weapon.prototype.trackPointer=function(t,e,i){return void 0===t&&(t=this.game.input.activePointer),void 0===e&&(e=0),void 0===i&&(i=0),this.trackedPointer=t,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(e,i),this},n.Weapon.prototype.fire=function(t,e,i){if(this.game.time.now<this._nextFire||this.fireLimit>0&&this.shots===this.fireLimit)return!1;var s=this.bulletSpeed;0!==this.bulletSpeedVariance&&(s+=n.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)),t?this.fireFrom.width>1?this.fireFrom.centerOn(t.x,t.y):(this.fireFrom.x=t.x,this.fireFrom.y=t.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.rotation),this.fireFrom.width>1?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):this.fireFrom.width>1?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(s+=this.trackedSprite.body.speed)):this.trackedPointer&&(this.fireFrom.width>1?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y));var o=this.fireFrom.width>1?this.fireFrom.randomX:this.fireFrom.x,a=this.fireFrom.height>1?this.fireFrom.randomY:this.fireFrom.y,r=this.trackRotation?this.trackedSprite.angle:this.fireAngle;void 0!==e&&void 0!==i&&(r=this.game.math.radToDeg(Math.atan2(i-a,e-o))),0!==this.bulletAngleVariance&&(r+=n.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));var h=0,l=0;0===r||180===r?h=Math.cos(this.game.math.degToRad(r))*s:90===r||270===r?l=Math.sin(this.game.math.degToRad(r))*s:(h=Math.cos(this.game.math.degToRad(r))*s,l=Math.sin(this.game.math.degToRad(r))*s);var c=null;if(this.autoExpandBulletsGroup?(c=this.bullets.getFirstExists(!1,!0,o,a,this.bulletKey,this.bulletFrame)).data.bulletManager=this:c=this.bullets.getFirstExists(!1),c){if(c.reset(o,a),c.data.fromX=o,c.data.fromY=a,c.data.killType=this.bulletKillType,c.data.killDistance=this.bulletKillDistance,c.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===n.Weapon.KILL_LIFESPAN&&(c.lifespan=this.bulletLifespan),c.angle=r+this.bulletAngleOffset,""!==this.bulletAnimation){if(null===c.animations.getAnimation(this.bulletAnimation)){var u=this.anims[this.bulletAnimation];c.animations.add(u.name,u.frames,u.frameRate,u.loop,u.useNumericIndex)}c.animations.play(this.bulletAnimation)}else this.bulletFrameCycle?(c.frame=this.bulletFrames[this.bulletFrameIndex],++this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(c.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]);if(c.data.bodyDirty&&(this._data.customBody&&c.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),c.body.collideWorldBounds=this.bulletCollideWorldBounds,c.data.bodyDirty=!1),c.body.velocity.set(h,l),c.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y),0!==this.bulletSpeedVariance){var d=this.fireRate;(d+=n.Math.between(-this.fireRateVariance,this.fireRateVariance))<0&&(d=0),this._nextFire=this.game.time.now+d}else this._nextFire=this.game.time.now+this.fireRate;this.shots++,this.onFire.dispatch(c,this,s),this.fireLimit>0&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit)}return c},n.Weapon.prototype.fireAtPointer=function(t){return void 0===t&&(t=this.game.input.activePointer),this.fire(null,t.worldX,t.worldY)},n.Weapon.prototype.fireAtSprite=function(t){return this.fire(null,t.world.x,t.world.y)},n.Weapon.prototype.fireAtXY=function(t,e){return this.fire(null,t,e)},n.Weapon.prototype.setBulletBodyOffset=function(t,e,i,s){return void 0===i&&(i=0),void 0===s&&(s=0),this._data.customBody=!0,this._data.width=t,this._data.height=e,this._data.offsetX=i,this._data.offsetY=s,this.bullets.callAll("body.setSize","body",t,e,i,s),this.bullets.setAll("data.bodyDirty",!1),this},n.Weapon.prototype.setBulletFrames=function(t,e,i,s){return void 0===i&&(i=!0),void 0===s&&(s=!1),this.bulletFrames=n.ArrayUtils.numberArray(t,e),this.bulletFrameIndex=0,this.bulletFrameCycle=i,this.bulletFrameRandom=s,this},n.Weapon.prototype.addBulletAnimation=function(t,e,i,s,n){return this.anims[t]={name:t,frames:e,frameRate:i,loop:s,useNumericIndex:n},this.bullets.callAll("animations.add","animations",t,e,i,s,n),this.bulletAnimation=t,this},n.Weapon.prototype.debug=function(t,e,i){void 0===t&&(t=16),void 0===e&&(e=32),void 0===i&&(i=!1),this.game.debug.text("Weapon Plugin",t,e),this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,t,e+24),i&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")},Object.defineProperty(n.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(t){this._bulletClass=t,this.bullets.classType=this._bulletClass}}),Object.defineProperty(n.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case n.Weapon.KILL_STATIC_BOUNDS:case n.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case n.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case n.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds}this._bulletKillType=t}}),Object.defineProperty(n.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(t){this._bulletCollideWorldBounds=t,this.bullets.setAll("body.collideWorldBounds",t),this.bullets.setAll("data.bodyDirty",!1)}}),Object.defineProperty(n.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(t){this.fireFrom.x=t}}),Object.defineProperty(n.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(t){this.fireFrom.y=t}}),n.Bullet=function(t,e,i,s,o){n.Sprite.call(this,t,e,i,s,o),this.anchor.set(.5),this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}},n.Bullet.prototype=Object.create(n.Sprite.prototype),n.Bullet.prototype.constructor=n.Bullet,n.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this},n.Bullet.prototype.update=function(){this.exists&&(this.data.killType>n.Weapon.KILL_LIFESPAN&&(this.data.killType===n.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))},n.Video=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),this.game=t,this.key=e,this.width=0,this.height=0,this.type=n.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new n.Signal,this.onChangeSource=new n.Signal,this.onComplete=new n.Signal,this.onAccess=new n.Signal,this.onError=new n.Signal,this.onTimeout=new n.Signal,this.timeout=15e3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,e&&this.game.cache.checkVideoKey(e)){var s=this.game.cache.getVideo(e);s.isBlob?this.createVideoFromBlob(s.data):this.video=s.data,this.width=this.video.videoWidth,this.height=this.video.videoHeight}else i&&this.createVideoFromURL(i,!1);this.video&&!i?(this.baseTexture=new PIXI.BaseTexture(this.video),this.baseTexture.forceLoaded(this.width,this.height)):(this.baseTexture=new PIXI.BaseTexture(n.Cache.DEFAULT.baseTexture.source),this.baseTexture.forceLoaded(this.width,this.height)),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new n.Frame(0,0,0,this.width,this.height,"video"),this.texture.setFrame(this.textureFrame),this.texture.valid=!1,null!==e&&this.video&&(this.texture.valid=this.video.canplay),this.snapshot=null,n.BitmapData&&(this.snapshot=new n.BitmapData(this.game,"",this.width,this.height)),!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?this.setTouchLock():s&&(s.locked=!1)},n.Video.prototype={connectToMediaStream:function(t,e){return t&&e&&(this.video=t,this.videoStream=e,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=null),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;null!==this.videoStream&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),null!==e&&(this.video.width=e),null!==i&&(this.video.height=i),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:t,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(t){this.getUserMediaError(t)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID),this.onTimeout.dispatch(this)},getUserMediaError:function(t){clearTimeout(this._timeOutID),this.onError.dispatch(this,t)},getUserMediaSuccess:function(t){clearTimeout(this._timeOutID),this.videoStream=t,void 0!==this.video.mozSrcObject?this.video.mozSrcObject=t:this.video.src=window.URL&&window.URL.createObjectURL(t)||t;var e=this;this.video.onloadeddata=function(){var t=10;!function i(){if(t>0)if(e.video.videoWidth>0){var s=e.video.videoWidth,n=e.video.videoHeight;isNaN(e.video.videoHeight)&&(n=s/(4/3)),e.video.play(),e.isStreaming=!0,e.baseTexture.source=e.video,e.updateTexture(null,s,n),e.onAccess.dispatch(e)}else window.setTimeout(i,500);t--}()}},createVideoFromBlob:function(t){var e=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.addEventListener("loadeddata",function(t){e.updateTexture(t)},!0),this.video.src=window.URL.createObjectURL(t),this.video.canplay=!0,this},createVideoFromURL:function(t,e){return void 0===e&&(e=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,e&&this.video.setAttribute("autoplay","autoplay"),this.video.src=t,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=t,this},updateTexture:function(t,e,i){var s=!1;null!=e||(e=this.video.videoWidth,s=!0),null!=i||(i=this.video.videoHeight),this.width=e,this.height=i,this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video),this.baseTexture.forceLoaded(e,i),this.texture.frame.resize(e,i),this.texture.width=e,this.texture.height=i,this.texture.valid=!0,this.snapshot&&this.snapshot.resize(e,i),s&&null!==this.key&&(this.onChangeSource.dispatch(this,e,i),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=t?"loop":"",this.video.playbackRate=e,this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4!==this.video.readyState?(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)):(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0))),this.video.play(),this.onPlay.dispatch(this,t,e)),this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0),this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(t){t.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},addToWorld:function(t,e,i,s,n,o){n=n||1,o=o||1;var a=this.game.add.image(t,e,this);return a.anchor.set(i,s),a.scale.set(n,o),a},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||this.video.play())},changeSource:function(t,e){return void 0===e&&(e=!0),this.texture.valid=!1,this.video.pause(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=t,this.video.load(),this._autoplay=e,e||(this.paused=!0),this},checkVideoProgress:function(){4===this.video.readyState?this.updateTexture():--this.retry>0&&(this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval))},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this),this.touchLocked=!0},unlock:function(){if(this.touchLocked=!1,this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate),this.key){var t=this.game.cache.getVideo(this.key);t&&!t.isBlob&&(t.locked=!1)}return!0},grab:function(t,e,i){if(void 0===t&&(t=!1),void 0===e&&(e=1),void 0===i&&(i=null),null!==this.snapshot)return t&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,e,i),this.snapshot},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay"),this.video.removeAttribute("src"),this.video=null}},destroy:function(){this.stop(),this.removeVideoElement(),this.touchLocked&&this.game.input.touch.removeTouchLockCallback(this.unlock,this),this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(n.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(t){this.video.currentTime=t}}),Object.defineProperty(n.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(n.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(n.Video.prototype,"mute",{get:function(){return this._muted},set:function(t){if(t=t||null){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(n.Video.prototype,"paused",{get:function(){return this._paused},set:function(t){if(t=t||null,!this.touchLocked)if(t){if(this._paused)return;this._codePaused=!0,this.setPause()}else{if(!this._paused)return;this._codePaused=!1,this.setResume()}}}),Object.defineProperty(n.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(t){t<0?t=0:t>1&&(t=1),this.video&&(this.video.volume=t)}}),Object.defineProperty(n.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(t){this.video&&(this.video.playbackRate=t)}}),Object.defineProperty(n.Video.prototype,"loop",{get:function(){return!!this.video&&this.video.loop},set:function(t){t&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}}),Object.defineProperty(n.Video.prototype,"playing",{get:function(){return!(this.video.paused&&this.video.ended)}}),n.Video.prototype.constructor=n.Video,void 0===PIXI.blendModes&&(PIXI.blendModes=n.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=n.scaleModes),void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new PIXI.Matrix),void 0===PIXI.RenderTexture.tempMatrix&&(PIXI.RenderTexture.tempMatrix=new PIXI.Matrix),PIXI.Graphics&&void 0===PIXI.Graphics.POLY&&(PIXI.Graphics.POLY=n.POLYGON,PIXI.Graphics.RECT=n.RECTANGLE,PIXI.Graphics.CIRC=n.CIRCLE,PIXI.Graphics.ELIP=n.ELLIPSE,PIXI.Graphics.RREC=n.ROUNDEDRECTANGLE),PIXI.TextureSilentFail=!0,void 0!==t&&t.exports&&(e=t.exports=n),e.Phaser=n,n}).call(this)}).call(e,i(59))},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function n(t){if(l===setTimeout)return setTimeout(t,0);if((l===i||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function o(){f&&d&&(f=!1,d.length?p=d.concat(p):y=-1,p.length&&a())}function a(){if(!f){var t=n(o);f=!0;for(var e=p.length;e;){for(d=p,p=[];++y<e;)d&&d[y].run();y=-1,e=p.length}d=null,f=!1,function(t){if(c===clearTimeout)return clearTimeout(t);if((c===s||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(t);try{c(t)}catch(e){try{return c.call(null,t)}catch(e){return c.call(this,t)}}}(t)}}function r(t,e){this.fun=t,this.array=e}function h(){}var l,c,u=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:i}catch(t){l=i}try{c="function"==typeof clearTimeout?clearTimeout:s}catch(t){c=s}}();var d,p=[],f=!1,y=-1;u.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new r(t,e)),1!==p.length||f||n(a)},r.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=h,u.addListener=h,u.once=h,u.off=h,u.removeListener=h,u.removeAllListeners=h,u.emit=h,u.prependListener=h,u.prependOnceListener=h,u.listeners=function(t){return[]},u.binding=function(t){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(t){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(t,e,i){var s;!function(){function n(t,e,i){return t.call.apply(t.bind,arguments)}function o(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,s),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function a(t,e,i){return(a=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:o).apply(null,arguments)}function r(t,e){this.a=t,this.o=e||t,this.c=this.o.document}function h(t,e,i,s){if(e=t.c.createElement(e),i)for(var n in i)i.hasOwnProperty(n)&&("style"==n?e.style.cssText=i[n]:e.setAttribute(n,i[n]));return s&&e.appendChild(t.c.createTextNode(s)),e}function l(t,e,i){(t=t.c.getElementsByTagName(e)[0])||(t=document.documentElement),t.insertBefore(i,t.lastChild)}function c(t){t.parentNode&&t.parentNode.removeChild(t)}function u(t,e,i){e=e||[],i=i||[];for(var s=t.className.split(/\s+/),n=0;n<e.length;n+=1){for(var o=!1,a=0;a<s.length;a+=1)if(e[n]===s[a]){o=!0;break}o||s.push(e[n])}for(e=[],n=0;n<s.length;n+=1){for(o=!1,a=0;a<i.length;a+=1)if(s[n]===i[a]){o=!0;break}o||e.push(s[n])}t.className=e.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function d(t,e){for(var i=t.className.split(/\s+/),s=0,n=i.length;s<n;s++)if(i[s]==e)return!0;return!1}function p(t,e,i){function s(){r&&n&&o&&(r(a),r=null)}e=h(t,"link",{rel:"stylesheet",href:e,media:"all"});var n=!1,o=!0,a=null,r=i||null;Z?(e.onload=function(){n=!0,s()},e.onerror=function(){n=!0,a=Error("Stylesheet failed to load"),s()}):setTimeout(function(){n=!0,s()},0),l(t,"head",e)}function f(t,e,i,s){var n=t.c.getElementsByTagName("head")[0];if(n){var o=h(t,"script",{src:e}),a=!1;return o.onload=o.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,i&&i(null),o.onload=o.onreadystatechange=null,"HEAD"==o.parentNode.tagName&&n.removeChild(o))},n.appendChild(o),setTimeout(function(){a||(a=!0,i&&i(Error("Script load timeout")))},s||5e3),o}return null}function y(){this.a=0,this.c=null}function g(t){return t.a++,function(){t.a--,v(t)}}function m(t,e){t.c=e,v(t)}function v(t){0==t.a&&t.c&&(t.c(),t.c=null)}function b(t){this.a=t||"-"}function x(t,e){this.c=t,this.f=4,this.a="n";var i=(e||"n4").match(/^([nio])([1-9])$/i);i&&(this.a=i[1],this.f=parseInt(i[2],10))}function _(t){var e=[];t=t.split(/,\s*/);for(var i=0;i<t.length;i++){var s=t[i].replace(/['"]/g,"");-1!=s.indexOf(" ")||/^\d/.test(s)?e.push("'"+s+"'"):e.push(s)}return e.join(",")}function w(t){return t.a+t.f}function P(t){var e="normal";return"o"===t.a?e="oblique":"i"===t.a&&(e="italic"),e}function C(t){var e=4,i="n",s=null;return t&&((s=t.match(/(normal|oblique|italic)/i))&&s[1]&&(i=s[1].substr(0,1).toLowerCase()),(s=t.match(/([1-9]00|normal|bold)/i))&&s[1]&&(/bold/i.test(s[1])?e=7:/[1-9]00/.test(s[1])&&(e=parseInt(s[1].substr(0,1),10)))),i+e}function T(t,e){this.c=t,this.f=t.o.document.documentElement,this.h=e,this.a=new b("-"),this.j=!1!==e.events,this.g=!1!==e.classes}function S(t){if(t.g){var e=d(t.f,t.a.c("wf","active")),i=[],s=[t.a.c("wf","loading")];e||i.push(t.a.c("wf","inactive")),u(t.f,i,s)}A(t,"inactive")}function A(t,e,i){t.j&&t.h[e]&&(i?t.h[e](i.c,w(i)):t.h[e]())}function E(){this.c={}}function I(t,e){this.c=t,this.f=e,this.a=h(this.c,"span",{"aria-hidden":"true"},this.f)}function M(t){l(t.c,"body",t.a)}function O(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+_(t.c)+";font-style:"+P(t)+";font-weight:"+t.f+"00;"}function R(t,e,i,s,n,o){this.g=t,this.j=e,this.a=s,this.c=i,this.f=n||3e3,this.h=o||void 0}function B(t,e,i,s,n,o,a){this.v=t,this.B=e,this.c=i,this.a=s,this.s=a||"BESbswy",this.f={},this.w=n||3e3,this.u=o||null,this.m=this.j=this.h=this.g=null,this.g=new I(this.c,this.s),this.h=new I(this.c,this.s),this.j=new I(this.c,this.s),this.m=new I(this.c,this.s),t=O(t=new x(this.a.c+",serif",w(this.a))),this.g.a.style.cssText=t,t=O(t=new x(this.a.c+",sans-serif",w(this.a))),this.h.a.style.cssText=t,t=O(t=new x("serif",w(this.a))),this.j.a.style.cssText=t,t=O(t=new x("sans-serif",w(this.a))),this.m.a.style.cssText=t,M(this.g),M(this.h),M(this.j),M(this.m)}function L(){if(null===$){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);$=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))}return $}function D(t,e,i){for(var s in Q)if(Q.hasOwnProperty(s)&&e===t.f[Q[s]]&&i===t.f[Q[s]])return!0;return!1}function k(t){var e,i=t.g.a.offsetWidth,s=t.h.a.offsetWidth;(e=i===t.f.serif&&s===t.f["sans-serif"])||(e=L()&&D(t,i,s)),e?J()-t.A>=t.w?L()&&D(t,i,s)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?F(t,t.v):F(t,t.B):function(t){setTimeout(a(function(){k(this)},t),50)}(t):F(t,t.v)}function F(t,e){setTimeout(a(function(){c(this.g.a),c(this.h.a),c(this.j.a),c(this.m.a),e(this.a)},t),0)}function G(t,e,i){this.c=t,this.a=e,this.f=0,this.m=this.j=!1,this.s=i}function U(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&u(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),A(t,"active")):S(t.a))}function N(t){this.j=t,this.a=new E,this.h=0,this.f=this.g=!0}function j(t,e,i,s,n){var o=0==--t.h;(t.f||t.g)&&setTimeout(function(){var t=n||null,r=s||{};if(0===i.length&&o)S(e.a);else{e.f+=i.length,o&&(e.j=o);var h,l=[];for(h=0;h<i.length;h++){var c=i[h],d=r[c.c],p=e.a,f=c;if(p.g&&u(p.f,[p.a.c("wf",f.c,w(f).toString(),"loading")]),A(p,"fontloading",f),p=null,null===tt)if(window.FontFace){f=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var y=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);tt=f?42<parseInt(f[1],10):!y}else tt=!1;p=tt?new R(a(e.g,e),a(e.h,e),e.c,c,e.s,d):new B(a(e.g,e),a(e.h,e),e.c,c,e.s,t,d),l.push(p)}for(h=0;h<l.length;h++)l[h].start()}},0)}function W(t,e,i){var s=[],n=i.timeout;!function(t){t.g&&u(t.f,[t.a.c("wf","loading")]),A(t,"loading")}(e);s=function(t,e,i){var s,n=[];for(s in e)if(e.hasOwnProperty(s)){var o=t.c[s];o&&n.push(o(e[s],i))}return n}(t.a,i,t.c);var o=new G(t.c,e,n);for(t.h=s.length,e=0,i=s.length;e<i;e++)s[e].load(function(e,i,s){j(t,o,e,i,s)})}function X(t,e){this.c=t,this.a=e}function H(t,e){this.c=t,this.a=e}function V(t,e){this.c=t||et,this.a=[],this.f=[],this.g=e||""}function Y(t){this.f=t,this.a=[],this.c={}}function q(t,e){this.c=t,this.a=e}function z(t,e){this.c=t,this.a=e}function K(t,e){this.c=t,this.f=e,this.a=[]}var J=Date.now||function(){return+new Date},Z=!!window.FontFace;b.prototype.c=function(t){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return e.join(this.a)},R.prototype.start=function(){var t=this.c.o.document,e=this,i=J(),s=new Promise(function(s,n){!function o(){J()-i>=e.f?n():t.fonts.load(function(t){return P(t)+" "+t.f+"00 300px "+_(t.c)}(e.a),e.h).then(function(t){1<=t.length?s():setTimeout(o,25)},function(){n()})}()}),n=null,o=new Promise(function(t,i){n=setTimeout(i,e.f)});Promise.race([o,s]).then(function(){n&&(clearTimeout(n),n=null),e.g(e.a)},function(){e.j(e.a)})};var Q={D:"serif",C:"sans-serif"},$=null;B.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=J(),k(this)};var tt=null;G.prototype.g=function(t){var e=this.a;e.g&&u(e.f,[e.a.c("wf",t.c,w(t).toString(),"active")],[e.a.c("wf",t.c,w(t).toString(),"loading"),e.a.c("wf",t.c,w(t).toString(),"inactive")]),A(e,"fontactive",t),this.m=!0,U(this)},G.prototype.h=function(t){var e=this.a;if(e.g){var i=d(e.f,e.a.c("wf",t.c,w(t).toString(),"active")),s=[],n=[e.a.c("wf",t.c,w(t).toString(),"loading")];i||s.push(e.a.c("wf",t.c,w(t).toString(),"inactive")),u(e.f,s,n)}A(e,"fontinactive",t),U(this)},N.prototype.load=function(t){this.c=new r(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,W(this,new T(this.c,t),t)},X.prototype.load=function(t){var e=this,i=e.a.projectId,s=e.a.version;if(i){var n=e.c.o;f(this.c,(e.a.api||"https://fast.fonts.net/jsapi")+"/"+i+".js"+(s?"?v="+s:""),function(s){s?t([]):(n["__MonotypeConfiguration__"+i]=function(){return e.a},function e(){if(n["__mti_fntLst"+i]){var s,o=n["__mti_fntLst"+i](),a=[];if(o)for(var r=0;r<o.length;r++){var h=o[r].fontfamily;null!=o[r].fontStyle&&null!=o[r].fontWeight?(s=o[r].fontStyle+o[r].fontWeight,a.push(new x(h,s))):a.push(new x(h))}t(a)}else setTimeout(function(){e()},50)}())}).id="__MonotypeAPIScript__"+i}else t([])},H.prototype.load=function(t){var e,i,s=this.a.urls||[],n=this.a.families||[],o=this.a.testStrings||{},a=new y;for(e=0,i=s.length;e<i;e++)p(this.c,s[e],g(a));var r=[];for(e=0,i=n.length;e<i;e++)if((s=n[e].split(":"))[1])for(var h=s[1].split(","),l=0;l<h.length;l+=1)r.push(new x(s[0],h[l]));else r.push(new x(s[0]));m(a,function(){t(r,o)})};var et="https://fonts.googleapis.com/css",it={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},st={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},nt={i:"i",italic:"i",n:"n",normal:"n"},ot=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/,at={Arimo:!0,Cousine:!0,Tinos:!0};q.prototype.load=function(t){var e=new y,i=this.c,s=new V(this.a.api,this.a.text),n=this.a.families;!function(t,e){for(var i=e.length,s=0;s<i;s++){var n=e[s].split(":");3==n.length&&t.f.push(n.pop());var o="";2==n.length&&""!=n[1]&&(o=":"),t.a.push(n.join(o))}}(s,n);var o=new Y(n);(function(t){for(var e=t.f.length,i=0;i<e;i++){var s=t.f[i].split(":"),n=s[0].replace(/\+/g," "),o=["n4"];if(2<=s.length){var a;if(a=[],r=s[1])for(var r,h=(r=r.split(",")).length,l=0;l<h;l++){var c;if((c=r[l]).match(/^[\w-]+$/))if(null==(u=ot.exec(c.toLowerCase())))c="";else{if(c=null==(c=u[2])||""==c?"n":nt[c],null==(u=u[1])||""==u)u="4";else var u=st[u]||(isNaN(u)?"4":u.substr(0,1));c=[c,u].join("")}else c="";c&&a.push(c)}0<a.length&&(o=a),3==s.length&&(a=[],0<(s=(s=s[2])?s.split(","):a).length&&(s=it[s[0]])&&(t.c[n]=s))}for(t.c[n]||(s=it[n])&&(t.c[n]=s),s=0;s<o.length;s+=1)t.a.push(new x(n,o[s]))}})(o),p(i,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var e=t.a.length,i=[],s=0;s<e;s++)i.push(t.a[s].replace(/ /g,"+"));return e=t.c+"?family="+i.join("%7C"),0<t.f.length&&(e+="&subset="+t.f.join(",")),0<t.g.length&&(e+="&text="+encodeURIComponent(t.g)),e}(s),g(e)),m(e,function(){t(o.a,o.c,at)})},z.prototype.load=function(t){var e=this.a.id,i=this.c.o;e?f(this.c,(this.a.api||"https://use.typekit.net")+"/"+e+".js",function(e){if(e)t([]);else if(i.Typekit&&i.Typekit.config&&i.Typekit.config.fn){e=i.Typekit.config.fn;for(var s=[],n=0;n<e.length;n+=2)for(var o=e[n],a=e[n+1],r=0;r<a.length;r++)s.push(new x(o,a[r]));try{i.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}t(s)}},2e3):t([])},K.prototype.load=function(t){var e=this.f.id,i=this.c.o,s=this;e?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[e]=function(e,i){for(var n=0,o=i.fonts.length;n<o;++n){var a=i.fonts[n];s.a.push(new x(a.name,C("font-weight:"+a.weight+";font-style:"+a.style)))}t(s.a)},f(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+function(t){return t.o.location.hostname||t.a.location.hostname}(this.c)+"/"+e+".js",function(e){e&&t([])})):t([])};var rt=new N(window);rt.a.c.custom=function(t,e){return new H(e,t)},rt.a.c.fontdeck=function(t,e){return new K(e,t)},rt.a.c.monotype=function(t,e){return new X(e,t)},rt.a.c.typekit=function(t,e){return new z(e,t)},rt.a.c.google=function(t,e){return new q(e,t)};var ht={load:a(rt.load,rt)};void 0!==(s=function(){return ht}.call(e,i,e,t))&&(t.exports=s)}()},function(t,e,i){"use strict";e.__esModule=!0;var s=i(62);e.Boot=s.default;var n=i(25);e.Gameplay=n.default;var o=i(26);e.Menu=o.default;var a=i(20);e.Garage=a.default;var r=i(22);e.ChooseZone=r.default},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0,i(12),i(11);var n=i(63),o=i(3),a=i(39),r=i(23),h=function(t){function e(){var i=t.call(this)||this;return i.name=e.Name,i}return s(e,t),e.prototype.init=function(){var t=this;this.game.canvas.oncontextmenu=function(t){t.preventDefault()},this.game.input.maxPointers=3,this.game.input.addPointer(),this.game.input.addPointer(),this.game.device.desktop?(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.game.scale.windowConstraints.bottom="visual",this.game.onBlur.add(function(){t.game.sound.mute=!0}),this.game.onFocus.add(function(){t.game.sound.mute=!1})):(this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.fullScreenScaleMode=Phaser.ScaleManager.USER_SCALE,window.addEventListener("resize",function(){return e.mobileResizeCallback(t.game.scale)}),this.game.scale.onSizeChange.add(function(){o.Constants.LANDSCAPE_LOCKED?t.game.width>t.game.height?t.handleCorrect():t.handleIncorrect():o.Constants.PORTRAIT_LOCKED&&(t.game.width<t.game.height?t.handleCorrect():t.handleIncorrect()),t.game.state.getCurrentState().resize()},this),e.mobileResizeCallback(this.game.scale),document.addEventListener("pause",function(){t.game.sound.mute=!0}),document.addEventListener("resume",function(){t.game.sound.mute=!1}),this.stage.disableVisibilityChange=!1,this.game.onPause.add(function(){t.game.sound.mute=!0}),this.game.onResume.add(function(){t.game.sound.mute=!1}))},e.mobileResizeCallback=function(t){var i=window.innerWidth,s=window.innerHeight;e.setScaling(t.game);var n=720*o.Constants.GAME_SCALE,a=480*o.Constants.GAME_SCALE,r=1;r/=i>s?s/a:s/n,o.Constants.WIDTH=720,o.Constants.HEIGHT=480,o.Constants.CALCULATED_WIDTH=Math.ceil(i*r),o.Constants.CALCULATED_HEIGHT=Math.ceil(s*r),t.setGameSize(o.Constants.CALCULATED_WIDTH,o.Constants.CALCULATED_HEIGHT),t.setUserScale(1/r,1/r),o.Constants.LANDSCAPE_LOCKED&&(t.game.width>t.game.height?(document.getElementById("orientation").style.display="none",document.getElementById("content").style.display="block"):(document.getElementById("orientation").style.display="block",document.getElementById("content").style.display="none"))},e.setScaling=function(t){window.innerWidth>window.innerHeight?window.innerWidth:window.innerHeight;t.device.pixelRatio,o.Constants.GAME_SCALE=1},e.prototype.preload=function(){var t=this;this.game.load.cacheBuster=1557148846939;var e="x"+o.Constants.GAME_SCALE+"/";o.Images.preloadList.forEach(function(i){t.game.load.image(i,"assets/images/"+e+i+".png")}),o.JSONData.preloadList.forEach(function(e){t.game.load.json(e,"assets/levels/"+e+".json")}),o.Atlases.preloadList.forEach(function(i){t.game.load.atlas(i,"assets/atlases/"+e+i+".png","assets/atlases/"+e+i+".json")}),o.Sounds.preloadList.forEach(function(e){t.game.device.iOS?t.game.load.audio(e,["assets/sounds/"+e+".m4a"]):t.game.load.audio(e,["assets/sounds/"+e+".ogg","assets/sounds/"+e+".mp3"])}),r.default.init(),this.game.load.crossOrigin="anonymous",this.game.load.image("more_games",r.default.api.getMoreGamesButtonImage())},e.prototype.create=function(){n.default.hide(),this.game.state.start(a.default.Name)},e.prototype.handleCorrect=function(){document.getElementById("orientation").style.display="none",document.getElementById("content").style.display="block"},e.prototype.handleIncorrect=function(){document.getElementById("orientation").style.display="block",document.getElementById("content").style.display="none"},e.Name="boot",e}(Phaser.State);e.default=h},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.show=function(){var t=document.getElementById("loader");t&&(t.style.display="block")},t.hide=function(){var t=document.getElementById("loader");t&&(t.style.display="none")},t}();e.default=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){this.updated=[],this.restarted=[],this.objects=[],this.game=null}return t.prototype.start=function(){this.view.start(),this.physics.start()},t.prototype.init=function(t){this.game=t},t.prototype.add=function(t){this.objects.push(t),t.update&&(this.updatedLen=this.updated.push(t)),t.restart&&this.restarted.push(t),t.body&&this.physics.add(t),t.graphic&&this.view.add(t)},t.prototype.update=function(t){this.physics.update(t);for(var e=0;e<this.updatedLen;e++)this.updated[e].update(t)},t.prototype.restart=function(){for(var t=this.restarted.length,e=0;e<t;e++)this.restarted[e].restart()},t.prototype.release=function(){for(var t=this.objects.length,e=0;e<t;e++)this.objects[e].release();this.objects.splice(0,t),this.restarted.splice(0,this.restarted.length),this.updated.splice(0,this.updatedLen),this.updatedLen=0,this.view.release(),this.physics.release()},t}();e.GameCore=s},function(t,e,i){"use strict";e.__esModule=!0;var s=i(0),n=function(){function t(){this.type=-1}return t.prototype.create=function(t){void 0===t&&(t=null)},t.prototype.release=function(){if(this.graphic){if(this.graphic.dispose)try{this.graphic.dispose()}catch(t){}this.graphic=null}if(this.body){try{s.NapeUtil.disposeBody(this.body)}catch(t){}this.body=null}},t}();e.GameObject=n},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";e.__esModule=!0},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(t){this.game=null,this.game=t}return t.prototype.add=function(t){},t.prototype.release=function(){this.game=null,this.raceCamera=null},t.prototype.update=function(t,e,i,s){},t.prototype.start=function(){},t}();e.GameView=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){this.obj=null,this.bodyW=64,this.bodyH=32,this.bodyDensity=1,this.bodyMassType=0,this.wheelBackR=16,this.wheelBackDx=32,this.wheelBackDensity=1,this.driverDensity=0,this.driverDx=32,this.driverDy=0,this.driverW=64,this.driverH=64,this.axisBackY=2,this.axisBackLen=30,this.axisBackAngle=.5*Math.PI,this.damperBackY=0,this.damperBackLen=32,this.damperBackFreq=10,this.damperBackDamp=1,this.wheelFrontR=16,this.wheelFrontDx=32,this.wheelFrontDensity=1,this.axisFrontY=0,this.axisFrontLen=32,this.axisFrontAngle=.5*Math.PI,this.damperFrontY=2,this.damperFrontLen=30,this.damperFrontFreq=10,this.damperFrontDamp=1,this.wd=2,this.maxSpeed=1e3,this.torque=1e3,this.maxTorque=2e3,this.flipTorque=1e3,this.maxFlipSpeed=3,this.boostForce=1e3,this.skinId=1,this.wheelBackFriction=2,this.wheelFrontFriction=2,this.maxSpeedPct=5,this.torquePct=5,this.wheelFrictionPct=10,this.wheelRadiusValue=1,this.boostValue=1,this.handlingPct=5,this.engineCount=3,this.handlingCount=3,this.boostCount=3,this.wheelsCount=3,this.wheels=0,this.colorId=1}return t.prototype.setData=function(t){this.setData2(t),this.getData()},t.prototype.setData2=function(t){this.bodyW=t.bodyW,this.bodyH=t.bodyH,this.bodyDensity=t.bodyDensity,this.bodyMassType=t.bodyMassType,this.wheelBackDx=t.wheelBackDx,this.wheelFrontDx=t.wheelFrontDx,this.driverDensity=t.driverDensity,this.driverDx=t.driverDx,this.driverDy=t.driverDy,this.driverW=t.driverW,this.driverH=t.driverH,this.wheelBackR=t.wheelBackR,this.wheelBackDensity=t.wheelBackDensity,this.wheelBackFriction=t.wheelBackFriction,this.axisBackAngle=t.axisBackAngle,this.axisBackY=t.axisBackY,this.axisBackLen=t.axisBackLen,this.damperBackY=t.damperBackY,this.damperBackLen=t.damperBackLen,this.damperBackFreq=t.damperBackFreq,this.damperBackDamp=t.damperBackDamp,this.wheelFrontR=t.wheelFrontR,this.wheelFrontDensity=t.wheelFrontDensity,this.wheelFrontFriction=t.wheelFrontFriction,this.axisFrontAngle=t.axisFrontAngle,this.axisFrontY=t.axisFrontY,this.axisFrontLen=t.axisFrontLen,this.damperFrontY=t.damperFrontY,this.damperFrontLen=t.damperFrontLen,this.damperFrontFreq=t.damperFrontFreq,this.damperFrontDamp=t.damperFrontDamp,this.wd=t.wd,this.maxSpeed=t.maxSpeed,this.torque=t.torque,this.maxTorque=t.maxTorque,this.flipTorque=t.flipTorque,this.maxFlipSpeed=t.maxFlipSpeed,this.boostForce=t.boostForce,this.skinId=t.skinId,this.maxSpeedPct=t.maxSpeedPct,this.torquePct=t.torquePct,this.wheelFrictionPct=t.wheelFrictionPct,this.wheelRadiusValue=t.wheelRadiusValue,this.boostValue=t.boostValue,this.handlingPct=t.handlingPct,this.engineCount=t.engineCount,this.handlingCount=t.handlingCount,this.boostCount=t.boostCount,this.wheelsCount=t.wheelsCount,this.wheels=t.wheels},t.prototype.getData=function(){return null===this.obj&&(this.obj={}),this.obj.bodyW=this.bodyW,this.obj.bodyH=this.bodyH,this.obj.bodyDensity=this.bodyDensity,this.obj.bodyMassType=this.bodyMassType,this.obj.bodyMassType=this.bodyMassType,this.obj.wheelBackDx=this.wheelBackDx,this.obj.wheelFrontDx=this.wheelFrontDx,this.obj.driverDensity=this.driverDensity,this.obj.driverDx=this.driverDx,this.obj.driverDy=this.driverDy,this.obj.driverW=this.driverW,this.obj.driverH=this.driverH,this.obj.wheelBackR=this.wheelBackR,this.obj.wheelBackDensity=this.wheelBackDensity,this.obj.wheelBackFriction=this.wheelBackFriction,this.obj.axisBackAngle=this.axisBackAngle,this.obj.axisBackY=this.axisBackY,this.obj.axisBackLen=this.axisBackLen,this.obj.damperBackY=this.damperBackY,this.obj.damperBackLen=this.damperBackLen,this.obj.damperBackFreq=this.damperBackFreq,this.obj.damperBackDamp=this.damperBackDamp,this.obj.wheelFrontR=this.wheelFrontR,this.obj.wheelFrontDensity=this.wheelFrontDensity,this.obj.wheelFrontFriction=this.wheelFrontFriction,this.obj.axisFrontAngle=this.axisFrontAngle,this.obj.axisFrontY=this.axisFrontY,this.obj.axisFrontLen=this.axisFrontLen,this.obj.damperFrontY=this.damperFrontY,this.obj.damperFrontLen=this.damperFrontLen,this.obj.damperFrontFreq=this.damperFrontFreq,this.obj.damperFrontDamp=this.damperFrontDamp,this.obj.wd=this.wd,this.obj.maxSpeed=this.maxSpeed,this.obj.torque=this.torque,this.obj.maxTorque=this.maxTorque,this.obj.flipTorque=this.flipTorque,this.obj.maxFlipSpeed=this.maxFlipSpeed,this.obj.boostForce=this.boostForce,this.obj.skinId=this.skinId,this.obj.maxSpeedPct=this.maxSpeedPct,this.obj.torquePct=this.torquePct,this.obj.wheelFrictionPct=this.wheelFrictionPct,this.obj.wheelRadiusValue=this.wheelRadiusValue,this.obj.boostValue=this.boostValue,this.obj.handlingPct=this.handlingPct,this.obj.engineCount=this.engineCount,this.obj.handlingCount=this.handlingCount,this.obj.boostCount=this.boostCount,this.obj.wheelsCount=this.wheelsCount,this.obj.wheels=this.wheels,this.obj},t.prototype.cloneWheel=function(t){void 0===t&&(t=!0),t?(this.wheelFrontR=this.wheelBackR,this.wheelFrontDensity=this.wheelBackDensity,this.wheelFrontFriction=this.wheelBackFriction,this.axisFrontY=this.axisBackY,this.axisFrontLen=this.axisBackLen,this.damperFrontY=this.damperBackY,this.damperFrontLen=this.damperBackLen,this.damperFrontFreq=this.damperBackFreq,this.damperFrontDamp=this.damperBackDamp):(this.wheelBackR=this.wheelFrontR,this.wheelBackDensity=this.wheelFrontDensity,this.wheelBackFriction=this.wheelFrontFriction,this.axisBackY=this.axisFrontY,this.axisBackLen=this.axisFrontLen,this.damperBackY=this.damperFrontY,this.damperBackLen=this.damperFrontLen,this.damperBackFreq=this.damperFrontFreq,this.damperBackDamp=this.damperFrontDamp)},t}();e.CarParams=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){this.engine=0,this.wheel=0,this.health=0,this.weapon=0}return t.prototype.isZero=function(){return 0===this.engine&&0===this.wheel&&0===this.health&&0===this.weapon},t}();e.CarUpgrades=s},function(t,e,i){"use strict";e.__esModule=!0;var s=i(16),n=i(33),o=i(0),a=function(){function t(){this.player={},this.bots=[],this.cars=[]}return t.prototype.reset=function(){this.player.x=.5*s.default.GAME_W,this.player.y=.5*s.default.GAME_H,this.bots.splice(0,this.bots.length),this.cars.splice(0,this.cars.length)},t.prototype.add=function(t){"PlayerWP"===t.className&&(n.RacesData.data=new o.RaceData,this.player.x=t.params.x,this.player.y=t.params.y,n.RacesData.data.startX=this.player.x)},t.prototype.setDrive=function(t){for(var e=0;e<this.cars.length;e++)this.cars[e].drive=t},t.COLORS=[1,3,3,1,3,1,1,1,1,1],t}();e.RaceCars=a},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){this.ammo=100,this.maxAmmo=100,this.speed=1,this.damage=60,this.count=1}return t.prototype.reset=function(t,e){void 0===t&&(t=null),void 0===e&&(e=0),t&&(this.maxAmmo=t.ammo+t.upg*e,this.speed=t.speed,this.damage=t.damage,this.count=t.count,this.life=t.life,this.radius=t.radius),this.ammo=this.maxAmmo},t}();e.WeaponParams=s},function(t,e,i){"use strict";e.__esModule=!0;var s=i(33),n=function(){function t(){this.save=null,this.firstEnter=!1,this.inited=!1}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t,t._instance.signalUnlock=new Phaser.Signal),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(){if(!this.inited){this.inited=!0,this.save={},this.save.skin=1;var e=this.save[t.LAST_ENTER];this.save[t.LAST_ENTER]=Date.now(),e||(this.firstEnter=!0),this.save[t.RACE_PREFIX+1+t.RACE_RESULT]=0}},t.prototype.reset=function(){this.inited=!1,this.init()},t.prototype.setRaceResult=function(e,i,n){var o=this.save[t.RACE_PREFIX+e.toString()+t.RACE_RESULT];if(!o)return e<s.RacesData.MAP_COUNT&&(this.save[t.RACE_PREFIX+(e+1).toString()+t.RACE_RESULT]||(this.save[t.RACE_PREFIX+(e+1).toString()+t.RACE_RESULT]=0)),this.save[t.RACE_PREFIX+e.toString()+t.RACE_RESULT]=i,this.save[t.RACE_PREFIX+e.toString()+t.RACE_TIME]=n,!0;i>Number(o)&&(this.save[t.RACE_PREFIX+e.toString()+t.RACE_RESULT]=i);var a=this.save[t.RACE_PREFIX+e.toString()+t.RACE_TIME];return n<parseFloat(a||100500)&&(this.save[t.RACE_PREFIX+e.toString()+t.RACE_TIME]=n,!0)},t.prototype.setScore=function(e,i){return this.save[t.RACE_PREFIX+e.toString()+t.RACE_SCORE]=i,this.getTotalScore()},t.prototype.getTotalScore=function(){for(var e=0,i=0;i<s.RacesData.MAP_COUNT;i++){var n=t.RACE_PREFIX+(i+1).toString()+t.RACE_SCORE;void 0!==this.save[n]&&(e+=this.save[n])}return e},t.prototype.getTotalStars=function(){for(var e=0,i=0;i<s.RacesData.MAP_COUNT;i++)void 0!==t.instance.save[t.RACE_PREFIX+(i+1).toString()+t.RACE_RESULT]&&(e+=this.save[t.RACE_PREFIX+(i+1).toString()+t.RACE_RESULT]);return e},t.prototype.unlockAll=function(){for(var e=1;e<25;e++)this.save[t.RACE_PREFIX+e.toString()+t.RACE_RESULT]=2;this.save[t.LAST_ENTER]=Date.now(),this.signalUnlock.dispatch()},Object.defineProperty(t.prototype,"skin",{get:function(){return this.save.skin},set:function(t){this.save.skin=t},enumerable:!0,configurable:!0}),t.LAST_ENTER="l_e",t.RACE_PREFIX="r_",t.RACE_RESULT="_r",t.RACE_SCORE="_s",t.RACE_TIME="_t",t}();e.Inventory=n},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){return function(){this.skins={}}}();e.LeagueVO=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){return function(){}}();e.MapVO=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){this.assetsReady=!1,this.restarted=!1,this.gravityY=1400,this.countdown=0,this.timer=0,this.startX=0,this.finishX=0,this.skinId=1,this.delayForMaks=.2}return t.prototype.reset=function(){this.assetsReady=!1,this.restarted=!1,this.startX=this.finishX=0,this.restart()},t.prototype.restart=function(){this.flip=0,this.delayForMaks=.2},t}();e.RaceData=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){return function(t,e){this.width=t.width,this.dx=t.x,this.texture=e,this.point=new Phaser.Point(0,t.y)}}();e.BgElVo=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){return function(){this.req_id=1}}();e.ShopCarVO=s},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(){}return t.cars=[],t.carsCount=0,t}();e.ShopData=s},function(t,e,i){"use strict";e.__esModule=!0;var s=Phaser.Signal,n=nape.constraint.AngleJoint,o=nape.constraint.DistanceJoint,a=nape.constraint.LineJoint,r=nape.constraint.WeldJoint,h=nape.geom.GeomPoly,l=nape.geom.GeomPolyList,c=nape.geom.Vec2,u=nape.phys.Body,d=nape.phys.BodyType,p=nape.phys.Material,f=nape.shape.Circle,y=nape.shape.Polygon,g=i(0),m=i(4),v=i(7),b=i(10),x=i(6),_=i(5),w=i(8),P=i(84),C=i(1),T=i(2),S=function(){function t(){this.complete=new s}return t.prototype.createAllCars=function(){this.cars=g.CarsData.cars,this.createPlayerCar(),this.carsCreated()},t.prototype.carsCreated=function(){g.CarsData.cars.cars;this.playerParams=null,this.complete.dispatch(this)},t.prototype.dispose=function(){this.complete.removeAll()},t.prototype.createPlayerCar=function(){this.playerParams=g.CarsData.params;var e=g.CarsData.cars.player.x,i=g.CarsData.cars.player.y,s=t.createCar(this.playerParams,e,i,!0,!1);s.controller=new g.PlayerController(s),s.frontWheel.graphic.createGroundParts(),s.backWheel.graphic.createGroundParts(),s.frame.graphic.createSmokeParts(),m.MaxGameCore.instance.car=s},t.createWheel=function(t,e,i,s){var r=i?t.wheelBackFriction:t.wheelFrontFriction,h=i?t.wheelBackDensity:t.wheelFrontDensity,l=new u(d.DYNAMIC);l.disableCCD=!0;var y,m,x=new p(0,r,r,h),w=i?t.wheelBackR:t.wheelFrontR;y=new f(w,null,x,v.Filters.WHEEL),l.cbTypes.add(b.CbTypes.WHEEL),l.shapes.add(y),l.compound=e,m=i?-t.wheelBackDx:t.wheelFrontDx;var P=i?t.axisBackY:t.axisFrontY,C=i?t.axisBackLen:t.axisFrontLen,T=i?t.damperBackY:t.damperFrontY,S=i?t.damperBackLen:t.damperFrontLen,A=2*S,E=i?t.damperBackFreq:t.damperFrontFreq,I=i?t.damperBackDamp:t.damperFrontDamp;l.position.setxy(s.position.x+m,s.position.y+S);var M=c.fromPolar(1,i?t.axisBackAngle:t.axisFrontAngle),O=new a(s,l,c.weak(m,P),c.weak(),M,0,C);O.compound=l.compound,M.dispose();var R=new o(s,l,c.weak(m,T),c.weak(),S,A);R.frequency=E,R.damping=I,R.ignore=!0,R.stiff=!1,R.compound=l.compound;var B=new g.WheelObject;if(!i){var L=new n(s,l,0,0,1);L.active=!1,L.stiff=!1,L.damping=100,L.compound=l.compound,B.brakeJoint=L}return B.skinId=t.skinId,B.body=l,B.graphic=_.GraphicUtil.createCarWheelGraphic(t,i?t.wheelBackR:t.wheelFrontR,i),B.material=x,B.lineJoint=O,B.distanceJoint=R,B.isPlayer=!0,B.create(),B},t.createDriver=function(t,e,i){var s=i.body,n=new g.DriverObject,o=new u(d.DYNAMIC),a=new p(0,0,0,t.driverDensity,.001);o.shapes.add(new y(y.box(t.driverW,t.driverH,!0),a,v.Filters.NOTHING)),o.userData.dx=0,o.userData.dy=t.driverDy,n.body=o,o.compound=e;var h=new r(s,o,c.weak(0,t.driverDy),c.weak(),0);h.ignore=!0,h.compound=o.compound,n.weld=h,n.dx=t.driverDx,n.create();var l=g.CarsData.geom[1],f=s.position.x,m=s.position.y,C=w.Materials.DEFAULT,S="driver_shin",A=l[S],E=new P.DriverPartObject;E.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),E.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),E.body.compound=e,E.create(A);var I=new P.DriverPartObject;I.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),I.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),I.body.compound=e,I.create(A),A=l[S="driver_hip"];var M=new P.DriverPartObject;M.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),M.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),M.body.compound=e,M.create(A);var O=new P.DriverPartObject;O.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),O.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),O.body.compound=e,O.create(A),A=l[S="driver_corpse"];var R=new P.DriverPartObject;R.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),R.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),R.body.compound=e,R.create(A),A=l[S="driver_arm"];var B=new P.DriverPartObject;B.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),B.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),B.body.compound=e,B.create(A);var L=new P.DriverPartObject;L.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),L.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),L.body.compound=e,L.create(A),A=l[S="driver_forearm"];var D=new P.DriverPartObject;D.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),D.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),D.body.compound=e,D.create(A);var k=new P.DriverPartObject;k.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),k.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER_PART,C),k.body.compound=e,k.create(A),A=l[S="driver_head"];var F=new P.DriverPartObject;F.graphic=_.GraphicUtil.createImage(f+A.x,m+A.y,A.r,T.AssetsStorage.instance.getByKey(S)),F.body=g.NapeUtil.createRectBodyWH(d.DYNAMIC,v.Filters.DRIVER_PART,!1,A.w,A.h,A.x+f,A.y+m,A.r,b.CbTypes.DRIVER,C),F.body.compound=e,F.create(A);var G=10*x.default.TO_RAD;return E.createJoints(M,l.hip_joint,f,m,G),I.createJoints(O,l.hip_joint,f,m,G),M.createJoints(R,l.corpse_joint,f,m,G),O.createJoints(R,l.corpse_joint,f,m,G),D.createJoints(B,l.forearm_joint,f,m,G),k.createJoints(L,l.forearm_joint,f,m,G),B.createJoints(R,l.arm_joint,f,m,G),L.createJoints(R,l.arm_joint,f,m,G),F.createJoints(R,l.head_joint,f,m,G),n.frameBody=i.body,n.connectArm(D,l.steer_joint,f,m,G),n.connectLeg(E,l.shin_joint,f,m,G),n.parts[0]=F,n.parts[1]=R,n.parts[2]=M,n.parts[3]=E,n.parts[4]=B,n.parts[5]=D,n.parts_mirror[0]=null,n.parts_mirror[1]=null,n.parts_mirror[2]=O,n.parts_mirror[3]=I,n.parts_mirror[4]=L,n.parts_mirror[5]=k,n},t.createFrame=function(e,i,s,n){var o=new g.FrameObject,a=new u(d.DYNAMIC,c.weak(i,s));a.cbTypes.add(b.CbTypes.BODY_COLLIDER);var r,l,f=new p(0,0,0,e.bodyDensity,.001);0===e.bodyMassType?((r=new y(y.box(.5*e.bodyW,e.bodyH,!0),f,v.Filters.NOTHING)).translate(c.weak(-e.wheelBackDx,0)),a.shapes.add(r),(r=new y(y.box(.5*e.bodyW,e.bodyH,!0),f,v.Filters.NOTHING)).translate(c.weak(e.wheelFrontDx,0)),a.shapes.add(r)):a.shapes.add(new y(y.box(e.bodyW,e.bodyH,!0),f,v.Filters.NOTHING)),l=v.Filters.BODY_COLLIDER;var m=g.CarsData.geom[1];if(m){var x=m.points;if(null!==x){for(var P=[],C=x.length,T=0;T<C;T++)P[P.length]=c.weak(x[T].x>>0,x[T].y>>0);var S=new h(P);if(S.isConvex())r=new y(S,w.Materials.WIEGHTLESS,l),S.dispose(),a.shapes.add(r);else{for(S.convexDecomposition(!1,t.polyList),S.dispose();!t.polyList.empty();)S=t.polyList.pop(),r=new y(S,w.Materials.WIEGHTLESS,l),a.shapes.add(r),S.dispose();t.polyList.clear()}}}return a.align(),a.compound=n,a.userData.skinId=e.skinId,o.body=a,o.skinId=e.skinId,o.graphic=_.GraphicUtil.createCarFrameGraphic(e,m),o.create(e),o},t.createCar=function(e,i,s,n,o){var a,r,h=new g.BikeObject,l=t.createFrame(e,i,s,h.compound);h.frame=l,a=t.createWheel(e,h.compound,!0,l.body),h.backWheel=a,a=t.createWheel(e,h.compound,!1,l.body),h.frontWheel=a,h.brakeJoint=a.brakeJoint,e.driverDensity>0&&(r=t.createDriver(e,h.compound,l),h.driver=r),h.backWheel.brakeMaterial=h.backWheel.material.copy(),h.backWheel.brakeMaterial.dynamicFriction=h.backWheel.brakeMaterial.staticFriction=.1*h.backWheel.material.staticFriction;g.Inventory.instance.skin;var u,d=g.CarsData.geom[1];d.suspend_back&&((u=new g.DecorObject(!0)).graphic=_.GraphicUtil.createImage(0,0,0,T.AssetsStorage.instance.getByKey("suspend_back")),h.suspendBack=u,u.type=C.ObjectTypes.CAR,h.suspendBackLocal=c.get(d.suspend_back.x,d.suspend_back.y),h.suspendBackW=d.suspend_back_w),d.suspend_front&&((u=new g.DecorObject(!0)).graphic=_.GraphicUtil.createImage(0,0,0,T.AssetsStorage.instance.getByKey("suspend_front")),h.suspendFront=u,h.suspendFrontAngle=e.axisFrontAngle,u.type=C.ObjectTypes.CAR),h.create(e),h.x=i,h.y=s,h.rotation=0;var p=m.MaxGameCore.instance,f=!1;p.add(h.backWheel),p.add(h.frontWheel);var y=!1;return 5===g.Inventory.instance.skin&&(y=!0,h.suspendFront&&p.add(h.suspendFront),f=!0,h.suspendBack&&p.add(h.suspendBack)),p.add(h.frame),y||h.suspendFront&&p.add(h.suspendFront),f||h.suspendBack&&p.add(h.suspendBack),h.driver&&(p.add(h.driver),h.driver.activateMirrorParts(!0),p.add(h.driver.parts_mirror[4]),p.add(h.driver.parts_mirror[5]),p.add(h.driver.parts_mirror[2]),p.add(h.driver.parts_mirror[3]),h.driver.activateMirrorParts(!1),p.add(h.driver.parts[1]),p.add(h.driver.parts[0]),p.add(h.driver.parts[2]),p.add(h.driver.parts[3]),p.add(h.driver.parts[4]),p.add(h.driver.parts[5]),h.driver.parts_mirror[2].body.userData.handler=h,h.driver.parts_mirror[3].body.userData.handler=h,h.driver.parts_mirror[4].body.userData.handler=h,h.driver.parts_mirror[5].body.userData.handler=h,h.driver.parts[0].body.userData.handler=h,h.driver.parts[1].body.userData.handler=h,h.driver.parts[2].body.userData.handler=h,h.driver.parts[3].body.userData.handler=h,h.driver.parts[4].body.userData.handler=h,h.driver.parts[5].body.userData.handler=h),r&&r.head&&p.add(r.head.trailAnimObject),p.add(h),o||(h.id=g.CarsData.cars.cars.length,g.CarsData.cars.cars.push(h)),h},Object.defineProperty(t,"instance",{get:function(){return null===t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.polyList=new l,t}();e.CarBuilder=S},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.constraint.AngleJoint,o=nape.constraint.PivotJoint,a=nape.constraint.WeldJoint,r=nape.geom.Vec2,h=i(0),l=i(1),c=i(44),u=i(15),d=function(t){function e(){var e=t.call(this)||this;return e.started=!1,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.body.userData.graphicEx=this.graphic,this.type=l.ObjectTypes.CAR,this.body.userData.dx=t.x,this.body.userData.dy=t.y,this.body.userData.dr=t.r,this.compound=this.body.compound,this.pinJoint=new a(this.body,null,r.weak(),r.weak()),this.pinJoint.active=!1,this.pinJoint.compound=this.compound,this.body.userData.driverPart=this,this.effector=new h.BodyEffector(this.body)},e.prototype.pinTo=function(t){if(!this.pinJoint.active){this.pinJoint.body2=t;var e=t.worldPointToLocal(this.body.position);this.pinJoint.anchor2=e,e.dispose(),this.pinJoint.phase=t.rotation-this.body.rotation,this.pinJoint.active=!0}},e.prototype.restart=function(){this.body.allowMovement=this.body.allowRotation=!0,this.trail&&this.trail.init(this.body.position.x,this.body.position.y),this.trailAnimObject&&this.trailAnimObject.graphic.position.set(this.body.position.x,this.body.position.y),this.started=!1},e.prototype.connect=function(t){this.pivotJoint&&(this.pivotJoint.active=t),this.angleJoint&&(this.angleJoint.active=t,t&&(this.angleJointStiff.jointMin=this.basePhase-this.deltaAngle,this.angleJointStiff.jointMax=this.basePhase+this.deltaAngle),this.angleJointStiff.active=t),t&&this.trail&&this.trail.init(this.body.position.x,this.body.position.y),this.trailAnimObject&&(this.trailAnimObject.graphic.visible=t),this.pinJoint.active=!1,this.pinJoint.body2=null},e.prototype.move=function(t,e){this.angleJointStiff.jointMin=this.basePhase-this.deltaAngle+t*e,this.angleJointStiff.jointMax=this.basePhase+this.deltaAngle+t*e,this.angleJoint.jointMin=this.basePhase+t*e,this.angleJoint.jointMax=this.basePhase+t*e},e.prototype.release=function(){this.compound=null,this.pivotJoint&&(this.pivotJoint.body1=null,this.pivotJoint.body2=null,this.pivotJoint.compound=null,this.angleJoint.body1=null,this.angleJoint.body2=null,this.angleJoint.compound=null,this.angleJointStiff.body1=null,this.angleJointStiff.body2=null,this.angleJointStiff.compound=null),u.NapeUtil.disposeJoint(this.pinJoint),this.pinJoint=null,this.trail&&(this.trail=null),this.trailAnimObject&&(this.trailAnimObject=null),this.effector.dispose(),this.effector=null,t.prototype.release.call(this)},e.prototype.createJoints=function(t,e,i,s,a){void 0===a&&(a=0);var h=r.get(i+e.x,s+e.y),l=this.body.worldPointToLocal(h),c=t.body.worldPointToLocal(h);this.pivotJoint=new o(this.body,t.body,l,c),this.pivotJoint.compound=this.body.compound;var u=t.body.rotation-this.body.rotation;this.basePhase=u,this.deltaAngle=a,a>0&&(this.angleJoint=new n(this.body,t.body,u,u,1),this.angleJoint.stiff=!1,this.angleJoint.damping=1,this.angleJoint.frequency=10,this.angleJoint.compound=this.body.compound,this.angleJointStiff=new n(this.body,t.body,u-a,u+a,1),this.angleJointStiff.compound=this.body.compound),l.dispose(),c.dispose(),h.dispose()},e.prototype.disableMuscles=function(){this.angleJoint&&(this.angleJoint.active=!1,this.angleJointStiff.jointMin=this.basePhase-5*this.deltaAngle,this.angleJointStiff.jointMax=this.basePhase+5*this.deltaAngle)},e.prototype.createTrail=function(){this.trail=new c.TrailParticlesSystem,this.trail.init(this.body.position.x,this.body.position.y)},e.prototype.update=function(t){if(this.trailAnimObject){var e=this.trailAnimObject.graphic;e.position.set(this.body.position.x,this.body.position.y);var i=this.body.velocity,s=i.length;if((this.started||s>400)&&(this.started=!0,s>50)){var n=i.angle;n>.25*Math.PI?n=.25*Math.PI:n<-.25*Math.PI&&(n=-.25*Math.PI),e.rotation=n}}this.effector.update(t)},e}(h.GameObject);e.DriverPartObject=d},function(t,e,i){"use strict";e.__esModule=!0;var s=Phaser.Signal,n=i(0),o=i(0),a=i(0),r=i(4),h=i(86),l=i(17),c=i(88),u=function(){function t(){this.complete=new s,this.handlers={}}return t.prototype.start=function(){this.parseParams(),this.parseLayers(),this.buildBg(),r.MaxGameCore.instance.initialDeactivate(),this.complete.dispatch(this)},t.prototype.parseParams=function(){var t=n.RacesData.map.settings;n.RacesData.data.gravityY=t.gravityY,a.MaxPhysics.space.gravity.setxy(0,n.RacesData.data.gravityY),n.RacesData.data.countdown=0},t.prototype.buildBg=function(){var t=new n.BgObject;t.create();var e,i=t.layer0.height;e=a.GraphicUtil.game.width/a.GraphicUtil.game.height>=l.default.WIDTH/l.default.HEIGHT?a.GraphicUtil.game.width/l.default.WIDTH:a.GraphicUtil.game.height/l.default.HEIGHT,t.layer0.scale.set(e),t.layer0.y=i-t.layer0.height,t.layer1W=t.layer0.width,r.MaxGameCore.instance.add(t)},t.prototype.parseLayers=function(){r.MaxGameCore.instance;for(var t=n.RacesData.map.layers,e=t.length,i=0;i<e;i++)this.parseLayer(t[i],i)},t.prototype.parseLayer=function(t,e){if(null!==t)for(var i=t.length,s=0;s<i;s++){var n=t[s],o=this.getObject(n,e);null!==o?(o.create(n),r.MaxGameCore.instance.add(o)):this.parseObject(n),0!=n.className.indexOf("Glass")&&0!=n.className.indexOf("Candy")||(o.graphic.worldRotation=o.graphic.rotation)}},t.prototype.parseObject=function(t){"PlayerWP"===t.className&&n.CarsData.cars.add(t)},t.prototype.getObject=function(t,e){var i=t.className;return i.indexOf("GroundPather")>=0?new n.GroundObject:i.indexOf("BonesPather")>=0?new n.GroundObject:i.indexOf("LandscapeShaper")>=0||i.indexOf("FinishShaper")>=0?new n.ShaperObject:i.indexOf("WaterShaper")>=0?new n.WaterObject:i.indexOf("GeyserE")>=0?new h.GeyserObject:i.indexOf("MoverPather")>=0?new n.MoverPatherObject:i.indexOf("DynamicPather")>=0||i.indexOf("PillarPather")>=0?new n.PlankObject:0===i.indexOf("Glass")?new n.GlassBlock:"TiltZone"===i||"BrakeZone"===i?new n.WaypointObject:"Dec2_1"===i?new n.DecorMultiObject(e<=1):0===i.indexOf("Dec")||0===i.indexOf("Sign")||0===i.indexOf("Pillar")?null!==t.params.id&&t.params.id>=0?new o.DecorActObject(e<=1):new o.DecorObject(e<=1):"BarrelE"===i||0===i.indexOf("Plank")?new o.DynamicBodyObject:0===i.indexOf("VecDec_")?new o.VectorDecor:"SphereE"===i?new c.SphereObject:"ToggleE"===i?new o.ToggleObject:"BoostE"===i?new o.BoostObject:"SafePointE"===i?new o.SafePointObject:"MotorJointE"===i?new o.MotorObject:"PivotJointE"===i?new o.PivotObject:"CameraZoneE"===i?new a.CameraZone:"SpikesE"===i?new a.SpikesObject:0===i.indexOf("Removed")?new a.RemovedBodyObjects:0===i.indexOf("Tnt")?new a.TntObject:"FinishZone"===i?new a.FinishObject:i.indexOf("Ball")>=0?new o.DynamicBodyObject:null},t.prototype.dispose=function(){this.complete.removeAll()},t}();e.RaceBuilder=u},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(5),r=i(10),h=i(7),l=i(1),c=i(6),u=i(8),d=i(2),p=i(87),f=function(t){function e(){var i=t.call(this)||this;return i.parts=new Array(e.PART_COUNT),i.id=-1,i.safeId=-1,i}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=l.ObjectTypes.OBJECT;var e=t.params,i=e.x,s=e.y;null!=e.id&&(this.id=e.id),null!=e.safeId&&(this.safeId=e.id),this.emitCounter=0,this.emitRate=null==e.rate?1:e.rate,this.body=o.NapeUtil.createRectBodyWH(n.STATIC,h.Filters.SENSOR,!0,e.width,e.height,i,s,c.default.TO_RAD*e.rotation,r.CbTypes.GEYSER,u.Materials.DEFAULT),this.width=e.width;var p=this.body.rotation,f=t.params.speed;this.velX=f*Math.cos(p),this.velY=f*Math.sin(p);var y=a.GraphicUtil.game.add.group();this.graphic=y;var g=d.AssetsStorage.instance;this.partPos=0,this.partMinX=-.5*this.width+16,this.partDeltaX=32;var m=a.GraphicUtil.game.add.sprite(0,0,a.GraphicUtil.currentAtlass,"GeyserBase0000");m.x=-.5*this.width,m.anchor.set(.7,.5),y.addChild(m),this.anim=a.GraphicUtil.createMovieClip(null,g.getByKey("geyser_anim"),15,!0),this.anim=a.GraphicUtil.game.add.sprite(0,0,a.GraphicUtil.currentAtlass,"geyser_anim0000"),this.anim.animations.add("geyser_anim",Phaser.Animation.generateFrameNames("geyser_anim",0,5,"",4)),this.anim.anchor.set(-.1,.5),this.anim.animations.getAnimation("geyser_anim").play(30,!0),this.anim.x=m.x,y.addChild(this.anim),this.createBoostParts(1e3,this.width/f),this.partMinY=-.5*e.height,this.partDeltaY=e.height,this.body.userData.handler=this,this.activate(this.id<0),y.x=this.body.position.x,y.y=this.body.position.y,y.rotation=c.default.TO_RAD*e.rotation},e.prototype.createBoostParts=function(t,i){for(var s=0;s<e.PART_COUNT;s++){var n=new p.GeyserPartClip(t,i);this.parts[s]=n,this.graphic.addChild(n)}},e.prototype.emit=function(t){if(void 0===t&&(t=1),this.partPos>=0)for(;t>0;){var i=this.parts[this.partPos],s=this.partMinX+Math.random()*this.partDeltaX,n=this.partMinY+Math.random()*this.partDeltaY;i.emit(s,n),this.partPos++,this.partPos>=e.PART_COUNT&&(this.partPos=0),t--}},e.prototype.update=function(t){if(void 0===t&&(t=0),this.active){this.emitCounter+=this.emitRate;var i=this.emitCounter>>0;if(this.emit(i),this.emitCounter-=i,this.partPos>=0)for(var s=0;s<e.PART_COUNT;s++){this.parts[s].update(t)}}},e.prototype.release=function(){for(var i=0;i<e.PART_COUNT;i++){var s=this.parts[i];s.parent&&s.parent.removeChild(s)}this.parts.splice(0,this.parts.length),this.partPos=-1,t.prototype.release.call(this)},e.prototype.activate=function(t){if(void 0===t&&(t=!0),this.active=t,!this.active)for(var i=0;i<e.PART_COUNT;i++){this.parts[i].visible=!1}},e.prototype.isActive=function(){return!0},e.prototype.restart=function(){this.review()},e.prototype.review=function(){this.id>=0&&this.activate(!1)},e.PART_COUNT=60,e}(o.GameObject);e.GeyserObject=f},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=function(t){function e(e,i){var s=t.call(this,n.GraphicUtil.game,0,0,n.GraphicUtil.currentAtlass,"particle_boost0000")||this;return s.scaleSpeed=4,s.alphaSpeed=1,s.velocity=e,s.alphaSpeed=.9/i,s.scaleSpeed=1.5/i,s.ttl=i,s.anchor.set(.5),s.visible=!1,s}return s(e,t),e.prototype.update=function(t){void 0===t&&(t=0),this.visible&&(this.x+=this.velX*t,this.scale.x-=this.scaleSpeed*t,this.timer+=t,this.timer>=this.ttl&&(this.visible=!1))},e.prototype.emit=function(t,e){this.visible=!0,this.timer=0,this.x=t,this.y=e,this.velX=this.velocity*(.95+.1*Math.random()),this.scale.x=2,this.alpha=1},e}(Phaser.Sprite);e.GeyserPartClip=o},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.constraint.LineJoint,o=nape.constraint.DistanceJoint,a=nape.phys.Material,r=nape.phys.BodyType,h=nape.geom.Vec2,l=i(0),c=i(1),u=i(6),d=i(8),p=i(7),f=i(5),y=i(2),g=i(30),m=function(t){function e(){var e=t.call(this)||this;return e.id=-1,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.space=g.NapePhysics.space,this.type=c.ObjectTypes.OBJECT,null!=t.params.id&&(this.id=t.params.id);var e=y.AssetsStorage.instance,i=t.className,s=e.getByKey(i+"_data"),m=t.params,v=m.x,b=m.y,x=m.len,_=b+x;b=_-m.pos*x;var w,P=m.rotation*u.default.TO_RAD,C=null==m.scale?1:m.scale,T=p.Filters.GROUND,S=f.GraphicUtil.createImageWithObj(m,i);this.graphic=S,this.graphic.y=b,S.scale.set(C),S.anchor.set(.5,.5),w=1!=m.density?new a(m.density):d.Materials.DEFAULT,this.body=l.NapeUtil.createCircleBody(r.DYNAMIC,T,!1,.5*s.w*C,v,b,P,null,w),this.body.allowRotation=!1,l.NapeUtil.setupStartPos(this.body),this.body.userData.graphicEx=this.graphic,this.lineJoint=new n(this.space.world,this.body,h.weak(v,_),h.weak(),h.weak(0,-1),0,x),this.distanceJoint=new o(this.space.world,this.body,h.weak(v,_+m.dySpring),h.weak(),m.lenSpring,m.lenSpring),this.distanceJoint.damping=m.damp,this.distanceJoint.frequency=m.freq,this.distanceJoint.stiff=!1,this.lineJoint.space=this.distanceJoint.space=this.space,0==t.params.active?this.activeOnStart=!1:this.activeOnStart=!0},e.prototype.activate=function(t){var e,i;if(void 0===t&&(t=!0),t)for(this.body.space=this.space,e=this.body.constraints.iterator();e.hasNext();)(i=e.next()).active=!0;else{for(e=this.body.constraints.iterator();e.hasNext();)(i=e.next()).active=!1,i.userData.skipActive=!0;this.body.space=null}},e.prototype.isActive=function(){return this.activeOnStart},e.prototype.restart=function(){l.NapeUtil.stopBody(this.body),l.NapeUtil.resetStartPos(this.body),this.activeOnStart||(this.graphic.x=this.body.position.x,this.graphic.y=this.body.position.y,this.graphic.rotation=this.body.rotation,this.activate(!1))},e.prototype.review=function(){this.restart()},e.prototype.release=function(){t.prototype.release.call(this),l.NapeUtil.disposeJoint(this.lineJoint),l.NapeUtil.disposeJoint(this.distanceJoint),this.lineJoint=null,this.distanceJoint=null,this.space=null},e}(l.GameObject);e.SphereObject=m},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(46),o=Phaser.Image,a=i(0),r=i(5),h=i(3),l=i(2),c=function(t){function e(e,i){var s=t.call(this,r.GraphicUtil.game,0,0)||this;s.parts=[],s.parts2=[],s.inputEnabled=!1,s.skinId=a.Inventory.instance.skin;var n=l.AssetsStorage.instance,c="bike_"+a.Inventory.instance.skin+"_base";return s.image=new o(s.game,0,0,h.Atlases.Cars,c+"0000"),s.image.anchor.set(l.AssetsList.FRAMES_ANCHORX[s.skinId-1],l.AssetsList.FRAMES_ANCHORY[s.skinId-1]),s.addChild(s.image),s.explodedImage=r.GraphicUtil.createImage(0,0,0,n.getByKey("Car"+s.skinId.toString()+"FrameExploded")),s.explodedImage.visible=!1,s.addChild(s.explodedImage),s.boostAnim=r.GraphicUtil.createMovieClip(null,"RocketAnim",30,!0),s.boostAnim.x=-28,s.boostAnim.y=-10,s.boostAnim.animations.play("RocketAnim",30,!0),s.addChildAt(s.boostAnim,0),s}return s(e,t),e.prototype.update2=function(t){for(var i=0;i<e.PART_COUNT;i++)this.parts[i].update2(t)},e.prototype.createSmokeParts=function(){for(var t=0;t<e.PART_COUNT;t++){var i=new n.SmokePartClip;this.parts[t]=i,this.parent.addChild(i)}this.partPos=0},e.prototype.emitSmoke=function(t,i,s){this.parts[this.partPos].emit(t,i,s),++this.partPos>=e.PART_COUNT&&(this.partPos=0)},e.PART_COUNT=60,e}(Phaser.Sprite);e.FrameGraphic=c},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(2),a=function(t){function e(){var e=t.call(this,n.GraphicUtil.game,0,0)||this;o.AssetsStorage.instance.getByKey("Car4TrailPart");return e}return s(e,t),e}(Phaser.Sprite);e.TrailPart=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(47),o=i(0),a=i(3),r=function(t){function e(e,i){var s=t.call(this,o.GraphicUtil.game,0,0,a.Atlases.Cars,"Wheel_"+o.Inventory.instance.skin+"_"+e.wheels.toString()+"0000")||this;return s.parts=[],s.anchor.set(.5),s}return s(e,t),e.prototype.createGroundParts=function(){for(var t=0;t<e.PART_COUNT;t++){var i=new n.GroundPartClip;this.parts[t]=i,this.parent.addChild(i)}this.partPos=0},e.prototype.emitGround=function(t,i,s,n){var o=this.parts[this.partPos],a=e.PART_SPEED+e.PART_DELTA*Math.random(),r=Math.random()*e.ANGLE_DELTA;r=n?s-r:s+r;var h=2*Math.PI*Math.random();o.emit(t+8*Math.cos(h),i+8*Math.cos(h),a*Math.cos(r),a*Math.sin(r)),this.partPos++,this.partPos>=e.PART_COUNT&&(this.partPos=0),this.hasParts=!0},e.prototype.update2=function(t){if(this.hasParts){this.hasParts=!1;for(var i=0;i<e.PART_COUNT;i++){var s=this.parts[i];s.update2(t),s.anim.isPlaying&&(this.hasParts=!0)}}},e.prototype.restart=function(){if(this.hasParts){for(var t=0;t<e.PART_COUNT;t++)this.parts[t].visible=!1;this.hasParts=!1}},e.PART_COUNT=60,e.PART_SPEED=128,e.PART_DELTA=64,e.ANGLE_DELTA=.1*Math.PI,e}(Phaser.Sprite);e.WheelGraphic=r},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){return function(){}}();e.BgEl=s},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=function(t){function e(e,i,s){var o=t.call(this,n.GraphicUtil.game)||this;return o.x=e.params.x-i,o.y=e.params.y-s,o}return s(e,t),e.prototype.dispose=function(){this.destroy()},e}(Phaser.Group);e.LandscapeShape=o},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(48),o=nape.geom.Vec2,a=i(0),r=i(37),h=i(9),l=i(3),c=function(t){function e(){var e=t.call(this)||this;return e.MIN_AC_BR_TIME=1,e.MAX_VEL_TIME=2,e.maxVelTimer=0,e}return s(e,t),e.prototype.restart=function(){this.suspendBack&&(this.suspendBack.graphic.visible=!0),this.suspendFront&&(this.suspendFront.graphic.visible=!0),this.accelWithBrakeTimer=0,this.maxVelTimer=0,this.exploded=!1,t.prototype.restart.call(this)},e.prototype.applyDrive=function(t,e,i){var s=this.controller.accell,n=this.controller.brake;this.accell=this.controller.accell;var o,a=this.accelTorque,r=this.maxAngularVel;if(this.deltaTorque>0&&s){var h=this.speed/this.wheelRadius;if(h<r){var l,c=.5+2.5*h/r;l=(1/(c*c)-1/9)/(4-1/9),a=this.accelTorque+l*this.deltaTorque}}s&&n?this.accelWithBrakeTimer+=t:(this.accelWithBrakeTimer>this.MIN_AC_BR_TIME&&(this.maxVelTimer=this.MAX_VEL_TIME),this.accelWithBrakeTimer=0),this.brakePart=this.accelWithBrakeTimer/this.MIN_AC_BR_TIME,this.brakePart>1&&(this.brakePart=1),n?(o=this.frontWheel.body,Math.abs(o.angularVel)<1&&(this.brakeJoint.jointMin=this.brakeJoint.jointMax=o.rotation-this.frame.body.rotation,this.brakeJoint.active=!0),o.angularVel*=.25,this.backWheel.brake(!0),s||(this.backWheel.body.angularVel=0)):(this.brakeJoint.active=!1,this.backWheel.brake(!1)),s?(o=this.backWheel.body,this.maxVelTimer>0?(o.angularVel<1.2*r&&o.applyAngularImpulse(1.5*t*a),this.maxVelTimer-=t):(o.angularVel<0&&(o.angularVel*=.5),o.angularVel<r&&o.applyAngularImpulse(t*a))):this.maxVelTimer=0},e.prototype.explode=function(){if(!this.exploded){var t;this.suspendBack&&(this.suspendBack.graphic.visible=!1),this.suspendFront&&(this.suspendFront.graphic.visible=!1),this.exploded=!0,(t=this.backWheel.body.position.sub(this.frame.body.position)).normalise(),t.muleq(500),this.backWheel.connect(!1),this.backWheel.body.velocity.addeq(t),t.dispose(),(t=this.frontWheel.body.position.sub(this.frame.body.position)).normalise(),t.muleq(500),this.frontWheel.connect(!1),this.frontWheel.body.velocity.addeq(t),t.dispose(),t=o.fromPolar(100,-.5*Math.PI),this.frame.body.velocity.addeq(t),t.dispose(),r.CarExplodeObject.get().activate(this.frame.body.position.x,this.frame.body.position.y),a.RacesData.data.camera.shake(),h.default.getInstance().play(l.Sounds.Explode2);var e=this.frame.graphic;e.image.visible=!1,e.explodedImage.visible=!0}},e.prototype.processDriverSpikes=function(){this.driver.pricessSpikes()},e.prototype.processDriverGround=function(){this.dead||(this._drive=!1,this.dead=!0,this.driver.connectDriver(!1),this.driver.disableMuscle(),this.driver.activateMirrorParts(!0),this.applyTilt(0,0),this.callbackDie&&this.callbackDie.call(this.callbackContext))},e.prototype.review=function(){this.suspendBack&&(this.suspendBack.graphic.visible=!0),this.suspendFront&&(this.suspendFront.graphic.visible=!0),this.exploded=!1,this.brakeJoint&&(this.brakeJoint.active=!1);var e=this.frame.graphic;e.image.visible=!0,e.explodedImage.visible=!1,t.prototype.review.call(this)},e}(n.CarObject);e.BikeObject=c},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(1),r=i(4),h=i(5),l=i(8),c=i(7),u=i(2),d=function(t){function e(){var e=t.call(this)||this;return e.type=a.ObjectTypes.CAR,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null);var e=t;this.space=r.MaxGameCore.instance.getSpace(),this.graphic=h.GraphicUtil.createImageWithObj(null,u.AssetsStorage.instance.getByKey("car_corpse"+e.skinId.toString())),this.body=o.NapeUtil.createPolyBody(u.AssetsStorage.instance.getByKey("car_corpse_points"+e.skinId.toString()),l.Materials.DEFAULT,c.Filters.WITH_EARTH_ONLY,n.DYNAMIC),this.restart()},e.prototype.activate=function(t,e,i,s){this.body.position.set(t),this.body.rotation=e,this.body.velocity.set(i),this.body.angularVel=s,this.graphic.visible=!0,this.body.space=this.space},e.prototype.restart=function(){this.deactivate()},e.prototype.release=function(){t.prototype.release.call(this)},e.prototype.deactivate=function(){this.graphic.visible=!1,this.body.space=null},e}(o.GameObject);e.CorpseObject=d},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.constraint.AngleJoint,o=nape.constraint.PivotJoint,a=nape.geom.Vec2,r=i(0),h=i(6),l=i(15),c=i(9),u=i(3),d=function(t){function e(){var e=t.call(this)||this;return e.parts=[],e.parts_mirror=[],e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null)},e.prototype.move=function(t,e){var i=this.dx*t;this.body.shapes.at(0).localCOM.x=i,this.parts[3].move(e,30*h.default.TO_RAD),this.parts[2].move(e,-45*h.default.TO_RAD),this.parts[4].move(e,-45*h.default.TO_RAD);var s=15*e*h.default.TO_RAD;this.angleJointLegStiff.jointMin=this.basePhaseLeg-this.deltaAngleLeg+s,this.angleJointLegStiff.jointMax=this.basePhaseLeg+this.deltaAngleLeg+s,this.angleJointLeg.jointMin=this.basePhaseLeg+s,this.angleJointLeg.jointMax=this.basePhaseLeg+s},e.prototype.release=function(){this.frameBody=null,this.head=null,this.pivotJointArm.body1=null,this.pivotJointArm.body2=null,this.pivotJointArm.compound=null,this.angleJointArm.body1=null,this.angleJointArm.body2=null,this.angleJointArm.compound=null,this.angleJointArmStiff.body1=null,this.angleJointArmStiff.body2=null,this.angleJointArmStiff.compound=null,this.pivotJointLeg.body1=null,this.pivotJointLeg.body2=null,this.pivotJointLeg.compound=null,this.angleJointLeg.body1=null,this.angleJointLeg.body2=null,this.angleJointLeg.compound=null,this.angleJointLegStiff.body1=null,this.angleJointLegStiff.body2=null,this.angleJointLegStiff.compound=null,this.weld.active=!1,this.weld.compound=null,this.weld.body1=null,this.weld.body2=null,this.weld=null,t.prototype.release.call(this)},e.prototype.restart=function(){this.spiked=!1},e.prototype.connect=function(t){this.weld.active=t;for(var e=0;e<this.parts.length;e++)this.parts[e].connect(t)},e.prototype.stop=function(){l.NapeUtil.stopBody(this.body);for(var t=0;t<this.parts.length;t++){var e=this.parts[t];l.NapeUtil.stopBody(e.body)}},e.prototype.review=function(t){this.spiked=!1,this.move(0,0),this.body.position.x=t.x+this.body.userData.dx,this.body.position.y=t.y+this.body.userData.dy,this.body.rotation=0;for(var e=0;e<this.parts.length;e++){var i=this.parts[e].body;i.position.x=t.x+i.userData.dx,i.position.y=t.y+i.userData.dy,i.rotation=i.userData.dr,i.allowMovement=i.allowRotation=!0,this.parts_mirror[e]&&((i=this.parts_mirror[e].body).allowMovement=i.allowRotation=!0)}},e.prototype.disableMuscle=function(){for(var t=this.parts.length,e=0;e<t;e++)this.parts[e].disableMuscles()},e.prototype.activateMirrorParts=function(t){for(var e=this.parts.length,i=0;i<e;i++){var s=this.parts[i],n=this.parts_mirror[i];n&&(t&&(l.NapeUtil.stopBody(n.body),n.body.position.set(s.body.position),n.body.rotation=s.body.rotation),n.body.compound=t?n.compound:null,n.connect(t),n.graphic.visible=t)}},e.prototype.connectArm=function(t,e,i,s,r){var h=a.get(i+e.x,s+e.y),l=this.frameBody.worldPointToLocal(h),c=t.body.worldPointToLocal(h);this.pivotJointArm=new o(this.frameBody,t.body,l,c),this.pivotJointArm.compound=this.frameBody.compound;var u=t.body.rotation-this.frameBody.rotation;this.basePhaseArm=u,this.angleJointArm=new n(this.frameBody,t.body,u,u,1),this.angleJointArm.stiff=!1,this.angleJointArm.damping=50,this.angleJointArm.frequency=50,this.angleJointArm.compound=this.frameBody.compound,this.deltaAngleArm=r,this.angleJointArmStiff=new n(this.frameBody,t.body,u-r,u+r,1),this.angleJointArmStiff.compound=this.frameBody.compound,l.dispose(),c.dispose(),h.dispose()},e.prototype.connectLeg=function(t,e,i,s,r){var h=a.get(i+e.x,s+e.y),l=this.frameBody.worldPointToLocal(h),c=t.body.worldPointToLocal(h);this.pivotJointLeg=new o(this.frameBody,t.body,l,c),this.pivotJointLeg.compound=this.frameBody.compound;var u=t.body.rotation-this.frameBody.rotation;this.basePhaseLeg=u,this.angleJointLeg=new n(this.frameBody,t.body,u,u,1),this.angleJointLeg.stiff=!1,this.angleJointLeg.damping=100,this.angleJointLeg.frequency=50,this.angleJointLeg.compound=this.frameBody.compound,this.deltaAngleLeg=r,this.angleJointLegStiff=new n(this.frameBody,t.body,u-r,u+r,1),this.angleJointLegStiff.compound=this.frameBody.compound,l.dispose(),c.dispose(),h.dispose()},e.prototype.connectDriver=function(t){this.pivotJointArm&&(this.pivotJointArm.active=t),this.angleJointArm&&(this.angleJointArm.active=t),this.angleJointArmStiff&&(this.angleJointArmStiff.active=t),this.pivotJointLeg&&(this.pivotJointLeg.active=t),this.angleJointLeg&&(this.angleJointLeg.active=t),this.angleJointLegStiff&&(this.angleJointLegStiff.active=t)},e.prototype.pricessSpikes=function(){this.spiked||(this.spiked=!0,c.default.getInstance().play(u.Sounds.DriverSpikes))},e}(r.GameObject);e.DriverObject=d},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.geom.Ray,o=nape.geom.Vec2,a=i(0),r=i(15),h=i(4),l=function(t){function e(){var e=t.call(this)||this;return e.END_GROUND_COLLISION_DELAY=.1,e.maxFlipVel=3,e.fire=null,e.type=a.ObjectTypes.CAR,e}return s(e,t),e.prototype.create=function(e){void 0===e&&(e=null),t.prototype.create.call(this,e),this.space=h.MaxGameCore.instance.getSpace();var i=e;this.wheelBackDx=i.wheelBackDx,this.wheelFrontDx=i.wheelFrontDx,this.wheelDy=Math.max(i.axisBackY+i.axisBackLen+i.wheelBackR,i.axisFrontY+i.axisFrontLen+i.wheelFrontR),this.ray=new n(o.weak(),o.weak(0,1)),r.NapeUtil.setupStartPos(this.body),this.localSmokePos=o.get(-43,-16),this.localFirePos=o.get(5,-55),this.effector=new a.BodyEffector(this.body),this.restart()},e.prototype.update=function(t){void 0===t&&(t=0);for(var e=!1,i=this.body.arbiters.iterator();i.hasNext();){var s=i.next();if(s.isCollisionArbiter()&&(s.body1===this.body?s.body2:s.body1).userData.isGround){e=!0;break}}e?(this.endGroundCollisionDelay=0,this.hasGround=!0):this.hasGround&&0===this.endGroundCollisionDelay&&(this.endGroundCollisionDelay=this.END_GROUND_COLLISION_DELAY),this.hasGround&&this.endGroundCollisionDelay>0&&(this.endGroundCollisionDelay-=t,this.endGroundCollisionDelay<=0&&(this.hasGround=!1)),this.graphic.update(t),this.effector.update(t)},e.prototype.restart=function(){r.NapeUtil.stopBody(this.body),r.NapeUtil.resetStartPos(this.body),r.NapeUtil.clearUserData(this.body),r.NapeUtil.setupStartPos(this.body),this.effector.reset(),this.body.userData.reviewX=this.body.position.x,this.body.userData.reviewY=this.body.position.y},e.prototype.release=function(){this.localSmokePos.dispose(),this.localSmokePos=null,this.localFirePos=null,r.NapeUtil.disposeBody(this.body),this.body=null,this.effector.dispose(),this.effector=null,t.prototype.release.call(this)},e.prototype.review=function(){this.body.position.setxy(this.body.userData.reviewX,this.body.userData.reviewY),this.body.rotation=0},e}(a.GameObject);e.FrameObject=l},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.geom.Vec2,o=i(1),a=i(0),r=i(15),h=function(t){function e(){var e=t.call(this)||this;return e.type=o.ObjectTypes.CAR_PART,e}return s(e,t),e.prototype.restart=function(){this.timer=0,this.hide()},e.prototype.create=function(t){void 0===t&&(t=null),this.space=this.body.space,this.localPos=t,this.body.userData.graphicEx=this.graphic,this.restart()},e.prototype.put=function(t){var i=t.localPointToWorld(this.localPos,!1);this.body.position.set(i),i.dispose(),this.body.rotation=t.rotation%(2*Math.PI);var s=-.25*Math.PI-.5*Math.PI*Math.random();this.localPos.x>0?s+=.25*Math.PI:s-=.25*Math.PI;var o=n.fromPolar(250,s);o.addeq(t.velocity),this.body.velocity.set(o),o.dispose(),this.body.angularVel=2*Math.random()-1,this.body.space=this.space,this.graphic.visible=!0,this.graphic.position.set(this.body.position.x,this.body.position.y),this.graphic.rotation=this.body.rotation,this.timer=e.LIFE_TIME},e.prototype.hide=function(){this.body.space=null,this.graphic.visible=!1},e.prototype.release=function(){this.localPos=null,this.body.space=null,this.space=null,r.NapeUtil.disposeBody(this.body),this.body=null},e.prototype.update=function(t){void 0===t&&(t=0),this.timer>0&&(this.timer-=t,this.timer<=0&&(a.RaceCamera.inCamera(this.graphic.x,this.graphic.y,32)?this.timer=e.LIFE_TIME:this.hide()))},e.LIFE_TIME=2,e}(a.GameObject);e.PartObject=h},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(1),a=i(15),r=function(t){function e(){var e=t.call(this)||this;return e.landFlyTime=0,e.DISABLECCD_OFF_TIME=.25,e.DISABLECCD_ON_TIME=.05,e.hasGround=!1,e.endGroundCollisionDelay=0,e.END_GROUND_COLLISION_DELAY=.25,e.START_SPIN_FRICTION=.01,e.START_SPIN_DELAY=1,e.SMOKE_INIT_DELTA=250,e.isPlayer=!0,e.braked=!1,e.type=o.ObjectTypes.CAR,e}return s(e,t),e.prototype.create=function(e){void 0===e&&(e=null),t.prototype.create.call(this,e),this.friction=this.material.dynamicFriction,this.circle=this.body.shapes.at(0),this.radius=this.circle.radius,a.NapeUtil.setupStartPos(this.body),this.freq=this.distanceJoint.frequency,this.jointMax=this.distanceJoint.jointMax,this.jointMin=this.distanceJoint.jointMin,this.lineMax=this.lineJoint.jointMax,this.effector=new n.BodyEffector(this.body),this.restart()},e.prototype.restart=function(){this.body.constraints.length>0&&(this.body.constraints.at(0).active=!1,this.body.constraints.at(1).active=!1),this.flyTime=0,this.material.staticFriction=this.material.dynamicFriction=this.friction,this.body.disableCCD=!0,this.disableOnDelay=0,this.startSpinDelay=0,a.NapeUtil.stopBody(this.body),a.NapeUtil.resetStartPos(this.body),this.body.constraints.length>0&&(this.body.constraints.at(0).active=!0,this.body.constraints.at(1).active=!0),this.brakeJoint&&(this.brakeJoint.active=!1),this.trail&&this.trail.init(this.body.position.x,this.body.position.y),this.effector.reset()},e.prototype.release=function(){this.lineJoint.compound=null,this.lineJoint.body1=null,this.lineJoint.body2=null,this.lineJoint=null,this.distanceJoint.compound=null,this.distanceJoint.body1=null,this.distanceJoint.body2=null,this.distanceJoint=null,a.NapeUtil.disposeBody(this.body),this.body=null,this.circle=null,this.trail=null,this.effector.dispose(),this.effector=null,t.prototype.release.call(this)},e.prototype.update=function(t){void 0===t&&(t=0),this.startSpinDelay>0&&(this.startSpinDelay-=t,this.startSpinDelay<=0?this.material.staticFriction=this.material.dynamicFriction=this.friction:this.startSpinDelay<.5*this.START_SPIN_DELAY&&(this.material.staticFriction=this.START_SPIN_FRICTION+(this.friction-this.START_SPIN_FRICTION)*(.5*this.START_SPIN_DELAY-this.startSpinDelay)/(.5*this.START_SPIN_DELAY),this.material.dynamicFriction=this.material.staticFriction));for(var e,i=!1,s=this.body.arbiters.iterator(),n=0,o=0;s.hasNext();){var a=s.next();if(a.isCollisionArbiter()&&(a.body1===this.body?a.body2:a.body1).userData.isGround){i=!0;var r=a.collisionArbiter.contacts.at(0).position;n=r.x,o=r.y,e=a.collisionArbiter.normal.angle,a.body1===this.body&&(e+=Math.PI);break}}if(i&&this.graphic&&this.isPlayer&&4!==this.skinId){var h=this.body.velocity.length,l=this.body.angularVel*this.radius;Math.abs(l)-Math.abs(h)>this.SMOKE_INIT_DELTA&&(this.graphic.emitGround(n,o,e,l>0),this.graphic.emitGround(n,o,e,l>0),this.graphic.emitGround(n,o,e,l>0))}i?(this.endGroundCollisionDelay=0,this.hasGround=!0,this.landFlyTime=this.flyTime,this.flyTime=0):this.hasGround&&0===this.endGroundCollisionDelay&&(this.endGroundCollisionDelay=this.END_GROUND_COLLISION_DELAY),this.hasGround?(this.disableOnDelay>0&&(this.disableOnDelay-=t,this.disableOnDelay<=0&&(this.disableOnDelay=0,this.body.disableCCD=!0)),this.endGroundCollisionDelay>0&&(this.endGroundCollisionDelay-=t,this.endGroundCollisionDelay<=0&&(this.hasGround=!1))):(this.flyTime+=t,this.flyTime>this.DISABLECCD_OFF_TIME&&(0===this.disableOnDelay&&(this.body.disableCCD=!1),this.disableOnDelay=this.DISABLECCD_ON_TIME)),this.isPlayer&&this.graphic.update2(t),this.trail&&this.trail.emit(this.body.position.x,this.body.position.y),this.effector.update(t)},e.prototype.startSpin=function(){this.distanceJoint.frequency=this.freq,this.startSpinDelay=this.START_SPIN_DELAY},e.prototype.brake=function(t){t?this.braked||(this.circle.material=this.brakeMaterial,this.body.shapes.remove(this.circle),this.body.shapes.add(this.circle)):this.braked&&(this.circle.material=this.material,this.body.shapes.remove(this.circle),this.body.shapes.add(this.circle)),this.braked=t},e.prototype.connect=function(t){this.body.constraints.length>1&&(this.body.constraints.at(0).active=t,this.body.constraints.at(1).active=t),t&&this.trail&&this.trail.init(this.body.position.x,this.body.position.y)},e}(n.GameObject);e.WheelObject=r},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(1),a=i(2),r=i(31),h=function(t){function e(){var e=t.call(this)||this;return e.PART_1=-.2,e.PART_2=-.4,e.wasStarted=!1,e.type=o.ObjectTypes.BG,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null);var e=a.AssetsStorage.instance;this.graphic=n.GraphicUtil.game.add.group();var i=new a.SpriteData(e.getByKey("Bg0"));this.layer0=i.bitmapData,this.graphic.addChild(this.layer0);var s=null;(i=new a.SpriteData(e.getByKey("Bg2")))&&(this.layer2=i.bitmapData,this.layer2W=i.rect.width,this.layer2Rect=i.rect.clone(this.layer2Rect),this.graphic.addChild(this.layer2),(s=i.bitmapData).x=this.layer2Rect.width-1,this.layer2.addChild(s),(s=i.bitmapData).x=2*(this.layer2Rect.width-1),this.layer2.addChild(s),(s=i.bitmapData).x=3*(this.layer2Rect.width-1),this.layer2.addChild(s),(s=i.bitmapData).x=4*(this.layer2Rect.width-1),this.layer2.addChild(s),(s=i.bitmapData).x=5*(this.layer2Rect.width-1),this.layer2.addChild(s),this.layer2.y=135),this.startDx=Math.random()*this.layer2W},e.prototype.update=function(t){var e;void 0===t&&(t=0),this.wasStarted?e=this.prevViewX+(n.RacesData.TARGET_X-this.prevTargetX)*r.RaceCamera.scale:(e=n.RacesData.TARGET_X+this.startDx,this.wasStarted=!0),this.prevViewX=e,this.prevTargetX=n.RacesData.TARGET_X,this.layer1&&this.updateLayer(e,this.PART_1,this.layer1,this.layer1W),this.layer2&&this.updateLayer(e,this.PART_2,this.layer2,this.layer2W)},e.prototype.updateLayer=function(t,e,i,s){var n=-t*e%s;i.x=-n},e.prototype.restart=function(){this.wasStarted=!1},e}(n.GameObject);e.BgObject=h},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e.prototype.create=function(e){void 0===e&&(e=null),this.id=e.params.id,t.prototype.create.call(this,e)},e.prototype.activate=function(t){void 0===t&&(t=!0),this.graphic.visible=!t},e.prototype.isActive=function(){return!0},e}(i(49).DecorObject);e.DecorActObject=n},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(1),a=function(t){function e(e){var i=t.call(this)||this;return i.type=e?o.ObjectTypes.LANDSCAPE:o.ObjectTypes.FRONT,i}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null);var e=t.className;2===n.RacesData.map.settings.theme&&(this.type=o.ObjectTypes.LANDSCAPE_BACK);var i=e.indexOf("_dup");i>=0&&(e=e.substring(0,i));var s=n.GraphicUtil.game.add.group();s.x=t.params.x,s.y=t.params.y,isNaN(t.params.scaleX)||(s.scale.x=t.params.scaleX),isNaN(t.params.scaleY)||(s.scale.y=t.params.scaleY),s.rotation=t.params.rotation,this.graphic=s},e}(n.GameObject);e.DecorMultiObject=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null)},e}(i(0).GameObject);e.VectorDecor=n},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(1),a=i(5),r=i(4),h=i(2),l=function(t){function e(){var e=t.call(this)||this;return e.create(),e}return s(e,t),e.get=function(){return e.pool.length>0?e.pool.pop():new e},e.prototype.create=function(t){void 0===t&&(t=null),this.type=o.ObjectTypes.EFFECT,this.graphic=a.GraphicUtil.createMovieClip(null,h.AssetsStorage.instance.getByKey("glass_exp_anim"),30,!1),this.graphic.completeCallback=this.animComplete,this.graphic.scaleX=this.graphic.scaleY=2,this.graphic.visible=!1,r.MaxGameCore.instance.add(this)},e.prototype.animComplete=function(t){this.active=!1,this.graphic.visible=!1,null!=this.completeCallback&&(this.completeCallback(),this.completeCallback=null),e.pool[e.pool.length]=this},e.prototype.activate=function(t,e,i){void 0===i&&(i=null),this.active=!0,this.graphic.x=t,this.graphic.y=e,this.graphic.visible=!0,this.completeCallback=i},e.prototype.restart=function(){this.active&&(this.graphic.visible=!1,this.active=!1,this.completeCallback=null,e.pool[e.pool.length]=this)},e.prototype.update=function(t){void 0===t&&(t=0),this.active&&this.graphic.update(t)},e.prototype.release=function(){this.completeCallback=null,t.prototype.release.call(this)},e.pool=[],e}(n.GameObject);e.GlassExplodeObject=l},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(50),o=nape.geom.Vec2,a=nape.phys.BodyType,r=i(0),h=i(4),l=i(5),c=i(10),u=i(7),d=i(16),p=i(1),f=i(6),y=i(8),g=i(2),m=i(9),v=i(3),b=function(t){function e(){var e=t.call(this)||this;return e.switchOffDelay=0,e.isCrashed=!1,e}return s(e,t),e.getParts=function(){var t=e.pool[e.poolPos];return e.poolPos++,e.poolPos>=e.POOL_SIZE&&(e.poolPos=0),t},e.prototype.create=function(t){void 0===t&&(t=null),this.step=d.default.STEP,this.type=p.ObjectTypes.OBJECT,this.space=h.MaxGameCore.instance.getSpace();var e=t.params;this.safeId=e.safeId,this.ttl=e.ttl;var i=g.AssetsStorage.instance;this.className=t.className;var s=i.getByKey(this.className+"_data"),n=e.x,o=e.y,m=t.params.rotation*f.default.TO_RAD,v=u.Filters.GROUND;this.bodyW=s.w,this.bodyHHalf=.5*s.h,this.body=r.NapeUtil.createRectBodyWH(a.STATIC,v,!1,s.w,s.h,n,o,m,null,y.Materials.DEFAULT),this.body.cbTypes.add(c.CbTypes.GLASS),this.body.cbTypes.add(c.CbTypes.GROUND),this.body.userData.collideCallback=this.processCollide,this.body.userData.collideCallbackContext=this;var b=l.GraphicUtil.createImageWithObj(e,this.className);this.graphic=b,this.className.indexOf("Crashed")>=0&&(this.createParts(this.className),this.isCrashed=!0,this.partScale="GlassCrashed0"===this.className?1:.5),this.counter=0},e.prototype.createParts=function(t){if(null==e.pool){e.pool=[];for(var i=0;i<e.POOL_SIZE;i++){for(var s=[],o=0;o<e.VECTOR_SIZE;o++){var a=new n.GlassBlockPart(o,"GlassCrashed0_");a.create(),h.MaxGameCore.instance.add(a),a.restart(),s[o]=a}e.pool[i]=s}}},e.prototype.update=function(t){void 0===t&&(t=0),this.counter<10&&this.counter++,this.switchOffDelay>0&&(this.switchOffDelay-=t,this.switchOffDelay<=0&&this.switchOff())},e.prototype.restart=function(){this.switchOffDelay=0,this.collided=!1,this.body.space=this.space,this.graphic.visible=!0,this.graphic.alpha=1,this.graphic.scale.x=1,this.graphic.scale.y=1},e.prototype.release=function(){this.space=null,this.clearPool(),t.prototype.release.call(this)},e.prototype.clearPool=function(){if(null!==e.pool){for(var t=0;t<e.pool.length;t++)e.pool[t].splice(0,e.pool[t].length),e.pool[t]=null;e.pool.splice(0,e.pool.length),e.pool=null}},e.prototype.review=function(){this.restart()},e.prototype.switchOff=function(){this.body.space=null,this.graphic.visible=!1,this.isCrashed&&this.crashGlass()},e.prototype.processCollide=function(t,i){i.collided||(i.collided=!0,i.isCrashed?(i.collidePos=t.copy(),i.explodeX=i.collidePos.x,i.explodeY=i.collidePos.y+i.bodyHHalf,i.switchOffDelay=i.ttl):i.ttl>e.ANIM_TIME||i.startAnim(i))},e.prototype.startAnim=function(t){t.isCrashed},e.prototype.crashGlass=function(){if(r.RaceCamera.inCamera(this.explodeX,this.explodeY,256)){var t=(new Date).getTime();t-e.lastCrashTime>e.MIN_CRASH_DELTA&&(e.lastCrashTime=t,m.default.getInstance().play(v.Sounds.GlassCrash))}var i=e.getParts(),s=i.length,n=o.get();n.setxy(-.25*this.bodyW+.5*Math.random()*this.bodyW,this.bodyHHalf);var a=this.collidePos;a.y+=2*this.bodyHHalf;for(var h=e.PARTS_DATA[this.className],l=this.body.rotation,c=0;c<s;c++){var u=i[c];n.setxy(h[c].x,h[c].y);var d=this.body.localPointToWorld(n);u.activate(d,l,this.partScale);var p=o.get(u.body.position.x+.5*Math.random()-a.x,u.body.position.y-a.y);p.normalise(),p.length=5,d.dispose(),u.body.applyImpulse(p,a),p.dispose()}n.dispose(),a.dispose()},e.lastCrashTime=0,e.MIN_CRASH_DELTA=200,e.PARTS_DATA={GlassCrashed0:[{x:-47,y:-6},{x:-35,y:2},{x:13,y:2},{x:48,y:2},{x:47,y:-4},{x:4,y:-4}],GlassCrashed1:[{x:-23,y:-6},{x:-17,y:2},{x:7,y:2},{x:25,y:2},{x:24,y:-4},{x:3,y:-4}]},e.POOL_SIZE=10,e.VECTOR_SIZE=6,e.poolPos=0,e.ANIM_TIME=.6,e}(r.GameObject);e.GlassBlock=b},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=Phaser.Point,o=i(0),a=i(1),r=i(6),h=i(51),l=i(5),c=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null);var e=t.params,i=t.className.indexOf("BonesPather")>=0,s=!1;i&&(s=!0===e.isPillar)&&(e.physic=!1);var c=o.RacesData.map.settings.theme;if(3===e.lineId&&0===c?this.type=a.ObjectTypes.FRONT:3===e.lineId&&1===c?this.type=a.ObjectTypes.OBJECT:this.type=a.ObjectTypes.LANDSCAPE,0!==e.rotation){var u=r.default.normalizeVertices(t);t=u,e=u.params}var d=e.vertices,p=d.length,f=e.x,y=e.y;(i&&!s||!0===e.physic)&&(this.body=h.PhysicUtil.createGroundBody(t)),!0===e.physic&&(this.body=h.PhysicUtil.createGroundBody(t));var g,m,v,b,x=[],_=0;for(b=0;b<p;b++){g=d[b],0===b&&(m=g.x,v=g.y);var w=new n(g.x-m,g.y-v);x.push(w),w.y>_&&(_=w.y)}if(f+=m,y+=v,i&&(e.shape=!1,e.line=!0,e.lineId=13),!0!==e.shape&&!0!==e.line||(this.graphic=l.GraphicUtil.createGround(f,y,x,e.line,e.shape,_,e.lineId)),!0===e.camera){p=x.length;var P=e.cameraOffsetY;for(b=0;b<p;b++)x[b].x+=f,x[b].y+=y+P;o.CameraPathes.instance.addPathByPoints(x)}},e}(o.GameObject);e.GroundObject=c},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(1),a=i(6),r=i(4),h=i(8),l=i(7),c=i(10),u=i(5),d=i(11),p=i(2),f=function(t){function e(){var e=t.call(this)||this;return e.id=-1,e}return s(e,t),e.prototype.activate=function(t,e){t&&(this.graphic.visible=!1)},e.prototype.isActive=function(){return!0},e.prototype.create=function(t){void 0===t&&(t=null),this.type=o.ObjectTypes.LANDSCAPE,this.space=r.MaxGameCore.instance.getSpace();var e=t.params;if(this.safeId=e.safeId,null!=e.id&&(this.id=e.id,this.id),0!==e.rotation){var i=a.default.normalizeVertices(t);t=i,e=i.params}var s,f=e.vertices,y=f.length;if(0!==e.rotation){var g=a.default.TO_RAD*e.rotation;for(s=0;s<y;s++){var m=f[s].x,v=f[s].y;if(0===m&&0===v);else{var b=Math.atan2(v,m),x=Math.sqrt(m*m+v*v);b+=g,f[s].x=Math.cos(b)*x,f[s].y=Math.sin(b)*x}}}var _=e.type,w=0,P=0;if(e.physic){var C=t.params.shapeH;4!==_&&5!==_&&6!==_||(e.shapeH=20,C=20),this.body=3===_||7===_?n.NapeUtil.createPatherBody(t,h.Materials.GROUND,l.Filters.NOTHING,C):n.NapeUtil.createPatherBody(t,h.Materials.GROUND,l.Filters.GROUND,C),4===_||5===_?this.body.cbTypes.add(c.CbTypes.SPIKES):this.body.cbTypes.add(c.CbTypes.GROUND),this.body.userData.isGround=!0,this.body.space=this.space,w=e.x-this.body.position.x,P=e.y-this.body.position.y}var T=t.className.indexOf("PillarPather")>=0,S=null,A=!1;if(T||e.graphic){var E=null;if(T?S="pillar_line"+_.toString():1===_?E="CandyPather":5==_?(E="line_spike",A=!0):6==_?E="line_wood_pather_pool":8==_?E="line_tube_bot":9==_?E="line_tube_top":10==_?E="line_tube_blick":S=4===_||5===_||6===_?"road_line9":"road_line"+(_+5).toString(),null==E&&(E=p.AssetsStorage.instance.getByKey(S)),E){var I=u.GraphicUtil.game.add.group();I.inputEnableChildren=!1,y=f.length;var M=[];for(s=0;s<y;s++)M[M.length]=new d.Point(f[s].x+w,f[s].y+P),T&&(0===s&&Math.atan2(f[s+1].y-f[s].y,f[s+1].x-f[s].x),s===y-2&&Math.atan2(f[s+1].y-f[s].y,f[s+1].x-f[s].x));A?n.Drawing.drawBitmapPath2(E,I,M):n.Drawing.drawBitmapPath(E,I,M),this.body?(I.x=this.body.position.x,I.y=this.body.position.y):(I.x=e.x,I.y=e.y),this.graphic=I}}this.body&&this.body.isDynamic()&&(n.NapeUtil.setupStartPos(this.body),this.body.userData.graphic=this.graphic)},e.prototype.restart=function(){this.body&&this.body.isDynamic()&&(n.NapeUtil.stopBody(this.body),n.NapeUtil.resetStartPos(this.body)),this.graphic&&(this.graphic.visible=!0)},e.prototype.release=function(){this.space=null,t.prototype.release.call(this)},e.prototype.review=function(){this.restart()},e}(n.GameObject);e.PlankObject=f},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.constraint.PivotJoint,o=nape.geom.Vec2,a=nape.phys.BodyType,r=i(0),h=i(1),l=i(6),c=i(4),u=i(8),d=i(7),p=i(10),f=i(5),y=function(t){function e(){var e=t.call(this)||this;return e.id=-1,e.removeOnToogle=!0,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.space=c.MaxGameCore.instance.getSpace();var e=t.params,i=e.layer,s=t.className.indexOf("Finish")>=0;this.type=s||1===i||7===i?h.ObjectTypes.LANDSCAPE_SHAPE:h.ObjectTypes.LANDSCAPE,s||(this.id=e.id,this.safeId=e.safeId,this.safeId<=-10&&(this.skipRevive=!0),null!==e.rem&&!1===e.rem&&(this.removeOnToogle=!1)),this.isStatic=s||e.isStatic;var n=e.x,y=e.y;if(s||!0===e.physic){var g=void 0;s?g=u.Materials.DEFAULT:1===e.density?g=u.Materials.GROUND:(g=u.Materials.GROUND.copy()).density=e.density;var m;if(m=s?d.Filters.SENSOR:!0===e.plr?d.Filters.PLAYER_ONLY:!0===e.ignore?d.Filters.NOTHING:d.Filters.GROUND,this.body=r.NapeUtil.createPolyBody(e,g,m,this.isStatic?a.STATIC:a.DYNAMIC),this.body.userData.isGround=!0,s){for(var v=this.body.shapes.iterator();v.hasNext();)v.next().sensorEnabled=!0;this.body.cbTypes.add(p.CbTypes.ZONE_FINISH)}else this.body.cbTypes.add(p.CbTypes.GROUND),3===i&&this.body.cbTypes.add(p.CbTypes.SAW),9===i&&this.body.cbTypes.add(p.CbTypes.SPIKES);this.body.align(),!0===e.isWheel&&(this.body.userData.isWheel=!0),this.body.space=this.space}if(s||!0===e.graphic){var b=0,x=0;this.body&&(b=-this.body.position.x+n,x=-this.body.position.y+y);var _=f.GraphicUtil.createLandscapeShape(t,b,x,s);this.graphic=_}if(this.body){if(0!==e.rotation){this.body.isDynamic()||(this.body.space=null);var w=o.get(n,y);this.body.rotate(w,l.default.TO_RAD*e.rotation),w.dispose(),this.body.isDynamic()||(this.body.space=this.space)}this.graphic&&(this.graphic.x=this.body.position.x,this.graphic.y=this.body.position.y,this.graphic,r.LandscapeShape,this.graphic.rotation=this.body.rotation),this.body.space=c.MaxGameCore.instance.getSpace()}else this.graphic.rotation=l.default.TO_RAD*e.rotation;this.body&&!this.isStatic&&(r.NapeUtil.setupStartPos(this.body),this.graphic instanceof r.LandscapeShape?this.body.userData.graphic=this.graphic:this.body.userData.graphicEx=this.graphic),this.removeOnToogle||this.id>=0&&this.activate(!1)},e.prototype.release=function(){if(e.textures){for(var i in e.textures)e.textures[i]&&(e.textures[i]=null);e.textures=null}this.space=null,t.prototype.release.call(this)},e.prototype.activate=function(t){if(void 0===t&&(t=!0),this.removeOnToogle){if(this.graphic&&(this.graphic.visible=!1),this.body){for(var e=this.body.constraints.iterator();e.hasNext();){var i=e.next();i instanceof n&&(i.active=!1)}this.body.space=null}}else this.body&&this.body.constraints.length<=0&&(this.body.space=t?this.space:null)},e.prototype.restart=function(){var t,e;if(this.removeOnToogle){if(this.graphic&&(this.graphic.visible=!0),this.body)for(this.body.space=this.space,t=this.body.constraints.iterator();t.hasNext();)(e=t.next())instanceof n&&(e.active=!0)}else this.id>=0&&this.activate(!1);this.body&&!this.isStatic&&(r.NapeUtil.stopBody(this.body),r.NapeUtil.resetStartPos(this.body))},e.prototype.review=function(){this.skipRevive&&this.body&&this.body.isKinematic()||this.restart()},e.prototype.isActive=function(){return!0},e}(r.GameObject);e.ShaperObject=y},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.geom.Vec2,o=nape.phys.BodyType,a=i(0),r=i(6),h=i(1),l=i(10),c=i(7),u=i(8),d=i(4),p=i(110),f=function(t){function e(){var e=t.call(this)||this;return e.id=-1,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=h.ObjectTypes.LANDSCAPE;var e=t.params;this.id=e.id;var i,s=e.x,f=e.y;i=u.Materials.GROUND;var y=0,g=0,m=c.Filters.WATER;if(this.id>-10&&(this.body=a.NapeUtil.createPolyBody(e,i,m,o.STATIC),this.body.cbTypes.add(l.CbTypes.WATER),3===e.layer&&this.body.cbTypes.add(l.CbTypes.SAW),this.body.align(),this.body&&(y=-this.body.position.x+s,g=-this.body.position.y+f)),this.graphic=new p.WaterShape(t,y,g),this.body){if(0!==e.rotation){var v=n.get(s,f);this.body.rotate(v,r.default.TO_RAD*e.rotation),v.dispose()}this.graphic&&(this.graphic.x=this.body.position.x,this.graphic.y=this.body.position.y,this.graphic instanceof a.LandscapeShape?this.graphic.rotation=r.default.TO_DEG*this.body.rotation:this.graphic.rotation=this.body.rotation),this.body.space=d.MaxGameCore.instance.getSpace();for(var b=0;b<this.body.shapes.length;b++){var x=this.body.shapes.at(b);x.fluidProperties.viscosity=t.params.viscosity,x.fluidProperties.density=t.params.density,x.fluidEnabled=!0}}},e.prototype.release=function(){this.bgShape&&this.bgShape.dispose(),this.bgShape=null,t.prototype.release.call(this)},e.prototype.update=function(t){void 0===t&&(t=0),this.active&&this.graphic.update(t)},e.prototype.activate=function(t){void 0===t&&(t=!0),this.active=t},e.prototype.isActive=function(){return!1},e}(a.GameObject);e.WaterObject=f},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=function(t){function e(e,i,s,o){void 0===o&&(o=!1);var a=t.call(this,n.GraphicUtil.game)||this;return a.WAVE_SPEED=50,a.waveX=0,a.isBg=o,a.x=e.params.x-i,a.y=e.params.y-s,a.vertices=e.params.vertices,a.dx=i,a.dy=s,a.draw(),a}return s(e,t),e.prototype.draw=function(){var t=this;t.clear();t.lineStyle(2,12575231),t.beginFill(34815,.4);var e,i=this.vertices[0];t.moveTo(i.x+this.dx,i.y+this.dy+0);var s=this.vertices[1].x-this.vertices[0].x,n=this.vertices[0].x,o=this.vertices[0].y,a=s/16>>0,r=s/a;for(e=0;e<a;e++){var h=(e+1)*r;t.lineTo(n+h+this.dx,o+4*Math.sin(.05*(this.waveX+h))+this.dy)}for(a=this.vertices.length,e=2;e<a;e++)i=this.vertices[e],t.lineTo(i.x+this.dx,i.y+this.dy);t.endFill()},e.prototype.update2=function(t){this.waveX+=t*this.WAVE_SPEED,this.draw()},e.prototype.dispose=function(){this.vertices=null},e}(Phaser.Graphics);e.WaterShape=o},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(1),r=i(7),h=i(5),l=i(10),c=function(t){function e(){var e=t.call(this)||this;return e.collided=!1,e}return s(e,t),e.prototype.create=function(e){void 0===e&&(e=null),this.safeId=e.params.safeId,this.type=a.ObjectTypes.OBJECT,t.prototype.create.call(this,e);var i=e.params;this.body=o.NapeUtil.createCircleBody(n.STATIC,r.Filters.SENSOR,!0,32,i.x,i.y,0,l.CbTypes.BOOST),this.clip=h.GraphicUtil.createMovieClip(i,"BoostAnim",15,!0),this.clip.animations.play("boost_anim",30,!0),this.graphic=this.clip,this.body.userData.collideCallback=this.processCollide,this.body.userData.collideCallbackContext=this,this.body.userData.time=i.time,this.body.userData.force=i.force,this.collided=!1},e.prototype.processCollide=function(t){return!t.collided&&(t.collided=!0,t.body.space=null,t.graphic.visible=!1,!0)},e.prototype.restart=function(){this.collided=!1,this.graphic.visible=!0,this.body.space=o.NapePhysics.space},e.prototype.review=function(){this.restart()},e.prototype.release=function(){t.prototype.release.call(this)},e.prototype.update=function(t){void 0===t&&(t=0)},e}(o.GameObject);e.BoostObject=c},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(1),r=i(7),h=i(10),l=i(8),c=i(11),u=function(t){function e(){var e=t.call(this)||this;return e.type=a.ObjectTypes.LANDSCAPE,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.body=o.NapeUtil.createRectBody(n.STATIC,r.Filters.SENSOR,!0,t.params,h.CbTypes.ZONE_FINISH,l.Materials.DEFAULT);var e=o.GraphicUtil.createGround(0,0,[new c.Point(-.5*t.params.width,-.5*t.params.height),new c.Point(.5*t.params.width,-.5*t.params.height),new c.Point(.5*t.params.width,.5*t.params.height),new c.Point(-.5*t.params.width,.5*t.params.height)],!1,!0,0,100);e.x=t.params.x,e.y=t.params.y,this.graphic=e,o.RacesData.data.finishX=t.params.x},e}(o.GameObject);e.FinishObject=u},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.constraint.MotorJoint,o=nape.constraint.PivotJoint,a=nape.constraint.WeldJoint,r=nape.geom.Vec2,h=i(0),l=i(1),c=i(4),u=i(10),d=i(5),p=i(6),f=i(2),y=function(t){function e(){var e=t.call(this)||this;return e.isDynamic=!1,e}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=l.ObjectTypes.OBJECT,this.time=t.params.time,this.space=c.MaxGameCore.instance.getSpace(),this.id=t.params.id,this.safeId=t.params.safeId,this.safeId<=-10&&(this.skipRevive=!0);var e=r.get(t.params.x,t.params.y);this.x=t.params.x,this.y=t.params.y;for(var i,s=h.NapeUtil.bodiesUnderPoint(this.space,e);!s.empty()&&!(i=s.pop()).isDynamic();)i=null;if(i){s=h.NapeUtil.bodiesUnderPoint(this.space,e);for(var y=void 0;!s.empty()&&((y=s.pop())===i||y.cbTypes.has(u.CbTypes.TOGGLE));)y=null;y||(y=this.space.world),(y.isDynamic()||i.isDynamic())&&(this.isDynamic=!0);var g=void 0;y.userData.isWheel&&(g=y,y=i,i=g);var m=i.worldPointToLocal(e),v=y.worldPointToLocal(e);this.pivot=new o(y,i,v,m),this.pivot.ignore=!0,this.pivot.space=this.space,this.motor=new n(y,i,t.params.rate*p.default.TO_RAD),this.motor.active=!1,this.motor.userData.id=this.id,this.motor.ignore=!0,this.motor.space=this.space,m.dispose(),v.dispose(),t.params.graphic>0&&(this.graphic=d.GraphicUtil.createImageWithObj(t.params,f.AssetsStorage.instance.getByKey("Motor"+(t.params.graphic-1).toString())),this.graphicRot=0),this.useWeldJoint=!0===t.params.useWeld,this.useWeldJoint?(this.phaseBase=this.pivot.body2.rotation-this.pivot.body1.rotation,this.weldJoint=new a(this.pivot.body1,this.pivot.body2,this.pivot.anchor1,this.pivot.anchor2,this.phaseBase),this.weldJoint.ignore=!0,this.weldJoint.space=this.space):i.allowRotation=!1}this.snd=!0===t.params.snd,e.dispose()},e.prototype.activate=function(t){if(void 0===t&&(t=!0),t){if(this.active)return;this.motor&&(this.useWeldJoint?this.weldJoint.active=!1:this.motor.body2.allowRotation=!0,this.motor.active=t,this.timer=this.time,this.active=!0)}else{var e=this.motor.body2;this.motor.active=!1,e.angularVel=0,this.useWeldJoint?(this.weldJoint.phase=this.weldJoint.body2.rotation-this.weldJoint.body1.rotation,this.weldJoint.active=!0):e.allowRotation=!1}},e.prototype.restart=function(){this.motor&&(this.motor.space=null,this.motor.space=this.space,this.pivot.space=null,this.pivot.space=this.space,this.motor.active=!1,this.useWeldJoint?(this.weldJoint.active=!1,this.weldJoint.phase=this.phaseBase,this.weldJoint.active=!0):this.motor.body2.allowRotation=!1),this.active=!1},e.prototype.release=function(){this.pivot&&(this.pivot.body1=null,this.pivot.body2=null,this.pivot.space=null,this.motor.body1=null,this.motor.body2=null,this.motor.space=null),this.useWeldJoint&&(this.weldJoint.body1=null,this.weldJoint.body2=null,this.weldJoint.space=null),this.space=null,t.prototype.release.call(this)},e.prototype.update=function(t){void 0===t&&(t=0);var e=this.motor.body2;if(this.active&&(this.timer>0&&(this.graphic&&(this.graphicRot+=t*this.motor.rate,this.graphic.rotation=this.graphicRot%(2*Math.PI)),this.timer>0&&(this.timer-=t,this.timer<=0&&(this.motor.active=!1,e.angularVel=0,this.useWeldJoint?(this.weldJoint.phase=this.weldJoint.body2.rotation-this.weldJoint.body1.rotation,this.weldJoint.active=!0):e.allowRotation=!1))),this.graphic&&this.isDynamic)){var i=e.localPointToWorld(this.pivot.anchor2,!1);this.graphic.x=i.x,this.graphic.y=i.y,i.dispose()}},e.prototype.review=function(){this.skipRevive||this.restart()},e.prototype.isActive=function(){return!0},e}(h.GameObject);e.MotorObject=y},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.geom.Vec2,o=nape.phys.Body,a=nape.phys.BodyType,r=nape.shape.Circle,h=i(0),l=i(4),c=i(8),u=i(7),d=i(6),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cpId=-1,e.accelDist=0,e.accel=0,e.breaked=!1,e.dir=1,e.prevDir=1,e}return s(e,t),e.prototype.switchOn=function(t){this.active&&(this.stopOnPoint||this.stopOnEnd)||(this.dir+=t,this.active=0!==this.dir,this.active?this.checkChangePointDir():(this.body.velocity.x=0,this.body.velocity.y=0,this.updateBodyGraphic()))},e.prototype.switchOff=function(t){if(this.stopOnEnd||this.stopOnPoint){if(0!==this.dir)return;this.dir+=t,this.active=0!==this.dir,this.active?this.checkChangePointDir():(this.body.velocity.x=0,this.body.velocity.y=0,this.updateBodyGraphic())}else this.dir-=t,this.active=0!==this.dir,this.active?this.checkChangePointDir():(this.body.velocity.x=0,this.body.velocity.y=0,this.updateBodyGraphic())},e.prototype.checkChangePointDir=function(){this.dir*this.prevDir<0&&(this.pointDir*=-1,this.velocity.muleq(-1),this.timeToPoint=this.timeToPointTotal-this.timeToPoint),this.prevDir=this.dir},e.prototype.release=function(){this.velocity.dispose(),this.velocity=null,this.body=null,t.prototype.release.call(this)},e.prototype.restart=function(){this.startTime=this.baseStartTime,this.active=this.baseActive,this.angleSpeed=0,this.baseActive?this.dir=1:this.dir=0,this.pointId=0,this.pointDir=1,null!=this.body.userData.graphic&&(this.body.userData.graphic.visible=!0),this.body.space=this.space;for(var t=0,e=!1,i=0;i<this.points.length;i++)if(i>0){var s=this.points[i].sub(this.points[i-1]),n=s.length;if(t+=n,!e&&t>=this.position){this.pointId=i-1;var o=1-(t-this.position)/n;this.body.position.x=this.points[i-1].x+o*(this.points[i].x-this.points[i-1].x),this.body.position.y=this.points[i-1].y+o*(this.points[i].y-this.points[i-1].y),this.calcVel(),e=!0}s.dispose()}this.breaked=!1,this.body.type=a.KINEMATIC,this.body.allowRotation=!1,this.updateBodyGraphic()},e.prototype.create=function(t){void 0===t&&(t=null),this.space=l.MaxGameCore.instance.getSpace(),this.id=t.params.id,this.safeId=t.params.safeId;var e=null;if(t.params.body)this.body=new o(a.KINEMATIC,n.weak()),this.body.shapes.add(new r(16,null,c.Materials.DEFAULT,u.Filters.NOTHING)),this.body.space=this.space;else{for(var i=n.get(t.params.x,t.params.y),s=h.NapeUtil.bodiesUnderPoint(this.space,i);!s.empty()&&!(e=s.pop()).isDynamic();)e=null;e&&(this.body=e,e.type=a.KINEMATIC,h.NapeUtil.stopBody(e)),i.dispose()}this.speed=this.baseSpeed=t.params.speed,this.accelDist=null===t.params.accelDist?0:t.params.accelDist,this.accelDist>0&&(this.minSpeed=.05*this.baseSpeed,this.accel=(this.baseSpeed*this.baseSpeed-this.minSpeed*this.minSpeed)/(2*this.accelDist)),this.cycle=1===t.params.cycle,this.active=this.baseActive=1===t.params.active,this.startTime=this.baseStartTime=t.params.startTime,this.sideWait=t.params.sideWait?t.params.sideWait:0,this.sideAngle=t.params.sideAngle?t.params.sideAngle*d.default.TO_RAD:0,this.cpId=t.params.cpId,this.body.userData.correct=!0,this.space=this.body.space,this.baseRot=this.body.rotation,this.stopOnEnd=!0===t.params.stopOnEnd,this.stopOnPoint=!0===t.params.stopOnPoint,this.baseActive?this.dir=1:this.dir=0,this.pointId=0,this.pointDir=1;var p=t.params.vertices;this.points=new Array(p.length),this.position=t.params.position,this.velocity=n.get();for(var f=0,y=!1,g=0;g<this.points.length;g++)if(this.points[g]=n.get(t.params.x+p[g].x,t.params.y+p[g].y),g>0){var m=this.points[g].sub(this.points[g-1]),v=m.length;if(f+=v,!y&&f>=this.position){this.pointId=g-1;var b=1-(f-this.position)/v;this.body.position.x=this.points[g-1].x+b*(this.points[g].x-this.points[g-1].x),this.body.position.y=this.points[g-1].y+b*(this.points[g].y-this.points[g-1].y),this.calcVel(),y=!0}m.dispose()}this.totalLength=f,this.body.userData.handler=this,this.body.userData.hasMover=!0},e.prototype.calcVel=function(){var t=this.body.position,e=this.getNextPoint().sub(t,!0),i=e.angle;this.velocity.x=Math.cos(i)*this.speed,this.velocity.y=Math.sin(i)*this.speed;var s=e.length;this.timeToPointTotal=this.timeToPoint=s/this.speed},e.prototype.calcAccelVel=function(t){var e,i=0;if(this.pointDir>0){for(e=1;e<=this.pointId;e++)i+=n.distance(this.points[e-1],this.points[e]);i+=n.distance(this.points[this.pointId],this.body.position)}else{for(e=this.points.length-2;e>=this.pointId;e--)i+=n.distance(this.points[e+1],this.points[e]);i+=n.distance(this.points[this.pointId],this.body.position),i=this.totalLength-i}i<this.accelDist?this.speed=this.minSpeed+i/this.accelDist*(this.baseSpeed-this.minSpeed):i>this.totalLength-this.accelDist?this.speed=this.minSpeed+(this.totalLength-i)/this.accelDist*(this.baseSpeed-this.minSpeed):this.speed=this.baseSpeed;var s=this.body.position,o=this.getNextPoint().sub(s,!0),a=o.angle;this.velocity.x=Math.cos(a)*this.speed,this.velocity.y=Math.sin(a)*this.speed;var r=o.length;this.timeToPointTotal=this.timeToPoint=r/this.speed},e.prototype.getNextPoint=function(){return this.pointDir>0?this.pointId>=this.points.length-1?this.points[0]:this.points[this.pointId+1]:this.pointId<=0?this.points[this.points.length-1]:this.points[this.pointId-1]},e.prototype.update=function(t){void 0===t&&(t=0),this.breaked||(this.active?(!0===this.body.userData.skipMove?this.body.velocity.x=this.body.velocity.y=0:this.startTime>0?(this.body.velocity.x=this.body.velocity.y=0,this.startTime-=t,this.startTime<=0?0!==this.sideAngle&&0!==this.angleSpeed&&(this.angleSpeed=0,this.body.rotation=this.sideTarget):0!==this.sideAngle&&0!==this.angleSpeed&&(this.body.rotation+=this.angleSpeed*t)):(this.timeToPoint>0?this.accelDist>0&&this.calcAccelVel(t):(this.pointId+=this.pointDir,0===this.pointId||this.pointId===this.points.length-1?(this.sideWait>0&&(this.startTime=this.sideWait,0!==this.sideAngle&&(0===this.pointId?(this.sideTarget=this.baseRot,this.angleSpeed=-this.sideAngle/this.sideWait):(this.sideTarget=this.baseRot+this.sideAngle,this.angleSpeed=this.sideAngle/this.sideWait))),this.cycle||(this.pointDir*=-1),this.stopOnEnd&&(this.active=!1,this.dir=0,null!==this.body&&this.body.position.set(this.points[this.pointId]))):(this.pointId<0||this.pointId>this.points.length-1)&&(this.pointDir>0?this.pointId=0:this.pointId=this.points.length-1),this.accelDist>0?this.calcAccelVel(t):this.calcVel(),this.stopOnPoint&&(this.active=!1)),this.active?(this.body.velocity.x=this.velocity.x,this.body.velocity.y=this.velocity.y):(this.body.velocity.x=0,this.body.velocity.y=0),this.timeToPoint-=t),this.updateBodyGraphic()):(this.body.allowMovement=!1,this.body.velocity.x=0,this.body.velocity.y=0))},e.prototype.updateBodyGraphic=function(){var t=this.body.userData.graphic;null!=t?(t.x=this.body.position.x,t.y=this.body.position.y,t.rotation=this.body.rotation):null!=(t=this.body.userData.graphicEx)&&(t.x=this.body.position.x,t.y=this.body.position.y,t.rotation=this.body.rotation)},e.prototype.review=function(){this.restart()},e.prototype.activate=function(t){void 0===t&&(t=!0),t?this.switchOn(1):this.switchOff(1)},e.prototype.isActive=function(){return!0},e}(h.GameObject);e.MoverPatherObject=p},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.constraint.PivotJoint,o=nape.geom.Vec2,a=i(0),r=i(4),h=i(5),l=i(2),c=i(1),u=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=c.ObjectTypes.OBJECT,this.space=r.MaxGameCore.instance.getSpace();var e=t.params;this.id=e.id,this.safeId=e.safeId;for(var i=o.get(e.x,e.y),s=a.NapeUtil.bodiesUnderPoint(this.space,i),u=null,d=null;!s.empty();){var p=s.pop();if(p.isDynamic()){if(null===u)u=p;else if(!0!==u.userData.isPT&&!0===p.userData.isPT)d=u,u=p;else if(null===d){if(!0===(d=p).userData.isPT)break}else if(!0!==d.userData.isPT&&!0===p.userData.isPT){d=p;break}}else null===d&&(d=p)}if(u){null===d&&(d=this.space.world);var f=u.worldPointToLocal(i),y=d.worldPointToLocal(i);this.pivot=new n(u,d,f,y),this.pivot.ignore=!0,this.pivot.space=this.space,f.dispose(),y.dispose();var g=null===e.graphic?0:e.graphic;if(g>0){var m=l.AssetsStorage.instance,v="Pivot"+(g-1).toString();this.graphic=h.GraphicUtil.createImageWithObj(e,m.getByKey(v)),this.graphic&&(this.isDynamic=!(u.isStatic()||d.isStatic()),this.body2=d)}}i.dispose()},e.prototype.activate=function(t){void 0===t&&(t=!0),this.active||(this.pivot.active=!1,this.active=!0)},e.prototype.restart=function(){this.pivot&&(this.pivot.space=null,this.pivot.space=this.space,!0!==this.pivot.userData.skipActive&&(this.pivot.active=!0)),this.active=!1},e.prototype.release=function(){this.pivot&&(this.pivot.body1=null,this.pivot.body2=null,this.pivot.space=null),this.body2=null,this.space=null,t.prototype.release.call(this)},e.prototype.review=function(){this.restart()},e.prototype.isActive=function(){return!0},e.prototype.update=function(t){if(void 0===t&&(t=0),this.isDynamic){var e=this.body2.localPointToWorld(this.pivot.anchor2,!1);this.graphic.x=e.x,this.graphic.y=e.y,e.dispose()}},e}(a.GameObject);e.PivotObject=u},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(52),o=i(4),a=function(t){function e(){var e=t.call(this)||this;return e.INIT_TIME=1,e.REMOVE_TIME=1,e.initTimer=0,e}return s(e,t),e.prototype.create=function(e){void 0===e&&(e=null),t.prototype.create.call(this,e),this.space=o.MaxGameCore.instance.getSpace(),this.initTimer=this.INIT_TIME},e.prototype.update=function(t){void 0===t&&(t=0),this.active?this.timer>0&&(this.timer-=t,this.timer<=0?(this.body.space=null,this.graphic.visible=!1):this.timer<.5*this.REMOVE_TIME&&(this.graphic.alpha=this.timer/(.5*this.REMOVE_TIME))):this.initTimer>0?this.initTimer-=t:this.body.velocity.length>100&&(this.active=!0,this.timer=this.REMOVE_TIME)},e.prototype.activate=function(e){void 0===e&&(e=!0),this.active||t.prototype.activate.call(this,e)},e.prototype.restart=function(){this.initTimer=this.INIT_TIME,this.active=!1,this.graphic.alpha=1,this.graphic.visible=!0,this.body.space=this.space,t.prototype.restart.call(this)},e.prototype.release=function(){this.space=null,t.prototype.release.call(this)},e}(n.DynamicBodyObject);e.RemovedBodyObjects=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(1),r=i(7),h=i(5),l=i(10),c=i(8),u=i(9),d=i(24),p=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=a.ObjectTypes.OBJECT,this.body=o.NapeUtil.createRectBody(n.STATIC,r.Filters.SENSOR,!0,t.params,l.CbTypes.SAFE_POINT,c.Materials.DEFAULT),this.body.userData.id=t.params.id,this.body.userData.collideCallback=this.processCollide,this.body.userData.collideCallbackContext=this,this.graphic=h.GraphicUtil.createMovieClip(t.params,"SafePointAnim")},e.prototype.processCollide=function(t){t.active||(t.active=!0,u.default.getInstance().play(d.default.SavePoint),t.graphic.animations.getAnimation("SafePointAnim").play(30,!1))},e.prototype.restart=function(){this.active=!1;var t=this.graphic.animations.getAnimation("SafePointAnim");t.play(30,!1,!1),t.frame=0,t.restart(),t.stop()},e}(o.GameObject);e.SafePointObject=p},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(1),r=i(7),h=i(6),l=i(5),c=i(10),u=i(8),d=i(2),p=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.type=a.ObjectTypes.OBJECT;var e=d.AssetsStorage.instance,i=t.className,s=e.getByKey(i+"_data"),p=t.params,f=p.x,y=p.y,g=t.params.rotation*h.default.TO_RAD,m=r.Filters.GROUND;this.body=o.NapeUtil.createRectBodyWH(n.STATIC,m,!1,s.w,s.h,f,y,g,c.CbTypes.SPIKES,u.Materials.DEFAULT),this.graphic=l.GraphicUtil.createImageWithObj(p,e.getByKey(i))},e}(o.GameObject);e.SpikesObject=p},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.geom.Ray,o=nape.geom.Vec2,a=nape.phys.BodyType,r=i(0),h=i(1),l=i(5),c=i(7),u=i(4),d=i(6),p=i(8),f=i(37),y=i(2),g=i(9),m=i(3),v=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.id=t.params.id,this.safeId=t.params.safeId,this.type=h.ObjectTypes.OBJECT;var e=y.AssetsStorage.instance,i=t.className,s=e.getByKey(i+"_data"),f=t.params,g=f.x,m=f.y;this.x=g,this.y=m,this.graphic=l.GraphicUtil.createImageWithObj(f,e.getByKey(i)),t.params.physic&&(this.body=r.NapeUtil.createRectBodyWH(a.DYNAMIC,c.Filters.WITH_EARTH_ONLY,!1,s.w,s.h,g,m,d.default.TO_RAD*f.rotation,null,p.Materials.DEFAULT),this.body.userData.handler=this,this.body.userData.graphicEx=this.graphic,r.NapeUtil.setupStartPos(this.body)),this.space=u.MaxGameCore.instance.getSpace(),f.impulse>0?(this.impulse=f.impulse,this.count=f.count,this.angle=2*Math.PI/this.count,this.ray=new n(o.weak(g,m),o.weak(1,0)),this.radius=f.radius,this.ray.maxDistance=this.radius):this.impulse=0,this.stones=!0===t.params.stones},e.prototype.processCollide=function(){if(this.body&&(this.body.space=null),this.impulse>0)for(var t=0;t<this.count;t++){var e=t*this.angle;this.ray.direction.angle=e;var i=this.space.rayCast(this.ray);if(i){var s=i.shape.body;if(s.isDynamic()){var n=o.fromPolar(this.impulse*(this.radius-i.distance)/this.radius,e),a=this.ray.at(i.distance);s.applyImpulse(n,a),a.dispose(),n.dispose()}i.dispose()}}this.active=!0,r.RaceCamera.inCamera(this.x,this.y,256)?(f.CarExplodeObject.get().activate(this.x,this.y,this.hideGraphic,null,this),r.RacesData.data.camera.shake(),g.default.getInstance().play(m.Sounds.Explode1),this.stones&&g.default.getInstance().play(m.Sounds.Stones)):this.graphic.visible=!1},e.prototype.hideGraphic=function(t){t.graphic.visible=!1},e.prototype.applyDamage=function(t,e){return void 0===e&&(e=null),this.processCollide(),!0},e.prototype.release=function(){this.space=null,t.prototype.release.call(this)},e.prototype.restart=function(){this.body&&(r.NapeUtil.stopBody(this.body),r.NapeUtil.resetStartPos(this.body),this.body.space=this.space),this.active=!1,this.graphic.visible=!0,this.dead=!1},e.prototype.activate=function(t){void 0===t&&(t=!0),this.active||t&&this.processCollide()},e.prototype.review=function(){this.restart()},e.prototype.isActive=function(){return!0},e}(r.GameObject);e.TntObject=v},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(4),r=i(7),h=i(10),l=i(8),c=i(9),u=i(3),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.id_off=-1,e.sensCount=0,e.sndId=-1,e}return s(e,t),e.prototype.restart=function(){this.active=!1,this.body.space=this.space,this.sensCount=0},e.prototype.dispose=function(){this.body.userData.collideCallback=null,this.body.userData.collideCallbackContext=null,this.body.space=null,this.body=null,this.space=null},e.prototype.create=function(t){void 0===t&&(t=null),this.space=a.MaxGameCore.instance.getSpace(),this.safeId=t.params.safeId,this.id=t.params.id,t.params.id_off&&(this.id_off=t.params.id_off),this.body=o.NapeUtil.createRectBody(n.STATIC,r.Filters.TOGGLE,!0,t.params,h.CbTypes.TOGGLE,l.Materials.DEFAULT),!0===t.params.off?(this.deactivated=!0,this.body.cbTypes.add(h.CbTypes.TOGGLE_OFF)):this.deactivated=!1,!0===t.params.bot&&(this.body.userData.bot=!0),this.body.userData.collideCallback=this.activate,this.body.userData.collideCallbackContext=this,this.sndId=t.params.sndId},e.prototype.activate=function(t,e,i){e||(i.id>=0&&t&&(a.MaxGameCore.instance.activate(i.id,!0),i.deactivated||(i.body.space=null),i.sensCount++),i.id_off>=0&&t&&(a.MaxGameCore.instance.activate(i.id_off,!1),i.deactivated||(i.body.space=null))),t||--i.sensCount<=0&&a.MaxGameCore.instance.activate(i.id,t),t&&(i.active||i.sndId>=0&&c.default.getInstance().play(1===i.sndId?u.Sounds.Wendy:u.Sounds.FlySound()),i.active=!0)},e.prototype.review=function(){this.restart()},e}(o.GameObject);e.ToggleObject=d},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(0),o=i(16),a=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(t){void 0===t&&(t=null),this.id=t.params.id;var i=t.params.width,s=t.params.height,n=i/s,a=o.default.GAME_W/o.default.GAME_H;this.x=t.params.x,this.y=t.params.y,n===a?(this.scale=o.default.GAME_W/i,this.move=e.STATIC):n>a?(this.move=e.HOR,this.scale=o.default.GAME_H/s,this.minMove=this.x-.5*i+.5*this.scale*i,this.maxMove=this.x+.5*i-.5*this.scale*i):(this.move=e.VER,this.scale=o.default.GAME_W/i,this.minMove=this.y-.5*s+.5*this.scale*s,this.maxMove=this.y+.5*s-.5*this.scale*s)},e.prototype.activate=function(t){void 0===t&&(t=!0),t?(e.focusedOnPoint=!1,e.current=this):this.deactivate()},e.prototype.deactivate=function(){e.current===this&&(e.current=null)},e.prototype.dispose=function(){e.current=null},e.prototype.restart=function(){e.current=null},e.prototype.isActive=function(){return!0},e.STATIC=0,e.HOR=1,e.VER=2,e.focusedOnPoint=!1,e}(n.GameObject);e.CameraZone=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.phys.BodyType,o=i(0),a=i(7),r=i(8),h=function(t){function e(){return t.call(this)||this}return s(e,t),e.prototype.create=function(i){void 0===i&&(i=null),t.prototype.create.call(this,i);var s=i.className;this.body=o.NapeUtil.createRectBody(n.STATIC,a.Filters.SENSOR,!0,i.params,void 0,r.Materials.DEFAULT),e.addCarsToUserData(this.body,i.params),"TiltZone"===s?(this.body.userData.backChance=i.params.backChance,this.body.userData.frontChance=i.params.frontChance):"BrakeZone"===s&&(this.body.userData.chance=i.params.chance)},e.addCarsToUserData=function(t,e){var i=e.cars;if(null!=i&&i.length>0){var s=i.split(",");t.userData.cars={};for(var n=0;n<s.length;n++)t.userData.cars[s[n]]=!0}},e}(o.GameObject);e.WaypointObject=h},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=nape.callbacks.CbEvent,o=nape.callbacks.CbType,a=nape.callbacks.CbTypeList,r=nape.callbacks.InteractionListener,h=nape.callbacks.InteractionType,l=i(0),c=i(9),u=i(3),d=i(31),p=function(t){function e(){var e=t.call(this)||this;return e.hasListeners=!1,e}return s(e,t),e.prototype.start=function(){t.prototype.start.call(this),l.RacesData.data=new l.RaceData,l.NapePhysics.space.gravity.setxy(0,l.RacesData.data.gravityY),this.hasListeners||this.setupListners()},e.prototype.setupListners=function(){this.hasListeners=!0,new r(n.ONGOING,h.SENSOR,l.CbTypes.BODY_COLLIDER,l.CbTypes.GEYSER,this.onGeyser).space=l.NapePhysics.space,new r(n.ONGOING,h.SENSOR,l.CbTypes.DRIVER_PART,l.CbTypes.GEYSER,this.onGeyser).space=l.NapePhysics.space,new r(n.ONGOING,h.SENSOR,l.CbTypes.WHEEL,l.CbTypes.GEYSER,this.onGeyser).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,l.CbTypes.BODY_COLLIDER,l.CbTypes.BOOST,this.onBoost).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,l.CbTypes.DRIVER_PART,l.CbTypes.BOOST,this.onBoost).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,l.CbTypes.WHEEL,l.CbTypes.BOOST,this.onBoost).space=l.NapePhysics.space;var t=new a;t.add(l.CbTypes.WHEEL),t.add(l.CbTypes.BODY_COLLIDER),new r(n.BEGIN,h.SENSOR,t,l.CbTypes.TOGGLE,e.onToggleSens).space=l.NapePhysics.space,new r(n.END,h.SENSOR,t,l.CbTypes.TOGGLE_OFF,e.onToggleSens).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,t,l.CbTypes.DESTOYED,this.onDestroyedSens).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,l.CbTypes.DRIVER,l.CbTypes.ZONE_FINISH,this.onFinish).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,l.CbTypes.DRIVER_PART,l.CbTypes.ZONE_FINISH,this.onFinish).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,l.CbTypes.DRIVER,l.CbTypes.SAFE_POINT,this.onCarSafePoint).space=l.NapePhysics.space,new r(n.BEGIN,h.SENSOR,l.CbTypes.DRIVER_PART,l.CbTypes.SAFE_POINT,this.onCarSafePoint).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,t,l.CbTypes.GLASS,this.onCarGlass).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.DRIVER,l.CbTypes.GLASS,this.onCarGlass).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.DRIVER_PART,l.CbTypes.GLASS,this.onCarGlass).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.DRIVER,l.CbTypes.GROUND,this.onDriverGround).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,t,l.CbTypes.SPIKES,this.onCarSpikes).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.DRIVER,l.CbTypes.SPIKES,this.onDriverSpikes).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.DRIVER_PART,l.CbTypes.SPIKES,this.onDriverSpikes).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,t,l.CbTypes.SAW,this.onCarSaw).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.DRIVER,l.CbTypes.SAW,this.onDriverSaw).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.DRIVER_PART,l.CbTypes.SAW,this.onDriverSaw).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.BARREL,o.ANY_BODY,this.onBarrelHit).space=l.NapePhysics.space,new r(n.BEGIN,h.COLLISION,l.CbTypes.WOOD,o.ANY_BODY,this.onWoodHit).space=l.NapePhysics.space,new r(n.BEGIN,h.FLUID,l.CbTypes.DRIVER,l.CbTypes.WATER,this.onWater).space=l.NapePhysics.space,new r(n.BEGIN,h.FLUID,l.CbTypes.DRIVER_PART,l.CbTypes.WATER,this.onWater).space=l.NapePhysics.space},e.prototype.onGeyser=function(t){var e=t.int1.castBody.userData,i=t.int2.castBody.userData.handler;e.effectVelX=i.velX,e.effectVelY=i.velY},e.prototype.onWater=function(t){t.int1.castBody.userData.handler.processDriverGround(),t.int1.castBody.userData.handler.explode()},e.prototype.onWoodHit=function(t){if(t.arbiters.at(0).collisionArbiter.normalImpulse().length>400){var e=t.int1.castBody.position;d.RaceCamera.inCamera(e.x,e.y,0)&&c.default.getInstance().play(u.Sounds.Wood)}},e.prototype.onBarrelHit=function(t){if(t.arbiters.at(0).collisionArbiter.normalImpulse().length>400){var e=t.int1.castBody.position;d.RaceCamera.inCamera(e.x,e.y,0)&&c.default.getInstance().play(Math.random()>.5?u.Sounds.Barrel1:u.Sounds.Barrel2)}},e.prototype.onDriverSaw=function(t){var e=t.int1.castBody.userData.handler;e&&(e.processDriverSpikes(),e.processDriverGround(),e.explode())},e.prototype.onCarSaw=function(t){t.int1.castBody.userData.handler.processDriverGround(),t.int1.castBody.userData.handler.explode()},e.prototype.onCarSpikes=function(t){t.int1.castBody.userData.handler.processDriverGround(),t.int1.castBody.userData.handler.explode()},e.prototype.onDriverSpikes=function(t){var e=t.int2.castBody,i=t.int1.castBody;e.isStatic()?(l.NapeUtil.stopBody(i),i.allowMovement=i.allowRotation=!1):i.userData.driverPart.pinTo(e),t.int1.castBody.userData.handler.processDriverSpikes(),t.int1.castBody.userData.handler.processDriverGround()},e.prototype.onDriverGround=function(t){t.int1.castBody.userData.handler.processDriverGround(),t.int1.castBody.userData.handler.explode()},e.prototype.onCarSafePoint=function(t){var e=t.int2.castBody,i=t.int1.castBody.userData.handler;if(i&&!i.dead){i.setReviewPos(e.position.x,e.position.y,e.userData.id);var s=t.int2.castBody.userData.collideCallbackContext;t.int2.castBody.userData.collideCallback(s)}},e.prototype.onCarGlass=function(t){var e=t.int2.castBody.userData.collideCallbackContext;t.int2.castBody.userData.collideCallback(t.arbiters.at(0).collisionArbiter.contacts.at(0).position,e)},e.prototype.onFinish=function(t){var e=t.int1.castBody.userData.handler;e&&e.processFinish(t.int1.castBody.userData.collideCallbackContext)},e.prototype.onDestroyedSens=function(t){var e=t.int2.castBody,i=t.int1.castBody,s=e.userData.collideCallback;s(e.userData.collideCallbackContext)&&s(i)},e.prototype.onBoost=function(t){var e=t.int2.castBody.userData;(0,e.collideCallback)(e.collideCallbackContext)&&t.int1.castBody.userData.handler.addBoost(e.time,e.force)},e.onToggleSens=function(t){if(t.event===n.BEGIN){var e=t.int2.castBody;if(null===e.space)return;var i=null===t.int1.castShape?t.int1.castBody:t.int1.castShape.body,s=e.userData.collideCallback,o=e.userData.collideCallbackContext;s(!0,i.userData.handler.dead,o)}else{if(s=t.int2.castBody.userData.collideCallback)s(!1,!1,o=t.int2.castBody.userData.collideCallbackContext)}},e.proccessZoneSens=function(t,e,i,s){if(s)t.userData[i]=!1;else if(null===e.userData.cars||!0===e.userData.cars[t.userData.skinId]){var n=e.userData.chance;Math.random()<n&&(t.userData[i]=!0)}},e}(l.NapePhysics);e.MaxPhysics=p},function(t,e,i){"use strict";e.__esModule=!0;var s=function(){function t(t){this.body=t,this.reset()}return t.prototype.update=function(t){var e=this.body.userData.effectVelX,i=this.body.userData.effectVelY;if(0!==e||0!==i){var s=2*t*(e-this.body.velocity.x),n=2*t*(i-this.body.velocity.y);this.body.velocity.x+=s,this.body.velocity.y+=n,this.body.userData.effectVelX=0,this.body.userData.effectVelY=0}},t.prototype.reset=function(){this.body.userData.effectVelX=0,this.body.userData.effectVelY=0},t.prototype.dispose=function(){this.body=null},t}();e.BodyEffector=s},function(t,e,i){"use strict";e.__esModule=!0;var s=nape.geom.Vec2,n=i(9),o=i(3),a=function(){function t(t){this.timeLeft=0,this.force=0,this.snd=null,this.body=t,this.compound=t.compound}return t.prototype.add=function(t,e){var i=this.timeLeft<=0;return i?(this.force=e,this.timeLeft=t,this.anim.visible=!0):(this.force=Math.max(this.force,e),this.timeLeft+=t),null==this.snd?this.snd=n.default.getInstance().play(o.Sounds.Boost):(this.snd.isPlaying&&this.snd.stop(),this.snd.play()),i},t.prototype.update=function(t,e){if(this.timeLeft>0){var i=this.compound.COM(),n=this.body.rotation,o=s.get(t*this.force*Math.cos(n),t*this.force*Math.sin(n));if(this.body.applyImpulse(o,i),o.dispose(),i.dispose(),e||(this.body.angularVel*=.8),this.timeLeft-=t,this.timeLeft<=0)return this.anim.visible=!1,null!=this.snd&&this.snd.stop(),!0}return!1},t.prototype.dispose=function(){this.anim=null,this.body=null,this.compound=null},t.prototype.restart=function(){this.anim.visible=!1,this.timeLeft=0,this.force=0},t}();e.BoostEffector=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(53),o=i(35),a=function(t){function e(e){return t.call(this,e)||this}return s(e,t),e.prototype.getDrive=function(){var t=0;return o.default.instance.isbtnDown?(t--,this.brake=!0):this.brake=!1,o.default.instance.isbtnUp?(t++,this.accell=!0):this.accell=!1,t},e.prototype.getBoost=function(){return t.prototype.getBoost.call(this)},e.prototype.getUseItem=function(){return this.car.itemId>=0},e.prototype.getTilt=function(){var t=0;return o.default.instance.isbtnLeft&&t--,o.default.instance.isbtnRight&&t++,t},e}(n.CarController);e.PlayerController=a},function(t,e,i){"use strict";var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();e.__esModule=!0;var n=i(18),o=i(17),a=function(t){function e(e,i,s){void 0===s&&(s=n.default.Garage);var a=t.call(this,e,i,o.default.styleChooseLevel,null,null,s)||this;return a.signalSelect=new Phaser.Signal,a.selected=!1,a.tween=null,a.tween2=null,a.id=i,a.btn.onInputDown.add(a.onDown,a),a}return s(e,t),e.prototype.getSelect=function(){return this.selected},e.prototype.getID=function(){return this.id},e.prototype.setColor=function(t){this.color=t},e.prototype.setSelect=function(t){this.selected=t,this.color>=0?this.selectTint():this.selectTween(),this.signalSelect.dispatch(this)},e.prototype.selectTint=function(){this.selected?(this.btn.tint=this.color,this.label.alpha=.7):(this.label.alpha=1,this.btn.tint=16777215)},e.prototype.selectTween=function(){this.selected?(this.tween=this.game.add.tween(this.scale),this.tween.to({x:1.1,y:1.1},300,Phaser.Easing.Linear.None,!1),this.tween2=this.game.add.tween(this.scale),this.tween2.to({x:1,y:1},300,Phaser.Easing.Linear.None,!1),this.tween2.onComplete.add(this.startTween1,this),this.tween.onComplete.add(this.startTween2,this),this.startTween1()):(this.tween&&(this.tween.stop(!1),this.game.tweens.remove(this.tween),this.tween2.stop(!1),this.game.tweens.remove(this.tween2)),this.scale.set(1),this.tween=null,this.tween2=null)},e.prototype.startTween1=function(){this.tween.start()},e.prototype.startTween2=function(){this.tween2.start()},e.prototype.onDown=function(){this.setSelect(!0)},e.prototype.destroy=function(e){this.signalSelect.removeAll(),this.signalSelect=null,t.prototype.destroy.call(this,e)},e}(i(13).default);e.default=a}]);